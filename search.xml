<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Nettyå¿ƒè·³åŸç†</title>
      <link href="/2024/02/03/Netty%E5%BF%83%E8%B7%B3%E5%8E%9F%E7%90%86/"/>
      <url>/2024/02/03/Netty%E5%BF%83%E8%B7%B3%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰ææè¦ä»£ç "><a href="#å‰ææè¦ä»£ç " class="headerlink" title="å‰ææè¦ä»£ç "></a>å‰ææè¦ä»£ç </h1><p>æ­¤éƒ¨åˆ†è¯¦ç»†ä»£ç è§<a href="/2024/01/30/Nettyå®ç°websocket/">Nettyå®ç°WebSocketåŸç†</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="comment">// æœåŠ¡å™¨å¯åŠ¨å¼•å¯¼å¯¹è±¡</span></span><br><span class="line">    <span class="type">ServerBootstrap</span> <span class="variable">serverBootstrap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerBootstrap</span>();</span><br><span class="line">    serverBootstrap.group(bossGroup, workerGroup)</span><br><span class="line">        .channel(NioServerSocketChannel.class)</span><br><span class="line">        .option(ChannelOption.SO_BACKLOG, <span class="number">128</span>)</span><br><span class="line">        .option(ChannelOption.SO_KEEPALIVE, <span class="literal">true</span>)</span><br><span class="line">        .handler(<span class="keyword">new</span> <span class="title class_">LoggingHandler</span>(LogLevel.INFO)) <span class="comment">// ä¸º bossGroup æ·»åŠ  æ—¥å¿—å¤„ç†å™¨</span></span><br><span class="line">        .childHandler(<span class="keyword">new</span> <span class="title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(SocketChannel socketChannel)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                <span class="type">ChannelPipeline</span> <span class="variable">pipeline</span> <span class="operator">=</span> socketChannel.pipeline();</span><br><span class="line">                <span class="comment">//30ç§’å®¢æˆ·ç«¯æ²¡æœ‰å‘æœåŠ¡å™¨å‘é€å¿ƒè·³åˆ™å…³é—­è¿æ¥</span></span><br><span class="line">                pipeline.addLast(<span class="keyword">new</span> <span class="title class_">IdleStateHandler</span>(<span class="number">30</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">                <span class="comment">// å› ä¸ºä½¿ç”¨httpåè®®ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨httpçš„ç¼–ç å™¨ï¼Œè§£ç å™¨</span></span><br><span class="line">                pipeline.addLast(<span class="keyword">new</span> <span class="title class_">HttpServerCodec</span>());</span><br><span class="line">                <span class="comment">// ä»¥å—æ–¹å¼å†™ï¼Œæ·»åŠ  chunkedWriter å¤„ç†å™¨</span></span><br><span class="line">                pipeline.addLast(<span class="keyword">new</span> <span class="title class_">ChunkedWriteHandler</span>());</span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">                         * è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment">                         *  1. httpæ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯åˆ†æ®µçš„ï¼ŒHttpObjectAggregatorå¯ä»¥æŠŠå¤šä¸ªæ®µèšåˆèµ·æ¥ï¼›</span></span><br><span class="line"><span class="comment">                         *  2. è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå½“æµè§ˆå™¨å‘é€å¤§é‡æ•°æ®æ—¶ï¼Œå°±ä¼šå‘å‡ºå¤šæ¬¡ httpè¯·æ±‚çš„åŸå› </span></span><br><span class="line"><span class="comment">                         */</span></span><br><span class="line">                pipeline.addLast(<span class="keyword">new</span> <span class="title class_">HttpObjectAggregator</span>(<span class="number">8192</span>));</span><br><span class="line">                <span class="comment">//ä¿å­˜ç”¨æˆ·ip</span></span><br><span class="line">                <span class="comment">//                        pipeline.addLast(new HttpHeadersHandler());</span></span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">                         * è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment">                         *  1. å¯¹äº WebSocketï¼Œå®ƒçš„æ•°æ®æ˜¯ä»¥å¸§frame çš„å½¢å¼ä¼ é€’çš„ï¼›</span></span><br><span class="line"><span class="comment">                         *  2. å¯ä»¥çœ‹åˆ° WebSocketFrame ä¸‹é¢æœ‰6ä¸ªå­ç±»</span></span><br><span class="line"><span class="comment">                         *  3. æµè§ˆå™¨å‘é€è¯·æ±‚æ—¶ï¼š ws://localhost:7000/hello è¡¨ç¤ºè¯·æ±‚çš„uri</span></span><br><span class="line"><span class="comment">                         *  4. WebSocketServerProtocolHandler æ ¸å¿ƒåŠŸèƒ½æ˜¯æŠŠ httpåè®®å‡çº§ä¸º ws åè®®ï¼Œä¿æŒé•¿è¿æ¥ï¼›</span></span><br><span class="line"><span class="comment">                         *      æ˜¯é€šè¿‡ä¸€ä¸ªçŠ¶æ€ç  101 æ¥åˆ‡æ¢çš„</span></span><br><span class="line"><span class="comment">                         */</span></span><br><span class="line">                pipeline.addLast(<span class="keyword">new</span> <span class="title class_">WebSocketServerProtocolHandler</span>(<span class="string">&quot;/&quot;</span>));</span><br><span class="line">                <span class="comment">// è‡ªå®šä¹‰handler ï¼Œå¤„ç†ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">                pipeline.addLast(<span class="keyword">new</span> <span class="title class_">NettyWebSocketServerHandler</span>());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="comment">// å¯åŠ¨æœåŠ¡å™¨ï¼Œç›‘å¬ç«¯å£ï¼Œé˜»å¡ç›´åˆ°å¯åŠ¨æˆåŠŸ</span></span><br><span class="line">    serverBootstrap.bind(WEB_SOCKET_PORT).sync();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å¿ƒè·³åŒ…"><a href="#å¿ƒè·³åŒ…" class="headerlink" title="å¿ƒè·³åŒ…"></a>å¿ƒè·³åŒ…</h1><p>å¦‚æœç”¨æˆ·çªç„¶å…³é—­ç½‘é¡µï¼Œæ˜¯ä¸ä¼šæœ‰æ–­å¼€é€šçŸ¥ç»™æœåŠ¡ç«¯çš„ã€‚é‚£ä¹ˆæœåŠ¡ç«¯æ°¸è¿œæ„ŸçŸ¥ä¸åˆ°ç”¨æˆ·ä¸‹çº¿ã€‚å› æ­¤éœ€è¦å®¢æˆ·ç«¯ç»´æŒä¸€ä¸ªå¿ƒè·³ï¼Œå½“æŒ‡å®šæ—¶é—´æ²¡æœ‰å¿ƒè·³ï¼ŒæœåŠ¡ç«¯ä¸»åŠ¨æ–­å¼€ï¼Œè¿›è¡Œç”¨æˆ·ä¸‹çº¿æ“ä½œã€‚</p><p>ç›´æ¥æ¥å…¥nettyçš„ç°æœ‰ç»„ä»¶<code>new IdleStateHandler(30, 0, 0)</code>å¯ä»¥å®ç°30ç§’é“¾æ¥æ²¡æœ‰è¯»è¯·æ±‚ï¼Œå°±ä¸»åŠ¨å…³é—­é“¾æ¥ã€‚æˆ‘ä»¬çš„webå‰ç«¯éœ€è¦ä¿æŒæ¯10så‘é€ä¸€ä¸ªå¿ƒè·³åŒ…ã€‚</p><p>åœ¨æ­¤éƒ¨åˆ†çš„ä»£ç ç¬¬34è¡Œ,  WebSocketè‡ªå¸¦æœ‰ä¸€ä¸ªå¿ƒè·³æ£€æµ‹ç»„ä»¶  å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//30ç§’å®¢æˆ·ç«¯æ²¡æœ‰å‘æœåŠ¡å™¨å‘é€å¿ƒè·³åˆ™å…³é—­è¿æ¥</span></span><br><span class="line">pipeline.addLast(<span class="keyword">new</span> <span class="title class_">IdleStateHandler</span>(<span class="number">30</span>, <span class="number">0</span>, <span class="number">0</span>)); <span class="comment">// è¯»ç©ºé—²æ—¶é—´ å†™ç©ºé—²æ—¶é—´ å…¨å±€æ—¶é—´</span></span><br></pre></td></tr></table></figure><ol><li>ç¬¬ä¸€ä¸ªå‚æ•°: è¯»ç©ºé—²æ—¶é—´</li></ol><p>å‰ç«¯ä¸»åŠ¨è¯·æ±‚,  ç»™å®¢æˆ·ç«¯ä¸»åŠ¨å‘é€ä¸€æ¡æ¶ˆæ¯,  å¦‚æœåœ¨30ç§’å†…æœ‰æ–°æ¶ˆæ¯åˆ™ä¸ºæ­£å¸¸çŠ¶æ€,  æ²¡ç”¨åˆ™å…³é—­è¿æ¥</p><ol start="2"><li>ç¬¬äºŒä¸ªå‚æ•°: å†™ç©ºé—²æ—¶é—´</li></ol><p>åç«¯æœ‰æ²¡æœ‰ä¸»åŠ¨ç»™å‰ç«¯å†™æ¶ˆæ¯,  ä¸€èˆ¬é€‚ç”¨äºå®¢æˆ·ç«¯,  å®¢æˆ·ç«¯åŠ äº†å¿ƒè·³,  åˆ™å®¢æˆ·ç«¯ä¼šè‡ªå·±ä¸»åŠ¨å†™å¿ƒè·³</p><h2 id="æµ‹è¯•å¿ƒè·³"><a href="#æµ‹è¯•å¿ƒè·³" class="headerlink" title="æµ‹è¯•å¿ƒè·³"></a>æµ‹è¯•å¿ƒè·³</h2><p>æ­¤é¡¹ä¸å‰é¢æåˆ°çš„æ–‡ç« ä»£ç ä¸€è‡´(åœ¨ #è‡ªå®šä¹‰æ¡æ‰‹äº‹ä»¶)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">userEventTriggered</span><span class="params">(ChannelHandlerContext ctx, Object evt)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœäº‹ä»¶æ˜¯ä¸€ä¸ªWebSocketæ¡æ‰‹çš„äº‹ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (evt <span class="keyword">instanceof</span> WebSocketServerProtocolHandler.HandshakeComplete) &#123;</span><br><span class="line">        log.info(<span class="string">&quot;[æ¡æ‰‹å®Œæˆ]&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (evt <span class="keyword">instanceof</span> IdleStateEvent) &#123;</span><br><span class="line">        <span class="comment">// å¿ƒè·³</span></span><br><span class="line">        <span class="type">IdleStateEvent</span> <span class="variable">event</span> <span class="operator">=</span> (IdleStateEvent) evt;</span><br><span class="line">        <span class="keyword">if</span> (event.state() == IdleState.READER_IDLE) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;[è¯»ç©ºé—²]&quot;</span>);</span><br><span class="line">            <span class="comment">//todo ç”¨æˆ·ä¸‹çº¿</span></span><br><span class="line">            ctx.channel().close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è®¾ç½®äº†å‰é¢çš„ç¬¬ä¸€ä¸ªå‚æ•°å,  å¯åŠ¨æœåŠ¡,  è¿æ¥WebSocketç„¶åç­‰å¾…30ç§’åˆ™ä¼šè¾“å‡ºæ—¥å¿—: [è¯»ç©ºé—²]</p><h1 id="ç»“å°¾"><a href="#ç»“å°¾" class="headerlink" title="ç»“å°¾"></a>ç»“å°¾</h1><p>å…¶å®å°±æ˜¯,  åœ¨è®¾å®šçš„30ç§’å†…æ²¡æœ‰æ–°æ¶ˆæ¯,  å°±ä¼šå‘é€ä¸€ä¸ªäº‹ä»¶,  åœ¨è¿½è¸ª<strong>IdleStateHandler</strong>æºç å¯ä»¥å‘ç°,  å®ƒæœ‰ä¸€äº›è¯»æ¶ˆæ¯çš„åœ°æ–¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.readerIdleTimeNanos &gt; <span class="number">0L</span> || <span class="built_in">this</span>.allIdleTimeNanos &gt; <span class="number">0L</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.reading = <span class="literal">true</span>;</span><br><span class="line">        <span class="built_in">this</span>.firstReaderIdleEvent = <span class="built_in">this</span>.firstAllIdleEvent = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ctx.fireChannelRead(msg);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¯»å®Œæˆ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelReadComplete</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">if</span> ((<span class="built_in">this</span>.readerIdleTimeNanos &gt; <span class="number">0L</span> || <span class="built_in">this</span>.allIdleTimeNanos &gt; <span class="number">0L</span>) &amp;&amp; <span class="built_in">this</span>.reading) &#123;</span><br><span class="line">        <span class="comment">// è®°å½•æœ€åä¸€æ¬¡è¯»çš„æ—¶é—´</span></span><br><span class="line">        <span class="built_in">this</span>.lastReadTime = <span class="built_in">this</span>.ticksInNanos(); <span class="comment">// æ­¤é¡¹é€šè¿‡å®šæ—¶ä»»åŠ¡å®ç°</span></span><br><span class="line">        <span class="built_in">this</span>.reading = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ctx.fireChannelReadComplete();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®å°±æ˜¯è¯»Channel,  è®°å½•æœ€åä¸€æ¬¡è¯»çš„æ—¶é—´ä¸ä¹‹å½“å‰æ—¶é—´è¿›è¡Œå¯¹æ¯”,  æœ€åä¸€æ¬¡è¯»çš„æ—¶é—´çš„æ›´æ–°é€šè¿‡<u>å®šæ—¶ä»»åŠ¡</u>å®Œæˆ,  é€šè¿‡è¿½è¸ªlastReadTimeå±æ€§</p><p>å¯ä»¥å‘ç°æºç ä¸­å­˜åœ¨å¦‚ä¸‹çš„å®šæ—¶ä»»åŠ¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">ReaderIdleTimeoutTask</span> <span class="keyword">extends</span> <span class="title class_">AbstractIdleTask</span> &#123;</span><br><span class="line"></span><br><span class="line">    ReaderIdleTimeoutTask(ChannelHandlerContext ctx) &#123;</span><br><span class="line">        <span class="built_in">super</span>(ctx);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(ChannelHandlerContext ctx)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">nextDelay</span> <span class="operator">=</span> readerIdleTimeNanos;</span><br><span class="line">        <span class="keyword">if</span> (!reading) &#123;</span><br><span class="line">            <span class="comment">// æ—¶é—´å¤„ç†</span></span><br><span class="line">            nextDelay -= ticksInNanos() - lastReadTime;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (nextDelay &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// Reader is idle - set a new timeout and notify the callback.</span></span><br><span class="line">            <span class="comment">// ä¸è®ºä»€ä¹ˆæƒ…å†µéƒ½ä¼šæ‰§è¡Œä¸‹ä¸€æ¬¡å‘¨æœŸçš„å®šæ—¶ä»»åŠ¡,é€šè¿‡çº¿ç¨‹æ± æ‰§è¡Œå®šæ—¶ä»»åŠ¡,å…·ä½“å®šæ—¶å¤šä¹…è¯»è€…è‡ªè¡ŒæŸ¥é˜…</span></span><br><span class="line">            readerIdleTimeout = schedule(ctx, <span class="built_in">this</span>, readerIdleTimeNanos, TimeUnit.NANOSECONDS);</span><br><span class="line"></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">first</span> <span class="operator">=</span> firstReaderIdleEvent;</span><br><span class="line">            firstReaderIdleEvent = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// äº‹ä»¶é€šçŸ¥, æ„å»ºä¸€ä¸ªè¯»ç©ºé—²æ—¶é—´</span></span><br><span class="line">                <span class="type">IdleStateEvent</span> <span class="variable">event</span> <span class="operator">=</span> newIdleStateEvent(IdleState.READER_IDLE, first);</span><br><span class="line">                channelIdle(ctx, event);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">                ctx.fireExceptionCaught(t);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Read occurred before the timeout - set a new timeout with shorter delay.</span></span><br><span class="line">            readerIdleTimeout = schedule(ctx, <span class="built_in">this</span>, nextDelay, TimeUnit.NANOSECONDS);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ¯ä¸€æ¬¡æœ‰æ–°æ¶ˆæ¯è¿›æ¥çš„æ—¶å€™,  æˆ‘ä»¬ä¼šæ›´æ–°æœ€åä¸€æ¬¡äº‹ä»¶æ—¶é—´(æ­¤é¡¹è¯¦æƒ…åœ¨scheduleå®šæ—¶ä»»åŠ¡),  æœ€åç»„æˆå¿ƒè·³æœºåˆ¶</p><p>å¿ƒè·³å¤„ç†å™¨åªæ˜¯å‘å‡ºäº‹ä»¶,  å…·ä½“å¤„ç†äº¤ç»™æˆ‘ä»¬è‡ªå·±,  ä¾‹å¦‚ç¬”è€…æ ·ä¾‹ä»£ç ä¸­å­˜åœ¨ä¸€å¤„ä¸º&#x2F;&#x2F; todo ç”¨æˆ·ä¸‹çº¿,  æ‰€ä»¥è¿˜èƒ½å¯¹ç”¨æˆ·ä¸‹çº¿è¿›è¡Œä¸šåŠ¡é€»è¾‘å¤„ç†,  é‚£ä¹ˆè¿™æ ·(åªæ˜¯é€šè¿‡å‘å‡ºäº‹ä»¶)çš„å¥½å¤„å¯ä»¥è§£è€¦</p><h1 id="å†™åœ¨æœ€å"><a href="#å†™åœ¨æœ€å" class="headerlink" title="å†™åœ¨æœ€å"></a>å†™åœ¨æœ€å</h1><p>ä¸ºä»€ä¹ˆæˆ‘ä»¬ä½¿ç”¨netty,  å› ä¸ºå®ƒä»¥åŠå°è£…äº†å¾ˆå¤šå®ç”¨çš„ç»„ä»¶äº†,  ä»¥è‡³äºæ²¡æœ‰ä½¿ç”¨åŸç”Ÿçš„æœåŠ¡</p>]]></content>
      
      
      <categories>
          
          <category> WebSocket </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Netty </tag>
            
            <tag> WebSocket </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nettyå®ç°WebSocketåŸç†</title>
      <link href="/2024/01/30/Netty%E5%AE%9E%E7%8E%B0websocket/"/>
      <url>/2024/01/30/Netty%E5%AE%9E%E7%8E%B0websocket/</url>
      
        <content type="html"><![CDATA[<div class="note pink anzhiyufont anzhiyu-icon-instagram simple"><p>å“ªæ€•æ˜å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹ï¼Œä¹Ÿæ¯”åŸåœ°è¸æ­¥æˆ–é€€æ­¥è¦å¥½</p></div><h1 id="å‰ç½®æè¦"><a href="#å‰ç½®æè¦" class="headerlink" title="å‰ç½®æè¦"></a>å‰ç½®æè¦</h1><p>Netty WebSocket Serverä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NettyWebSocketServer</span> &#123;</span><br><span class="line">    <span class="comment">// å¼€å¯nettyæœåŠ¡ç«¯å£8090</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">WEB_SOCKET_PORT</span> <span class="operator">=</span> <span class="number">8090</span>;</span><br><span class="line">    <span class="comment">// åˆ›å»ºçº¿ç¨‹æ± æ‰§è¡Œå™¨</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">EventLoopGroup</span> <span class="variable">bossGroup</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="type">EventLoopGroup</span> <span class="variable">workerGroup</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NioEventLoopGroup</span>(NettyRuntime.availableProcessors());</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯åŠ¨ ws server</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> InterruptedException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        run();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é”€æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PreDestroy</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        Future&lt;?&gt; future = bossGroup.shutdownGracefully();</span><br><span class="line">        Future&lt;?&gt; future1 = workerGroup.shutdownGracefully();</span><br><span class="line">        future.syncUninterruptibly();</span><br><span class="line">        future1.syncUninterruptibly();</span><br><span class="line">        log.info(<span class="string">&quot;å…³é—­ ws server æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="comment">// æœåŠ¡å™¨å¯åŠ¨å¼•å¯¼å¯¹è±¡</span></span><br><span class="line">        <span class="type">ServerBootstrap</span> <span class="variable">serverBootstrap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerBootstrap</span>();</span><br><span class="line">        serverBootstrap.group(bossGroup, workerGroup)</span><br><span class="line">                .channel(NioServerSocketChannel.class)</span><br><span class="line">                .option(ChannelOption.SO_BACKLOG, <span class="number">128</span>)</span><br><span class="line">                .option(ChannelOption.SO_KEEPALIVE, <span class="literal">true</span>)</span><br><span class="line">                .handler(<span class="keyword">new</span> <span class="title class_">LoggingHandler</span>(LogLevel.INFO)) <span class="comment">// ä¸º bossGroup æ·»åŠ  æ—¥å¿—å¤„ç†å™¨</span></span><br><span class="line">                .childHandler(<span class="keyword">new</span> <span class="title class_">ChannelInitializer</span>&lt;SocketChannel&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initChannel</span><span class="params">(SocketChannel socketChannel)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                        <span class="type">ChannelPipeline</span> <span class="variable">pipeline</span> <span class="operator">=</span> socketChannel.pipeline();</span><br><span class="line">                        <span class="comment">//30ç§’å®¢æˆ·ç«¯æ²¡æœ‰å‘æœåŠ¡å™¨å‘é€å¿ƒè·³åˆ™å…³é—­è¿æ¥</span></span><br><span class="line">                        pipeline.addLast(<span class="keyword">new</span> <span class="title class_">IdleStateHandler</span>(<span class="number">30</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">                        <span class="comment">// å› ä¸ºä½¿ç”¨httpåè®®ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨httpçš„ç¼–ç å™¨ï¼Œè§£ç å™¨</span></span><br><span class="line">                        pipeline.addLast(<span class="keyword">new</span> <span class="title class_">HttpServerCodec</span>());</span><br><span class="line">                        <span class="comment">// ä»¥å—æ–¹å¼å†™ï¼Œæ·»åŠ  chunkedWriter å¤„ç†å™¨</span></span><br><span class="line">                        pipeline.addLast(<span class="keyword">new</span> <span class="title class_">ChunkedWriteHandler</span>());</span><br><span class="line">                        <span class="comment">/**</span></span><br><span class="line"><span class="comment">                         * è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment">                         *  1. httpæ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯åˆ†æ®µçš„ï¼ŒHttpObjectAggregatorå¯ä»¥æŠŠå¤šä¸ªæ®µèšåˆèµ·æ¥ï¼›</span></span><br><span class="line"><span class="comment">                         *  2. è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå½“æµè§ˆå™¨å‘é€å¤§é‡æ•°æ®æ—¶ï¼Œå°±ä¼šå‘å‡ºå¤šæ¬¡ httpè¯·æ±‚çš„åŸå› </span></span><br><span class="line"><span class="comment">                         */</span></span><br><span class="line">                        pipeline.addLast(<span class="keyword">new</span> <span class="title class_">HttpObjectAggregator</span>(<span class="number">8192</span>));</span><br><span class="line">                        <span class="comment">//ä¿å­˜ç”¨æˆ·ip</span></span><br><span class="line"><span class="comment">//                        pipeline.addLast(new HttpHeadersHandler());</span></span><br><span class="line">                        <span class="comment">/**</span></span><br><span class="line"><span class="comment">                         * è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment">                         *  1. å¯¹äº WebSocketï¼Œå®ƒçš„æ•°æ®æ˜¯ä»¥å¸§frame çš„å½¢å¼ä¼ é€’çš„ï¼›</span></span><br><span class="line"><span class="comment">                         *  2. å¯ä»¥çœ‹åˆ° WebSocketFrame ä¸‹é¢æœ‰6ä¸ªå­ç±»</span></span><br><span class="line"><span class="comment">                         *  3. æµè§ˆå™¨å‘é€è¯·æ±‚æ—¶ï¼š ws://localhost:7000/hello è¡¨ç¤ºè¯·æ±‚çš„uri</span></span><br><span class="line"><span class="comment">                         *  4. WebSocketServerProtocolHandler æ ¸å¿ƒåŠŸèƒ½æ˜¯æŠŠ httpåè®®å‡çº§ä¸º ws åè®®ï¼Œä¿æŒé•¿è¿æ¥ï¼›</span></span><br><span class="line"><span class="comment">                         *      æ˜¯é€šè¿‡ä¸€ä¸ªçŠ¶æ€ç  101 æ¥åˆ‡æ¢çš„</span></span><br><span class="line"><span class="comment">                         */</span></span><br><span class="line">                        pipeline.addLast(<span class="keyword">new</span> <span class="title class_">WebSocketServerProtocolHandler</span>(<span class="string">&quot;/&quot;</span>));</span><br><span class="line">                        <span class="comment">// è‡ªå®šä¹‰handler ï¼Œå¤„ç†ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">                        pipeline.addLast(<span class="keyword">new</span> <span class="title class_">NettyWebSocketServerHandler</span>());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">        <span class="comment">// å¯åŠ¨æœåŠ¡å™¨ï¼Œç›‘å¬ç«¯å£ï¼Œé˜»å¡ç›´åˆ°å¯åŠ¨æˆåŠŸ</span></span><br><span class="line">        serverBootstrap.bind(WEB_SOCKET_PORT).sync();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h1><h2 id="ä¼˜é›…é”€æ¯æœåŠ¡"><a href="#ä¼˜é›…é”€æ¯æœåŠ¡" class="headerlink" title="ä¼˜é›…é”€æ¯æœåŠ¡"></a>ä¼˜é›…é”€æ¯æœåŠ¡</h2><p>åœ¨ä»£ç ç¬¬25è¡Œçš„destroyæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PreDestroy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">    Future&lt;?&gt; future = bossGroup.shutdownGracefully();</span><br><span class="line">    Future&lt;?&gt; future1 = workerGroup.shutdownGracefully();</span><br><span class="line">    future.syncUninterruptibly();</span><br><span class="line">    future1.syncUninterruptibly();</span><br><span class="line">    log.info(<span class="string">&quot;å…³é—­ ws server æˆåŠŸ&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯æŠŠè¿æ¥å…ˆè¿›è¡Œå…³é—­,  ç„¶åå†<u>è¿›è¡Œç­‰å¾…</u>ç‰‡åˆ»ã€‚</p><h2 id="æœåŠ¡ç»“æ„"><a href="#æœåŠ¡ç»“æ„" class="headerlink" title="æœåŠ¡ç»“æ„"></a>æœåŠ¡ç»“æ„</h2><p>é‡å†™runæ–¹æ³•å®ç°ä¸­ï¼Œåœ¨å‰æä»£ç ä¸­ç¬¬44è¡Œ</p><p><code>ChannelPipeline pipeline = socketChannel.pipeline();</code></p><p>ç®¡é“ï¼Œæ¯ä¸€ä¸ªNettyæœåŠ¡éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ChannelPipelineç®¡é“ï¼Œæ­¤éƒ¨åˆ†ä¸€èˆ¬ç”¨äºå®ç°æ·»åŠ å¯¹åº”çš„<u>å¤„ç†å™¨</u>ã€‚ä¾‹å¦‚HttpServerã€WebSocketç­‰å¤„ç†å™¨</p><p>æ­¤å¤„æˆ‘ä»¬ä»¥WebSocketå¤„ç†å™¨ä¸ºä¾‹ï¼ˆ67è¡Œï¼‰ï¼Œå…¶ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pipeline.addLast(<span class="keyword">new</span> <span class="title class_">WebSocketServerProtocolHandler</span>(<span class="string">&quot;/&quot;</span>));</span><br></pre></td></tr></table></figure><p>è¿½è¸ªå¤„ç†å™¨ï¼ˆè¿½è¸ªè¿›å»å¯ä»¥æ‰¾åˆ°åé¢çš„æ–¹æ³•ï¼šhandlerAddedï¼‰ï¼Œåœ¨å…¶æºç ä¸­ä¸éš¾å‘ç°æœ‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handlerAdded</span><span class="params">(ChannelHandlerContext ctx)</span> &#123;</span><br><span class="line">    <span class="type">ChannelPipeline</span> <span class="variable">cp</span> <span class="operator">=</span> ctx.pipeline();</span><br><span class="line">    <span class="keyword">if</span> (cp.get(WebSocketServerProtocolHandshakeHandler.class) == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// Add the WebSocketHandshakeHandler before this one.</span></span><br><span class="line">        <span class="comment">// å¤„ç†æ¡æ‰‹ï¼šWebSocketServerProtocolHandshakeHandler</span></span><br><span class="line">        cp.addBefore(ctx.name(), WebSocketServerProtocolHandshakeHandler.class.getName(),</span><br><span class="line">                     <span class="keyword">new</span> <span class="title class_">WebSocketServerProtocolHandshakeHandler</span>(serverConfig));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (serverConfig.decoderConfig().withUTF8Validator() &amp;&amp; cp.get(Utf8FrameValidator.class) == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// Add the UFT8 checking before this one.</span></span><br><span class="line">        cp.addBefore(ctx.name(), Utf8FrameValidator.class.getName(),</span><br><span class="line">                     <span class="keyword">new</span> <span class="title class_">Utf8FrameValidator</span>(serverConfig.decoderConfig().closeOnProtocolViolation()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿½è¸ª æ¡æ‰‹å¤„ç†å™¨ç±»WebSocketServerProtocolHandshakeHandlerï¼š</p><p>å¯ä»¥å‘ç°æœ‰ä¸€ä¸ªæ–¹æ³•ä¸ºï¼š <strong>channelRead</strong>ï¼Œå…·ä½“å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">channelRead</span><span class="params">(<span class="keyword">final</span> ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">HttpObject</span> <span class="variable">httpObject</span> <span class="operator">=</span> (HttpObject) msg;</span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯Httpè¯·æ±‚</span></span><br><span class="line">    <span class="keyword">if</span> (httpObject <span class="keyword">instanceof</span> HttpRequest) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">HttpRequest</span> <span class="variable">req</span> <span class="operator">=</span> (HttpRequest) httpObject;</span><br><span class="line">        isWebSocketPath = isWebSocketPath(req);</span><br><span class="line">        <span class="keyword">if</span> (!isWebSocketPath) &#123;</span><br><span class="line">            ctx.fireChannelRead(msg);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!GET.equals(req.method())) &#123;</span><br><span class="line">                sendHttpResponse(ctx, req, <span class="keyword">new</span> <span class="title class_">DefaultFullHttpResponse</span>(HTTP_1_1, FORBIDDEN, ctx.alloc().buffer(<span class="number">0</span>)));</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// ç»„è£…æ¡æ‰‹å“åº”</span></span><br><span class="line">            <span class="keyword">final</span> <span class="type">WebSocketServerHandshakerFactory</span> <span class="variable">wsFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebSocketServerHandshakerFactory</span>(</span><br><span class="line">                getWebSocketLocation(ctx.pipeline(), req, serverConfig.websocketPath()),</span><br><span class="line">                serverConfig.subprotocols(), serverConfig.decoderConfig());</span><br><span class="line">            <span class="comment">// åˆ›å»ºä¸€ä¸ªæ¡æ‰‹çš„å“åº”ç±»</span></span><br><span class="line">            <span class="keyword">final</span> <span class="type">WebSocketServerHandshaker</span> <span class="variable">handshaker</span> <span class="operator">=</span> wsFactory.newHandshaker(req);</span><br><span class="line">            <span class="keyword">final</span> <span class="type">ChannelPromise</span> <span class="variable">localHandshakePromise</span> <span class="operator">=</span> handshakePromise;</span><br><span class="line">            <span class="keyword">if</span> (handshaker == <span class="literal">null</span>) &#123;</span><br><span class="line">                WebSocketServerHandshakerFactory.sendUnsupportedVersionResponse(ctx.channel());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// Ensure we set the handshaker and replace this handler before we</span></span><br><span class="line">                <span class="comment">// trigger the actual handshake. Otherwise we may receive websocket bytes in this handler</span></span><br><span class="line">                <span class="comment">// before we had a chance to replace it.</span></span><br><span class="line">                <span class="comment">//</span></span><br><span class="line">                <span class="comment">// See https://github.com/netty/netty/issues/9471.</span></span><br><span class="line">                WebSocketServerProtocolHandler.setHandshaker(ctx.channel(), handshaker);</span><br><span class="line">                <span class="comment">// ğŸ˜€ä»è¯·æ±‚ç®¡é“ä¸­ç§»é™¤è‡ªå·±ï¼Œæˆ‘ä»¬WebSocketè¿æ¥åªéœ€è¦åœ¨ç¬¬ä¸€æ¬¡è¿æ¥çš„æ—¶å€™ä½¿ç”¨ç„¶åè¿›è¡Œå‡çº§ï¼Œéšåç§»é™¤</span></span><br><span class="line">                ctx.pipeline().remove(<span class="built_in">this</span>);</span><br><span class="line">                <span class="comment">// æ¡æ‰‹çš„å“åº”ç±»ä¼šé€šè¿‡handshakerè¿›è¡Œè¯·æ±‚çš„å“åº”</span></span><br><span class="line">                <span class="keyword">final</span> <span class="type">ChannelFuture</span> <span class="variable">handshakeFuture</span> <span class="operator">=</span> handshaker.handshake(ctx.channel(), req);</span><br><span class="line">                handshakeFuture.addListener(<span class="keyword">new</span> <span class="title class_">ChannelFutureListener</span>() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">operationComplete</span><span class="params">(ChannelFuture future)</span> &#123;</span><br><span class="line">                        <span class="comment">// äº‹ä»¶ç›‘å¬ï¼šå¯¹å¤±è´¥ä¸æˆåŠŸæƒ…å†µè¿›è¡Œå¤„ç†</span></span><br><span class="line">                        <span class="keyword">if</span> (!future.isSuccess()) &#123;</span><br><span class="line">                            localHandshakePromise.tryFailure(future.cause());</span><br><span class="line">                            ctx.fireExceptionCaught(future.cause());</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            localHandshakePromise.trySuccess();</span><br><span class="line">                            <span class="comment">// Kept for compatibility</span></span><br><span class="line">                            ctx.fireUserEventTriggered(</span><br><span class="line">                                WebSocketServerProtocolHandler.ServerHandshakeStateEvent.HANDSHAKE_COMPLETE);</span><br><span class="line">                            ctx.fireUserEventTriggered(</span><br><span class="line">                                <span class="comment">// æˆåŠŸåˆ™å‘é€ä¸€ä¸ªä¸‹é¢çš„æ¡æ‰‹äº‹ä»¶ä½“</span></span><br><span class="line">                                <span class="keyword">new</span> <span class="title class_">WebSocketServerProtocolHandler</span>.HandshakeComplete(</span><br><span class="line">                                    req.uri(), req.headers(), handshaker.selectedSubprotocol()));</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                applyHandshakeTimeout();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            ReferenceCountUtil.release(req);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!isWebSocketPath) &#123;</span><br><span class="line">        ctx.fireChannelRead(msg);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        ReferenceCountUtil.release(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°çš„ä»£ç æ ·ä¾‹ä¸­æœ‰æ³¨é‡Šè§£é‡Šä»£ç ï¼Œä¸‹é¢è¿›è¡Œè¯´æ˜</p><ul><li>ç¬¬äº”è¡Œï¼š<code>if (httpObject instanceof HttpRequest)</code></li></ul><p>åˆ¤å®šè¯·æ±‚æ˜¯å¦ä¸ºHttpè¯·æ±‚</p><ul><li>ç¬¬åå…«è¡Œï¼šç»„è£…æ¡æ‰‹å“åº”</li><li>ç¬¬äºŒåäºŒè¡Œï¼šåˆ›å»ºä¸€ä¸ªæ¡æ‰‹çš„å“åº”ç±»</li></ul><p>ä¸ºåé¢çš„å“åº”è¿›è¡Œå¤„ç†</p><ul><li>â—ˆç¬¬ä¸‰åå››è¡Œï¼šç§»é™¤è‡ªå·±</li></ul><p>ä»è¯·æ±‚ç®¡é“ä¸­ç§»é™¤è‡ªå·±ï¼Œæˆ‘ä»¬WebSocketè¿æ¥åªéœ€è¦åœ¨ç¬¬ä¸€æ¬¡è¿æ¥çš„æ—¶å€™ä½¿ç”¨ç„¶åè¿›è¡Œå‡çº§ï¼Œéšåç§»é™¤ã€‚å› ä¸ºåªåœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼ˆå‡çº§ï¼‰çš„æ—¶å€™ä½¿ç”¨åˆ°äº†ï¼Œåç»­ä¸éœ€è¦å“Ÿåˆ°</p><ul><li>ç¬¬ä¸‰åå…­è¡Œï¼š</li></ul><p>æ¡æ‰‹çš„å“åº”ç±»ä¼šé€šè¿‡handshakerè¿›è¡Œè¯·æ±‚çš„å“åº”</p><ul><li>ç¬¬äº”åä¸€è¡Œï¼šå‘é€è¯·æ±‚</li></ul><p>å¦‚æœäº‹ä»¶æˆåŠŸåˆ™å‘é€ä¸€ä¸ªæ¡æ‰‹äº‹ä»¶ä½“</p><h2 id="é‡å†™è‡ªå®šä¹‰æ¡æ‰‹äº‹ä»¶"><a href="#é‡å†™è‡ªå®šä¹‰æ¡æ‰‹äº‹ä»¶" class="headerlink" title="é‡å†™è‡ªå®šä¹‰æ¡æ‰‹äº‹ä»¶"></a>é‡å†™è‡ªå®šä¹‰æ¡æ‰‹äº‹ä»¶</h2><p>åŸºäºå‰é¢æœ€ååˆ†æçš„å‘é€æ¡æ‰‹äº‹ä»¶ä½“ï¼Œåˆ™æœ‰å¦‚ä¸‹å®ç°ï¼ˆé€šè¿‡é‡å†™userEventTriggeredæ–¹æ³•ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NettyWebSocketServerHandler</span> <span class="keyword">extends</span> <span class="title class_">SimpleChannelInboundHandler</span>&lt;TextWebSocketFrame&gt; &#123;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¦‚æœéœ€è¦åœ¨æ¡æ‰‹çš„æ—¶å€™è¿›è¡Œè®¤è¯ï¼Œåˆ™å¯ä»¥å°†è®¤è¯é€»è¾‘å¡«å†™è‡³æ­¤å¤„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ctx</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> evt äº‹ä»¶ç±»å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">userEventTriggered</span><span class="params">(ChannelHandlerContext ctx, Object evt)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœäº‹ä»¶æ˜¯ä¸€ä¸ªWebSocketæ¡æ‰‹çš„äº‹ä»¶</span></span><br><span class="line">        <span class="keyword">if</span> (evt <span class="keyword">instanceof</span> WebSocketServerProtocolHandler.HandshakeComplete) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¡æ‰‹å®Œæˆ&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (evt <span class="keyword">instanceof</span> IdleStateEvent) &#123;</span><br><span class="line">            <span class="type">IdleStateEvent</span> <span class="variable">event</span> <span class="operator">=</span> (IdleStateEvent) evt;</span><br><span class="line">            <span class="keyword">if</span> (event.state() == IdleState.READER_IDLE) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;è¯»ç©ºé—²&quot;</span>);</span><br><span class="line">                <span class="comment">//todo ç”¨æˆ·ä¸‹çº¿</span></span><br><span class="line">                ctx.channel().close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">channelRead0</span><span class="params">(ChannelHandlerContext ctx, TextWebSocketFrame msg)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">text</span> <span class="operator">=</span> msg.text();</span><br><span class="line">        System.out.println(<span class="string">&quot;text = &quot;</span> + text);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>Nettyå…·ä½“å®ç°WebSocketæ˜¯é€šè¿‡<u>Httpå‡çº§ä¸€æ¬¡</u>ï¼Œä¾é çš„æ˜¯æˆ‘ä»¬å‰é¢åˆ†æçš„å¤„ç†å™¨ï¼ˆ<strong>WebSocketServerProtocolHandshakeHandler</strong>ï¼‰å¸®æˆ‘ä»¬è¿›è¡Œè¿æ¥çš„å‡çº§</p>]]></content>
      
      
      <categories>
          
          <category> WebSocket </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Netty </tag>
            
            <tag> WebSocket </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BigDecimalç›¸å…³</title>
      <link href="/2024/01/21/BigDecimal/"/>
      <url>/2024/01/21/BigDecimal/</url>
      
        <content type="html"><![CDATA[<h1 id="ç•™æ„"><a href="#ç•™æ„" class="headerlink" title="ç•™æ„"></a>ç•™æ„</h1><h2 id="æµ®ç‚¹ç±»å‹"><a href="#æµ®ç‚¹ç±»å‹" class="headerlink" title="æµ®ç‚¹ç±»å‹"></a>æµ®ç‚¹ç±»å‹</h2><p>é«˜ç²¾åº¦ä¹‹ç²¾åº¦ä¸¢å¤±</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”¨æ³•ä¸€</span></span><br><span class="line"><span class="type">BigDecimal</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="number">0.01</span>);</span><br><span class="line"><span class="comment">// ç”¨æ³•äºŒ</span></span><br><span class="line"><span class="type">BigDecimal</span> <span class="variable">b</span> <span class="operator">=</span> BigDecimal.valueOf(<span class="number">0.01</span>);</span><br></pre></td></tr></table></figure><p>å¯¹åº”çš„ç»“æœå¦‚ä¸‹:</p><p>a:   0.01000000000000000020816681711721685132943093776702880859375<br>b:   0.01</p><hr><p>é‚£ä¹ˆ:  åœ¨<code>new BigDecimal</code>çš„æ—¶å€™ä¼ å…¥çš„å·²ç»æ˜¯æµ®ç‚¹ç±»å‹( è¿‘ä¼¼å€¼ )äº†,  è€Œåœ¨ä½¿ç”¨<code>valueOf</code>çš„æ—¶å€™,  é€šè¿‡é˜…è¯»æºç å¯çŸ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> BigDecimal <span class="title function_">valueOf</span><span class="params">(<span class="type">double</span> val)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(Double.toString(val));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨valueOfçš„æ–¹æ³•å†…éƒ¨,  è°ƒç”¨äº†Double.toStringæ–¹æ³•è½¬æ¢æˆä¸ºäº†å­—ç¬¦ä¸²,  è½¬æ¢æˆä¸ºå­—ç¬¦ä¸²å°±ä¸å­˜åœ¨è¿›åº¦ä¸¢å¤±é—®é¢˜ (å› ä¸ºå¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²æ¨¡æ‹Ÿé«˜ç²¾åº¦å®ç°è®¡ç®—:  æ¢¦å›cè¯­è¨€é«˜ç²¾åº¦å®ç°)</p><p>é‚£ä¹ˆæˆ‘ä»¬éœ€è¦ä½¿ç”¨åˆ™:  (ä¸¤ä¸ªæ–¹å‘)</p><ol><li>åˆ›å»ºå¯¹è±¡æ—¶,  æ„é€ å‡½æ•°ä¼ å­—ç¬¦ä¸²</li><li>ä½¿ç”¨BigDecimal.valueOfä¼ å€¼åˆå§‹åŒ–å¯¹è±¡</li></ol><h2 id="ç²¾åº¦è®¾ç½®"><a href="#ç²¾åº¦è®¾ç½®" class="headerlink" title="ç²¾åº¦è®¾ç½®"></a>ç²¾åº¦è®¾ç½®</h2><p>å…¶å®å°±æ˜¯å››èˆäº”å…¥çš„é—®é¢˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">BigDecimal</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;1.0&quot;</span>);</span><br><span class="line"><span class="type">BigDecimal</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;3.0&quot;</span>);</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚æˆ‘ä»¬éœ€è¦è¿ç®—</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a.divide(b);</span><br></pre></td></tr></table></figure><p>ç„¶åå°±ä¼šæŠ›å‡ºå¼‚å¸¸: <code>ArithmeticException</code></p><p>å› ä¸ºå®ƒ(ç»“æœ)æ˜¯ä¸€ä¸ªæ— é™å¾ªç¯å°æ•°,  å®ƒä¸èƒ½è½¬æ¢æˆä¸ºæˆ‘ä»¬é¢„æœŸçš„ç²¾ç¡®æ•°å­—</p><p>æ‰€ä»¥éœ€è¦æŒ‡å®šç²¾åº¦</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">BigDecimal</span> <span class="variable">c</span> <span class="operator">=</span> a.divide(b, <span class="number">4</span>,RoundingMode.HALF_UP);</span><br></pre></td></tr></table></figure><ul><li>4:  å››ä½å°æ•°</li><li>RoundingMode.HALF_UP:   HALF_UP-&gt; å¤§äºä¸€åŠåˆ™å‘ä¸Šå–æ•´</li></ul><p>æ•…ç»“æœä¸º:   0.3333</p><p>å…¶ä¸­RoundingModeè¿˜æœ‰å¾ˆå¤šæšä¸¾,  è‡ªè¡ŒæŸ¥é˜…</p><h2 id="æµ®ç‚¹æ¯”è¾ƒ"><a href="#æµ®ç‚¹æ¯”è¾ƒ" class="headerlink" title="æµ®ç‚¹æ¯”è¾ƒ"></a>æµ®ç‚¹æ¯”è¾ƒ</h2><p>æ¯”è¾ƒBigDecimalå€¼çš„å¤§å°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">BigDecimal</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;0.01&quot;</span>);</span><br><span class="line"><span class="type">BigDecimal</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;0.010&quot;</span>);</span><br></pre></td></tr></table></figure><p>ç„¶åæœ‰ä¸¤ç§æ¯”è¾ƒæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a.equals(b)</span><br><span class="line">a.compareTo(b)</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ä¸€çœ‹å¥½åƒæ²¡ä»€ä¹ˆåŒºåˆ«,  æŸ¥é˜…æºç ( equals )å¯çŸ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object x)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!(x <span class="keyword">instanceof</span> BigDecimal))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="type">BigDecimal</span> <span class="variable">xDec</span> <span class="operator">=</span> (BigDecimal) x;</span><br><span class="line">    <span class="keyword">if</span> (x == <span class="built_in">this</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (scale != xDec.scale) <span class="comment">// å¦‚æœç²¾åº¦ä¸ä¸€æ ·,ç›´æ¥false</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="type">long</span> <span class="variable">s</span> <span class="operator">=</span> <span class="built_in">this</span>.intCompact;</span><br><span class="line">    <span class="type">long</span> <span class="variable">xs</span> <span class="operator">=</span> xDec.intCompact;</span><br><span class="line">    <span class="keyword">if</span> (s != INFLATED) &#123;</span><br><span class="line">        <span class="keyword">if</span> (xs == INFLATED)</span><br><span class="line">            xs = compactValFor(xDec.intVal);</span><br><span class="line">        <span class="keyword">return</span> xs == s;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (xs != INFLATED)</span><br><span class="line">        <span class="keyword">return</span> xs == compactValFor(<span class="built_in">this</span>.intVal);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.inflated().equals(xDec.inflated());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>compareToåˆ™æ˜¯å®ç°æ¯”è¾ƒå€¼çš„å¤§å°,  è¿”å›çš„å€¼ä¸º-1ï¼ˆå°äºï¼‰ï¼Œ0ï¼ˆç­‰äºï¼‰ï¼Œ1ï¼ˆå¤§äºï¼‰</p><p>æˆ‘ä»¬å¯ä»¥çŸ¥é“,  å¦‚æœåœ¨ä¸¥æ ¼<u>è¦æ±‚ç²¾åº¦</u>çš„æƒ…å†µä¸‹,  ä½¿ç”¨<strong>equals</strong></p><p>å¦‚æœ<u>ä»…è€ƒè™‘å€¼çš„å¤§å°</u>åˆ™è€ƒè™‘ä½¿ç”¨ <strong>compareTo</strong></p><h2 id="è¾“å‡ºæ ¼å¼åŒ–"><a href="#è¾“å‡ºæ ¼å¼åŒ–" class="headerlink" title="è¾“å‡ºæ ¼å¼åŒ–"></a>è¾“å‡ºæ ¼å¼åŒ–</h2><p>æ­¤å¤„ä»…ç»™å‡ºå‡ ä¸ªç¤ºä¾‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">NumberFormat</span> <span class="variable">currency</span> <span class="operator">=</span> NumberFormat.getCurrencyInstance(); <span class="comment">//å»ºç«‹è´§å¸æ ¼å¼åŒ–å¼•ç”¨</span></span><br><span class="line"><span class="type">NumberFormat</span> <span class="variable">percent</span> <span class="operator">=</span> NumberFormat.getPercentInstance();  <span class="comment">//å»ºç«‹ç™¾åˆ†æ¯”æ ¼å¼åŒ–å¼•ç”¨</span></span><br><span class="line">percent.setMaximumFractionDigits(<span class="number">4</span>); <span class="comment">//ç™¾åˆ†æ¯”å°æ•°ç‚¹æœ€å¤š4ä½</span></span><br><span class="line"> </span><br><span class="line"><span class="type">BigDecimal</span> <span class="variable">loanAmount</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;59988.24&quot;</span>); <span class="comment">//é‡‘é¢</span></span><br><span class="line"><span class="type">BigDecimal</span> <span class="variable">interestRate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;0.007&quot;</span>); <span class="comment">//åˆ©ç‡</span></span><br><span class="line"><span class="type">BigDecimal</span> <span class="variable">interest</span> <span class="operator">=</span> loanAmount.multiply(interestRate); <span class="comment">//ç›¸ä¹˜</span></span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;é‡‘é¢:\t&quot;</span> + currency.format(loanAmount));</span><br><span class="line">System.out.println(<span class="string">&quot;åˆ©ç‡:\t&quot;</span> + percent.format(interestRate));</span><br><span class="line">System.out.println(<span class="string">&quot;åˆ©æ¯:\t&quot;</span> + currency.format(interest));</span><br></pre></td></tr></table></figure><p>è¾“å‡º:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">é‡‘é¢: ï¿¥59,988.24 </span><br><span class="line">åˆ©ç‡: 0.7% </span><br><span class="line">åˆ©æ¯: ï¿¥419.92</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¾§è¾¹æ æ·»åŠ æ—‹è½¬å°äºº</title>
      <link href="/2024/01/11/%E5%8D%9A%E5%AE%A2%E4%BE%A7%E8%BE%B9%E6%A0%8F%E6%97%8B%E8%BD%AC%E5%B0%8F%E4%BA%BA/"/>
      <url>/2024/01/11/%E5%8D%9A%E5%AE%A2%E4%BE%A7%E8%BE%B9%E6%A0%8F%E6%97%8B%E8%BD%AC%E5%B0%8F%E4%BA%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="æ—‹è½¬å°äºº"><a href="#æ—‹è½¬å°äºº" class="headerlink" title="æ—‹è½¬å°äºº"></a>æ—‹è½¬å°äºº</h1><div class="tip success"><p>å®ç°ä»£ç å‚è€ƒ <a href="https://codepen.io/">codepen</a></p></div><details class="folding-tag" green><summary> codepenä»£ç  </summary>              <div class="content">              <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;twopeople&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height:200px;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">class</span>=<span class="string">&quot;illo&quot;</span> <span class="attr">width</span>=<span class="string">&quot;800&quot;</span> <span class="attr">height</span>=<span class="string">&quot;800&quot;</span> <span class="attr">style</span>=<span class="string">&quot;max-width: 200px; max-height: 200px; touch-action: none; width: 640px; height: 640px;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/js/twopeople1.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/js/zdog.dist.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">id</span>=<span class="string">&quot;rendered-js&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/gh/Justlovesmile/CDN/js/twopeople.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.twopeople</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">canvas</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">display</span>: block;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin</span>: <span class="number">0</span> auto;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">cursor</span>: move;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>              </div>            </details><h1 id="å¼•å…¥åˆ°ä¸»é¢˜ä¸­"><a href="#å¼•å…¥åˆ°ä¸»é¢˜ä¸­" class="headerlink" title="å¼•å…¥åˆ°ä¸»é¢˜ä¸­"></a>å¼•å…¥åˆ°ä¸»é¢˜ä¸­</h1><p>åœ¨<code>themes/anzhiyu/layout/includes/widget</code>åˆ›å»ºæ–‡ä»¶<code>card_anim.pug</code><br>ä»£ç å‚è€ƒå¦‚ä¸‹:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.twopeople(style=&quot;margin: 0;align-items: center;justify-content: center;text-align: center;&quot;)</span><br><span class="line">    .container(style=&quot;height: 180px; margin: 0; align-items: center; justify-content: center; text-align: center;&quot;)</span><br><span class="line">      canvas.illo(width=&quot;600&quot; height=&quot;600&quot; style=&quot;display: block;margin: 0 auto;cursor: move;max-width: 200px; max-height: 200px; touch-action: none; width: 480px; height: 480px;&quot;)</span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://npm.elemecdn.com/justlovesmile-static/js/twopeople1.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://npm.elemecdn.com/justlovesmile-static/js/zdog.dist.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">id</span>=<span class="string">&quot;rendered-js&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://npm.elemecdn.com/justlovesmile-static/js/twopeople.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨<code>themes/anzhiyu/layout/includes/widget/index.pug</code>ä¸­å¼•å…¥åˆšåˆšåˆ›å»ºçš„é¡µé¢(card_anim.pug)<br>ç„¶åhexoä¸‰ä»¶å¥—å°±å¯ä»¥çœ‹åˆ°æ•ˆæœ<br>ä»¥ä¸Šéƒ¨åˆ†å‚è€ƒ: <a href="https://lazyingman.com/posts/5788839b.html">åˆ«äº¦éš¾</a></p><h1 id="å¾®è°ƒ"><a href="#å¾®è°ƒ" class="headerlink" title="å¾®è°ƒ"></a>å¾®è°ƒ</h1><p>å¦‚æœæ­¤æ—¶æŒ‰ç…§å‰é¢åšä¸»é‚£æ ·è®¾ç½®,å³ä¾§æ ä¼šè¢«é¡¶,æ‰€ä»¥éœ€è¦å¾®è°ƒï¼Œä»¥ä¸‹å†…å®¹<kbd>Ctrl</kbd> + <kbd>C/V</kbd>å°±å¯ä»¥ä½¿ç”¨äº†<br>å¾®è°ƒå¦‚ä¸‹:</p><p><code>card_anim.pug</code>:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.card-widget.card-revolve</span><br><span class="line">    .twopeople(style=&quot;margin: 0;align-items: center;justify-content: center;text-align: center; background: linear-gradient(to bottom, #D9A7C7, #FFFCDC);&quot;)</span><br><span class="line">        .container(style=&quot;height: 50px; margin: 0; align-items: center; justify-content: center; text-align: center;&quot;)</span><br><span class="line">            h2 ä¸å®šæœŸæ›´æ–°åšå®¢,æ¬¢è¿äº’æ¢</span><br><span class="line">                a(href=&quot;https://blog.calyee.top/link/&quot;) å‹é“¾.</span><br><span class="line">        canvas.illo(width=&quot;600&quot; height=&quot;600&quot; style=&quot;display: block;margin: 0 auto;cursor: move;max-width: 200px; max-height: 200px; touch-action: none; width: 480px; height: 480px;&quot;)</span><br><span class="line"></span><br><span class="line">| <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://npm.elemecdn.com/justlovesmile-static/js/twopeople1.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">| <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://npm.elemecdn.com/justlovesmile-static/js/zdog.dist.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">| <span class="tag">&lt;<span class="name">script</span> <span class="attr">id</span>=<span class="string">&quot;rendered-js&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://npm.elemecdn.com/justlovesmile-static/js/twopeople.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>index.pug</code>:æŒ‡<code>themes/anzhiyu/layout/includes/widget/index.pug</code>.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#aside-content.aside-content</span><br><span class="line">  //- post</span><br><span class="line">  if is_post()</span><br><span class="line">    - const tocStyle = page.toc_style_simple</span><br><span class="line">    - const tocStyleVal = tocStyle === true || tocStyle === false ? tocStyle : theme.toc.style_simple</span><br><span class="line">    if showToc &amp;&amp; tocStyleVal</span><br><span class="line">      .sticky_layout</span><br><span class="line">        include ./card_post_toc.pug</span><br><span class="line">    else</span><br><span class="line">      !=partial(&#x27;includes/widget/card_author&#x27;, &#123;&#125;, &#123;cache: true&#125;)</span><br><span class="line">+      !=partial(&#x27;includes/widget/card_anim&#x27;, &#123;&#125;, &#123;cache: true&#125;)  </span><br><span class="line">      !=partial(&#x27;includes/widget/card_announcement&#x27;, &#123;&#125;, &#123;cache: true&#125;)</span><br><span class="line">      !=partial(&#x27;includes/widget/card_weixin&#x27;, &#123;&#125;, &#123;cache: true&#125;)</span><br><span class="line">      !=partial(&#x27;includes/widget/card_top_self&#x27;, &#123;&#125;, &#123;cache: true&#125;)</span><br><span class="line">      .sticky_layout</span><br><span class="line">        if showToc</span><br><span class="line">          include ./card_post_toc.pug</span><br><span class="line">        !=partial(&#x27;includes/widget/card_recent_post&#x27;, &#123;&#125;, &#123;cache: true&#125;)</span><br><span class="line">        !=partial(&#x27;includes/widget/card_ad&#x27;, &#123;&#125;, &#123;cache: true&#125;)</span><br><span class="line">  else</span><br><span class="line">    //- page</span><br><span class="line">    !=partial(&#x27;includes/widget/card_author&#x27;, &#123;&#125;, &#123;cache: true&#125;)</span><br><span class="line">+    !=partial(&#x27;includes/widget/card_anim&#x27;, &#123;&#125;, &#123;cache: true&#125;) </span><br><span class="line">    !=partial(&#x27;includes/widget/card_announcement&#x27;, &#123;&#125;, &#123;cache: true&#125;)</span><br><span class="line">    !=partial(&#x27;includes/widget/card_weixin&#x27;, &#123;&#125;, &#123;cache: true&#125;)</span><br></pre></td></tr></table></figure><p><code>aside.styl</code>: æŒ‡<code>themes\anzhiyu\source\css\_layout\aside.styl</code></p><p>æ‰¾åˆ°æ ·å¼ <code>#aside-content</code>å¤„</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">hexo-config</span>(<span class="string">&#x27;aside.enable&#x27;</span>)</span><br><span class="line">  <span class="selector-id">#aside-content</span></span><br><span class="line">+    &gt;<span class="selector-class">.card-widget</span><span class="selector-class">.card-revolve</span></span><br><span class="line">+      <span class="attribute">text-align</span>: left;</span><br><span class="line">+      <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">+      <span class="attribute">margin-top</span>: <span class="number">20px</span>;</span><br><span class="line">+      <span class="attribute">padding</span>: <span class="number">0px</span> <span class="number">0px</span>;</span><br><span class="line">+      <span class="attribute">border-radius</span>: <span class="number">12px</span>;</span><br><span class="line">+      <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">+      <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(to bottom, <span class="number">#D9A7C7</span>, <span class="number">#FFFCDC</span>);</span><br><span class="line">+      <span class="selector-tag">a</span></span><br><span class="line">+        <span class="attribute">color</span>: <span class="number">#f18ed4</span>;<span class="attribute">text-decoration</span>: none;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ è§‰å¾—æœ‰ç”¨ï¼Œå¯ä»¥ç•™ä¸‹ä¸ªè¯„è®º</p>]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexoé­”æ”¹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RabbitMQ</title>
      <link href="/2023/12/27/RabbitMQ/"/>
      <url>/2023/12/27/RabbitMQ/</url>
      
        <content type="html"><![CDATA[<h1 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h1><p>RabbitMQæ˜¯åŸºäºErlang(å¤„ç†å¹¶å‘)è¯­è¨€å¼€å‘çš„å¼€æºæ¶ˆæ¯é€šä¿¡ä¸­é—´ä»¶ï¼Œå®˜ç½‘åœ°å€ï¼š</p><p><a href="https://www.rabbitmq.com/">https://www.rabbitmq.com/</a></p><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>åŸºäºDockerå®‰è£…RabbitMQ,  ä½¿ç”¨å‘½ä»¤å¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢ç‰ˆæœ¬</span></span><br><span class="line">docker search rabbitmq</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># linux</span></span><br><span class="line">docker run \</span><br><span class="line">-d \</span><br><span class="line">--name=rabbitmq-server \</span><br><span class="line">-p 15672:15672 \</span><br><span class="line">-p 5672:5672 \</span><br><span class="line">-e RABBITMQ_DEFAULT_USER=admin \</span><br><span class="line">-e RABBITMQ_DEFAULT_PASS=123456 \</span><br><span class="line">rabbitmq:3.11.28-management</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># win</span></span><br><span class="line">docker run --name=rabbitmq-server -p 15672:15672 -p 5672:5672 -e RABBITMQ_DEFAULT_USER=admin -e RABBITMQ_DEFAULT_PASS=123456 -d rabbitmq:3.11.28-management</span><br></pre></td></tr></table></figure><ul><li>15672ï¼šRabbitMQæä¾›çš„ç®¡ç†æ§åˆ¶å°çš„ç«¯å£</li><li>5672ï¼šRabbitMQçš„æ¶ˆæ¯å‘é€å¤„ç†æ¥å£</li></ul><h2 id="å…¥é—¨"><a href="#å…¥é—¨" class="headerlink" title="å…¥é—¨"></a>å…¥é—¨</h2><p>æ¶æ„å›¾</p><p><img src="https://s2.loli.net/2023/12/27/e6jFbKNGlPsV4cg.png" alt="202312271833685.png"></p><p>å…¶ä¸­åŒ…å«å‡ ä¸ªæ¦‚å¿µï¼š</p><ul><li><code>publisher</code>ï¼šç”Ÿäº§è€…ï¼Œä¹Ÿå°±æ˜¯å‘é€æ¶ˆæ¯çš„ä¸€æ–¹</li><li><code>consumer</code>ï¼šæ¶ˆè´¹è€…ï¼Œä¹Ÿå°±æ˜¯æ¶ˆè´¹æ¶ˆæ¯çš„ä¸€æ–¹</li><li><code>queue</code>ï¼šé˜Ÿåˆ—ï¼Œå­˜å‚¨æ¶ˆæ¯ã€‚ç”Ÿäº§è€…æŠ•é€’çš„æ¶ˆæ¯ä¼šæš‚å­˜åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…æ¶ˆè´¹è€…å¤„ç†</li><li><code>exchange</code>ï¼šäº¤æ¢æœºï¼Œè´Ÿè´£æ¶ˆæ¯è·¯ç”±ã€‚ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ç”±äº¤æ¢æœºå†³å®šæŠ•é€’åˆ°å“ªä¸ªé˜Ÿåˆ—ã€‚</li><li><code>virtual host</code>ï¼šè™šæ‹Ÿä¸»æœºï¼Œèµ·åˆ°æ•°æ®éš”ç¦»çš„ä½œç”¨ã€‚æ¯ä¸ªè™šæ‹Ÿä¸»æœºç›¸äº’ç‹¬ç«‹ï¼Œæœ‰å„è‡ªçš„exchangeã€queue</li></ul><h2 id="SpringAMQP"><a href="#SpringAMQP" class="headerlink" title="SpringAMQP"></a>SpringAMQP</h2><p>Springçš„å®˜æ–¹åŸºäºRabbitMQæä¾›äº†è¿™æ ·ä¸€å¥—æ¶ˆæ¯æ”¶å‘çš„æ¨¡æ¿å·¥å…·,å¹¶ä¸”è¿˜åŸºäºSpringBootå¯¹å…¶å®ç°äº†è‡ªåŠ¨è£…é…ã€‚</p><div calss="anzhiyu-tag-link"><a class="tag-Link" target="_blank" href="https://spring.io/projects/spring-amqp">    <div class="tag-link-tips">å¼•ç”¨ç«™å¤–åœ°å€</div>    <div class="tag-link-bottom">        <div class="tag-link-left" style>          <i class="anzhiyufont anzhiyu-icon-link" style></i>        </div>        <div class="tag-link-right">            <div class="tag-link-title">Spring AMQP</div>            <div class="tag-link-sitename">Spring AMQP</div>        </div>        <i class="anzhiyufont anzhiyu-icon-angle-right"></i>    </div>    </a></div><p>SpringAMQPæä¾›äº†ä¸‰ä¸ªåŠŸèƒ½ï¼š</p><ul><li>è‡ªåŠ¨å£°æ˜é˜Ÿåˆ—ã€äº¤æ¢æœºåŠå…¶ç»‘å®šå…³ç³»</li><li>åŸºäºæ³¨è§£çš„ç›‘å¬å™¨æ¨¡å¼ï¼Œå¼‚æ­¥æ¥æ”¶æ¶ˆæ¯</li><li>å°è£…äº†RabbitTemplateå·¥å…·ï¼Œç”¨äºå‘é€æ¶ˆæ¯</li></ul><h3 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h3><p>åˆ›å»ºæµ‹è¯•æ¡ˆä¾‹é¡¹ç›®ç»“æ„</p><ul><li>rabbitmq-demoï¼š çˆ¶å·¥å‚ï¼Œç®¡ç†ä¾èµ–</li><li>publisherï¼šæ¶ˆæ¯æ¨é€è€…</li><li>consumerï¼šæ¶ˆæ¯æ¶ˆè´¹è€…</li></ul><p>å¯¼å…¥ä¸»è¦ä¾èµ–  (é¡¹ç›®ä¸ºSpringBootå·¥ç¨‹)</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--SpringAMQP:åŒ…å«äº†RabbitMQ--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å…¥é—¨æ¡ˆä¾‹</p>]]></content>
      
      
      <categories>
          
          <category> RabbitMQ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ¶ˆæ¯é˜Ÿåˆ— </tag>
            
            <tag> ä¸­é—´ä»¶ </tag>
            
            <tag> RabbitMQ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¡¹ç›®ç›¸å…³</title>
      <link href="/2023/12/19/%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/"/>
      <url>/2023/12/19/%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="æŠ±æ­‰ï¼Œè¿™ä¸ªå¯†ç çœ‹ç€ä¸å¤ªå¯¹ï¼Œè¯·å†è¯•è¯•ã€‚" data-whm="æŠ±æ­‰ï¼Œè¿™ä¸ªæ–‡ç« ä¸èƒ½è¢«çº æ­£ï¼Œä¸è¿‡æ‚¨è¿˜æ˜¯èƒ½çœ‹çœ‹è§£å¯†åçš„å†…å®¹ã€‚">  <script id="hbeData" type="hbeData" data-hmacdigest="ec93dc50ddb75147c42a93aad20c7beff743c46ce00cb2eb6bf822fc5189bfbe">f1e2971e5cb45bc6de875902725b7e5bf10030e767a0488fe18f5b28db1378561fc877b8414cf17627e4002d7dfb0e3a939d185821956b3320059a1a78c70f3f3935d3287f4e1cf321b489c3abef0433773343a774d2439a47519ca09ea6d1f240064545d95033d49a06ce0719bab11c99aa3394684123fc2a4f3c7820049905a82c26055392f7469dee8b3f22efbf1a7458870ce9ceef0aaaeafd1571c99c7e0654352148a17e677e300e8fff7e17cb945a356994694cf696d1268edb75ec0f4b012838f61e4e4ab3a8ae3659c03b266a1b2154a04e33b069a5a6367834a7bc9363c9fc4b819d1128a81ff7994c8ad76feef0be1d182ec9e84a54e4684233af77da268e1c1a6445f1868e92bf5477841a3d81f4a3942cb6b02508e5453be9f6a82ae04daddf3c71ff0760cfbb8c1a301552b81b19dd53f7c552ba7e587393c568ceee9e793148796324e4e012e569140e4dd133f460c6e69b7a1efbf67bd9fdc32dd20ba71b25bceafbd22f3ce1f61386629f13f1dc03d9a4cb0f703c7e5fef5bef36e04ee9f465d8346df6df69ea7af23294e70a0dae71f07f08be5ce63f7e72b82ab998fad80942da8e584cd6df1a1ab36a4eb61595d8a2cf5c9fc66e86e19385ed5cca907dbc777feed58280fa7551a4a4d8e7b71a3e64f2295d3ba653f6fac434eadf804d6922f05a4dc61e211b1c7b54397d6163b8f7f91511a2f9919f38afda0ca0b0e2c023665b2a0cefafb7ac556b242937a16df8b7ab59a6863550b7cb80397b5e6b435ec3dcb291cfdb98695bc47fc3f1477a251409efb92b3e4494b1c902ff88aa8bb0b9d05f00427944f4fb33c6f890b2924ab7420e8ebce363a687bcf62e7b8277d54123985e0a97936fdc7022b627a83ecbebe64a9a9964cec10f97496a1959547fcde7752c97827832b14b393a61049a0ca58c0cf6056f39aaac362ebf8a16037fc69bdf24efffc696cd8052eeef5e29724f4b12c1fe20ad8aafb73b0fb4bc140fb2033b4c4768e2229ac11a521cafc603ebfc98d59a8f1bea56c051958a7114f059db107436887fafcd69b152d9e8a342f1449e7b7759598db6d55164e3e63003d3b9955043697787bfb7ea161ffa681430fd34990334b37f43426f9d7b16ff9074e45673a4ec55714490c48e6ad7b3e89102c1701c066839f78c3aa3a6e7c50de3eb7b12bbd9db5b4aef907f325be5dfe2127299558cf95e97218c43d0e2edcb1ec62f168bddcda2e0aeea72db89b012dce323b229c31e71e72befe886935e59830f53510ab7e8daaee3db084b9ce66df572da4ee683e143406d6342783a7cf43b4737103e4e6493ecbcc3b670502ad37eaebd3a44835ba48283a2853fb5e0695b53f7b18f90dfa20276f4bc4590d79f85d243e1d35f9ffe4534a0b050b26d11f34ccbd250774de52a8f6c3e00d2adb126448836200b092d6141546b2e5b992a40d7e82cf9fe3db9a3f4fae0e80c83466859cb9ba7e4ffcf46686dbecb88fa7757402f425e872b984261386fc7dfb46f2130525f02249b6bf4f08dcbc3f1aceffbd1d55d8f86b6854b30dd9b0c42cf9be6a497d000a557444992707cf6ba4ff88b786ccc08dba4f9c9b6afb8240ebf727e127d89e87898957c686d9eaec157c3fbd3e4a5c4b85762186d1d2b087542de5fb5e4b2c95bcf733feabfc1aac5637f682c8d39aff7210e6e97eebf2d5057c996e728ad98a3a3d56953395af1668dbde6f159e4ab703b85c4a5079cc0739f93bea1e56014337f846376b853c16813c6231be5b6e8c3a1c7311dd8f36630c8d7aa7e8c229ad104e89846f55a72a69fb1343ce2cd953d0481ca4eb5560a4251ee28dc33c935bb9683eeabc21154ed449a7c3e758d04fcec2a3d46194c27869174e7d4cf1715332c45468ace1b2599994af7ebb719f8e827355f0f349ba779fb3d65c506f2ccdfb2888e296fe70c2283a97a77b18f1d730bb06cf8c7abd8fbc8e9e9e2feb206f537ec68a47819137100d23380c7eb1b32b2c0491eba89cca892328a74e4be751b929f63cefa3c5c763595fb445bb658da89a501b7d4363c85bf2e38398af7ad078011e18015f390a4b3ae0d6af7a6e12c1b92d5df500ab793c4be55c53426481c05c32d5410e6afa87b88e83ca071665cb52c4ce63ffc75aae7f5417181b89f514d133b5ecbee89ece7a84e5825946f38d929765022a6d34d2b9e33e360efea6e6d925c35704c7c2a5453a6db7d1893618c572a3da300b9d1a04632be9277a4e703fc1224a437ceb0d701a3b6bce4ea6a3adfa130d5dbadd295e88520fe25c0d3ed3c52b97c60758d514d6a8b116310019966780388cc42e9f2d6a4234c37f218ef7e592173e96e2a8b7efec24000a56e65987477c9f469f456abc7a48035f4bb17956a30b78c2859905f8497a06157eb9ec330ac3c92e0a7927fa4c6be7298a07c6f6564699f8c3d9b7223162fe2f0a477dea9d2b416e733c482e8e01cbeb33a125e671c10da2538ee2440206600fd200a7f52ea6b4a2e45dbdbcf396674e55d7ffa3fc57ff1daebe0cd30ce6b63c92be515f252991e16e8a195c2988f0bd68d073fecbd0ba59c9f787507e28e34792b751d9453d4d4fd0116f6a4884edf42611d9bd4d14c337160381c53867c3979f150dbc3979f02963a556b8396cac98f6455ed18ead147117f1957c3b48600800aefb8c7e9d009bfd444d8e59b48f0930b47f97f365f6c604e4901f0ed371316674dea4bfcf8481f37b3056a17f787eda9f946f3dcefd6ae33f92d9cbe1acd6b296633daada09db5f8ae20627ab3272984853f58ce677c59b478dbfa02051e34c0c6d011179b96c41a40e9fa6e87eda914221fb6f947e39ac85ee03cc76f4b765c8340d0c5d85f5ef39d0f426b7117f85d0bd49f40ddda30e3558594a547f5240282b4507ce92f94914c66e5a9f13374c3556b9cb8981d4faf0444766ba199420568d13f4ef483e6855e42e8764e2cb9f84b3714c854aa02141fe9c4693894fc17b757d3f320f99300833a4ee17997fe6943ca5438131b3a79e89467bee471f420ff32e8d3b0cbbd87b59ffa2ecb41d0e3a0b838cb9aea640f6eed7b0ec3f8e935735b87972e6024521747ef90c940b21a92e76e86501fdae5a6b98190c771423ab40fa7d47ec343affd0e8356a22645b103177ec3062bfdbb0242a8907e7cd8678f9d1408297b5907ec5529c68e0f5df99311f1c35ea471a478edb986f1384c49c7d4177b717ee36823dcdbfe808f00762436975fee00d492cde5470c5c879f8b29f11ad6879c50cce2c43c0cf833eaf02017f9ccb503dfad8337f3e31410dbcb5ba2d92abbbae4041ae5baeaac3484bc2e888a42dd6f273eb22719fa32a2c4fd3b4edf93fdebf03938a1f387fb969b8920767fa025513ff50f7d0f219756a6e24525905b9fef27ceb36ad483b34587e8e3a38ef92b3b4f9714d97065b049024c66c27a72ed9c83a7b9c7657ec028a83fa5555fcb1cad880acead88c73a950caea0d3aed6d519a7ee3e59046983253e94d71dabd0deb159d1f1bdf989a88ef5ce3aa5ce5ae0c975b5f459faf3b333b87d653f57773532bdc0333716bfd539aaaf81328e2d35bef89886f6a8b6cee6d8ee19e8c74da97e5ab636cbc7d6e95f7d70995436fc347540376ccc353e499dceab47bfaebf84695ba823f7fbb085eaf88e0399e0db9e4f06a013f10bdf935616624e3a972368bcdd4a461fd2ae32620df4dd1d2850ae287ab6ec6d57fb374c01ea925687b236aaa2c233257b026c7ac66dbcfa93a4c3fd238f4f9e37b74f51621d50dbcc1e526efc9fe7b07767f30c808a052b25180955b7face5385442a3c4b0cf4b3a64833f3a3d18a70336c12045f3afc631a954933e4e1476fe26dccebaabf0baacaffba4b1348e5c7d025d2931ea87ea39c2db6a079b15be914fbc92bb6bdf200dec7226b62583434f90113171b1b536daefaa0217d2abf47fcb55fbbe79b1ead52700c2471c46d55e793a27a4ec83427ea81005da422a1fffe562e22bcb3086d94b7344bb45c39c8f303bb83fdc356c1c6f0fadf6d34a76ff6310f53060fd6a1924b2123c7584a377ed7076645efa1c5e9b4df45ebe2f90a1f0be78dd80566ff87e41736aeb6fcba0d3539b3035667588ace8f4b9be731fb9a197468bd9f52a264f6ea6f5440af797f00c25789b92e52238d6b88e4bde6fd38de8856a185ea057b7bc588eb9781223bb3db04aa2956f5c9fa37a447c63e9884aaaa03a5f71c2888392f8efcb68f159e27549f8538a478e2f098cbe356440d8255a62227c27a2773cef432a959f747f5a670bfd09298c3ed1d9d79ad142583762e603d2acd3dff0ccfc78f7f278cb776dac611224db5980b52bde5e03c2222240372b1966a3a738dd6c6699a21251b25c613619953d3b45557a384638064a09c5e30da9d3805c4da111007ba8397b741a7d0e57b7c5a5f64c2a4a4fc683841712ab8469c45f6353e5769f2c1387764846673c6f5117c850faa6df81363a32b19daa918b55478a5dfa03f3f3b463f7a28a580cebd24196a7528a655f2c1221d3785d582d78965de91c2cb31dcf5605f2b59fd087fab02750bed9f6fce514656a86f8163a381873154d513d64d71af4158eb3d9028a2a39028dcd025799ad134220de09bdc15130279d5011cffaf96c0f7bf74beb8ee961fc3c56b712786a2b2ec8f0f24dcf62ab92ad4aa872ebb951d339a0493597e0d5365cded5ff6f91346afec399bccbcfd1a4f1336e793520e57e6bcc7575838766f0eeb32e5b10d0c9a0089f819a7ee28d9c3b9d861cb9f521dc8b00ec2ff7d7168e3e07dc1795f2d2b7b46c7d9ded12d</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">æ‚¨å¥½ï¼Œè¿™ç¯‡æ–‡ç« æ˜¯éœ€è¦å¯†ç çš„ã€‚</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¡¹ç›® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼</title>
      <link href="/2023/12/19/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
      <url>/2023/12/19/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="è®¾è®¡æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼</h1><h2 id="23ä¸ªè®¾è®¡æ¨¡å¼åˆ†ç±»"><a href="#23ä¸ªè®¾è®¡æ¨¡å¼åˆ†ç±»" class="headerlink" title="23ä¸ªè®¾è®¡æ¨¡å¼åˆ†ç±»"></a>23ä¸ªè®¾è®¡æ¨¡å¼åˆ†ç±»</h2><p>æ€»ä½“æ¥è¯´è®¾è®¡æ¨¡å¼åˆ†ä¸ºä¸‰å¤§ç±»ï¼š</p><ul><li>åˆ›å»ºå‹æ¨¡å¼ï¼Œå…±äº”ç§ï¼š</li></ul><p>å·¥å‚æ–¹æ³•æ¨¡å¼ã€æŠ½è±¡å·¥å‚æ¨¡å¼ã€å•ä¾‹æ¨¡å¼ã€å»ºé€ è€…(æ„é€ å™¨)æ¨¡å¼ã€åŸå‹æ¨¡å¼ã€‚</p><ul><li>ç»“æ„å‹æ¨¡å¼ï¼Œå…±ä¸ƒç§ï¼š</li></ul><p>é€‚é…å™¨æ¨¡å¼ã€è£…é¥°å™¨æ¨¡å¼ã€ä»£ç†æ¨¡å¼ã€å¤–è§‚æ¨¡å¼ã€æ¡¥æ¥æ¨¡å¼ã€ç»„åˆæ¨¡å¼ã€äº«å…ƒæ¨¡å¼ã€‚</p><ul><li>è¡Œä¸ºå‹æ¨¡å¼ï¼Œå…±åä¸€ç§ï¼š</li></ul><p>ç­–ç•¥æ¨¡å¼ã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼ã€è§‚å¯Ÿè€…æ¨¡å¼ã€è¿­ä»£å­æ¨¡å¼ã€è´£ä»»é“¾æ¨¡å¼ã€å‘½ä»¤æ¨¡å¼ã€å¤‡å¿˜å½•æ¨¡å¼ã€çŠ¶æ€æ¨¡å¼ã€è®¿é—®è€…æ¨¡å¼ã€ä¸­ä»‹è€…æ¨¡å¼ã€è§£é‡Šå™¨æ¨¡å¼ã€‚</p><h2 id="è´£ä»»é“¾æ¨¡å¼"><a href="#è´£ä»»é“¾æ¨¡å¼" class="headerlink" title="è´£ä»»é“¾æ¨¡å¼"></a>è´£ä»»é“¾æ¨¡å¼</h2><p>è´£ä»»é“¾æ¨¡å¼åœ¨æ¡†æ¶çš„å¼•ç”¨æä¸ºå¹¿æ³›,  ä¾‹å¦‚SpringSecurityçš„è¿‡æ»¤å™¨é“¾,  Sentinelçš„æ’æ§½(é™æµ, é™çº§, ç³»ç»Ÿä¿æŠ¤ç­‰)ï¼Œä»–ä»¬å®ç°å°±åƒä¸€æ¡é“¾å­ä¸€æ · ä¸€çº§ä¸€çº§çš„å¾€ä¸‹èµ°ã€‚</p><p>åœ¨è¿™ç§æ¨¡å¼ä¸­ï¼Œé€šå¸¸æ¯ä¸ªæ¥æ”¶è€…éƒ½åŒ…å«å¯¹å¦ä¸€ä¸ªæ¥æ”¶è€…çš„å¼•ç”¨ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡ä¸èƒ½å¤„ç†è¯¥è¯·æ±‚ï¼Œé‚£ä¹ˆå®ƒä¼šæŠŠç›¸åŒçš„è¯·æ±‚ä¼ ç»™ä¸‹ä¸€ä¸ªæ¥æ”¶è€…ï¼Œä¾æ­¤ç±»æ¨ã€‚</p><h2 id="å»ºé€ è€…-æ„é€ å™¨-æ¨¡å¼"><a href="#å»ºé€ è€…-æ„é€ å™¨-æ¨¡å¼" class="headerlink" title="å»ºé€ è€…(æ„é€ å™¨)æ¨¡å¼"></a>å»ºé€ è€…(æ„é€ å™¨)æ¨¡å¼</h2><p>å»ºé€ è€…æ¨¡å¼ï¼šå°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æ„å»ºä¸å®ƒçš„è¡¨ç¤ºåˆ†ç¦»ï¼Œä½¿å¾—åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºï¼Œå»ºé€ è€…æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡åˆ›å»ºå‹æ¨¡å¼ã€‚ï¼šå°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æ„å»ºä¸å®ƒçš„è¡¨ç¤ºåˆ†ç¦»ï¼Œä½¿å¾—åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºï¼Œå»ºé€ è€…æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡åˆ›å»ºå‹æ¨¡å¼ã€‚</p><p>æœ€å¸¸è§çš„æ˜¯Lombokçš„<code>@Builder</code>æ³¨è§£,  è®©æˆ‘ä»¬ä½¿ç”¨æµå¼åˆ›å»ºå¯¹è±¡ã€‚</p><p>: æ¯ä¸€ä¸ªå±æ€§å¯¹åº”çš„æ–¹æ³•éƒ½<wavy>,è¿”å›Builderæœ¬èº«</wavy></p><ol><li><p>é€šè¿‡ä¸€ä¸ªpublic static class Builderçš„å†…éƒ¨ç±»ï¼ŒæŒæœ‰è¦æ„å»ºå¯¹è±¡çš„æ‰€æœ‰å±æ€§</p></li><li><p>è®¾ç½®å±æ€§çš„æ–¹æ³•éƒ½è¿”å›Builderå½“å‰å®ä¾‹thisï¼Œè¿™æ ·å¯ä»¥æµå¼è®¾ç½®å±æ€§ï¼Œç”¨èµ·æ¥æ›´åŠ æ–¹ä¾¿</p></li><li><p>æä¾›ä¸€ä¸ªstaticçš„Builderæ–¹æ³•ï¼Œæ–¹ä¾¿ç”¨æˆ·è·å–Builderå¯¹è±¡</p></li><li><p>ç”¨æˆ·é€šè¿‡builderå¯¹è±¡è‡ªå®šä¹‰è®¾ç½®å±æ€§</p></li><li><p>æä¾›buildæ–¹æ³•ï¼Œåˆ›å»ºæœ€ç»ˆå¯¹è±¡</p></li></ol><h2 id="å·¥å‚æ–¹æ³•æ¨¡å¼"><a href="#å·¥å‚æ–¹æ³•æ¨¡å¼" class="headerlink" title="å·¥å‚æ–¹æ³•æ¨¡å¼"></a>å·¥å‚æ–¹æ³•æ¨¡å¼</h2><p>é€‚ç”¨:  <u>æ ¹æ®æ¡ä»¶</u> åˆ¤æ–­ç”Ÿæˆä»€ä¹ˆå¯¹è±¡</p><h3 id="ç®€å•å·¥å‚æ¨¡å¼"><a href="#ç®€å•å·¥å‚æ¨¡å¼" class="headerlink" title="ç®€å•å·¥å‚æ¨¡å¼"></a>ç®€å•å·¥å‚æ¨¡å¼</h3><p>æ¡ˆä¾‹:  æˆ‘ä»¬æœ‰ä¸€ä¸ªç”Ÿäº§è¯¾ç¨‹å¯¹è±¡çš„å·¥å‚(CourseFactory),  æ ¹æ®ä¼ å…¥æ¡ä»¶ç”Ÿäº§å¯¹è±¡(JavaCourse,GoCourseâ€¦)</p><p>éœ€æ±‚:  æˆ‘ä»¬ä¼ å…¥ä»€ä¹ˆåˆ™ç”Ÿæˆä»€ä¹ˆå¯¹è±¡</p><p>å®ç°:  å¯ä»¥é€šè¿‡ç»™å·¥å‚çš„create(è‡ªå®šä¹‰çš„åˆ›å»ºç”Ÿäº§çš„æ–¹æ³•), ä¼ å…¥å¯¹è±¡åã€ç±»åã€å­—èŠ‚ç å¯¹è±¡,  ç„¶åç”Ÿäº§ç›¸å¯¹åº”çš„å®ä¾‹å¯¹è±¡</p><p>æ­¤æ—¶çš„å·¥å‚æ¨¡å¼æœ‰ä¸€ä¸ªæœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯å·¥å‚å…·ä½“,  äº§å“æŠ½è±¡,   å·¥å‚ç”Ÿäº§æ˜¯æ ¹æ®æ¡ä»¶ç”Ÿäº§,  åªèƒ½ç”Ÿäº§ä¸€ä¸ªç±»çš„è¯¾ç¨‹</p><details class="folding-tag" green><summary> æŸ¥çœ‹ä»£ç æµ‹è¯• </summary>              <div class="content">              <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”Ÿäº§çš„å·¥å‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CourseFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ICourse <span class="title function_">create</span><span class="params">(Class&lt;?&gt; clazz)</span>&#123; <span class="comment">// ICourse: è¯¾ç¨‹çš„æŠ½è±¡</span></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="literal">null</span> != clazz)&#123;</span><br><span class="line">                <span class="keyword">return</span> clazz.newInstance();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            e.printStackTace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æµ‹è¯•</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">CourseFactory</span> <span class="variable">cf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CourseFactory</span>();</span><br><span class="line">    <span class="type">ICourse</span> <span class="variable">course</span> <span class="operator">=</span> cf.create(JavaCourse.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>              </div>            </details><h3 id="å·¥å‚æ–¹æ³•æ¨¡å¼-1"><a href="#å·¥å‚æ–¹æ³•æ¨¡å¼-1" class="headerlink" title="å·¥å‚æ–¹æ³•æ¨¡å¼"></a>å·¥å‚æ–¹æ³•æ¨¡å¼</h3><p>äº§å“æŠ½è±¡,  å·¥å‚ä¹ŸæŠ½è±¡ã€‚</p><p>Javaè¯¾ç¨‹å¯¹åº”ä¸€ä¸ªJavaå·¥å‚,  Pythonè¯¾ç¨‹å¯¹åº”ä¸€ä¸ªPythonå·¥å‚.    åœ¨æŸä¸€ä¸ªç‰¹å®šçš„å·¥å‚å¯ä»¥æ ¹æ®ç‰¹å®šçš„æ¡ä»¶ç”Ÿäº§ç‰¹å®šçš„äº§å“.   è§£è€¦åˆ</p><p>ä¾‹å¦‚:  Listçš„å®ç°,  å¯ä»¥å‘ç°ä¸åŒçš„å…·ä½“å®ä¾‹å®ç°æœ‰ä¸åŒçš„éå†æ–¹æ³•(æŒ‡: è¿­ä»£å™¨).  å› ä¸ºä¸åŒçš„å®ç°,  å®ƒä»¬åº•å±‚çš„æ•°æ®ç»“æ„å®ç°ä¸åŒ, åœ¨LinkedListåº•å±‚åˆ™æ˜¯é“¾è¡¨,  ArrayListåˆ™æ˜¯é¡ºåºè¡¨.</p><p>è¿½è¸ªArrayListçš„æºç ä¸­å®ç°çš„è¿­ä»£æ–¹æ³•Iterator</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™ä¸ªå°±æ˜¯å·¥å‚ç”Ÿäº§äº§å“çš„æ–¹æ³•, ç”Ÿäº§äº†ä¸€ä¸ªç”¨äºArrayListçš„Itrè¿­ä»£å®ä¾‹</span></span><br><span class="line"><span class="keyword">public</span> Iterator&lt;E&gt; <span class="title function_">iterator</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Itr</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç»§ç»­è¿½è¸ªItr(), å¯ä»¥å‘ç°nextæ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> E <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">    checkForComodification();</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> cursor;</span><br><span class="line">    <span class="keyword">if</span> (i &gt;= size)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NoSuchElementException</span>();</span><br><span class="line">    Object[] elementData = ArrayList.<span class="built_in">this</span>.elementData;</span><br><span class="line">    <span class="keyword">if</span> (i &gt;= elementData.length)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConcurrentModificationException</span>();</span><br><span class="line">    cursor = i + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> (E) elementData[lastRet = i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾ˆå®¹æ˜“çŸ¥é“,  å…¶å®å°±æ˜¯ä¸€ä¸ªé¡ºåºè¡¨çš„éå†</p><p>åŒç†LinkedListéå†ä¹Ÿæ˜¯ä¸€æ ·,  é€šè¿‡å®ç°Iterator,  å®¹æ˜“çŸ¥é“è‚¯å®šæ˜¯é“¾è¡¨çš„éå†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> E <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">    checkForComodification();</span><br><span class="line">    <span class="keyword">if</span> (!hasNext())</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NoSuchElementException</span>();</span><br><span class="line"></span><br><span class="line">    lastReturned = next;</span><br><span class="line">    next = next.next;</span><br><span class="line">    nextIndex++;</span><br><span class="line">    <span class="keyword">return</span> lastReturned.item;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æœ‰:  Listçš„å„ç§å®ç°ç±»,  ä¸åŒçš„æ•°æ®ç»“æ„å®ç°æ‰€å®ç°çš„è¿­ä»£å™¨(å·¥å‚æ–¹æ³•â€“&gt; ç”¨äºç”Ÿäº§äº§å“â€“&gt; è¿­ä»£å™¨äº§å“).</p><p>åœ¨SpringCloud Gatewayä¸­,  æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…³é”®ç»„ä»¶æœ‰</p><ul><li>è°“è¯å·¥å‚</li></ul><p>ç”¨äºå®šä¹‰è·¯ç”±è§„åˆ™ã€‚è°“è¯å·¥å‚æ¥æ”¶ä¸€ä¸ªè¾“å…¥ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªHTTPè¯·æ±‚ï¼‰ï¼Œå¹¶æ ¹æ®å®šä¹‰çš„è§„åˆ™è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæŒ‡ç¤ºè¯¥è¯·æ±‚æ˜¯å¦ä¸è·¯ç”±åŒ¹é…ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">food-service</span> <span class="comment"># è·¯ç”±è§„åˆ™idï¼Œè‡ªå®šä¹‰ï¼Œå”¯ä¸€</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://food-service</span> <span class="comment"># è·¯ç”±çš„ç›®æ ‡æœåŠ¡ï¼Œlbä»£è¡¨è´Ÿè½½å‡è¡¡ï¼Œä¼šä»æ³¨å†Œä¸­å¿ƒæ‹‰å–æœåŠ¡åˆ—è¡¨</span></span><br><span class="line">          <span class="attr">predicates:</span> <span class="comment"># è·¯ç”±æ–­è¨€ï¼Œåˆ¤æ–­å½“å‰è¯·æ±‚æ˜¯å¦ç¬¦åˆå½“å‰è§„åˆ™ï¼Œç¬¦åˆåˆ™è·¯ç”±åˆ°ç›®æ ‡æœåŠ¡</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/resfood/**</span> <span class="comment"># è¿™é‡Œæ˜¯ä»¥è¯·æ±‚è·¯å¾„ä½œä¸ºåˆ¤æ–­è§„åˆ™</span></span><br></pre></td></tr></table></figure><p>predicates:  è·¯ç”±æ–­è¨€</p><p>ç°åœ¨ä½¿ç”¨è¯¥æ¨¡å¼æˆ‘ä»¬å¯ä»¥é€šè¿‡<wavy>,æ ¹æ®æ¡ä»¶åˆ›å»ºä¸€ä¸ªå¯¹è±¡</wavy>,  åœ¨ä»¥å¾€ä¹‹å‰,  åªèƒ½é€šè¿‡newä¸€ä¸ªå…·ä½“å¯¹è±¡</p><blockquote><p>å…¶ä»–çš„æ¡ˆä¾‹è¿˜æœ‰: 1. Feign  2. JDKä¸­çš„StringBuilder</p></blockquote><ul><li>è¿‡æ»¤å™¨å·¥å‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŸºäºSpringBootå®ç°ç®€å•å¾®ä¿¡æ‰«ç ç™»å½•</title>
      <link href="/2023/12/17/%E5%BE%AE%E4%BF%A1%E6%89%AB%E7%A0%81%E7%99%BB%E5%BD%95/"/>
      <url>/2023/12/17/%E5%BE%AE%E4%BF%A1%E6%89%AB%E7%A0%81%E7%99%BB%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<p>å¯¹äºå¾®ä¿¡æ‰«ç ç™»å½•,é¦–å…ˆæˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªå…¬ä¼—å·å¹³å°è´¦å·(å¯ä»¥æ˜¯æµ‹è¯•è´¦æˆ·,ä¹Ÿå¯ä»¥æ˜¯å·²ç»æ³¨å†Œç»‘å®šè¥ä¸šçš„è´¦æˆ·).</p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç›´è¾¾é“¾æ¥(å½“å‰æ ·ä¾‹ä»…åœ¨æµ‹è¯•å·ç¯å¢ƒä¸‹å¤„ç†):</p><ul><li><p><a href="https://mp.weixin.qq.com/debug/cgi-bin/sandboxinfo?action=showinfo&t=sandbox/index">å¾®ä¿¡å…¬ä¼—å¹³å°ç®¡ç†</a></p></li><li><p><a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html">ç½‘é¡µæˆæƒæ–‡æ¡£</a></p></li></ul><p>è¿˜éœ€è¦å‡†å¤‡ä¸€ä¸ªå†…ç½‘ç©¿é€çš„å·¥å…·(ä»»é€‰å…¶ä¸€å³å¯)</p><ul><li><p><a href="https://ngrok.com/download">ngrok</a></p></li><li><p><a href="https://hsk.oray.com/">èŠ±ç”Ÿå£³</a></p></li></ul><p>åœ¨æ­¤ä»…åˆ—å‡ºä¿©ä¸ª,  éœ€è¦è·å–æ›´å¤šä¿¡æ¯ <a href="https://www.bing.com/search?pglt=675&q=%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7">é“¾æ¥</a></p><h3 id="å†…ç½‘ç©¿é€"><a href="#å†…ç½‘ç©¿é€" class="headerlink" title="å†…ç½‘ç©¿é€"></a>å†…ç½‘ç©¿é€</h3><p>ä¸€å¥è¯æ¥è¯´å°±æ˜¯ï¼Œè®©å¤–ç½‘èƒ½è®¿é—®ä½ çš„å†…ç½‘ï¼›æŠŠè‡ªå·±çš„å†…ç½‘ï¼ˆä¸»æœºï¼‰å½“æˆæœåŠ¡å™¨ï¼Œè®©å¤–ç½‘èƒ½è®¿é—®</p><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦é€šè¿‡å·¥å…·é…ç½®(å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¸ç”¨å·¥å…·,æˆ‘åœ¨æ­¤ä½¿ç”¨å·¥å…·çš„æ–¹å¼å®ç°)</p><h4 id="Ngrok"><a href="#Ngrok" class="headerlink" title="Ngrok"></a>Ngrok</h4><p>é¦–å…ˆåœ¨Ngrokæ³¨å†Œè´¦å·,  ç‚¹å‡»ä¸Šé¢é“¾æ¥ä¸‹è½½Ngrok</p><p>æ‰“å¼€ngrokåœ¨å¼¹å‡ºæ§åˆ¶å°è¾“å…¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ngrok http 80</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚æˆ‘éœ€è¦æ˜ å°„æœ¬åœ°çš„80ç«¯å£,  è¾“å…¥å®Œæˆæ§åˆ¶å°ä¼šæœ‰ä¸€ä¸ªå›è°ƒæ˜¾ç¤º,  å¤åˆ¶æ˜ å°„åœ°å€å³å¯</p><h4 id="èŠ±ç”Ÿå£³"><a href="#èŠ±ç”Ÿå£³" class="headerlink" title="èŠ±ç”Ÿå£³"></a>èŠ±ç”Ÿå£³</h4><p>èŠ±ç”Ÿå£³é…ç½®å¦‚å›¾</p><p><img src="https://calyee-image.pages.dev/file/9c4e56f236da97ae0ab93.png"></p><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><h4 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- hutoolå·¥å…·åŒ… --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.7.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ç”ŸæˆäºŒç»´ç  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.zxing<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- wx --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- å¾®ä¿¡æˆæƒç™»å½•--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.github.binarywang/weixin-java-mp --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.binarywang<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>weixin-java-mp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="yaml"><a href="#yaml" class="headerlink" title="yaml"></a>yaml</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">wechat:</span></span><br><span class="line">  <span class="attr">mpAppId:</span> <span class="string">wxfc5465********</span>  <span class="comment"># your appid</span></span><br><span class="line">  <span class="attr">mpAppSecret:</span> <span class="number">49e5997</span><span class="string">*****</span>  <span class="comment"># your appSecret</span></span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•å·ç®¡ç†é…ç½®"><a href="#æµ‹è¯•å·ç®¡ç†é…ç½®" class="headerlink" title="æµ‹è¯•å·ç®¡ç†é…ç½®"></a>æµ‹è¯•å·ç®¡ç†é…ç½®</h4><p>æˆ‘ä»¬éœ€è¦é…ç½®çš„æ˜¯ <strong>æ¥å£é…ç½®ä¿¡æ¯</strong></p><p>URLå’ŒToken</p><p>URL: éªŒè¯çš„æ–¹æ³•</p><p>æ¥ä¸‹æ¥ç›´æ¥åˆ—å‡ºä»£ç </p><p><code>controller</code>: </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WeixinCheckController</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¾®ä¿¡å…¬ä¼—å·ç­¾åè®¤è¯æ¥å£</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/wxCheck&quot;,</span></span><br><span class="line"><span class="meta">            method = &#123;RequestMethod.POST, RequestMethod.GET&#125;,</span></span><br><span class="line"><span class="meta">            produces = &quot;text/html; charset=utf-8&quot;)</span> <span class="comment">// å¿…é¡»ä¸ºè¿™ä¸ªè¿”å›ç»“æœæ ¼å¼</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">WxToken</span><span class="params">(<span class="meta">@RequestParam(name = &quot;signature&quot;, required = false)</span> String signature,</span></span><br><span class="line"><span class="params">                          <span class="meta">@RequestParam(name = &quot;timestamp&quot;, required = false)</span> String timestamp,</span></span><br><span class="line"><span class="params">                          <span class="meta">@RequestParam(name = &quot;nonce&quot;, required = false)</span> String nonce,</span></span><br><span class="line"><span class="params">                          <span class="meta">@RequestParam(name = &quot;echostr&quot;, required = false)</span> String echostr</span></span><br><span class="line"><span class="params">    )</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;å¾®ä¿¡Tokenè®¤è¯===&gt;signature=&#123;&#125;,timestamp=&#123;&#125;,echostr=&#123;&#125;&quot;</span>, signature, timestamp, echostr);</span><br><span class="line">        <span class="comment">// é€šè¿‡æ£€éªŒsignatureå¯¹è¯·æ±‚è¿›è¡Œæ ¡éªŒï¼Œè‹¥æ ¡éªŒæˆåŠŸåˆ™åŸæ ·è¿”å›echostrï¼Œè¡¨ç¤ºæ¥å…¥æˆåŠŸï¼Œå¦åˆ™æ¥å…¥å¤±è´¥</span></span><br><span class="line">        <span class="keyword">if</span> (signature != <span class="literal">null</span> &amp;&amp; WeixinCheckoutUtil.checkSignature(signature, timestamp, nonce)) &#123;</span><br><span class="line">            <span class="keyword">return</span> echostr;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>WeixinCheckoutUtil</code>:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> WeixinCheckoutUtil</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> Calyee</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WeixinCheckoutUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸æ¥å£é…ç½®ä¿¡æ¯ä¸­çš„Tokenè¦ä¸€è‡´</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> <span class="string">&quot;calyee&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * éªŒè¯ç­¾å</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> signature</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> timestamp</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> nonce</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">checkSignature</span><span class="params">(String signature, String timestamp, String nonce)</span> &#123;</span><br><span class="line">        String[] arr = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;token, timestamp, nonce&#125;;</span><br><span class="line">        <span class="comment">// å°†tokenã€timestampã€nonceä¸‰ä¸ªå‚æ•°è¿›è¡Œå­—å…¸åºæ’åº</span></span><br><span class="line">        <span class="comment">// Arrays.sort(arr);</span></span><br><span class="line">        sort(arr);</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">content</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">            content.append(arr[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">MessageDigest</span> <span class="variable">md</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">tmpStr</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            md = MessageDigest.getInstance(<span class="string">&quot;SHA-1&quot;</span>);</span><br><span class="line">            <span class="comment">// å°†ä¸‰ä¸ªå‚æ•°å­—ç¬¦ä¸²æ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²è¿›è¡Œsha1åŠ å¯†</span></span><br><span class="line">            <span class="type">byte</span>[] digest = md.digest(content.toString().getBytes());</span><br><span class="line">            tmpStr = byteToStr(digest);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        content = <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">// å°†sha1åŠ å¯†åçš„å­—ç¬¦ä¸²å¯ä¸signatureå¯¹æ¯”ï¼Œæ ‡è¯†è¯¥è¯·æ±‚æ¥æºäºå¾®ä¿¡</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> tmpStr != <span class="literal">null</span> ? tmpStr.equals(signature.toUpperCase()) : <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†å­—èŠ‚æ•°ç»„è½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> byteArray</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">byteToStr</span><span class="params">(<span class="type">byte</span>[] byteArray)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">strDigest</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; byteArray.length; i++) &#123;</span><br><span class="line">            strDigest += byteToHexStr(byteArray[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> strDigest;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†å­—èŠ‚è½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mByte</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">byteToHexStr</span><span class="params">(<span class="type">byte</span> mByte)</span> &#123;</span><br><span class="line">        <span class="type">char</span>[] Digit = &#123;<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;F&#x27;</span>&#125;;</span><br><span class="line">        <span class="type">char</span>[] tempArr = <span class="keyword">new</span> <span class="title class_">char</span>[<span class="number">2</span>];</span><br><span class="line">        tempArr[<span class="number">0</span>] = Digit[(mByte &gt;&gt;&gt; <span class="number">4</span>) &amp; <span class="number">0X0F</span>];</span><br><span class="line">        tempArr[<span class="number">1</span>] = Digit[mByte &amp; <span class="number">0X0F</span>];</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(tempArr);</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(String a[])</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; a.length - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i + <span class="number">1</span>; j &lt; a.length; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (a[j].compareTo(a[i]) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">temp</span> <span class="operator">=</span> a[i];</span><br><span class="line">                    a[i] = a[j];</span><br><span class="line">                    a[j] = temp;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ä½¿ç”¨<u>å†…å¤–ç©¿é€</u>çš„åœ°å€è®¿é—®æ­¤æ¥å£å§, æ³¨æ„æ˜¯åœ¨å…¬ä¼—å·é…ç½®ä¿¡æ¯å¤„</p><h3 id="å¼€å‘"><a href="#å¼€å‘" class="headerlink" title="å¼€å‘"></a>å¼€å‘</h3><p>å¾®ä¿¡å¼€å‘è€…æ–‡æ¡£å°†æˆæƒæµç¨‹åˆ†ä¸ºäº†4æ­¥: (<a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html">å¾®ä¿¡ç½‘é¡µå¼€å‘</a>)</p><ol><li>å¼•å¯¼ç”¨æˆ·è¿›å…¥æˆæƒé¡µé¢åŒæ„æˆæƒï¼Œè·å–code</li><li>é€šè¿‡codeæ¢å–ç½‘é¡µæˆæƒaccess_tokenï¼ˆä¸åŸºç¡€æ”¯æŒä¸­çš„access_tokenä¸åŒï¼‰</li><li>å¦‚æœéœ€è¦ï¼Œå¼€å‘è€…å¯ä»¥åˆ·æ–°ç½‘é¡µæˆæƒaccess_tokenï¼Œé¿å…è¿‡æœŸ</li><li>é€šè¿‡ç½‘é¡µæˆæƒaccess_tokenå’Œopenidè·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼ˆæ”¯æŒUnionIDæœºåˆ¶ï¼‰</li></ol><h4 id="ç¬¬ä¸€æ­¥-ç”¨æˆ·åŒæ„æˆæƒè·å–code"><a href="#ç¬¬ä¸€æ­¥-ç”¨æˆ·åŒæ„æˆæƒè·å–code" class="headerlink" title="ç¬¬ä¸€æ­¥: ç”¨æˆ·åŒæ„æˆæƒè·å–code"></a>ç¬¬ä¸€æ­¥: ç”¨æˆ·åŒæ„æˆæƒè·å–code</h4><p>åœ¨ç¡®ä¿å¾®ä¿¡å…¬ä¼—è´¦å·æ‹¥æœ‰æˆæƒä½œç”¨åŸŸï¼ˆscopeå‚æ•°ï¼‰çš„æƒé™çš„å‰æä¸‹ï¼ˆå·²è®¤è¯æœåŠ¡å·ï¼Œé»˜è®¤æ‹¥æœ‰scopeå‚æ•°ä¸­çš„snsapi_baseå’Œsnsapi_userinfo æƒé™ï¼‰ï¼Œå¼•å¯¼å…³æ³¨è€…æ‰“å¼€å¦‚ä¸‹é¡µé¢ï¼š</p><p><a href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=APPID&redirect_uri=REDIRECT_URI&response_type=code&scope=SCOPE&state=STATE#wechat_redirect">https://open.weixin.qq.com/connect/oauth2/authorize?appid=APPID&amp;redirect_uri=REDIRECT_URI&amp;response_type=code&amp;scope=SCOPE&amp;state=STATE#wechat_redirect</a></p><p>è‹¥æç¤ºâ€œè¯¥é“¾æ¥æ— æ³•è®¿é—®â€ï¼Œè¯·æ£€æŸ¥å‚æ•°æ˜¯å¦å¡«å†™é”™è¯¯ï¼Œæ˜¯å¦æ‹¥æœ‰scopeå‚æ•°å¯¹åº”çš„æˆæƒä½œç”¨åŸŸæƒé™ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> WeixinLoginController</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> å¾®ä¿¡ç™»å½•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> Calyee</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@DATE</span> 2023/12/17 017 18:32</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WeixinLoginController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">baseUrl</span> <span class="operator">=</span> <span class="string">&quot;https://2886**********/&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;wechat.mpAppId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">appid</span> <span class="operator">=</span> <span class="string">&quot;wxfc546**********&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”ŸæˆäºŒç»´ç </span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/wxLogin&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">login</span><span class="params">(HttpServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// redirect_uriæ˜¯å›è°ƒçš„åœ°å€æ³¨æ„è¦è½¬æˆUrLEncodeæ ¼å¼</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">redirectUrl</span> <span class="operator">=</span> URLEncoder.encode(baseUrl + <span class="string">&quot;wxCallBack&quot;</span>, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        <span class="comment">// æ„é€ äºŒç»´ç é“¾æ¥åœ°å€</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;https://open.weixin.qq.com/connect/oauth2/authorize?&quot;</span> +</span><br><span class="line">                <span class="string">&quot;appid=&quot;</span> + appid +</span><br><span class="line">                <span class="string">&quot;&amp;redirect_uri=&quot;</span> + redirectUrl +</span><br><span class="line">                <span class="string">&quot;&amp;response_type=code&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&amp;scope=snsapi_userinfo&quot;</span> +      <span class="comment">// æˆæƒä½œç”¨åŸŸ</span></span><br><span class="line">                <span class="string">&quot;&amp;state=STATE#wechat_redirect&quot;</span>; <span class="comment">// #wechat_redirectå¿…é¡»ä¼ </span></span><br><span class="line">        <span class="comment">// &lt;link&gt; https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html</span></span><br><span class="line">        <span class="comment">// https://open.weixin.qq.com/connect/oauth2/authorize?appid=APPID&amp;redirect_uri=REDIRECT_URI&amp;response_type=code&amp;scope=SCOPE&amp;state=STATE#wechat_redirect</span></span><br><span class="line">        <span class="comment">// ç”ŸæˆäºŒç»´ç çš„ï¼Œæ‰«æåè·³è½¬ä¸Šé¢çš„åœ°å€</span></span><br><span class="line">        response.setContentType(<span class="string">&quot;image/png&quot;</span>);</span><br><span class="line">        <span class="comment">// ç”ŸæˆäºŒç»´ç </span></span><br><span class="line">        QrCodeUtil.generate(url, <span class="number">300</span>, <span class="number">300</span>, <span class="string">&quot;jpg&quot;</span>, response.getOutputStream());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆæƒåï¼Œé¡µé¢å°†è·³è½¬è‡³ redirect_uri&#x2F;?code&#x3D;CODE&amp;state&#x3D;STATE</p><h4 id="ç¬¬äºŒæ­¥ï¼šé€šè¿‡codeæ¢å–ç½‘é¡µæˆæƒaccess-token"><a href="#ç¬¬äºŒæ­¥ï¼šé€šè¿‡codeæ¢å–ç½‘é¡µæˆæƒaccess-token" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šé€šè¿‡codeæ¢å–ç½‘é¡µæˆæƒaccess_token"></a>ç¬¬äºŒæ­¥ï¼šé€šè¿‡codeæ¢å–ç½‘é¡µæˆæƒaccess_token</h4><p>é¦–å…ˆè¯·æ³¨æ„ï¼Œè¿™é‡Œé€šè¿‡codeæ¢å–çš„æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç½‘é¡µæˆæƒaccess_token,ä¸åŸºç¡€æ”¯æŒä¸­çš„access_tokenï¼ˆè¯¥access_tokenç”¨äºè°ƒç”¨å…¶ä»–æ¥å£ï¼‰ä¸åŒã€‚å…¬ä¼—å·å¯é€šè¿‡ä¸‹è¿°æ¥å£æ¥è·å–ç½‘é¡µæˆæƒaccess_tokenã€‚å¦‚æœç½‘é¡µæˆæƒçš„ä½œç”¨åŸŸä¸ºsnsapi_baseï¼Œåˆ™æœ¬æ­¥éª¤ä¸­è·å–åˆ°ç½‘é¡µæˆæƒaccess_tokençš„åŒæ—¶ï¼Œä¹Ÿè·å–åˆ°äº†openidï¼Œsnsapi_baseå¼çš„ç½‘é¡µæˆæƒæµç¨‹å³åˆ°æ­¤ä¸ºæ­¢ã€‚</p><p>å°¤å…¶æ³¨æ„ï¼šç”±äºå…¬ä¼—å·çš„secretå’Œè·å–åˆ°çš„access_tokenå®‰å…¨çº§åˆ«éƒ½éå¸¸é«˜ï¼Œå¿…é¡»åªä¿å­˜åœ¨æœåŠ¡å™¨ï¼Œä¸å…è®¸ä¼ ç»™å®¢æˆ·ç«¯ã€‚åç»­åˆ·æ–°access_tokenã€é€šè¿‡access_tokenè·å–ç”¨æˆ·ä¿¡æ¯ç­‰æ­¥éª¤ï¼Œä¹Ÿå¿…é¡»ä»æœåŠ¡å™¨å‘èµ·ã€‚</p><p>åœ¨å½“å‰controlleræ·»åŠ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> WxMpService wxMpService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* ç”¨æˆ·ç‚¹åŒæ„å›è°ƒ</span></span><br><span class="line"><span class="comment">* é€šè¿‡codeæ¢å–ç½‘é¡µçš„æˆæƒaccess_token</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> code     é¡µé¢æ‹¿åˆ°çš„code</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">* <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/wxCallBack&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getWxCallBack</span><span class="params">(String code,</span></span><br><span class="line"><span class="params">                            String state,</span></span><br><span class="line"><span class="params">                            HttpSession session,</span></span><br><span class="line"><span class="params">                            HttpServletRequest request,</span></span><br><span class="line"><span class="params">                            HttpServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    log.info(<span class="string">&quot;code=&#123;&#125;&quot;</span>, code);</span><br><span class="line">    WxMpOAuth2AccessToken wxMpOAuth2AccessToken;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        wxMpOAuth2AccessToken = wxMpService.oauth2getAccessToken(code);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (WxErrorException e) &#123;</span><br><span class="line">        log.info(<span class="string">&quot;ã€å¾®ä¿¡ç½‘é¡µæˆæƒå‘ç”Ÿé”™è¯¯ã€‘&quot;</span>);</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Exception</span>(e.getError().getErrorMsg());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// wxMpOAuth2AccessToken: å¯ä»¥è·å–ç”¨æˆ·æˆæƒçš„ä¿¡æ¯</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">openId</span> <span class="operator">=</span> wxMpOAuth2AccessToken.getOpenId();</span><br><span class="line">    log.info(<span class="string">&quot;ã€å¾®ä¿¡ç½‘é¡µæˆæƒã€‘openId=&#123;&#125;,accessToken=&#123;&#125;&quot;</span>, openId, wxMpOAuth2AccessToken.getAccessToken());</span><br><span class="line">    <span class="comment">// ç¼“å­˜ä¸€ä¸‹</span></span><br><span class="line">    session.setAttribute(<span class="string">&quot;openid&quot;</span>, openId);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:&quot;</span> + state + <span class="string">&quot;?openid=&quot;</span> + openId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç¬¬ä¸‰æ­¥ï¼šåˆ·æ–°access-tokenï¼ˆå¦‚æœéœ€è¦ï¼‰"><a href="#ç¬¬ä¸‰æ­¥ï¼šåˆ·æ–°access-tokenï¼ˆå¦‚æœéœ€è¦ï¼‰" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šåˆ·æ–°access_tokenï¼ˆå¦‚æœéœ€è¦ï¼‰"></a>ç¬¬ä¸‰æ­¥ï¼šåˆ·æ–°access_tokenï¼ˆå¦‚æœéœ€è¦ï¼‰</h4><blockquote><p>è§æ–‡æ¡£,  æ­¤æ­¥éª¤æ–‡æ¡£æè¿°é“é€šè¿‡refresh_tokenè¯·æ±‚ä»¥ä¸‹é“¾æ¥è·å–access_token</p></blockquote><blockquote><p><a href="https://api.weixin.qq.com/sns/oauth2/refresh_token?appid=APPID&grant_type=refresh_token&refresh_token=REFRESH_TOKEN">https://api.weixin.qq.com/sns/oauth2/refresh_token?appid=APPID&amp;grant_type=refresh_token&amp;refresh_token=REFRESH_TOKEN</a></p></blockquote><h4 id="ç¬¬å››æ­¥ï¼šæ‹‰å–ç”¨æˆ·ä¿¡æ¯-éœ€scopeä¸º-snsapi-userinfo"><a href="#ç¬¬å››æ­¥ï¼šæ‹‰å–ç”¨æˆ·ä¿¡æ¯-éœ€scopeä¸º-snsapi-userinfo" class="headerlink" title="ç¬¬å››æ­¥ï¼šæ‹‰å–ç”¨æˆ·ä¿¡æ¯(éœ€scopeä¸º snsapi_userinfo)"></a>ç¬¬å››æ­¥ï¼šæ‹‰å–ç”¨æˆ·ä¿¡æ¯(éœ€scopeä¸º snsapi_userinfo)</h4><blockquote><p> è§æ–‡æ¡£,  å¦‚æœç½‘é¡µæˆæƒä½œç”¨åŸŸä¸ºsnsapi_userinfoï¼Œåˆ™æ­¤æ—¶å¼€å‘è€…å¯ä»¥é€šè¿‡access_tokenå’Œopenidæ‹‰å–ç”¨æˆ·ä¿¡æ¯äº†ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> å¾®ä¿¡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¾®ä¿¡æ‰«ç  </tag>
            
            <tag> å†…ç½‘ç©¿é€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringSecurity</title>
      <link href="/2023/12/03/SpringSecurity/"/>
      <url>/2023/12/03/SpringSecurity/</url>
      
        <content type="html"><![CDATA[<div class="tip info"><p>å¾…æ›´æ–°</p></div><h1 id="SpringSecurity"><a href="#SpringSecurity" class="headerlink" title="SpringSecurity"></a>SpringSecurity</h1><h2 id="å…¥é—¨ç¯å¢ƒ"><a href="#å…¥é—¨ç¯å¢ƒ" class="headerlink" title="å…¥é—¨ç¯å¢ƒ"></a>å…¥é—¨ç¯å¢ƒ</h2><p>åŸºäºçˆ¶ä¾èµ–SpringBoot 2.7.3</p><p>å¯¼å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--SpringBoot Web--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--SpringSecurity--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="è®¤è¯"><a href="#è®¤è¯" class="headerlink" title="è®¤è¯"></a>è®¤è¯</h2><p>ç™»å½•æ ¡éªŒæµç¨‹å›¾</p><p><img src="https://github.com/anchorlove/SpringSecurityStudy/raw/main/img/image-20211215094003288.png"></p><h3 id="é€šè¿‡æ–°çš„Debugæ–¹å¼äº†è§£Securityå†…éƒ¨é€»è¾‘"><a href="#é€šè¿‡æ–°çš„Debugæ–¹å¼äº†è§£Securityå†…éƒ¨é€»è¾‘" class="headerlink" title="é€šè¿‡æ–°çš„Debugæ–¹å¼äº†è§£Securityå†…éƒ¨é€»è¾‘"></a>é€šè¿‡æ–°çš„Debugæ–¹å¼äº†è§£Securityå†…éƒ¨é€»è¾‘</h3><p>SpringSecurityçš„åŸç†å…¶å®å°±æ˜¯ä¸€ä¸ªè¿‡æ»¤å™¨é“¾ï¼Œå†…éƒ¨åŒ…å«äº†æä¾›å„ç§åŠŸèƒ½çš„è¿‡æ»¤å™¨</p><p>æ­¤æ—¶æˆ‘ä»¬éœ€è¦æ¢ç©¶SpringSecurityçš„è¿‡æ»¤å™¨é“¾,  å¯ä»¥é€šè¿‡æŸ¥çœ‹Springå®¹å™¨ä¸­çš„å®¹å™¨å°±å¯ä»¥çŸ¥é“</p><p>æˆ‘ä»¬è·å–SpringApplicationçš„è¿”å›å€¼ å¦‚:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ConfigurableApplicationContext</span> <span class="variable">run</span> <span class="operator">=</span> SpringApplication.run(SecurityApplication.class, args);</span><br></pre></td></tr></table></figure><p>åœ¨æ­¤è¡Œçš„ä¸‹æ–¹éšä¾¿è¾“å‡ºä¸€è¡Œè¯­å¥,  æ‰“ä¸Šæ–­ç‚¹,  è¿›å…¥debugæ¨¡å¼</p><p><img src="https://s2.loli.net/2023/12/03/h2yz8cnRHpOSfF6.png"></p><p>å¯¹åˆšåˆšçš„è¿”å›å€¼runè¿›è¡Œæ•è·(å›¾ç¤ºé‡Œé¢å¹¶æœªæ·»åŠ è¿”å›å€¼),  æŒ‰ä¸‹å›è½¦å³å¯è·å–ç»“æœé›†(å®¹å™¨),  åœ¨æ­¤æ—¶æˆ‘ä»¬éœ€è¦è·å–çš„beanä¸ºDefaultSecurityFilterChain</p><p><img src="https://s2.loli.net/2023/12/03/YqVBs9ZHrwonml7.png"></p><p>å¦‚å›¾å¯ä»¥çœ‹åˆ°æœ‰16ä¸ªè¿‡æ»¤å™¨</p>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é‰´æƒ </tag>
            
            <tag> SpringSecurity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LoadBalancerå·¥ä½œåŸç†</title>
      <link href="/2023/11/25/SpringCloud%20LoadBalancer%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/"/>
      <url>/2023/11/25/SpringCloud%20LoadBalancer%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å‰è¨€:  å½“å‰ç« èŠ‚ä¸ä¼šåƒSpringBootæºç åˆ†æç¯‡ç« ä¸€æ ·å¤§ç¯‡å¹…çš„åˆ—ä¸¾å¤§é‡æºç ,  ä»…ä»…åˆ—ä¸¾éƒ¨åˆ†æºç </p></blockquote><h2 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h2><h3 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h3><p>é¦–å…ˆéœ€è¦å¯¼å…¥LoadBalanceä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--LoadBalanced--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-loadbalancer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="é€æ­¥è¿½è¸ªä¾èµ–"><a href="#é€æ­¥è¿½è¸ªä¾èµ–" class="headerlink" title="é€æ­¥è¿½è¸ªä¾èµ–"></a>é€æ­¥è¿½è¸ªä¾èµ–</h3><p>é€šè¿‡è¯¥starterè¿½è¸ªæ‰¾åˆ°ä¾èµ–jaråŒ…ä¸­åªæœ‰ä¸€ä¸ªpomæ–‡ä»¶,  åœ¨pomæ–‡ä»¶ä¸­æ‰¾åˆ°LoadBalanceçš„çœŸæ­£ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-loadbalancer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="æ‰¾åˆ°LoadBalancerAutoConfiguration"><a href="#æ‰¾åˆ°LoadBalancerAutoConfiguration" class="headerlink" title="æ‰¾åˆ°LoadBalancerAutoConfiguration"></a>æ‰¾åˆ°LoadBalancerAutoConfiguration</h3><p>ç»§ç»­åœ¨ä¾èµ–é‡Œé¢æ‰¾åˆ°<code>spring-cloud-loadbalancer</code>çš„jaråŒ…, æ ¹æ®SPIåŸåˆ™æ‰¾åˆ°<code>spring.factories</code>,  åœ¨è¯¥æ–‡ä»¶ä¸­æ‰¾åˆ°è‡ªåŠ¨é…ç½®<code>LoadBalancerAutoConfiguration</code> è¿½è¸ªåˆ°äº†è¯¥ç±»ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@LoadBalancerClients</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(LoadBalancerClientsProperties.class)</span></span><br><span class="line"><span class="meta">@AutoConfigureBefore(&#123; ReactorLoadBalancerClientAutoConfiguration.class,</span></span><br><span class="line"><span class="meta">LoadBalancerBeanPostProcessorAutoConfiguration.class &#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(value = &quot;spring.cloud.loadbalancer.enabled&quot;,havingValue = &quot;true&quot;, </span></span><br><span class="line"><span class="meta">                       matchIfMissing = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoadBalancerAutoConfiguration</span> &#123;</span><br><span class="line"><span class="comment">// ç•¥(è¯¦æƒ…è§org.springframework.cloud.loadbalancer.config.LoadBalancerAutoConfiguration)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span> <span class="comment">// å½“å‰æ³¨è§£ä¸º:å‡å¦‚æ²¡æœ‰è¯¥beanåˆ™åˆ›å»º,æœ‰åˆ™ä¸æ‰§è¡Œ</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> LoadBalancerClientFactory <span class="title function_">loadBalancerClientFactory</span><span class="params">(LoadBalancerClientsProperties properties)</span> &#123;</span><br><span class="line"><span class="type">LoadBalancerClientFactory</span> <span class="variable">clientFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LoadBalancerClientFactory</span>(properties);</span><br><span class="line">clientFactory.setConfigurations(<span class="built_in">this</span>.configurations.getIfAvailable(Collections::emptyList));</span><br><span class="line"><span class="keyword">return</span> clientFactory;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§£æç‚¹:</p><ul><li>å¯¹äº6-7è¡Œä»£ç å¤„çš„æ³¨è§£,  å¯ä»¥æ¸…æ™°çš„çŸ¥é“,  å‡å¦‚ä½¿ç”¨SpringCloudçš„è´Ÿè½½å‡è¡¡åœ¨æ²¡æœ‰é…ç½®å¼€å¯çš„æƒ…å†µä¸‹,  é»˜è®¤ä¸ºå¼€å¯,  å› ä¸º <code>matchIfMissing = true</code></li><li>å¯¹äº12è¡Œçš„æ–¹æ³•ä¸ºè´Ÿè½½å‡è¡¡å®¢æˆ·ç«¯å·¥å‚æ–¹æ³•,  ç”¨äºæ„é€ è´Ÿè½½å‡è¡¡å®¢æˆ·ç«¯çš„</li></ul><h3 id="åˆ‡å…¥ç‚¹ä¸è‡ªå®šä¹‰è®¾æƒ³"><a href="#åˆ‡å…¥ç‚¹ä¸è‡ªå®šä¹‰è®¾æƒ³" class="headerlink" title="åˆ‡å…¥ç‚¹ä¸è‡ªå®šä¹‰è®¾æƒ³"></a>åˆ‡å…¥ç‚¹ä¸è‡ªå®šä¹‰è®¾æƒ³</h3><div class="tip info"><p>åˆ‡å…¥ç‚¹:  ä¸ºä»€ä¹ˆåœ¨SpringCloud LoadBalanceä¸­é»˜è®¤ä¸ºè½®è¯¢ ?  æˆ‘ä»¬èƒ½ä¸èƒ½è‡ªå®šä¹‰ä¸€ä¸ªç®—æ³•è¿›è¡Œè´Ÿè½½å‡è¡¡å‘¢ ? </p></div><p>ç»§ç»­å¯¹äº12è¡Œæ–¹æ³•ä¸­çš„<code>LoadBalancerClientFactory</code>è´Ÿè½½å‡è¡¡å®¢æˆ·ç«¯å·¥å‚è¿›è¡Œè¿½è¸ª,  å¯¹äºå·¥å‚è€Œè¨€,  æœ€é‡è¦çš„å°±æ˜¯å®ä¾‹åŒ–beanäº†,  åœ¨å½“å‰æºç å¤„,  å¯ä»¥å®¹æ˜“æ‰¾åˆ°ä¸€ä¸ªåä¸º<code>getInstance</code>çš„æ–¹æ³•,  æ˜¾ç„¶ä¸ºä»å·¥å‚è·å–å®ä¾‹beançš„æ–¹æ³•:  (å¦‚ä¸‹)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ReactiveLoadBalancer&lt;ServiceInstance&gt; <span class="title function_">getInstance</span><span class="params">(String serviceId)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> getInstance(serviceId, ReactorServiceInstanceLoadBalancer.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è§£è¯»,  è·å–å®ä¾‹æ˜¯é€šè¿‡</p><ol><li>ä¸€ä¸ªæœåŠ¡çš„ç¼–å·</li><li>ä¸€ä¸ªå®ç°æ¥å£çš„å­—èŠ‚ç ç±»</li></ol><p>å¯¹äº1å½“ç„¶ä¸é™Œç”Ÿ,  æ˜¾ç„¶å½“å‰è¦ä»¥2åˆ‡å…¥</p><p>è¿½è¸ªè¿›å»æ˜¯ä¸€ä¸ªæ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A marker interface for &#123;<span class="doctag">@link</span> ReactorLoadBalancer&#125; that allows selecting</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> ServiceInstance&#125; objects.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Olga Maciaszek-Sharma</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2.2.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ReactorServiceInstanceLoadBalancer</span> <span class="keyword">extends</span> <span class="title class_">ReactorLoadBalancer</span>&lt;ServiceInstance&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨é‡Š:  ä¸€ä¸ªæ ‡è®°ä¸ºè´Ÿè½½å‡è¡¡çš„æ¥å£,  å®ƒè¢«å…è®¸é€‰æ‹©æœåŠ¡å®ä¾‹å¯¹è±¡</p><h3 id="é€‰æ‹©è´Ÿè½½å‡è¡¡å®ä¾‹"><a href="#é€‰æ‹©è´Ÿè½½å‡è¡¡å®ä¾‹" class="headerlink" title="é€‰æ‹©è´Ÿè½½å‡è¡¡å®ä¾‹"></a>é€‰æ‹©è´Ÿè½½å‡è¡¡å®ä¾‹</h3><p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬éœ€è¦å®ç°è‡ªå·±çš„è´Ÿè½½å‡è¡¡å°±æ˜¯é€šè¿‡å½“å‰çš„æ¥å£å®ç°çš„,  é€šè¿‡ç‚¹å‡»å½“å‰æ¥å£å,  å¯ä»¥å‘ç°æœ‰ä¸‰ä¸ªå®ç°ç±»</p><ol><li>RandomLoadBalancer</li><li>RoundRobinLoadBalancer</li><li>LoadBalancerClientFactory</li></ol><p>ä»¥2(RoundRobin: è½®è¯¢)ä¸ºä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoundRobinLoadBalancer</span> <span class="keyword">implements</span> <span class="title class_">ReactorServiceInstanceLoadBalancer</span> &#123;  <span class="comment">// å®ç°ReactorServiceInstanceLoadBalancer æ¥å£</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Log</span> <span class="variable">log</span> <span class="operator">=</span> LogFactory.getLog(RoundRobinLoadBalancer.class);</span><br><span class="line"><span class="keyword">final</span> AtomicInteger position; <span class="comment">// ä¸€ä¸ªåŸå­æ•´æ•°(ç”¨äºçº¿ç¨‹åŒæ­¥)ï¼Œè¡¨ç¤ºå¾ªç¯è½®è¯¢ä¸­çš„å½“å‰ä½ç½®</span></span><br><span class="line"><span class="keyword">final</span> String serviceId; <span class="comment">// è¡¨ç¤ºéœ€è¦é€‰æ‹©å®ä¾‹çš„æœåŠ¡çš„ID</span></span><br><span class="line"></span><br><span class="line">ObjectProvider&lt;ServiceInstanceListSupplier&gt; serviceInstanceListSupplierProvider; <span class="comment">// ç”¨äºè·å–æœåŠ¡å®ä¾‹åˆ—è¡¨çš„æä¾›è€…</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> serviceInstanceListSupplierProvider a provider of</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> ServiceInstanceListSupplier&#125; that will be used to get available instances</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> serviceId id of the service for which to choose an instance</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">    <span class="comment">// æ„é€ å‡½æ•°ï¼Œä½¿ç”¨ç»™å®šçš„ serviceInstanceListSupplierProviderã€serviceId å’Œä¸€ä¸ªéšæœºçš„ç§å­ä½ç½®åˆå§‹åŒ– RoundRobinLoadBalancerã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">RoundRobinLoadBalancer</span><span class="params">(ObjectProvider&lt;ServiceInstanceListSupplier&gt; serviceInstanceListSupplierProvider,</span></span><br><span class="line"><span class="params">String serviceId)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>(serviceInstanceListSupplierProvider, serviceId, <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">1000</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> serviceInstanceListSupplierProvider a provider of</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> ServiceInstanceListSupplier&#125; that will be used to get available instances</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> serviceId id of the service for which to choose an instance</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> seedPosition Round Robin element position marker</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">    <span class="comment">// å¦ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå…è®¸æŒ‡å®šå¾ªç¯è½®è¯¢çš„ç§å­ä½ç½®</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">RoundRobinLoadBalancer</span><span class="params">(ObjectProvider&lt;ServiceInstanceListSupplier&gt; serviceInstanceListSupplierProvider,</span></span><br><span class="line"><span class="params">String serviceId, <span class="type">int</span> seedPosition)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.serviceId = serviceId;</span><br><span class="line"><span class="built_in">this</span>.serviceInstanceListSupplierProvider = serviceInstanceListSupplierProvider;</span><br><span class="line"><span class="built_in">this</span>.position = <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(seedPosition);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;rawtypes&quot;)</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="comment">// è´Ÿè´£æ ¹æ®å¾ªç¯è½®è¯¢ç®—æ³•é€‰æ‹©ä¸€ä¸ªæœåŠ¡å®ä¾‹</span></span><br><span class="line"><span class="keyword">public</span> Mono&lt;Response&lt;ServiceInstance&gt;&gt; <span class="title function_">choose</span><span class="params">(Request request)</span> &#123;</span><br><span class="line"><span class="type">ServiceInstanceListSupplier</span> <span class="variable">supplier</span> <span class="operator">=</span> serviceInstanceListSupplierProvider</span><br><span class="line">.getIfAvailable(NoopServiceInstanceListSupplier::<span class="keyword">new</span>);</span><br><span class="line"><span class="keyword">return</span> supplier.get(request).next()</span><br><span class="line">.map(serviceInstances -&gt; processInstanceResponse(supplier, serviceInstances));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¿™ä¸ªæ–¹æ³•å¤„ç†é€‰æ‹©æœåŠ¡å®ä¾‹åæ”¶åˆ°çš„å“åº”ï¼Œå¹¶åœ¨æœ‰å›è°ƒæ—¶é€šçŸ¥</span></span><br><span class="line"><span class="keyword">private</span> Response&lt;ServiceInstance&gt; <span class="title function_">processInstanceResponse</span><span class="params">(ServiceInstanceListSupplier supplier,</span></span><br><span class="line"><span class="params">List&lt;ServiceInstance&gt; serviceInstances)</span> &#123;</span><br><span class="line">Response&lt;ServiceInstance&gt; serviceInstanceResponse = getInstanceResponse(serviceInstances);</span><br><span class="line"><span class="keyword">if</span> (supplier <span class="keyword">instanceof</span> SelectedInstanceCallback &amp;&amp; serviceInstanceResponse.hasServer()) &#123;</span><br><span class="line">((SelectedInstanceCallback) supplier).selectedServiceInstance(serviceInstanceResponse.getServer());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> serviceInstanceResponse;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è´Ÿè´£æ ¹æ®å¾ªç¯è½®è¯¢ç®—æ³•ä»æä¾›çš„åˆ—è¡¨ä¸­ç”ŸæˆåŒ…å«æ‰€é€‰æœåŠ¡å®ä¾‹çš„å“åº”</span></span><br><span class="line"><span class="keyword">private</span> Response&lt;ServiceInstance&gt; <span class="title function_">getInstanceResponse</span><span class="params">(List&lt;ServiceInstance&gt; instances)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (instances.isEmpty()) &#123;</span><br><span class="line"><span class="keyword">if</span> (log.isWarnEnabled()) &#123;</span><br><span class="line">log.warn(<span class="string">&quot;No servers available for service: &quot;</span> + serviceId);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EmptyResponse</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Ignore the sign bit, this allows pos to loop sequentially from 0 to</span></span><br><span class="line"><span class="comment">// Integer.MAX_VALUE</span></span><br><span class="line"><span class="type">int</span> <span class="variable">pos</span> <span class="operator">=</span> <span class="built_in">this</span>.position.incrementAndGet() &amp; Integer.MAX_VALUE;</span><br><span class="line"><span class="type">ServiceInstance</span> <span class="variable">instance</span> <span class="operator">=</span> instances.get(pos % instances.size());</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultResponse</span>(instance);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºä¸Šé¢ç±»çš„è§£é‡Š:</p><ul><li><p>positionå±æ€§: ä½¿ç”¨äº† AtomicInteger è¿›è¡ŒåŸå­æ“ä½œ,  ä½¿å¤šçº¿ç¨‹æ“ä½œä¹Ÿèƒ½åŒæ­¥</p></li><li><p>æ„é€ å‡½æ•°: ä¸¤ä¸ªçš„åŒºåˆ«åœ¨äºæ˜¯å¦æœ‰<code>seedPosition</code> å¾ªç¯è½®è¯¢çš„èµ·å§‹ä½ç½®,  é™¤å»è¯¥é¡¹,  æ„é€ å™¨çš„ä½œç”¨åœ¨äºåˆå§‹åŒ–æœåŠ¡å®ä¾‹åˆ—è¡¨çš„æä¾›è€…(å³åˆå§‹åŒ–æœåŠ¡å™¨é€‰æ‹©çš„ç§å­)</p></li><li><p>choose:  æ ¹æ®ç®—æ³•é€‰æ‹©åˆé€‚çš„æœåŠ¡å®ä¾‹</p></li><li><p>processInstanceResponse: å¤„ç†é€‰æ‹©æœåŠ¡å®ä¾‹åæ”¶åˆ°çš„å“åº”ï¼Œå¹¶åœ¨æœ‰å›è°ƒæ—¶é€šçŸ¥</p></li><li><p>getInstanceResponse: è´Ÿè´£è½®è¯¢çš„ç®—æ³•</p><p>ä¸Šé¢ä¸‰ä¸ªæ–¹æ³•ä¸ºå±‚çº§è°ƒç”¨ choose -&gt; processInstanceResponse -&gt; getInstanceResponse</p></li><li><p>å¯¹äº62è¡Œçš„è§£é‡Š: <code>&amp; Integer.MAX_VALUE</code>è¿™éƒ¨åˆ†æ˜¯ä¸€ä¸ªä½è¿ç®—ï¼Œå®ƒç¡®ä¿äº†å¦‚æœ position çš„å€¼å¢åŠ åˆ°è¶…è¿‡ Integer.MAX_VALUE æ—¶ï¼Œä¸ä¼šäº§ç”Ÿè´Ÿæ•°ã€‚å…¶ä¸€ï¼Œåœ¨è½®è¯¢ç®—æ³•ä¸­ï¼Œå¦‚æœè®¡æ•°å™¨å˜æˆè´Ÿæ•°ï¼Œé‚£ä¹ˆå–ä½™æ“ä½œå¯èƒ½ä¼šäº§ç”Ÿè´Ÿçš„ç´¢å¼•å€¼ï¼Œè¿™æ˜¯æ— æ•ˆçš„ï¼› å…¶äºŒï¼Œä¹Ÿå¯ä¹Ÿä¿è¯åœ¨ç›¸åŒè§„åˆ™åº•ä¸‹çš„å…¬å¹³æ€§</p></li></ul><h2 id="è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡"><a href="#è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡" class="headerlink" title="è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡"></a>è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡</h2><h3 id="å‰ç½®åˆ†æ"><a href="#å‰ç½®åˆ†æ" class="headerlink" title="å‰ç½®åˆ†æ"></a>å‰ç½®åˆ†æ</h3><p>å¯¹äºè‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥,  è¿½è¸ªä¸Šé¢çš„æ¡ˆä¾‹æ˜¾ç„¶æ˜¯ä¸å¤Ÿçš„,  å½“ç„¶è¿˜æœ‰é…ç½®æ–‡ä»¶éœ€è¦è§£è¯»</p><p>é€šè¿‡æ³¨è§£<code>@LoadBalancerClient</code>è¿½è¸ª  (è¯¥æ³¨è§£ä¸ºè´Ÿè½½å‡è¡¡å®¢æˆ·ç«¯é…ç½® â€”- service-idã€Configuration)</p><p>ç„¶åæ‰¾åˆ°configurationçš„æ³¨é‡Šæœ‰é»˜è®¤é…ç½®åœ¨: <code>LoadBalancerClientConfiguration</code>,  å…¶ä¸­è¿™ä¸ªé‡Œé¢å°±æ ‡æ˜é»˜è®¤ä¸ºRoundRobinLoadBalancer  è½®è¯¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line"><span class="keyword">public</span> ReactorLoadBalancer&lt;ServiceInstance&gt; <span class="title function_">reactorServiceInstanceLoadBalancer</span><span class="params">(Environment environment,</span></span><br><span class="line"><span class="params">                                                                               LoadBalancerClientFactory loadBalancerClientFactory)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> environment.getProperty(LoadBalancerClientFactory.PROPERTY_NAME);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RoundRobinLoadBalancer</span>(</span><br><span class="line">        loadBalancerClientFactory.getLazyProvider(name, ServiceInstanceListSupplier.class), name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆåˆ°æ­¤å¤„,  é…ç½®æ–‡ä»¶ è¿˜æœ‰è½®è¯¢æ–¹æ¡ˆéƒ½äº†è§£äº†,  éœ€è¦è‡ªå®šä¹‰å®ç°ä¹Ÿå°±æ¸…æ¥šäº†: </p><ol><li>ç¼–å†™ä¸€ä¸ª<u>é…ç½®ç±»</u>,  è¿”å›è‡ªå®šä¹‰çš„LoadBalanceç±» </li><li>è‡ªå®šä¹‰çš„LoadBalanceç±» éœ€è¦å®ç°æ¥å£ <u>ReactorServiceInstanceLoadBalancer</u></li><li>åˆ©ç”¨@LoadBalancerClient æŒ‡å®šé…ç½®ç±»ç”Ÿæ•ˆèŒƒå›´(æŒ‡å®šçš„æœåŠ¡)</li></ol><h3 id="ç†è®ºå­˜åœ¨-å®è·µå¼€å§‹"><a href="#ç†è®ºå­˜åœ¨-å®è·µå¼€å§‹" class="headerlink" title="ç†è®ºå­˜åœ¨ å®è·µå¼€å§‹"></a>ç†è®ºå­˜åœ¨ å®è·µå¼€å§‹</h3><h4 id="è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç®—æ³•"><a href="#è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç®—æ³•" class="headerlink" title="è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç®—æ³•-"></a>è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç®—æ³•-</h4><p>é¦–å…ˆå‚è€ƒRoundRobinLoadBalanceråˆ›å»ºä¸€ä¸ªè‡ªå·±çš„LoadBalancer</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyLoadBalancer</span> <span class="keyword">implements</span> <span class="title class_">ReactorServiceInstanceLoadBalancer</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Log</span> <span class="variable">log</span> <span class="operator">=</span> LogFactory.getLog(MyLoadBalancer.class);</span><br><span class="line">    <span class="keyword">final</span> String serviceId;  <span class="comment">// æœåŠ¡id</span></span><br><span class="line">    ObjectProvider&lt;ServiceInstanceListSupplier&gt; serviceInstanceListSupplierProvider; <span class="comment">// æœåŠ¡æä¾›è€…</span></span><br><span class="line"><span class="comment">// å½“å‰ä»…æä¾›ä¸¤ä¸ªå‚æ•°çš„æ„é€ å™¨, æœ‰éœ€è¿½åŠ å±æ€§</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyLoadBalancer</span><span class="params">(ObjectProvider&lt;ServiceInstanceListSupplier&gt; serviceInstanceListSupplierProvider,String serviceId)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.serviceId = serviceId;</span><br><span class="line">        <span class="built_in">this</span>.serviceInstanceListSupplierProvider = serviceInstanceListSupplierProvider;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;rawtypes&quot;)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Response&lt;ServiceInstance&gt;&gt; <span class="title function_">choose</span><span class="params">(Request request)</span> &#123;</span><br><span class="line">        <span class="type">ServiceInstanceListSupplier</span> <span class="variable">supplier</span> <span class="operator">=</span> serviceInstanceListSupplierProvider</span><br><span class="line">                .getIfAvailable(NoopServiceInstanceListSupplier::<span class="keyword">new</span>);</span><br><span class="line">        <span class="keyword">return</span> supplier.get(request).next()</span><br><span class="line">                .map(serviceInstances -&gt; processInstanceResponse(supplier, serviceInstances));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Response&lt;ServiceInstance&gt; <span class="title function_">processInstanceResponse</span><span class="params">(ServiceInstanceListSupplier supplier,</span></span><br><span class="line"><span class="params">                                                              List&lt;ServiceInstance&gt; serviceInstances)</span> &#123;</span><br><span class="line">        Response&lt;ServiceInstance&gt; serviceInstanceResponse = getInstanceResponse(serviceInstances);</span><br><span class="line">        <span class="keyword">if</span> (supplier <span class="keyword">instanceof</span> SelectedInstanceCallback &amp;&amp; serviceInstanceResponse.hasServer()) &#123;</span><br><span class="line">            ((SelectedInstanceCallback) supplier).selectedServiceInstance(serviceInstanceResponse.getServer());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> serviceInstanceResponse;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Response&lt;ServiceInstance&gt; <span class="title function_">getInstanceResponse</span><span class="params">(List&lt;ServiceInstance&gt; instances)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instances.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (log.isWarnEnabled()) &#123;</span><br><span class="line">                log.warn(<span class="string">&quot;No servers available for service: &quot;</span> + serviceId);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EmptyResponse</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è´Ÿè½½å‡è¡¡ç®—æ³•å¤„  (å½“å‰ä»¥ä»…è®¿é—®ä¸€ä¸ªæœåŠ¡ä¸ºä¾‹)</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">pos</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">ServiceInstance</span> <span class="variable">instance</span> <span class="operator">=</span> instances.get(pos);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultResponse</span>(instance);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“å‰è´Ÿè½½å‡è¡¡ç¤ºä¾‹ä»…è®¾ç½®äº†è®¿é—®ä¸€ä¸ªå›ºå®šæœåŠ¡,  å¦‚éœ€ä¿®æ”¹åˆ™ä¿®æ”¹æ­¤å¤„çš„ç®—æ³•å³å¯ (37è¡Œå¤„)</p><p>é…ç½®å®Œåˆšåˆšçš„è´Ÿè½½å‡è¡¡ç®—æ³•éƒ¨åˆ†,  æ¥ä¸‹æ¥éœ€è¦è¯»å–è‡ªå®šä¹‰çš„è´Ÿè½½å‡è¡¡</p><h4 id="é…ç½®ç±»"><a href="#é…ç½®ç±»" class="headerlink" title="é…ç½®ç±»"></a>é…ç½®ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@ConditionalOnDiscoveryEnabled</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyLoadBalancerConfiguration</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="comment">// @ConditionalOnMissingBean  // æ­¤æ³¨è§£å¦‚æœéœ€è¦è‡ªå®šä¹‰å¿…é¡»å¾—å»æ‰</span></span><br><span class="line">    <span class="keyword">public</span> ReactorLoadBalancer&lt;ServiceInstance&gt; <span class="title function_">reactorServiceInstanceLoadBalancer</span><span class="params">(Environment environment,</span></span><br><span class="line"><span class="params">                                                                                   LoadBalancerClientFactory loadBalancerClientFactory)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> environment.getProperty(LoadBalancerClientFactory.PROPERTY_NAME);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyLoadBalancer</span>(</span><br><span class="line">                loadBalancerClientFactory.getLazyProvider(name, ServiceInstanceListSupplier.class), name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æœ€ä¸‹é¢(å³ç¬¬9è¡Œå¤„),  è¿”å›æˆ‘ä»¬åˆšåˆšè‡ªå®šä¹‰çš„è´Ÿè½½å‡è¡¡å®ä¾‹</p><div class="timeline red"><div class="timeline-item headline"><div class="timeline-item-title"><div class="item-circle"><p>100%</p></div></div></div><div class="timeline-item"><div class="timeline-item-title"><div class="item-circle"><p>90%</p></div></div><div class="timeline-item-content"><p>è‡³æ­¤,  è‡ªå®šä¹‰çš„è´Ÿè½½å‡è¡¡å·²ç»å®Œæˆ90%äº†</p></div></div></div><h4 id="é…ç½®é…ç½®ç±»ç”Ÿæ•ˆèŒƒå›´"><a href="#é…ç½®é…ç½®ç±»ç”Ÿæ•ˆèŒƒå›´" class="headerlink" title="é…ç½®é…ç½®ç±»ç”Ÿæ•ˆèŒƒå›´"></a>é…ç½®é…ç½®ç±»ç”Ÿæ•ˆèŒƒå›´</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@LoadBalancerClients(value = &#123;</span></span><br><span class="line"><span class="meta">        @LoadBalancerClient(value = &quot;service-id1&quot;,configuration = MyLoadBalancerConfiguration.class),</span></span><br><span class="line"><span class="meta">        @LoadBalancerClient(value = &quot;service-id2&quot;,configuration = MyLoadBalancerConfiguration.class)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoadApplication</span> &#123;</span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨<code>LoadBalancerClients</code>ä¸­å¯ä»¥é…ç½®å¤šä¸ª<code>LoadBalancerClient</code>,  åœ¨<code>LoadBalancerClient</code>ä¸­æŒ‡å®šæœåŠ¡ä½¿ç”¨æŒ‡å®šçš„è´Ÿè½½å‡è¡¡ç­–ç•¥</p><p>å½“å‰é…ç½®é¡¹ä¸€èˆ¬ç”¨äºå¯åŠ¨ç±»ä¸­</p><div class="tip success"><p>ç»“æŸæ ‡è¯†</p></div><hr><a class="btn-anzhiyu outline green larger" href="/" title="ç‚¹å‡»è·³è½¬åˆ°é¦–é¡µ"><i class="anzhiyufont anzhiyu-icon-circle-arrow-right"></i><span>ç‚¹å‡»è·³è½¬åˆ°é¦–é¡µ</span></a>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æºç åˆ†æ </tag>
            
            <tag> è´Ÿè½½å‡è¡¡ </tag>
            
            <tag> SpringCloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaéƒ¨åˆ†</title>
      <link href="/2023/11/25/Java/"/>
      <url>/2023/11/25/Java/</url>
      
        <content type="html"><![CDATA[<h2 id="JDKåŠ¨æ€ä»£ç†-æ¡ˆä¾‹"><a href="#JDKåŠ¨æ€ä»£ç†-æ¡ˆä¾‹" class="headerlink" title="JDKåŠ¨æ€ä»£ç† æ¡ˆä¾‹"></a>JDKåŠ¨æ€ä»£ç† æ¡ˆä¾‹</h2><p>**éœ€æ±‚: ** ç®€å•çš„å®ç°å¢å¼º(AOP)</p><p><strong>JDKåŠ¨æ€ä»£ç†åªèƒ½ä»£ç†å®ç°äº†æ¥å£çš„ç±»ï¼Œä¸æ”¯æŒå¯¹ç±»çš„ç›´æ¥ä»£ç†</strong></p><p>åœ¨æ­¤æä¾›ä¸€ä¸ªæ¥å£å’Œä¸€ä¸ªå®ç°ç±»,  éœ€è¦å¯¹æ¥å£å®ç°ç±»ä¸­çš„æ–¹æ³•è¿›è¡Œå¢å¼º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Interface</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IHello</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hello</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">bye</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Implement</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloImpl</span> <span class="keyword">implements</span> <span class="title class_">IHello</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">bye</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Bye&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¢å¼ºéƒ¨åˆ†:</p><p>é¦–å…ˆéœ€è¦è‡ªå®šä¹‰ç±»å®ç°<code>InvocationHandler</code>æ¥å£,  å…¶æ¬¡é‡å†™<code>invoke</code>æ–¹æ³•,  é€šè¿‡invokeæ–¹æ³•è¿›è¡Œä»£ç†: æ¡ˆä¾‹å¦‚ä¸‹: </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProxyHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Object target; <span class="comment">// ç›®æ ‡ç±»</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ProxyHandler</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = target; <span class="comment">// $Proxy01: hello()  Bye()</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç”Ÿæˆä»£ç†å¯¹è±¡æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">createProxy</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// JDKä¸­æä¾›äº† Proxyç±», æœ‰ä¸€ä¸ªæ–¹æ³•ä¸“é—¨ç”¨äºæ ¹æ®æ¥å£ç”Ÿæˆä»£ç†ç±»å¯¹è±¡çš„æ–¹æ³•</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">proxy</span> <span class="operator">=</span> Proxy.newProxyInstance(ProxyHandler.class.getClassLoader(),</span><br><span class="line">                target.getClass().getInterfaces(),</span><br><span class="line">                <span class="built_in">this</span>);</span><br><span class="line">        <span class="keyword">return</span> proxy;  <span class="comment">// $Proxy01  Hello()  Bye()</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> proxy ä»£ç†å¯¹è±¡ $Proxy01</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method è°ƒç”¨çš„æ–¹æ³•   hello()</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args æ–¹æ³•çš„å‚æ•°å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">// è§£é‡Š  @Pointcut(&quot;execution(* com.hang..add*(..))&quot;)</span></span><br><span class="line">        <span class="keyword">if</span>(method.getName().equalsIgnoreCase(<span class="string">&quot;hello&quot;</span>))&#123;</span><br><span class="line">            <span class="comment">// å¢å¼º</span></span><br><span class="line">            showTime();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// åˆ©ç”¨åå°„æœºåˆ¶è°ƒç”¨ç›®æ ‡ç±»çš„ç›®æ ‡æ–¹æ³•</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">reflectObj</span> <span class="operator">=</span> method.invoke(target, args); <span class="comment">//  HelloImpl.Hello()   ç›®æ ‡ç±»çš„æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> reflectObj;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¢å¼ºçš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">showTime</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å½“å‰æ—¶é—´ä¸º: &quot;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¯¹äº24-26è¡Œ:  å¯¹äºæ–¹æ³•åä¸º helloè¿›è¡Œå¢å¼º,  æ­¤å¤„ä»¥å‰ç½®å¢å¼ºä¸ºä¾‹,  åœ¨æ–¹æ³•æ‰§è¡Œ(invoke)å‰,  æ‰§è¡Œè‡ªå®šä¹‰æ–¹æ³•(showTime)æ˜¾ç¤ºæ—¶é—´</li></ul><p>æµ‹è¯•æ–¹æ³•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// åœ¨æœ¬åœ°ç”Ÿæˆä»£ç†å¯¹è±¡å­—èŠ‚ç æ–‡ä»¶</span></span><br><span class="line">        System.getProperties().put(<span class="string">&quot;sun.misc.ProxyGenerator.saveGeneratedFiles&quot;</span>,<span class="string">&quot;true&quot;</span>);</span><br><span class="line">        <span class="type">IHello</span> <span class="variable">target</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HelloImpl</span>();  <span class="comment">// ç›®æ ‡ç±»</span></span><br><span class="line">        <span class="type">ProxyHandler</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProxyHandler</span>(target);</span><br><span class="line">        <span class="comment">// ç”Ÿæˆä»£ç†ç±»</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">proxy</span> <span class="operator">=</span> handler.createProxy();</span><br><span class="line">        System.out.println(proxy); <span class="comment">// Proxy0å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">        <span class="type">IHello</span> <span class="variable">obj</span> <span class="operator">=</span> (IHello) proxy;</span><br><span class="line">        obj.hello();  <span class="comment">// $ Proxy0.Hello()</span></span><br><span class="line">        obj.bye();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºå¦‚ä¸‹:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">com.hang.HelloImpl@61bbe9ba</span><br><span class="line">å½“å‰æ—¶é—´ä¸º: Sat Nov 25 10:31:56 SGT 2023</span><br><span class="line">Hello</span><br><span class="line">Bye</span><br></pre></td></tr></table></figure><p>å¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹åˆ°,  åœ¨helloæ–¹æ³•æ‰§è¡Œå‰,  è¾“å‡ºäº†è‡ªå®šä¹‰å¢å¼ºæ–¹æ³•showTime</p><p>æ­¤æ—¶éœ€è¦è§‚å¯Ÿç”Ÿæˆä»£ç†å­—èŠ‚ç ç±»å¯ä»¥åœ¨æµ‹è¯•ä¸­æ·»åŠ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.getProperties().put(<span class="string">&quot;sun.misc.ProxyGenerator.saveGeneratedFiles&quot;</span>,<span class="string">&quot;true&quot;</span>);</span><br></pre></td></tr></table></figure><p>æ·»åŠ è¯¥è¡Œå,  åœ¨å½“å‰Moduleçš„åŒç›®å½•ä¸‹ä¼šç”Ÿæˆæ–‡ä»¶å¤¹ä¸º<code>com.sum.proxy</code> ,æ–‡ä»¶å¤¹å†…ä¼šç”Ÿæˆå­—èŠ‚ç $Proxy0  â€¦ $Proxy20 â€¦  æ•°å­—éƒ¨åˆ†å¯å˜</p><p>ä»¥å½“å‰æ¡ˆä¾‹ç”Ÿæˆçš„å­—èŠ‚ç ä¸ºä¾‹:  ($Proxy0.class)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">$Proxy0</span> <span class="keyword">extends</span> <span class="title class_">Proxy</span> <span class="keyword">implements</span> <span class="title class_">IHello</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m1;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m4;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m3;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m2;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m0;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> $Proxy0(InvocationHandler var1) <span class="keyword">throws</span>  &#123;</span><br><span class="line">        <span class="built_in">super</span>(var1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">bye</span><span class="params">()</span> <span class="keyword">throws</span>  &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>.h.invoke(<span class="built_in">this</span>, m4, (Object[])<span class="literal">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UndeclaredThrowableException</span>(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">hello</span><span class="params">()</span> <span class="keyword">throws</span>  &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>.h.invoke(<span class="built_in">this</span>, m3, (Object[])<span class="literal">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UndeclaredThrowableException</span>(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// çœç•¥equals,toString,hashCodeä¸‰æ–¹æ³•åŒä¸Š(ä¸ºé»˜è®¤ç”Ÿæˆ)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            m1 = Class.forName(<span class="string">&quot;java.lang.Object&quot;</span>).getMethod(<span class="string">&quot;equals&quot;</span>, Class.forName(<span class="string">&quot;java.lang.Object&quot;</span>));</span><br><span class="line">            m4 = Class.forName(<span class="string">&quot;com.hang.IHello&quot;</span>).getMethod(<span class="string">&quot;bye&quot;</span>);</span><br><span class="line">            m3 = Class.forName(<span class="string">&quot;com.hang.IHello&quot;</span>).getMethod(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">            m2 = Class.forName(<span class="string">&quot;java.lang.Object&quot;</span>).getMethod(<span class="string">&quot;toString&quot;</span>);</span><br><span class="line">            m0 = Class.forName(<span class="string">&quot;java.lang.Object&quot;</span>).getMethod(<span class="string">&quot;hashCode&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NoSuchMethodError</span>(var2.getMessage());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NoClassDefFoundError</span>(var3.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>é€šè¿‡è¯¥å­—èŠ‚ç æ–‡ä»¶å¯ä»¥å¾ˆæ˜æ˜¾çš„å‘ç°ä¸€å…±ç”Ÿæˆäº† 5ä¸ª Method  (ä¸¤ä¸ªä¸ºåˆšåˆšå®šä¹‰çš„æ–¹æ³•, ä¸‰ä¸ª(1.equals 2.toString 3.hashCode)ä¸ºé»˜è®¤ç”Ÿæˆçš„)</p></li><li><p>åœ¨ä»£ç å°¾éƒ¨çš„staticéƒ¨åˆ†,  ç”Ÿæˆäº†æ–¹æ³•ä¸Šè¿°çš„5ä¸ªæ–¹æ³•</p></li></ul><p>ä»¥å½“å‰å­—èŠ‚ç æ–‡ä»¶ä¸­çš„ <code>hello()</code>ä¸ºä¾‹  (å› ä¸ºæˆ‘ä»¬å¯¹è¯¥æ–¹æ³•å¢å¼ºäº†):</p><p>è¯¥æ–¹æ³•ä¸»è¦é€»è¾‘ä¸ºæ‰§è¡Œ<code>super.h.invoke(this, m3, (Object[])null);</code></p><ul><li><p>è¯¥æ–¹æ³•å¾ˆæ˜ç¡®å°±æ˜¯è°ƒç”¨çˆ¶ç±»çš„ InvocationHandler</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// the invocation handler for this proxy instance.</span></span><br><span class="line"><span class="keyword">protected</span> InvocationHandler h;</span><br></pre></td></tr></table></figure><p>ç„¶åè°ƒç”¨invoke,  è¿™ä¸ªinvokeä¸å°±æ˜¯æˆ‘ä»¬æ¡ˆä¾‹ä¸­é‡å†™äº†çš„invokeå—?</p></li></ul><p>æ€»ç»“:  é€šè¿‡ä»£ç†æ¥å£å®ç°æ¥å£æ–¹æ³•,  å½“è°ƒç”¨æ—¶æ‰§è¡Œä»£ç†ç±»ä¸­çš„åŒåæ–¹æ³•ç„¶åå›è°ƒåˆ°æˆ‘ä»¬è‡ªå®šä¹‰çš„invoke,  åœ¨è¯¥æ–¹æ³•å†…å¯ä»¥å®ç°å¢å¼º(å‰ç½®,åç½®,ç¯ç»•)</p><h2 id="JDKè°“è¯"><a href="#JDKè°“è¯" class="headerlink" title="JDKè°“è¯"></a>JDKè°“è¯</h2><p>ç›´æ¥ä¸Šæ¡ˆä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; ns= Arrays.asList(<span class="string">&quot;calyee blog&quot;</span>,<span class="string">&quot;cal&quot;</span>,<span class="string">&quot;ccaaalyyyyeeee&quot;</span>);</span><br><span class="line">ArrayList&lt;String&gt; names = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(ns);</span><br><span class="line">Predicate&lt;String&gt; predicate = s -&gt; s.length() &gt; <span class="number">3</span>;  <span class="comment">// è°“è¯</span></span><br><span class="line">names.removeIf(predicate);</span><br></pre></td></tr></table></figure><p>è¿½è¸ªPredicate</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Predicate</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(T t)</span>;</span><br><span class="line">    <span class="comment">// ä»…åˆ—å‡ºä¸€ä¸ª (å…¶ä»–çš„è¿˜æœ‰æ¯”å¦‚æˆ–è¿ç®—)</span></span><br><span class="line">    <span class="keyword">default</span> Predicate&lt;T&gt; <span class="title function_">and</span><span class="params">(Predicate&lt;? <span class="built_in">super</span> T&gt; other)</span> &#123;</span><br><span class="line">        Objects.requireNonNull(other);</span><br><span class="line">        <span class="keyword">return</span> (t) -&gt; test(t) &amp;&amp; other.test(t);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“å‰æ¡ˆä¾‹ä¸º:  ç­›é€‰é•¿åº¦å¤§äº3çš„å¯¹è±¡</p><p>å…¶ä¸­<code>removeIf</code>æ–¹æ³•ä¸ºä¼ å…¥ä¸€ä¸ªè°“è¯å¯¹è±¡,  é€šè¿‡è°“è¯æ¡ä»¶æ„é€ ç­›é€‰æ¡ä»¶,  ç„¶åé‡å¤éå†(ç±»ä¼¼äºæ„é€ if-elseåˆ¤æ–­)</p><p>æ‰€ä»¥:  è°“è¯å·¥å‚å°±æ˜¯ä¸€ä¸ªåˆ¤æ–­</p><h2 id="è‡ªå®šä¹‰å®ç°Xxx"><a href="#è‡ªå®šä¹‰å®ç°Xxx" class="headerlink" title="è‡ªå®šä¹‰å®ç°Xxx"></a>è‡ªå®šä¹‰å®ç°Xxx</h2><div class="tip info"><p>é¢„å®š</p></div>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åº•å±‚ </tag>
            
            <tag> æºç åˆ†æ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringCloud</title>
      <link href="/2023/11/14/SpringCloud/"/>
      <url>/2023/11/14/SpringCloud/</url>
      
        <content type="html"><![CDATA[<div class="tip cogs"><p>å¾®æœåŠ¡ç¯‡ç« </p></div><h1 id="SpringCloud"><a href="#SpringCloud" class="headerlink" title="SpringCloud"></a>SpringCloud</h1><h2 id="å…¥é—¨ç†è®º"><a href="#å…¥é—¨ç†è®º" class="headerlink" title="å…¥é—¨ç†è®º"></a>å…¥é—¨ç†è®º</h2><h3 id="CAPç†è®º"><a href="#CAPç†è®º" class="headerlink" title="CAPç†è®º"></a>CAPç†è®º</h3><p>CAPå³ï¼š</p><ul><li>Consistencyï¼ˆä¸€è‡´æ€§ï¼‰   å¯¹æŸä¸ªæŒ‡å®šçš„å®¢æˆ·ç«¯æ¥è¯´ï¼Œè¯»æ“ä½œä¿è¯èƒ½å¤Ÿè¿”å›æœ€æ–°çš„å†™æ“ä½œç»“æœ</li><li>Availabilityï¼ˆå¯ç”¨æ€§ï¼‰  éæ•…éšœçš„èŠ‚ç‚¹åœ¨åˆç†çš„æ—¶é—´å†…è¿”å›åˆç†çš„å“åº”(ä¸å‡ºç°é”™è¯¯æˆ–è¶…æ—¶)</li><li>Partition toleranceï¼ˆåˆ†åŒºå®¹å¿æ€§ï¼‰  æŸä¸€å—å‡ºç°æ•…éšœä¸å½±å“å…¶å¦å¤–çš„è¿è¡Œ</li></ul><p>ç»å¸¸ç”¨å¾®æœåŠ¡çš„å°ä¼™ä¼´åº”è¯¥çŸ¥é“,  CAPå°±æ˜¯è¯´ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸å¯èƒ½åŒæ—¶æ»¡è¶³Cã€Aã€Pè¿™ä¸‰ä¸ªç‰¹æ€§</p><p>å¯¹äºåˆ†å¸ƒå¼æ¶æ„é¡¹ç›®æ¥è¯´,  ä¸€èˆ¬Pæ˜¯è‚¯å®šæ»¡è¶³çš„,  é‚£ä¹ˆä»…ä»…å‰©ä¸‹Cå’ŒAäº†</p><ul><li>CP:  æ»¡è¶³ä¸€è‡´æ€§å’Œåˆ†åŒºå®¹å¿æ€§ï¼Œç‰ºç‰²å¯ç”¨æ€§ã€‚å½“ç½‘ç»œåˆ†åŒºå‘ç”Ÿæ—¶ï¼Œç³»ç»Ÿåªä¿ç•™ä¸€ä¸ªåˆ†åŒºç»§ç»­æä¾›æœåŠ¡ï¼Œå…¶ä»–åˆ†åŒºä¸å¯ç”¨ï¼Œç›´åˆ°ç½‘ç»œæ¢å¤æ­£å¸¸ã€‚  åº”ç”¨: ZooKeeper, HBase, MongoDB, Redisï¼ˆé›†ç¾¤æ¨¡å¼ï¼‰ç­‰ã€‚è¿™äº›ç³»ç»Ÿé€šå¸¸ç”¨äºéœ€è¦å¼ºä¸€è‡´æ€§çš„åœºæ™¯ï¼Œå¦‚åè°ƒã€é”æœåŠ¡ã€å…ƒæ•°æ®ç®¡ç†ç­‰</li><li>AP:  æ»¡è¶³å¯ç”¨æ€§å’Œåˆ†åŒºå®¹å¿æ€§ï¼Œç‰ºç‰²ä¸€è‡´æ€§ã€‚å½“ç½‘ç»œåˆ†åŒºå‘ç”Ÿæ—¶ï¼Œç³»ç»Ÿä¿æŒæ‰€æœ‰åˆ†åŒºéƒ½å¯ç”¨ï¼Œä½†å¯èƒ½è¿”å›è¿‡æœŸçš„æ•°æ®ï¼Œç›´åˆ°æ•°æ®åŒæ­¥å®Œæˆã€‚   åº”ç”¨: Eureka, Cassandra, CouchDB, DynamoDB, Riak, Redisï¼ˆå“¨å…µæ¨¡å¼ï¼‰ç­‰ã€‚è¿™äº›ç³»ç»Ÿé€šå¸¸ç”¨äºéœ€è¦é«˜å¯ç”¨æ€§å’Œå¯æ‰©å±•æ€§çš„åœºæ™¯ï¼Œå¦‚ç¼“å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—ã€æ–‡æ¡£å­˜å‚¨ç­‰</li></ul><p>Nacosæ”¯æŒAP+CP,  Nacoså¯ä»¥æ ¹æ®é…ç½®æˆ–è€…æœåŠ¡èŠ‚ç‚¹çš„çŠ¶æ€æ¥è¯†åˆ«ä¸ºAPæ¨¡å¼æˆ–CPæ¨¡å¼ï¼Œé»˜è®¤æ˜¯APæ¨¡å¼ã€‚å¦‚æœæ³¨å†ŒNacosçš„clientèŠ‚ç‚¹æ³¨å†Œæ—¶ephemeral&#x3D;trueï¼Œé‚£ä¹ˆNacosé›†ç¾¤å¯¹è¿™ä¸ªclientèŠ‚ç‚¹çš„æ•ˆæœå°±æ˜¯APï¼Œé‡‡ç”¨distroåè®®å®ç°ï¼›è€Œæ³¨å†ŒNacosçš„clientèŠ‚ç‚¹æ³¨å†Œæ—¶ephemeral&#x3D;falseï¼Œé‚£ä¹ˆNacosé›†ç¾¤å¯¹è¿™ä¸ªclientèŠ‚ç‚¹çš„æ•ˆæœå°±æ˜¯CPï¼Œé‡‡ç”¨raftåè®®å®ç°ã€‚</p><h2 id="è¿œç¨‹è°ƒç”¨"><a href="#è¿œç¨‹è°ƒç”¨" class="headerlink" title="è¿œç¨‹è°ƒç”¨"></a>è¿œç¨‹è°ƒç”¨</h2><p>åŸæœ¬æˆ‘ä»¬åªæœ‰ä¸€ä¸ªå•ä½“é¡¹ç›®(é»‘é©¬å•†åŸ),  ç°åœ¨ç”±äºå„ä¸šåŠ¡æ¨¡å—çš„æ‹†åˆ†,  ä»¥è‡³äºåŸæœ¬ç›´æ¥è·¨æ¨¡å—æ³¨å…¥çš„æ–¹æ³•ä¸èƒ½è°ƒç”¨</p><p>åœ¨æ‹†åˆ†çš„æ—¶å€™ï¼Œæˆ‘ä»¬å‘ç°ä¸€ä¸ªé—®é¢˜ï¼šå°±æ˜¯è´­ç‰©è½¦ä¸šåŠ¡ä¸­éœ€è¦æŸ¥è¯¢å•†å“ä¿¡æ¯ï¼Œä½†å•†å“ä¿¡æ¯æŸ¥è¯¢çš„é€»è¾‘å…¨éƒ¨è¿ç§»åˆ°äº†<code>item-service</code>æœåŠ¡ï¼Œå¯¼è‡´æˆ‘ä»¬æ— æ³•æŸ¥è¯¢ã€‚</p><p>æœ€ç»ˆç»“æœå°±æ˜¯æŸ¥è¯¢åˆ°çš„è´­ç‰©è½¦æ•°æ®ä¸å®Œæ•´ï¼Œå› æ­¤è¦æƒ³è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±å¿…é¡»æ”¹é€ å…¶ä¸­çš„ä»£ç ï¼ŒæŠŠåŸæœ¬æœ¬åœ°æ–¹æ³•è°ƒç”¨ï¼Œæ”¹é€ æˆè·¨å¾®æœåŠ¡çš„è¿œç¨‹è°ƒç”¨ï¼ˆRPCï¼Œå³<strong>R</strong>emote <strong>P</strong>roduce <strong>C</strong>allï¼‰</p><p>å› æ­¤ï¼Œç°åœ¨æŸ¥è¯¢è´­ç‰©è½¦åˆ—è¡¨çš„æµç¨‹å˜æˆäº†è¿™æ ·:</p><img src="/2023/11/14/SpringCloud/RPC_1.png" class title="è¿œç¨‹è°ƒç”¨_1"><p>æ­¤æ—¶éœ€è¦å˜åŠ¨çš„ä»£ç æ˜¯è¿™ä¸€æ­¥:(ä¸‹é¢å¸¦-çš„)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleCartItems</span><span class="params">(List&lt;CartVO&gt; vos)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.è·å–å•†å“id</span></span><br><span class="line">    Set&lt;Long&gt; itemIds = vos.stream().map(CartVO::getItemId).collect(Collectors.toSet());</span><br><span class="line">    <span class="comment">// 2.æŸ¥è¯¢å•†å“</span></span><br><span class="line">-    List&lt;ItemDTO&gt; items = itemService.queryItemByIds(itemIds);</span><br><span class="line">    <span class="keyword">if</span> (CollUtils.isEmpty(items)) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.è½¬ä¸º id åˆ° itemçš„map</span></span><br><span class="line">    Map&lt;Long, ItemDTO&gt; itemMap = items.stream().collect(Collectors.toMap(ItemDTO::getId, Function.identity()));</span><br><span class="line">    <span class="comment">// 4.å†™å…¥vo</span></span><br><span class="line">    <span class="keyword">for</span> (CartVO v : vos) &#123;</span><br><span class="line">        <span class="type">ItemDTO</span> <span class="variable">item</span> <span class="operator">=</span> itemMap.get(v.getItemId());</span><br><span class="line">        <span class="keyword">if</span> (item == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        v.setNewPrice(item.getPrice());</span><br><span class="line">        v.setStatus(item.getStatus());</span><br><span class="line">        v.setStock(item.getStock());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ²¡æœ‰ä½¿ç”¨å¾®æœåŠ¡ä¹‹å‰å¹¶æ²¡æœ‰ä½¿ç”¨è¿‡è·¨æœåŠ¡è°ƒç”¨,  åœ¨æ‹†åˆ†é‡åˆ°çš„ç¬¬ä¸€ä¸ªé—®é¢˜å°±æ˜¯:  éœ€è¦åœ¨ä¸€ä¸ªæœåŠ¡è°ƒç”¨å¦å¤–ä¸€ä¸ªæœåŠ¡çš„æ¥å£</p><p>å¦‚ä½•è¿›è¡Œ<strong>è·¨å¾®æœåŠ¡</strong>çš„è¿œç¨‹è°ƒç”¨å‘¢? </p><h3 id="RestTemplate"><a href="#RestTemplate" class="headerlink" title="RestTemplate"></a>RestTemplate</h3><p>Springç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªRestTemplateçš„APIï¼Œå¯ä»¥æ–¹ä¾¿çš„å®ç°Httpè¯·æ±‚çš„å‘é€ã€‚</p><p>ä½¿ç”¨æ­¥éª¤å¦‚ä¸‹:</p><ol><li>æ³¨å…¥RestTemplateåˆ°Springå®¹å™¨</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>å‘èµ·è¿œç¨‹è°ƒç”¨</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;T&gt; ResponseEntity&lt;T&gt; <span class="title function_">exchange</span><span class="params">(</span></span><br><span class="line"><span class="params">String url,   // è¯·æ±‚è·¯å¾„</span></span><br><span class="line"><span class="params">    HttpMethod method,         // è¯·æ±‚æ–¹å¼    (HttpMethod.GET)</span></span><br><span class="line">    <span class="meta">@Nullable</span> HttpEntity&lt;?&gt; requestEntity,<span class="comment">// è¯·æ±‚å®ä½“,å¯ä»¥ä¸ºç©º</span></span><br><span class="line">    Class&lt;T&gt; responseType,     <span class="comment">// è¿”å›å€¼ç±»å‹  (Jsonååºåˆ—åŒ–Classå­—èŠ‚ç å¯¹è±¡)</span></span><br><span class="line">    Map&lt;String,?&gt; uriVariables <span class="comment">// è¯·æ±‚å‚æ•°    (Map.of(&quot;id&quot;,1))</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h4 id="æ„é€ å™¨æ³¨å…¥æ–°ä½“éªŒ"><a href="#æ„é€ å™¨æ³¨å…¥æ–°ä½“éªŒ" class="headerlink" title="æ„é€ å™¨æ³¨å…¥æ–°ä½“éªŒ"></a>æ„é€ å™¨æ³¨å…¥æ–°ä½“éªŒ</h4><p>æŸç±»ä¸­æ³¨å…¥RestTemplate</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> RestTemplate restTemplate;  <span class="comment">// final</span></span><br></pre></td></tr></table></figure><p>ç„¶åä½¿ç”¨lombokä¸­çš„æ³¨è§£<code>@RequiredArgsConstructor</code>å¿…éœ€çš„å‡½æ•°æ„é€ å™¨</p><h4 id="è¿œç¨‹è°ƒç”¨æ”¹é€ åŸä»£ç "><a href="#è¿œç¨‹è°ƒç”¨æ”¹é€ åŸä»£ç " class="headerlink" title="è¿œç¨‹è°ƒç”¨æ”¹é€ åŸä»£ç "></a>è¿œç¨‹è°ƒç”¨æ”¹é€ åŸä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleCartItems</span><span class="params">(List&lt;CartVO&gt; vos)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.è·å–å•†å“id</span></span><br><span class="line">    Set&lt;Long&gt; itemIds = vos.stream().map(CartVO::getItemId).collect(Collectors.toSet());</span><br><span class="line">    <span class="comment">// 2.æŸ¥è¯¢å•†å“</span></span><br><span class="line">    -   <span class="comment">// List&lt;ItemDTO&gt; items = itemService.queryItemByIds(itemIds);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ---------------è¿œç¨‹è°ƒç”¨-------------------- //</span></span><br><span class="line">        <span class="comment">// åˆ©ç”¨RestTemplateå‘èµ·httpè¯·æ±‚,å¾—åˆ°httpçš„å“åº”</span></span><br><span class="line">    ResponseEntity&lt;List&lt;ItemDTO&gt;&gt; response = restTemplate.exchange(</span><br><span class="line">        <span class="string">&quot;http://localhost:8081/items?ids=&#123;ids&#125;&quot;</span>, <span class="comment">// &#123;ids&#125;:å ä½ç¬¦</span></span><br><span class="line">        HttpMethod.GET,</span><br><span class="line">        <span class="literal">null</span>,</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ParameterizedTypeReference</span>&lt;List&lt;ItemDTO&gt;&gt;() &#123;</span><br><span class="line">        &#125;,<span class="comment">// åˆ©ç”¨æ³›å‹, åå°„æ‹¿åˆ°</span></span><br><span class="line">        Map.of(<span class="string">&quot;ids&quot;</span>, CollUtil.join(itemIds, <span class="string">&quot;,&quot;</span>)) <span class="comment">// JDk11ä¸­çš„Map.of,  Hutoolä¸­çš„CollUtilæ‹¼æ¥</span></span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// è§£æå“åº”</span></span><br><span class="line">    <span class="keyword">if</span>(!response.getStatusCode().is2xxSuccessful())&#123; <span class="comment">// ä¸æ˜¯2xxç±»å‹</span></span><br><span class="line">        <span class="comment">// æŸ¥è¯¢å¤±è´¥</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;ItemDTO&gt; body = response.getBody();</span><br><span class="line">    <span class="comment">// ---------------------------------------- //</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (CollUtils.isEmpty(items)) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.è½¬ä¸º id åˆ° itemçš„map</span></span><br><span class="line">    Map&lt;Long, ItemDTO&gt; itemMap = items.stream().collect(Collectors.toMap(ItemDTO::getId, Function.identity()));</span><br><span class="line">    <span class="comment">// 4.å†™å…¥vo</span></span><br><span class="line">    <span class="keyword">for</span> (CartVO v : vos) &#123;</span><br><span class="line">        <span class="type">ItemDTO</span> <span class="variable">item</span> <span class="operator">=</span> itemMap.get(v.getItemId());</span><br><span class="line">        <span class="keyword">if</span> (item == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        v.setNewPrice(item.getPrice());</span><br><span class="line">        v.setStatus(item.getStatus());</span><br><span class="line">        v.setStock(item.getStock());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œ<code>item-service</code>æä¾›äº†æŸ¥è¯¢æ¥å£ï¼Œ<code>cart-service</code>åˆ©ç”¨Httpè¯·æ±‚è°ƒç”¨è¯¥æ¥å£ã€‚å› æ­¤<code>item-service</code>å¯ä»¥ç§°ä¸ºæœåŠ¡çš„<u>æä¾›è€…</u>ï¼Œè€Œ<code>cart-service</code>åˆ™ç§°ä¸ºæœåŠ¡çš„<u>æ¶ˆè´¹è€…</u>æˆ–æœåŠ¡è°ƒç”¨è€…</p><h4 id="å°æ€»ç»“"><a href="#å°æ€»ç»“" class="headerlink" title="å°æ€»ç»“"></a>å°æ€»ç»“</h4><p>å¦‚ä½•æ‹†åˆ†ï¼Ÿ</p><ul><li>é¦–å…ˆè¦åšåˆ°é«˜å†…èšã€ä½è€¦åˆ</li><li>ä»æ‹†åˆ†æ–¹å¼æ¥è¯´ï¼Œæœ‰æ¨ªå‘æ‹†åˆ†å’Œçºµå‘æ‹†åˆ†ä¸¤ç§ã€‚çºµå‘å°±æ˜¯æŒ‰ç…§ä¸šåŠ¡åŠŸèƒ½æ¨¡å—ï¼Œæ¨ªå‘åˆ™æ˜¯æ‹†åˆ†é€šç”¨æ€§ä¸šåŠ¡ï¼Œæé«˜å¤ç”¨æ€§</li></ul><p>æœåŠ¡æ‹†åˆ†ä¹‹åï¼Œä¸å¯é¿å…çš„ä¼šå‡ºç°è·¨å¾®æœåŠ¡çš„ä¸šåŠ¡ï¼Œæ­¤æ—¶å¾®æœåŠ¡ä¹‹é—´å°±éœ€è¦è¿›è¡Œè¿œç¨‹è°ƒç”¨ã€‚å¾®æœåŠ¡ä¹‹é—´çš„è¿œç¨‹è°ƒç”¨è¢«ç§°ä¸ºRPCï¼Œå³è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ã€‚RPCçš„å®ç°æ–¹å¼æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ï¼š</p><ul><li>åŸºäºHttpåè®®</li><li>åŸºäºDubboåè®®</li></ul><p>æ¡ˆä¾‹ä¸­ä½¿ç”¨çš„æ˜¯Httpæ–¹å¼ï¼Œè¿™ç§æ–¹å¼ä¸å…³å¿ƒæœåŠ¡æä¾›è€…çš„å…·ä½“æŠ€æœ¯å®ç°ï¼Œåªè¦å¯¹å¤–æš´éœ²Httpæ¥å£å³å¯ï¼Œæ›´ç¬¦åˆå¾®æœåŠ¡çš„éœ€è¦ã€‚</p><p>Javaå‘é€httpè¯·æ±‚å¯ä»¥ä½¿ç”¨Springæä¾›çš„RestTemplateï¼Œä½¿ç”¨çš„åŸºæœ¬æ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li>æ³¨å†ŒRestTemplateåˆ°Springå®¹å™¨</li><li>è°ƒç”¨RestTemplateçš„APIå‘é€è¯·æ±‚ï¼Œå¸¸è§æ–¹æ³•æœ‰ï¼š<ul><li>getForObjectï¼šå‘é€Getè¯·æ±‚å¹¶è¿”å›æŒ‡å®šç±»å‹å¯¹è±¡</li><li>PostForObjectï¼šå‘é€Postè¯·æ±‚å¹¶è¿”å›æŒ‡å®šç±»å‹å¯¹è±¡</li><li>putï¼šå‘é€PUTè¯·æ±‚</li><li>deleteï¼šå‘é€Deleteè¯·æ±‚</li><li>exchangeï¼šå‘é€ä»»æ„ç±»å‹è¯·æ±‚ï¼Œè¿”å›ResponseEntity</li></ul></li></ul><p>å¯¹äºåˆšåˆšæ¡ˆä¾‹çš„è¿œç¨‹è°ƒç”¨æ–¹å¼,  å›ºå®šIPå’Œç«¯å£,  è®¿é—®å›ºå®šçš„æœåŠ¡,  é‚£ä¹ˆç°åœ¨å‡ºç°é—®é¢˜æœ‰:  1)å‡å¦‚å›ºå®šè®¿é—®çš„æœåŠ¡å™¨å®•æœºäº†æ€ä¹ˆåŠ  2)å‡å¦‚ä½¿ç”¨å¤šæœåŠ¡,é‚£ä¹ˆè¯¥æ€ä¹ˆå»æŒ‡å®šè®¿é—®æœåŠ¡å‘¢  3)å¦‚æœå¹¶å‘å¤ªé«˜ï¼Œ<code>item-service</code>ä¸´æ—¶å¤šéƒ¨ç½²äº†Nå°å®ä¾‹ï¼Œ<code>cart-service</code>å¦‚ä½•çŸ¥é“æ–°å®ä¾‹çš„åœ°å€</p><h2 id="NacosæœåŠ¡æ³¨å†Œå’Œå‘ç°"><a href="#NacosæœåŠ¡æ³¨å†Œå’Œå‘ç°" class="headerlink" title="NacosæœåŠ¡æ³¨å†Œå’Œå‘ç°"></a>NacosæœåŠ¡æ³¨å†Œå’Œå‘ç°</h2><h3 id="æ³¨å†Œä¸­å¿ƒåŸç†"><a href="#æ³¨å†Œä¸­å¿ƒåŸç†" class="headerlink" title="æ³¨å†Œä¸­å¿ƒåŸç†"></a>æ³¨å†Œä¸­å¿ƒåŸç†</h3><p>åœ¨å¾®æœåŠ¡è¿œç¨‹è°ƒç”¨çš„è¿‡ç¨‹ä¸­ï¼ŒåŒ…æ‹¬ä¸¤ä¸ªè§’è‰²ï¼š</p><ul><li>æœåŠ¡æä¾›è€…ï¼šæä¾›æ¥å£ä¾›å…¶å®ƒå¾®æœåŠ¡è®¿é—®ï¼Œæ¯”å¦‚<code>item-service</code></li><li>æœåŠ¡æ¶ˆè´¹è€…ï¼šè°ƒç”¨å…¶å®ƒå¾®æœåŠ¡æä¾›çš„æ¥å£ï¼Œæ¯”å¦‚<code>cart-service</code></li></ul><p>åœ¨å¤§å‹å¾®æœåŠ¡é¡¹ç›®ä¸­ï¼ŒæœåŠ¡æä¾›è€…çš„æ•°é‡ä¼šéå¸¸å¤šï¼Œä¸ºäº†ç®¡ç†è¿™äº›æœåŠ¡å°±å¼•å…¥äº†<strong>æ³¨å†Œä¸­å¿ƒ</strong>çš„æ¦‚å¿µã€‚</p><p>æ³¨å†Œæµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>æœåŠ¡å¯åŠ¨æ—¶å°±ä¼šæ³¨å†Œè‡ªå·±çš„æœåŠ¡ä¿¡æ¯ï¼ˆæœåŠ¡åã€IPã€ç«¯å£ï¼‰åˆ°æ³¨å†Œä¸­å¿ƒ</li><li>è°ƒç”¨è€…å¯ä»¥ä»æ³¨å†Œä¸­å¿ƒè®¢é˜…æƒ³è¦çš„æœåŠ¡ï¼Œè·å–æœåŠ¡å¯¹åº”çš„å®ä¾‹åˆ—è¡¨ï¼ˆ1ä¸ªæœåŠ¡å¯èƒ½å¤šå®ä¾‹éƒ¨ç½²ï¼‰</li><li>è°ƒç”¨è€…è‡ªå·±å¯¹å®ä¾‹åˆ—è¡¨è´Ÿè½½å‡è¡¡ï¼ŒæŒ‘é€‰ä¸€ä¸ªå®ä¾‹</li><li>è°ƒç”¨è€…å‘è¯¥å®ä¾‹å‘èµ·è¿œç¨‹è°ƒç”¨</li></ul><p>å½“æœåŠ¡æä¾›è€…çš„å®ä¾‹å®•æœºæˆ–è€…å¯åŠ¨æ–°å®ä¾‹æ—¶ï¼Œè°ƒç”¨è€…å¦‚ä½•å¾—çŸ¥å‘¢ï¼Ÿ</p><ul><li>æœåŠ¡æä¾›è€…ä¼šå®šæœŸå‘æ³¨å†Œä¸­å¿ƒå‘é€è¯·æ±‚ï¼ŒæŠ¥å‘Šè‡ªå·±çš„å¥åº·çŠ¶æ€ï¼ˆå¿ƒè·³è¯·æ±‚ï¼‰</li><li>å½“æ³¨å†Œä¸­å¿ƒé•¿æ—¶é—´æ”¶ä¸åˆ°æä¾›è€…çš„å¿ƒè·³æ—¶ï¼Œä¼šè®¤ä¸ºè¯¥å®ä¾‹å®•æœºï¼Œå°†å…¶ä»æœåŠ¡çš„å®ä¾‹åˆ—è¡¨ä¸­å‰”é™¤</li><li>å½“æœåŠ¡æœ‰æ–°å®ä¾‹å¯åŠ¨æ—¶ï¼Œä¼šå‘é€æ³¨å†ŒæœåŠ¡è¯·æ±‚ï¼Œå…¶ä¿¡æ¯ä¼šè¢«è®°å½•åœ¨æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡å®ä¾‹åˆ—è¡¨</li><li>å½“æ³¨å†Œä¸­å¿ƒæœåŠ¡åˆ—è¡¨å˜æ›´æ—¶ï¼Œä¼šä¸»åŠ¨é€šçŸ¥å¾®æœåŠ¡ï¼Œæ›´æ–°æœ¬åœ°æœåŠ¡åˆ—è¡¨</li></ul><h3 id="Nacosæ³¨å†Œä¸­å¿ƒé…ç½®"><a href="#Nacosæ³¨å†Œä¸­å¿ƒé…ç½®" class="headerlink" title="Nacosæ³¨å†Œä¸­å¿ƒé…ç½®"></a>Nacosæ³¨å†Œä¸­å¿ƒé…ç½®</h3><p>Nacoså®˜ç½‘  <a href="https://nacos.io/zh-cn/docs/what-is-nacos.html">Nacos</a></p><p>å¼€é—¨è§å±±</p><h4 id="åœ¨Windowsæœ¬åœ°"><a href="#åœ¨Windowsæœ¬åœ°" class="headerlink" title="åœ¨Windowsæœ¬åœ°"></a>åœ¨Windowsæœ¬åœ°</h4><ol><li><p>å­˜å‚¨Nacosæ•°æ®,  é¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨MySQLä¸­åˆ›å»ºè¡¨nacos,  SQLè„šæœ¬åœ¨<code>conf</code>ç›®å½•ä¸‹æ‰¾åˆ°åˆå§‹åŒ–è„šæœ¬<code>nacos-mysql.sql</code>, ç„¶åå¯¼å…¥å³å¯</p></li><li><p>ä¿®æ”¹<code>nacos</code>çš„<code>application.properties</code>é…ç½®æ–‡ä»¶,  è®¾ç½®æ•°æ®åº“è¿æ¥ä¸ºMySQL</p></li></ol><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#*************** Config Module Related Configurations ***************#</span></span><br><span class="line"><span class="comment">### If use MySQL as datasource:</span></span><br><span class="line"><span class="attr">spring.datasource.platform</span>=<span class="string">mysql</span></span><br><span class="line"><span class="comment"># spring.sql.init.platform=mysql</span></span><br><span class="line"><span class="comment">### Count of DB:</span></span><br><span class="line"><span class="attr">db.num</span>=<span class="string">1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">### Connect URL of DB:</span></span><br><span class="line"><span class="attr">db.url.0</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/nacos?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line"><span class="attr">db.user.0</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">db.password.0</span>=<span class="string">root</span></span><br><span class="line"><span class="comment"># ä¸‹é¢è¿˜æœ‰ä¸€ä¸ªç§˜é’¥å¯ä»¥ä¿®æ”¹,ç”¨äºé‰´æƒ</span></span><br></pre></td></tr></table></figure><ol start="3"><li>å•æœºå¯åŠ¨æŒ‡ä»¤: <code>startup.cmd -m standalone  </code>, æˆ–è€…åœ¨<code>startup.cmd</code>æ–‡ä»¶ä¸­<code>set MODE=&quot;standalone&quot;</code></li></ol><h4 id="åœ¨Dockeréƒ¨ç½²"><a href="#åœ¨Dockeréƒ¨ç½²" class="headerlink" title="åœ¨Dockeréƒ¨ç½²"></a>åœ¨Dockeréƒ¨ç½²</h4><ol><li>å­˜å‚¨Nacosæ•°æ®,  é¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨MySQLä¸­åˆ›å»ºè¡¨nacos,  SQLè„šæœ¬åœ¨<code>conf</code>ç›®å½•ä¸‹æ‰¾åˆ°åˆå§‹åŒ–è„šæœ¬<code>nacos-mysql.sql</code>, ç„¶åå¯¼å…¥å³å¯</li><li>åˆ›å»ºæŒ‚è½½<code>conf</code>å’Œ<code>logs</code>ç›®å½•</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /idata/nacos/logs/                      <span class="comment">#æ–°å»ºlogsç›®å½•</span></span><br><span class="line"><span class="built_in">mkdir</span> -p /idata/nacos/conf/<span class="comment">#æ–°å»ºconfç›®å½•</span></span><br></pre></td></tr></table></figure><ol start="3"><li>åˆ›å»ºå®¹å™¨</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 8848:8848 --name nacos -d nacos/nacos-server</span><br></pre></td></tr></table></figure><ol start="4"><li>å¯åŠ¨å®¹å™¨</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">docker run -d</span><br><span class="line">--name nacos </span><br><span class="line">-p 8848:8848  </span><br><span class="line">-p 9848:9848 </span><br><span class="line">-p 9849:9849</span><br><span class="line">--privileged=<span class="literal">true</span></span><br><span class="line">-e JVM_XMS=256m</span><br><span class="line">-e JVM_XMX=256m</span><br><span class="line">-e MODE=standalone</span><br><span class="line">-v /idata/nacos/logs/:/home/nacos/logs</span><br><span class="line">-v /idata/nacos/conf/:/home/nacos/conf/</span><br><span class="line">--restart=always</span><br><span class="line">nacos/nacos-server</span><br></pre></td></tr></table></figure><p>-e JVM_XMS&#x3D;256m ï¼š ä¸ºjvmå¯åŠ¨æ—¶åˆ†é…çš„å†…å­˜</p><p>-e JVM_XMX&#x3D;256m ï¼š ä¸ºjvmè¿è¡Œè¿‡ç¨‹ä¸­åˆ†é…çš„æœ€å¤§å†…å­˜</p><p><strong>æ³¨æ„äº‹é¡¹</strong></p><p>éœ€è¦åœ¨é˜²ç«å¢™å¼€æ”¾ç›¸å…³ç«¯å£ï¼Œå¦‚æœä½ æ˜¯äº‘æœåŠ¡å™¨ï¼Œå¼€æ”¾å®‰å…¨ç»„ï¼Œä¸‹é¢æä¾›ç›¸å…³è¯­å¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## å¼€æ”¾ç«¯å£8848 9848 9849</span></span><br><span class="line">firewall-cmd --zone=public --add-port=8848/tcp --permanent</span><br><span class="line">firewall-cmd --zone=public --add-port=9848/tcp --permanent</span><br><span class="line">firewall-cmd --zone=public --add-port=9849/tcp --permanent</span><br><span class="line"></span><br><span class="line"><span class="comment">## é‡å¯é˜²ç«å¢™</span></span><br><span class="line">firewall-cmd --reload</span><br><span class="line"></span><br><span class="line"><span class="comment">## æŸ¥çœ‹æ‰€æœ‰å¼€å¯çš„ç«¯å£</span></span><br><span class="line">firewall-cmd --zone=public --list-ports</span><br></pre></td></tr></table></figure><ol start="5"><li>è·Ÿåœ¨Windowsé…ç½®ä¸€æ ·,  è¿›å…¥Nacosé…ç½®</li></ol><h3 id="æœåŠ¡æ³¨å†Œ"><a href="#æœåŠ¡æ³¨å†Œ" class="headerlink" title="æœåŠ¡æ³¨å†Œ"></a>æœåŠ¡æ³¨å†Œ</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŠŠæœåŠ¡æ³¨å†Œåˆ°Nacosï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li>å¼•å…¥ä¾èµ–</li><li>é…ç½®Nacosåœ°å€</li><li>é‡å¯</li></ul><h4 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h4><p>åœ¨éœ€è¦æœåŠ¡æ³¨å†Œçš„<code>pom.xml</code>ä¸­æ·»åŠ ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--nacos æœåŠ¡æ³¨å†Œå‘ç°--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="é…ç½®Nacos"><a href="#é…ç½®Nacos" class="headerlink" title="é…ç½®Nacos"></a>é…ç½®Nacos</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">item-service</span> <span class="comment"># æœåŠ¡åç§°</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span> <span class="comment"># nacosåœ°å€</span></span><br></pre></td></tr></table></figure><h4 id="å¯åŠ¨æœåŠ¡å®ä¾‹"><a href="#å¯åŠ¨æœåŠ¡å®ä¾‹" class="headerlink" title="å¯åŠ¨æœåŠ¡å®ä¾‹"></a>å¯åŠ¨æœåŠ¡å®ä¾‹</h4><p>åœ¨IDEAå¯ä»¥å¯åŠ¨å¤šä¸ªå®ä¾‹,  å¤åˆ¶ä¸€ä»½å¯åŠ¨é…ç½®ç„¶ååœ¨VM Optionsä¸­é…ç½®å…¶ä»–ç«¯å£å³å¯(åœ¨åŒä¸€å°æœºå™¨ä¸Š)</p><p>ç„¶åå¯åŠ¨,  ç™»å½•nacoså°±å¯ä»¥çœ‹åˆ°æœåŠ¡ä¸Šçº¿</p><h3 id="æœåŠ¡å‘ç°"><a href="#æœåŠ¡å‘ç°" class="headerlink" title="æœåŠ¡å‘ç°"></a>æœåŠ¡å‘ç°</h3><p>æœåŠ¡çš„æ¶ˆè´¹è€…è¦å»nacosè®¢é˜…æœåŠ¡ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯æœåŠ¡å‘ç°ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li>å¼•å…¥ä¾èµ–</li><li>é…ç½®Nacosåœ°å€</li><li>å‘ç°å¹¶è°ƒç”¨æœåŠ¡</li></ul><p>æœåŠ¡å‘ç°é™¤äº†è¦å¼•å…¥nacosä¾èµ–ä»¥å¤–ï¼Œç”±äºè¿˜éœ€è¦è´Ÿè½½å‡è¡¡ï¼Œå› æ­¤è¦å¼•å…¥SpringCloudæä¾›çš„LoadBalancerä¾èµ–ã€‚</p><p>æˆ‘ä»¬åœ¨æ¨¡å—ä¸­å¯¼å…¥ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--nacos æœåŠ¡æ³¨å†Œå‘ç°--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ï¼Œè¿™é‡ŒNacosçš„ä¾èµ–äºæœåŠ¡æ³¨å†Œæ—¶ä¸€è‡´ï¼Œè¿™ä¸ªä¾èµ–ä¸­åŒæ—¶åŒ…å«äº†æœåŠ¡æ³¨å†Œå’Œå‘ç°çš„åŠŸèƒ½ã€‚å› ä¸ºä»»ä½•ä¸€ä¸ªå¾®æœåŠ¡éƒ½å¯ä»¥è°ƒç”¨åˆ«äººï¼Œä¹Ÿå¯ä»¥è¢«åˆ«äººè°ƒç”¨ï¼Œå³å¯ä»¥æ˜¯è°ƒç”¨è€…ï¼Œä¹Ÿå¯ä»¥æ˜¯æä¾›è€…ã€‚</p><p>å› æ­¤ï¼Œç­‰ä¸€ä¼šå„¿<code>cart-service</code>æ¨¡å—å¯åŠ¨ï¼ŒåŒæ ·ä¼šæ³¨å†Œåˆ°Nacos</p><h4 id="é…ç½®Nacosåœ°å€"><a href="#é…ç½®Nacosåœ°å€" class="headerlink" title="é…ç½®Nacosåœ°å€"></a>é…ç½®Nacosåœ°å€</h4><p>åœ¨<code>cart-service</code>çš„<code>application.yml</code>ä¸­æ·»åŠ nacosåœ°å€é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span> <span class="comment"># nacosåœ°å€</span></span><br></pre></td></tr></table></figure><h4 id="å‘ç°å¹¶è°ƒç”¨æœåŠ¡-è´Ÿè½½å‡è¡¡"><a href="#å‘ç°å¹¶è°ƒç”¨æœåŠ¡-è´Ÿè½½å‡è¡¡" class="headerlink" title="å‘ç°å¹¶è°ƒç”¨æœåŠ¡(è´Ÿè½½å‡è¡¡)"></a>å‘ç°å¹¶è°ƒç”¨æœåŠ¡(è´Ÿè½½å‡è¡¡)</h4><p>å¯¹äºå‘ç°æ³¨å†Œçš„æœåŠ¡éœ€è¦åœ¨å¯åŠ¨ç±»ä¸ŠåŠ æ³¨è§£<code>@EnableDiscoveryClient</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DiscoveryApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(DiscoveryApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼ŒæœåŠ¡è°ƒç”¨è€…<code>cart-service</code>å°±å¯ä»¥å»è®¢é˜…<code>item-service</code>æœåŠ¡äº†ã€‚ä¸è¿‡item-serviceæœ‰å¤šä¸ªå®ä¾‹ï¼Œè€ŒçœŸæ­£å‘èµ·è°ƒç”¨æ—¶åªéœ€è¦çŸ¥é“ä¸€ä¸ªå®ä¾‹çš„åœ°å€ã€‚</p><p>å› æ­¤ï¼ŒæœåŠ¡è°ƒç”¨è€…å¿…é¡»åˆ©ç”¨è´Ÿè½½å‡è¡¡çš„ç®—æ³•ï¼Œä»å¤šä¸ªå®ä¾‹ä¸­æŒ‘é€‰ä¸€ä¸ªå»è®¿é—®ã€‚å¸¸è§çš„è´Ÿè½½å‡è¡¡ç®—æ³•æœ‰ï¼š</p><ul><li>éšæœº</li><li>è½®è¯¢</li><li>IPçš„hash</li><li>æœ€è¿‘æœ€å°‘è®¿é—®</li><li>â€¦</li></ul><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©æœ€ç®€å•çš„éšæœºè´Ÿè½½å‡è¡¡ã€‚</p><p>å¦å¤–ï¼ŒæœåŠ¡å‘ç°éœ€è¦ç”¨åˆ°ä¸€ä¸ªå·¥å…·ï¼ŒDiscoveryClientï¼ŒSpringCloudå·²ç»å¸®æˆ‘ä»¬è‡ªåŠ¨è£…é…ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ³¨å…¥ä½¿ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> DiscoveryClient discoveryClient; <span class="comment">// æ„é€ å™¨æ³¨å…¥</span></span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå¯¹äºä¹‹å‰å›ºå®šæœåŠ¡è€…çš„çš„IPæ“ä½œè¿›è¡Œä¿®æ”¹,  é€šè¿‡DiscoveryClientå‘ç°æœåŠ¡å®ä¾‹åˆ—è¡¨ï¼Œç„¶åé€šè¿‡è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œé€‰æ‹©ä¸€ä¸ªå®ä¾‹å»è°ƒç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> DiscoveryClient discoveryClient;  <span class="comment">// æ„é€ å™¨æ³¨å…¥</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleCartItems</span><span class="params">(List&lt;CartVO&gt; vos)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.è·å–å•†å“id</span></span><br><span class="line">        Set&lt;Long&gt; itemIds = vos.stream().map(CartVO::getItemId).collect(Collectors.toSet());</span><br><span class="line">    <span class="comment">// -------------------------åˆ’æ—¶ä»£çš„æ”¹å˜------------------------- // </span></span><br><span class="line">        <span class="comment">// 2.æŸ¥è¯¢å•†å“</span></span><br><span class="line">        <span class="comment">// 2.1 æ ¹æ®æœåŠ¡åç§°è·å–æœåŠ¡çš„å®ä¾‹åˆ—è¡¨</span></span><br><span class="line">        List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances(<span class="string">&quot;cart-service&quot;</span>); <span class="comment">// æœåŠ¡åç§°</span></span><br><span class="line">        <span class="keyword">if</span> (CollUtils.isEmpty(instances)) &#123;</span><br><span class="line">            <span class="comment">// æŸ¥è¯¢å¤±è´¥,ç›´æ¥ç»“æŸ</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2.2 è´Ÿè½½å‡è¡¡,ä»å®ä¾‹ä¸­æŒ‘é€‰ä¸€ä¸ªå®ä¾‹ (éšæœºæŒ‘é€‰)</span></span><br><span class="line">        <span class="type">ServiceInstance</span> <span class="variable">serviceInstance</span> <span class="operator">=</span> instances.get(RandomUtil.randomInt(instances.size()));</span><br><span class="line">        <span class="comment">// 2.3 åˆ©ç”¨RestTemplateå‘èµ·httpè¯·æ±‚,å¾—åˆ°httpå“åº”</span></span><br><span class="line">        ResponseEntity&lt;List&lt;ItemDTO&gt;&gt; response = restTemplate.exchange(</span><br><span class="line">                serviceInstance.getUri() + <span class="string">&quot;/items?ids=&#123;ids&#125;&quot;</span>, <span class="comment">// æ‹¼æ¥å ä½ç¬¦</span></span><br><span class="line">   <span class="comment">// -------------------------ä»£ç ä¿®æ”¹èŒƒå›´end----------------------- // </span></span><br><span class="line">                HttpMethod.GET,</span><br><span class="line">                <span class="literal">null</span>,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ParameterizedTypeReference</span>&lt;List&lt;ItemDTO&gt;&gt;() &#123;</span><br><span class="line">                &#125;,<span class="comment">// åˆ©ç”¨æ³›å‹, åå°„æ‹¿åˆ°</span></span><br><span class="line">                Map.of(<span class="string">&quot;ids&quot;</span>, CollUtil.join(itemIds, <span class="string">&quot;,&quot;</span>)) <span class="comment">// JDk11ä¸­çš„Map.of,  Hutoolä¸­çš„CollUtilæ‹¼æ¥</span></span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">if</span> (!response.getStatusCode().is2xxSuccessful()) &#123; <span class="comment">// ä¸æ˜¯2xxç±»å‹</span></span><br><span class="line">            <span class="comment">// æŸ¥è¯¢å¤±è´¥</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;ItemDTO&gt; items = response.getBody();</span><br><span class="line"><span class="comment">// ç•¥</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶åœ¨swaggerè¿›è¡Œæµ‹è¯•,  å½“å‰æµ‹è¯•å»ºç«‹åœ¨æˆ‘ä»¬ä¸€ä¸ªæ¨¡å—å¼€å¯å¤šä¸ªæœåŠ¡çš„æƒ…å†µä¸‹,  é€šè¿‡å‘å¤šæ¬¡è¯·æ±‚,  åå°æ§åˆ¶å°å‡æœ‰æ—¥å¿—è¾“å‡ºä¿¡æ¯,  è¯´æ˜è´Ÿè½½å‡è¡¡èµ·ä½œç”¨äº†</p><p>å‡å¦‚ç°åœ¨æœ‰æœåŠ¡æŒ‚äº†(æ€»å…±æœåŠ¡: 1.<code>ItemApplication</code>   2.<code>ItemApplication2</code>),  2æœåŠ¡æŒ‚äº†,  å†æ¬¡æµ‹è¯•å‘ç°SpringCloudè‡ªåŠ¨æ„ŸçŸ¥åˆ°äº†,  æ­¤æ—¶è¯·æ±‚å…¨éƒ¨æ‰“åœ¨æœåŠ¡1ä¸Š</p><p>å¯¹äºä¸Šè¿°è´Ÿè½½å‡è¡¡æ–¹æ¡ˆä¸ºæ‰‹å†™çš„éšæœºè´Ÿè½½å‡è¡¡ï¼Œé™¤äº†è¯¥æ–¹æ¡ˆè¿˜æœ‰åŸºäºåŸç”Ÿçš„<code>RestTemplate</code>æ–¹æ¡ˆï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@LoadBalanced</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> RestTemplcate <span class="title function_">restTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é€šè¿‡åŸç”Ÿçš„RestTemplcateåœ¨Springå®¹å™¨ä¸­æ³¨å†ŒBeanï¼Œå¹¶ä¸”åœ¨Beanä¸Šé¢åŠ æ³¨è§£<code>@LoadBalanced</code>æ¥å®ç°è´Ÿè½½å‡è¡¡,  å¯¹äºå½“å‰æ–¹æ¡ˆæˆ‘ä»¬éœ€è¦æä¾›ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--LoadBalanced--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-loadbalancer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> DiscoveryClient discoveryClient;  <span class="comment">// æ„é€ å™¨æ³¨å…¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1 æ ¹æ®æœåŠ¡åç§°è·å–æœåŠ¡çš„å®ä¾‹åˆ—è¡¨</span></span><br><span class="line">List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances(<span class="string">&quot;cart-service&quot;</span>); <span class="comment">// æœåŠ¡åç§°</span></span><br><span class="line"><span class="comment">// 2 è´Ÿè½½å‡è¡¡,ä»å®ä¾‹ä¸­æŒ‘é€‰ä¸€ä¸ªå®ä¾‹ (éšæœºæŒ‘é€‰)</span></span><br><span class="line"><span class="type">ServiceInstance</span> <span class="variable">serviceInstance</span> <span class="operator">=</span> instances.get(RandomUtil.randomInt(instances.size()));</span><br><span class="line"><span class="comment">// 3 è·å–å®ä¾‹ç«¯å£å’ŒIP</span></span><br><span class="line"><span class="type">URI</span> <span class="variable">uri</span> <span class="operator">=</span> serviceInstance.getUri();</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><h2 id="OpenFeignè¿œç¨‹è°ƒç”¨"><a href="#OpenFeignè¿œç¨‹è°ƒç”¨" class="headerlink" title="OpenFeignè¿œç¨‹è°ƒç”¨"></a>OpenFeignè¿œç¨‹è°ƒç”¨</h2><p>åœ¨ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬åˆ©ç”¨Nacoså®ç°äº†æœåŠ¡çš„æ²»ç†ï¼Œåˆ©ç”¨RestTemplateå®ç°äº†æœåŠ¡çš„è¿œç¨‹è°ƒç”¨ã€‚ä½†æ˜¯è¿œç¨‹è°ƒç”¨çš„ä»£ç å¤ªå¤æ‚äº†(å¦‚ä¸‹code)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2.1 æ ¹æ®æœåŠ¡åç§°è·å–æœåŠ¡çš„å®ä¾‹åˆ—è¡¨</span></span><br><span class="line">List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances(<span class="string">&quot;item-service&quot;</span>); <span class="comment">// æœåŠ¡åç§°</span></span><br><span class="line"><span class="keyword">if</span> (CollUtils.isEmpty(instances)) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 2.2 è´Ÿè½½å‡è¡¡,ä»å®ä¾‹ä¸­æŒ‘é€‰ä¸€ä¸ªå®ä¾‹ (éšæœºæŒ‘é€‰)</span></span><br><span class="line"><span class="type">ServiceInstance</span> <span class="variable">serviceInstance</span> <span class="operator">=</span> instances.get(RandomUtil.randomInt(instances.size()));</span><br><span class="line"><span class="comment">// 2.3 åˆ©ç”¨RestTemplateå‘èµ·httpè¯·æ±‚,å¾—åˆ°httpå“åº”</span></span><br><span class="line">ResponseEntity&lt;List&lt;ItemDTO&gt;&gt; response = restTemplate.exchange(</span><br><span class="line">    serviceInstance.getUri() + <span class="string">&quot;/items?ids=&#123;ids&#125;&quot;</span>, <span class="comment">// æ‹¼æ¥å ä½ç¬¦</span></span><br><span class="line">    HttpMethod.GET,</span><br><span class="line">    <span class="literal">null</span>,</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ParameterizedTypeReference</span>&lt;List&lt;ItemDTO&gt;&gt;() &#123;</span><br><span class="line">    &#125;,<span class="comment">// åˆ©ç”¨æ³›å‹, åå°„æ‹¿åˆ°</span></span><br><span class="line">    Map.of(<span class="string">&quot;ids&quot;</span>, CollUtil.join(itemIds, <span class="string">&quot;,&quot;</span>)) <span class="comment">// JDk11ä¸­çš„Map.of,  Hutoolä¸­çš„CollUtilæ‹¼æ¥</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥è®©<strong>è¿œç¨‹è°ƒç”¨åƒæœ¬åœ°æ–¹æ³•è°ƒç”¨ä¸€æ ·ç®€å•</strong>å‘¢?    ä½ è¯´å‘¢,  çœ‹è¿™ä¸€å°èŠ‚çš„æ ‡é¢˜</p><p>ä¸‹é¢ä¾‹å­è¿˜æ˜¯ä»¥ cart-serviceä¸­çš„æŸ¥è¯¢è´­ç‰©è½¦ä¸ºä¾‹</p><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><h4 id="å¯¼å…¥ä¾èµ–"><a href="#å¯¼å…¥ä¾èµ–" class="headerlink" title="å¯¼å…¥ä¾èµ–"></a>å¯¼å…¥ä¾èµ–</h4><p>åœ¨<code>cart-service</code>æœåŠ¡çš„pom.xmlä¸­å¼•å…¥<code>OpenFeign</code>çš„ä¾èµ–å’Œ<code>loadBalancer</code>ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--openFeign--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--è´Ÿè½½å‡è¡¡å™¨--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-loadbalancer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="å¯ç”¨OpenFeign"><a href="#å¯ç”¨OpenFeign" class="headerlink" title="å¯ç”¨OpenFeign"></a>å¯ç”¨OpenFeign</h4><p>åœ¨<code>cart-service</code>çš„<code>CartApplication</code>å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ï¼Œå¯åŠ¨OpenFeignåŠŸèƒ½</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span>  <span class="comment">// å¼€å¯OpenFeign</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CartApplication</span> &#123;</span><br><span class="line">    <span class="comment">// ... ç•¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç¼–å†™OpenFeignå®¢æˆ·ç«¯"><a href="#ç¼–å†™OpenFeignå®¢æˆ·ç«¯" class="headerlink" title="ç¼–å†™OpenFeignå®¢æˆ·ç«¯"></a>ç¼–å†™OpenFeignå®¢æˆ·ç«¯</h4><p>åœ¨<code>cart-service</code>ä¸­ï¼Œå®šä¹‰ä¸€ä¸ªæ–°çš„æ¥å£ï¼Œç¼–å†™Feignå®¢æˆ·ç«¯ï¼š</p><p>å…¶ä¸­ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;item-service&quot;)</span>  <span class="comment">// æœåŠ¡å</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ItemClient</span> &#123;      <span class="comment">// ç»“æœ:  åœ¨æŒ‡å®šçš„æœåŠ¡+æŒ‡å®šçš„è¯·æ±‚åœ°å€+è¯·æ±‚å‚æ•°  =&gt;  æ¨¡æ‹Ÿçš„httpè¯·æ±‚</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  å…¶å®å°±æ˜¯è·ŸSpringMVCå†™è¯·æ±‚å·®ä¸å¤šçš„</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/items&quot;)</span></span><br><span class="line">    List&lt;ItemDTO&gt; <span class="title function_">queryItemByIds</span><span class="params">(<span class="meta">@RequestParam(&quot;ids&quot;)</span> Collection&lt;Long&gt; ids)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåªéœ€è¦å£°æ˜æ¥å£ï¼Œæ— éœ€å®ç°æ–¹æ³•ã€‚æ¥å£ä¸­çš„å‡ ä¸ªå…³é”®ä¿¡æ¯ï¼š</p><ul><li><code>@FeignClient(&quot;item-service&quot;)</code> ï¼šå£°æ˜æœåŠ¡åç§°</li><li><code>@GetMapping</code> ï¼šå£°æ˜è¯·æ±‚æ–¹å¼</li><li><code>@GetMapping(&quot;/items&quot;)</code> ï¼šå£°æ˜è¯·æ±‚è·¯å¾„</li><li><code>@RequestParam(&quot;ids&quot;) Collection&lt;Long&gt; ids</code> ï¼šå£°æ˜è¯·æ±‚å‚æ•°</li><li><code>List&lt;ItemDTO&gt;</code> ï¼šè¿”å›å€¼ç±»å‹</li></ul><p>æœ‰äº†ä¸Šè¿°ä¿¡æ¯ï¼ŒOpenFeignå°±å¯ä»¥åˆ©ç”¨åŠ¨æ€ä»£ç†å¸®æˆ‘ä»¬å®ç°è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶ä¸”å‘<code>http://item-service/items</code>å‘é€ä¸€ä¸ª<code>GET</code>è¯·æ±‚ï¼Œæºå¸¦idsä¸ºè¯·æ±‚å‚æ•°ï¼Œå¹¶è‡ªåŠ¨å°†è¿”å›å€¼å¤„ç†ä¸º<code>List&lt;ItemDTO&gt;</code>ã€‚</p><p>æˆ‘ä»¬åªéœ€è¦ç›´æ¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå³å¯å®ç°è¿œç¨‹è°ƒç”¨äº†</p><h4 id="ä½¿ç”¨FeignClient"><a href="#ä½¿ç”¨FeignClient" class="headerlink" title="ä½¿ç”¨FeignClient"></a>ä½¿ç”¨FeignClient</h4><p>åŸºäºä¸Šé¢ç¼–å†™çš„å®¢æˆ·ç«¯æ¥å£</p><p>æˆ‘ä»¬åœ¨<code>cart-service</code>çš„<code>com.hmall.cart.service.impl.CartServiceImpl</code>ä¸­æ”¹é€ ä»£ç ï¼Œç›´æ¥è°ƒç”¨<code>ItemClient</code>çš„æ–¹æ³•(å³è€ä¾‹å­)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    private final RestTemplate restTemplate;</span></span><br><span class="line"><span class="comment">//    private final DiscoveryClient discoveryClient;</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ItemClient itemClient;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleCartItems</span><span class="params">(List&lt;CartVO&gt; vos)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.è·å–å•†å“id</span></span><br><span class="line">    Set&lt;Long&gt; itemIds = vos.stream().map(CartVO::getItemId).collect(Collectors.toSet());</span><br><span class="line">    <span class="comment">// -----------ç°åœ¨--------- // </span></span><br><span class="line">    List&lt;ItemDTO&gt; items = itemClient.queryItemByIds(itemIds);</span><br><span class="line"> <span class="comment">// ----------------------- //</span></span><br><span class="line">    <span class="keyword">if</span> (CollUtils.isEmpty(items)) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.è½¬ä¸º id åˆ° itemçš„map</span></span><br><span class="line">    Map&lt;Long, ItemDTO&gt; itemMap = items.stream().collect(Collectors.toMap(ItemDTO::getId, Function.identity()));</span><br><span class="line">    <span class="comment">// 4.å†™å…¥vo</span></span><br><span class="line">    <span class="keyword">for</span> (CartVO v : vos) &#123;</span><br><span class="line">        <span class="type">ItemDTO</span> <span class="variable">item</span> <span class="operator">=</span> itemMap.get(v.getItemId());</span><br><span class="line">        <span class="keyword">if</span> (item == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        v.setNewPrice(item.getPrice());</span><br><span class="line">        v.setStatus(item.getStatus());</span><br><span class="line">        v.setStock(item.getStock());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>feignæ›¿æˆ‘ä»¬å®Œæˆäº†æœåŠ¡æ‹‰å–ã€è´Ÿè½½å‡è¡¡ã€å‘é€httpè¯·æ±‚çš„æ‰€æœ‰å·¥ä½œï¼Œæ˜¯ä¸æ˜¯çœ‹èµ·æ¥<wavy>ä¼˜é›…å¤šäº†</wavy>ã€‚</p><p>è€Œä¸”ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸å†éœ€è¦RestTemplateäº†ï¼Œè¿˜çœå»äº†RestTemplateçš„æ³¨å†Œã€‚</p><h4 id="OpenFeignå°æ€»ç»“"><a href="#OpenFeignå°æ€»ç»“" class="headerlink" title="OpenFeignå°æ€»ç»“"></a>OpenFeignå°æ€»ç»“</h4><img src="/2023/11/14/SpringCloud/OpenFeign_1.png" class title="è´­ç‰©æµç¨‹,æ³¨å†Œä¸è°ƒç”¨"><h5 id="æœåŠ¡æ¶ˆè´¹è€…"><a href="#æœåŠ¡æ¶ˆè´¹è€…" class="headerlink" title="æœåŠ¡æ¶ˆè´¹è€…"></a>æœåŠ¡æ¶ˆè´¹è€…</h5><p>æœåŠ¡æ¶ˆè´¹è€…çš„å¯åŠ¨ç±»ä¸Šå¼€å¯OpenFeignå®¢æˆ·ç«¯<code>@EnableFeignClients()</code>,  æ‹¬å·é‡Œé¢å¯é€‰<strong>æŒ‡å®šæ‰«ææ³¨å†Œè·¯å¾„</strong>å’Œ<strong>é»˜è®¤è¡Œä¸ºæŒ‡å®š</strong>(å½“å‰ä¸¤å¤„æ¨ªçº¿ æ¡ˆä¾‹å¯å‚è€ƒå½“å‰#OpenFeignç« èŠ‚çš„#æœ€ä½³å®è·µ å’Œ#æ—¥å¿—é…ç½®),</p><h5 id="æœåŠ¡æä¾›è€…"><a href="#æœåŠ¡æä¾›è€…" class="headerlink" title="æœåŠ¡æä¾›è€…"></a>æœåŠ¡æä¾›è€…</h5><p>æœåŠ¡æä¾›è€…æŠ½å–æœåŠ¡æ¶ˆè´¹è€…éœ€è¦è°ƒç”¨çš„æ–¹æ³•,  æ³¨å†Œè‡³<code>Client</code>, æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªæ¨¡å—ä¸º<code>api</code>æ¨¡å—ä¸“é—¨ç”¨äºæå–æ¥å£æš´éœ²,  é›†ä¸­æ³¨å†Œä¾¿äºå®¢æˆ·ç«¯æ‰«æ,  å…¶ä¸­åœ¨Clientæ¥å£ç±»é€šè¿‡<code>@FeignClient(&quot;xxx-service&quot;)</code>æŒ‡å®šæœåŠ¡å(å½“å‰æœåŠ¡åä¸ºæœåŠ¡æä¾›è€…çš„åº”ç”¨å)</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¯ä¸€ä¸ªspringbootå¾®æœåŠ¡éƒ½éœ€è¦å–ä¸€ä¸ªåå­—</span></span><br><span class="line"><span class="attr">spring.application.name</span> = <span class="string">xxx-service </span></span><br></pre></td></tr></table></figure><p>æ¯ä¸€ä¸ªæœåŠ¡å¯ä»¥æ˜¯æœåŠ¡æä¾›è€…ä¹Ÿå¯ä»¥æ˜¯æœåŠ¡æ¶ˆè´¹è€…</p><h3 id="è¿æ¥æ± "><a href="#è¿æ¥æ± " class="headerlink" title="è¿æ¥æ± "></a>è¿æ¥æ± </h3><p>Feignåº•å±‚å‘èµ·httpè¯·æ±‚ï¼Œä¾èµ–äºå…¶å®ƒçš„æ¡†æ¶ã€‚å…¶åº•å±‚æ”¯æŒçš„httpå®¢æˆ·ç«¯å®ç°åŒ…æ‹¬ï¼š</p><ul><li>HttpURLConnectionï¼šé»˜è®¤å®ç°ï¼Œä¸æ”¯æŒè¿æ¥æ± </li><li>Apache HttpClient ï¼šæ”¯æŒè¿æ¥æ± </li><li>OKHttpï¼šæ”¯æŒè¿æ¥æ± </li></ul><p>å› æ­¤æˆ‘ä»¬é€šå¸¸ä¼šä½¿ç”¨å¸¦æœ‰è¿æ¥æ± çš„å®¢æˆ·ç«¯æ¥ä»£æ›¿é»˜è®¤çš„HttpURLConnectionã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬ä½¿ç”¨OK Http</p><h4 id="å¼•å…¥ä¾èµ–"><a href="#å¼•å…¥ä¾èµ–" class="headerlink" title="å¼•å…¥ä¾èµ–"></a>å¼•å…¥ä¾èµ–</h4><p>åœ¨<code>cart-service</code>çš„<code>pom.xml</code>ä¸­å¼•å…¥ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--OK http çš„ä¾èµ– --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.github.openfeign<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>feign-okhttp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="å¼€å¯è¿æ¥æ± "><a href="#å¼€å¯è¿æ¥æ± " class="headerlink" title="å¼€å¯è¿æ¥æ± "></a>å¼€å¯è¿æ¥æ± </h4><p>åœ¨<code>cart-service</code>çš„<code>application.yml</code>é…ç½®æ–‡ä»¶ä¸­å¼€å¯Feignçš„è¿æ¥æ± åŠŸèƒ½ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">okhttp:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># å¼€å¯OKHttpåŠŸèƒ½</span></span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¼€å¯å®Œæˆäº†,  æµ‹è¯•æ˜¯å¦å¼€å¯å¯ä»¥é€šè¿‡Debugæ¨¡å¼æŸ¥çœ‹</p><h3 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h3><p>å…³äºé‡å¤çš„ç¼–ç ç»“æœ,  æˆ‘ä»¬å¯ä»¥é€šè¿‡<wavy>æŠ½å–å…¬å…±æ¨¡å—</wavy>,  å»ºç«‹ä¸€ä¸ªæ–°çš„æ¨¡å—ç»™å…¶ä»–æ¨¡å—æä¾›å…¬å…±æœåŠ¡,  ä¾‹å¦‚commonæ¨¡å—ä¸­å¯ä»¥æ”¾å…¥ç»å¸¸ä½¿ç”¨çš„entityå®ä½“,</p><p>å¯¹äºapiæ¨¡å—æŠ½å–,  éœ€è¦è°ƒç”¨apiæ¨¡å—ä¸­çš„æ¥å£çš„æ¨¡å—åˆ™<u>æ·»åŠ </u>å¯¹äºè¯¥æ¨¡å—çš„ä¾èµ–</p><h4 id="ä¾‹-æŠ½å–Feignå®¢æˆ·ç«¯"><a href="#ä¾‹-æŠ½å–Feignå®¢æˆ·ç«¯" class="headerlink" title="ä¾‹:æŠ½å–Feignå®¢æˆ·ç«¯"></a>ä¾‹:æŠ½å–Feignå®¢æˆ·ç«¯</h4><ol><li>åˆ›å»ºä¸€ä¸ªæ¨¡å—, ä¸“é—¨ç”¨æ¥æ”¾apiçš„,  å¯¼å…¥ä¾èµ–</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--openFeign--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--è´Ÿè½½å‡è¡¡å™¨--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-loadbalancer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å› ä¸ºæ­¤æ¨¡å—æ˜¯å®¢æˆ·ç«¯,  æ‰€ä»¥ æ˜¯è¦å¯¼å…¥OpenFeignå’Œè´Ÿè½½å‡è¡¡ä¸ºåŸºç¡€çš„</p><ol start="2"><li>åœ¨è¯¥æ¨¡å—ä¸­æŠŠä¹‹å‰çš„<code>Client</code>ç§»åŠ¨è¿‡æ¥,  å› ä¸ºè¯¥æ¥å£éœ€è¦ç”¨åˆ°<code>ItemDto</code>,  æ•…dtoä¹Ÿè¦ç§»åŠ¨è¿‡æ¥</li><li>åœ¨éœ€è¦å¼•ç”¨(è°ƒç”¨)è¯¥æ¨¡å—çš„pomæ–‡ä»¶ä¸­,  <wavy>å¯¼å…¥ä¾èµ–</wavy>,  å¦‚æœæ­¤æ—¶è¿è¡Œæ˜¯ä¸è¡Œçš„,  å½“å‰æ¨¡å—æ²¡æœ‰è¢«æ‰«æåˆ°,  æ²¡æœ‰è¢«Springç®¡ç†,  å› ä¸ºæ­¤æ—¶åœ¨å¦å¤–ä¸€ä¸ªæ¨¡å—äº†,  ä¸åœ¨æ‰«æçš„è·¯å¾„ä¸‹äº†</li><li>æ·»åŠ æ‰«æ</li></ol><p>åœ¨éœ€è¦è°ƒç”¨çš„æ¨¡å—çš„å¯åŠ¨ç±»ä¸Šæ·»åŠ å£°æ˜å³å¯ï¼Œä¸¤ç§æ–¹å¼ï¼š</p><ul><li>æ–¹å¼1ï¼šå£°æ˜æ‰«æåŒ…ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients(basePackages = &quot;com.heima.api.client&quot;)</span> <span class="comment">// ç±»å…¨è·¯å¾„(æŠ½å–çš„æ¨¡å—)</span></span><br></pre></td></tr></table></figure><ul><li>æ–¹å¼2ï¼šå£°æ˜è¦ç”¨çš„FeignClient</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients(clients = &#123;ItemClient.class&#125;)</span>           <span class="comment">// å®¢æˆ·ç«¯æ¥å£</span></span><br></pre></td></tr></table></figure><h3 id="æ—¥å¿—é…ç½®"><a href="#æ—¥å¿—é…ç½®" class="headerlink" title="æ—¥å¿—é…ç½®"></a>æ—¥å¿—é…ç½®</h3><p>OpenFeignåªä¼šåœ¨FeignClientæ‰€åœ¨åŒ…çš„æ—¥å¿—çº§åˆ«ä¸º<strong>DEBUG</strong>æ—¶ï¼Œæ‰ä¼šè¾“å‡ºæ—¥å¿—ã€‚è€Œä¸”å…¶æ—¥å¿—çº§åˆ«æœ‰4çº§ï¼š</p><ul><li><strong>NONE</strong>ï¼šä¸è®°å½•ä»»ä½•æ—¥å¿—ä¿¡æ¯ï¼Œè¿™æ˜¯é»˜è®¤å€¼ã€‚</li><li><strong>BASIC</strong>ï¼šä»…è®°å½•è¯·æ±‚çš„æ–¹æ³•ï¼ŒURLä»¥åŠå“åº”çŠ¶æ€ç å’Œæ‰§è¡Œæ—¶é—´</li><li><strong>HEADERS</strong>ï¼šåœ¨BASICçš„åŸºç¡€ä¸Šï¼Œé¢å¤–è®°å½•äº†è¯·æ±‚å’Œå“åº”çš„å¤´ä¿¡æ¯</li><li><strong>FULL</strong>ï¼šè®°å½•æ‰€æœ‰è¯·æ±‚å’Œå“åº”çš„æ˜ç»†ï¼ŒåŒ…æ‹¬å¤´ä¿¡æ¯ã€è¯·æ±‚ä½“ã€å…ƒæ•°æ®ã€‚</li></ul><p>Feigné»˜è®¤çš„æ—¥å¿—çº§åˆ«å°±æ˜¯NONEï¼Œæ‰€ä»¥é»˜è®¤æˆ‘ä»¬çœ‹ä¸åˆ°è¯·æ±‚æ—¥å¿—ã€‚</p><h4 id="å®šä¹‰æ—¥å¿—çº§åˆ«"><a href="#å®šä¹‰æ—¥å¿—çº§åˆ«" class="headerlink" title="å®šä¹‰æ—¥å¿—çº§åˆ«"></a>å®šä¹‰æ—¥å¿—çº§åˆ«</h4><p>åœ¨åˆšåˆšæŠ½å–çš„clientæ¨¡å—ä¸‹æ–°å»ºä¸€ä¸ªé…ç½®ç±»ï¼Œå®šä¹‰Feignçš„æ—¥å¿—çº§åˆ«ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> feign.Logger;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultFeignConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Logger.Level <span class="title function_">feignLogLevel</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Logger.Level.FULL;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><p>æ¥ä¸‹æ¥ï¼Œè¦è®©æ—¥å¿—çº§åˆ«ç”Ÿæ•ˆï¼Œè¿˜éœ€è¦é…ç½®è¿™ä¸ªç±»ã€‚æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ul><li><strong>å±€éƒ¨</strong>ç”Ÿæ•ˆï¼šåœ¨æŸä¸ª<code>FeignClient</code>ä¸­é…ç½®ï¼Œåªå¯¹å½“å‰<code>FeignClient</code>ç”Ÿæ•ˆ</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = &quot;item-service&quot;, configuration = DefaultFeignConfig.class)</span></span><br></pre></td></tr></table></figure><ul><li><strong>å…¨å±€</strong>ç”Ÿæ•ˆï¼šåœ¨<code>@EnableFeignClients</code>ä¸­é…ç½®ï¼Œé’ˆå¯¹æ‰€æœ‰<code>FeignClient</code>ç”Ÿæ•ˆã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients(defaultConfiguration = DefaultFeignConfig.class)</span></span><br></pre></td></tr></table></figure><blockquote><p>ä¸€èˆ¬æƒ…å†µä¸éœ€è¦é…ç½®æ—¥å¿—,  ä»…ä»…åœ¨æœ‰éœ€è¦çš„æ—¶å€™åœ¨å¼€å¯å³å¯</p></blockquote><h2 id="Gatewayç½‘å…³è·¯ç”±"><a href="#Gatewayç½‘å…³è·¯ç”±" class="headerlink" title="Gatewayç½‘å…³è·¯ç”±"></a>Gatewayç½‘å…³è·¯ç”±</h2><p>ç½‘å…³å°±æ˜¯<strong>ç½‘</strong>ç»œçš„<strong>å…³</strong>å£ã€‚æ•°æ®åœ¨ç½‘ç»œé—´ä¼ è¾“ï¼Œä»ä¸€ä¸ªç½‘ç»œä¼ è¾“åˆ°å¦ä¸€ç½‘ç»œæ—¶å°±éœ€è¦ç»è¿‡ç½‘å…³æ¥åšæ•°æ®çš„<strong>è·¯ç”±å’Œè½¬å‘ä»¥åŠæ•°æ®å®‰å…¨çš„æ ¡éªŒ</strong>,  å…¶å®å°±æ˜¯å§”æ‰˜</p><p>eg: æœ‰äººåœ¨å°åŒºæ¥¼ä¸‹æ‰¾ä½ ,  ä½†æ˜¯åœ¨æ¥¼ä¸‹ä¿å®‰ä¼šæ‹¦ä½, ç„¶ååªèƒ½è¯¢é—®ä¿å®‰,  ç„¶åè®©ä¿å®‰å»æ‰¾ä½   </p><p>ç°åœ¨ï¼Œå¾®æœåŠ¡ç½‘å…³å°±èµ·åˆ°åŒæ ·çš„ä½œç”¨ã€‚å‰ç«¯è¯·æ±‚ä¸èƒ½ç›´æ¥è®¿é—®å¾®æœåŠ¡ï¼Œè€Œæ˜¯è¦<strong>è¯·æ±‚ç½‘å…³</strong>ï¼š</p><ul><li>ç½‘å…³å¯ä»¥åšå®‰å…¨æ§åˆ¶ï¼Œä¹Ÿå°±æ˜¯ç™»å½•èº«ä»½æ ¡éªŒï¼Œæ ¡éªŒé€šè¿‡æ‰æ”¾è¡Œ</li><li>é€šè¿‡è®¤è¯åï¼Œç½‘å…³å†æ ¹æ®è¯·æ±‚åˆ¤æ–­åº”è¯¥è®¿é—®å“ªä¸ªå¾®æœåŠ¡ï¼Œå°†è¯·æ±‚è½¬å‘è¿‡å»</li></ul><img src="/2023/11/14/SpringCloud/gateway_1.png" class><p>ç½‘å…³åœ¨æ³¨å†Œä¸­å¿ƒæ‰¾æœåŠ¡,  è´Ÿè½½å‡è¡¡</p><h3 id="SpringCloud-Gateway"><a href="#SpringCloud-Gateway" class="headerlink" title="SpringCloud Gateway"></a>SpringCloud Gateway</h3><p>åˆ›å»ºç½‘å…³æ¨¡å— gateway</p><h4 id="å¯¼å…¥ä¾èµ–-1"><a href="#å¯¼å…¥ä¾èµ–-1" class="headerlink" title="å¯¼å…¥ä¾èµ–"></a>å¯¼å…¥ä¾èµ–</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--ç½‘å…³--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--nacos discovery--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--è´Ÿè½½å‡è¡¡--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-loadbalancer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="ç¼–å†™å¯åŠ¨ç±»"><a href="#ç¼–å†™å¯åŠ¨ç±»" class="headerlink" title="ç¼–å†™å¯åŠ¨ç±»"></a>ç¼–å†™å¯åŠ¨ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GatewayApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(GatewayApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é…ç½®è·¯ç”±"><a href="#é…ç½®è·¯ç”±" class="headerlink" title="é…ç½®è·¯ç”±"></a>é…ç½®è·¯ç”±</h4><p>åœ¨gatewayæ¨¡å—ä¸­çš„é…ç½®æ–‡ä»¶ä¸­</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gateway</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span>   <span class="comment"># Nacosåœ°å€</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">item</span> <span class="comment"># è·¯ç”±è§„åˆ™idï¼Œè‡ªå®šä¹‰ï¼Œå”¯ä¸€</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://item-service</span> <span class="comment"># è·¯ç”±çš„ç›®æ ‡æœåŠ¡ï¼Œlbä»£è¡¨è´Ÿè½½å‡è¡¡ï¼Œä¼šä»æ³¨å†Œä¸­å¿ƒæ‹‰å–æœåŠ¡åˆ—è¡¨</span></span><br><span class="line">          <span class="attr">predicates:</span> <span class="comment"># è·¯ç”±æ–­è¨€ï¼Œåˆ¤æ–­å½“å‰è¯·æ±‚æ˜¯å¦ç¬¦åˆå½“å‰è§„åˆ™ï¼Œç¬¦åˆåˆ™è·¯ç”±åˆ°ç›®æ ‡æœåŠ¡</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/items/**,/search/**</span> <span class="comment"># è¿™é‡Œæ˜¯ä»¥è¯·æ±‚è·¯å¾„ä½œä¸ºåˆ¤æ–­è§„åˆ™</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">cart</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://cart-service</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/carts/**</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">user</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://user-service</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/users/**,/addresses/**</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">trade</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://trade-service</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/orders/**</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">pay</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://pay-service</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/pay-orders/**</span></span><br></pre></td></tr></table></figure><p>è¯¦æƒ…é…ç½®: [Spring Cloud Gateway](<a href="https://docs.spring.io/spring-cloud-gateway/docs/3.1.8/reference/html/">Spring Cloud Gateway</a>)</p><p>ç„¶åæ‰€æœ‰åœ¨ç½‘å…³æ³¨å†Œçš„æœåŠ¡çš„è®¿é—®,  <wavy>ç›´æ¥è®¿é—®ç½‘å…³é…ç½®çš„ç«¯å£</wavy>å³å¯</p><h4 id="è·¯ç”±è¿‡æ»¤"><a href="#è·¯ç”±è¿‡æ»¤" class="headerlink" title="è·¯ç”±è¿‡æ»¤"></a>è·¯ç”±è¿‡æ»¤</h4><p>å¯¹äºåˆšåˆšæ¡ˆä¾‹ä¸­çš„è·¯ç”±é…ç½®( æˆªå–ä¸€éƒ¨åˆ† )</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">item</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://item-service</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/items/**,/search/**</span></span><br></pre></td></tr></table></figure><p>è¿½è¸ªrouterå¯ä»¥å‘ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(&quot;spring.cloud.gateway&quot;)</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GatewayProperties</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PREFIX</span> <span class="operator">=</span> <span class="string">&quot;spring.cloud.gateway&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Log</span> <span class="variable">logger</span> <span class="operator">=</span> LogFactory.getLog(<span class="built_in">this</span>.getClass());</span><br><span class="line">    <span class="comment">// å½“å‰ä¸ºè·¯ç”±é…ç½®é¡¹(ä¸ºä¸€ä¸ªListé›†åˆ)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="meta">@NotNull</span> <span class="meta">@Valid</span> List&lt;RouteDefinition&gt; routes = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥å‘ç°routesæ˜¯ä¸€ä¸ªé›†åˆ,  é‚£ä¹ˆå¯ä»¥å®šä¹‰å¤šä¸ªè·¯ç”±é¡¹</p><p>å…¶ä¸­è·¯ç”±çš„å±æ€§å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RouteDefinition</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> <span class="meta">@NotEmpty</span> <span class="meta">@Valid</span> List&lt;PredicateDefinition&gt; predicates = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="meta">@Valid</span> List&lt;FilterDefinition&gt; filters = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="meta">@NotNull</span> URI uri;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; metadata = <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">order</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å››ä¸ªå±æ€§å«ä¹‰å¦‚ä¸‹ï¼š</p><ul><li><code>id</code>ï¼šè·¯ç”±çš„å”¯ä¸€æ ‡ç¤º</li><li><code>predicates</code>ï¼šè·¯ç”±æ–­è¨€ï¼Œå…¶å®å°±æ˜¯åŒ¹é…æ¡ä»¶</li><li><code>filters</code>ï¼šè·¯ç”±è¿‡æ»¤æ¡ä»¶ï¼Œåé¢è®²</li><li><code>uri</code>ï¼šè·¯ç”±ç›®æ ‡åœ°å€ï¼Œ<code>lb://</code>ä»£è¡¨è´Ÿè½½å‡è¡¡ï¼Œä»æ³¨å†Œä¸­å¿ƒè·å–ç›®æ ‡å¾®æœåŠ¡çš„å®ä¾‹åˆ—è¡¨ï¼Œå¹¶ä¸”è´Ÿè½½å‡è¡¡é€‰æ‹©ä¸€ä¸ªè®¿é—®ã€‚</li></ul><p>åœ¨å½“å‰å±æ€§ä¸­,  æ˜¾ç„¶æœ€å…³å¿ƒçš„æ˜¯è·¯ç”±æ–­è¨€(<code>predicates</code>),  å…¶ä¸­åŒ…æ‹¬å¾ˆå¤šè¯­æ³•å¦‚ä¸‹</p><table><thead><tr><th align="left"><strong>åç§°</strong></th><th align="left"><strong>è¯´æ˜</strong></th><th align="left"><strong>ç¤ºä¾‹</strong></th></tr></thead><tbody><tr><td align="left">After</td><td align="left">æ˜¯æŸä¸ªæ—¶é—´ç‚¹åçš„è¯·æ±‚</td><td align="left">- After&#x3D;2037-01-20T17:42:47.789-07:00[America&#x2F;Denver]</td></tr><tr><td align="left">Before</td><td align="left">æ˜¯æŸä¸ªæ—¶é—´ç‚¹ä¹‹å‰çš„è¯·æ±‚</td><td align="left">- Before&#x3D;2031-04-13T15:14:47.433+08:00[Asia&#x2F;Shanghai]</td></tr><tr><td align="left">Between</td><td align="left">æ˜¯æŸä¸¤ä¸ªæ—¶é—´ç‚¹ä¹‹å‰çš„è¯·æ±‚</td><td align="left">- Between&#x3D;2037-01-20T17:42:47.789-07:00[America&#x2F;Denver], 2037-01-21T17:42:47.789-07:00[America&#x2F;Denver]</td></tr><tr><td align="left">Cookie</td><td align="left">è¯·æ±‚å¿…é¡»åŒ…å«æŸäº›cookie</td><td align="left">- Cookie&#x3D;chocolate, ch.p</td></tr><tr><td align="left">Header</td><td align="left">è¯·æ±‚å¿…é¡»åŒ…å«æŸäº›header</td><td align="left">- Header&#x3D;X-Request-Id, \d+</td></tr><tr><td align="left">Host</td><td align="left">è¯·æ±‚å¿…é¡»æ˜¯è®¿é—®æŸä¸ªhostï¼ˆåŸŸåï¼‰</td><td align="left">- Host&#x3D;<strong>.somehost.org,</strong>.anotherhost.org</td></tr><tr><td align="left">Method</td><td align="left">è¯·æ±‚æ–¹å¼å¿…é¡»æ˜¯æŒ‡å®šæ–¹å¼</td><td align="left">- Method&#x3D;GET,POST</td></tr><tr><td align="left">Path</td><td align="left">è¯·æ±‚è·¯å¾„å¿…é¡»ç¬¦åˆæŒ‡å®šè§„åˆ™</td><td align="left">- Path&#x3D;&#x2F;red&#x2F;{segment},&#x2F;blue&#x2F;**</td></tr><tr><td align="left">Query</td><td align="left">è¯·æ±‚å‚æ•°å¿…é¡»åŒ…å«æŒ‡å®šå‚æ•°</td><td align="left">- Query&#x3D;name, Jackæˆ–è€…- Query&#x3D;name</td></tr><tr><td align="left">RemoteAddr</td><td align="left">è¯·æ±‚è€…çš„ipå¿…é¡»æ˜¯æŒ‡å®šèŒƒå›´</td><td align="left">- RemoteAddr&#x3D;192.168.1.1&#x2F;24</td></tr><tr><td align="left">weight</td><td align="left">æƒé‡å¤„ç†</td><td align="left"></td></tr></tbody></table><h2 id="ç½‘å…³ç™»å½•æ ¡éªŒ"><a href="#ç½‘å…³ç™»å½•æ ¡éªŒ" class="headerlink" title="ç½‘å…³ç™»å½•æ ¡éªŒ"></a>ç½‘å…³ç™»å½•æ ¡éªŒ</h2><p>å¯¹äºå•ä½“æ¶æ„,  æˆ‘ä»¬åªéœ€è¦å®Œæˆä¸€æ¬¡ç”¨æˆ·ç™»å½•ã€è¿›è¡Œèº«ä»½æ ¡éªŒå°±å¯ä»¥åœ¨æ‰€æœ‰ä¸šåŠ¡ä¸­å¾—åˆ°ç”¨æˆ·ä¿¡æ¯ï¼ˆThreadLocalï¼‰ã€‚åœ¨å¾®æœåŠ¡ä¸‹ï¼Œæ¯ä¸€ä¸ªæœåŠ¡éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬éƒ¨ç½²ï¼Œæ•°æ®ä¸åƒå•ä½“æ¶æ„é‚£æ ·å…±äº«ã€‚</p><p>åœ¨ä¸Šä¸€éƒ¨åˆ†æˆ‘ä»¬çŸ¥é“ï¼Œæ‰€æœ‰çš„å¾®æœåŠ¡è¯·æ±‚åªè¦åœ¨ç½‘å…³ä¸­æ³¨å†Œç„¶åï¼Œè¯·æ±‚åªéœ€è¦æ‰“åœ¨ç½‘å…³ä¸Šé¢å°±å¯ä»¥å®šå‘åˆ°å…·ä½“çš„æœåŠ¡ï¼Œé‚£ä¹ˆå¤§èƒ†çŒœæƒ³ï¼šå²‚ä¸æ˜¯å¯ä»¥åœ¨ç½‘å…³ä¸­åšæ ¡éªŒï¼Œç„¶åæŠŠæ ¡éªŒæ•°æ®æ”¾è¯·æ±‚å¤´é‡Œé¢æ˜¯ä¸æ˜¯å°±å®Œæˆäº†èº«ä»½äº’é€šï¼Œé‚£ä¹ˆ</p><ul><li>åªéœ€è¦åœ¨ç½‘å…³å’Œç”¨æˆ·æœåŠ¡ä¿å­˜ç§˜é’¥</li><li>åªéœ€è¦åœ¨ç½‘å…³å¼€å‘ç™»å½•æ ¡éªŒåŠŸèƒ½</li></ul><p>ç”±ç½‘å…³ä¸‹å‘ä¼ é€’ç”¨æˆ·ä¿¡æ¯ç­¾å‘æœåŠ¡ï¼Œä¸è¿‡ï¼Œè¿™é‡Œå­˜åœ¨å‡ ä¸ªé—®é¢˜ï¼š</p><ul><li>ç½‘å…³è·¯ç”±æ˜¯é…ç½®çš„ï¼Œè¯·æ±‚è½¬å‘æ˜¯Gatewayå†…éƒ¨ä»£ç ï¼Œæˆ‘ä»¬å¦‚ä½•åœ¨è½¬å‘ä¹‹å‰åšç™»å½•æ ¡éªŒï¼Ÿ</li><li>ç½‘å…³æ ¡éªŒJWTä¹‹åï¼Œå¦‚ä½•å°†ç”¨æˆ·ä¿¡æ¯ä¼ é€’ç»™å¾®æœåŠ¡ï¼Ÿ</li><li>å¾®æœåŠ¡ä¹‹é—´ä¹Ÿä¼šç›¸äº’è°ƒç”¨ï¼Œè¿™ç§è°ƒç”¨ä¸ç»è¿‡ç½‘å…³ï¼Œåˆè¯¥å¦‚ä½•ä¼ é€’ç”¨æˆ·ä¿¡æ¯ï¼Ÿ</li></ul><h3 id="ç½‘å…³è¿‡æ»¤å™¨"><a href="#ç½‘å…³è¿‡æ»¤å™¨" class="headerlink" title="ç½‘å…³è¿‡æ»¤å™¨"></a>ç½‘å…³è¿‡æ»¤å™¨</h3><p>ç™»å½•æ ¡éªŒå¿…é¡»åœ¨è¯·æ±‚è½¬å‘åˆ°å¾®æœåŠ¡ä¹‹å‰åšï¼Œå¦åˆ™å°±å¤±å»äº†æ„ä¹‰ã€‚è€Œç½‘å…³çš„è¯·æ±‚è½¬å‘æ˜¯<code>Gateway</code>å†…éƒ¨ä»£ç å®ç°çš„ï¼Œè¦æƒ³åœ¨è¯·æ±‚è½¬å‘ä¹‹å‰åšç™»å½•æ ¡éªŒï¼Œå°±å¿…é¡»äº†è§£<code>Gateway</code>å†…éƒ¨å·¥ä½œçš„åŸºæœ¬åŸç†ã€‚</p><img src="/2023/11/14/SpringCloud/gateway_2.png" class title="ç½‘å…³è¿‡æ»¤å·¥ä½œåŸç†"><p>å¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬åªéœ€è¦å°†è‡ªå®šä¹‰è¿‡æ»¤å™¨çš„æ‰§è¡Œé¡ºåºå®šä¹‰åˆ°<code>NettyRoutingFilter</code>ä¹‹å‰å³å¯ã€‚</p><p>ç½‘å…³è¿‡æ»¤å™¨é“¾ä¸­çš„è¿‡æ»¤å™¨æœ‰ä¸¤ç§ï¼š</p><ul><li><code>GatewayFilter</code>ï¼šè·¯ç”±è¿‡æ»¤å™¨ï¼Œä½œç”¨èŒƒå›´æ¯”è¾ƒçµæ´»ï¼Œå¯ä»¥æ˜¯ä»»æ„æŒ‡å®šçš„è·¯ç”±<code>Route</code>. </li><li><code>GlobalFilter</code>ï¼šå…¨å±€è¿‡æ»¤å™¨ï¼Œä½œç”¨èŒƒå›´æ˜¯æ‰€æœ‰è·¯ç”±ï¼Œä¸å¯é…ç½®ã€‚</li></ul><blockquote><p><strong>æ³¨æ„</strong>ï¼šè¿‡æ»¤å™¨é“¾ä¹‹å¤–è¿˜æœ‰ä¸€ç§è¿‡æ»¤å™¨ï¼ŒHttpHeadersFilterï¼Œç”¨æ¥å¤„ç†ä¼ é€’åˆ°ä¸‹æ¸¸å¾®æœåŠ¡çš„è¯·æ±‚å¤´ã€‚ä¾‹å¦‚org.springframework.cloud.gateway.filter.headers.XForwardedHeadersFilterå¯ä»¥ä¼ é€’ä»£ç†è¯·æ±‚åŸæœ¬çš„hostå¤´åˆ°ä¸‹æ¸¸å¾®æœåŠ¡ã€‚</p></blockquote><p>å…¶å®<code>GatewayFilter</code>å’Œ<code>GlobalFilter</code>è¿™ä¸¤ç§è¿‡æ»¤å™¨çš„æ–¹æ³•ç­¾åå®Œå…¨ä¸€è‡´ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¤„ç†è¯·æ±‚å¹¶å°†å…¶ä¼ é€’ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> exchange å½“å‰è¯·æ±‚çš„ä¸Šä¸‹æ–‡ï¼Œå…¶ä¸­åŒ…å«requestã€responseç­‰å„ç§æ•°æ®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> chain è¿‡æ»¤å™¨é“¾ï¼ŒåŸºäºå®ƒå‘ä¸‹ä¼ é€’è¯·æ±‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> æ ¹æ®è¿”å›å€¼æ ‡è®°å½“å‰è¯·æ±‚æ˜¯å¦è¢«å®Œæˆæˆ–æ‹¦æˆªï¼Œchain.filter(exchange)å°±æ”¾è¡Œäº†ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span>;</span><br></pre></td></tr></table></figure><p>Gatewayä¸­å†…ç½®äº†å¾ˆå¤šçš„ç½‘å…³è¿‡æ»¤å™¨ï¼Œ è¯¦æƒ…å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£<a href="https://docs.spring.io/spring-cloud-gateway/docs/3.1.7/reference/html/#gatewayfilter-factories">Spring Cloud Gateway</a></p><p>å•æœåŠ¡åº”ç”¨:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">cart-service</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://cart-service</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/carts/**</span></span><br><span class="line">          <span class="attr">filters:</span></span><br><span class="line">          <span class="comment"># é€—å·ä¹‹å‰æ˜¯è¯·æ±‚å¤´çš„keyï¼Œé€—å·ä¹‹åæ˜¯value</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">AddRequestHeader=key,</span> <span class="string">value</span></span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚æˆ‘æ­¤æ—¶ç»™<code>cart-service</code>è·¯ç”±æœåŠ¡æ·»åŠ äº†<strong>è¯·æ±‚è¿‡æ»¤å™¨</strong>ï¼Œè®¿é—®cartæœåŠ¡åˆ™åœ¨è¯·æ±‚å¤´é‡Œé¢ä¼šæ–°å¢<code>Key</code>:key  <code>Value</code>:value</p><p>å¤šæœåŠ¡åº”ç”¨:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">default-filters:</span> <span class="comment"># default-filtersä¸‹çš„è¿‡æ»¤å™¨å¯ä»¥ä½œç”¨äºæ‰€æœ‰è·¯ç”±</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">AddRequestHeader=key,</span> <span class="string">value</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">cart-service</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">lb://cart-service</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">Path=/carts/**</span></span><br></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰è¿‡æ»¤å™¨"><a href="#è‡ªå®šä¹‰è¿‡æ»¤å™¨" class="headerlink" title="è‡ªå®šä¹‰è¿‡æ»¤å™¨"></a>è‡ªå®šä¹‰è¿‡æ»¤å™¨</h3><h4 id="è‡ªå®šä¹‰GatewayFilter"><a href="#è‡ªå®šä¹‰GatewayFilter" class="headerlink" title="è‡ªå®šä¹‰GatewayFilter"></a>è‡ªå®šä¹‰GatewayFilter</h4><p>å‰ç½®: å¦‚æœæœ‰<strong>ä¼ å‚æ•°</strong>,å®šä¹‰æ‰§è¡Œé¡ºåº,èŒƒå›´ç­‰åˆ™ç”¨æ­¤é¡¹</p><p>è‡ªå®šä¹‰<code>GatewayFilter</code>ä¸æ˜¯ç›´æ¥å®ç°<code>GatewayFilter</code>ï¼Œè€Œæ˜¯å®ç°<code>AbstractGatewayFilterFactory</code>ã€‚æœ€ç®€å•çš„æ–¹å¼æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PrintAnyGatewayFilterFactory</span> <span class="keyword">extends</span> <span class="title class_">AbstractGatewayFilterFactory</span>&lt;Object&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> GatewayFilter <span class="title function_">apply</span><span class="params">(Object config)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">GatewayFilter</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">                <span class="comment">// è·å–è¯·æ±‚</span></span><br><span class="line">                <span class="type">ServerHttpRequest</span> <span class="variable">request</span> <span class="operator">=</span> exchange.getRequest();</span><br><span class="line">                <span class="comment">// ç¼–å†™è¿‡æ»¤å™¨é€»è¾‘</span></span><br><span class="line">                log.info(<span class="string">&quot;è¿‡æ»¤å™¨æ‰§è¡Œäº†&quot;</span>);</span><br><span class="line">                <span class="comment">// æ”¾è¡Œ</span></span><br><span class="line">                <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å½“å‰è‡ªå®šä¹‰ç±»åçš„åç¼€å¿…é¡»ä¸º: <code>GatewayFilterFactory</code></p></blockquote><p>ä¼—æ‰€å‘¨çŸ¥SpringBootçº¦å®šå¤§äºé…ç½®ï¼Œå½“æˆ‘ä»¬è¿™æ ·å‘½åçš„æ—¶å€™ï¼Œåœ¨yamlä¸­é…ç½®å¯ä»¥æ˜¯è¿™æ ·çš„</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">default-filters:</span></span><br><span class="line">      <span class="comment"># æ­¤å¤„ç›´æ¥ä»¥è‡ªå®šä¹‰çš„GatewayFilterFactoryç±»åç§°å‰ç¼€ç±»å£°æ˜è¿‡æ»¤å™¨</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">PrintAny</span>   <span class="comment"># å†™å‰ç¼€å³å¯</span></span><br></pre></td></tr></table></figure><p>å¦å¤–ï¼Œè¿™ç§è¿‡æ»¤å™¨è¿˜å¯ä»¥æ”¯æŒåŠ¨æ€é…ç½®å‚æ•°ï¼Œä¸è¿‡å®ç°èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PrintAnyGatewayFilterFactory</span> <span class="comment">// çˆ¶ç±»æ³›å‹æ˜¯å†…éƒ¨ç±»çš„Configç±»å‹</span></span><br><span class="line">        <span class="keyword">extends</span> <span class="title class_">AbstractGatewayFilterFactory</span>&lt;PrintAnyGatewayFilterFactory.Config&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> GatewayFilter <span class="title function_">apply</span><span class="params">(Config config)</span> &#123;</span><br><span class="line">        <span class="comment">// OrderedGatewayFilteræ˜¯GatewayFilterçš„å­ç±»(å¯ä»¥å®ç°æ’åº)ï¼ŒåŒ…å«ä¸¤ä¸ªå‚æ•°ï¼š</span></span><br><span class="line">        <span class="comment">// - GatewayFilterï¼šè¿‡æ»¤å™¨</span></span><br><span class="line">        <span class="comment">// - int orderå€¼ï¼šå€¼è¶Šå°ï¼Œè¿‡æ»¤å™¨æ‰§è¡Œä¼˜å…ˆçº§è¶Šé«˜</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OrderedGatewayFilter</span>(<span class="keyword">new</span> <span class="title class_">GatewayFilter</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">                <span class="comment">// è·å–configå€¼</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">a</span> <span class="operator">=</span> config.getA();</span><br><span class="line">                <span class="type">String</span> <span class="variable">b</span> <span class="operator">=</span> config.getB();</span><br><span class="line">                <span class="type">String</span> <span class="variable">c</span> <span class="operator">=</span> config.getC();</span><br><span class="line">                <span class="comment">// ç¼–å†™è¿‡æ»¤å™¨é€»è¾‘</span></span><br><span class="line">                log.info(<span class="string">&quot;PrintAnyGatewayFilterFactoryæ‰§è¡Œäº†, a = &#123;&#125;,b = &#123;&#125;,c = &#123;&#125;&quot;</span>, a, b, c);</span><br><span class="line">                <span class="comment">// æ”¾è¡Œ</span></span><br><span class="line">                <span class="keyword">return</span> chain.filter(exchange);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è‡ªå®šä¹‰é…ç½®å±æ€§ï¼Œæˆå‘˜å˜é‡åç§°å¾ˆé‡è¦ï¼Œä¸‹é¢ä¼šç”¨åˆ°</span></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Config</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> String a;</span><br><span class="line">        <span class="keyword">private</span> String b;</span><br><span class="line">        <span class="keyword">private</span> String c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†å˜é‡åç§°ä¾æ¬¡è¿”å›ï¼Œé¡ºåºå¾ˆé‡è¦ï¼Œå°†æ¥è¯»å–å‚æ•°æ—¶éœ€è¦æŒ‰é¡ºåºè·å–</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">shortcutFieldOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> List.of(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›å½“å‰é…ç½®ç±»çš„ç±»å‹ï¼Œä¹Ÿå°±æ˜¯å†…éƒ¨çš„Config</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;Config&gt; <span class="title function_">getConfigClass</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Config.class;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨yamlæ–‡ä»¶ä¸­ä½¿ç”¨ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">default-filters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">PrintAny=1,2,3</span> <span class="comment"># æ³¨æ„ï¼Œè¿™é‡Œå¤šä¸ªå‚æ•°ä»¥&quot;,&quot;éš”å¼€ï¼Œå°†æ¥ä¼šæŒ‰ç…§shortcutFieldOrder()æ–¹æ³•è¿”å›çš„å‚æ•°é¡ºåºä¾æ¬¡å¤åˆ¶</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™ç§é…ç½®æ–¹å¼å‚æ•°å¿…é¡»ä¸¥æ ¼æŒ‰ç…§shortcutFieldOrder()æ–¹æ³•çš„è¿”å›å‚æ•°åé¡ºåºæ¥èµ‹å€¼ã€‚</p><p>è¿˜æœ‰ä¸€ç§ç”¨æ³•ï¼Œæ— éœ€æŒ‰ç…§è¿™ä¸ªé¡ºåºï¼Œå°±æ˜¯æ‰‹åŠ¨æŒ‡å®šå‚æ•°åï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">default-filters:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">PrintAny</span></span><br><span class="line">     <span class="attr">args:</span> <span class="comment"># æ‰‹åŠ¨æŒ‡å®šå‚æ•°åï¼Œæ— éœ€æŒ‰ç…§å‚æ•°é¡ºåº</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">a:</span> <span class="number">1</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">b:</span> <span class="number">2</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">c:</span> <span class="number">3</span></span><br></pre></td></tr></table></figure><h4 id="è‡ªå®šä¹‰GlobalFilter"><a href="#è‡ªå®šä¹‰GlobalFilter" class="headerlink" title="è‡ªå®šä¹‰GlobalFilter"></a>è‡ªå®šä¹‰GlobalFilter</h4><p>ç®€å•çš„è¿‡æ»¤å™¨</p><p>è‡ªå®šä¹‰GlobalFilteråˆ™ç®€å•å¾ˆå¤šï¼Œç›´æ¥å®ç°GlobalFilterå³å¯ï¼Œè€Œä¸”ä¹Ÿæ— æ³•è®¾ç½®åŠ¨æ€å‚æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PrintAnyGlobalFilter</span> <span class="keyword">implements</span> <span class="title class_">GlobalFilter</span>, Ordered &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span> &#123;</span><br><span class="line">        <span class="comment">// ç¼–å†™è¿‡æ»¤å™¨é€»è¾‘</span></span><br><span class="line">        log.info(<span class="string">&quot;æœªç™»å½•ï¼Œæ— æ³•è®¿é—®&quot;</span>);</span><br><span class="line">        <span class="comment">// æ”¾è¡Œ</span></span><br><span class="line">        <span class="comment">// return chain.filter(exchange);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‹¦æˆª</span></span><br><span class="line">        <span class="type">ServerHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> exchange.getResponse();</span><br><span class="line">        response.setRawStatusCode(<span class="number">401</span>);</span><br><span class="line">        <span class="keyword">return</span> response.setComplete();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåºï¼Œå€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Actuatorç›‘æ§"><a href="#Actuatorç›‘æ§" class="headerlink" title="Actuatorç›‘æ§"></a>Actuatorç›‘æ§</h2><p>å®˜ç½‘æ–‡æ¡£:<a href="https://cloud.spring.io/spring-cloud-gateway/reference/html/#actuator-api">Spring Cloud Gateway</a></p><p>å¯¼å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="é…ç½®æ‰“å¼€çš„ç«¯ç‚¹"><a href="#é…ç½®æ‰“å¼€çš„ç«¯ç‚¹" class="headerlink" title="é…ç½®æ‰“å¼€çš„ç«¯ç‚¹"></a>é…ç½®æ‰“å¼€çš„ç«¯ç‚¹</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span>           <span class="comment"># é€šè¿‡ actuatoræš´éœ²æ­¤æœåŠ¡çš„ç®¡ç†ç«¯å£</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span>              <span class="comment"># é€šè¿‡webæ¥æš´éœ²ç®¡ç†API,</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&quot;*&quot;</span>  <span class="comment"># * ä»£è¡¨å°†æ‰€æœ‰çš„ç«¯å£æš´éœ²  ä¸€å®šè¦åŠ &quot;&quot;,å› ä¸º *æ˜¯ç‰¹æ®Šå­—ç¬¦ï¼ŒåŠ &quot;&quot;é˜²æ­¢è½¬ä¹‰</span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹æ‰€æœ‰ç«¯ç‚¹éƒ½æŒ‚åœ¨&#x2F;actuator&#x2F;gateway&#x2F; ä¸‹é¢</p><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><ol><li>å¯ä»¥è®¿é—® ä½ çš„æœåŠ¡+&#x2F;actuator&#x2F;gateway&#x2F;routefilters,  è¿›è¡ŒæŸ¥çœ‹æ‰€æœ‰çš„è¿‡æ»¤å™¨å·¥å‚</li><li>&#x2F;actuator&#x2F;gateway&#x2F;routes:   å±•ç¤ºæ‰€æœ‰çš„è·¯ç”±åˆ—è¡¨</li></ol><h2 id="è‡ªå®šä¹‰è°“è¯å·¥å‚Predicates"><a href="#è‡ªå®šä¹‰è°“è¯å·¥å‚Predicates" class="headerlink" title="è‡ªå®šä¹‰è°“è¯å·¥å‚Predicates"></a>è‡ªå®šä¹‰è°“è¯å·¥å‚Predicates</h2><p>ä¼—æ‰€å‘¨çŸ¥ SpringCloud Gatewayæœ‰å¾ˆå¤šå†…ç½®çš„è°“è¯å·¥å‚,   ä¸€èˆ¬ç”¨çš„æœ€å¤šçš„æ˜¯é€šè¿‡<u>è·¯å¾„</u>è°“è¯å·¥å‚åˆ¤æ–­ã€‚</p><h3 id="åˆ†æPathRoutePredicateFactoryè°“è¯å·¥å‚"><a href="#åˆ†æPathRoutePredicateFactoryè°“è¯å·¥å‚" class="headerlink" title="åˆ†æPathRoutePredicateFactoryè°“è¯å·¥å‚"></a>åˆ†æPathRoutePredicateFactoryè°“è¯å·¥å‚</h3><p>è¦å®ç°è‡ªå®šä¹‰è°“è¯å·¥å‚ï¼Œæˆ‘ä»¬å…ˆåˆ†æ<code>PathRoutePredicateFactory</code>è°“è¯å·¥å‚.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.ç»§æ‰¿AbstractRoutePredicateFactory&lt;æ³›å‹è‡ªå·±çš„å†…éƒ¨é…ç½®ç±».Config&gt;</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PathRoutePredicateFactory</span> <span class="keyword">extends</span> <span class="title class_">AbstractRoutePredicateFactory</span>&lt;PathRoutePredicateFactory.Config&gt; &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">MATCH_TRAILING_SLASH</span> <span class="operator">=</span> <span class="string">&quot;matchTrailingSlash&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">PathPatternParser</span> <span class="variable">pathPatternParser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PathPatternParser</span>();</span><br><span class="line"><span class="comment">// **4.æŠŠé…ç½®ä¼ å›å»</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">PathRoutePredicateFactory</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="built_in">super</span>(Config.class);</span><br><span class="line">&#125;</span><br><span class="line">   <span class="comment">// **2.é‡å†™</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Predicate&lt;ServerWebExchange&gt; <span class="title function_">apply</span><span class="params">(Config config)</span> &#123;</span><br><span class="line"> <span class="comment">// ç•¥</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">GatewayPredicate</span>() &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(ServerWebExchange exchange)</span> &#123;</span><br><span class="line"><span class="comment">// ç•¥</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 3.å†…éƒ¨é…ç½®ç±», åé¢åˆ©ç”¨åå°„çš„æœºåˆ¶è¯»å–é…ç½®ä¿¡æ¯</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Config</span> &#123;</span><br><span class="line"><span class="keyword">private</span> List&lt;String&gt; patterns = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">matchTrailingSlash</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">public</span> List&lt;String&gt; <span class="title function_">getPatterns</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> patterns;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> Config <span class="title function_">setPatterns</span><span class="params">(List&lt;String&gt; patterns)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.patterns = patterns;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä»…ä¿ç•™ä¸»æ¡†æ¶ç»“æ„</p></blockquote><p>å¯¹äºå·¥å‚æ¨¡å¼:  è¯¥è°“è¯å·¥å‚æ¨¡å¼é€šè¿‡ç»§æ‰¿äº†ä¸€ä¸ªæŠ½è±¡å·¥å‚,  å®ç°é‡å†™applyæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// RoutePredicateFactoryä¸ºAbstractRoutePredicateFactoryç»§æ‰¿çš„æ¥å£</span></span><br><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RoutePredicateFactory</span>&lt;C&gt; <span class="keyword">extends</span> <span class="title class_">ShortcutConfigurable</span>, Configurable&lt;C&gt; &#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Pattern key.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">String</span> <span class="variable">PATTERN_KEY</span> <span class="operator">=</span> <span class="string">&quot;pattern&quot;</span>;</span><br><span class="line"><span class="comment">// å·¥å‚æ–¹æ³• æ ¸å¿ƒæ–¹æ³•</span></span><br><span class="line"><span class="keyword">default</span> Predicate&lt;ServerWebExchange&gt; <span class="title function_">apply</span><span class="params">(Consumer&lt;C&gt; consumer)</span> &#123;</span><br><span class="line"><span class="type">C</span> <span class="variable">config</span> <span class="operator">=</span> newConfig(); <span class="comment">// é…ç½®æ–‡ä»¶</span></span><br><span class="line">consumer.accept(config); </span><br><span class="line">beforeApply(config);    <span class="comment">// ç”Ÿæˆ</span></span><br><span class="line"><span class="keyword">return</span> apply(config);</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">// ç•¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æœ€æ ¸å¿ƒçš„å°±æ˜¯ <strong>å†…éƒ¨é…ç½®ç±»</strong>å’Œ<strong>apply</strong>æ–¹æ³•</p><p>å…¶ä¸­å†…éƒ¨é…ç½®ç±»ä¸­ patternsæ˜¯ä¸€ä¸ªListé›†åˆ,  æ¨¡å¼å¯ä»¥æœ‰<u>å¤šä¸ª</u> .</p><p>è¯»å–åˆ°é…ç½®ç±»,  ç”Ÿæˆè°“è¯è¯­å¥,   ç„¶åéå†è§£æåˆ¤æ–­</p><h4 id="å°ç»“è®º"><a href="#å°ç»“è®º" class="headerlink" title="å°ç»“è®º"></a>å°ç»“è®º</h4><p>é‚£ä¹ˆåˆ°è¿™å„¿å¯ä»¥å¾—å‡ºä¸€ä¸ªç»“è®º,  å› ä¸ºæ˜¯ä¸€ä¸ªä¸€ä¸ªçš„éå†è§£æåˆ¤æ–­,  é‚£ä¹ˆå°±ä¸€å®šå­˜åœ¨æ‰§è¡Œçš„<u>å…ˆåé¡ºåº</u>é—®é¢˜,   æ‰€ä»¥<wavy>,é€šç”¨é…ç½®å†™åœ¨åé¢</wavy>,   ç‰¹å®šé…ç½®å†™åœ¨å‰é¢</p><h3 id="è‡ªå®šä¹‰è°“è¯å·¥å‚"><a href="#è‡ªå®šä¹‰è°“è¯å·¥å‚" class="headerlink" title="è‡ªå®šä¹‰è°“è¯å·¥å‚"></a>è‡ªå®šä¹‰è°“è¯å·¥å‚</h3><p>ä¾‹å¦‚æˆ‘éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªåœ¨æ—¶é—´åŒºé—´çš„(éœ€è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°)</p><ol><li>åœ¨ç½‘å…³æ¨¡å—</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> TimeBetweenRoutePredicateFactory</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> è‡ªå®šä¹‰æ—¶é—´è°“è¯å·¥å‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> Calyee</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TimeBetweenRoutePredicateFactory</span> <span class="keyword">extends</span> <span class="title class_">AbstractRoutePredicateFactory</span>&lt;TimeBetweenRoutePredicateFactory.Config&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ„é€ å™¨ä¼ å…¥å†…éƒ¨ç±»çš„å­—èŠ‚ç æ–‡ä»¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TimeBetweenRoutePredicateFactory</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(Config.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Predicate&lt;ServerWebExchange&gt; <span class="title function_">apply</span><span class="params">(Config config)</span> &#123;</span><br><span class="line">        <span class="comment">// ä»å†…éƒ¨é…ç½®ç±»ä¸­è·å–é…ç½®å±æ€§</span></span><br><span class="line">        <span class="type">LocalTime</span> <span class="variable">startTime</span> <span class="operator">=</span> config.getStartTime();</span><br><span class="line">        <span class="type">LocalTime</span> <span class="variable">endTime</span> <span class="operator">=</span> config.getEndTime();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Predicate</span>&lt;ServerWebExchange&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(ServerWebExchange serverWebExchange)</span> &#123;</span><br><span class="line">                <span class="comment">// å½“å‰æ—¶é—´</span></span><br><span class="line">                <span class="type">LocalTime</span> <span class="variable">now</span> <span class="operator">=</span> LocalTime.now();</span><br><span class="line">                <span class="keyword">return</span> now.isAfter(startTime) &amp;&amp; now.isBefore(endTime);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">START_TIME</span> <span class="operator">=</span> <span class="string">&quot;startTime&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">END_TIME</span> <span class="operator">=</span> <span class="string">&quot;endTime&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨äºæ¥æ”¶ymlä¸­çš„ä¸¤ä¸ªå‚æ•° </span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">shortcutFieldOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Arrays.asList(START_TIME, END_TIME);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å†…éƒ¨é…ç½®ç±»ä¸¤ä¸ªå‚æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Config</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> LocalTime startTime;</span><br><span class="line">        <span class="keyword">private</span> LocalTime endTime;</span><br><span class="line">        <span class="comment">// Getter Setter</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="2"><li>é…ç½®å¥½åœ¨å¯åŠ¨çš„æ—¶å€™ä¼šå‡ºç°</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2023-12-20 21:28:41.488  INFO 6268 --- [           main] o.s.c.g.r.RouteDefinitionRouteLocator    : Loaded RoutePredicateFactory [TimeBetween]</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå°±è¯æ˜å·²ç»è¢«æ‰˜ç®¡äº†</p><ol start="3"><li>Yaml</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gateway</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">food-service</span> <span class="comment"># è·¯ç”±è§„åˆ™idï¼Œè‡ªå®šä¹‰ï¼Œå”¯ä¸€</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://food-service</span> <span class="comment"># è·¯ç”±çš„ç›®æ ‡æœåŠ¡ï¼Œlbä»£è¡¨è´Ÿè½½å‡è¡¡ï¼Œä¼šä»æ³¨å†Œä¸­å¿ƒæ‹‰å–æœåŠ¡åˆ—è¡¨</span></span><br><span class="line">          <span class="attr">predicates:</span> <span class="comment"># è·¯ç”±æ–­è¨€ï¼Œåˆ¤æ–­å½“å‰è¯·æ±‚æ˜¯å¦ç¬¦åˆå½“å‰è§„åˆ™ï¼Œç¬¦åˆåˆ™è·¯ç”±åˆ°ç›®æ ‡æœåŠ¡</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/resfood/**</span> <span class="comment"># è¿™é‡Œæ˜¯ä»¥è¯·æ±‚è·¯å¾„ä½œä¸ºåˆ¤æ–­è§„åˆ™</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">TimeBetween=ä¸Šåˆ06:00,ä¸‹åˆ09:00</span></span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥è·å–è¿™ä¸¤ä¸ªå‚æ•°äº†,  åŒ¹é…åˆ°åˆ™ä¼šè¿›è¡Œåˆ°æˆ‘ä»¬è‡ªå®šä¹‰çš„è°“è¯åˆ¤æ–­</p><h2 id="ç™»å½•æ ¡éªŒ-ç½‘å…³ç™»å½•æ ¡éªŒ"><a href="#ç™»å½•æ ¡éªŒ-ç½‘å…³ç™»å½•æ ¡éªŒ" class="headerlink" title="ç™»å½•æ ¡éªŒ(#ç½‘å…³ç™»å½•æ ¡éªŒ)"></a>ç™»å½•æ ¡éªŒ(#ç½‘å…³ç™»å½•æ ¡éªŒ)</h2><h3 id="å½“å‰-ç™»å½•æ ¡éªŒ-ä¸-ç½‘å…³ç™»å½•æ ¡éªŒ-æœ¬åº”ä¸ºçˆ¶å­å±‚çº§å…³ç³»"><a href="#å½“å‰-ç™»å½•æ ¡éªŒ-ä¸-ç½‘å…³ç™»å½•æ ¡éªŒ-æœ¬åº”ä¸ºçˆ¶å­å±‚çº§å…³ç³»" class="headerlink" title="å½“å‰#ç™»å½•æ ¡éªŒ ä¸#ç½‘å…³ç™»å½•æ ¡éªŒ æœ¬åº”ä¸ºçˆ¶å­å±‚çº§å…³ç³»"></a>å½“å‰#ç™»å½•æ ¡éªŒ ä¸#ç½‘å…³ç™»å½•æ ¡éªŒ æœ¬åº”ä¸ºçˆ¶å­å±‚çº§å…³ç³»</h3><p><strong>å‡ºç°åœ¨è¿™æ˜¯ç”±äº #Actuatorç›‘æ§ ä¼˜å…ˆçº§é«˜äºæ­¤, æ•…å½“å‰å°ç»“é€€åæå‡ä¸€çº§</strong></p><p>å¯¹äºç™»å½•æ ¡éªŒï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨åŒç§˜é’¥ï¼šæœåŠ¡å™¨ä¸€ä¸ªç§˜é’¥ï¼Œç½‘å…³ä¸€ä¸ªç§˜é’¥ï¼Œè¯¥æ–¹æ¡ˆä¸ºéå¯¹ç§°åŠ å¯†ã€‚</p><ul><li><p><u>å¯¹ç§°åŠ å¯†</u>ï¼šåˆ©ç”¨ä¸€ä¸ªç§˜é’¥åŠ å¯†ç„¶åå†é‡‡ç”¨è¯¥ç§˜é’¥éªŒç­¾ï¼Œé‚£ä¹ˆæ‹¿åˆ°ç§˜é’¥å°±å¯ä»¥å®ç°ç§˜é’¥ä¸æ˜æ–‡äº’ç›¸è½¬æ¢ã€‚</p></li><li><p><u>éå¯¹ç§°åŠ å¯†</u>ï¼šæœåŠ¡å™¨ä¸€ä¸ªç§˜é’¥ï¼ˆç§é’¥ï¼‰ï¼Œç½‘å…³ä¸€ä¸ªç§˜é’¥ï¼ˆå…¬é’¥ï¼‰ï¼Œç§é’¥åŠ å¯†çš„ç§˜é’¥å¯ä»¥è¢«ç§é’¥éªŒç­¾ï¼Œå…¬é’¥åŠ å¯†çš„ç§˜é’¥åªæœ‰ç§é’¥æ‰èƒ½è¿›è¡ŒéªŒç­¾ï¼ˆè‡ªå·±åŠ å¯†ä¸èƒ½è§£å¯†è‡ªå·±ï¼‰ï¼Œå…¬é’¥å¯ä»¥å…¬å¼€ï¼Œä»»ä½•äººéƒ½å¯ä»¥ä½¿ç”¨å®ƒæ¥åŠ å¯†æ¶ˆæ¯ï¼Œä½†åªæœ‰ç§é’¥çš„æŒæœ‰è€…æ‰èƒ½å°†å…¶è§£å¯†</p></li></ul><h3 id="JWTå·¥å…·"><a href="#JWTå·¥å…·" class="headerlink" title="JWTå·¥å…·"></a>JWTå·¥å…·</h3><p>å½“å‰(<strong>ç½‘å…³ç™»å½•æ ¡éªŒ</strong>)éƒ¨åˆ†å¾…å®Œæˆâ€¦</p><h2 id="é…ç½®ç®¡ç†"><a href="#é…ç½®ç®¡ç†" class="headerlink" title="é…ç½®ç®¡ç†"></a>é…ç½®ç®¡ç†</h2><p>åˆ°æ­¤å®Œæˆäº†åœ¨å¾®æœåŠ¡ç›¸å…³çš„é—®é¢˜:</p><ul><li>è¿œç¨‹è°ƒç”¨</li><li>æœåŠ¡æ³¨å†Œå‘ç°</li><li>è¯·æ±‚è·¯ç”±ç½‘å…³ã€è´Ÿè½½å‡è¡¡</li><li>ç™»å½•ä¿¡æ¯æ‹¦æˆªä¼ é€’ï¼ˆä¸Šç« èŠ‚æœªå®Œæˆï¼‰</li></ul><p>åˆ°è¿™å„¿å¯ä»¥å‘ç°ï¼Œé…ç½®æ–‡ä»¶å…¨æ˜¯å†™æ­»çš„ï¼Œéå¸¸ä¸çµæ´»</p><ul><li>å¦‚æœä¿®æ”¹å¿…é¡»é‡æ–°å¯åŠ¨å¾®æœåŠ¡</li><li>å¯¹äºå¾ˆå¤šé‡å¤çš„é…ç½®æ˜¾ç„¶å¯ä»¥æŠ½å–å‡ºæ¥</li></ul><p>è¿™äº›é—®é¢˜éƒ½å¯ä»¥é€šè¿‡ç»Ÿä¸€çš„<strong>é…ç½®ç®¡ç†å™¨æœåŠ¡</strong>è§£å†³ã€‚è€ŒNacosä¸ä»…ä»…å…·å¤‡æ³¨å†Œä¸­å¿ƒåŠŸèƒ½ï¼Œä¹Ÿå…·å¤‡é…ç½®ç®¡ç†çš„åŠŸèƒ½ï¼š</p><p><img src="https://calyee-image.pages.dev/file/2e4c389170ce5a0f05ea6.png"></p><p>å¾®æœåŠ¡å…±äº«çš„é…ç½®å¯ä»¥ç»Ÿä¸€äº¤ç»™Nacosä¿å­˜å’Œç®¡ç†ï¼Œåœ¨Nacosæ§åˆ¶å°ä¿®æ”¹é…ç½®åï¼ŒNacosä¼šå°†é…ç½®å˜æ›´æ¨é€ç»™ç›¸å…³çš„å¾®æœåŠ¡ï¼Œå¹¶ä¸”æ— éœ€é‡å¯å³å¯ç”Ÿæ•ˆï¼Œå®ç°é…ç½®çƒ­æ›´æ–°ã€‚</p><p>ç½‘å…³çš„è·¯ç”±åŒæ ·æ˜¯é…ç½®ï¼Œå› æ­¤åŒæ ·å¯ä»¥åŸºäºè¿™ä¸ªåŠŸèƒ½å®ç°åŠ¨æ€è·¯ç”±åŠŸèƒ½ï¼Œæ— éœ€é‡å¯ç½‘å…³å³å¯ä¿®æ”¹è·¯ç”±é…ç½®ã€‚</p><hr><p>åˆ°äº†æ­¤å¤„ï¼Œæˆ‘ä»¬åº”è¯¥äº†è§£é…ç½®ä¸­å¿ƒçš„æ¶æ„å›¾äº†</p><p><img src="https://calyee-image.pages.dev/file/e2cef8a8cd3b397fe23a7.png"></p><p>ä¸éš¾çœ‹å‡ºæ¥ï¼Œè¯¥å¤„ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼ä¸º<u>è§‚å¯Ÿè€…æ¨¡å¼</u>ï¼Œé€šè¿‡ç›‘å¬é…ç½®çš„å˜åŒ–ï¼Œé€šçŸ¥å®¢æˆ·ç«¯ä¿®æ”¹é…ç½®ï¼Œå¯¹äºNacosçš„æŒä¹…åŒ–ä¿¡æ¯å¤„ç†é‡‡ç”¨ç§»å…¥MySQLçš„æ–¹æ¡ˆ</p><h3 id="æŠ½å–é…ç½®éƒ¨ç½²åœ¨Nacosï¼ˆå…¥é—¨ï¼‰"><a href="#æŠ½å–é…ç½®éƒ¨ç½²åœ¨Nacosï¼ˆå…¥é—¨ï¼‰" class="headerlink" title="æŠ½å–é…ç½®éƒ¨ç½²åœ¨Nacosï¼ˆå…¥é—¨ï¼‰"></a>æŠ½å–é…ç½®éƒ¨ç½²åœ¨Nacosï¼ˆå…¥é—¨ï¼‰</h3><p>å¯¹äºæŠ½å–é…ç½®æˆ‘ä»¬å¿…é¡»çŸ¥é“ï¼š é…ç½®æ–‡ä»¶ä¹Ÿæ˜¯æœ‰æ‰§è¡Œé¡ºåºçš„</p><h4 id="å…¥é—¨æ¡ˆä¾‹ï¼šäº†è§£ç»“æ„"><a href="#å…¥é—¨æ¡ˆä¾‹ï¼šäº†è§£ç»“æ„" class="headerlink" title="å…¥é—¨æ¡ˆä¾‹ï¼šäº†è§£ç»“æ„"></a>å…¥é—¨æ¡ˆä¾‹ï¼šäº†è§£ç»“æ„</h4><div class="note primary flat"><p>éœ€æ±‚ç‚¹ï¼šåœ¨å¾®æœåŠ¡<u>å¯åŠ¨æ—¶</u>å°±è¦è®¿é—®nacosé…ç½®ä¸­å¿ƒ</p></div><p>å¯¹äºéœ€è¦æ»¡è¶³æ­¤éœ€æ±‚ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£åœ¨nacosä¸­å¦‚ä½•ç®¡ç†é…ç½®æ–‡ä»¶ã€‚</p><p>å¯åŠ¨nacosï¼Œä¸ºä½ çš„é¡¹ç›®èµ·ä¸€ä¸ªå‘½åç©ºé—´ï¼ˆå¯é€‰ï¼‰ï¼Œåœ¨é…ç½®åˆ—è¡¨é€‰æ‹©ä¸€ä¸ªå‘½åç©ºé—´ï¼Œåœ¨å‘½åç©ºé—´ä¸­æ·»åŠ é…ç½®æ–‡ä»¶ï¼Œæ­¤æ—¶å¯ä»¥çœ‹åˆ°ä¸€ä¸ªåä¸º<strong>Data Id</strong>çš„å­—æ®µï¼Œå¯¹äºè¯¥å­—æ®µç¬”è€…å»ºè®®å–ä¾‹å¦‚è¯¥ï¼š<code>cloud-user-dev.yml</code>,  å¯¹äºè¯¥é…ç½®å‘½åçš„è§£é‡Š:  <code>$&#123;prefix&#125;-$&#123;spring.profiles.active&#125;.$&#123;file-extension&#125;</code></p><p>æ˜“çŸ¥:  <code>prefix</code>ä¸ºå‰ç¼€å,  <code>spring.profiles.active</code>ä¸ºé…ç½®ç”Ÿæ•ˆçš„ç¯å¢ƒ,  <code>file-extension</code>ä¸ºæ–‡ä»¶åç¼€</p><p>åˆ°è¿™å¯èƒ½ä¼šäº§ç”Ÿä¸€ä¸ªç–‘é—®ï¼šä¸ºä»€ä¹ˆéœ€è¦è¿™æ ·å–ï¼Ÿ å› ä¸ºè¿™æ ·å–åä¸€ç›®äº†ç„¶ä¸”SpringBootä¸­çš„nacosé…ç½®æ–‡ä»¶å°±æ˜¯è¯»å–è¿™æ ·çš„ç»“æ„ï¼ˆå¦‚ä¸‹å›¾ï¼‰</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span> <span class="comment"># æœåŠ¡åœ°å€</span></span><br><span class="line">        <span class="comment"># namespace -&gt; group   =&gt;  $&#123;prefix&#125;-$&#123;spring.profiles.active&#125;.$&#123;file-extension&#125;</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">res</span>       <span class="comment"># å‘½åç©ºé—´</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">DEFAULT_GROUP</span> <span class="comment"># åˆ†ç»„</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">nacos</span>     <span class="comment"># nacosç™»å½•é…ç½®</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">nacos</span></span><br><span class="line">        <span class="attr">prefix:</span> <span class="string">cloud-user</span>   <span class="comment"># æœåŠ¡å</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yml</span>  <span class="comment"># åç¼€å</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">prod</span>             <span class="comment"># ç”Ÿæ•ˆçš„é…ç½®å</span></span><br></pre></td></tr></table></figure><p>åœ¨è¯»å–åå°±ä¼šè‡ªåŠ¨æ‹¼æ¥ã€‚</p><p>åœ¨è¿™é‡Œçš„æ—¶å€™ä¼šæƒ³ï¼šåˆ°åº•æ˜¯ä»€ä¹ˆæ–‡ä»¶æ‰èƒ½è®©ä»–åœ¨å¯åŠ¨æ—¶å°±å¯ä»¥è®¿é—®ï¼Œåœ¨ä¹‹å‰æˆ‘ä»¬çŸ¥é“é…ç½®æ–‡ä»¶æœ‰ä¿©ç§æ–¹æ¡ˆï¼ˆå¿½ç•¥ä¸åŒåç¼€é…ç½®ï¼‰</p><ul><li>é€šè¿‡<code>application.yml</code>çš„é…ç½®æ–‡ä»¶é…ç½®</li><li>åœ¨å¯åŠ¨æ—¶é€šè¿‡å‘½ä»¤è¡Œä¾‹å¦‚<code>-Dserver.port=8080</code>: æ­¤é¡¹å¿…é¡»å»ºç«‹åœ¨å¯åŠ¨ç±»ä¼ å…¥äº†argsçš„æƒ…å†µ</li></ul><p>é˜…è¯»åˆ°è¿™  ä»–ä»¬ä¿©çš„åŠ è½½é¡ºåºå‡­ç»éªŒå°±å¯ä»¥çŸ¥é“:  å‘½ä»¤è¡Œ &gt; application.yml</p><h5 id="è§£æbootstrap-yml"><a href="#è§£æbootstrap-yml" class="headerlink" title="è§£æbootstrap.yml"></a>è§£æbootstrap.yml</h5><p>application.ymlä¸bootstrap.ymlçš„åŒºåˆ«:  </p><ul><li>åŠ è½½é¡ºåº</li></ul><p>bootstrap.ymlå…ˆåŠ è½½ï¼Œapplication.ymlååŠ è½½ã€‚bootstrap.ymlç”¨äºåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡çš„å¼•å¯¼é˜¶æ®µï¼Œç”±<u>çˆ¶Spring ApplicationContext</u>åŠ è½½ã€‚</p><ul><li>é…ç½®åŒºåˆ«</li></ul><p>bootstrap.ymlç”¨æ¥ç¨‹åºå¼•å¯¼æ—¶æ‰§è¡Œï¼Œåº”ç”¨äºæ›´åŠ æ—©æœŸé…ç½®ä¿¡æ¯è¯»å–ï¼Œå¯ä»¥ç†è§£æˆç³»ç»Ÿçº§åˆ«çš„ä¸€äº›å‚æ•°é…ç½®ï¼Œè¿™äº›å‚æ•°ä¸€èˆ¬æ˜¯ä¸ä¼šå˜åŠ¨çš„ã€‚ä¸€æ—¦bootStrap.ymlè¢«åŠ è½½ï¼Œåˆ™å†…å®¹ä¸ä¼šè¢«è¦†ç›–ã€‚application.ymlå¯ä»¥ç”¨æ¥å®šä¹‰åº”ç”¨çº§åˆ«çš„ï¼Œåº”ç”¨ç¨‹åºç‰¹æœ‰é…ç½®ä¿¡æ¯ï¼Œå¯ä»¥ç”¨æ¥é…ç½®åç»­å„ä¸ªæ¨¡å—ä¸­éœ€ä½¿ç”¨çš„å…¬å…±å‚æ•°ç­‰ã€‚</p><ul><li>å±æ€§è¦†ç›–é—®é¢˜</li></ul><p>å¯åŠ¨ä¸Šä¸‹æ–‡æ—¶ï¼ŒSpring Cloudä¼šåˆ›å»ºä¸€ä¸ªBootstrap Contextï¼Œä½œä¸ºSpringåº”ç”¨çš„Application Contextçš„çˆ¶ä¸Šä¸‹æ–‡ã€‚åˆå§‹åŒ–çš„æ—¶å€™ï¼ŒBootstrap Contextè´Ÿè´£ä»å¤–éƒ¨æºåŠ è½½é…ç½®å±æ€§å¹¶è§£æé…ç½®ã€‚è¿™ä¸¤ä¸ªä¸Šä¸‹æ–‡å…±äº«ä¸€ä¸ªä»å¤–éƒ¨è·å–çš„Environmentã€‚Bootstrapå±æ€§æœ‰é«˜ä¼˜å…ˆçº§ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä»¬ä¸ä¼šè¢«æœ¬åœ°é…ç½®è¦†ç›–ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœåŠ è½½çš„application.ymlçš„å†…å®¹æ ‡ç­¾ä¸bootstrapçš„æ ‡ç­¾ä¸€è‡´ï¼Œapplicationä¹Ÿä¸ä¼šè¦†ç›–bootstrapï¼Œè€Œapplication.ymlé‡Œé¢çš„å†…å®¹å¯ä»¥åŠ¨æ€æ›¿æ¢ã€‚</p><ul><li>å¦‚ä½•ä½¿ç”¨</li></ul><p>åœ¨springcloud2020ä»¥åç¦ç”¨äº†bootstrap.yml,å¦‚è¦é‡æ–°æ‰“å¼€ï¼Œåˆ™éœ€å¯¼å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bootstrap<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="å¦‚ä½•ç®€å•çš„ä½¿ç”¨"><a href="#å¦‚ä½•ç®€å•çš„ä½¿ç”¨" class="headerlink" title="å¦‚ä½•ç®€å•çš„ä½¿ç”¨"></a>å¦‚ä½•ç®€å•çš„ä½¿ç”¨</h4><ol><li>å¯¼å…¥ä¾èµ–</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--å¼€å¯å¯¹bootstrap.ymlæ”¯æŒ--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bootstrap<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--å¼€å¯nacosé…ç½®ä¸­å¿ƒæ”¯æŒ--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--ç›‘æ§(å¦‚æœè¦åŠ¨æ€æ›´æ–°å¿…é¡»å¯¼å…¥è¯¥ç›‘æ§ä¾èµ–)--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>åˆ©ç”¨bootstrap.ymlåšå¯åŠ¨é…ç½®(å›¾ä¾‹å†ç°)</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848#</span> <span class="string">æœåŠ¡åœ°å€</span></span><br><span class="line">        <span class="comment"># namespace -&gt; group   =&gt;  $&#123;prefix&#125;-$&#123;spring.profiles.active&#125;.$&#123;file-extension&#125;</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">res</span>       <span class="comment"># å‘½åç©ºé—´</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">DEFAULT_GROUP</span> <span class="comment"># åˆ†ç»„</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">nacos</span>     <span class="comment"># nacosç™»å½•é…ç½®</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">nacos</span></span><br><span class="line">        <span class="attr">prefix:</span> <span class="string">cloud-user</span>   <span class="comment"># æœåŠ¡å</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yml</span>  <span class="comment"># åç¼€å</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">prod</span>             <span class="comment"># ç”Ÿæ•ˆçš„é…ç½®å</span></span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°çš„é…ç½®é…ç½®å®Œæˆä¹‹å,  å¯ä»¥åœ¨nacoså°è¯•å‘å¸ƒ(ç¤ºä¾‹é…ç½®)</p><p><img src="https://calyee-image.pages.dev/file/e7d6cf82c4362d29fbfa6.png"></p><p>æ­¤æ—¶é…ç½®å®Œæˆ(ç¬¼ç»Ÿçš„é…ç½®),  åœ¨é¡¹ç›®ä¸­çš„é…ç½®(application.yml)å°±å¯ä»¥è¯•ç€æ³¨é‡Šæ‰äº†,  è¿˜æ˜¯å’ŒåŸæ¥çš„å¯åŠ¨ç»“æœä¸€æ ·</p><p>æ¢ç´¢ç‚¹:  æ­¤æ—¶æˆ‘ä»¬å¯ä»¥è¯•ç€æŠŠç«¯å£ä¿®æ”¹ä¸€ä¸‹ç„¶åé‡å¯çœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆå¥‡æ•ˆ</p><h3 id="åŠ¨æ€åˆ·æ–°"><a href="#åŠ¨æ€åˆ·æ–°" class="headerlink" title="åŠ¨æ€åˆ·æ–°"></a>åŠ¨æ€åˆ·æ–°</h3><p>åˆ°è¿™çš„æ—¶å€™,  æˆ‘ä»¬åœ¨ä¸Šä¸€ç« èŠ‚çš„éœ€æ±‚ä¼¼ä¹å°±å®Œæˆäº†,  è™½ç„¶æŠ½å–äº†å¯åŠ¨çš„æ—¶å€™çš„é…ç½®æ–‡ä»¶,  è¿™æ ·ä¼¼ä¹æ¯”ä¹‹å‰ç¡®å®å¥½å¾ˆå¤šäº†,  å¯ä»¥åŠ¨æ€ä¿®æ”¹ç«¯å£è¿™äº›</p><p>æˆ‘ä»¬è¿˜éœ€è¦åŠ¨æ€åˆ·æ–°å…¶ä»–çš„å±æ€§å…¶ä»–çš„å€¼å‘¢?</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ³¨è§£<code>@RefreshScope</code>å»è·å–åˆ°åŠ¨æ€åˆ·æ–°çš„å€¼   æ ·ä¾‹å¦‚ä¸‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="meta">@RefreshScope</span> <span class="comment">// åŠ åœ¨ç±»ä¸Šå¯ä»¥è‡ªåŠ¨æ„ŸçŸ¥å±æ€§çš„å˜åŒ–</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="comment">// è¯»å–é…ç½®æ–‡ä»¶å±æ€§å€¼my.pattern.dateFormatString</span></span><br><span class="line">    <span class="meta">@Value(&quot;#&#123;my.pattern.dateFormatString&#125;&quot;)</span> </span><br><span class="line">    <span class="keyword">private</span> String dateFormatString;</span><br><span class="line">     </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/getTimeInfo&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">getInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        <span class="type">DateFormat</span> <span class="variable">df</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(dateFormatString);</span><br><span class="line">        <span class="type">String</span> <span class="variable">formatTime</span> <span class="operator">=</span> df.format(date);</span><br><span class="line">        <span class="keyword">return</span> Result.ok(formatTime);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åªéœ€è¦åœ¨nacosçš„å½“å‰é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹<code>my.pattern.dateFormatString</code>çš„å€¼å°±å¯ä»¥åŠ¨æ€ä¿®æ”¹æ—¶é—´çš„æ ¼å¼äº†(yyyy-MM-dd HH:mm:ss  -&gt; yyyyå¹´MMæœˆddæ—¥ HH:mm:ss)</p><ul><li>åŠ åœ¨ç±»ä¸Šå¯ä»¥è‡ªåŠ¨æ„ŸçŸ¥å±æ€§çš„å˜åŒ–</li><li>åŠ åœ¨æ–¹æ³•ä¸Šå¯ä»¥æ„ŸçŸ¥æ–¹æ³•é‡Œé¢çš„å€¼å˜åŒ–</li></ul><blockquote><p>å½“å‰æè¿°çš„å€¼ä¸ºè¢«ç»‘å®šè¿‡çš„å€¼</p></blockquote><p>é‚£ä¹ˆåº•å±‚è‚¯å®šæ˜¯ç»“åˆäº† SpringBootä¸­çš„<code>actuator</code>çš„æ”¯æŒ,  å¹¶ä¸”å¼€æ”¾äº† refreshScopeç«¯ç‚¹çš„æ”¯æŒ,  é‚£ä¹ˆæ‰èƒ½åŠ¨æ€æ„ŸçŸ¥,  å…¶å®å°±æ˜¯nacosæœåŠ¡å™¨å‘é¡¹ç›®çš„ç«¯ç‚¹(refreshScope)å‘äº†ä¸€ä¸ªè¯·æ±‚ (POST &#x2F;actuator&#x2F;refresh)</p><h3 id="é…ç½®æ–‡ä»¶ç‰ˆæœ¬æ§åˆ¶"><a href="#é…ç½®æ–‡ä»¶ç‰ˆæœ¬æ§åˆ¶" class="headerlink" title="é…ç½®æ–‡ä»¶ç‰ˆæœ¬æ§åˆ¶"></a>é…ç½®æ–‡ä»¶ç‰ˆæœ¬æ§åˆ¶</h3><p>åœ¨nacosçš„é…ç½®ç®¡ç†ä¸­æœ‰ä¸€ä¸ªé…ç½®å›æ»šé¡¹(åä¸º:å†å²ç‰ˆæœ¬)</p><h3 id="é…ç½®å…±äº«"><a href="#é…ç½®å…±äº«" class="headerlink" title="é…ç½®å…±äº«"></a>é…ç½®å…±äº«</h3><p>æˆ‘ä»¬å¯ä»¥æŠŠå¾®æœåŠ¡å…±äº«çš„é…ç½®æŠ½å–åˆ°Nacosä¸­ç»Ÿä¸€ç®¡ç†ï¼Œè¿™æ ·å°±ä¸éœ€è¦æ¯ä¸ªå¾®æœåŠ¡éƒ½é‡å¤é…ç½®äº†ã€‚åˆ†ä¸ºä¸¤æ­¥ï¼š</p><ul><li>åœ¨Nacosä¸­æ·»åŠ å…±äº«é…ç½®</li><li>å¾®æœåŠ¡æ‹‰å–é…ç½®</li></ul><p>å¦‚ä½•æ·»åŠ å…±äº«é…ç½®å‘¢?  æ•°æ®åº“å½“ç„¶å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ª, Redisä¹Ÿå¯ä»¥ â€¦</p><p>é‚£ä¹ˆæŠŠä»–ä»¬çš„é…ç½®ç»™æŠ½å–å‡ºæ¥ ä¾‹å¦‚: <code>mysql8-local.yml</code>å’Œ<code>redis-local.yml</code></p><p>åœ¨nacosé…ç½®ä¸­åˆ›å»ºè¯¥ç¤ºä¾‹</p><p>æŠ½å–å‰é¢ç¬¼ç»Ÿçš„é…ç½®(mysqlå’Œredisçš„é…ç½®ç­‰),  å½“ç„¶ä¹Ÿå¯ä»¥æŠ½å–å…¶ä»–çš„ä¾‹å¦‚æ—¥å¿—</p><p>ä¾‹å¦‚æŠ½å–åœ¨nacosçš„redisé…ç½®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="comment"># sessionä¿å­˜åˆ°redis</span></span><br><span class="line">  <span class="attr">session:</span></span><br><span class="line">    <span class="attr">store-type:</span> <span class="string">redis</span></span><br><span class="line">  <span class="comment">#Redisç›¸å…³é…ç½®</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span>  <span class="comment"># docker åä¿®æ”¹</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="comment">#password:123456</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">0</span> <span class="comment">#0æ˜¯0å·æ•°æ®åº“ï¼Œredisé»˜è®¤å¼€å¯çš„16ä¸ªæ•°æ®åº“</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="number">5000</span> <span class="comment">#è¶…æ—¶æ—¶é—´</span></span><br><span class="line">    <span class="attr">jedis:</span></span><br><span class="line">      <span class="comment">#Redisè¿æ¥æ± é…ç½®</span></span><br><span class="line">      <span class="attr">pool:</span></span><br><span class="line">        <span class="attr">max-active:</span> <span class="number">8</span> <span class="comment">#æœ€å¤§è¿æ¥æ•°</span></span><br><span class="line">        <span class="attr">max-wait:</span> <span class="string">1ms</span> <span class="comment">#è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´</span></span><br><span class="line">        <span class="attr">max-idle:</span> <span class="number">4</span> <span class="comment">#è¿æ¥æ± ä¸­æœ€å¤§ç©ºé—²è¿æ¥</span></span><br><span class="line">        <span class="attr">min-idle:</span> <span class="number">0</span> <span class="comment">#è¿æ¥æ± ä¸­æœ€å°ç©ºé—²è¿æ¥</span></span><br></pre></td></tr></table></figure><p>æŠ½å–å®Œæˆä¹‹åæˆ‘ä»¬éœ€è¦åœ¨bootstrap.ymlä¸­å¢åŠ é¡¹(å‰é¢å¸¦+,  å¦‚éœ€ç¼©å‡åˆ™+å˜ç©ºæ ¼)</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">        <span class="comment"># namespace -&gt; group   =&gt;  $&#123;prefix&#125;-$&#123;spring.profiles.active&#125;.$&#123;file-extension&#125;</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">res</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">DEFAULT_GROUP</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">nacos</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">nacos</span></span><br><span class="line">        <span class="attr">prefix:</span> <span class="string">food-service</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yml</span></span><br><span class="line"><span class="string">+</span>       <span class="attr">shared-configs:</span></span><br><span class="line"><span class="string">+</span>         <span class="bullet">-</span> &#123; <span class="attr">dataId:</span> <span class="string">&#x27;redis-local.yml&#x27;</span>,<span class="attr">refresh:</span> <span class="literal">true</span> &#125;  <span class="comment"># è¯¦æƒ…é…ç½®å¯ä»¥è¿½è¸ªè¯¥é¡¹</span></span><br><span class="line"><span class="string">+</span>         <span class="bullet">-</span> &#123; <span class="attr">dataId:</span> <span class="string">&#x27;mysql8-local.yml&#x27;</span>,<span class="attr">refresh:</span> <span class="literal">true</span> &#125;</span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">prod</span></span><br></pre></td></tr></table></figure><blockquote><p>ä¸Šè¿°ä¿©é¡¹é…ç½®å,  éœ€åœ¨å‰é¢çš„ç¬¼ç»Ÿé…ç½®ä¸­åˆ é™¤é‡å¤é¡¹</p></blockquote><p>å¤§åŠŸå‘Šæˆ !</p><h4 id="å°ä»»åŠ¡"><a href="#å°ä»»åŠ¡" class="headerlink" title="å°ä»»åŠ¡"></a>å°ä»»åŠ¡</h4><div class="note primary flat"><p>éœ€æ±‚ç‚¹ï¼šç»“åˆnacosé…ç½®ä¸­å¿ƒå®Œæˆdruidçš„æ•°æ®åº“çš„åˆ‡æ¢</p></div><p>è‡ªå·±æ€è€ƒ</p><details class="folding-tag" blue><summary> æ ·ä¾‹ä»£ç  </summary>              <div class="content">              <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å°†åŸæ¥çš„springbootçš„è‡ªåŠ¨IOC DruidDatasourceæ–¹æ¡ˆæ”¹ä¸º æ‰‹å·¥ç¼–ç¨‹</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyDataSourceConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.datasource.url&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.datasource.driver-class-name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String driverClassName;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.datasource.username&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.datasource.password&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>  <span class="comment">//IOC</span></span><br><span class="line">    <span class="meta">@Primary</span>  <span class="comment">//ä¼˜å…ˆä½¿ç”¨è¿™ä¸ªä»£ç IOC</span></span><br><span class="line">    <span class="meta">@RefreshScope</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">druid</span><span class="params">()</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;ä½¿ç”¨çš„ç¼–ç¨‹å¼çš„æ•°æ®æºåˆ›å»º.&quot;</span>);</span><br><span class="line">        DruidDataSource ds=<span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">        ds.setUsername(username);</span><br><span class="line">        ds.setPassword(password);</span><br><span class="line">        ds.setDriverClassName(<span class="built_in">this</span>.driverClassName);</span><br><span class="line">        ds.setUrl(url);</span><br><span class="line">        <span class="keyword">return</span>  ds;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æ­¤æ—¶ä¼šå‘ç°æœ‰å‘, druidæ•°æ®æºåœ¨è®¾ç½®çš„æ—¶å€™æœ‰æ£€æŸ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¦‚æœè¢«è®¾ç½®è¿‡åˆ™æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">this</span>.inited) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>();</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">// ä¸æ˜¯ç¬¬ä¸€æ¬¡åˆ™å¯ä»¥è®¾ç½®å€¼</span></span><br><span class="line">    <span class="built_in">this</span>.Xxx = Xxx;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´æŒ‰é“ç†æ¥è¯´æ˜¯ä¸èƒ½ä¿®æ”¹çš„</p><p>å®é™…ä¸Š:  nacosåœ¨ä¿®æ”¹æ­¤é¡¹ä¹‹åä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„DataSourceå¯¼è‡´è¿™ä¸ªä¸ç”Ÿæ•ˆ (  )</p>              </div>            </details><h2 id="SentinelæœåŠ¡å“¨å…µ"><a href="#SentinelæœåŠ¡å“¨å…µ" class="headerlink" title="SentinelæœåŠ¡å“¨å…µ"></a>SentinelæœåŠ¡å“¨å…µ</h2><h3 id="ç« èŠ‚å‰è¨€"><a href="#ç« èŠ‚å‰è¨€" class="headerlink" title="ç« èŠ‚å‰è¨€"></a>ç« èŠ‚å‰è¨€</h3><p>åœ¨äº†è§£Sentinelä¹‹å‰å¯ä»¥äº†è§£:</p><ol><li>ä»€ä¹ˆæ˜¯æœåŠ¡é›ªå´©?æœåŠ¡é›ªå´©å‘ç”Ÿæ—¶çš„å„é˜¶æ®µåŠç›´æ¥åŸå› ?</li><li>åº”å¯¹æœåŠ¡é›ªå´©çš„è§£å†³æ–¹æ¡ˆï¼Ÿ(ä»ç¡¬ä»¶å’Œè½¯ä»¶æ–¹é¢åˆ†åˆ«è€ƒé‡)</li><li>ä»€ä¹ˆæ˜¯é™æµ?</li><li>ä»€ä¹ˆæ˜¯æœåŠ¡ç†”æ–­? è§£å†³æœåŠ¡ç†”æ–­çš„é€šè¿‡æ¨¡å‹ä¸ºæ–­è·¯å™¨æ¨¡å¼ï¼Œå®ƒæ˜¯ä»€ä¹ˆåŸç†?</li><li>ä»€ä¹ˆæ˜¯æœåŠ¡é™çº§?</li><li>é™æµç®—æ³•ä¸­çš„ä»¤ç‰Œæ¡¶ç®—æ³•ä¸æ¼æ¡¶ç®—æ³•çš„åŸç†åŠåŒºåˆ«?</li><li>ä»€ä¹ˆæ˜¯èŒè´£é“¾è®¾è®¡æ¨¡å¼ï¼Ÿè¯·å†™ä¸€ä¸ªç®€å•çš„æ¡ˆä¾‹?</li><li>ä»€ä¹ˆæ˜¯çƒ­ç‚¹æ•°æ®?å¦‚ä½•è§£å†³çƒ­ç‚¹æ•°æ®çš„è®¿é—®é—®é¢˜?å¸¸è§çš„ç­–ç•¥æœ‰LRU,LFU, FIFO, è¯·æŒæ¡æ¯ç§ç­–ç•¥çš„åŸç†åŠç®€å•å®ç°.</li></ol><h3 id="Jmiterç®€å•ä½¿ç”¨"><a href="#Jmiterç®€å•ä½¿ç”¨" class="headerlink" title="Jmiterç®€å•ä½¿ç”¨"></a>Jmiterç®€å•ä½¿ç”¨</h3><p>åœ¨ä½¿ç”¨Sentinelä¹‹å‰éœ€è¦æœ‰ä¸€ä¸ª*<u>å‹æµ‹å·¥å…·</u>*(<a href="https://jmeter.apache.org/download_jmeter.cgi">JMeter - Download</a>)æ¥æ”¯æ’‘æˆ‘ä»¬çš„æµ‹è¯•,  é€šè¿‡æµ‹è¯•è¯„ä¼°ç³»ç»Ÿå“åº”ã€ååé‡ç­‰ï¼Œæ ¹æ®è¯„ä¼°ç»“æœä¼˜åŒ–ç³»ç»Ÿã€‚</p><p>è¿è¡Œ:  ä¸‹è½½è´¦æˆ·åœ¨binç›®å½•æ‰¾åˆ°<code>jmeter.bat</code></p><ul><li>ä¸­æ–‡è®¾ç½®:  ç¼–è¾‘å°†<code>set JMETER_LANGUAGE=-Duser.language=&quot;en&quot; -Duser.region=&quot;EN&quot;</code>è®¾ç½®ä¸º<code>set JMETER_LANGUAGE=-Duser.language=&quot;zh&quot; -Duser.region=&quot;CN&quot;</code></li><li>åŒå‡»è¯¥è„šæœ¬å³å¯è¿è¡Œ</li></ul><p>ç¼–å†™å‹æµ‹æ¡ˆä¾‹:  </p><ol><li><p>åœ¨æµ‹è¯•è®¡åˆ’ä¸­æ·»åŠ çº¿ç¨‹ç»„,  åœ¨çº¿ç¨‹ç»„é‡Œè®¾ç½®çº¿ç¨‹æ•°å’Œå¾ªç¯æ¬¡æ•°ä»¥åŠRamp-UpæŒç»­æ—¶é—´</p></li><li><p>åœ¨çº¿ç¨‹ç»„æ·»åŠ Httpè¯·æ±‚,  è®¾ç½®è¯·æ±‚åç§°ã€åè®®ã€IPã€ç«¯å£ã€è¯·æ±‚ã€è·¯å¾„</p><blockquote><p>å¯¹äºæ­¤é¡¹å¯ä»¥æ·»åŠ éšæœºæ•°,  å·¥å…·-&gt;å‡½æ•°åŠ©æ‰‹å¯¹è¯æ¡†-&gt; RandomèŒƒå›´(å¯é€‰å…¶ä»–å‡½æ•°)  -&gt; ç”Ÿæˆ</p></blockquote></li><li><p>åœ¨ä¸€ä¸ªçº¿ç¨‹ç»„å±‚çº§å¯ä»¥è®¾ç½®æ±‡æ€»æŠ¥å‘Šä»¥åŠç»“æœæ ‘ç”¨äºæŸ¥çœ‹å‹æµ‹æ•°æ®</p></li></ol><h3 id="Sentinelæ¦‚å¿µ"><a href="#Sentinelæ¦‚å¿µ" class="headerlink" title="Sentinelæ¦‚å¿µ"></a>Sentinelæ¦‚å¿µ</h3><h4 id="æœåŠ¡é›ªå´©"><a href="#æœåŠ¡é›ªå´©" class="headerlink" title="æœåŠ¡é›ªå´©"></a>æœåŠ¡é›ªå´©</h4><p>ç®€å•æ¥è¯´æœåŠ¡é›ªå´©å°±æ˜¯ï¼Œä¸€ä¸ªæœåŠ¡å¤±è´¥ï¼Œå¯¼è‡´æ•´æ¡é“¾è·¯çš„æœåŠ¡éƒ½å¤±è´¥çš„æƒ…å½¢</p><p>æœåŠ¡é›ªå´©çš„ä¸‰ä¸ªé˜¶æ®µä»¥åŠåŸå› :</p><ul><li>é˜¶æ®µä¸€:  æœåŠ¡ä¸å¯ç”¨</li></ul><p>åŸå› å¯èƒ½å¦‚ä¸‹:  <strong>ç¼“å­˜å‡»ç©¿</strong>,  ç¡¬ä»¶æ•…éšœ,  ç”¨æˆ·å¤§é‡è¯·æ±‚,  ç¨‹åºBug</p><ul><li>é˜¶æ®µäºŒ:  è°ƒç”¨ç«¯é‡è¯•åŠ å¤§æµé‡</li></ul><p>åŸå› å¯èƒ½å¦‚ä¸‹:  ç”¨æˆ·é‡è¯•,  ä»£ç é€»è¾‘é‡è¯•</p><ul><li>é˜¶æ®µä¸‰:  æœåŠ¡è°ƒç”¨è€…ä¸å¯ç”¨</li></ul><p>åŸå› å¯èƒ½å¦‚ä¸‹: åŒæ­¥ç­‰å¾…é€ æˆçš„èµ„æºè€—å°½</p><p>å¯¹äºä»¥ä¸Šçš„ä¸‰ä¸ªé˜¶æ®µå¯ä»¥äº§ç”Ÿæœ‰è§£å†³æ–¹æ¡ˆå¦‚ä¸‹:</p><ul><li>åº”ç”¨å‹æ‰©å®¹:  åŠ æœºå™¨,  å‡çº§ç¡¬ä»¶</li><li>æµæ§:  é™æµ(ä¿¡å·é‡),  å…³é—­é‡è¯•,  è¶…æ—¶å¤„ç†</li><li>ç¼“å­˜:  ç¼“å­˜é¢„åŠ è½½</li><li><strong>æœåŠ¡é™çº§</strong>: æœåŠ¡æ¥å£æ‹’ç»æœåŠ¡ ,  é¡µé¢æ‹’ç»æœåŠ¡,  å»¶è¿ŸæŒä¹…åŒ–,  éšæœºæ‹’ç»æœåŠ¡</li><li><strong>æœåŠ¡ç†”æ–­</strong></li></ul><p>å¦‚ä½•è¿›è¡Œé™æµ,  æœåŠ¡ç†”æ–­?</p><ul><li><p>é™æµ:   æå‰å¯¹å„ä¸ªæœåŠ¡ç±»å‹çš„è¯·æ±‚è®¾ç½®ç†æƒ³é«˜çš„QPSé˜ˆå€¼,  è‹¥é«˜äºæ­¤é˜ˆå€¼åˆ™ç›´æ¥å¯¹äºè¯·æ±‚ç›´æ¥è¿”å›</p></li><li><p>æœåŠ¡ç†”æ–­:  å½“ä¸‹æ¸¸çš„æœåŠ¡å› ä¸ºæŸç§åŸå› çªç„¶å˜å¾—ä¸å¯ç”¨æˆ–å“åº”è¿‡æ…¢ï¼Œä¸Šæ¸¸æœåŠ¡ä¸ºäº†ä¿è¯è‡ªå·±æ•´ä½“æœåŠ¡çš„å¯ç”¨æ€§ï¼Œä¸å†ç»§ç»­è°ƒç”¨ç›®æ ‡æœåŠ¡ï¼Œç›´æ¥è¿”å›ï¼Œå¿«é€Ÿé‡Šæ”¾èµ„æºã€‚å¦‚æœç›®æ ‡æœåŠ¡æƒ…å†µå¥½è½¬åˆ™æ¢å¤è°ƒç”¨,  ä¸€å¥è¯è¯´å°±æ˜¯å…ˆä¿è‡ªå·±çš„æœåŠ¡</p></li></ul><h4 id="æœåŠ¡ç†”æ–­"><a href="#æœåŠ¡ç†”æ–­" class="headerlink" title="æœåŠ¡ç†”æ–­"></a>æœåŠ¡ç†”æ–­</h4><p>å¯¹äºæ–­è·¯å™¨æ¨¡å¼çš„çŠ¶æ€å›¾å¤§è‡´å¦‚ä¸‹:</p><p><img src="https://user-images.githubusercontent.com/9434884/82635455-ca075f00-9c32-11ea-9e99-d67518923e0d.png" alt="ç†”æ–­æ¨¡å¼çš„çŠ¶æ€å›¾"></p><p>åœ¨æœ€å¼€å§‹æ˜¯å¤„äºClosedçŠ¶æ€,  ä¸€æ—¦è¯·æ±‚è¾¾åˆ°è®¾å®šé˜ˆå€¼åˆ™è½¬ä¸ºOpençŠ¶æ€,  æ­¤æ—¶ä¼šæœ‰ä¸€ä¸ªé‡è¯•æ—¶é—´(reset timeout:  å…¶å®æ˜¯é‡è¯•æ—¶é—´è®¡ç®—å™¨),  å¦‚æœåˆ°è¾¾äº†è®¾å®šçš„é‡è¯•æ—¶é—´åˆ™è½¬ä¸ºåŠå¼€çŠ¶æ€(Half-Open),æŒ‡éƒ¨åˆ†è¯·æ±‚å¯ä»¥è¯·æ±‚åˆ°åç«¯,  ä¸€æ—¦æ£€æµ‹é€šè¿‡åˆ™åˆ°ClosedçŠ¶æ€(æ¢å¤æœåŠ¡)</p><p>å…³äºç†”æ–­è¯¦æƒ…å®˜æ–¹æ–‡æ¡£  <a href="https://sentinelguard.io/zh-cn/docs/golang/circuit-breaking.html">ç†”æ–­é™çº§</a></p><h4 id="æœåŠ¡é™çº§"><a href="#æœåŠ¡é™çº§" class="headerlink" title="æœåŠ¡é™çº§"></a>æœåŠ¡é™çº§</h4><p>å¯¹äºæœåŠ¡é™çº§æœ‰ä¸¤ç§åœºæ™¯:</p><ol><li>å½“ä¸‹æ¸¸çš„æœåŠ¡å› ä¸ºæŸç§åŸå› å“åº”è¿‡æ…¢ï¼Œä¸‹æ¸¸æœåŠ¡ä¸»åŠ¨åœæ‰ä¸€äº›ä¸å¤ªé‡è¦çš„ä¸šåŠ¡ï¼Œé‡Šæ”¾å‡ºæœåŠ¡å™¨èµ„æºï¼Œå¢åŠ å“åº”é€Ÿåº¦</li><li>å½“ä¸‹æ¸¸çš„æœåŠ¡å› ä¸ºæŸç§åŸå› ä¸å¯ç”¨ï¼Œä¸Šæ¸¸ä¸»åŠ¨è°ƒç”¨æœ¬åœ°çš„ä¸€äº›é™çº§é€»è¾‘ï¼Œé¿å…å¡é¡¿ï¼Œè¿…é€Ÿè¿”å›ç»™ç”¨æˆ·</li></ol><p>å½“ç„¶æœåŠ¡ç†”æ–­å¯è§†ä¸ºé™çº§æ–¹å¼çš„ä¸€ç§</p><p>åœ¨å®é™…çš„é¡¹ç›®ä¸­ï¼Œä¹Ÿå¯é‡‡ç”¨ä»¥ä¸‹çš„æ–¹å¼æ¥å®Œæˆé™çº§å·¥ä½œ</p><ol><li>æ¢³ç†å‡ºæ ¸å¿ƒä¸šåŠ¡æµç¨‹å’Œéæ ¸å¿ƒä¸šåŠ¡æµç¨‹ã€‚ç„¶ååœ¨éæ ¸å¿ƒä¸šåŠ¡æµç¨‹ä¸ŠåŠ ä¸Šå¼€å…³ï¼Œä¸€æ—¦å‘ç°ç³»ç»Ÿæ‰›ä¸ä½ï¼Œå…³æ‰å¼€å…³ï¼Œç»“æŸè¿™äº›æ¬¡è¦æµç¨‹</li><li>ä¸€ä¸ªå¾®æœåŠ¡ä¸‹è‚¯å®šæœ‰å¾ˆå¤šåŠŸèƒ½ï¼Œé‚£è‡ªå·±åŒºåˆ†å‡ºä¸»è¦åŠŸèƒ½å’Œæ¬¡è¦åŠŸèƒ½ã€‚ç„¶åæ¬¡è¦åŠŸèƒ½åŠ ä¸Šå¼€å…³ï¼Œéœ€è¦é™çº§çš„æ—¶å€™ï¼ŒæŠŠæ¬¡è¦åŠŸèƒ½å…³é—­</li><li>é™ä½ä¸€è‡´æ€§è¦æ±‚ï¼Œå³å°†æ ¸å¿ƒä¸šåŠ¡æµç¨‹çš„åŒæ­¥æ”¹å¼‚æ­¥ï¼Œå°†å¼ºä¸€è‡´æ€§æ”¹æœ€ç»ˆä¸€è‡´æ€§</li></ol><hr><p>sentinelæ˜¯ä»¥æµé‡ä¸ºåˆ‡å…¥ç‚¹ï¼Œä»æµé‡æ§åˆ¶ç†”æ–­é™çº§ï¼Œç³»ç»Ÿè´Ÿè½½ä¿æŠ¤ç­‰å¤šç»´åº¦ä¿æŠ¤æœåŠ¡çš„ç¨³å®šæ€§</p><h4 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h4><ol><li>å¤šç§é™æµç®—æ³•ï¼šåŒ…æ‹¬ä»¤ç‰Œæ¡¶ã€æ¼æ¡¶ç­‰ï¼Œå¯ä»¥æ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©åˆé€‚çš„ç®—æ³•ã€‚</li><li>å¤šç§é™æµç»´åº¦ï¼šåŒ…æ‹¬QPSã€å¹¶å‘çº¿ç¨‹æ•°ã€å¼‚å¸¸æ¯”ä¾‹ç­‰ï¼Œå¯ä»¥æ ¹æ®ä¸åŒçš„ç»´åº¦æ¥è¿›è¡Œé™æµã€‚</li><li>å¤šç§åº”ç”¨åœºæ™¯ï¼šæ”¯æŒDubboã€Spring Cloudã€gRPCç­‰å¤šç§RPCæ¡†æ¶çš„æœåŠ¡å‘ç°å’Œè°ƒç”¨ã€‚</li><li>åŠ¨æ€è§„åˆ™æºï¼šæ”¯æŒå¤šç§æ•°æ®æºï¼Œå¦‚Nacosã€Zookeeperã€Apolloç­‰ï¼Œå¯ä»¥åŠ¨æ€æ¨é€å’Œæ›´æ–°è§„åˆ™ã€‚</li><li>å®æ—¶ç›‘æ§ï¼šæä¾›å®æ—¶çš„ç›‘æ§å’Œç»Ÿè®¡åŠŸèƒ½ï¼Œå¯ä»¥æŸ¥çœ‹æœåŠ¡çš„è¿è¡ŒçŠ¶æ€å’ŒæŒ‡æ ‡</li></ol><p>Sentinelçš„ä½¿ç”¨:  åˆ†ä¸ºæ ¸å¿ƒåº“(java Client)å’Œæ§åˆ¶å°(Web Dasboard)</p><h4 id="æ‰§è¡ŒåŸç†"><a href="#æ‰§è¡ŒåŸç†" class="headerlink" title="æ‰§è¡ŒåŸç†"></a>æ‰§è¡ŒåŸç†</h4><p>é‡‡ç”¨èŒè´£é“¾è®¾è®¡æ¨¡å¼:  è¯¥è®¾è®¡æ¨¡å¼æ˜¯sentinelçš„æ ¸å¿ƒéª¨æ¶,  å®ƒå°†ä¸åŒæ˜¯slotæŒ‰ç…§é¡ºåºç»„æˆèŒè´£é“¾,, ä»è€Œå°†ä¸åŒçš„åŠŸèƒ½(ä¾‹å¦‚: é™æµã€é™çº§ã€ç³»ç»Ÿä¿æŠ¤)ç»„åˆåœ¨ä¸€èµ·</p><p>å¯¹äºsentinelèŒè´£é“¾å®è·µå¯ä»¥è·³è½¬<a href="https://zhuanlan.zhihu.com/p/337996849">é˜¿é‡ŒSentinelæ ¸å¿ƒæºç è§£æ-è´£ä»»é“¾æ¨¡å¼æœ€ä½³å®è·µ - çŸ¥ä¹ (zhihu.com)</a></p><h3 id="Sentinelä½¿ç”¨ä¸é…ç½®"><a href="#Sentinelä½¿ç”¨ä¸é…ç½®" class="headerlink" title="Sentinelä½¿ç”¨ä¸é…ç½®"></a>Sentinelä½¿ç”¨ä¸é…ç½®</h3><h4 id="Dashboard"><a href="#Dashboard" class="headerlink" title="Dashboard"></a>Dashboard</h4><p>å®‰è£…Dashboardæ§åˆ¶å°ï¼Œä¸‹è½½sentinel-dashboard.jaræ–‡ä»¶<a href="https://github.com/alibaba/Sentinel/releases">ç›´è¾¾é“¾æ¥</a></p><p>ä¸‹è½½å¥½ä¹‹ååœ¨æ–‡ä»¶ç›®å½•ç¼–å†™å¤„ç†è„šæœ¬ ä¾‹å¦‚:<code>start.bat</code>å†…å®¹å¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">java -jar ./sentinel-dashboard-1.8.0.jar --server.port=9999</span><br><span class="line">pause</span><br></pre></td></tr></table></figure><p>å…¶å®å°±æ˜¯ä¸€ä¸ªè¿è¡ŒjaråŒ…çš„è„šæœ¬ç„¶åè®¾ç½®äº†ç«¯å£,  è¿™æ ·è®¾ç½®äº†ä¾¿äºä»¥åè¿è¡Œ</p><p>å¯åŠ¨jaråŒ…åæ‰“å¼€ç½‘é¡µ<a href="http://localhost:9999/#/login">http://localhost:9999/#/login</a></p><p>é€šè¿‡äº†è§£é…ç½®æ–‡ä»¶å¯ä»¥å¾—çŸ¥è´¦å·å¯†ç å‡ä¸º: sentinel</p><p>è¯¦æƒ…å‚è€ƒå®˜æ–¹æ–‡æ¡£<a href="https://github.com/alibaba/Sentinel/wiki/%E6%8E%A7%E5%88%B6%E5%8F%B0">æ§åˆ¶å° Â· alibaba&#x2F;Sentinel Wiki (github.com)</a></p><h4 id="å¾®æœåŠ¡æ•´åˆ"><a href="#å¾®æœåŠ¡æ•´åˆ" class="headerlink" title="å¾®æœåŠ¡æ•´åˆ"></a>å¾®æœåŠ¡æ•´åˆ</h4><h5 id="ä¾èµ–åŠåˆ†æ"><a href="#ä¾èµ–åŠåˆ†æ" class="headerlink" title="ä¾èµ–åŠåˆ†æ"></a>ä¾èµ–åŠåˆ†æ</h5><p>åœ¨éœ€è¦æ•´åˆçš„æœåŠ¡ä¸­å¯¼å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- sentinel å®¢æˆ·ç«¯ä¾èµ– --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¯¹äºæœ¬æ¡ˆä¾‹ä¸å†ä½¿ç”¨ç¡¬ç¼–ç è¿›è¡Œä¸€ä¸€è®¾ç½®,  å¦‚éœ€äº†è§£ç¡¬ç¼–ç æ¨¡å¼è§<a href="https://sentinelguard.io/zh-cn/docs/quick-start.html">quick-start | Sentinel</a></p><p>åœ¨é»˜è®¤åœ¨åŠ äº†starterä¾èµ–ã€é…ç½®å®Œé…ç½®æ–‡ä»¶åï¼Œåœ¨controllerä¸­çš„æ¥å£éƒ½ä¼šç›‘æ§ï¼Œæ‰€æœ‰çš„ URL å°±è‡ªåŠ¨æˆä¸º Sentinel ä¸­çš„åŸ‹ç‚¹èµ„æºã€‚</p><p>åœ¨å®˜æ–¹æ–‡æ¡£ä¸­æè¿°ï¼šä¸€èˆ¬æ¨èå°† <code>@SentinelResource</code> æ³¨è§£åŠ åˆ°æœåŠ¡å®ç°ä¸Šï¼Œè€Œåœ¨ Web å±‚ç›´æ¥ä½¿ç”¨ Spring Cloud Alibaba è‡ªå¸¦çš„ Web åŸ‹ç‚¹é€‚é…ã€‚<a href="https://github.com/alibaba/spring-cloud-alibaba/wiki/Sentinel">å®˜æ–¹æ–‡æ¡£</a></p><p>å¯¹äºServiceå±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestService</span> &#123;</span><br><span class="line">    <span class="meta">@SentinelResource(value = &quot;sayHello&quot;)</span>  <span class="comment">// æµæ§å¤„ç†é€»è¾‘,è‡ªå®šä¹‰sayHelloé™æµç­–ç•¥</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sayHello</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello, &quot;</span> + name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºäº†è§£ä¸”ä½¿ç”¨è¿‡ç¡¬ç¼–ç çš„é…ç½®,  å¯ä»¥çŸ¥é“éœ€è¦å¯¼å…¥å¦‚ä¸‹ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Sentinel æ ¸å¿ƒä¾èµ–--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Sentinel æ§åˆ¶å°é€šä¿¡--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-transport-simple-http<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¯¹äºæ­¤ç¬¬äºŒä¸ªä¾èµ–: </p><p><strong>simple-http</strong>ï¼šå®ƒæ˜¯ä¸€ä¸ªç®€ç‰ˆçš„httpæœåŠ¡å™¨,ç”¨äºä¸dashboardé€šè®¯</p><p>å®ƒæ˜¯ä¸€ç§æä¾›HTTPç«¯ç‚¹çš„é€šä¿¡æ¨¡å—ï¼Œç”¨äºæ¥æ”¶æ¥è‡ªDashboardçš„æ§åˆ¶æŒ‡ä»¤ã€‚å®ƒæ˜¯sentinel-transportæ¨¡å—çš„ä¸€ä¸ªå­æ¨¡å—ï¼Œä½¿ç”¨NIOå®ç°äº†ä¸€ä¸ªç®€å•çš„HTTPæœåŠ¡å™¨ã€‚å®ƒçš„ä½œç”¨æ˜¯è®©Sentinel Clientèƒ½å¤Ÿä¸Dashboardè¿›è¡Œè¿œç¨‹é€šä¿¡ï¼Œå®ç°è§„åˆ™ç®¡ç†å’Œæ¨é€ã€æ•°æ®ä¸ŠæŠ¥å’Œç›‘æ§ç­‰åŠŸèƒ½ã€‚</p><p>å†å¯¹<code>sentinel-starter</code>è¿›è¡Œåˆ†æ:  å®ƒè¿˜å¯¼å…¥äº†<code>aspectj</code>åˆ‡é¢,  ä¼—æ‰€å‘¨çŸ¥æˆ‘ä»¬éœ€è¦å¯¹èµ„æºè¿›è¡Œç»Ÿè®¡(<strong>QPS</strong>)å½“ç„¶æ˜¯è¦åœ¨è¯·æ±‚æ‰§è¡Œå‰å•¦,  é‚£ä¸å°±æ˜¯åˆ‡é¢<u><em>å‰ç½®å¢å¼º</em></u>å—</p><p>å…¶ä¸­è¿˜åŒ…æ‹¬ä¸€äº›å…¶ä»–ä¾èµ–å¦‚è´Ÿè½½å‡è¡¡ã€ç†”æ–­ã€è¿œç¨‹è°ƒç”¨ç­‰,  å°±ä¸ä¸€ä¸€åˆ—å‡ºäº†</p><h5 id="Yamlé…ç½®"><a href="#Yamlé…ç½®" class="headerlink" title="Yamlé…ç½®"></a>Yamlé…ç½®</h5><p>ä½¿ç”¨äº†Nacoså,  æˆ‘ä»¬çš„åŸºç¡€é…ç½®åº”è¯¥æ˜¯æ”¾åœ¨äº†Nacosä¸­äº†,  æ­¤æ—¶å°±ä¸éœ€è¦å†æ”¾åœ¨é¡¹ç›®çš„application.ymläº†,  æˆ‘ä»¬åœ¨Nacosä¸­å¯¹åº”çš„é…ç½®æ–‡ä»¶å¤„æ·»åŠ </p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">sentinel:</span>  <span class="comment">#sentinelé…ç½®</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">8719</span>                  <span class="comment">#è·Ÿæ§åˆ¶å°äº¤æµçš„ç«¯å£,éšæ„æŒ‡å®šä¸€ä¸ªæœªä½¿ç”¨çš„ç«¯å£å³å¯(sentinelé»˜è®¤å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„äº¤äº’ç«¯å£ä¸º8719),å¦‚éœ€åœ¨ä¸€å°æœºå™¨ä¸Šéœ€è¦é…ç½®å…¶ä»–çš„ç«¯å£</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="string">localhost:9999</span>   <span class="comment">#åˆšåˆšåœ¨å¯åŠ¨dashboardé…ç½®çš„åœ°å€ä¸ç«¯å£</span></span><br><span class="line">      <span class="attr">eager:</span> <span class="literal">true</span>                   <span class="comment">#è¡¨ç¤º Sentinel ä¼šåœ¨åº”ç”¨å¯åŠ¨æ—¶ç«‹å³è¿›è¡Œåˆå§‹åŒ–ã€‚è¿™æ„å‘³ç€ Sentinel ä¼šç«‹å³åŠ è½½è§„åˆ™ã€ç»Ÿè®¡ä¿¡æ¯ç­‰ç›¸å…³çš„æ•°æ®ï¼Œå¹¶å¼€å§‹ç›‘æ§å’Œé™æµ</span></span><br></pre></td></tr></table></figure><p>åœ¨è¿›è¡Œåˆ°æ­¤å¤„,  starterå’Œé…ç½®æ–‡ä»¶ã€ Dashboardéƒ½å‡†å¤‡å¥½äº†,  æˆ‘ä»¬å¯ä»¥ç»“åˆJmiterè¿›è¡Œä½QPSï¼ˆå¤ªå¤šäº†ä¼šå¡æ­»ï¼‰çš„ç®€å•å‹æµ‹ï¼ŒæŸ¥çœ‹Sentinel Dashboardçš„å®æ—¶ç›‘æ§æ˜¯å¦èµ·ä½œç”¨</p><h5 id="Sentinelçš„ç›‘æ§æ•°æ®æ˜¯å“ªæ¥çš„"><a href="#Sentinelçš„ç›‘æ§æ•°æ®æ˜¯å“ªæ¥çš„" class="headerlink" title="Sentinelçš„ç›‘æ§æ•°æ®æ˜¯å“ªæ¥çš„"></a>Sentinelçš„ç›‘æ§æ•°æ®æ˜¯å“ªæ¥çš„</h5><p>Sentinelæ˜¯åŸºäºSpringBootå¼€å‘çš„ï¼Œ SpringBootæä¾›äº†ä¸€å¥—å¯¹å¤–çš„actuatorç›‘æ§ç«¯ç‚¹ï¼Œå¾ˆæ˜¾ç„¶Sentinelå°±æ˜¯å¯¹æš´éœ²ç«¯ç‚¹çš„æ•°æ®è¿›è¡Œç›‘æ§ç„¶åè·å¾—çš„æ•°æ®</p><p>æˆ‘ä»¬éœ€è¦äº†è§£Sentinelç›‘æ§çš„ç«¯å£å¯ä»¥è®¿é—®æ¥å£<a href="http://localhost:8719/api">http://localhost:8719/api</a> :8719ä¸ºymlä¸­é…ç½®çš„ç›‘å¬ç«¯å£</p><p>å…¶ä»–é…ç½®è¯¦æƒ…è§å®˜æ–¹æ–‡æ¡£(è®¿é—®ä¸Šé¢æè¿°çš„apiæ¥å£å¯ä»¥æ‹¿å–ä¸€äº›urlè¿›è¡ŒäºŒæ¬¡å¼€å‘)</p><h3 id="SentinelæœåŠ¡æµæ§"><a href="#SentinelæœåŠ¡æµæ§" class="headerlink" title="SentinelæœåŠ¡æµæ§"></a>SentinelæœåŠ¡æµæ§</h3><h4 id="æœåŠ¡æµæ§æ¨¡å¼"><a href="#æœåŠ¡æµæ§æ¨¡å¼" class="headerlink" title="æœåŠ¡æµæ§æ¨¡å¼"></a>æœåŠ¡æµæ§æ¨¡å¼</h4><h5 id="ä¸€-ç›´æ¥å¤±è´¥"><a href="#ä¸€-ç›´æ¥å¤±è´¥" class="headerlink" title="ä¸€:  ç›´æ¥å¤±è´¥"></a>ä¸€:  ç›´æ¥å¤±è´¥</h5><p>é™åˆ¶QPSæˆ–è€…è¿›ç¨‹æ•°ï¼š</p><p>â€‹QPSï¼šé™åˆ¶å•ä½æ—¶é—´çš„è¯·æ±‚æ¥å£æ¬¡æ•°é™åˆ¶</p><p><img src="https://calyee-image.pages.dev/file/2427cc0b86a43409940b0.png"></p><p>â€‹æ•ˆæœå›¾å¦‚ä¸‹ (Sentinelå®æ—¶ç›‘æ§)</p><p><img src="https://calyee-image.pages.dev/file/939b643170060549e3d3a.png"></p><p>æˆ‘ä»¬å¯ä»¥æ¸…æ™°çš„çœ‹åˆ°<code>/resfood/findAll</code>æ¥å£çš„QPSè¢«é™åˆ¶åœ¨äº†100,  å…¶ä»–çš„éƒ½è¢«æ‹’ç»äº†</p><p>â€‹<strong>é™åˆ¶è¿›ç¨‹æ•°</strong>:å•ä½æ—¶é—´å†…ï¼Œè¯·æ±‚å¹¶å‘æ•°é™åˆ¶,è¿™é‡Œå¤„ç†çš„å¹¶å‘è¯·æ±‚æ˜¯æŒ‡tomcatä¸­å¼€å¯å¤šå°‘ä¸ªçº¿ç¨‹æ¥å¤„ç†è¯·æ±‚ã€‚</p><blockquote><p> åœ¨Tomcatä¸­<u>é»˜è®¤</u>çº¿ç¨‹æ± æ•°ä¸º10, å¦‚éœ€ä¿®æ”¹æˆ‘ä»¬å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: <span class="number">9000</span>                # æ­¤æœåŠ¡çš„ç«¯å£(æ³¨æ„å„å¾®æœåŠ¡çš„ç«¯å£è¦åŒºåˆ†)</span><br><span class="line">  tomcat:# é…ç½®tomcatç›¸å…³å‚æ•°</span><br><span class="line">    accept-count: <span class="number">100</span>  # ç­‰å¾…é˜Ÿåˆ—é•¿åº¦ï¼Œé»˜è®¤<span class="number">100</span>ã€‚</span><br><span class="line">    max-threads: <span class="number">20</span>     # æœ€å¤§å·¥ä½œçº¿ç¨‹æ•°ï¼Œé»˜è®¤<span class="number">200</span>ã€‚</span><br><span class="line">    min-spare-threads: <span class="number">5</span>    # æœ€å°å·¥ä½œç©ºé—²çº¿ç¨‹æ•°ï¼Œé»˜è®¤<span class="number">10</span>ã€‚</span><br><span class="line">    max-connections: <span class="number">100</span>    # æœ€å¤§è¿æ¥æ•°ï¼Œé»˜è®¤ä¸º<span class="number">10000</span></span><br></pre></td></tr></table></figure></blockquote><p>å¹¶å‘çº¿ç¨‹æ•°æ§åˆ¶ç•Œé¢å¦‚ä¸‹</p><p><img src="https://calyee-image.pages.dev/file/e1591dd91d82c52b8dd1c.png"></p><h5 id="äºŒ-å…³è”å¤±è´¥"><a href="#äºŒ-å…³è”å¤±è´¥" class="headerlink" title="äºŒ: å…³è”å¤±è´¥"></a>äºŒ: å…³è”å¤±è´¥</h5><p>å½“å…³è”çš„èµ„æºè¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå°±é™æµè‡ªå·±</p><p>éœ€æ±‚åœºæ™¯: åœ¨ resfoodæœåŠ¡ä¸­ï¼Œ åœ¨&#x2F;resfood&#x2F;findById&#x2F;{fid}è®¿é—®é‡æš´æ¶¨çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç¡®å®šä¿æŠ¤å®ƒçš„æœåŠ¡ è€Œå¿«é€Ÿå¤±è´¥ &#x2F;resfood&#x2F;findAll,  å³åœ¨æ ¹æ®idæŸ¥æ‰¾å•†å“çš„è®¿é—®é‡æš´æ¶¨ä¸‹æˆ‘ä»¬éœ€è¦ä¿æŠ¤å®ƒè€Œå®ƒå…³è”çš„æŸ¥æ‰¾å…¨éƒ¨æœåŠ¡åˆ™éœ€è¦å¤±è´¥</p><p>åº”ç”¨åœºæ™¯:  è®¢å•æœåŠ¡å…³è”ç¬¬ä¸‰æ–¹æ”¯ä»˜æ¥å£ï¼Œå½“æ”¯ä»˜æ¥å£è®¿é—®è¿‡å¤šçš„æ—¶å€™å¯¼è‡´å¿«ç˜«ç—ªæ—¶ï¼Œé‚£ä¹ˆå°±é™åˆ¶æˆ‘ä»¬çš„ä¸‹å•æœåŠ¡ï¼ˆé™æµï¼‰</p><h5 id="ä¸‰-é“¾è·¯æµæ§"><a href="#ä¸‰-é“¾è·¯æµæ§" class="headerlink" title="ä¸‰:  é“¾è·¯æµæ§"></a>ä¸‰:  é“¾è·¯æµæ§</h5><p>åªè®°å½•æŒ‡å®šé“¾è·¯ä¸Šçš„æµé‡ï¼ˆæŒ‡å®šèµ„æºä»å…¥å£èµ„æºè¿›æ¥çš„æµé‡ï¼Œå¦‚æœè¾¾åˆ°é˜ˆå€¼ï¼Œå°±å¯ä»¥é™æµï¼‰[apiçº§åˆ«çš„é’ˆå¯¹æ¥æº]</p><p>å¯¹äºéœ€è¦ä½¿ç”¨é“¾è·¯æµæ§,  éœ€è¦é…ç½®  <code>web-context-unify: false</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">web-context-unify:</span> <span class="literal">false</span>       <span class="comment"># å…³é—­contextæ•´åˆ, æµ‹è¯•æµæ§éœ€å…³é—­æ­¤é¡¹</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">8720</span>                   <span class="comment"># è·Ÿæ§åˆ¶å°äº¤æµçš„çª—å£, éšæ„æŒ‡å®šä¸€ä¸ªæœªä½¿ç”¨çš„ç«¯å£å³å¯</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="string">localhost:9999</span>    <span class="comment"># Dashboardåœ°å€å’Œç«¯å£</span></span><br><span class="line">      <span class="attr">eager:</span> <span class="literal">true</span>                    <span class="comment"># è¡¨ç¤ºSentinelä¼šåœ¨åº”ç”¨å¯åŠ¨æ—¶ç«‹åˆ»è¿›è¡Œåˆå§‹åŒ–,è¿™æ„å‘³ç€Sentinelä¼šç«‹åˆ»åŠ è½½è§„åˆ™,ç»Ÿè®¡ä¿¡æ¯</span></span><br></pre></td></tr></table></figure><p>ä¸ºäº†è¾¾åˆ°é“¾è·¯çš„æ•ˆæœ,  æ¨¡æ‹ŸæœåŠ¡ç»“æ„å¦‚ä¸‹</p><p>ServiceA ,ServiceBå„è‡ªéƒ½ä¾èµ–äºgetInfo</p><p>å½“å‰ç¤ºä¾‹,åœ¨Sentinelæ§åˆ¶å°ä¼šæ˜¾ç¤ºä¾èµ–æ ‘å½¢çŠ¶ç»“æ„</p><p>ä¸¤ä¸ªèŠ‚ç‚¹éƒ½ä¾èµ–äºçˆ¶èŠ‚ç‚¹</p><p>ç®€ç•¥ç¤ºä¾‹ä»£ç </p><ul><li>getInfo()</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InfoService</span>&#123;</span><br><span class="line">    <span class="meta">@SentinelResource(&quot;getInfo&quot;)</span> <span class="comment">// å®šä¹‰ä¸ºSentinelç®¡ç†çš„èµ„æº,å®šä½åæ ‡getInfo</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getInfo</span><span class="params">()</span>&#123;<span class="keyword">return</span> <span class="string">&quot;getInfo exec&quot;</span>;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ServiceA&#x2F;B</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/resorder&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResorderController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> InfoService infoService; <span class="comment">// æ³¨å…¥</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/serviceA&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">serviceA</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.ok(infoService.getInfo()); <span class="comment">// out:getInfo exec</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/serviceB&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">serviceB</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.ok(infoService.getInfo()); <span class="comment">// out:getInfo exec</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸¤ä¸ªæœåŠ¡å¯¹getInfoäº§ç”Ÿä¾èµ–,  å¦‚éœ€<u>é™æµä¸€ä¸ªæœåŠ¡</u>,  åˆ™éœ€å¯¹èµ„æºgetInfoè¿›è¡Œ<strong>é“¾è·¯é™æµ</strong>,  åœ¨å…¥å£èµ„æºé€‰é¡¹åˆ™å¡«å…¥éœ€è¦é™æµçš„æœåŠ¡ ä¾‹å¦‚éœ€è¦å¯¹ServiceAé™æµä»¥ä¿è¯ServiceBçš„å¹³ç¨³è¿è¡Œåˆ™åœ¨å…¥å£èµ„æºå¡«å…¥ <code>/resorder/serviceA</code>: å½“å‰ä¸ºé™åˆ¶<code>ResorderController</code>ä¸­æ¥å£ä¸º<code>serviceA</code>çš„è¯·æ±‚ï¼Œæµæ§æ•ˆæœæ ¹æ®éœ€è¦è‡ªè¡Œé€‰æ‹©ã€‚</p><p>æ ¹æ®ä¸Šé¢çš„æ¡ˆä¾‹åˆ™å¯ä»¥  å®ç°ä¼˜å…ˆæŸæœåŠ¡ã€æ¥å£çš„æ“ä½œ</p><h4 id="æµæ§æ•ˆæœ"><a href="#æµæ§æ•ˆæœ" class="headerlink" title="æµæ§æ•ˆæœ"></a>æµæ§æ•ˆæœ</h4><ul><li>å¿«é€Ÿå¤±è´¥ï¼šç›´æ¥å¤±è´¥</li><li>Warm Up: é¢„çƒ­,  å³è¯·æ±‚ QPS ä» threshold &#x2F; 3 å¼€å§‹ï¼Œç»é¢„çƒ­æ—¶é•¿é€æ¸å‡è‡³è®¾å®šçš„ QPS é˜ˆå€¼threshold</li></ul><p>æ•ˆæœç¤ºä¾‹å¦‚ä¸‹: (æ¨¡æ‹Ÿç¯å¢ƒå¦‚ä¸‹: Sentinel Dashboardæ§åˆ¶:  æ¥å£åœ¨Sentinelæµæ§ä¸‹è®¾ç½®QPS<strong>é˜ˆå€¼25</strong>,æµæ§æ¨¡å¼ä¸º<strong>ç›´æ¥æµæ§</strong>, æµæ§æ•ˆæœä¸º<strong>Warm Up</strong>,  é¢„çƒ­æ—¶é•¿ <strong>3s ** ,å‹æµ‹æ¨¡æ‹Ÿç«¯: çº¿ç¨‹æ•°</strong>400ä¸ª**, Ramp-Up: <strong>5ç§’</strong>, å¾ªç¯ä¸€æ¬¡)</p><table><thead><tr><th align="center">æ—¶é—´</th><th align="center">é€šè¿‡QPS</th><th align="center">æ‹’ç»QPS</th><th align="center">å“åº”æ—¶é—´(ms)</th></tr></thead><tbody><tr><td align="center">20:48:07</td><td align="center">25.0</td><td align="center">51.0</td><td align="center">3.0</td></tr><tr><td align="center">20:48:06</td><td align="center">25.0</td><td align="center">51.0</td><td align="center">3.0</td></tr><tr><td align="center">20:48:05</td><td align="center">18.0</td><td align="center">59.0</td><td align="center">3.0</td></tr><tr><td align="center">20:48:04</td><td align="center">12.0</td><td align="center">65.0</td><td align="center">3.0</td></tr><tr><td align="center">20:48:03</td><td align="center">9.0</td><td align="center">67.0</td><td align="center">3.0</td></tr><tr><td align="center">20:48:02</td><td align="center">8&#x2F;0</td><td align="center">2.0</td><td align="center">3.0</td></tr></tbody></table><p>å¯ä»¥çœ‹å‡ºæ¥,  å¤„äºé¢„çƒ­æ¨¡å¼ä¸‹,  éšç€æ—¶é—´çš„æ¨ç§»,  QPSé€æ¸è¾¾åˆ°é˜ˆå€¼ç„¶åä¸€ç›´ä¿æŒæœ€å¤§å€¼,  ç›´åˆ°æ‰€æœ‰è¯·æ±‚å…¨éƒ¨å¤„ç†å®Œæˆ</p><p>åº”ç”¨:  ç§’æ€ç³»ç»Ÿåœ¨å¼€å¯çš„ç¬é—´ï¼Œä¼šæœ‰å¾ˆå¤šæµé‡ä¸Šæ¥ï¼Œå¾ˆæœ‰å¯èƒ½æŠŠç³»ç»Ÿæ‰“æ­»ï¼Œé¢„çƒ­æ–¹å¼å°±æ˜¯æŠŠä¸ºäº†ä¿æŠ¤ç³»ç»Ÿï¼Œå¯æ…¢æ…¢çš„æŠŠæµé‡æ”¾è¿›æ¥ï¼Œæ…¢æ…¢çš„æŠŠé˜€å€¼å¢é•¿åˆ°è®¾ç½®çš„é˜€å€¼</p><ul><li>æ’é˜Ÿç­‰å¾…</li></ul><p><img src="https://github.com/alibaba/Sentinel/wiki/image/uniform-speed-queue.png" alt="æ’é˜Ÿç­‰å¾…"></p><p>åŒ€é€Ÿæ’é˜Ÿï¼Œè®©è¯·æ±‚ä»¥å‡åŒ€çš„é€Ÿåº¦é€šè¿‡ï¼Œé˜€å€¼ç±»å‹å¿…é¡»è®¾æˆQPSï¼Œå¦åˆ™æ— æ•ˆã€‚å¯¹åº”çš„æ˜¯<strong>æ¼æ¡¶ç®—æ³•</strong></p><p>å…³äºæ’é˜Ÿç­‰å¾…è¯¦æƒ…è§å®˜æ–¹æ–‡æ¡£ <a href="https://github.com/alibaba/Sentinel/wiki/%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6-%E5%8C%80%E9%80%9F%E6%8E%92%E9%98%9F%E6%A8%A1%E5%BC%8F">æµé‡æ§åˆ¶ åŒ€é€Ÿæ’é˜Ÿæ¨¡å¼</a></p><h3 id="Sentinelç†”æ–­é™çº§"><a href="#Sentinelç†”æ–­é™çº§" class="headerlink" title="Sentinelç†”æ–­é™çº§"></a>Sentinelç†”æ–­é™çº§</h3><p>å®˜æ–¹ä»‹ç»ï¼š å¯¹ä¸ç¨³å®šçš„<strong>å¼±ä¾èµ–æœåŠ¡è°ƒç”¨</strong>è¿›è¡Œç†”æ–­é™çº§ï¼Œæš‚æ—¶åˆ‡æ–­ä¸ç¨³å®šè°ƒç”¨ï¼Œé¿å…å±€éƒ¨ä¸ç¨³å®šå› ç´ å¯¼è‡´æ•´ä½“çš„é›ªå´©ã€‚ç†”æ–­é™çº§æ˜¯ä¸€ä¸ªä¿æŠ¤è‡ªèº«çš„æ‰‹æ®µã€‚<a href="https://github.com/alibaba/Sentinel/wiki/%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7">ç†”æ–­é™çº§ Â· alibaba&#x2F;Sentinel Wiki</a></p><h4 id="ä¸‰ç§ç­–ç•¥"><a href="#ä¸‰ç§ç­–ç•¥" class="headerlink" title="ä¸‰ç§ç­–ç•¥"></a>ä¸‰ç§ç­–ç•¥</h4><h5 id="æ…¢è°ƒç”¨æ¯”ä¾‹-SLOW-REQUEST-RATIO"><a href="#æ…¢è°ƒç”¨æ¯”ä¾‹-SLOW-REQUEST-RATIO" class="headerlink" title="æ…¢è°ƒç”¨æ¯”ä¾‹ (SLOW_REQUEST_RATIO)"></a>æ…¢è°ƒç”¨æ¯”ä¾‹ (SLOW_REQUEST_RATIO)</h5><p>é€‰æ‹©ä»¥æ…¢è°ƒç”¨æ¯”ä¾‹ä½œä¸ºé˜ˆå€¼ï¼Œéœ€è¦è®¾ç½®å…è®¸çš„æ…¢è°ƒç”¨ RTï¼ˆå³æœ€å¤§çš„å“åº”æ—¶é—´ï¼‰ï¼Œè¯·æ±‚çš„å“åº”æ—¶é—´å¤§äºè¯¥å€¼åˆ™ç»Ÿè®¡ä¸ºæ…¢è°ƒç”¨ã€‚å½“å•ä½ç»Ÿè®¡æ—¶é•¿ï¼ˆstatIntervalMsï¼‰å†…è¯·æ±‚æ•°ç›®å¤§äºè®¾ç½®çš„æœ€å°è¯·æ±‚æ•°ç›®ï¼Œå¹¶ä¸”æ…¢è°ƒç”¨çš„æ¯”ä¾‹å¤§äºé˜ˆå€¼ï¼Œåˆ™æ¥ä¸‹æ¥çš„ç†”æ–­æ—¶é•¿å†…è¯·æ±‚ä¼šè‡ªåŠ¨è¢«ç†”æ–­ã€‚ç»è¿‡ç†”æ–­æ—¶é•¿åç†”æ–­å™¨ä¼šè¿›å…¥æ¢æµ‹æ¢å¤çŠ¶æ€ï¼ˆHALF-OPEN çŠ¶æ€ï¼‰ï¼Œè‹¥æ¥ä¸‹æ¥çš„ä¸€ä¸ªè¯·æ±‚å“åº”æ—¶é—´å°äºè®¾ç½®çš„æ…¢è°ƒç”¨ RT åˆ™ç»“æŸç†”æ–­ï¼Œè‹¥å¤§äºè®¾ç½®çš„æ…¢è°ƒç”¨ RT åˆ™ä¼šå†æ¬¡è¢«ç†”æ–­ã€‚</p><p><strong>æ…¢è°ƒç”¨æ¨¡æ‹Ÿ</strong></p><p><strong>jmiter</strong>: çº¿ç¨‹:<strong>100</strong>,  Ramp-Up:<strong>5</strong>,  å¾ªç¯:<strong>1</strong></p><p><strong>ç†”æ–­è§„åˆ™</strong>: èµ„æºå; <strong>å¯¹å½“å‰æ¥å£è¿›è¡Œç»‘å®š</strong>,    ç†”æ–­ç­–ç•¥: <strong>æ…¢è°ƒç”¨æ¯”ä¾‹</strong>,    æœ€å¤§RT:  <strong>200(æ¯«ç§’)</strong> [å½“å‰è®¾ç½®é¡¹ä¸ºè¯„ä¼°æ¥å£æ…¢çš„æ ‡å‡†,æˆ‘ä»¬è®¾ç½®äº†ç¡çœ 1000msè‚¯å®šæ˜¯å¤§äºè¯¥æ ‡å‡†çš„,æ•…ä¼šè¢«è¯„ä¼°æˆæ…¢ ],   æ¯”ä¾‹é˜ˆå€¼: <strong>0.3 (30%)</strong>,  ç†”æ–­æ—¶é•¿:  <strong>2(ç§’)</strong>  [æ–­å¼€æ—¶é•¿,ä¸å¤„ç†çš„æ—¶é•¿],    æœ€å°è¯·æ±‚æ•°:  <strong>5</strong>[è¿›è¡Œè¯¥æ“ä½œéœ€è¦çš„æœ€å°è¯·æ±‚æ•°],     ç»Ÿè®¡æ—¶é•¿:</p><p><strong>1000(æ¯«ç§’)</strong>[ç»Ÿè®¡1000æ¯«ç§’å†…çš„æ…¢è°ƒç”¨æ¥å£]  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/pay&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">pay</span><span class="params">(Integer id)</span> <span class="keyword">throws</span> InterruptedException&#123;</span><br><span class="line">    <span class="keyword">if</span>(Objects.isNull(id))&#123; <span class="comment">// å½“å‰æ¨¡æ‹Ÿæœªä¼ id,é»˜è®¤ä¸ºç©º</span></span><br><span class="line">        Thread.sleep(<span class="number">1000</span>); <span class="comment">// æ¨¡æ‹Ÿè°ƒç”¨ç¬¬ä¸‰æ–¹æ¥å£</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç»“æœ:  åŸºäºæˆ‘ä»¬è®¾å®šçš„æµ‹è¯•ç¯å¢ƒä¸‹,  åœ¨ç¬¬ä¸€æ‰¹è¯·æ±‚æ‰“è¿‡å»ä¹‹åå¿…å®šä¼šç†”æ–­,  ç†”æ–­ä¸¤ç§’å,   ç”±äºæˆ‘ä»¬è®¾å®šçš„æ˜¯äº”ç§’æŒç»­å‘è¯·æ±‚,  åˆ™ä¸¤ç§’ä¹‹åä¼š<u>æ‰“ä¸€ä¸ªè¯·æ±‚è¿‡æ¥</u>æµ‹è¯•æ˜¯å¦é€šè·¯,  å¦‚æœèƒ½åˆ™Closedé€šè·¯</p><h5 id="å¼‚å¸¸æ¯”ä¾‹-ERROR-RATIO"><a href="#å¼‚å¸¸æ¯”ä¾‹-ERROR-RATIO" class="headerlink" title="å¼‚å¸¸æ¯”ä¾‹ (ERROR_RATIO)"></a>å¼‚å¸¸æ¯”ä¾‹ (ERROR_RATIO)</h5><p>å½“å•ä½ç»Ÿè®¡æ—¶é•¿ï¼ˆstatIntervalMsï¼‰å†…è¯·æ±‚æ•°ç›®å¤§äºè®¾ç½®çš„æœ€å°è¯·æ±‚æ•°ç›®ï¼Œå¹¶ä¸”å¼‚å¸¸çš„æ¯”ä¾‹å¤§äºé˜ˆå€¼ï¼Œåˆ™æ¥ä¸‹æ¥çš„ç†”æ–­æ—¶é•¿å†…è¯·æ±‚ä¼šè‡ªåŠ¨è¢«ç†”æ–­ã€‚ç»è¿‡ç†”æ–­æ—¶é•¿åç†”æ–­å™¨ä¼šè¿›å…¥æ¢æµ‹æ¢å¤çŠ¶æ€ï¼ˆHALF-OPEN çŠ¶æ€ï¼‰ï¼Œè‹¥æ¥ä¸‹æ¥çš„ä¸€ä¸ªè¯·æ±‚æˆåŠŸå®Œæˆï¼ˆæ²¡æœ‰é”™è¯¯ï¼‰åˆ™ç»“æŸç†”æ–­ï¼Œå¦åˆ™ä¼šå†æ¬¡è¢«ç†”æ–­ã€‚å¼‚å¸¸æ¯”ç‡çš„é˜ˆå€¼èŒƒå›´æ˜¯ [0.0, 1.0]ï¼Œä»£è¡¨ 0% - 100%ã€‚</p><p><strong>å¼‚å¸¸æ¯”ä¾‹æ¨¡æ‹Ÿ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/pay&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">pay</span><span class="params">(Integer id)</span> <span class="keyword">throws</span> InterruptedException&#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">if</span>(random==<span class="number">1</span> || random==<span class="number">3</span>)&#123; <span class="comment">// 0-4:äº”ä¸ªéšæœºæ•°ä¸­çš„ä¸¤ä¸ª æ¨¡æ‹Ÿæ¦‚ç‡ä¸º40%</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;å‡ºç°å¼‚å¸¸äº†&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="å¼‚å¸¸æ•°-ERROR-COUNT"><a href="#å¼‚å¸¸æ•°-ERROR-COUNT" class="headerlink" title="å¼‚å¸¸æ•° (ERROR_COUNT)"></a>å¼‚å¸¸æ•° (ERROR_COUNT)</h5><p>å½“å•ä½ç»Ÿè®¡æ—¶é•¿å†…çš„å¼‚å¸¸æ•°ç›®è¶…è¿‡é˜ˆå€¼ä¹‹åä¼šè‡ªåŠ¨è¿›è¡Œç†”æ–­ã€‚ç»è¿‡ç†”æ–­æ—¶é•¿åç†”æ–­å™¨ä¼šè¿›å…¥æ¢æµ‹æ¢å¤çŠ¶æ€ï¼ˆHALF-OPEN çŠ¶æ€ï¼‰ï¼Œè‹¥æ¥ä¸‹æ¥çš„ä¸€ä¸ªè¯·æ±‚æˆåŠŸå®Œæˆï¼ˆæ²¡æœ‰é”™è¯¯ï¼‰åˆ™ç»“æŸç†”æ–­ï¼Œå¦åˆ™ä¼šå†æ¬¡è¢«ç†”æ–­ã€‚</p><blockquote><p>æ³¨æ„å¼‚å¸¸é™çº§<strong>ä»…é’ˆå¯¹ä¸šåŠ¡å¼‚å¸¸</strong>ï¼Œå¯¹ Sentinel é™æµé™çº§æœ¬èº«çš„å¼‚å¸¸ï¼ˆ<code>BlockException</code>ï¼‰ä¸ç”Ÿæ•ˆã€‚ä¸ºäº†ç»Ÿè®¡å¼‚å¸¸æ¯”ä¾‹æˆ–å¼‚å¸¸æ•°ï¼Œéœ€è¦é€šè¿‡ <code>Tracer.trace(ex)</code> è®°å½•ä¸šåŠ¡å¼‚å¸¸</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/pay&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">pay</span><span class="params">(Integer id)</span> <span class="keyword">throws</span> InterruptedException&#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">if</span>(random==<span class="number">1</span> || random==<span class="number">3</span>)&#123; <span class="comment">// 0-4:äº”ä¸ªéšæœºæ•°ä¸­çš„ä¸¤ä¸ª æ¨¡æ‹Ÿæ¦‚ç‡ä¸º40%</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;å‡ºç°å¼‚å¸¸äº†&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä»£ç ä¸­</strong>:  å¼‚å¸¸æ•°<strong>40%</strong></p><p><strong>jmiter</strong>: çº¿ç¨‹:<strong>100</strong>,  Ramp-Up:<strong>5</strong>,  å¾ªç¯:<strong>1</strong></p><p><strong>ç†”æ–­è§„åˆ™</strong>: èµ„æºå; <strong>å¯¹å½“å‰æ¥å£è¿›è¡Œç»‘å®š</strong>,    ç†”æ–­ç­–ç•¥: <strong>å¼‚å¸¸æ•°</strong>,    å¼‚å¸¸æ•°:  <strong>6</strong>,  ç†”æ–­æ—¶é•¿:  <strong>2(ç§’)</strong>  [æ–­å¼€æ—¶é•¿,ä¸å¤„ç†çš„æ—¶é•¿],    æœ€å°è¯·æ±‚æ•°:  <strong>5</strong>[è¿›è¡Œè¯¥æ“ä½œéœ€è¦çš„æœ€å°è¯·æ±‚æ•°]</p><p><img src="https://s2.loli.net/2023/12/03/K1fsRj5iqLQS8Dc.png"></p><p>å¯¹äºå½“å‰æ¨¡æ‹Ÿç»“è¿‡çš„ç›‘æ§å›¾å¯ä»¥çœ‹å‡º,  åœ¨å³ä¾§çš„15.20å¤„[å³15:20:32-15:20:37],  å¯¹äº15:20:34å¤„çš„ä¸€ä¸ªQPSåˆ™ä¸ºç†”æ–­åçš„ç‚¹æµ‹æ˜¯å¦å¯é€šï¼Œå¯é€šåˆ™Closedé€šè·¯ï¼Œå¯¹äº15:20:36åˆ™ä¸ºé€šè·¯åçš„è¯·æ±‚ï¼Œç„¶ååˆç†”æ–­ã€‚å½“å‰æ¨¡æ‹Ÿå›¾ï¼Œåœ¨å¼€å§‹è¯·æ±‚åå¼‚å¸¸æ•°å°±è¾¾åˆ°äº†ç†”æ–­æ ‡å‡†ã€‚</p><h3 id="çƒ­ç‚¹å‚æ•°é™æµ"><a href="#çƒ­ç‚¹å‚æ•°é™æµ" class="headerlink" title="çƒ­ç‚¹å‚æ•°é™æµ"></a>çƒ­ç‚¹å‚æ•°é™æµ</h3><h4 id="æ¡ˆä¾‹ä¸ä»‹ç»"><a href="#æ¡ˆä¾‹ä¸ä»‹ç»" class="headerlink" title="æ¡ˆä¾‹ä¸ä»‹ç»"></a>æ¡ˆä¾‹ä¸ä»‹ç»</h4><p>ä½•ä¸ºçƒ­ç‚¹ï¼Ÿçƒ­ç‚¹å³ç»å¸¸è®¿é—®çš„æ•°æ®ã€‚å¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¸Œæœ›ç»Ÿè®¡æŸä¸ªçƒ­ç‚¹æ•°æ®ä¸­è®¿é—®é¢‘æ¬¡æœ€é«˜çš„ Top K æ•°æ®ï¼Œå¹¶å¯¹å…¶è®¿é—®è¿›è¡Œé™åˆ¶ã€‚æ¯”å¦‚ï¼š</p><ul><li>å•†å“ ID ä¸ºå‚æ•°ï¼Œç»Ÿè®¡ä¸€æ®µæ—¶é—´å†…æœ€å¸¸è´­ä¹°çš„å•†å“ ID å¹¶è¿›è¡Œé™åˆ¶</li><li>ç”¨æˆ· ID ä¸ºå‚æ•°ï¼Œé’ˆå¯¹ä¸€æ®µæ—¶é—´å†…é¢‘ç¹è®¿é—®çš„ç”¨æˆ· ID è¿›è¡Œé™åˆ¶</li></ul><p>çƒ­ç‚¹å‚æ•°é™æµä¼šç»Ÿè®¡ä¼ å…¥å‚æ•°ä¸­çš„çƒ­ç‚¹å‚æ•°ï¼Œå¹¶æ ¹æ®é…ç½®çš„é™æµé˜ˆå€¼ä¸æ¨¡å¼ï¼Œå¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨è¿›è¡Œé™æµã€‚çƒ­ç‚¹å‚æ•°é™æµå¯ä»¥çœ‹åšæ˜¯ä¸€ç§ç‰¹æ®Šçš„æµé‡æ§åˆ¶ï¼Œä»…å¯¹åŒ…å«çƒ­ç‚¹å‚æ•°çš„èµ„æºè°ƒç”¨ç”Ÿæ•ˆã€‚</p><p><img src="https://github.com/alibaba/Sentinel/wiki/image/sentinel-hot-param-overview-1.png"></p><p>Sentinel åˆ©ç”¨ LRU ç­–ç•¥ç»Ÿè®¡æœ€è¿‘æœ€å¸¸è®¿é—®çš„çƒ­ç‚¹å‚æ•°ï¼Œç»“åˆä»¤ç‰Œæ¡¶ç®—æ³•æ¥è¿›è¡Œå‚æ•°çº§åˆ«çš„æµæ§ã€‚çƒ­ç‚¹å‚æ•°é™æµæ”¯æŒé›†ç¾¤æ¨¡å¼ã€‚</p><p>å®˜æ–¹æ–‡æ¡£  <a href="https://github.com/alibaba/Sentinel/wiki/%E7%83%AD%E7%82%B9%E5%8F%82%E6%95%B0%E9%99%90%E6%B5%81">çƒ­ç‚¹å‚æ•°é™æµ Â· alibaba&#x2F;Sentinel Wiki</a></p><p>ä½¿ç”¨æ–¹æ³•:</p><p>åœ¨éœ€è¦é™æµçš„èµ„æºä¸Šé¢å¢åŠ æ³¨è§£<code>@Sentinel(Xxx)</code>,  ç„¶ååœ¨å®¢æˆ·ç«¯è¿›è¡Œå¯è§†åŒ–é…ç½®é™æµç­–ç•¥å³å¯</p><p>ä¾‹å¦‚æˆ‘ä»¬éœ€è¦å¯¹åˆ†é¡µæ•°æ®è¿›è¡Œçƒ­ç‚¹é™æµ,  å› ä¸ºç¬¬ä¸€é¡µåˆ†é¡µå¾€å¾€è®¿é—®é‡å¤§  ç¤ºä¾‹å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/findByPage&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(value = &quot;hot-key-page&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;PageBean&gt; <span class="title function_">findByPage</span><span class="params">(Integer pageNum, </span></span><br><span class="line"><span class="params">                                   Integer pageSize,</span></span><br><span class="line"><span class="params">                                   <span class="meta">@RequestParam(required = false)</span> String sortBy,</span></span><br><span class="line"><span class="params">                                   <span class="meta">@RequestParam(required = false)</span> String sort)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> resfoodService.findByPage(pageNum, pageSize, sortBy, sort);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®å¥½æ³¨è§£ä¹‹å,  æˆ‘ä»¬åœ¨Sentinel Dashboardå¯¼èˆªæ é€‰æ‹©<strong>çƒ­ç‚¹è§„åˆ™</strong>,  ç‚¹å‡»<strong>æ–°å¢çƒ­ç‚¹è§„åˆ™</strong>,  <strong>èµ„æºå</strong>å¡«å…¥åœ¨æœåŠ¡ä¸­è®¾ç½®çš„Key,  <strong>å‚æ•°ç´¢å¼•</strong>é¡ºåºä¸ºæ–¹æ³•å½¢å‚é¡ºåº(ä»0å¼€å§‹),   <strong>å•æœºé˜ˆå€¼</strong>è®¿é—®è¶…è¿‡é˜ˆå€¼åˆ™å¼€å¯çƒ­ç‚¹é™æµæ§åˆ¶,  </p><p><strong>ç»Ÿè®¡çª—å£æ—¶é•¿</strong>åœ¨è¯¥æ—¶é•¿å†…ã€‚</p><p>å½“å‰æµ‹è¯•ç¯å¢ƒå¦‚ä¸‹ï¼š </p><p>å®¢æˆ·ç«¯:  å‚æ•°ç´¢å¼•:  <strong>0</strong> [ç¬¬0ä¸ªå‚æ•°ä¸ºåˆ†é¡µå‚æ•°],    å•æœºé˜ˆå€¼:  <strong>5</strong>  [åœ¨ç»Ÿè®¡çª—å£æ—¶é•¿å†…æœ‰5ä¸ªè¯·æ±‚åˆ™è¿›è¡Œé™æµ],  ç»Ÿè®¡çª—å£æ—¶é•¿:  <strong>1</strong>(ç§’),   å¯¹äºå‚æ•°ç´¢å¼•å¯ä»¥è¿›è¡Œé¢å¤–é…ç½®:  å½“å‰æˆ‘ä»¬é…ç½®å‚æ•°ç±»å‹ä¸º<strong>Int</strong>,  å‚æ•°å€¼ä¸º<strong>1</strong>(ç¬¬ä¸€é¡µ),  é™æµé˜ˆå€¼ <strong>10</strong>(è®¾ç½®äº†è¯¥é¡¹, å•æœºé˜ˆå€¼åˆ™å¤±æ•ˆ)</p><p>æ­¤æ—¶å‘é€è¯·æ±‚,  å¯¹äºç¬¬ä¸€é¡µçš„æ•°æ®è¿›è¡Œè®¿é—®,   åœ¨ä¸€ç§’é’Ÿå†…å¼€å¯100ä¸ªçº¿ç¨‹è®¿é—®ä¸€æ¬¡,   æœ€åä»…å¯ä»¥è®¿é—®<strong>10</strong>(é™æµé˜ˆå€¼)ä¸ª,  å…¶ä»–çš„éƒ½è¢«é™æµ</p><h4 id="çƒ­ç‚¹è§„åˆ™åè¯äº†è§£"><a href="#çƒ­ç‚¹è§„åˆ™åè¯äº†è§£" class="headerlink" title="çƒ­ç‚¹è§„åˆ™åè¯äº†è§£"></a>çƒ­ç‚¹è§„åˆ™åè¯äº†è§£</h4><h5 id="LRU-ç­–ç•¥"><a href="#LRU-ç­–ç•¥" class="headerlink" title="LRU ç­–ç•¥"></a>LRU ç­–ç•¥</h5><p>LRUç­–ç•¥æ˜¯ä¸€ç§ç¼“å­˜æ·˜æ±°ç­–ç•¥ï¼Œå®ƒçš„å…¨ç§°æ˜¯Least Recently Usedï¼Œå³æœ€è¿‘æœ€å°‘ä½¿ç”¨ã€‚LRUç­–ç•¥çš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šå¦‚æœä¸€ä¸ªæ•°æ®åœ¨æœ€è¿‘ä¸€æ®µæ—¶é—´æ²¡æœ‰è¢«è®¿é—®åˆ°ï¼Œé‚£ä¹ˆåœ¨å°†æ¥å®ƒè¢«è®¿é—®çš„å¯èƒ½æ€§ä¹Ÿå¾ˆå°ï¼Œé‚£ä¹ˆå°±å¯ä»¥å°†å…¶æ·˜æ±°ã€‚LRUç®—æ³•çš„å®ç°æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œæ¯”å¦‚å¯ä»¥ä½¿ç”¨é“¾è¡¨ã€å“ˆå¸Œè¡¨ç­‰æ•°æ®ç»“æ„</p><h5 id="ä»¤ç‰Œæ¡¶ç®—æ³•"><a href="#ä»¤ç‰Œæ¡¶ç®—æ³•" class="headerlink" title="ä»¤ç‰Œæ¡¶ç®—æ³•"></a>ä»¤ç‰Œæ¡¶ç®—æ³•</h5><p>ä»¤ç‰Œæ¡¶ç®—æ³•æ˜¯ä¸€ç§æµé‡æ§åˆ¶ç®—æ³•ï¼Œå®ƒçš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šç³»ç»Ÿä»¥æ’å®šçš„é€Ÿç‡å¾€æ¡¶é‡Œæ”¾å…¥ä»¤ç‰Œï¼Œè€Œå¦‚æœè¯·æ±‚éœ€è¦è¢«å¤„ç†ï¼Œåˆ™éœ€è¦å…ˆä»æ¡¶é‡Œè·å–ä¸€ä¸ªä»¤ç‰Œï¼Œå½“æ¡¶é‡Œæ²¡æœ‰ä»¤ç‰Œå¯å–æ—¶ï¼Œåˆ™æ‹’ç»æœåŠ¡ã€‚ä»¤ç‰Œæ¡¶ç®—æ³•çš„å®ç°æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œæ¯”å¦‚å¯ä»¥ä½¿ç”¨é˜»å¡é˜Ÿåˆ—ã€å®šæ—¶å™¨ç­‰æ–¹å¼</p><h3 id="é»‘ç™½åå•æ§åˆ¶-æˆæƒ"><a href="#é»‘ç™½åå•æ§åˆ¶-æˆæƒ" class="headerlink" title="é»‘ç™½åå•æ§åˆ¶&#x2F;æˆæƒ"></a>é»‘ç™½åå•æ§åˆ¶&#x2F;æˆæƒ</h3><p>å®˜æ–¹æ–‡æ¡£  <a href="https://github.com/alibaba/Sentinel/wiki/%E9%BB%91%E7%99%BD%E5%90%8D%E5%8D%95%E6%8E%A7%E5%88%B6">é»‘ç™½åå•æ§åˆ¶ Â· alibaba&#x2F;Sentinel Wiki (github.com)</a></p><p>éœ€è¦æ ¹æ®è°ƒç”¨æ¥æºæ¥åˆ¤æ–­è¯¥æ¬¡è¯·æ±‚æ˜¯å¦å…è®¸æ”¾è¡Œï¼Œè¿™æ—¶å€™å¯ä»¥ä½¿ç”¨ Sentinel çš„æ¥æºè®¿é—®æ§åˆ¶ï¼ˆé»‘ç™½åå•æ§åˆ¶ï¼‰çš„åŠŸèƒ½</p><p>åŸç†: æ¥æºè®¿é—®æ§åˆ¶æ ¹æ®èµ„æºçš„è¯·æ±‚æ¥æºï¼ˆoriginï¼‰é™åˆ¶èµ„æºæ˜¯å¦é€šè¿‡ï¼Œè‹¥é…ç½®ç™½åå•åˆ™åªæœ‰è¯·æ±‚æ¥æºä½äºç™½åå•å†…æ—¶æ‰å¯é€šè¿‡ï¼›è‹¥é…ç½®é»‘åå•åˆ™è¯·æ±‚æ¥æºä½äºé»‘åå•æ—¶ä¸é€šè¿‡ï¼Œå…¶ä½™çš„è¯·æ±‚é€šè¿‡</p><p>å…¶å®å°±æ˜¯æ‹¦æˆªè¯·æ±‚å¤´æˆ–è€…å…¶ä»–èµ„æº</p><h4 id="Sentinelå®¢æˆ·ç«¯æˆæƒ"><a href="#Sentinelå®¢æˆ·ç«¯æˆæƒ" class="headerlink" title="Sentinelå®¢æˆ·ç«¯æˆæƒ"></a>Sentinelå®¢æˆ·ç«¯æˆæƒ</h4><p>æ‰“å¼€Sentinelå®¢æˆ·ç«¯,  åœ¨å·¦ä¾§å¯¼èˆªæ é€‰æ‹©æˆæƒè§„åˆ™,  å¯¹æŒ‡å®šæœåŠ¡<strong>æ–°å¢æˆæƒè§„åˆ™</strong>,  ç¤ºä¾‹å¦‚ä¸‹å›¾</p><p><img src="https://calyee-image.pages.dev/file/02ad2bb1df06d3153a5b8.png"></p><p>å›¾ä¾‹ä¸­,  æˆ‘ä»¬å¯¹èµ„æºåä¸º<code>/user/getUserInfo</code>è¿›è¡Œè§„åˆ™é™åˆ¶,  è®¾ç½®æµæ§åº”ç”¨ä¸º<code>blackList</code>, æˆæƒç±»å‹ä¸ºé»‘åå•.  é‚£ä¹ˆæ„å‘³ç€å¦‚æœOriginä¸­åŒ…å«blackListåˆ™ä¼šè¢«è¿›è¡Œé™åˆ¶(å› ä¸ºæ­¤æ—¶æ˜¯é»‘åå•æˆæƒ)</p><p>å¦‚ä½•è¿›è¡Œæµ‹è¯•å‘¢:  ä½¿ç”¨jmiterå¯¹è¯¥æ¥å£èµ„æºè¿›è¡Œè®¿é—®,  åœ¨ç›¸å¯¹åº”çš„èµ„æºå³é”® -&gt; æ·»åŠ  -&gt; å‰ç½®å¤„ç†å™¨ -&gt;  HTTPä¿¡æ¯å¤´ç®¡ç†å™¨ -&gt; åœ¨Originæ·»åŠ valueä¸ºblackList,  è¿›è¡Œå¹¶å‘æµ‹è¯•å¯ä»¥æ¸…æ™°çš„çœ‹è§æ‰€æœ‰å¸¦æ­¤å¤´çš„è¯·æ±‚å‡è¢«æ‹¦æˆª,  åœ¨å–æ ·ç»“æœ(ç»“æœæ ‘)å¯ä»¥çœ‹åˆ° : <code>Blocked by Sentinel (flow limiting)</code>: Sentinelæµæ§é˜»æ­¢é™åˆ¶.</p><p>è‹¥è°ƒæ•´é€‰é¡¹ä¸ºç™½åå•åˆ™åŒ…å«æ­¤å¤´ä¿¡æ¯çš„æ‰å¯ä»¥è®¿é—®è¯¥èµ„æº</p><h4 id="ç¼–ç æˆæƒç¤ºä¾‹"><a href="#ç¼–ç æˆæƒç¤ºä¾‹" class="headerlink" title="ç¼–ç æˆæƒç¤ºä¾‹"></a>ç¼–ç æˆæƒç¤ºä¾‹</h4><p><strong>åœ¨æœåŠ¡æä¾›æ–¹(FoodService)</strong></p><ul><li>æ·»åŠ ä¾èµ–</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- sentinelä¾èµ– --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>é…ç½®SentinelæœåŠ¡å™¨</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">sentinel:</span>  <span class="comment">#sentinelé…ç½®</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">8719</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="string">localhost:9999</span>  <span class="comment"># sentinelæœåŠ¡</span></span><br><span class="line">      <span class="attr">eager:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">web-context-unify:</span> <span class="literal">false</span> <span class="comment">#web-context-unify æ˜¯ Sentinel çš„ä¸€ä¸ªé…ç½®é¡¹ï¼Œç”¨äºç»Ÿä¸€ Web è¯·æ±‚çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚åœ¨ Sentinel ä¸­ï¼ŒWeb è¯·æ±‚çš„ä¸Šä¸‹æ–‡ä¿¡æ¯åŒ…æ‹¬è¯·æ±‚è·¯å¾„ã€è¯·æ±‚æ–¹æ³•ã€è¯·æ±‚å‚æ•°ã€è¯·æ±‚å¤´ç­‰</span></span><br></pre></td></tr></table></figure><ul><li>æ·»åŠ è§£æå™¨</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="comment">// RequestOriginParser: Sentinelç”¨äºè§£æOriginçš„æ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomerRequestOriginParser</span> <span class="keyword">implements</span> <span class="title class_">RequestOriginParser</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">parseOrigin</span><span class="params">(HttpServletRequest httpServletRequest)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;è§£æè¯·æ±‚å¤´ä¸­çš„origin&quot;</span>);</span><br><span class="line">        String source= httpServletRequest.getHeader(<span class="string">&quot;source&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;è¯·æ±‚æ¥æºä¸º:&quot;</span>+source);</span><br><span class="line">        <span class="keyword">return</span> source;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åœ¨æœåŠ¡è°ƒç”¨æ–¹(OrderService)</strong></p><ul><li>åˆ©ç”¨æ‹¦æˆªå™¨åœ¨openfeignå‘å‡ºè¯·æ±‚æ—¶ç»Ÿä¸€åŠ å…¥originä¿¡æ¯(æ­¤æ–¹æ¡ˆä¸å¯ç”¨,åœ¨å‘é€æ—¶ä¼šæ·»åŠ ,ä½†åœ¨æ¥æ”¶çš„æ—¶å€™å°±æ²¡æœ‰äº†)</li></ul><p>è™½ç„¶æ ‡é¢˜è¯´ä¸å¯ç”¨,  ä¸å¯ç”¨çš„æ¡ä»¶æ˜¯,  æˆ‘ä»¬è®¾ç½®å¤´çš„keyä¸ºOriginä¸å…¶åŸæœ¬çš„å†²çªäº†,  åªéœ€è¦æ”¹å…¶ä»–åå­—å°±å¯ä»¥äº†,  ä¾‹å¦‚å½“å‰å·²ç»ä¿®æ”¹æˆsourceå°±å¯ä»¥,  åœ¨åæ¥åªéœ€è¦æ‹¦æˆªsourceå³å¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¯·æ±‚æ‹¦æˆªå™¨ï¼Œç»Ÿä¸€åŠ å…¥ originè¯·æ±‚å¤´ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomerRequestInterceptor</span> <span class="keyword">implements</span> <span class="title class_">RequestInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">apply</span><span class="params">(RequestTemplate requestTemplate)</span> &#123;</span><br><span class="line">        <span class="comment">// åœ¨OpenFeignä¸­æ·»åŠ å¤´ä¿¡æ¯</span></span><br><span class="line">        requestTemplate.header( <span class="string">&quot;source&quot;</span>,<span class="string">&quot;blackList&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬”è€…æŸ¥é˜…èµ„æ–™å¾—çŸ¥è¿˜å¯ä»¥åœ¨ä½¿ç”¨SpringMVCæ³¨è§£å†…æ·»åŠ å¤´åŸŸä¿¡æ¯,  ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/findById&quot;,headers = &#123;&quot;Origin=blackList&quot;&#125;)</span> <span class="comment">// ä¸èƒ½ç”¨Origin,å…³é”®å­—ä¼šä¸åŸæ¥çš„å­—æ®µå†²çª</span></span><br><span class="line"><span class="keyword">public</span> Resfood <span class="title function_">findById</span><span class="params">(<span class="meta">@RequestParam(&quot;id&quot;)</span> Integer id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> resfoodService.findById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç³»ç»Ÿè‡ªé€‚åº”é™æµ"><a href="#ç³»ç»Ÿè‡ªé€‚åº”é™æµ" class="headerlink" title="ç³»ç»Ÿè‡ªé€‚åº”é™æµ"></a>ç³»ç»Ÿè‡ªé€‚åº”é™æµ</h3><p><a href="https://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81">ç³»ç»Ÿè‡ªé€‚åº”é™æµ Â· alibaba&#x2F;Sentinel Wiki</a></p><p>Sentinel ç³»ç»Ÿè‡ªé€‚åº”è¿‡è½½ä¿æŠ¤ä»æ•´ä½“ç»´åº¦å¯¹åº”ç”¨å…¥å£æµé‡è¿›è¡Œæ§åˆ¶ï¼Œç»“åˆåº”ç”¨çš„ Loadã€CPU ä½¿ç”¨ç‡ã€æ€»ä½“å¹³å‡ RTã€å…¥å£ QPS å’Œå¹¶å‘çº¿ç¨‹æ•°ç­‰å‡ ä¸ªç»´åº¦çš„ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡è‡ªé€‚åº”çš„æµæ§ç­–ç•¥ï¼Œè®©ç³»ç»Ÿçš„å…¥å£æµé‡å’Œç³»ç»Ÿçš„è´Ÿè½½è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡ï¼Œè®©ç³»ç»Ÿå°½å¯èƒ½è·‘åœ¨æœ€å¤§ååé‡çš„åŒæ—¶ä¿è¯ç³»ç»Ÿæ•´ä½“çš„ç¨³å®šæ€§ã€‚</p><p>åœ¨Sentinelå®¢æˆ·ç«¯é€‰æ‹©ç³»ç»Ÿè§„åˆ™</p><p><img src="https://s2.loli.net/2023/12/18/AlBVFJUShEP7mfN.png"></p><p>åœ¨æ­¤æ¡ˆä¾‹ä¸­æˆ‘ä»¬é€‰æ‹©å…¥å£QPSä¸º10è¿›è¡Œæµ‹è¯•,  Jmiteræµ‹è¯•ç¯å¢ƒ: 60ä¸ªçº¿ç¨‹ æŒç»­2ç§’ é‡å¤ä¸€æ¬¡(å³ä¸€ç§’30QPS)</p><p><img src="https://s2.loli.net/2023/12/18/mCaU7ZgQJ2HGRBi.png"></p><p>å¦‚å›¾è¶…è¿‡é˜ˆå€¼,åˆ™æœ€å¤šåªèƒ½é€šè¿‡10QPS,  è¶…è¿‡è¯¥é˜ˆå€¼çš„å…¨éƒ¨è¢«æ‹’ç»</p><h3 id="ä¸šåŠ¡å¼‚å¸¸çš„å›è°ƒå¤„ç†"><a href="#ä¸šåŠ¡å¼‚å¸¸çš„å›è°ƒå¤„ç†" class="headerlink" title="ä¸šåŠ¡å¼‚å¸¸çš„å›è°ƒå¤„ç†"></a>ä¸šåŠ¡å¼‚å¸¸çš„å›è°ƒå¤„ç†</h3><p>å¦‚æœç›‘æ§çš„èµ„æºå‡ºç°äº†ä¸šåŠ¡å¼‚å¸¸(ä¾‹å¦‚: controlleræ‰§è¡Œè°ƒç”¨ä¸šåŠ¡å±‚å‡ºç°å¼‚å¸¸,ä¸å¤„ç†åˆ™ä¼šæŠ›å‡º500å¼‚å¸¸)</p><ul><li>éœ€æ±‚: å¦‚æœæµæ§è§„åˆ™èµ·ä½œç”¨äº†ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œsentinelä»¥  httpå“åº”ç  4xxå½¢å¼å›é€ä¸€æ¡ ä¿¡æ¯,  è€Œä¸æ˜¯é»˜è®¤è¿”å›çš„500.</li></ul><blockquote><p> æœ¬èŠ‚ä¸‹åˆ—æ‰€è¿°å‡ä¸ºåœ¨æ³¨è§£<code>@SentinelResource</code>å¤„ç†,  ä¾‹å¦‚ <code>@SentinelResource(value = &quot;a-service&quot;)</code></p></blockquote><h4 id="blockHandler-blockHandlerClass"><a href="#blockHandler-blockHandlerClass" class="headerlink" title="blockHandler&#x2F;blockHandlerClass"></a>blockHandler&#x2F;blockHandlerClass</h4><p>blockHandler ç”¨äºå¤„ç†è¢« Sentinel é˜»æ­¢çš„è¯·æ±‚ï¼Œä¾‹å¦‚å½“è¯·æ±‚è¶…è¿‡é™æµé˜ˆå€¼æ—¶ï¼ŒSentinel ä¼šè‡ªåŠ¨é˜»æ­¢è¯¥è¯·æ±‚ï¼Œå¹¶è°ƒç”¨æŒ‡å®šçš„ blockHandler æ–¹æ³•è¿›è¡Œå¤„ç† ,  è¿™æ ·å¯ä»¥å°†æµæ§è¿™ç§å¼‚å¸¸ä¿¡æ¯è½¬ä¸ºä¸šåŠ¡è¦å¤„ç†çš„æ¶ˆæ¯æ ¼å¼. </p><p>é€šè¿‡é˜…è¯»æºç æ³¨è§£æ³¨é‡Š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The &#123;<span class="doctag">@code</span> blockHandler&#125; is located in the same class with the original method by default.</span></span><br><span class="line"><span class="comment">     * However, if some methods share the same signature and intend to set the same block handler,</span></span><br><span class="line"><span class="comment">     * then users can set the class where the block handler exists. Note that the block handler method</span></span><br><span class="line"><span class="comment">     * must be static.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the class where the block handler exists, should not provide more than one classes</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>å¯çŸ¥:  è‡ªå®šä¹‰å›è°ƒå¤„ç†æ–¹æ³•åº”è¯¥ä¸åŠ æ³¨è§£éœ€è¦å¤„ç†çš„èµ„æºåœ¨åŒä¸€ä¸ªç±»ä¸‹,  blockHandlerä¸­æŒ‡æ˜çš„æ–¹æ³•å¿…é¡»ä¸ºé™æ€çš„</p><h5 id="ä»£ç ç¼–å†™"><a href="#ä»£ç ç¼–å†™" class="headerlink" title="ä»£ç ç¼–å†™"></a>ä»£ç ç¼–å†™</h5><p>æˆ‘ä»¬é€šè¿‡è®¾ç½®ä¹‹å,  é€‰æ‹©food-serviceæœåŠ¡,  findByPageæ¥å£ä¸ºä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ­¤æ–¹æ³•ä¸­çš„å‚æ•°æ˜¯ç”±Sentinelåœ¨è¿è¡Œæ—¶ä»¥ DIçš„æ–¹å¼æ³¨å…¥çš„</span></span><br><span class="line"><span class="comment">// BlockException: åŒ…è£…æµå¼‚å¸¸çš„æ‰€æœ‰ä¿¡æ¯    æ³¨æ„æ˜¯æµå¼‚å¸¸</span></span><br><span class="line"><span class="keyword">private</span> Result <span class="title function_">blockHandlerMethod</span><span class="params">(Integer pageNum, Integer pageSize, String sortBy, String sort,</span></span><br><span class="line"><span class="params">                            BlockException exception)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">info</span> <span class="operator">=</span> String.format(<span class="string">&quot;è°ƒç”¨åˆ†é¡µæŸ¥è¯¢æ—¶å‘ç”Ÿé”™è¯¯,Message:pageNum=%s,pageSize=%s,sortBy=%s,sort=%s,role=%s,e=%s&quot;</span>,</span><br><span class="line">                                pageNum, pageSize, sortBy, sort, exception.getRule(), exception.getMessage());</span><br><span class="line">    <span class="keyword">return</span> Result.build(<span class="string">&quot;&quot;</span>, <span class="number">201</span>, info);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/findByPage&quot;)</span></span><br><span class="line"><span class="meta">@SentinelResource(value = &quot;hot-key-page&quot;, </span></span><br><span class="line"><span class="meta">                  blockHandler = &quot;blockHandlerMethod&quot;)</span> <span class="comment">// * blockHandler</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">findByPage</span><span class="params">(Integer pageNum, Integer pageSize,</span></span><br><span class="line"><span class="params">                         <span class="meta">@RequestParam(required = false)</span> String sortBy,</span></span><br><span class="line"><span class="params">                         <span class="meta">@RequestParam(required = false)</span> String sort)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> resfoodService.findByPage(pageNum, pageSize, sortBy, sort);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“å‰æˆ‘ä»¬è®¾ç½®çš„æ˜¯:  å¦‚æœfindByPageæ¥å£å‡ºç°å¼‚å¸¸,  åˆ™ä¼šè°ƒç”¨<code>blockHandlerMethod</code>æ–¹æ³•(å³åœ¨ä¸Šé¢å£°æ˜çš„),  å£°æ˜çš„æ–¹æ³•ä¸º:  å¦‚æœå‘ç”Ÿäº†å¼‚å¸¸,  æˆ‘ä»¬å°†æ„é€ ä¸€ä¸ªè¿”å›<strong>ç»“æœé›†</strong> code&#x3D;200,  body&#x3D;â€â€,  msg&#x3D;info</p><p>info: åˆ™ä¸ºæˆ‘ä»¬æ„é€ çš„ä¿¡æ¯è¿”å›</p><h5 id="å®¢æˆ·ç«¯è®¾ç½®æµæ§"><a href="#å®¢æˆ·ç«¯è®¾ç½®æµæ§" class="headerlink" title="å®¢æˆ·ç«¯è®¾ç½®æµæ§"></a>å®¢æˆ·ç«¯è®¾ç½®æµæ§</h5><p>(Sentinel Dashboard)  æˆ‘ä»¬åœ¨<code>ç°‡ç‚¹é“¾è·¯</code> é€‰æ‹©æµæ§,  èµ„æºä¸ºhot-key-page(è®¾ç½®çš„<strong>èµ„æºå</strong>), QPSè®¾ç½®1 å…¶ä»–é«˜çº§è®¾ç½®é»˜è®¤å³å¯</p><h5 id="æµ‹è¯•ç»“æœ"><a href="#æµ‹è¯•ç»“æœ" class="headerlink" title="æµ‹è¯•ç»“æœ"></a>æµ‹è¯•ç»“æœ</h5><p>å‡å¦‚æ²¡æœ‰è®¾ç½®è¯¥é¡¹,  é‚£ä¹ˆåœ¨Jmiteræµ‹è¯•åˆ™ä¼šæ˜¯ä¸€ç‰‡çº¢,  å¦‚æœåƒè¿™æ ·è®¾ç½®äº†é‚£ä¹ˆä¼šå¾—åˆ°å¦‚å›¾æ‰€ç¤ºçš„ç»“æœ</p><p><img src="https://s2.loli.net/2023/12/18/bLxsUnhNvJzRpd2.png"></p><h4 id="fallback"><a href="#fallback" class="headerlink" title="fallback"></a>fallback</h4><p>fallbackå’Œä¸Šé¢æ¡ˆä¾‹çš„blockHandlerå¤§åŒå°å¼‚</p><p>åŒºåˆ«: </p><ul><li><p>blockHandler: ä¼ çš„å½¢å‚æ˜¯BlockExceptionæµå¼‚å¸¸</p></li><li><p>fallback: ä¼ å…¥çš„æ˜¯Throwableå…¶ä»–å¼‚å¸¸</p></li></ul><p>è‹¥éœ€æ¨¡æ‹Ÿ:  æä¾›æ€è·¯,  å¯ä»¥æ¨¡æ‹Ÿæ•°æ®åº“æ‰çº¿ (å³åœ¨è¿è¡Œçš„æ—¶å€™å…³é—­æ•°æ®åº“,åœ¨è¿›è¡Œè®¿é—®)</p><h4 id="å¯¹äºä¸Šè¿°ä¸¤ä¸ªæ¡ˆä¾‹"><a href="#å¯¹äºä¸Šè¿°ä¸¤ä¸ªæ¡ˆä¾‹" class="headerlink" title="å¯¹äºä¸Šè¿°ä¸¤ä¸ªæ¡ˆä¾‹"></a>å¯¹äºä¸Šè¿°ä¸¤ä¸ªæ¡ˆä¾‹</h4><p>åœ¨ä½¿ç”¨ä¸Š,  ä¸¤ä¸ªéƒ½å¤§åŒå°å¼‚.  å®é™…ä¸Š</p><ul><li>fallbackï¼šè‹¥æœ¬æ¥å£å‡ºç°æœªçŸ¥å¼‚å¸¸ï¼Œåˆ™è°ƒç”¨fallbackæŒ‡å®šçš„æ¥å£ã€‚</li><li>blockHandlerï¼šè‹¥æœ¬æ¬¡è®¿é—®è¢«é™æµæˆ–æœåŠ¡é™çº§ï¼Œåˆ™è°ƒç”¨blockHandleræŒ‡å®šçš„æ¥å£ã€‚</li></ul><p>æ‰€ä»¥:  fallbackä¸€èˆ¬ç”¨äºå¤„ç†ä¸šåŠ¡å¼‚å¸¸,  blockHandlerä¸€èˆ¬è¢«ç”¨äºå¤„ç†è¢«é™æµæˆ–æœåŠ¡é™çº§åçš„å¤„ç†</p><p>æ€»ç»“å‚è€ƒ: </p><ol><li>blockHandler</li></ol><p>blockHandlerä»…å¤„ç†é™æµå¼‚å¸¸ï¼›<br>ä½¿ç”¨blockHandleræ—¶ï¼Œæ–¹æ³•ç­¾åå‚æ•°ä¸åŸæ–¹æ³•ä¸€è‡´ï¼Œä¸”å¿…é¡»è¦åœ¨å‚æ•°çš„æœ€åä½ç½®è¡¥å……BlockExceptionå‚æ•°ï¼›<br>è‹¥æœªè¡¥å……BlockExceptionå‚æ•°åˆ™ä¸ç”Ÿæ•ˆï¼›</p><ol start="2"><li>fallback</li></ol><p>fallbackå¯ä»¥å¤„ç†æ‰€æœ‰ç±»å‹å¼‚å¸¸ï¼ŒåŒ…æ‹¬é™æµå¼‚å¸¸å’Œä¸šåŠ¡å¼‚å¸¸ï¼›<br>ä½¿ç”¨fallbackæ—¶ï¼Œæ–¹æ³•ç­¾åå‚æ•°å¯ä»¥ä¸åŸæ–¹æ³•å®Œå…¨ä¸€è‡´ï¼Œæˆ–è€…ä¹Ÿæ¥å—åœ¨å‚æ•°çš„æœ€åä½ç½®è¡¥å……Throwableå‚æ•°ï¼›<br>é€šè¿‡å¯¹Throwableå‚æ•°çš„ç±»å‹åŒºåˆ†æ˜¯é™æµå¼‚å¸¸è¿˜æ˜¯å…¶ä»–å¼‚å¸¸ï¼›<br>å½“åŒæ—¶ç”Ÿæ•ˆblockHandlerå’Œfallbackæ—¶ï¼Œé™æµå¼‚å¸¸ä¼šä¼˜å…ˆè¢«blockHandlerå¤„ç†è€Œä¸å†è¿›å…¥fallbacké€»è¾‘ï¼›<br>å¯æŸ¥çœ‹: <a href="https://blog.csdn.net/minghao0508/article/details/132148320">Sentinelçš„blockHandlerä¸fallback-CSDNåšå®¢</a></p><h3 id="AOPå®Œæˆä¸šåŠ¡å¼‚å¸¸ç»Ÿä¸€å¤„ç†"><a href="#AOPå®Œæˆä¸šåŠ¡å¼‚å¸¸ç»Ÿä¸€å¤„ç†" class="headerlink" title="AOPå®Œæˆä¸šåŠ¡å¼‚å¸¸ç»Ÿä¸€å¤„ç†"></a>AOPå®Œæˆä¸šåŠ¡å¼‚å¸¸ç»Ÿä¸€å¤„ç†</h3><blockquote><p>å…¶å®æœ¬èŠ‚ä¹Ÿæ˜¯è·Ÿä¸Šä¸€èŠ‚åº”è¯¥æ˜¯çˆ¶å­ç›®å½•å…³ç³»,  å› ä¸ºè¿‡äºé‡è¦,  æ‰€ä»¥æå‡ä¸€ä¸ªæ¡£ä½,  æ•…ä½äºåŒçº§ç›®å½•</p></blockquote><h4 id="ControllerAdvice"><a href="#ControllerAdvice" class="headerlink" title="@ControllerAdvice"></a>@ControllerAdvice</h4><p>åˆ©ç”¨æ³¨è§£é‡‡ç”¨AOPåˆ‡é¢å¤„ç†Controllerä¸­çš„å¼‚å¸¸, Adviceå¢å¼º</p><p>åˆ©ç”¨<code>@ExceptionHandler(RuntimeException.class)</code>æ•è·æŸå¼‚å¸¸,  ç„¶ååŒ…è£…å›é€(å¯ä»¥åˆ©ç”¨@ResponseBodyå›é€JSONæ•°æ®)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> CustomerExceptionHandler</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸ç»Ÿä¸€å¤„ç†åˆ‡é¢ç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ControllerAdvice</span>  <span class="comment">// Controlleræ§åˆ¶å™¨,ioc    Advice: aopä¸­çš„å¢å¼º</span></span><br><span class="line"><span class="meta">@Order(-100000)</span>    <span class="comment">// æœ‰å¾ˆå¤šå¢å¼º,å€¼è¶Šå°åˆ™è¶Šåœ¨å¤–å±‚,å€¼è¶Šå°åˆ™åœ¨æœ€å¤–é¢,å…¨éƒ¨è¦å¤„ç†åˆ°</span></span><br><span class="line"><span class="comment">// AOPæŠ€æœ¯</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomerExceptionHandler</span> &#123;</span><br><span class="line">    <span class="comment">// daoå¼‚å¸¸ -&gt; serviceå¼‚å¸¸, å¯¹äºäº‹åŠ¡å›æ»šé’ˆå¯¹é»˜è®¤ä¸ºRuntimeException -&gt; controller -&gt; è¢«æˆ‘ä»¬è‡ªå®šä¹‰çš„åˆ‡é¢æ‹¦æˆª</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­é”™è¯¯æ˜¯å¦æ˜¯å·²å®šä¹‰çš„å·²çŸ¥é”™è¯¯ï¼Œä¸æ˜¯åˆ™ç”±æœªçŸ¥é”™è¯¯ä»£æ›¿ï¼ŒåŒæ—¶è®°å½•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(value = Exception.class)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">exceptionGet</span><span class="params">(Throwable e)</span> &#123;</span><br><span class="line">        <span class="comment">// è‡ªå®šä¹‰æ·»åŠ </span></span><br><span class="line">        <span class="keyword">if</span> (e <span class="keyword">instanceof</span> Exception) &#123;</span><br><span class="line">            <span class="type">Exception</span> <span class="variable">exception</span> <span class="operator">=</span> (Exception) e;</span><br><span class="line">            <span class="keyword">return</span> Result.fail(exception.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;unknown error&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŠ ä¸Šè¯¥åˆ‡é¢å¢å¼ºä¹‹å,  å‡ºç°çš„è¿è¡Œæ—¶å¼‚å¸¸éƒ½ä¼šè¢«åˆ‡é¢å¤„ç†åˆ°ç„¶åä»¥æˆ‘ä»¬æ„é€ çš„ç»“æœé›†è¿”å›,  ä¸ä¼šåœ¨å‡ºç°500å¼‚å¸¸(é’ˆå¯¹æ­¤æ¡ˆä¾‹è€Œè¨€)</p><p>æ¨¡æ‹Ÿ:  åœ¨è¿è¡Œæ—¶å…³é—­æ•°æ®åº“,  é€šè¿‡Jmiterå‘é€è¯·æ±‚,  å‘ç°éƒ½æ˜¯ç»¿æ²¹æ²¹çš„201,  å†ä¹Ÿä¸æ˜¯çº¢çº¢çš„500äº†</p><p>æ­¤æ—¶è™½ç„¶æ˜¯å®Œæˆäº†ä¸šåŠ¡å¤„ç†,  è¿™é‡Œçš„å¤„ç†æŒ‡è¿”å›ç»“æœå¤„ç†,  ä½†æ˜¯è¿˜æ˜¯ä¸çŸ¥é“åœ¨å“ªé‡Œå‘ç”Ÿäº†å¼‚å¸¸,  å¾ˆä¸å‹å¥½,  å¯¹æ­¤æˆ‘ä»¬å¼•å…¥åˆ‡é¢æ—¥å¿—è®°å½•å¼‚å¸¸å‘ç”Ÿå¤„</p><h4 id="Aspect"><a href="#Aspect" class="headerlink" title="Aspect"></a>Aspect</h4><p>ç®€å•çš„æ ·ä¾‹,  å¯æ‹“å±•: å†™æˆæœ¬åœ°æ—¥å¿—æ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CustomerExceptionHandler customerExceptionHandler;<span class="comment">//å…¨å±€å¼‚å¸¸å¤„ç†ç±»</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(public * com.hang.controller.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pointCut</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;pointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">handleControllerMethod</span><span class="params">(ProceedingJoinPoint point)</span> &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">// å°è£…</span></span><br><span class="line">        Map&lt;String,Object&gt; records = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">beginTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// æ‰§è¡Œæ–¹æ³•</span></span><br><span class="line">            request = ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest();</span><br><span class="line">            result = point.proceed();</span><br><span class="line">            <span class="type">MethodSignature</span> <span class="variable">methodSignature</span> <span class="operator">=</span>(MethodSignature) point.getSignature();</span><br><span class="line">            String[] parameterNames = methodSignature.getParameterNames();</span><br><span class="line">            Object[] param =point.getArgs();</span><br><span class="line">            StringBuffer str=<span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">            <span class="keyword">if</span>(parameterNames!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;parameterNames.length;i++)&#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="literal">null</span> !=param[i])&#123;</span><br><span class="line">                        str.append(param[i].toString());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            records.put(<span class="string">&quot;request&quot;</span>,request.getRequestURL().toString());</span><br><span class="line">            records.put(<span class="string">&quot;method&quot;</span>,request.getMethod());</span><br><span class="line">            records.put(<span class="string">&quot;params&quot;</span>,str.toString());</span><br><span class="line">            records.put(<span class="string">&quot;time&quot;</span>,<span class="keyword">new</span> <span class="title class_">Date</span>().getTime());</span><br><span class="line">            records.put(<span class="string">&quot;result&quot;</span>,result.toString());</span><br><span class="line">            log.info(<span class="string">&quot;[æ¥å£ç›‘æ§æœåŠ¡]  : &quot;</span>+records);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;è¯·æ±‚: &quot;</span>+request.getRequestURI()+<span class="string">&quot; å¼‚å¸¸&quot;</span>,e);</span><br><span class="line">            <span class="keyword">return</span> customerExceptionHandler.handleOtherException(e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ‰§è¡Œæ—¶é•¿(æ¯«ç§’)</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">time</span> <span class="operator">=</span> System.currentTimeMillis() - beginTime;</span><br><span class="line">        log.info(<span class="string">&quot;use time :&quot;</span>+time);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Sentinelç»Ÿä¸€å¼‚å¸¸å¤„ç†"><a href="#Sentinelç»Ÿä¸€å¼‚å¸¸å¤„ç†" class="headerlink" title="Sentinelç»Ÿä¸€å¼‚å¸¸å¤„ç†"></a>Sentinelç»Ÿä¸€å¼‚å¸¸å¤„ç†</h3><p>è¦çŸ¥é“Sentinelçš„å¼‚å¸¸è¯¥æ€ä¹ˆå¤„ç†æˆ‘ä»¬é¦–å…ˆéœ€è¦çŸ¥é“ä»–çš„æ¶æ„å›¾,   </p><p>å¯¹äºSentinelæ¶æ„å›¾<a href="https://github.com/alibaba/Sentinel/wiki">How Sentinel works</a>  #How Sentinel works   å…³é”®å­—å¤„</p><p><img src="https://user-images.githubusercontent.com/9434884/69955207-1e5d3c00-1538-11ea-9ab2-297efff32809.png"></p><p>é€šè¿‡æ¶æ„å›¾æˆ‘ä»¬å¯ä»¥çŸ¥é“,  Sentinelçš„æ ¸å¿ƒå°±æ˜¯å°†ä¸åŒçš„Slot(æ’æ§½)æŒ‰ç…§é¡ºåºè¿æ¥åˆ°ä¸€èµ·,   è¿™ä¸ªæ¨¡å¼å«åš<wavy>,è´£ä»»é“¾æ¨¡å¼</wavy>,  ä»è€Œå°†ä¸åŒçš„åŠŸèƒ½(ä¾‹å¦‚: é™æµ,  é™çº§,  ç³»ç»Ÿä¿æŠ¤)  ç»„åˆåœ¨ä¸€èµ·</p><p>å¯¹äºSentinelçš„ç»Ÿä¸€å¼‚å¸¸å¤„ç†æˆ‘ä»¬éœ€è¦åˆ©ç”¨SpringMVCçš„å…¨å±€å¼‚å¸¸å¤„ç†æœºåˆ¶é›†ä¸­å¤„ç†å¼‚å¸¸</p><h4 id="ä¾èµ–â€“å¢å¼ºé€‚é…å™¨"><a href="#ä¾èµ–â€“å¢å¼ºé€‚é…å™¨" class="headerlink" title="ä¾èµ–â€“å¢å¼ºé€‚é…å™¨"></a>ä¾èµ–â€“å¢å¼ºé€‚é…å™¨</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--å°†sentinelçš„BlockException æŠ›å‡º åˆ°å¤–é¢ç»Ÿä¸€ç”±  MySentinelExceptionHandler(æˆ‘ä»¬çš„å¼‚å¸¸å¤„ç†)å¤„ç†  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-spring-webmvc-adapter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--å•ç‹¬å¯¹ ParamFlowExceptionå¤„ç† --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-parameter-flow-control<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="é…ç½®å®ç°"><a href="#é…ç½®å®ç°" class="headerlink" title="é…ç½®å®ç°"></a>é…ç½®å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¯¹Sentinelå¼‚å¸¸ BlockExceptionåŠå­ç±»(å„ç§æµæ§å¼‚å¸¸)  ç»Ÿä¸€è½¬æ¢å¤„ç†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MySentinelExceptionHandler</span> <span class="keyword">implements</span> <span class="title class_">BlockExceptionHandler</span> &#123;</span><br><span class="line">    <span class="comment">// è¯·æ±‚ä¸€è¿‡æ¥Sentinelå°±éœ€è¦å¯¹å…¶æ‹¦æˆªå¤„ç†, é€šè¿‡ä¾èµ–sentinel-spring-webmvc-adapterè½¬æ¢æˆä¸ºäº†SpringMVCçš„å¼‚å¸¸è¿›è¡Œå¤„ç†</span></span><br><span class="line"><span class="comment">// Tomcatå®¹å™¨æ³¨å…¥ Request,Response</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, BlockException ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (ex <span class="keyword">instanceof</span> FlowException) &#123;</span><br><span class="line">            msg = <span class="string">&quot;è®¿é—®é¢‘ç¹ï¼Œè¯·ç¨å€™å†è¯•&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ex <span class="keyword">instanceof</span> DegradeException) &#123;</span><br><span class="line">            msg = <span class="string">&quot;ç³»ç»Ÿé™çº§&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>( ex <span class="keyword">instanceof</span> ParamFlowException)&#123;</span><br><span class="line">            msg=<span class="string">&quot;çƒ­ç‚¹å‚æ•°å¼‚å¸¸:&quot;</span>+   ex.getMessage()+<span class="string">&quot;,&quot;</span>+((ParamFlowException) ex).getResourceName()+<span class="string">&quot;,&quot;</span>+ex.getRule() ;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//ParamFlowExceptionå¼‚å¸¸éœ€è¦é¢å¤–çš„ä¾èµ–åŒ…</span></span><br><span class="line"><span class="comment">//         &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">//            &lt;groupId&gt;com.alibaba.csp&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">//            &lt;artifactId&gt;sentinel-parameter-flow-control&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">//        &lt;/dependency&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        else if (ex instanceof ParamFlowException) &#123;</span></span><br><span class="line"><span class="comment">//            msg = &quot;çƒ­ç‚¹å‚æ•°é™æµ&quot;;</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (ex <span class="keyword">instanceof</span> SystemBlockException) &#123;</span><br><span class="line">            msg = <span class="string">&quot;ç³»ç»Ÿè§„åˆ™é™æµæˆ–é™çº§&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ex <span class="keyword">instanceof</span> AuthorityException) &#123;</span><br><span class="line">            msg = <span class="string">&quot;æˆæƒè§„åˆ™ä¸é€šè¿‡&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            msg = <span class="string">&quot;æœªçŸ¥é™æµé™çº§&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è¾“å‡ºæµ</span></span><br><span class="line">        response.setStatus(<span class="number">200</span>);</span><br><span class="line">        response.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">        response.setContentType(<span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">        <span class="comment">// è¿™é‡Œå¯ä»¥ç”¨ä½ è‡ªå·±çš„ç»“æœé›†</span></span><br><span class="line">        Map map=<span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        map.put(<span class="string">&quot;code&quot;</span>,<span class="number">0</span>);</span><br><span class="line">        map. put(<span class="string">&quot;msg&quot;</span>, msg);</span><br><span class="line"><span class="comment">// åˆ©ç”¨ObjectMapperå¯¹Mapè¿›è¡ŒJSONè½¬æ¢</span></span><br><span class="line">        ObjectMapper om=<span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        String json=om.writeValueAsString(   map );</span><br><span class="line">        <span class="comment">// åˆ©ç”¨Responseè¾“å‡º</span></span><br><span class="line">        PrintWriter writer=response.getWriter();</span><br><span class="line">        writer.write(   json  );</span><br><span class="line">        writer.flush();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶è®¾ç½®å¥½ä¹‹å,  æˆ‘ä»¬åœ¨Sentinel Dashboardå¯¹findByPageè¿›è¡Œæµæ§è®¾ç½®QPS:1 .</p><p>é€šè¿‡Jmiterè¿›è¡Œæµ‹è¯•(10QPS)</p><p><img src="https://s2.loli.net/2023/12/18/6sR8GcSJmQPFhix.png"></p><p>åªæœ‰ç¬¬ä¸€ä¸ªè®¿é—®æˆåŠŸ,  å…¶ä»–çš„å‡ä¸ºè¢«æµæ§,  è¯æ˜è¿™äº›å¼‚å¸¸å…¨éƒ¨åˆ°æˆ‘ä»¬è®¾ç½®çš„MySentinelExceptionHandleräº†,  å…¶ä»–çš„å¼‚å¸¸å¯ä»¥å»Dashboardè®¾ç½®å³å¯è§¦å‘(ä¾‹å¦‚æˆ‘ä»¬å»<strong>ç³»ç»Ÿè§„åˆ™</strong>è®¾ç½®<strong>å…¥å£QPS</strong>:1),  åˆ™ä¹Ÿä¼šè§¦å‘ç›¸å¯¹åº”çš„<strong>ç³»ç»Ÿå¼‚å¸¸</strong></p>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringCloud </tag>
            
            <tag> å¾®æœåŠ¡ </tag>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¼€å‘å°æ‰‹å†Œ</title>
      <link href="/2023/11/04/%E5%BC%80%E5%8F%91%E5%B0%8F%E6%89%8B%E5%86%8C/"/>
      <url>/2023/11/04/%E5%BC%80%E5%8F%91%E5%B0%8F%E6%89%8B%E5%86%8C/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="æŠ±æ­‰ï¼Œè¿™ä¸ªå¯†ç çœ‹ç€ä¸å¤ªå¯¹ï¼Œè¯·å†è¯•è¯•ã€‚" data-whm="æŠ±æ­‰ï¼Œè¿™ä¸ªæ–‡ç« ä¸èƒ½è¢«çº æ­£ï¼Œä¸è¿‡æ‚¨è¿˜æ˜¯èƒ½çœ‹çœ‹è§£å¯†åçš„å†…å®¹ã€‚">  <script id="hbeData" type="hbeData" data-hmacdigest="542828c4822c8f6e75434b492fd3841de9f6153b98fad9686f09a1c6a6a77ef3">f1e2971e5cb45bc6de875902725b7e5bf10030e767a0488fe18f5b28db137856fe9586cd0c4b03020b23903e4a3186ae6cb50d7d256c3a3ed767d7953f275ff5749b46dc37ead1ad7671f8a4c27dfac207f075b7c165ed6ed27e21be9ebe633fa5bcae06efb1b7b971af43b21fbcba9c4f303815bbc19706402af0b0c4f44fb8e1f6319a4514eb8f0acffd6f21beb83db44e629171127af9f41c1efb08ad6df5b08717e4154769f0387ca60ab21c5cd0bc6dbb3c7878a96516dcbafdbeaef9be0926d444a649ca23df257b8636680f48730d52c25ade4a6c479d48c907f367af8368e6b5025b900e40c09e361861e92933af83263031824a8b9d2d7b1bba1943b0379082fdc55ed11131e2a1f9ee79174a62b6fcbe7ee4caba1303f7df2e4908efc553e044da6e6594a60f44907f1fd457e51df7de4533dbb00d2367363e632ebd383d36e2df3ad1d1a511e2def34ab29832be76474e6de4a004c0bdb2ea833b55e92f74cdddb83aab1e4495f8446e5b24fa52ca3a796dcc4b73dd20ffe442696581e79f0c44a19482d0d7528c657884b26e64e253a475201bbaa54efef124a53336e5681abc3a766c0cd38340818708f61edf550bf6a85f3c7d65556304bbf912b1b6dc218fcf2170bc963eb91cdea2ac5f8d27d98c759d430fae4a7bad8a091b87d107d882aa06671e9569728344946b6c51e1be9b9d8a440404ff709744479374cacae6b786722586204fe3813abb03b2841f1a1386a065ad0ca31c46d6c1b732da3a8568143e3422068b86c2003c4449485118ef2ab9ae6e2c01a16c2152d7158800ee17ae656c565c8b4ae529169403377c44aaca7ec57210ac6f83492c8220be9e66f558658265917294631361e039dd2f36d2b3992911b5443fced27a24bb71aef76b1df4a9ddf991d59324e002b9be25e4ef0e4f691ac0094d413712b126df116d800c485dff445eb2f0f5ea24fce2482240a8e14466a40aab22248e40d9ce972829e37fde55b24725fc0b5f7e595d54365a0f5196d6f82b215adc05aea8ef5de185865daa9f3f563d0900a7f64ba34db858b5e0118b43baf2611fe4a2b70da67e74f2178e82a74ffa8d8ecacdf8a384f6e9235b002528ead20aca002bfd98e204815381bb6a7e5341a5e11f033e49b4ec040ac712c4342bf5a0485707396ed692bf65d2399b0d01d8365b4124273a42538b21daafe9ff3ad01fd779071c7a1e56a6323a1ddc8c1556cfc0672d93d54d4cfc1296be355ed951f86eecc4b877431a1fda911b2134964270a015b346917b58c4bfa5e2587213d489a1909c61cc0ba310674e306fe5e1020a8e040c86970056c0303812752776ee30ff633dcea5c7b34a2626ab13327f3d4319bb05a34553b067f733e96a8496d3aa60f147b6dfd736143013338d09551c35f788bfdf84446e419de04718f6e23579e9958efed795234e9e561063c8e836acec74ee0cc81635d48d7517c7bb8196ece54c827cf7a958a01d41e42749a8ffb0715a9dd63917e2d7d002935c737c9e4b26992276742f97d9d622e4f49d890209d6117feb26478df44264fa2741d87b8aed876c31bfea5ad31a68d89ed97e2cbf24e0a843e562fa76b42ff248db4fa8bbfce8c7fa2d04d77c93944acc2e9eb49f9e38ee6af54f3e70a2eb1895fca1095d0b579d9707acef5fc3233ce982b3562a8feaf22fb578f318bc6f749252321dfb18c860dea9638642b24170f4310a55b9fb710f570f3c589715030865aa19d56a29cf95c4ebc8737e817313fa689c1fb35b81ae23866c177329d15aa61c2ca65ae2e4e8c60dc73ded2438e4143a3296e4359f6804bc361a5ea2463fb323054dceae3b26ba9ba0e54304ea2ddb3e566aa1aebdd1991211e79d9b4dac19ad387dd1b910eab3b4ce2ee78fcc93e14af568e844fc53fc588678547fc4e1f5e1271a868fb5c905cc5eb272687809a9e6bd21d749accef413bc4a69e1a71fc70922b719ae5c887fbc0814eec00314b5c89cd4b301db285bb46637645d6d611ed53c5d2ef18a6d2f5cc2f0098d077f691756bed12e083c30e289df94427f34210d8bcf89203f72e18ae353ce2c8d8669341315fe517c56d247d94dd9960b8b400f0ee704e480d2cd81d1303fbe1456c025ad80fee50aa41391a751c110767a989d57b2ce96040592939ebbb495fc79f98eff6231d4081d5fbcd6f1702fa60c9f01da4e96cd4bc920251c0aa15239e68210d94a4b05032ce0fe8ea1518aead496c5a73a2f102d0bf5af35af2b35625cceab976f132093c6f95e5186b90aea6a927266bac151cd19ee15e06099182f7519c9a5a53e8f13dfc00bf868667cf7ef9f23238e1fc9ebfca11099c0421ab4df8098ae946556b86e71cca9ea932a6f5080e11027926a17cc00a9553c3295935255625105429a027cc847a938676e570aa163c1f511037f8aaa5ced551b384a56a7a6b734791af7834acf4cfae6ff5d2493cdb306cc7c63a1af31c1d2b4c9721c2778d09a5f30462b38a252fd911177c3252cee01c4ecbfff3160ae92629cde660183f571850f8e8bcfda63f8881ab0c00c23afd9aac726e0c78bc128d36693d126b1ff79a3b0bca6322e9740b763867a54657ae518b9bfaebfa6c42777dd1691c56a75f9f7836e137dbd15ec17978b0c63c533f049b842068bdda24482b90a76e6c1a3685b74c7dae92fd300bafe85ea08ccc7b459538cc4cb3bbd5c5a9e8f0293364bf1bb54069ca3107c1e28c1b73f83486eaceef975a2bf43899164f984154da8f737cc9995607c134ecee1a57b522297542f7057d376f7650b22cb80ca5565dae579e1c0a30f56350524549957a38fa1488dbdd987f7f47bf0fe905fe8c95f0355aa6718c777a1f68f916f779398ed7971cb6b03bfb49124b85050446437c81607da1df43253bbfb18511855ba24daced88a6a909b89de769ecc15e40851a0c440da42e585825b40e60ffc7155b2ac4f9ca55c58fd30b15f5ccd4f65b321fdfe08fc7f8b7ed25e4e7acc800b1552529bdd02668c9d696ec3e69351399070e04bc631eabc1cbf584f28b630230af13d4abf2eaf9f745adc8af0f5c59456a0cc00bee86ba52c18ad03b0b81c7cdb214901eda527dc9dff15953c0b191ef8d22d25b810734a46c0a8f06b137335ba5811aafff5940624f0f1fa6197d385ece6a5104be34495aee92d8f32bde872670e550b37d3339386d91cce8acc34c5845f70de70813932832388c9f08a94ce43f9f3693daff3e024811a2c74e81a0c57fcd6ce410904af14bc506661be921c1ccee35bb40bb6b74bbdcc6c8ac8d8fc40a1f179274712f7fc9463bbbab74e3f680b0a35a5ae0fc405efbb0e8e650bb2dd7a055d7e734531dfd099c1805e9947411f3a4d888a82902fdbf91ae896808fe0f2f9e79a6a3aad813ff88e79ddc4fff68244d1835043867290447fcb4ed165b43249257e1c7469682a29b94bfc3f69bbd2aae99a2a499e207a2da68d8512eb7901e634b4a9123b03eadc85c80af51078e75713ac52aaec436c9986e434eb47c3ef48c23c1acd433e802ee7cc3ffdba8d31d2ed3c86b9cfe5014442dc3bb010258697595a066353cb08d7255fcc091fc242e29ab1cf2bc6d9132dd9d3760f3189d5a5eaf064b298d125f8a2d98b54a20597ffe695998959ae03c421a0c1d1be7aaa6acc52b413a03a66618ef007ee1eb0594531be77b175cbe9b320ce3e68d7d8565debc5df650d1683cf6176306fd1ae89b548870027375036ef8e9bbc9a5320a034b419d48ce9cd92d6bd7708eef246d6c40a793744cafd73150eb3bbda5b03ace4f8fe68b87cfd5d25f0860545609568391f1cab8f3721b5fe3b950009339486955d11dd5466269af07f5fb05414380401071238a001cee1920da81c618d1e169c73ee2f3e222b1db8c986ab997fae9a38a196aa73cac2bdd2bc146d357dac6cfd92b0633b8811e74f1cde87097f88d3b4ad20cf1bae8c652fa672475c1d1c00181664ba0cb26945e58a4b0c5ad33d51e86f7d6bed7e03e7e927b78219d4109716752de5be493c015d6e1751c4f9405e6149145dee48847131c59291e3346183fda764aacff134a7a511b39ebf4f7701461f05d28c53159dfd1236792bf52cfa3313be8ebf519e5627b7a7ec672c14c81f25085e2af1ab785beae52edf8dd572e29d441c4ec35737441e60f4ca86d03a42a523095a204e3a25acdf2f9f4a8134ae04510d0c74b521949f0254bb616de6869c03c7d712f8faa00e96a6a704533db6c6c1011704a419006fb57704348a3accd21b4f73baecfa71fdbea1cffe8072903f272984172dc53dc25be912fc7beb3814e80364ac0cc64a9823c9b37c49fc977ab43da02493bf938cd11ae4f6363d21e6909509ad709daa4711628585f4057e86012b3be60a98831a9d64ec369637b772dd7eb2589779f2e1e44a1ca12a6e4c2cd3882b852e8db0eeb5ce3ad8879434ca26069dfe4d914f4c75bb2f8a49679332d27bca9215ea3c9c10b99f432c5655a8c389402bdc708f6b408924d61a26eea214f17495f81fa14903ba067c15e7717bc1ad0f44cb232cd002b3594d92c9758f7e3bace16c184de191e3ada0487819510fac95404142d8e627ac5044d40622a5aadacd69015e0c61b0b33694c92961e24ea238647071cbe5ead8bfe165023fb8135ab7271445279449d7e78ae9c863e464fc5085529d9431dd93cd6325efa921ab8a2aab7c26630d72b89d53b4c494657f3ccd91925fbcb7cf55d42b6383a777ae6a0e8899cd7d38424e1162ae4a0f7e26fdb24095bafdbc8ae4a5f26bdbd664eb3bc4aea65ca0565455fbdc0f7ca0e11c33d24e62f3cec57715cdb9c6068ba81e6e3f33edf36ada570f912286f78ca892a545492fca85dff07b165aa9b629ef6b66f0b488d0deeb8ca134747a3076072a1aec03af060ee24f967850e5d92781fec7406285d5ab92a5ee3210a31be021100b1399527e4366a24ff472b48ce2aa2e809db352f80419a886175c2fe7b61e53ad979f7987585331cc6262adcb70bfd975bb85668b8afb0ddd7cbd9ff0b1d1a49262fec14460c31a023d2e88ef63585993a4bc3e40d378b3b421ff0cfb6e863e8f59ab5aceb585c4a7ce9fabb2664856d27cbf09de3aaca53567c688f3a4c1122527d927ea8933a5345ba0ec1afbd24582514888d89b9d3905b2c72b7bb253ecc81eadef470f4c7f6793bb5e3a22925bacbfd196561c23c9b8895bdd0fe7b2740beea39ff31c2c269e30a54d1b1c49777d53a199e940eaa46d27a2bd9b5bfed0472222713b58a9011da998a36d74fd092c1b483d94aaccc862ca895ce0649110fc57f50f55f9420b9074d8e8a51a44f1717aa48d0f26122a1926acbbeb3ddc243761674013651b9df14947e92bd22bcc2c1b89f3bbfe7fe6179555fd1a61fccf1565bf2e792dfce3ba340ae3b7d3b7da0ac779a8f361a9174df397b68822066bd8d0f8a53a7c9fa2320f1eea1ceec01f57b9edd5d00c6c0802eea55cc397f0a20e9f1243256fd4dc4a3738625dbd8b1cbfc6c9b1071af81a05d98d2caa45e29ed421d70d0118f567f84a70297f38c46cb0ab3376d8fa9ed0609f9433ee2a91e26395c28531e242923a0a718901e24e9f1ec215172d4dcc71b99179c0779a94eeeb4e0b9a7782fe3b5f02c408303f08af168bbe8eca2755b20f9825e9b22f8618c26129e28552934ef06872a970c9e389678830f7f764243aeffcd6445cabcaadbd351b54d1c0871f1742d112a5689112bdf4b8f47885b341e9a751dbb259c7ddb8fc719a4ed1ad7dd71c005272e2de30e466a44b42b16b8310cce1c50fe53ef77547246157a9c22244c93130e5f1789171a16e19267398ae1177ce5e325145090bd8ea61119b730fdb2eba7c117ef4be712fc3425b5a3be574a726d01930259fce3945685161f5bc86adb5ebcacfae4178ca6070d30a57a5657e0acc82b012ae2b4b019c4d205b67159c9b20732a6fd4607b117005a8a7c3e759b536bfda4cd2dd07636915dc33db2994a77abe33778e63beb4ce8bc3bcf54f23034c620b03d64c756b0d60a497b22d9bc5b2a9bcbae7ccf68398823bb7c5b9ac441a9731b81085d38fa23b4a41e9749b5653f9b93feaef62f81c1834f6215a50fd10985a36ce6ad134f7444027a86e7e36d05e12e1b9a9c3ec00ea6d0d11b4f65a8e85674b59da12626bf3d71a86f77eaca177d97412ea8e0ed238ae4e0b81badf9c76b624728009ebd21f7c8fec35b4db0652fb3d96f4af779719f49334a8e633e86ee8487e60a05df0a2d165af4b23af146ff20bf9d12a1bea5245ab23f38747378dc296c69164c3b614bac6bf68b4940335c183fd62608279b335d0eaf5eb001d2e588142cccc4a52058515638bb5b3f346fe8595c25e49ea41569db9604ecdd7958ef9928728c412a270c50df818832c9228835b0a44de850e16366dc4cef68762e0eec1129375c780a17585ecf48d99eeb7c04ae052334d767398a5c8ebf5c5156f2bd55d68ed6ee8138dd741bae8abed817e0902ef40002e093bae25ed8fb2bc4276fa239a0309426d6e23274787c1327af88b2db5606a5b99cfef7866dc4a90e0289618eaaba4d61541304972d830eb62c11f7bf79ff1f5f624f2f5ae09556a4cb98638d5055a67c373397671ab51a86ff418a956ea175de1a15edce40281324ee9e8008116687018f28825fde16367e4d0a4ceb2e8903017d73840cf6bf709c7049fc2ec54349f32554c695304486082bddf26574c0ba400c364d79067010c08cf23a6be65991f61a3275e19093518bee0c170e07c3189cde5da0f27dec23614fb34720e0f7ec0aed01334c2e42f26f0e4ba786486bd12c4e28eec9be9c2426ac176eea915f8253108fbf69b04a8f00b1fc662cc39d1464328aae3fc56957f1fb77f934dba9d3ae35e56e5f3db0e4a75c095a06815f95c7b7ed4a17277d0aaa8d8278dcaa0e3d44d2d0719a3a95f1150f175ebc98369da6646271fb3bac014ebcf2880ac4ba3e1aefc1f2be8ad085aecccfcf7fe3473e1013096b1f3aab491cfc45448df76741815dc44ced9c2e10ba707357fb6eb6803ec0308fd1f5b7fb14e948b1d5af26c6df60eaa7367f20a0cdc0bc5da58a34192ca5815825fdf21b7621dca8b79f4c8cfd03dec60b8242ba8ff4b176237e329b96aafb9b40675fa555f594ab9a8961fd32fd925d1530d43c8e0c0a09526a12cc3f36d45adfb9d5b42e0db53a95fd60859c7ff22d9aa25f194eb975f362188c44c5d456b86d92ab13e26d3dab43ba84b72405a69db2f337b434874a0d72932883c73b6a9bcaa8b4c46417279cd81f7d1695b81872ee7afd4c197becfafb0d8f0a2828db90ac343721d37956e599d6d9004de4d0fc45c09de3ad7b328463fbfbac297d36387d8da74f7b79710f4d7095415a686cdd4555e93309221ef9a47de155e78be390f61bf6e98748756781c805b426b356fab8f3f919fd20cbf4941caa9f07000bcbac05db4cf079f7dc17bee8696edc06d7dcfd2e1f4b544359544635108a18986eb6b1f22aba76e516839aa87e4741604c22b1a143089535ba71c7043da96109192ea4583e309b68dbfd8b92cd4300140693522dcfd4238976f0e003463aeccd2c84bfcb86dc255246dad0ff633a0de6c6c0b82df9e9e2849a8ffe7d44271213bc3d9c909c1415355c1d02edd381565e3b683e95a120102a9c8b17caf4134401384abcd6687e83f7c19e6cb2b701253f0ffa9b1b730e84dcef9a2c87acb4a5db7cfcf2bb0b949aaed5da95c2457a93b4bc4f06d12019fa1bd74e0ece822d170299a914178ef5f75bd12f6bc1dd2468ab45647db4c8a7b3d74b7dc09d25a25417af9b6f60a8cb30c5b73e8b75f80d45413d223c70787e38345f3c2aaeb9e48ea18e6940a264596531a042553a0029964be8eb7df428c02565dd5ba311704205ad69702ef365d95797b2e57c52556e04732445920a1d548bf2a6e0c153a544c2e8253ed9d2e2cb224ecede851fa53c4b7fecccd260439087131e8fd6f8e0d5f08540e032b76d1a5db06bac9d4e14d3c36e0674825dce1767c23c01d631264c29b11299f15ebfc17f4f93b3957c328814ed7dc0e9dd1e594be5a0a71388371e93004750dadd51b2f037ea9da3534269c67b79dbcff4638d4adbb8c652885f99f3db534fce9d2809f9e2eaacdf510e6d90cbafc212e167728898cedb5b57b9d5c35bc8c6aceb843eda48644ed6223d3251776fe0df7d9256f019c2e0b3b584964e7c0f7ece089d4223e26739fe738188c41b46ce3643299eef93bb6f8e4d80aa3e52ab27c7d06c07f8b1ca5e294cb863a404befe09894c4a622467b47c3833047ee6f04f7fc351c01de5aef07fc3a9a9deaac4ab66fa45e008c144727b2c74fb1e22f5c3c3fa73746402611738d4b62f5b4c896f727ec5189ff112024be5c399d0747f476e0e5e073d29c3d42bb54ddf886dcfbb25e02cf9f2195e00ebbcc8e0c5b16b3130e1149ef7f176b00da47ab4a5b3cd7fc6feee682a6ba3a1e07c5793aab0a79b328d48fdc98d689a8cced00c1247dc4e66cfbb6fad5dea02de724fb6bc899550bb452384a6a606b29562d572a60060d9f135febed9ec22bc58ded71f84c5247c703fa728e26516009bc67069c3f4c0fa19ebd735f004ab03b07e8a14136b60c2dde9885dc56c16f909cd88b4ec986ea0625c62755cd82c59e5aa9fb5f3bf6994de2f6655ea7befddfd9c0ee09e3e490cbf064b947a1137859b76401b9d9ead4f58179912bf9e1d075a374730c485f7c8e314f7d458d81a4740c53242e2ac4c02053be54a8509d6c65bd593f6d53b17947021712b7911bb79ca4d1ac86dfee895f27ad9031982d565a72b1fd53ee3e8e2dbc06f216c14001d9fc0fec833394fbf328d53b060e71c593a8b0d491a5dcbb35613a7abc2052dc36bef97ee59b6bf7e1c8784baf0833587640dc90223c7700048c0f5e4e084aca83c629295e966f1256dd26177da62c04ead774a1d2b3e75bac0882fc09587bebc9a82ff50ff2a87766c768c3b9b384bcade4535961fadb3916267334aa22afc27fff52e7946aa293f39aa02994c27854626522f28e7b97459904e3d8570e23a7df99bc13d3ab66467315df2c25e5b7676d0a270b8f4a5b6279dfae7fe57492b956b37a066d5e9c6169bb75a8e8dbb00dfc44fdc564bd634380646e50acac5cb9d2ace76f73e4e5d23b295526a4f93f4c2bcef5dabd9c64f0f357a4765548004652ff9f549d88497037d8891bc43211b4b0ff772963c26fb6a53ff06bf744f457aef1156db478ce771bab38a43a2036eeb9bc882bc2141d3df447786ed0e7e1d8281c5f067132d10dd68eb7e4d141652ff1be765831fa4a219a477dc4941c780d768e44955491e7a0ff0eb289d0622d106b869129cccaed452ac3465fe960493f8f580ab9adfb2cd3712fe2cda5655f9ad4233f103b0e9eaba6e85b688e3d679295e79f8f0379c6073bd69465f881d492a0ebc01b5e14d689710c8f816388868d53e56b22d8ac1d30c7069bd600bb6884f71efc6af0859bafe9494cb95b781ee05d3bcf672033e2377c2244f5f5254033484e3d9b5691d80c71a5ff8c4004407fab125b3a6f0a57a54827b7ba4c7b9e803df34db0be9eef51a696fe3a355d7902a44741830b46eb282ff8f36735c0d926eb8b8c456f15c4aa3b4efd5c9b1d4b335f3887ef3f228bb622d49b9837fe102aaea34d54ee448d5d1d701c1f1b05370581e2db6cf8b056c24b598af959443a9acf18d9d73e2906c63033e21ea94f7b784515675d13eb0341856e7f6596ae236b4c144ee4f3d42bbb19d230010022e57a01b593e73e5adb91a10b687e59dfff840e3a075f554b248acb68de24a46f2e3190f8b3cb7e14d928ed7a7b7ba5b81d54700c53cd918a2cf5aed7ab0450d17f7affa44a449174cf300c0b9a05004b20803747d49654998533123817f3992a6e5bfa2d01f4120df48fdda6414904b23b0a590f6e6bc5015bf6e3bd0319bef73b55b171699c7947f8b6e8212d17ad2e6fef4dcd546162c495d8303836185d87b0eaa4a332a748587299bf3374fa8cf7bab72efa72a651cb2e3aeabbab72dd8b8f3c8c094ee1598918f16379a56cabb302498d06aced50d201dd3075165edc021db3e1e924fa2711e8d69f44f9abc879fe1aae372be7bef7782143f39fb6a787b44d0416dd79711eb9bbe65e612c9b368b03b09333492a20b9928126e43cfbfed4693e0426963c7776af1234c771f1e87abc7d32e6e0e2df2265e4c3586c8a0879363376dd59837324cc957283a3c35be6063d167b9f223e2874ea3c091e7a4dd627f9b523d37464276a6293f8a1701bc19f72a9c9bbe298a5697cca3dbc51455b259ba36f9e1b31769b528d716c4e504ce6fb450ad166e53de88e538dc1ef0dc24a1d41c7b0d659b05c0401ee0d3c250cf1e26240efd87fbdf01b48e2191c2b5ee60c5a3c4bebc93d3b63a36b68faa5e4d882e65dc7fd89eb7b3795d678f652c56cf2a021d1079d152c18de9c90c76abca7f32578c77fc07c8b74361b8696df9ea2a91815406a32c25cc6048b7ff230a2f8d466da7f46b0b8d96c12aac0c22f04f47d45788e25281ed549bd318ec3ca0113e42b0451291ae4e66212c68396f7e10df84a14f8e1f52ec05c73dce7ca859bb7d31a11d0468f26cdd4c7f1dcf995706105457d3f35bd1a28a689f08b2f60cd3a852b6459aa144b7ee376a4412973df7ed1560f6d313e31ae33de2a298658890656ca10bcc4761f14b6544abcd3d8730190803d67032828ca8febfe2df198ca18d993395c6bd8e26411f89e651e51ea9f027514a330a10b31ce7fbe322eb913c8739d15f2e692c885b0912c4ddb48eb734ab83722edb288ec4836e2266af96463373837d223684a9037c77fe45a9dc53010a952b8b05045e73600c0dbfd5ebf0cc091bcf3bfabf183b8b3ddbb1c5330fcb464cb6cfe1247ce371828709698271b6bd98a78b9a9f5727eea76ab5ebd467e0d6250b109750d983388d76356d0ee2ea73d309096a763c64c46f54315c7780baedc5b56ffd55b2c7980a1072b4b61d97e46748503ccea5e7f926f34c7215bc044559dda0498e0a04a6339c418806bf38d43e49b33e0fcc744725f0190253915e9d397f58021517bfa8049fa3d9e89d4a055c12ec5f8238caa07602bbad7bc2a25e938b54d1de67ee7ec131b5e3e21d71d310961ab8fa3e51593af67c6d1721c08b0246f047023a6d3a138421a6478da87c4ad5b6cf96e6764194fe8b0f34a5c1da688db5814c98a1c1ae7cf8e5f8dfcda751b9886ea977808c458b21dc3c763bce7442b649225c1e22d20a58dd7b79104663a9d94afff71f3f957624b577a11486bf047d6872e96e3b1e2230c7c610331fc201132c4868564d86e42c07c407b412ec2481ff548d6854d3c5439f28672f903f87e6583c71f17d0f465c78a5e563755f36f18769f37ee71c67a05d0255d4c4d92dbd66d5363f0696a24735fa28d8eff90d5b328cb889d3b7ace8001905e7fff2677015be37df9f263b68f3519ce4f3350507b150f3666e4feeaaf92b96ad950990ac03cbc863237b94e837f49bdbc1133b9aef486a2a66a8a4f24406c6cdf96367e1b7d1b1bb4148166f68c08c669e02509c89027a52774b131bd76b0b65bcedd128e98a097ec2766f052631c033d97663b9c0971b3a6ab2a98258cd9a75c51a8a0d5725bfb56847a2c5ababf2b493d99525386e8da871f4ffc1ea205f52ef1908956427ceb1bc23986f8c1e586388a05b5c1d4ab26e5f631f3accce0a8e5f30f3827a5c52fd02651cfdfdd6527214201b03a78aa214c15894d44edf2a1edc26e870897c9ea82c0891851af025633c410b61b62a544a417e127af627a54f79009b36868704ff251794b0f1c755dac3be29ccd2b1aeb13c48ee158eaa5702fad89f43639efff206cb94592884bd632bf6c7673863e84bdae687a87e444618e1e084c3cf290f737d4576730121527baad39d1ebbe77e8047f92700f3f91a9d24c1ac9124a045828d1dc0ae34e4244e51151f3f6317d36cd13288db5eaaf894e27363fe3a8a87c5bc1e0698fa29411f5abe80b5e677944f937c1b8a3c59d1ac82c2ccbda3dec9d193d268b8a4ecfb677c261ab99951595fb9c0765119d63b87c3d19ea9ae5d31abac5a82d93b2ed3ee317fcdd7696e0f93608a6aaf493c8cb04800a6795bf17e2880fd74c5d6cba62d1ea2e370e06c735fd48f040d2c1af4b735b571afba0c8bc4d9193b76af9a136f0dcf8fba7bbada396ad17c3ec354d3d13123d85bb82fdfa20e693f7ff343ea743ac6ad77eb075a65839bc7c3788db16ebdaaee6cfd81881eeef250187548050c301e33a4ee5d92c6ea2f7179e8e4dd3df5cb048b47e64463b5ee642c9405e07eadfda22dd1def8093375f762d06946bf8c440763ddff88df3db854eae958a4f711f5d7f79d788ac31c184b69e38648c9ef908dbe1846922e7b4195364f1d382df78d5623d24daf3656323b3acf05112bd536695b59f7070f68f825b28277ea6140eea3793ade8681a1a385a91b4cf9e304975fccba4a456c97748acbdc3006352fa6981cb5845f8933debead411aed754f757601cf35fe2f43ac825c39c068aea52bc73f2eede91a81d0a4e6ae24ec4dce8ae420f2004159d3567ebd9182a340b79aa55bac6e693c824203b8836b0f240582f760fc738436129f6809a6605d7931ebf0501d759607ab302a55756ae9f597e947a60ecbb65c92244108d1b211ccaf058447368c80f0e5deb6a9adae73430f175c924938ed4a5e975a097b25145fc62e4a33f0684fcbb8b3251d45ee854df741b27886882469c7032b667e4e8865ba00a92623e02be816440d998d67e7663596342920af2f6b8faace11a15dd0ac1b1610af616733f6ad708991a379756529ecafed3052ccb48bffa19f7397a18394910078ef95f1f166484aefcda0e619daa19dbeb1b0f91af056ecb314e86b3f4322239e11a5ec6ed87d05857a1ce80b73f495c4e251177f60a6b1041b392f37dcd974134c588240c7f4562935c4acac757055fbbe72838df7c264e66a22fb9dd55c9706aed0c59b544ff62e489d66966438791a1018aa2c82d9010117666c8854f37398bf3a41fbb9491805efffc91e46d453dd8d036aba232e2938f6384c6d4f2cdc5eb7e2013642bd283387caef8a9aa63e69f12a3e6757b8d1879d2f6122711a1b37b542ea613b986f07becfd05715eee875e599732f07dbe5deec66d2921e662786fa18c5cd5272e54cf8a8caf9e33cfb04d59cdc605affa3915308ef9c2a28c934ea09105c54a144d6e10840260809e2223e4b0d8d48c43c5217700f5e982febcfd8bd006cf829173ff0981c22106ec4f53901aef949c8dff8161acaa112c9d64aa0edf97a53bcf763ea62236358d608be7d7fc89fac930873d7f09fcca08aca5ede816d3efb4cabf726b05e8dc372b07db588402a0d544aee07fdcf9f859cdfdfb5d4a0218aa1cb51c57e3aeb1e844a6d771bccebcbf5ff73c4dda030207e43a211d89a6ebae2500f06df310a3425c6278119fd89201947af2c30e8dd220f17ab3750422e0ef8802557aead4c18f797294e728da618a1c5ae0c2704dea0bb79dbde3214275b8d0bda92728708b32478925d6225a8581acc135efb0b6cf6544d0fe288ee7b7a90640da60324d76de3af505a99de7895cd5eadecec6750ff5af3e69e2a64b87da2320b6d98c4b4a017985958f81d44cad63f0efa518e802999c63400f78fab792bcd880ece705bd76282786e98ca2b23babc7e6c493e0f1216ac4f545d1296f6a838492fd9538d979308b261204fe2b4b7d47ca6bff8f9d113435a3f5ea9e4f455c71d6fa1c56d5b2626eb076395864b840a51806d0ade8c911079132430bdcd68bcc27d9ff974fb6886be41390da123fb095619910890338d61479ae0322992b67eb2d669ba13d144a6a4291b8cb4086b63f5f2028ac8aea2381261703266373cbb1898b192a9149af91901df77d76864a8dfbc9f1bf07831438adf6536ba4001e459a90a74d1aa454e65243f42a0fc2df5a152ff21cd15fff6742393719b548170520aae0fa8b037b5db536065f749baccb57f653833b6bb54b9604cdc62e2a65a046b75db8dc1b955ae0544a9627f157395df7ebe132a95bdfaee8895be22b8bf6316dd6319c9b75137d1f09b6963c7bb54dfe65120138278572c6472091547cf74341d6cdaaf27b993aef0f91e60e0a04ced295a6ebe10cfadb98667286f09bb336294f8e74167ca6eae8e75c4c4756480c78e125e9a0571ff6e3f1cf935c96c06756e36ef2e7d635e01bde60b91bd2af99508be1bc6598c562436e6e2dd5344bc3d466764e71940b5a56d24ed5f02de3fef1c1f621fd43cc99b816016a4b525a822da3e552231a61072b9c2b1c75a3eafcd47731205f36552990879edf62903adf86b1f1a881c20c678fe47d1ac61e9842e978b24f618eb91b7adae01d8d73bb205fc0e8efc042ac41eef6a7803f523994ef154aecaad4ebf8b5bfcaf3fc824841b6ec81c4dd2a63424a0726e72b3584e73e80cc9ddc1db310fa3ac11e67a1506da5ee666bbfca32fb6df022e6c89f18a1963b3e7755900bf16ba3f1806e203c92741541bda2226e41b8c13fb68afd7791ca27e85799ecffd83c4c6fa9851392553cf5c7b061e9828d93d9385c595e62840e1b3b28faa149389f51a363c3ade22396dba92f35b991be1b13baddce0ec618d402c355f1e9ecc540590437c0c870c78902c11114d11db863cd7c97fd41b8d5bb40af151750733e0377bbf271f15487dc370521cfc8ee9cd26f660c861876556e8c1335e5f60b68514b9298a0f32a2e7c95d638f83bc5c04deb1b42f01ee291b3a81d1ac82fa910f76fe764e71cd01dc0937c3e6667b78bef2c90319e358cf8cf047d6be2c771198cc4dad64035bd538c3fa3623b35758e23bccab0c68ddd9c173bbc2ea7c9685cada8a5e281822f14a4363c43142741ed38006cae53463eb30ee2f8b82f1f90261d2dc15f66436a38b1e4a36208d61bfee0e4e167f11455e741a73f0c0f9d99c4e5d3d0c1930fc2bc7136d1a3b85e063e121ac52ee7dcb114f9f17155245e154d354370ecc177a3fa16ee8fbe074518a49a4815f60b41b660f43c463872eb056c5d1bf513acebc3d0e69a290fe8ca62794ab2c7fb295912eb16a1adc39cdd93c281f7ef59c2881b0feff73e68c93a60f2eec4800dc6a7746c43b277bb2f1310ed06533369a5a2b380b45a60be9988bf0dde6949ccd1964991574584eecb92dd60f874a3adb519dfcf0aa48b85257364eedbb9a0d22196b7cd3333be86b43fa2bed9b8b2f87c54ac123cf501f652fa0b08495c4e2b3e33c78bc104b9e6f913c73d3ef30aca5124a69e31c94bcef69693f6e329519db865f7054b6299471778f2f8665c13298701b58dd84a77e0ee1cffae891c876d1db6fda95a234915bd8aaf65e98c929d94fa21bd34275253a8a0edda7e86dbc63dbe0bcf6398d6049b9dd918b48707e430e0758af25e0ad7471300e3904b261bbeb18ac1ac159b7cec5e8c4295b365bea0f36b0acdbd483438a87ca5a7ed953d24753e580fa31ea2555ed335fd6a7e8c34e4be3173ce93d720111e885d4fb50471ff9ffde8e770e91d8802dba66f99a1a10e8dc7e16462872adafbf41f3b235226313a099388f20bce1e4f42d1867fd91f69fa83876bab80de61fe23b5725e6866a1d373192ed672e62b1630202bd51c458583f8e3100472e646d4e55c3add7127a625217b18633480592e123f8cad63469e4d3826ed1c97c761d8219830ce5681d59f41197605d045105b725ad8caf60b1b3702dc3449b2aafa4b00c1fe0d2c246f54b552705d7346e9634573be8827aaf7320af8788711c79375461b5b2f7305d830af61919fbd66792da04b846d2bcd9ff69ca3a28f4ead66fe0c21a86218a3eb06321d278d438ad64bc8456869b946d2b48079b7e56872f7b54e2786af300e7e221b4fa41ac909e531c559b3a69e198ec6866403953783d00374e5efb708e3f54810654dc9736cea8e6528d392c096fd98fbb21d07fc109719a1a4fe247ff4d31443fd96e41b5725eeab49fc4fc22180779a31172298bd90e4250d0a6b793c9796c1fa32de02e6da1e7e1d56af4e7b482feb382fb328ea0217176532f3848fb34f7c32a3c046bce0724c81055e8289b78194df512ea29c07b1655b92eaf6db766301ade9c6e602e2a9d4a0bd308c5274ac71cac3492e38294adbba682bc0199cc5a96aaa2f10c959d44af973f91b18441b986a799274816c7609100bbd6826d8336ff10f1d4f2b2276c105b8a3c001ee2ce947e641a875ca4ec0f02ccb7b15dc40c45964a783fc8f23afee881ddde424f1e449f2c65cff14d03e43f88ed94b9fcaf161bf49591b5adca54665440b05f7ef0e9ab25a313aab9024acd39e948d5ece267832c36c8575fd2442dbdd2b794ee2d1538a86a98e004ccba7e65514c488d423a9bce17855f6c83e44d4bde44371849394d9b9efa99a67f80c80d0ba8b1482338aec8b5b87616fc91e203e0e72151c2c51c7469db52087860a4dce04d1c3084d575320df680e8d9914756669100085baead889c8ac0d2f549ff6b0a26408fd28995f75a9634b89842c07842e25d04f1729ed1b2026c00fa0b841404232b8d8e7b25720f39e554a88dfd7032a2b5756b2de38ea7762de78ed5f35ab3820a7e278ca37e51a32405ba9acda118c40b3561f52b8948878c930d28de8692c47bab9f17fb6be8881963801a11732d31d44bf64fb80ab4ac5a811674b9c4feb66da62c94d82074157428a6e7e619852caac8d16795ab43a55ea28ff940ca803ea575e90a2f0f95e828f96102e415a703f3623dd734b69f4c0be8eed3de8dc5c48d7974bacec2d8515d9ee8a921723057970d6e89b1fe84ac9a1018996af4b302222a752deb62a4e4101fffb4a247875025565c75b22e8a41626bb9b3792ed2ad0258906948146dd134d9444a8b791beed9143115fc1aed95c69e598fe7552c34907909e6133402e68ddf4e8b0f50dc2e8c3837889c55eed8f873d63e84cfebd4dbbe02337b0a01c9794f5cf6e2a156589cd27d81639e9c04a1ae261a41e9b3b6895bd4ed9f32e9860884b333fa8c1d27b043563b5179c602e755a9490f452ae3cd465b6094526202c9e21723d4a45674982ec2eab0fef74af0e7bc87d234282d9ed366fb884c8947b3695fcaae7d23233d18fbdfadbdf27247aaaf99aae0e8010fe2b55f98e5cf0393393b934c418599d6361ad218a47b833bfd69d9df08d14d9c5146fc72850cf38e36bea5e05e6fc8a42b6e25f7c17343f76d2bfebbb182f77a873e8a4c3b7bbd46b041366df73e64b55ee9c6d77dfa12943584f4ecd4b81d50a209052a603097a913a33755c7a7a3b1f1895f6e3290908e3664e95454d3dddba757c5c8941172bcadc5f1dd3643c4d1880d6cf60542f0da1263a09d7bb162fa868f7d3f4f4db92980b1ca96ac4e4a517e41712a148b07a4f36a1acaebca93a281c61c704bc4e6e2577d97d57f24d27c8729389b855e1156b5d7d39e82f11f45861813bd21fff4c78eb17c3b2b3e11c7a0aa95f663974ab80906e16e8776d6ef064f2c74a713c90c609aac2caa31dc89039d887257e2754251aba2021f61e239006edb7355ec78c0b7c63a46e4df4cc3f1c28a3d1f620f9042432a91faf05283fe94a9d79afb15a37c21074cfa8baeca5570f135a2bf259839174ba157e828d5de336a181847efc4d453a2b2aa9fcfff2c8bebb9fd2bdb6837b2e20c0e0a8d4901a29c5e960f0c9a79ff022bad14fd9e9c4bfb58096a65b88666fe50ad1c396c48ce24d28041919596d527128a563e7a009b64867372694a583db778d9ac30e6125f27d7fdf2254b88e7c73591d756809496a36168695c7c451ebb99a62b4909b4397b8e46299216ca97952856313ed8e2f2502edfb8dd8ceed7255a93ca154531cfc90991c109569cbb9645b552be5dee374e959598e189e0c1a599211199fab386737e879aa16f943648edc60176658c2770f3cba52a42fb55d75eed1a39696df86dc800020206e9418583a024790a9bd3ab5de0445e4fba519414c73ca8751010e747c1ae89bf46fa82374ccd13474b578352ef745d0911840170ff7300a4cfb0b2dad664ec87937252d3f89ce78e898d09c8273a3a5d3ebba09a9bc57826cbbd55c9f133d9eb74fd70c8a8bdfb425ee981159ac98ac46563632fdc2f67cc8b698bdcb5fc42515d142926026b219f429ba2ad50301194780fb7a83de35e15b0b785df42dbb274dacd8f72f21c091acd42c2f6ea951b767b8ed5278a2842be9423e20bac3a61f30ab2df81f5d30043ca79d668f7aafc02faa2415910fbf59ed8ce12a9d8bcac4ae4fd4427470b784edbf4753808d777ac6c7ae7226587dba7216a91600c9c200925652c53d32b23f183e3af4342f64e9204534c9b1760caad09680465691ea0d54ca09c42e13088e7b36e88f1404233362aee01ef6c39243bbdfb46a49228634a9beb31b93cb7943bfb5cd3d98e233c6095a2adaaa3b11bc87ccd9b5a0cb102e224ceb3f269747898c815ad72893d602123b0680d26d89eb596388adf46584cfd5d17ece9d5a06237bc834589de2eeeb653681e98758f676b45e49baf03b8a843340548be646f99da6b8fff4d1b5a072bce250074ebe9de28e2127912c669e6e3661df8b6afa8ff8f2e4cd4ac4e9fc5ae0f7ee166698696fab70742ee64122ec627860a1eed7dc6cfa873573277ae886f72670aec45938bfd1e9e501f4263d42646dd26eac8fbf3d157fad64a43b825327d801c121294490c677e660881a093e6a720b46c32e59023bef856d678bcf822319300105b089077a417ce5e4ba9cef0e356414b67e532484d430b927eb063533a921f0dcc987329c4639dd4a29c887b56b0e9187b6f98354cc0067500762b86beebdf46edca59571cc5c4d7f98730cd6b4f9c37aec3261eec0c2390d1be4f861ab86f2fef8af4e811968262a0a874f39895d85b0e91ed1c1f65eac067b4a2e5c535f1923a529bf93ae6abe838669816b80aba31e43db75ca1c50e98b5cb45cc4d37211b2ce706e149a6abde0f053a1ba3e1055f7daf9dfa0a113a83b483da1c9c0f7837b9e084d845800b9ef76636e1685f3be01f6b3e67f3f1e058d432e1b4eabe8ad67b066a945bc80b192e74527bab6fd681517001c8e329006cab7eab98e4a6a6b8c31af02a375266ba85402ef1a5f7dbc567d4a680e66ad98ae6d8b51d23b64601b122347c06b1f99f19b65b9363d8443addc233322a401f4610f59f29982d57b8a66c1f63115b9f83d36dee02122614a1b645795d81d3eb283accb80d1a79b91e412fe1c68c6bac23bba3722e1218b84df8482be8798e29cdde1c201232157d6d3bceefea8b86e2b182296fa41ad0a572e0166faeb8a7d47fe38916ff973b86f5457dd7242c0666719960aa22c3e7e9e577a23ebad7438c83542b20e60a34e504f9e48e6836c506f13595570afc262161bd72bf624059f219bb604336963c29a3f23471fade6726afb17db27e261b82d2d566bef7a3d28c564ef9ecfa18c158cc2c691d2644b3f2782252c1e8ac2454fcc753bd4b2dd05bcf77d5f38710577e9659d7ba997e23fd3ac1c8580103d4e7f9fd9051225740f32f4019e28373a7199ce17d0967ffae45f3661f666fa93779b1e52c0af47490356080317b0506e7fd2deaf654552455f9adee5cbee37a3068ee2a854cb274a0998460935cf5d93e90f132e2000a4902bd0d074de6b1ffb61c83ccb23cd98b4af5b8fff455493e918f03bd28469fb0aad6f97e868b94557e33d4a5b11a7497a01c2508dc3310b10ddfa69b35cea9e7b065d7a1a0d44f1e51092f132f13d66316c9d728307831ffda09d12784376d3c1ac6b9fe40f0fffe02ca9943a0da7283c4b7e4185ead1c4935ef5601fab3fb7788dda38eb7497ff210b94c475049893a94e66100cce8bc02750cea2cba881dd7d49908e01862cd1dd27c1189811bf767a7403847b29d0f7012631ac131415e8e49fbfc29e231af1eedd99947354835cbbbf7184fe490796840cf36b0856f633246b9424e71a64e8481029e357065b3626eb698961a42adf8e35e59f3ca7a7587b6feef745c1a87eab42f2dabece3cf09703db9094bace0951c14397907578b6b8e57ebaaac9a2598d7e879c2c7531a65ff6e1f913be0a248de5c4a848e16512c1a382b01b4992ce1478c740fb478bbd4f1fe2a4a8c678fe2005d32ad107024ef771dc49d50e5bfaef0dcd1138e1d1cde4498479b6272a302de9e8b171cd43ae9be23e1f94b70ffb526d27f3f788a021a5e7f72d545c6a0ff2e825c43be421a6dbb09fa2a4dd9e89801d1972f7f894cee9f507b46156e3741132f0fa28c3526138cbea1bfd513022da7b7184ba5f3f48fc73ac4430e1ea672e47c4e9057d45a08ea457cc0b0abe13e19c8c00d974864778f2a92e7135210613ac96a8d8430074a691efeed6465c71b176abb1b6aeccaed435ea14e23ac154f4cff2c03b64548a6f33cdfcbf9f0df4888edc14036db8bf96095982d622ebbde9593413818e845fbcd49f6eb90b0149d4c73f1ca14dbe5edfccda80c42a8868f5903daf7167cb815fe232bea7deb5c08dbbc3f91859aaf988526b067f98ee16220549ebd9283f0e5163344cdacdf671159fcfa08370ddc5b88caacfefa47e4605f0aa037e81e5f0e82b51fc56b5ed57ae0b971117145d358421322173c0ac1bebbb1a4a595a607b40b6dc34d163ca71119e1759fd8ad23132debc8e122f6261644bf44af401119b915653416aa15c8d9aa7f0e4c66ce1aa02d941453b158daf2563b8235fd048e540f7ff50881a73157f9d84387e6bdcbf8b0f975b58969445b917ce58f97d77632ec5753cd45b465529fb5994585c6b970f1dd9261678b3bda919fccc42767e5dc8e455cd6c028e977b0a51fa9dea31f37b5ccc85b9b200f4cc9468020f8ee54e205035e3301b96ff3d83d028383c66d1863209852b5ddf1fd73db0552a069296a0d9909d77b32f03b5b527b856c9387eb4ba044413a8b24aacf6ba8f3b26b6c2e72e247e1d5154222f425aae796689817805661fc382fd5d5f16bf6d938fa90f9e5e316136709ce75b5f38557518a4f4268990a638a8d5817764a22eedf039a8c326e60f9ed6ae9cb6c30fd7e09c14a7ce1d9761989cc40719ca0f261e2600015d625242b028703efc2c2a41ff692520a88f897673de2459f91c0d4fc0c67d5c4fd09e37109ea190c29a05392f7e74b66a1c84e3a5e3e1b7dcd295cea83e723972dfe37f03e64b8a474bc6b0cde3a7f69d5df840c21c2454c12152a348fd7262191327f218cd00156f3bb538bd3302966bc86ed90dece1d838cf22651b3e714143c558315f85b9f7433031d7baa07930f599a46ebe13d085abd8558b723569b33f92dd457b0606cc16789cc982be3bdb10cfc74162040f5761ae722505538130bb340f58e62f060185fee0a4414dd30119baf73c33a1f62d692522a7d8d1e7825bbd7e0996988210aa8c9374a659b59ce53fd62d74e9107a967d88d5e1aac1979f2261656b83f4b50549127f42c616115a576c9985e261bb729316749fe0f86c726e10b718327d7784b49ea72cb69900d3de68fd8a70d68f131771d94ba75a02f5a21826bf497373353e6ec83c1389e8c9ccbcc934f738125ec7f5d6b7d952389ec6361959f5fcd6164d41def1e97600cadc642916b87d38b0a8e3b0bb5e07352e760f03f3f85b72f615c930ec552aed121e1e7658933277bc7fcf53ebce13f999c841bb887dc2f9a1b1a82b0cf0a825f8987bf9c5219aa4aae7e0148a963cf58f77e9a3f561b9ae47ae41e164fb8b9cdc22ede36a36ac1e93e44b3dd05de60a56c2e0bc38a80c44008ab29f1585bc17d0e892e25fd7dc4ffbfae412d0900a8ea66b9551bcdce44b52c1206bf3d7e20ed347d82f75c7494e42c6ea627aa9e21b0767eb7973a05c0441370789aa7939d2929ab774cf2819cfb0c5b0d7e4e78c4ca36ca6f445b403fd6d40331765ac16daf36a6b7bf34a7b449762e800debdf51950c84e58090278f8220059a229b2aabb7ad07c36bc4f91401415329d2b0ad09f8ab840148bab0eec99559475fca0830185aa9dcb7018ac84dd4bf15ef40b75263bd06fe505afdf7e3f390bbbafc8aeede2f3c09133c9272d7fceed879dfd11c649ee5cdea2ef5dd1015bd948161ed194c629e8b97ece9f5d7270294f8c15967fe4df277fdf075588d5977a25af2510418e6b9d8ae0bace1229a4f40cb825404ad24849bfbfd1b467849ec8492cd79acd9e5a01ba4ed24e2917d7b1e28271aea3340ab02f0d2355a6c089cd9467537044dacce1d1fd2b1174f843354d3ab39f31912aa75aef8b4ae2dc17e49d39b27f5bb6abc57a8d8ce381dd79368379cc38945181bd7c62b2239d4e80991c1350c0b0ada84499ae7e43bab47d73e9c0452045f8c8d8261c18632bc6d01897d2a275df0afb7a6d5d5fa8b69cdd4ee29050999448fba547c8c6847da38539e820fa6e3428f2f71afa1ac96dc741605992239c529d2b68d6a64237d6f8c6cbf10173ac9a5f31c5e522c39b73013763d402947aed58ad68d491707daf80c1c8db7f97fd5b66b64a0b2b99a0613a2de135ba73bfd283fc1d8c02eba1ff20b19727180f66bb76e5ba71995f6dd996d4db8549d77a4beb492da37ead5ac1ff0c7af1978b2c6cfd140643bce5be89b19828a2b7d30dffe557a7416c4f2bf6ebbd27d70d263c6e5957dd6f8b67078bb34772cd98af17f7a812eba918667872688711bae1ee2671d9a24d67cced56e81a435b07de74215ba7a19857a5aa347957c8b364ad37f289ac7bfb09f5a9c8bc85a98ecc436e3383ad800e2a9cf4ae68a3274ea3864cad568c09bf07f251ca7248a7b946a7951e6c5bbd5fbc3315545251d315bcf90c9b12437f607c51145b2b7c2cd92520431237972f59795c23e39d4a69145a2043fd54a16284dcfd951e2d898129c184e9d897c6a5425f5b5aeb4ecad109f475787ad18492f776d897e4a928f1496300aa1a9789833bbf643a5c3eaf04bc406c7e960647b26bf4b35ff5c226525b94a0f3b015e8a595cfd4b0e7a061dda6bea8016a8e6bf823abcf0fb54bdd32f6616e25f09d0a63d5296c0489ba224aaedb320a818cbb883a0fd6843671f87fc4890a50ac0c47f944a34c90e0c632efb4d298262623422a82fe908fe9a234126f1c64f86d78262d03679a4d1c7d2b4202b9e14f271217fc8fba824df5cfa5c878c21b501ab121094a8550ecdcad5e98384cee5905ba12c6d764c9290ee71e0f0c68b5962e7d35546d75eb4b27cb045600f32ac678bfded6cd3ce47bfb93f81d45d0aa39b09deaeafb675e960656bd18e0d73cf39e99a7912f5d9db2723421800407e1f51228949415cb1862be79afa189d4fd18f1e76535d840c33ee59309bc892c620c09bfcd6ed1dcdf83f2b8ec085d73fb8a695e6554c9c6ed6de9951a4061f0cccbd3c887dbb1a5977d22ea1a1434ac5e4c63d7eeac1c23b47b9dad8c05efdce177e93a05651ad8228707ca869fae7b92db2b37f093b39bd0010dcf4f3a4519e43b294942d1b6c30c0678107b198401b50a8975c522c0fee6b26d86eca3d2274803efdd95916de2f2b0008489c1ef80acb98fbfe268e0a3b1d827b2dcd68e618f0f36eba284d0de32c756ae616bb071d4718e7fcb0ace7c37c3e4458a8610d84a0c32c957dd3d5356274aa4d29ed36967a858c38bf997762c975fd3f78ad72a6dbbc5bf6b06ed0b6cc0bf9029cee26aeac981c13674d9ef8be843c2891acc5c947efc9db2296dade3c0bcdac733e2f005bf6bd2773bca73fe860848a86b8d70c735d8bb06a378d15d8feea9ec961816a6a7ba0198f0a569d4298b2676efe8f6025327f1de49c39cf8437c06860636fa3670330317792b40431490b1ddf012636d51674f2e8bc51a2be676cee359effa239d46ce1e89fdfdf10a8c64ab24bf0cb93dfc363be2ae100efb7a2ba4e0b8d66947c7658e6ac72011c5b031818a9407893b5df2f07ec21bae1ac78e655f7142317c3e639e4fa1188226e2ae77d38dd495856a08173306619cb6694feb1159bd04015139cb671218f8b0f16e6a9d3473138988ead1394c01ef11003708e862781c2eaa4c03d83e9e016ea07f490fd1d9b377a775b244dcabe2b155f50b5ea0641611da7f7255e03876474e377e4235ab83d43c857625cbe135985e12af8b8ca9e6fd92702905c830177b8dc6c83407938b6034f23b2b85b347443ad191a6aff2b594c51f06290c8a55ec38a097f55817274ef8828db4d554a0837ee450df948f97a13edebbed43106a0c16a60ab794227041eb11f58b62b2cb6060fdf29a5a155adaa42ee9d799116172b95a788fbb037af3c23cabce3b9f64603f4185a94994bd078bcfe6b373b84e678406a8765d6fcefe8ec4eeaf9fa51491ae8c681940688d9c7b3a098a9b7893628c9806346a5abcdc31bc67440aeb643e84dfa24dc22780a89d25007fefa937f02abceb7ebd6ed62387ecf487f8187959c86bec90092ad3e6564c818ac67b0d6fb39d23f92b1bbc2b88d6e6eeb0560c1f3525931e90674ec36dcf49ea836c1b830c3c0c63f4a90b9d62241325a5aac9b6c80eb3c8963ffac1a0c40c84b6000bf5badab1183e3c8a480cc0b3bd91726041f593d99932e24826797dce7b3702796fbdc6763c81f0cbf8b73d4950d95e78903aa65816c9381d0bcb12f1e1de5c1f5854fc882b1017e13b13299f5f3c2e6568f49603370e982b5b53e1485f738ba064a8d756ae48b070c468bd7287bc2d0909df63f8ef9b484584e7a1198acabd518fc8e3a6ae2fd822674baf3874dc543971e2daff8a3a71272161d03a7dbd61af719e0be5ad7713fd770d89744f237dc564ae15656cd6d0bea5a2ad0b01541efd006011fcbf3e4c551a935dc8303f8fdd277785878b6ba41d2483566deec2fd974e021bb7128209082b1c395de2f49a41521216e21d473ca5ea94e2e482d00fe788718caba973a1b1dab5fe8c9bda97d9546f3872866ce32c37c372d818bc838c4de65e75072ba10440c622e19fad634af439b23acdd0abac75652f6f2f727224c460f9068ba66bfa93e7fd04dafdbd5b93321ead9abf85da27ea183f24dc8ddc2fcdd674c4eac7598041aa0cd4cb8e390e6cae00bcca63af80c17848f6f9574ad6d340845c2f21bac90865bda2e62699e3b9caffda4c89c4bf3fb445dbef0300c7041422d75ddbc03db6051d97035f7aa570c8d9c5a749aa92fc49c08c457a848d1130e2cc2eb599c355735da0c832b2698cc360c96e4873213462c5e9a8d56efcf15c3de148526da5d629e600147557cb752eb8e371eebe273ef5264e4f3715f18370d1d830dc222f34636aaa4208777da1c572a928c1d0cb2f007d58a78bc2543ba8c3944049c3212d767fba8b9da263a9404b21e173cc39bb55fe06db4f5d9da0de701bc5dc2ed0db8aae43ad1e15c7fd72b30f72fb1408911114aec5365f9b1511972ea0d09328e766308d77e3a3a6210e8a990802a4928137675f73e52e56f81eb24df9987998d31525c899fc4db5028d1df8eafdfc41f0fa8544dbbdaa831c77d7c0a8dad535d8ffee47474f5fe9ed02fe1620bd0be7f3cdc645b0be9bb49e1df414602cb5e22eb7b49c31b50188b9f7f1d2ac8f3eb2c659e9f028b1569704ca644f11f7d2eff45c026ef9c97c4a6f83ae7ba21e46d06bac0e399ca10f10a993caf0daec3eceb3ba235a5d075a36aafc1c98b6182a5f6e225eee87388b2b127e13a3a9e45d6cc55804356d0079366074f3103217f51c37e16f92c5ffcc70e5ada77af53d281eeb6904498d4b448c038cfff270538f9eb65f5b245c0596eebca3b73c4de6669788cf924f3eab7c254bba9b2588985a144aac5d589d9fcd944389ed7fd7853143ffbb3fb08a3ef874677d00df3b228ec6c20392248861e98a161f2d0d9df0b61c66a555e36b1c21b1461e732950fcfe3e00925337a8ca1e71f46d90943f63184274a02e54ef59830480880ca8a08003ded3728dc9ed56d7e9dc9d675cddfe16ad0131329400df7a69845f7d8191283fd13b1e79e6fdef89f830f11302e3017349cb9683326bc3db9d7498fcb1bf43a0fde8d61edfe32f33e37ef7556726dadbbb61c8cc28fa555eb818b134954eeb3db78df83ff65d89a0851bcc433baa0c91b9faad9b0374a7bfe3233da56fdb7f69785c0a98cf0e89c761c08a215fa03ca3748986a94ed55138c73e9b8114dbf01a168e96d9d334654ecff454a8f55da69ed55e06f0556dafcbd59c040905a930bd097138829f41ae7beaaf154cb96f4b387e01c812b4c220d3ac72407884b9542b8114aeeb7ef29ccc7d90661d62f46e22065f853b456a2cb6e119097fb76809dadb2a3cc0783c8ad2d65398c7770fbf04b9a511fdb12ae144dfa0861a8bb6c52f8f706d3aa2130db2d90f2688dd6dc671c2dd65224d935ece8cf7573f9d38b3839590fc12c557d4af292eedf3c7988ca82f2f3d8941ae30292bfada7f3cddf0794acd3349482364125a650a92fc4b4948ea28f6b370def8585a756a2a3e6f59da5b0acd91be1a7825e24c866006f5b3b4f4489d70683380a8499aa4b362354b15040bf2d4be5794d3f18fdd6ff4318b72eccceab4d4263429c051c09a071be65ad550f9ebdf8dc131257f73815f4d5f73cd50065886625e45b5c8bb8a6d64db784476b470f29438da13e5bac451d83fc6646b702d4650ab422eafe375e2cd41a6ea8d86aa908e45b8f21295c192d98d2815ecfef08b0562a3d76e3734532040e3bccdd2119186224c2c06ee2e0b64c7e7b132965859dc047e76d5de8d93ce342b5663fa69cf3ec78e0d676914253f1cb1b47f39ec0ca5b2741e55811a987c434cf1116dfd882f54b541f5b2e764912f07e2f1fab5105f37f10bdc09e8dc6ac2c91ffe2e2e88adc4a1a1cce084c1e502b74b7d737b6a766fa1d652195f939c2ff25039315be3d608f443b779811ba58e96168d193ddea8760bf510422db589a576cc67776311b6fc08923e1a3c25dad4e06a56361275d3254657bf5c7e429a6d62dd86a9720f2be7b28555dc0ff1d72db5eb172a65d3df6109c7b473f376b96759f63784c9b4136aaad676a6b729437b100e9b1750f9fa3a641dd32603ae2e544bac4c67ae8388475066de480c12628e811e96c6c6565781511ed7a52168c8b07bf612d2cd2e44565ffab48f428b53e7b8a3fbd919c206f8af4e1f4b9dfea92a7656f518c60e53a45cdc372c5cecbb7da8dfb5f8db34e12b271ed9fdd9d3703d0c06ae5ee3fad9f8c2bf3b4873bca30353ac5ed0f8e07f5cf52ce3501167fe476f0c244483653c32b19cf418616e314dee5a9da70caf9a6f1ab9aa8d5a0ffd6534a6e0f43d24a614ce9607bccd7e7b734e93a8e6487ed766c7c761e8b0a6440a5cbc9e0291e817e95192218c83dd31a179482d1c4ed2b75694230221bca007fe1b6fba66756fae4813b80f9b6c65ac2c03de0d6f2147970392e72e513a427a37854785de97172c3dcaedbea959b6b74a2ac87cf45d32b55b3195f6332071532dd0528f4fca9c297e246330baffd37c797e6505bb43a9a7978126a27fa507f3ad3b569ad217f6af02477e9668d7ad59c8315d6616fb57fe5c497fcf03ebfcd412e56816d3895d3b4a31f50728d17545de06d36e8b6831e86cd5498a29404c85a65c890949072dcf7b0902424d4331361f48022a50f7615d285d3f72a6e204fb6c96f4eca9c02bf46e174305a889a674c7342ef9b20ef4ba5bb7a34b60afe415d01b4e6a35e272ed687a172d6bec8ae73176e2be2ccbef4b7dba04fe9f086062e2ed7e2a790307169a57d6f5d0eed98c923e2a01d0c44cc3e55c5fc8c8ea0fa88a2acc008ddde777806268f4801c1801862d3ec085c5bae65147e659b094855f751d79f5aeed600b3502772752592bb362af6d96391c5caa2ff9287a6a7fa3273005becfd61811b52bd4b5a2d6176d16d8a4e8349ea474e6d3365a51e73fc7c644a27c3b4637cc07ae3ef4fd88da9ca749f2ecabb581126b98ffaeadecb1ae343a04f8e16d83e149b468c3eb12eb150cb1c35fc4642f7babc7f03c25ad5e581c155547f418583bfb88cf35dffcfc747643b37b9f5af5e96e37a3b3753d7a7213248b21fc778c0929d134c52ccc36e1bcb840d9a456718c5dda9a6d8cfb4bb390a7a59c5481827840f048d68bc9c8988d51fa3d208593c00639c87288383a2a57ce491cd412ff6d606c0e9cebb6961e5b902bf54fa186567ef22525749659ccf9a3e059dce0a82f4d8d79db8fbf306f8ce4f260686a4562ba0f18f0bbf84059933fd5677d44e0ae4f1c2af3674db6f2e31544bb44693d371341aae86fde6297f0ea6f43c38ccbfc1fc5fd48e8327b1d6265868ea168fdff91155ce2968b9adf0a18e40e4806b6f99ae703f6fe8bbbb7a7bf6a29f68829d2e52041da0de547900ab300ac1825b9061963dc160cb7a947c4fac5ca3d8c6fdb1ca86f7ddd855f6cca6ebfcc20f9484e9c141f53ab9859b1fb8270e6d70dcc68f3ecfb8eb701ea84880d27782d3c59ce90990a7c15cd6045a3a92228df210ab461f2af9e416144c571e6b5ebd77cded0a5e2cdc2630b029345beed7c8b144bd2c4cea9e3b22b8ecb3d377182d9c8a6bb529fd1c0b9a141924d59c65f592c4a626afce94ccdc4662e18c985ac320475e084e9c500bbdb8bb17a3610144dbc3f8c26b1a1481e513e2e40e986e00c6ea85d1360658a8d08db7d555a6fec5a5e078e29078817d574ece2b3684086b3bf8c2c34ed47374068ec548fdce10c89bc8ea655fc98d5f0cb2ed0a13b234bd06b94f025fe687485ea7f9bf17212c0bed08b4c9b0b59d97563910a34ff9cfa999dfb40dfacfb4717b36d162a502bdaf54b809598b14ff3c4871420a2aae6973fa0fedd63c841d7dd8b23ca10b99e51f7b34914751a3bae331ba0827c1ffc87c31f7622271c55ab78047c824c5d97d2f7cebd7401708c14218c3db38d03287ef4b3d9492c528f03fe1964e3c70fe5ff0920c6aef4d879c8ebc01900701f2d26b1aa7dd59f9ed064ce7ceef79f2b3c902ce9d176743736753d4317237f43dde4e190aaac068801dbc860fb42476c6b1dbc874db78ead60ea803527c8bf5498569fe814539f868f98e63114d8da282ec8aecca0fa788d5bcbcb96d075e0685d15419d98ec28599a0a5397930b65bccbd90a5878d45742dcff34f02643060104703719706ebaa1e0ba6c4d9587301390d971e11474e83b41c4bf2b4b503daa9edd2e143e6a5ca734338f2a8f53191859338cb40ba45736163f811211fc39ad1b3cac7aa9d473c71d0d80be1ee594d0864002a5d05aef294e1bdaa1be95b68ceebd9a478eedffae5a4d03bc122a899cc387db8be7a1b7d42ed75681b86bf0ece77afc46302d923106c7b76b06c16f89d70a91c1e10db69cced2d5eb6935ea4241071a0d8589331bbe677e10f25e8fdda510cc5b6be474eb315f016c2463cc41eef54350239d94c930791a3090665d296f58a8d34f14c601ec7836325a70db5323b72921f2857db30b1bef57d2c71524791254526a1dfe277a3b1b0265d6dab5680aaceab24822c4f0621c009f4e7df54d0dd0d539159836f85e79b57485c6a02d0c3fca5f569e1745273f7524f258f481c5de11c06e18c350682b8c1dfba965d2fb56acef0b85db37d8b1cb05bb16e9785e468123e1c7706717ff8a3c054995708adea9a2b1eca5b0dc9c72a4f1b7c7900e8b998e6a00d5ca44d67a72d985eac188c14f8db43ceb62697effb7682ac39877a4283bdd442dfe600671b4e34a9cd370392e1524dd55ed07e0dbb51e592e5baf5bb4f1866a31d2c6c0c11641a4b951b515242d424ed68a87754bd6138330f3f93db0ace053b06736793a51d5215d50c89e189ed88754d68abae6a2957c2d68aa2f597411a7d84a85996467926b47bdb268806ddf2ea9be4fd407498ae811d979d0f0f39dea841ad1a6d15de49f85287ecb15e3fcb0df2c4cd468b08a286b2f32f8d405d83f2ca016789147a5674d323da0ef449265c5c85d7f4302c0cee8fda06383b4349b967727089e80d4b762b6f0a60b5287acfb3b24e69b25f98916370d187ccb1102afb928434d5fb829109abfd844a3858e3a0a715c38a48136afeb78106cdfe48eb3eaba769935c7d5b355712b6a3ebbbd42a8348abcf516d9a52a08aff5d6bc461191cb053024ba834b34433b21ab59d3f7d336ab42f2fc190b15ed87010e5643a835e0fb06e46e1f93810c2d19ea973c110da307e2e1ae7ce3b2e2103d1e9d984693919c4825d72e9fdf9befea3cf85083736308570ef9dd619173aa34e8d464cca6b9ba700847a38d03d395dbb292ef96ebd6a5636dfd9d88c9b5e85cce6c3505c65d08013502d5b5931f3895514378430f5413f352e5718344a048bbe643040cf4ed9a9e2ca628faad204e21aa606c0e1641b2b4c6ba99fc852452e724b6be2f7ccac8fe47671a0a930ae4c213491a33c9b462ec7539cbd1cde3ab7477fd9a0fedd3160a9ce9ea583a438170406705254e9208ad9e264f7189fe84c3a92fc9bd3142993c585cea5df36d63f7d12a781fefa6c6402529522fd729a40a619838dc79499acea27b359be296acd2795aa5918cf27e3b10d4d3f31eb7b404b303433c0a743c7d9c122a87e5657e02dadb468937c67144ecf94e6e594613eb3cf551e0d80a928dd66d8ae387517b962dfc2242accbbb8c25ce23cdd851c935d6a9def62fe498340881292b1da735a2cc546a8202e1a706aa8937227dec3730bdf6ed8355a9055ed9f5de621617f2e3193d9669bf0165f5258f121ec0293b6f9e51ed8b5d7bbe5f1adf9202efa7af2e956f38363c4a3513dadc3f5f50ba287d247d3014593c977df56004baf6504a78aadcc19ca8cedb71964b206d2293db2deff502087aa4933bf69706b7d9435033c478d259ae79e6f293458a439ddc7c3c010b0f41e2f1ff0e75e16448f22b0a2ca8b5846f939c03396254427b3497d1d95140b40845ed0d9acb16e4942178c561b3c4b454fafe8e0d6ad5653ea6c5ead9982489817c211fa2b4ff7a5a727a308e648b2016c734f7394d9d5150f7f54e5d3181ec8a07def138ca522cc0d34d05d1263df88a4413265aec2a3d59880c71f5f681a1185b18a40df3ab42b5ed5c627e4b4e0adbb5aaf623d9709c0b76ef88b4dced8edcc242d6b9051ded55ec6f759c34063c2de8ffe350a7b8a3dfacf5822f38dc5155c802efda6062d4018e941ed31a420b1739cedb7a3940420c27aa2cf963feea4a52cb81e8698d3d339403d68f4bee4a8484c94a7b8dbeca7db8833b5552b04a4bee58012da614795a70dca1dd14a02cce82b58ebddbb02aa71f69e11adbb8e0767502d211f601c1921793810485ed13a1cc3abf89eca9ee3505252c7fb81449ccfac0a6a2bed85228ad19ee72da15c3011961ff99c02a58a66906ebe69b553817c8677eccc6faa6c830a529e2401f67725e0d27dedf00eb7f80aec8cf3e210562e6baf2a396c20ea00b4072cfb861e06b120bec67d91625dbc0882c6201a28fcaea6b166e3b702dd9a08cd8a623252dfb64d4cb677e513e886071b35c4e123350582540310b3e048a35c6a2ccc9a23aeed8576e23967aba0644d34e33b306cee4b33b980a3196dfcb7caf834b62dbe22abeb01ef7403ef291e82a02695cac058b703e7f0dc896d259aea154ee48da69fe98b5263625f5ffe76869ef677ceffe191dcd7ad8243f5a784decf3404f63ea3c351f6157adf1008d138c9c262ee2123ab9366f2cec1c2a0e31202d5095fbbeae9b79abc5b181af4e860299905b7318416cfcf19c4c1b97014b59cc04252501745d088d199e9c80377806c999a728548c0a06dc4e59164a7c60225b9940c9dde9699efa7e8f87418e71faee8b8accabd76eeea74cd68500e1f0c4de136ff2be37bb5814fc6f13de65c82849b2edff1e85d31e36aaf5fcddcf4be002fc7b4e1d77e03f110b5eb3276d4ada84a6ba9851734cef0ae07e0344c32ef73f8d425e98e4b11b8ff9439b1edf465b6aaa04806dfe87a4fafaaafc400a3b27d10bea869f8a3312746cc68e29a80a6e4836cdccf9fc133c93670bbb326ce542fe630954d338b80a6f3b9d997f03413cae3590c82d1c75c148f2494c057408dd5322cbfe0fc357b2cbad14cf03c4722d52c1bd5f9b94aab727bf42418f534d2837ba593e543503fb2a6f5b83bba9f44c8ae7b9f45b4a0d1465fbc72df4dc30306ec7eed06c99e9bc7b4f63816a19da9b42a892d5fb164fe2eb39548a56e3ebd9e15229b33e0908418207073b36dfb4f6bec744be29b0952e09064a9f7680cf37d201dbdc6c102dd25935498705e873ff420c08a57d2d935417106182a22d2b224454e189212c4822aa0f19310937b22332d11ef12307d55719c1b3fae078ddd0e23110ec5c5e2d89b9615c44cf5ef8903ecedb1ba217a79f67a55f30760a22bdc84abeef76a033e65f8433a80f6eca1a30f275906f4d93618126472b8ece2023687124b8f01deae59df679b0a3a48e33c86903799eddbb2e4db2a6f761b92239aabe986b664ae109515f58c5cebff746c380cc907fa3a7a83bea4d537b867d6596cc04edda389b56906427e0fee7a6d95f1aaf5c4316e785d59fb4fe013f7d5e477cf5102634aadea6f2b450fa57241378dec04ceb40ecbdd7f9298e5c9588959be8563deaa5f532071674f7e2d92521fdf85dd68100df94c783e226952e66f18ea86a79893383c3a31f30e79a6c4298af2cf3e8750f7207fa56e0a5ae4ddd3cb6f084fb75fb13e4ce2bf5573bdf2f6b2d831f7739a91849ce21254989ae8cdb23ada8e301bda6dfef3eb1b7463071b806409dbbbe7d2fc2fb955ca1077a8fbf526e7eb9909900d69d19f2df78d3178805d4ecc232565984d82a7e858fe4bc4102a569aaf79563f6d9acf75e95abb6ccb80679e4f06fae6f8af6c42ceae557f5048fc4e88527f913b6cb5d4ddc79fd9d79157b85c90b84d6f006da20096b8cf9f92e32a5a06ae1d73117eb6bf542fab4947cffabcc56211a65cee5634179038e830665dd6f5d6311300d17e0561f70c1f1ca55f6d1846e28916670269448c9af8916494856866d70b98ca35a78ac51263c4863024c5c7e31d2e9bf4198dd83e3bc499539b037448420c93ee1e0c66f4dade68890ff7290a9b5264ed11d176c5cfc6a91545dc2227943092ce12e26a795f3f1b1714032573de4f6f75d71848d5c1b5046a59e2143caf3b6b91f2e67919d69b0e240255e7f20c4a354306c11a2ff4a994e06a26272ecd59a0f2bd8560ff91db834c0f480079183b417615787999d3d4394640fa8ebb664accf0efe8e2602ff79eef07ce1a45e772c46141575d5147e34ebc5f0513a61bea9e34c79e02ec9cb4acfec3f5541a9fe786235077de9c9977581e7f572464ee06de0eec90e70f7d772be222080dd599097bda7656dc9740a8f12b142fadfd246679ea94f3b63157f813c4d35858328ee036a3e68471b1fcb86ad422ea4b9085da642d63d85804c7342f0e4516fdc90e7e6e10e89d4fccb3e180865ab526c25e6fb0010cd0bad7528170399346a27ad68b3da69d0816de1f8edd467013a0968100af9f9ec173bf149dfe3f29477f082489b63e41fc909203376a54a4f732a08d272fde43ecd2bc8a34609bf14bef5738033a13b212655c66f6bdaff2373df80e060d728df1d7f34560813fd6823de5e78d3b799c2b2b8e731d37987d7c0a2916839a394a07973dca8b8f42418ec1aec89465a82969c209ec1684ea7f7a52b710df8a971e249c703dfb9d407731cef387775772a39c7c8e6e0aa746f3a6ca59864987e0a075ad12e627a272b489f36329d3f8d17ac796f671e18f67c1406abcd799d12a63a67484a3d4e0ab0210cfb7ece4821ee4aa150af49107dcd0782252762f79fe1507ca17ca905a805f46b12e5b7e69f2a91f66a5135da1f94c5e28ab28397bd3155d4591e0a09bef7f8ccd9195ade6765815da04b7f57595982d566dc26fd034ecdbc6b054f22fafcca0fc202703db20113e32e08be396a7cb0b2905fa09bcd2fc88fd7a1daa70ebf78bfd82662d97d7f9550d35bab96df363632f57885b5fe0ad7a89ea7c2c07504413e764ccaa355766e352f6b707eddbb748d5e5ea73af98ffa93b8b2cb1a3b8330457273e9eff26e4010c4fc0a3d30b388306bb69ff37cde5cd2a4a591d70ef2f5fe4e83c1f713cc8abfed5a09dff28b9a9459f80688a1f94694645c8cb92e6204f94694056eb131fe25299b7305d3e58dad6007d535abe0fa83f308e4d82351690d6e4e3e54361c2ed8094422bd8a66db059169a96d8fa12184b0a3c1f67338b68f1fd9e8f02a3dae53b81a7e007fcf313698e015cfcde575fb816a1475488a0c16732fe9efc7b9be73abff572f5203505449c79da36186934ff45eeb321b3ee1432c7e9b64531d0b85ff0207f7de3bf15da31438ce03c0c0284e205b57546369951ec6f3286d0be9514f10cb74c8e355f5a1738b9966d465f1132adcb2ecc9cc0805a2636f51fb325098e13456ca96786c404e42ae650fdbadf9425fbf0b44aaeb5305f661907e554f8dcf3826b16058f30064e583491a5f883c37f3639bbfca48193a4bfda9fa41c865c26a91b4d6f1e9d508380e5938d0ffe8c099edcbccb6b128dc983aa5241d290ef25ff240e0ac8b7070f95b5a7a85b5447dcd7c4e3454bc1245fb1c79b09963cd87bc1ff0b2df360c2e32fe31bcbe36c572c90ce2fb0f1da87a1e372d8a7e5a6aea185ee84d13187f2abc3f59bdf74f44da5334d9c930ebd6aa98183afa997551aa98a9870ffd1a788801eeafd745e4115b66047c5a320a1f0320fccc2077fc463b89aba9319f36fe2a05af53952cba4d5de696e68e36b28be9f420994d6d7bf3836a4ffb9ca608f982f0e3d216426a1bf193f9997597e0614cab21af40bb32570257757a3fb845b36f4e021814950ae890acccddf93d9031caa140c6eb6adf59fd8e5a89ac8329fa5ef27f80905fb1c8d30b96f4a7f85e50a4de12bd836f38cbb938ac345aa63d6404a4fdcffe056ac07e7f284ebb3f21a7bef8da96d5ac7088454ef00a2571324bd4eb6972f5632ace02739c2cb9c5cc65b6adfff05cacde0d4030c920635b2e0676d7135f9f1228527cf42a1c24fc190ab2ac54eab91502c5c688ee97ab24c1525bb8ba7160cf11a97e78a6f5f11d1485e9519f3b35b7bcf9fe29fdc423aec33b703312e3af18d1fedb09d77d03d499b78da4956b5f4769f20b8c13a2bf6fe47a2c76a121e828f69d87cee10c995f299f1af873da298d0124b05d2552a42ad0835e93c658f387a513a72a4da0978e47ea35a3c57727336c3125d6207842a189ef724fb2cc56fc711f26029b7390b6bd6db4dcbe9c73ea2cebe152db12dfed97465f9d480393288693ca9b3cd7e9ee7a5cc6b9890df2a61fc452b3ea78c31be947d957d867bec43056fa1607e1b4b47667b6b532f4d40bd5de8e93da7689933b280063f02069f4b1256b1cbfa13540878b8f66cb426c9a82a19b38c475ae83e7a2be77baeccb9aaa1a3cbcdf2a44f98ca9d496da68e50229d17abff1a0edf84cca54ff41942ca403c828752cab67779546cec2bb7f4208b593b026e9007530f6f241c6b82da13af5a6b87a2017c199a0654ee4ab5ff98e8997e46828e0304a7ec862ffe242457a556b24a11c33fe6825a1c2fb7d0d2dfd779f50a4105754913f8a3396b51efb763f9b04ff1f38e9596cdc4b8445005ee558ac157c531c131b9c7c912821e8a8b0a7180b7f4c797bf33444f817e8ce0cfbd95df3b3a8539d4224110233bd427ed0eb6c1537c4d99dcf0b778b940e89f8d1d18bd91e556c3f55463e5917c98f190c5b5ad2749310758cb7f60025e0c856088235b7b0d18df51db3c465f2be488c0ff76e43ac154db7f5bcc48c77d099556692b96aabb1842369e4852f1170f00aedb834ad74e8166a737f4514f1026c94202cd8064bb0e921d450854f9afa5c2c94b70ce5c1d650a0a7560ed8145fcf3b38d54d206b5a0eee828602b374856f08864c2b86c0e0754d7df218230f3d42165c7e469cdbbeaa8cfe9d7da193049ac8bf1853a04d2f8245debf1bb003b3d3bc9fc7d14ad91869e546adfd42ab8f462f4dc6f707fc5bde8d80692c1759d398c819647e6dd5ef2a1d4432b6ec4b4e09eca59bcc1644d128a7681cce1063adcd13c10407694a6da6a61a9f0ae451a80f74537da321331366714a3ac7076cb2ce2b322f2d57a699fef37a9c2a814e8f816d7fee31123ff9867fcec3c3a49fb4e482045e160921ad974cbdbc8ceb2d84be1b78e4786e704d1cb87487ae8802dd6e43d8eb4893cc9236ff58a318e23e47453f6eb1714aa83d165c68c1549abc936bb04b4caaa2cd8aba3a1990ae938e7b1ab7dcc7ef32fbdab7f4fee22b002ffdf24da9e0df42f23461c1b14b746487bfb60534b9c13893f0acda47b9637bd63d74c5e05346c3dff9fb8ead5b9209640db7d27e8ab15ded251d20e311b46cf85ca7d2783d12fcf0136fb96093626fb3e14beeb29fbbd771aa5c087371edeb652e97754354dde916e5d79c9d0eb483116f5f94678a4e2bd4e181ea483d946fe4dad1bd8c14cabd903acfb3b69f4df01fc0b5fc1f70358d42b6c0937e2ad8b2364b0083758e04fa40a2699eb3613c0148d6155569cb9b8288b8628233532e8498fc5a5e6c63f11d3810c4badd15015ed6ba1b899d5ac2be6a345f45cce2fb843878096eb292618bdb89d3cb68038354e345b530259dcb96d208b5a40c1182db5b5a413dea48c70dd98cb0074c09868584fc5ff3785b728837b14214d124b474de4b86210c6837cdc4faa8292ed636e57ff219d5894ddd94167afdd15cd1b22d484ea92da7e3e9c494749bea75a59e3486639203da1dea6b81c1b51c08c7fefa30bb3427a3f64b04d3c159d68abdddd745726b674815437264661181efcc1de4c0d1911b3922d8dadb7e15a8c0e40ebea70a7814a118775be837e34049ed8c5ae55140db50a27ddd12adcc76ca62e70312b6c0c36da17a23281c830cb32aa0364569406b5c5bd0f79630151fcf0cd2f67b6eb7a967018c169181cfd2bd68e3543ee323533e7fcd63db6336d02108011e36ef4539e14ed09609f2dee71d4fc95512ec28e2159bd0626dfaac097daf31315df71bf637b302b0e8034764755144713b8b65452255ba4c0cd043d22781e11879edf4ab5fa661896513a8d784a258dda3486f0c16736de27a2c691981d801112b1edd5553f33cd28644dce9f8ea6e39c80d8c053f1983ca9f8226f64fb52dd2dc1b2b6abee8096225885bbb7e0b1a71e60799423e6080f44b3b72ae0e5a4c913c3ff8a387cb01a0d89be8f7cb6feff31bad2df05e3a6b752e7a5acd143681e3f4a62a48582327aec808772559195ff2f701e9cc14d1489a63939f57850dc10f57c443367642b86092db351a13ca198bd0296b0afb4de1f97815f7646db578e9a148a5fbd5a7b3678217b3f393ad4263e805a030287c86973e04f10bad0907ed1f7de8278e571caf05cb72752bc98b20a997787d418bf8167f44a314836490d60880ba947a018e096a38940e50dd3c1ad4e58ad813e8483308d3221a6c8630134a20fbab1bc29ba0ad82ad447ee553dbfee6ea14f48ca778f4190eea5bdec81136ab3f7fdc9fcdd2cbde71100d7ca037420d990879df08584024d6040e472bea159059f6cc3c36855f6c77f667606f72dd9f3931ed0c28ed626a32ed9f1b786c9d5630406ac5e33de688f59e30c60d830e1c1d10e785421950c4c1548382359ca7a4683f969f5ab8b72e8ff8d125a57deccdaae27a8a9ba9ea86e05444d2e44eadca84f9be0248eb135e6d665bd7249171ce5537a9fc6f2e7d6cefb78aff97cf74991724eafd9a1d251d41ceb70d4b5a2661a618cff9ae961debe29c733d60c67b4d081169c2a00b9deb5814ed34753be4030430d7588195eee3f0685144237d24501dce81905cf865893040f0e33e9d69015a55b5a2b693469852a23da42a98d06e33d629b1ca20cf9a7ffdd25e6947fae124cc8a7f7006784a739c1ae80f87c501884f8e684f627b87dbf5673c638633bf23bfbc38c76f30c65772e3f57ed94b5d7dd4771f8747a45dcab40693c9671acbee4bd3ddf2cb9e41520b7001ec944300a11c60e82d3585f999667c584c95fc9ce1b78fbd295a4bc916e863b8aa0c15afa2c9cc784f17dd034bdee191be16fdff4fb6beec40f5c47637a87addcfe201f13352538f18ba5dba8091f55f1957b1e58cff0d115448ff8d7e726636ccee5c00fa13ba493e64de8ed80926db2ce2dfd58a9019bf51530fd511cc3ae4145da8cd27a5807aeba9b99bcf88e29d2298dbf2e5bd22d7f4eaacbd5b498356f27c6b2dc19bf2d919e290a445ed12087f41d4a385a2b9c8189cf51afa6bdba3173a40776b3eecff89714f7be5241d13cc00ea088e9c2e2ecf882fe37af1d547ce37bad9531ae8d8cdba1f6139977fa0253f6a8fa7a36db297bf4f9a6d0355c808507bc5f746f0c2cdf05e9c816fbd4eec1221dc4289ea4b75a644eecf7b1fa17f9eb6e3a8af9fd40bbafa5cc8afd270fcc3b0af26d50ab4a156e093a04d9107db4f53ed2cbd51bd6c9e8d4dfe040f78d0372dc858a93d20d27c5241ed3f773d678282dae2b0533009d8456bff08c0833e0174c45ec0b796371b4de7c143a1c333aa4659bdbd29d9fe9ece5b38d43b797669e6c80b37a86198cf892d0a4bb53068df4e1ea91e1393908b1b4ad9ba2cc6b3b46cf012f66548aac5dc87f0134cd8ce8f38a0e7c2c66c2108ec59d9efb09e4f9e9849abc492b5a68ba4455d0a0d9b1bfa8e2e84fdcdfd37c357e66f7080b50e5bbaf768dd8ac72003cb920cc993f23adf21fc76c2b0999e1fc2fceba0bb0f429ec2e37ae94e3af1f5d8525276c248bb2804269ac21f0ba08ff1724cd39c3e750472c4474fca2bc3ada1a965416bd1d9956cd0dc2a20f0794b4ba6dbe0c23d6edc67eeecfceb70b09f9e549633ba98304f78732d1c07c3161e29052937ca4408b5ba283d6e0f3f6de19222f7c8883e2294d8cb7a072708416edc3a039db21af3911789cc5f979f17d0df7eb5fb208aa0e757a729918053677845dd1ca1f29730fcd7ad1bf67eb888abdeb75ef1f280e03c98c6edf3d7820a814bdc49326224825dcab881f9d8e934d31c22e929fe3a89d47b63533afa65aec78aa72e5828a7124d81f154c04b2bfa1b6ea3435d77cd10f485a52208f404bf8312f18d815d4987f23469b6731a64d9cec87a6edf66412ad0c580657548a77238e45549e71c3481cd09b3be8132d5cbc2a888ba3f3868ceadfc4554e516b230146533659eb5a57252d310e9a4f581bd6711bdcc55b51e92f3ad5d5f4dcee1c7c0a0649f6e9c65253741f3893f8abbce179c075e8a4bf4e5aae0e8c33d508d0b874cf194fc16e387948cef6c7f1990369c133ddba757b0b7c6fabb1c76999ad7ac800c6ce289d7fb2cd25da9422ca01758c85d45f76461a3122557af157fcb328763285b05b56613674885d337c4511b82d4612f378ab75c3e6f875acc335519eb30149eee26f9e730e24ef077b32398ac490e60a5f765612c7fc9cd63138a8a1311415c3f81d07da6656af7fb155ab43e187b0e0bf8b5668ad4ec6c116ce18c5d0f17e6cd623446824a3a00bc3d574e2276baaf85384fd134d3e25c51fe08a9ce558bf81e01352a54351f161f83b49a27ef22fc94df85bfb52df4e52b2291db0cc6002b80317ad7fde69fd8fa44d429b0523a3a3f2ca7737bd04627b08759cd5e2f2114b2fc031fafb8680fa1ba1f8c32054d47589f753503523788a935d4b2c0e55db9a3bb0554e55298d30a9a632af7a5c0cbf5e88870dc6d09a137d5f02c29cc56de4737dbaf69b2ff2a0cb5bea5703faa53d1b581110c09d1f3f152570a70b8b413f141090faf6047e9d4b222500a84701be199c7aacfeb0523b9e703b3a6947e73d8425374d1e9e1a9a051ec24299a69080ec0cf9acfc1a1a532b8db333485de711f233cf9667982799bceb366c0daffff9a7e5163cfc635422cccebf25eef4762da5d3993a35f4955a51656cda4b0eafcce76fad35c01bebe46970e8dceccea333d446ddb2e303a092335886f34b70dae605a23cab47fb03047e9b629cbddcb0077ad7188bbe9155bbe38d16baef777717d64a9f525b74b1c20c7f51a81a0e0b50d2caf711016a1fab8d301955a922278a2d32b31373e51b00f131ff2067010cd9fdf11ca005a8837a1716c5a2a09e8bd79eaf2424324010bec6bfe874afc7c925212596a137c167e6f169b5045619f1f09eeb776c22eef4c4c9a5dd5ce781af5cb1ff956ce6f127e10035f26771b8bf6a2724a58f8c1c30c21b90ac54612caf254ef3e48e25e25ccbd56b382c046687fa98b79dcfe898bf7d5dea16a58fc918109c6f810cc846eb75ee95d0292b380856536fb7379c64ab2f00b7f5d2fa8a29cd8e5bf64b28ca11ec731c2569c84fe06fc55166e008604efda0472c0c0882a4492e62636fa58b9d64c78f3afe97f3996479b9ec69d81e0adb74a0f10f89c126a99e8720c8f9f9558769eae4b77e95b5a821c541e4a560ce8bd0a37626193da1274c52cf4881425ceb53cef0f5fa84936f656ca4503eef8980e3a61fa1ff217c62845adee84b415b7f9b1747f0949a02c9304f9958645d51f8c57659889f015e917818a0d1729c9e60762013ed5eb3567cb9577ca44274686577bac5607e48b0d3a7f9f8bc5e5135440a354c4e69783d31256e4133329e750c7bcb20dcf1ac348ccd4171a08c9f599dae9ba384ae4a76eaf85f46505b40e711b4ae0679292d4c326d59e8333eb20ffc5c60153da2cad8b2c936cb1b5280edf6157a9ef0b7cad8fa1e0219ec4a3177dcd45299e1ed505683e41be8dece3fceade53e33f304cb455487a8e25c61b0ed5bb1667575bc8535585de6806e5defeeea9377e035a92e76ec81e5d4ed997c1d10e87465f5b484b0c938253c926fd1a65b9ae214c279688828286cb1178e5404c362b256c2b18fa88325e21aa282f72da580b760f4377937d2564b494b90b28a55e471735a552b7c5d73712c288ce2d8994d469ac213354b503cd91c9f84998f08a2627733fcf79e9cdee3bfde26c258fbf5c1a2f093d1a55b5da3fdb04c937ca5c5b1419bd91b42c6eda45c2f0e173b914ef99b3ae1d120e76fea4165f7d10513ea097b3fa57bb08dce02fa4006cfd30c15ab66b6104e146c8811170d5be2f4d3f25039049315535b200a8fc556963ffe67d87903522316e98189f04112feeb1c4d558c9c3ae23034840cf3519cb0e8193e92d3138516d1555bb3f02c2abe10c9d8fca9377922f1da4c517aa42cdae6dbabacc054c71e3dc171493bd190bd60d25e3ac37795fffe780f1332850c5e831a0ab1d4c3f8487626bcfdf47d0178066ecf837d030036b7830975229255d9a2b392b3e9924c3e5b82c4695890fed76ddf4bbf9872143c39a8690595e6192cf5a561e80f6a7e0da024430be77b378cc9ecd0308d81402611505a470b6a9785881d6f0d69c816e96ef5e5c0c2a1e6281107c0da56d41f1e6dc56378eadeb112ec616659889feea7c225abb9bdbc1b5a2b75a9386c1fcbf8891bd04c32bc604e6078b3eab7ce4eb937aa88ff3f3c4245292c1d4754eea081a0fa47afcc5e6e011ee72926aac0bf6df1c898b4a0dab1891a394010b7b30274b5c0bc6ed9b1fe7c1d727db83c34b0a9a891e1946f35f9f5e1ae2b1d86dfb47d58c23b250bb34ff6121c18211b6d7898706a161ab561d2eb4a61d0ac50bcf71b719d00daf148ba20a15f587d6bcaa9114b3dfe38f9918e3acee77e8ee2b521fd869a3a75b5d03805f0d399f764071da4d9e941db049c923bc43ebd8c5fff6642597f8beacc639c25e41d486d0d3795827c3a807e44216c5e84d5098d83d3afeebe08348332f82c1ec7dcd228b3648999672bdcf9095f05e16e23bb11311e172dbb19350528862654888c56f997896b33d2a84b7d2b75a61f89f77ddf7fa89b55a83c0df7e6ecf6168239a8c7fc64899277f9daf6fa4e03614fa9d203124d899b37d0935ffb98ca6258c1c2e5ab13ad9914fdca13991b9a81a7eb9e5d5ab035e93fcc46ea2631fc70a3787241290705e2a0516855e2e42a21815d6f09ab884925688e95f26698d4cff1de5090476181d5868e41156855c41987e519358d57dda18dc397ece09899c55f0aa7d9b7ec84a9f2c712928ad39d885842f8a9d4e4a0de16a5273775ba1971b66f8e5b3b24b149da0b0332e963e53348326b9f91b609cc59837d22d7de0b3c9a147b45813d1ea2392222b3595d09ec92d18cead0c34f0d170b0fe1842c383df1890d81493661e4539dc3b9fb6d14da924dbba8b15edc9fd3f55bf0524ee800c30f676687c0153b18a22526e793f26938b1aee9f52b3931ea4b0a50ee7fc5644e34b3f08d685d71ebdf380225fadb6286739d822267d5fe264b731f2d470d20abc0c97022bdc09f4d74a8a3966bf7400752ff928940199952c91ae39fa18a8b578c801c3e08781bb447f3b3f5f8228848825b30fd376b09fe28a60de4e8c8c397dc357b8b4707f560ffab90df3de9fb0704394fd14dd9361a0e8877f99e544294b41bf819a2f51677821c46044e953667343d4544c19be09c81fbd072d677e0dcbee1121727214b6299f72b9942e201d6ad3b21a5ec3b6b7dcf0e8472e5c191fb3aab34d1f4b9e42caed2d1d49af6801474f6f61139d0d1ea936b38d65404a7c3aefcd46e4b9529cb8a5ffe185671ebadf0e763db058e89e650f01ba9b163070f7679f9eba3b45beba8c357c790d187a74b86156c45a5c85e32c148b0021a47cce8f2e4e935e9be30e3251308cc647b8f0c5fee922ad62b01aaf0f7307c345a786f2b2a8a41f618f5834521ba024f5a42cb8da79edd84f2dab8864e534dc32dbac21239b70e5c0883d6c9a0ee0308e58c39842e8a1ced2e86b9aa1d80e298aeabaab42ea7909ec2a16749905f1d5ab9f2f6583be00b637c732dd3206ab5cc983d3bc2e0063607c526a6e0a309d21961e6c3dd637a38235b07de0909e8cada3f95fca6b19efa80481e9797317d9d385768c7fe938ff19ad14ec46720ab314ee398fc1a0ee33e31fbda37d0b5a19948548f13cf3086f6a54abb8ac388c7e66822f62d0339c1496fe58fcb3f9bd7c55f677cb3f5254308125eafe77a47b006ad4dfb0fc073c343db62afc4ed4bec80b59f58cbf6420e755a91a2ac1cc341997892cd2e64e0fb6d64efa6eb5cdb35ac1201b14c1b9213f5bab66af6f4cecbe6137db52b78447fdebfacdc53ae8eddc727f9852ace96c3a5a48df54ef798ba1a0d787e9221b7d2ffc6d784d642d678a0739d3eb7446262420169244ffed3a02eeb2281453ac561cffc67365bc193fcf43ce57b50384c26c6d17394870314e5dfca5875feb08fc172f2e5d778aa35d4ff8437c4ecb6b08e57b0ae471a55381c5d4d3f4efbbc79d3864defc1a5b2435fb712765de4e948b9966fab71637f453166a08446a0456c46a568192c7abed3dc341e165ad9ff3b40bc5bbcf9277bef8f9c62f97f4650ca922d425b65897de19f538b935c0496e8ef827a5aee72901f4abe2a035f780b88d7054916ba8bb1c370b8e5f4bedfa88bc7794120f4af9ae9d1d21e8bc767749fb017f93546d314cc15a801bc29c9a690580518105bbc741deb3ec0673af66d2d0867a6b6486694c9294aa14eb975e32187429c7fcda005d0e9597200f94aa36c77586513308ba6d55135bcfcdd66398a00941ea773e0ce2f3fcbd02ffdd800afc96cb06f36d54423eb45beab02da4f3d1efe8ec35d27c5f6cbf3f465b6a06d05738b0421aa8537adb48666b1057a26810f73f436104fd070021809cc86541e9deb52cc722c5ddd9c0cecb8118d66fa734bfa620cd0c8df702f19436a6e3318675dbcbd7d7f4588a2531f4ca73377e375676662a1dbb3191aad934a16937dc6ce53589075c81da32b42c21e8caa7821a6504f5ae76adc8c615845ab7495ab484af237a4d6dd50d68fc19d89ec5fd431a460284093c978aa365cf67d3cda6c7709802a09f63cd9fb293577fe9a6abb0434cd63afbc26178b7f9d493fe8b0fed076283c86e08fc76c2cf03eea1049164b571ebaff43db63b6aa50fe4498eb8c8884569a756405b7d4f255f592e152b7ef34b45f18b1b579a993e8e00f699523daf55b7777f4dc404b18a56576943863ea0ada6de92fa0f0ded4edef337f06b8f560c075505b699b0d874e319064d44a086af976bbc8d9de53fc2e5610ed83e8ac287817afe53fe4e7d31115c6f92a1dcddc2f3d3344139a701635a750d0e87370064e93317f8961889015e9a2df659c6621060bb41d3ca243a7f6ecd8fce6b1998d1912945cc60433f9429405ac1fedf8107c6ec06052c99eb0ae6574269c4f79a24657188413dd83c30c78304c1715e84265a5af5718dd32210d83b42612e28be024ecf6577009d48e1925ec8085be090fe2f468006e5ab3fcc209a1152a05d0b9f6cc313aa1bc11029e72a03a54a0985a1bc503994aec8606d87c52918bcf23b6378f58573745f66eec875fbeb1e3ed52c2494dd278016f408e745c66a48273e2187160d7661f90437a8b2853a36902c65c6e82023cba5b39bbb40d2d1357ab339e0de8dd4dd264c188f527d31d6df190730216c2d1b24ec689f14e85b33ab4f4d19afefde51ab3e4cd3bf615c57d80ec4a0fb37659b773fefb813f8349d5ff4961955ffe5514c58a7f315c3f8ee425a9ddcece510b91d550a696f1f66fc747a1fd93cd2c164b9aefca5370b70f526bd0c055e9e557a5ed203a59da314d46f912358f15931661c1bbd55d4be856eef797b6c0262525e8e5ccb833a8a657530d98e25babde08da864d7890dc1ccfb44df32a315b2afb0ccf7c8ab1cd48203e25584f8db06654e39d6ec5e05d183efeeb26447222cca4ea9cc5d151ba8da0663f814a8121b560f3da00638a0af802cbaead4bd1fbfcf6fe836c3b5de705bf577dfbb990fe807e642214c1eefe0fd94829282dc41cf597f1c06d7420fe53e65992cb12d12a0cc618ceabcbffa0933070e0d57806e80fd1c05dd4c51859f89582ddd256f167c8c145c61d6e09f259905779d04828dcfdf7a67e260b5e6466dfd819d33c69fe9b1cd6b726b074327147a633843f8119f54436ad005eb444f33c0b0d8f082c08b7a820fa89936a4e7d49c98bfae0e622eca22bdbe2027416e10323b93e0124c65a2941d4b53302a50df4c31579682457723670dc3a1fd96a2b8cadaf4a7e0db8448fda45c1dac9698381ff9a626221f1f828ae7e5c7e68faccac4a8f11901f86524657b25ada00e76999ca79c4ba2fab89388ecba3bf23203d2e6b2a9b6e275458963855386b9bb87c7c175f2dd43c662873f46be9d0eaedf03170b2d57951c92c491ca66ffb39d64acbc2742278ed5b0f7007843662b198f3e0edd644e663e9ff623d0190524949ce827edc93d42afabc93bbe33a7ab85df7bb146475ca1c5963a33f891f7e66181c288a68314dd81027dabbf034bcb699d1bf2321dec020258a57f5610432c98ff5d80f01220ef42d9304cd67f51a83e4c60c6f9cc6e815758a96589e41a3263191d75a49270b568c96537d57de8422a5354fcc22190039c53246bcfe508f0372c3ffb2cd6a40554d6b87770828ad7defd13901109ba4702b634e920c7ede994b15653a579aa1f3cda5c6c7a09c8e21358bbc6525603376787c6ba867b9e02e023483703428b60aeaf46173216a5bf71d87209152fa6ae30b6d966365aaafd660793caae4e166bd49cb3267adc28dd3d6474bbe59e2de99574261d31d58eacf58347d426ef24e59b64377e11060b5b6718eb1933c64a2852d7ad9953b1f5c3f3d4bd29604f598789d17560b84ee1ebc0ba61420631e2e797762ac3491c1819d28f0d955ae5ccd846638d8d3c10238f36c17fd51da38502c7a7432364e613a76ac526cd29345e6d1932a9178da21484dc951f6cfbb02ff3e57de74bebe101fee59964dade18b817c2282596e719ef9136d4cd7593a4007dce50f039bbf6898f00157a3d5780b734d1801dfc5e68dd1129672199eeb6bb751f308202ddbbf218d22cea2265c98b52ec343ccbbf9d9730f7c81dad843ac465a7cf2f5efe2cf2d9ccacfcab67508ce57ca29db161c475304a2e8afab8ed856e43018b98f66e626200e67faab8a9fa6f856724257f3c281a5c4ce50f5ccccb7b4aff46520ffd7f8eefbc84d8138cce28233c30fdbe10e34cc3e8ad0b7769d007e0d1c1d0999cc07227d4223227dbf9d8e0acb7420ac4041f1d6a734a742c3fdfeeb3ae8670c88bdcebae1d92fdb81acbe9a66779ae5c9817411d5ff91a003212b3f2a1615857d7d8ce175177c6598f5f06ca4693dbeacb3e8704ef20a22123192ee959ffd4a1fa8c137c658e2406e79e0496ec478a5b8997e83c719bd601803c6d85409d8a22bc75e88f89c69acdbedb76f8bb3524d82924ab5b15cac192cf0de35f14aab1496fab9db1ae13df35695190f50f37deecb76de0b4ffbb52af6ba00ca27784074b4b907ffabbe75b84d2ba655432edd2ce63721002f9a8161e1801e0ed78e283ec33824d1477cc58b606c6dbe99de59f03b0bc3bbfa5c1672576350c58ccfec782831be4526f10ab30697a2820d572c534acabb6864e0def5a1deefd5b5b3b602ad21eba45648eb918c64c4bb9d89a9350a713ccaf0f8729c8830d854632f43181f60052db971943059f96c7604643f0d5fa0da70712fa4a466a7ebd920fa33dbfad1eaac0686bf27fb7fb50fedd536421b8a5cfcc65a09897940c257b31c532fbee81267520e690e95960e589c76d92a566ca25c73830cca6d7b02c26b7aff58fe6301639b368407eb5f7ee6968809e0459fe8374e5f7b19afd9f984a963088906ef29adebc2fe35f0c36162aa890bde60a864b77e69353a49898433bb62a1c68374ea036181effefbea0a1f755cac89078be27a4ef2d776bda8671d04a9b29564ff316a1e514479c0ca616014d6c1dbf70b1390ce0e59f1bcb47a79b7c121334ac3d50f128dd8b256d12794f08cddb4ff32e049855f1ed303e32b1bbb81234167a9a33d4e24f995b6c021df5c09dbdd02a3db009c480edc7942d81fe0f54477e09b1b9e77e88a81c66edfda7cdf84bcbe5c12c656fd23fee2bf83f7f378c9cef41bf4cd3bae6b26447f05347746a061e03335d0c9aafadf67c77ef70d4097bed0c39a8d3252b294fe305718f0fa5190b38d5d4d07642c90aeb342a4805e7842e7dc915674084abac7d146d66faab2c23dd35b07ea11f9bc1eb88751e4120a14088f302daf1c58a3da90fb45a4a04e2ce54efdc00a8ef3920043092faa547f912e84eb2914946694fa5e49d0379d145d71b9f18056b96cc9c5c9c0de84fb173b258f38b5a1898bdc464b911d68b9aabfaeb65a78c610ca9b3c2067acea2194d3be956e5bbe25670b8d9e8396e16b25797db5979db3e7ad7bcd955298043dff0fc99d3da2de53bd07781c4a81b0b8ec79103a2a4fa349dd778af676d1ebdf20689fc790de2f539718b372449828b64c208e521051756db2e67e0c3e13dd4385cdc08e28bd77398b9f3d03b619c9865da5ac54d6e43c4791dc0e560f6a642de709a8275ad8621d48711715e80aa35ec38be066b35b405fb30a22210b8d09ff1a75fb0e55c9c2691fd799a38087a4f680657096e4b3deacac357190a796753f1f9463058df9c58d017f91fed3a563fb57636f9b633b13bbcf76f6631492335971118d26d8e97e448444f378e85a3a001327bb23554fb51e6fa6d1bc9d2782651831f14ee9e342fca6de33ea21d9e5c4230042bf6470014136c71ab40b3708b0f03e956aa60ba29e5c0693b36c7b59e2c752c6467238d3faa0fae994ce560063cbf535df0b2d3f8f71435b2ec711d8978baee6e976b2ab7546eea08672dc274679dd606169ce0e1e611983695524a8c2df5883c0494b452b5aaeda7faf7931e2a6760e6b3baf99ae7e2c637e84592f47affc02358dcbb21ba7c5b0dc454eab228368446ab6c797bce7ef9ebdbfefa12bc7b84a7166d5eb90900988bd8cdfc2ee5b48fa3537779767bac0ea35ba59055aacf38ebb761243538bde5e425762bb4dada708f39eca5b0fe2d8c49fca346cfb10b7e03b460a2bf91fbd732d20aa0171b654f9e0da9a5352d20d6e38a62409a1603d4f400521ce177a202c8ce6f77fab9745535fa6c4464263f4ff032bef794f76057663e51c3e505737dde21e05372c17ffeda2d423ec04a1a39a1a307aca8c9f6695df2affce92bc1b5976dfd477104a5d081fdd3d392a9edf173c6679c3dc8f6fd10f3a31930e63494d75a6516cdd714b32dcbc077c842ffd7f3534d5f94b703223c03fc37d6b0f9cec179433a4d9becb36016678b0784c0c950202adbf0372b1aaf86d06ac0ca6dafb4dad01767670d487246076a506189be14a2bb4f0bb051b41822ea2c061cfdd3cd7ef250dc266214f815a7faea600a4331a9f71b79b13913161e7f8505fdf948857e64376377c5f911b2cb6898c9b788bacab592f5b6173a760eeecafa656a4b6b186414498be8aa20709e4753f119539f6c0a20c5ae2bcb5ffb53798d8f5de29e532e4f28b3df29460309568eb8f141f9950f2775e9f4bea4692dd58662aebe6d61318bec8e6f321880264936401427ddfe4c9210cfcde0f43c90ab3cd41bc9ab238e9863e1e7de89d9e93de5b4f3b9a5ce66be672763b2b1fc9c68ca1bde8a43efa1afc0f4a8487041fe507ae472a5276aa5b69cd4d8b8f662056a60ea49df590664c81f2df60ef4a67cb882ea986f49dbde9564b9ef7c72e50026fe0cafb40c4ca59885205e0fe523d5d5405341691349fd32c96438626ca6e842d522d4b780fcda0f5b9d7e1277f36366f9aeb50a598239678a6a9d55c6b30f4d4376ef6edddab0de74c65772d0e92d7e4d097a915ba7eac90cf46e47ee43ef6cdbe35ef8a6e17dc0a320c4a2dc39d634264fac915985b4e189ee5758e3071019d12f57333a36751967a7d6cc4b2a12d7188402510a3b526dd652874898c5a8496e191e6c7b75b53b006493cf712e870439d93a9067bcded8831c8dcc52a36c423efc1f613d9c364f3fdfca40150725c1bb9590db4945ab5211c762509a88d44fa5117a033f42a78d6503c3e8e352b3278bd4f55444f94bc81280b350f3bd6abc69ac57723b3f4fa40b42c2c30dc4244f96f392761a44fb8129e1966bcf1b4a1dfc85fd62a7233a79adb3eebd843cc67e64e949c4663a514a23f36b77ec312a24c86e8fd4326e682957634685e75b5cb7d8d8d00a58ecadead9bc73dfc3f7de69436f76344c3c44d6825c40ffa95f82ea7f5504904a774fd1b7a9de99d5ad7aa3141251fb5cc21c47aef14f48677f81df4e21eaba9725974a2aa02433a8044f88cb8a6d1d949efd80fd03494fa1e8aedd8eb6add8c3b8eea8dee76e2b543d95f93210da5005f583736c94a85d25ccab42ca9f3c7ad1249aabd8a7cdcec3355f0d64934745b68504db8f859ee51df10c2f02b89fff885a1b6a7aac07ef5bbbabd96c3ba18cf2c127e353989ffe8cb1b496c59b30f187fe30faf7cb62ba0ac1a248d77fd8c6fbab7f783a5d5be4db25c98dde71dead516cf93cf27237ecaeef66071d9604a8d696fae229f66053f7e5d380ddf3b07abb9f18388b7329a148dcd229f3080c9418d3e4cb581f16f3be7ce0ebe570a129615d605fc9ca88fd60c0eff0db4bb1a72cd4307edaa29ea3a3cb1efaf4de7cfc1981c9151d3df99f534250efd93806e031b0fa6c65ee3569fe2c4414a2e57bf3a8cbb7578b8f405c234d428afe6c370230ad07a28b7764649066049537db100ca215ecc765cb1ad4639e693eff6e585ada1edfc7bb1860f4689c892de5a8bca4fee322eb2e3845f57d7575dc193454128862911a7928a14e6c8bc109f0a285f5060d66ac4a021804981eb628340effa803b4028f3956bf7a61e1ac4b7e7b606f4b2f123629f96dea3fff9a101b769bbd021cae8125b0621e08eac1908fabfb58a98dcd0e718352888c12ba9977df3a6f463b05b56005c333fbef3b71078ff33dfeb319439e71df0f0d97bfe2cc91c839991163305e552fa5b90fecdbd599c447c2ce33cc0941f10d5b865b9d751d08e6b58e189a42d5aff895aefce3d9ff933832e66ebe038227f390387b0741780e3eeb0c922af8d753946a6cb69b8112fe2053511e6d6cdebd1a7df4f7134a35709fa013bc64160dcc3d85dd59da0c2df47a6466fa32657825c80cad39c5622403ded45e5556b882e40fbc1817c96d9d16a015aae4493baf6787d4cf1d63774da7d2c6cb477a25b12738fb5e0d3a986afbfe85f0d25b9da09457a99cdb4fb85ed23540cf44d7b1820113bc21ab9c3a74f27346fc64ae2a8df341c254dc086efe1a582031c4cd308ec2f61458120181bba95d0eb597b90151d7a5388eef17bdd510004362cc5a7ac230129dbb063ca807a7051a149c8aed302aab691108e28c3e73eaf12a4fbd8e9d847fab14fef2062afa8db30932bcdefedba344911211ff12013eda6bc013f9f282aeb642b896785420a22ffa50de3621178c16194242f838ef23c12bde62e0ffa5d8ea82eb9236a2f4a0e93ca6044c8e87ce084f3d7dc20027bf34f3ea52663d65ab91aef6792ceda81e74f3bd5d24ee1094228c27e01f5960e11dc4fbe8985015a180ca741566ae77974111dd4fc686c9734cfd16f78caa642866f8f568c1fecbe921c38a51a761f8f0b3ea36f72a55ffe986574d0330e8c94d93dd835a4734258b1833dd64edd55d18a6847b1ae00667bbc0dc370afd445018a258196b2a0695fff270abad09046a6896ef18e10bde71ad7607d875ecd30a5461773d622cc47e6cc53cb041ca1097927b9d91c5f3c108cc04ae8d406357130acb27d53529903b5736e1c4e4e611982f6482d8a980c24739dd63fdfd9e50807541b52dbb116d1fef41946b974ee80751ada57506ae009447258996241db50b3baf59fa34d03e7b6fae0baf55e3bc8e07c7e8fd927eb2bcaf59741e335f9d5fcaf0389771113aacb4f46757935200266c2597bca511475814922074f3db51eec624585cbe6bef2ae561ba70d5851136b44124a0befa7039de0c39613b966ac1a61283abe4d4810805e41419317cde9be6a11a3d9228d0f81bc78802ca16d17d8ece60ee9d7c9cb2bf59731e2a2d52baabd7730028ab6cb48a39ad1e0b85f7d564854696cd073ccf9271fd0ae0360f78887dd03524a710ef53954fdc9161aa3a86454a40aecd761b4cc4c73c180d47a3c5e2a4753a789422fa985b20559aed5ebc9e99002d60c1d2f07797ccc36d074825b1d6bb71ed69ce009a4a7e818089a31aea793c09eb5b43154a88970a63cbcb4ea9a37bf8ed2afe13f0820882ff11d3f632bf01e5b014a70028c62e094e38173c2417d65bd287a701d4e231524b775ce2a3e6b7cb0937259607ae3a89257ded95be42d53782912c202169012c9ae47290f7f7004c40d430156c08bfaa51c6daa995e51a419eff3a5069d2ca95de87f52a6677fadc8f040df46036bc1d554c4bf9001bfcd8ffdc5407144f22a1b24253b84caa701f924fc1bd180d6853410679aaf7fb266c30b5c728ed9aa31e84618e81888ad302d4d97815a3bf95a1112d3bd40b6dc454593b1c24e9c49325417055326a74aadfdb7de20f1dc8efe0182050959015ac6b5c8c53b95786ccffaf2c8a246947b4e74b10eeba555b448c63788f73171139c07d5dc8aea20c7c99f9a77ac4abb70c59fe4b0a6d04b0db92bca37a8ce54db32d490e901f4060bede5723d39572f3cc51aa3dba659ae6d4a909e81c6313e451946ce97123fa142d61e30d6524693ec5880eacd9d8c1e173147791fb80911ae615f8c498cd336a8fed10d0993d09053948b07762f3db7de2798bcf8ff9901c7ef416ddaaf446f004ee709b4fb3eade7d71ef484f7eb10538a75efc5d7e9272bc221d8f976f099a33a973ca72f19b015a01bebb6e861a15d5cc19876968b17de0b2f9aa2369c30194925fa4312a24aaff9dca50424c7cf9e807fecb7827c6c634c14cab02b439a7e6e904b89ffff058215166592e0e26d1a0fb1a0b76d7d0f3c35faac57a3834fadf1fbc42a4ff3b4695ecdaa356f4a3fd947f2330f478cd49201668b22bb413e6087e35a8152598e299e9dedf833bd2054d8c7cfab3a09444e847e8f3f31eb9a40556386fa4fad0046eb77a1962ec5b7e5a42972f341a6f42f1e79b849126ff01acc565bba2d5e8dcbf79e818306b9b97541554ae2eba300fba5d6d03846f7f368a65e9bcddd5b2b8305b76cdcb47c076adbfc88a8e24b3944fa1a763b53df7a81b844a6a6d93c2a9cc24d552032d6f9a8577a3d835c1f448bca6e671c6cd2b27c933124203e8f74b55132b0ba8587d9ab02345f957c803b57eef4cf643be79250254a813786f2fe2814500a01d8eba31bd582cb506d40b265d47a5ca6580afccb119ba17ddcb265ab19228e2e16f0b152603428e0e660fc8d5029d2d383884e6f1271b29beb8a766d3b96816a8b53ef04ed2fba37bde012231db8800831faa7153a7129154c3cc2069b87dedf98a18882a32d1e1e2febdc631241312ed3100183264a5d965c7b3711e6cd357cfc4aa9ad935d02881405bb59db7063c12208c400164b23a3729a96236632951296ee7d3b0358b2569fa26c0ad1902f085f8f488167a3d806638ea2973d363beaf0e17af23c30b742b2342251bfdeab0be602494590971cad650f005e80792447984accf7722107310b16a32e1c1c820025c9d0bc76097f007b00045f018dbbf4359484a3a7c56e7f63f1c55d9e4aebb099f93720b4fde137fa1a8214e716c69dfe64f4a3b57d654b8ae902cdd5b402ced74ba0f91fe9c0c1af7820135497ae021d0a366e0e3f92feac5ef6675fe479ae402b663338bd4071cb8b99d3a09b6719118cc3e2635e7804418e8f862ff904e091794b78158b70f1cf0d608fc4609d5dd1b6012dc3f7a32618b63b81aeed2de216946c749ac78353fe3cff19fc0411205d2a43cbf8b29b18ce64c7e76216e459bb500e15612c6f05f7fd1be01d3195fbbd686789d529721166e8ae5f7a888357047893e52bdb8f7b758dbfd507ce009e925d5ff8dcfb5a565df06d35a12ad47c00a54bfd41efafccb9a6202e5e960060e2fda5b557973563480bc6e755116306438b150b41ef3c454afc061df350310c9f021e9e6098ac957fd9ab21a2ea2103dd0afaab398cb55846a9222d0be4d7eb4214c9773c475dd8670e247392cb550b0ffc91d68568a53ab4d9923f6bef84c627af80fc36d1ea79b2d9a324fbfc98ed1c624db7620a3ff7fa1eedec32b16d8f2e401950d0c01abef186c6aacf92137ebfd177d7da83bff8fedc8e6edd6137c16209d0a6787a4c3ec15d9626146bb4980da1b08096c144e07135ead145d27bde41c8eb7c01d1c49f92daa44445ec0f3a811ee30b70cb320538c0c2f6fc69350bcd69375a81684680f26a9d5284f73a0731df2488cfd62f9e28a3a69b599da3dab0399e198eb0124eb4ef65033533cda10581572e7e5a4e543c4d2deb1271d1c436738aeaa333ea949d66bea5753d55cb4423e8fc255d49f2416aeaabf1400792fc00c7cff416bdd76c7ff877b32cfa86f9ac788ac033b7e08629d54bb43f4112d5e9ea0e82531c70e3a86c95deb73cd47a82d8b57a43e22e2f9e284eef2d543a3be12a5fb631067dcc8996ec4fd711ea81fd5fb9a67eba8bb76bda89b74ed1e98ad23a02b4edd9f79a0d9e40c26c27dd0ff978ca60464c16b369c794e4109b83ee901a8e7d8cade8538f341ef93728d55a72eb46876581f6a91c3837f7f1b06eec66f22ccbf360c7093738ce5f989f029cebfd3cca6a778f5d3e29b59011a0c1d60b4da91014bc55f64c05f3bb9a4736c53715da9d62500362d4dc49fe3e438a2d8464a6a252110343422830ef3d3958613d29612e7fb024cdd5cb789deb26f1f7270b64a38f1166a9117c1130e7d3849cd5cb975b81418f7d9d551cbdc8c93a3d6a74fbeea0cd7bff47af47775ebb3e70b09e9cf9373911366acda1a2ff3141c3f9a7153efa8ece2be3c22596bb1ab14df31182193a60678fb40afed9137372d1231bdb799730660d34ef2a697b7ebd026485f9ea6762fbb241182516ef10181223438c2282de7b3935b875c53889bb4ba746714d21f7f08c75bf20b9e5da21dfc0e2f102860539547502d217e8defd6b31b0c34aaeb9975ccc2bcb07d9f7e1a2d379608e59e0a61488f5a3f450d3bed8bd8f7111b4f3fd79860c6acdb50f911c0af34417a852dbe02793330b0acb67e2d948820016c049c8796d7c8989a1aa7c8eb88f0f332f2215a0fa0613b0b09501c0bd328cd4213eff3f3d37c2311f2937da7d6397219f6839acc0e1945d5e51cd6b5ff98e6a726591301ad8a7a39840d63ae9f41fd79f8ff68e577a8074e047b35d5ddaa768a8647e2104ef155618272035ce52ac2491c523c25d3f4a300c000e54a72908c1092305d1257d5acc0354e28aac5d9806a21227e8ae89f7210aca54723338a83ae57226f534b102da8a6fed83456e28c7bb829db94671915198a63de9f3736b3b8bfd0cf4db591a0d598d8085f16996ec3bfbd8449e0c2fd86f95ebaadf77b7ce6101bd95e98df68921144cb516a70f13996c4c1842622738d671643b4ba1525bc8c7f1118f7a20e5aa9b6ee9a9fad41f9568794984584634e29c4ed679e84cf38fcc3264ca136b1b00eb2e3379e153d88724269a8883cedbc3a0e4e8e9f598f178df16fbcdb0621dff0bdde952d8c0d67d1ec1e8c0ba728f8fe312310a54f4fe26b54ed2a2c278f69b02a2cd9b3c6a2b4323e4056d8e53dd2f8218c4489172a60fc59e3b994994410758d83cc70fe27cea532d0464037fe3940549ca3600d6c64e938e90dc03cec723d0acb6585fce33db384de9d5150032f3489298129b434f6687192215deda06dfbc61c4e0e6ba84c5ec76b51aa442e5873fe943dbd0e6a3ea4da2da477323b2cb3d1e28dd39097ddebd01d7bc29c16a62eca8ecb3b650c4ea57363ed7bd25014202a749a41f3d6431b6cd8951ee0402a03c2a81afe6a0de2cea133c438a5f5138932fc014b9b471382023452c2a6b6ed3e5ac5293f732a3e47a10a444dbb33e32e4c88b9dfc5876a4dd648d899754135d290322d713b0525a0d9eb68331d0620fc8c1bec9008e3023581637c27f5105599ec60a9a38c8e6572016191f9f747e5bda7801688c617952dea00f50d59262dfd60f4712b55d41f476b08553b971c9b0eafa9484bd764d79974d91659037f5ec075ae64337c472010f3cd36377828ecefbda74f480b118fe8c02b870181f7656ee4ef9661a6895cc3047e598723cff13f0ad3061bdebc20b8639ca658271b570caca8f8cccf93905f54b13c3df8a04859b7b126d0366d4bdcb64e0b2432bb2787b73aa55c5e920ea0a28de0e510249cbc28d18f49da6e0c7dfd4456b4fb53dd9a46e9075a85694492c228a0256ccab133bf2958b3efefa0e31ab3c54ff348e7da7e497ae1ddbf7d937e4d51d20c33c25114c74f073b917a2e6d66ce732c8f5e4842f2bf3b69d0aafdc34c7d953b9c4431547ac58a55b76e4748d94a3c8ffba164654fbe073fa03c1d4838d33b5f5c974399f589473fdc5a345687ea697f4529a6249bcfea30375217131ddb4aa1b68965ffbeffd1215635b82db590d136b6c903afe5e9f549b5840acd7df121dcb02261ea94c1b63d506599b8667ccd62feb1b1bb2badfe54f79d661a66e4da4a7cf9bdc02378900e2645f618d0e17f6d52b8d698f36e2bcaa86aba9e87d186524b260887c6a73207416ee26f05c114012357da0fc8e486231614240685ce2889033721d42f5a32f125e77b098bc1374a6e24bb562a963b03e5afc0c7a22cce27e5324e01018cccd9e1106869adfcdc626ec8f41081a0bb6204b6fb459949391430d4e448d0e1d8e3ea1bd6734071d6ea11f232a0320c4f24f1281e8faeade4d9b8d0c51253108f11d61e5f13d4a7d90ed7cb2f9d75c200d7751a4e1e96ab9f07c72be0f3ce7c180f3d8cc66addae8d744c33740cb5b220ae3b60fc6973e393c489f09ee78793a100de696bd163690c5b1c502ddc2ff7148a3146a478553659e04ec43230ca45470cc4b2d20ce974e0db33045ccc678604f8cbaecbccff26f5073e4638e4ee1696d00211098127d89075480a634f27ba216a726c1bc37db8928246f5327c84fc9242d583e144b099414702fe6f62e4e61c5e8c2e36efbff38d32e0efba37806e34d9d5bfb8fa558559aeed32473d058aaa6bee42821893eae98886f76e36bdd6b6f8502d0468140892f415ae64d59e672c454cfcfe17b295448f2e43cc63fc20ed018646e5a8acbbdfc8df345a3b0e89d2ab37a77400333990813ddbad5a5c9d2c5b844a059163335fabd3ccda8110b7caf1613600b41f4740eab3f9301d39f02d498c0fd0640721886c747bc6ddaabdb77a64f536b5196c6b78e396778eeb63d1b24999fe4ba514b7535277cba99b5475b920e4ea840216936062a2e675cd9215ed9fa00e2486faee79d5051762716aa3336106b8b4cc756f77a529f785ed6ea58a8bcbb616c4c75282163e1c42cdd11cbb3eb39b3e3845efa1d2ae0c48ef4c6736eacb5e94b6d330d4e5f5cc01e71310967d9f867557bd51951cd93fa3d493d2e568917617ba6b80b586edf8fdb5eeb475b1b87ed92eebe71eb44674ac1a8353fcfaa83eda6a410530e1e81ebb2da592fb90fba8c0b1af84a10a00541fd69a2f61309c3f2946a91817564ffe6ba0e9da430ad02529d5e3f63807a30585d5c22cc52fd0c7cd0e005957dbd2a4894604920f125668e93e7f9810117d039d32f27e26a6582138ed79a8c9f638bc03989a7cdde4a9a7305da231fa14577d369dca10f117cd2e8bd8381cbf9c5598e90af0067eb80ece61ff90dbb1e05e2e88a8637dd0a244bdc620c1521c4416bb1b3ee9241ed59d8252bb85fd0ea053935db7fd5456839ad264a9025019fc627e8f025866ef7fa6b99f7cc3c9ea7f6f8d4e6de9db3eacb9146fff0796ae83dc7949db03ef7415f4da86ace379c663b45543bf4d5303e2bd00a99e7c52d71c3c5fd9b1a951bd5fa75f065742053190ae41320e4fc58585104a1fd9fbf87c99d313a1a802af201815a7e575cfa0023b0337e5edc500cefcdc74ac4c513cbd2c33b1101f15590e9edff6c470c499f6161a021e8d17304b9cac03b265355a03612a7c2205d4394016239aeddf8c08d6727bcdd139c28781ad49e7d84a8b9aa9512760c5fa16cfa72ae2c9514494b65936792e39595fae2c358b09fbfe53068d555b45c93d8e713b25193beb17d028f26d63f200f29dafbaf6d70b16c58b441d07395556ddc8b392dbe59c1f6c4bf8b3c97b80c27e759e5c18e3a2a9e93b6cc320aafb98fa33cd5f3eb392d02ed7c202a41f9327483cad893cc747fbd709df2e1ea177e8a8145ba972e032947f495fb3ecfda452baeb619146e9b98ae6809a26b1511f9e7936098c0281e30f234aa31b22c20d1163e8392d3df730723aca769246dd1d20a93fb99147f198f9a0394f667445f403781e1ff7a63ec96a3cbb18c095af68e7ce737a3583564d0b944ed4b574de4c9e1fc91bdaf92e347fbc7b3d013a216278b9a896fd6c3a0bda0445b3bdc95803cad44c56b46b2ba7cb523f8b2a5e0393b3fea838729306d8dca3dc7436b30d293ecb25d023a66a6dc2701ad8aaf8abf29a2748aecc750673fcf6fb37403ddf26de5755e3aa76338e4009dcc10b1ebd9ee8614d25ae1f8b2d1f927995e57385f9679c6b3de2aca5bdcfc8c2b53e5568d2a5aa746ec852370fcbab60c0092465688cc636f5055fecf7cd39ec2b7a3186e46c708e9d65f7374f1234d5ea05e4faf23e2d764c9b7fec465f868500b60a6deabe0bd8fa2e1c46ac4dbfbf60eff81e5e84673d352b38c99992dc331948df2dd6bde8f4257d26b36ff98dddaa729eb377bef47299d6982e786c62c1e3886611ecb4e5991b77bd26f85b232e50234b7b9c4f34add0a2650d2bf3178c6eb0e74a457d4b4dd1104d69dd16096a04e9a2c8a0933e131579605c151639266a276abe8d95ba1b069b5c313e9e7abeed3f7ef2b4f9e1ca8edadb2126f5f44de128aad22041cffa6bc92f4354b2bc61efccda928acabed6528a74802b34305701794d6881a2faea1320e5fcf9e7fab3257316911aaaab32a2377bfb30e94f235f5072528ed2a3c9f42ecf065a63516101c0d0129914320862f94c8160fd470acbc346bff21659c4bf976deb5a7b590b7246788b5754933e138d10b97cfa2cdac88710351fbb46d34c54097ff85f79811c49752dbb95c4b01351d1657344a1a56c34bbd5102d7a7ffc01e84a929fde9c2be6e3a1d9da8ed2eff5e70212ad65a85b23b68c9ec113b51c75636af908e0d90e7a9bd1be590261c0830dfb9611800c3732c83f1af872197e54d059f21b570cb6218062d1a7966dd5dc8be83243a26605f68afb80030a3312441ba3ef26c3a33b244aed8abafc7b4ebc81f4a9c5e5bfce093d27e7149921445a1c23f93bcad7a9eb12b1ddbd66d537f996c447e44f8a0bea531243280e004fbe30d9672d9920544bbfbd37d949c13b107ca3d9285464a05cd664f7a34f700db93fddf28279150751c5d978028acd512f03d08d0f280aef5e178387f211282af3a9b6edd14b9bfffe5b207f0b07eda16105e4737fa075a4b7f336e78b77c12f451ada7410415bcb7427296b1bbf75cb13b7f003f4287349489f70d95da56c21340b66595e978dc944ec20eb0a5d9d3ae803c007b35d9c5b8deeb59d101a383d4a95e47a357c2e2ee5a730109b9f9d4c6010b2552d834fa68cab212e4b160350d73ccc6be3b806e577bb980356c254b6f28fb026a1684436712ed71f3d9b3aa564ce5e28893ea29c5b1049f0beb68dad8b8c91a1f099b11fdda3e0248d5cd72079926cd8cfa7ace7bd59d0d4b89a3ed94fd9cf10c6a44ca90c29180bfe85dfa945b41e260a4bcc19e7e8fcfed94c897f0e0492dddbcbd2affde25d2731c758ad4518a3e1533ce4f53ec638b86986c2897e5c3000a2c9a9ca1b1265f8a2031020bebcaaf873cbf6dd42990eccd4a60458d7db03be0f52589747d0aafe20c0000b99142443dbe485ec8257208092d45d12a3fd673a0aa36b126eeb1fc6b91fbe8a458754e371a6ad53a8d40c8be39a9ca94d4f06ff09a15e1bc862b54095821ddd319d687c78bcbf7447a1df49416b3c7974fb94a5f5f782cbe5e181ce861808c102d934403a70b6e0c23c6c700ba781117d8ed3293affb9e97d245fc13f17aa46281fb1daed88505f4943995312f29f2f600e6ad03084fb00b4609834f779b7482e07e475a1d215d174d390ff7bae78916441cb6855d01462bf85a5f34dda208cabbb2c3af10b702cf7ba20e798fa95c8a96a6c265fc213b12145d3000c2728c4eb6b1ed128d685901bf2b5255d749825182d03eedd69d58f8893e91fc69ff30615a2d7ceb9de1621707d42ac6ca7b454d26c28e87e500696ef509b519eacf5d4490acaed1ea3f5703fdd8cbe220e8e903c1fee714961247214486139e88bac8ae58f80debe8a07752d7f2f42908fecf5357d000483aadbbaf4f380c239975bcaeb7e61ba2f6f826a7affbc876ea2e9d367429951198198b92bf8e14d9d94d2dd8ecd140887553437e3d2add7d56b7dde010fc5bdee950dc4561d9e6cbb3bb70097d81da4666b0e0873b09ccc6fb213287eb02b97708a4784078dce4f982c2056185411288ed12ffe43ee362ab4874b1a113924c3eff75aa22b8fed07a7c1433328e942ae6a1997bc056418f0b56bbfbdb56bc33dc081c80f0e27210884d6ba7ad91807105c51eb5716e4e81769cea66fa4e44e248a10fafae6237221d3b8b9cc5437589095b4b8980c1c36e0e94f6607393add98a0517e27bffc0c8c56bc2956841d74a9e8ae5481c6374ec18707c10972ed7afa25305d6cef3a249daad5dc91680aa83f40f5bd89e44477aecfaea89c1956031e85e16aeaf6f536330410255f1ad29c09005b0cb58a32d8381b1dbab6f03981f8bc325a63e180207f2ef19f5d1efa19395951b71a1ef585885a069721c4aa5ab80f8635165d2783f9f33c38bbca4501336e6cac3eba6c5d4671b99fc7c50ac5b6d50d56a3025a3c33faed6de5e1cbf8d531de989a854fdd5361f7205a7edfdc936172406a5f5e553c1e1afecdf7da3e0430f1b8387c343136f9f30d16cef24e3c1f5551f2d24b87f586345442698826db30c9f945b4150dceb282baa12df7c122c7f76cdca74ce9cbc44e5cd7240e04c32c5226d9e6b16f983420bb40bcd3c5ee4df1c13462f3dc095b20d8f9155d93f5f43770d7fad16fc2701ad8925e21f691c63d2481fe2f7c922ccfcbc639390c5a59d49314377bae06b883220fd53dbbf7a5061c73fdfa9734e59c4598cb2b01004c16aa7a5fec533b773d36f00748e5dcbbec519ba1c399c019ea2bfeca81e0e1050d1cc716969b5e896495583f22768acc8c6586d31f4262091aad1436037873b9461640fd854adfed7e4c1a888275108dc720a0a63eb800136f2f72881cdcf307ef38cf40b0024e5cf2901d7e451c9615939ba14f83e977716d2f025c47a07d2d7aa563fb0cb272a804b6425925911421d79afd343eeb5c3b8f88ea65b19d2fdaabd04285447088168aff9a59c73f599f932c8936ffb44a09ab090f0614c87a1122f8154208c93cf63b97735ec1b311b3afc649bd1441ec633676763df69219a8b765f5c24d9a99a695b229a40e02a57d408b381bba50ce7dd220078ac595a7703035bd359177164ecaa35f52ba5f24a23cf73dcbaadb0f6b344d64b3146ad7a180d38350a2538b5abffb259e19ed44dbbdae1e0c2dddc4dc1676d29fa9f40a597336a4608b2ae9cd29783db25d2986dbe990db3bf98e020af9100d5ff8c95532f9d4ba47bdd6954d6c492b7d4dcf058e64d93b0e61209dff8492ad5bed47873c9f8a4bf903fdaf70a80e72ab0887e3c94a0c7c439993bc5db47984a88f34b06fc24aa5608fe22cee80cd908c74cd3187726e08b031253d4fb169f461b02142f23b907fcb86e0709ca8cb1afbe216ce24622c0498d9445d02e57e83278a820d16d8b651bc2c67dc48393804de38cd4f9a280383940b0333f1db13ed444ec304fd57e91a0aba2d74e04df17b91127c35044fb5428cc460506a42d8eb74c0b48119432b39828aaef0d2e8e1d57459994e158683d543b0dfef902d4f47ae65df87a69f5b2902754d582e678169b570d7e81eeffd554cab087ed1a04070e1c2b883f9cef3c63afaca939b90c048e08e23bf58331c20644610eb25a22fc9ef25e4d553b0bb2d5cb54ffc587b2bb0f45b0fcfb72ea98c4b363cb76a7376abf5f1d9c6fc56531c00f877955504c1c24631b1a14e11df1a0f008d88369904b36609c737f1b8c16c96316fc3e27e6a35bd98e38fd694458b738e190d5fca7fd435929063a9220323d760bc5d417d196b4aa46679cd7592087b4d024006a56f71376fe34005a69d66a70bf9026616ecfba59420cddf35fab4f24f1ec2a53caef66e714135d343a825b9176c4b989a046406fb6f90361581ef9ad8329cd2f61ede9001a2399c5acf36ba9ec234936c07e529ca2bd83a59df20a66c4eed0d3cd918eee679f999bdd6734059d90b8b97eb0b987e90545ac0fdb876fbc88432ca89ac6fb81150dc71e9a42568d7e04c177481a06759aefccda6af42ad4cd421580c23750533d4a28cf2a3a445854d7cb98ee3cec4aacfde6447b83fb8bf6b20d05ec7a9607f93c87f97a35d454e984ec2cf6b61ccd8693f21d67bdbde0c1cbef35f8a13a99b3953f0f5b543f3472ab4b76a4366f84b66e936ce586628a41a9021fdfe49c8f634219d8c1b24dce6bd1a6b15a7fdebb84a097763421c10e65731eedaf3604d39dc48787e694ff8cf3d6f6e04a4db26617a176e031fb2bbe559c33ff39399252d8568859228ae3d09032d2baeee5e5d287fbeda69d491e79b165d7875f91c87c456ae641636b52b33dccb4b226c01d6e361420ffa27a46b5291d31cfb5a196684e50fb6f47e1a88ec550775c40ffc9c05545d9105a3219ef1eb620dd4e68c6c24f78aa44174d9ae05a3afe7738b40c2ccdee069f81ea883e66331627860a1e2c861997af18a1a2d1948e29dad40dafdc2bf1a85e8831beb4f1d2f8e31d4e8c3f2e25086952152d5f866e7e4289d6f6aff2a7fcaf8e5ac39025040f7bd8b4a2c8e14840b71acfa08aeba1409b68bcd9bf814bf09960c73d512e3eccba5670a382035747bfe8a39a6274b091df6f3c79ac3c119f98947ae10fccfd64b7b7b7de9f565e4a74081759874d772ebc97d598dcf3d5f12bf0ec10d98bdba229c5614cd5184633b36b791bc68420c56af1bf5fdd87eb5a777bb955a1642ba08a50558aa675b66784fa4bdd671cb694073ee38e2f742f36d51e1b192bb610ef711df595f57d875015aaf9abf00d3cfcb51e7d2e8d89efe14e02fd1b9584d324634975804904ba86a64738e653b447018492de3718a6bb7658d24f725e4aa095512df23df782e03576115a708ff1cebb8a59bd627b923cbaa714ad4ac87309395a602691ace25fd0eaa5e84f1add6fd36fc8c2b869ca19ed3e909e3c41f425d36d7e38ebbea1c5af8a7c4afa51a2cc330884a96b075e0d6e8138a004852f0b6fd39f80b1277eeb957c67da3ee803b3ca5981c315003b765852a7c266a53f9518648e6ded0ab9e2c1c112c7b76f43bf098eef846d2bd417451ec50629d158cd7bb8ba7c02919318d2b3b77ad1437bc0b591f1cb376ddb084d03dcbc49c8bf8078b7af363a8d88faceeac83b9b92c059e4fa00472f5fb22fc654de569fabcbcf5f5a3bf4dff0d4f402e31ee7490aa3b8ed28e9b8af2632d8364583b6e5572f390a6195ad7f8a852fa3ead5e68183c1e7e7bf0e00a37838eef90c90473c0ec0307af6f710172b341285214a54e35f228d215f88950737b6f8d5e3aaf97c6c03ddabadb60167a5df4ebc0c5221e78f4211e62314af0b41b7e4e8941c26460a721e5f55a8d910515ed9e0fd384749aadfeeee79b8e3ecaadfe051314483701b6ec1731416eb4c785115ef99635025513c550eaa092e704d422c0aad7555e9eb5d852ac696c5f4677212ba6739df7343be74ee318226828f7220223bf95e906ba14ca210c4b068a6d00c17d7c70b2488c71186936fbd7b199cc82c50b8f1c9d152b24c48dc8027266a0895db52f33280b157208b40fd99331ded6e67140645e17ced11c81a561cfd4f6c6603b6e75ae41e7943ee0a40f8cd86f8ed1e7f1a39ce5971d2c418c91df17543d1b7fe99afec452841604f3896280f73673d35aebc057125d2135c6d5d6e9eaacf1f09f2555eb138919086bf1126a8ea4e107f462c162d0b190de97d5f1911e8acdb5a13924851aad451250af27c66afc9f497ffb88591b764db603fcc075574a2230a5bf9c6efa0b75c554e1cb3d8af3572d1541206919319bd5d9445b5b575fd026367d5e2e6bae6d7b4da094b4aa7bb3114c7d057f52f451bd3a959100c9838502c0bb1d783bfa12c9d25415a1483426ed46d4c3ad93f6d914a09ff0399335b7a7b474a79ee3a1154dcd403ea3fe57c1cf52e8c43eb22a16bcf36f6366325bb4bef5a22432effd29e7c74f11398e51133d33b1c56057dac5961432000c8803f8801efcbac5db57b8eda2e8e371e3ee2494f7e1553553fd41c17dea56179906cb5c651b274cc12eb0d7bbb51481de7e849e070011a9de7466b92e8ed04d02c3ad0a96251574dad876290f578e33272e0458a421a069709a382779f539f727b830ad9a166ae7097b5285a2127869b7bd2e3ab2d56286d948dfb13b5ec921e9759990f7a92a385e4d1423feca0353f8d616127a6b89703cfda19efb418619342d10033cafa93a1d71f2a6aa81c83e90f9b3009a6f210aef4586eb5578dc7193cb92e831ab76e35653e3ee70d4840c847a76639810382a8f0116c865654b9ef110d9987f85d7ead3dde3897d4b65a5aa05a6000493cbd14facc3947630c14a5d3787518405f49400fd973d7d19365c5d5fde9c808d288226d767682488ebe78fa2df6b3f56969c79781e93e84e5125060423bd2f5d09118a0a86389bca03a2f5a0bc946c90a9883f795352b52a45745796faf7e93e81b429d6c110017ecb21e9db437ada260fcf11853f7d799cadd2edcd12dcc245085ca1bc91ee6c4f4bc3fab6227751174b43c5dc782158313b3112aa122a3985e01bf5a74b82b94c093392a0d99fee62e4523f81ae766ab2a832e52bc45b6dd2df5d9570175d5f70435be90237815f0dbc753c71dfac7c52d189a6399625a8fc20180d0382abed620027155bd05d53ca7895d5567ac9167d5e32e8c63c1193f79cda8897fccf3acce4ab69a8434d2b6c6d7600a8b21fa8c80aeb2abb2cff7f357650fe632d8cdcd9d89508b692d31a23c86833143ee7c22d1f6107ba6ed2809760046525046c035770d891568e95fdf78836f0eb487e468801e771035f8a5357e21f40be7d95adeeecfec5778f832b15f940e12cf4991c5ba6428b0b3bc964b019ddf46a8840867be579213ed704c6e0f19f069ef7faa6a3078b1a98344b572f1b583679f9c7956b7b42b6827e264cd31187e8d826d01becee866d357b09429ac5c083d82271e4fc5161c49597bd7b22eda360dffe0183a0b4f234e7979ef211fb4881929207e54f73b60888d807f85a2126ab79771d75c163104940438d81e391994b3dcbc2b93123db1811109c816ac6a93ce3b089fe0abab9d30330edb89e4aa9446950a92231de58a12f10eb915ac358f37c877102339b883921e4a3373865fc1c1ced771fda24f7a28e3707e8bd1cd36adf1c3d8c8ab39843dc02c3d1dead9a6c2f8b5f107d5ce4d130747463c2834bee6ca3fa4ad526b0165623279f3ca0bba49043d3d7f25ca84c029f47436ed45400626c02d6c752a8ec4d8c5e4f269c1a529957d86d632f2c24a734460f2c7d67e9ac6a407d8133502ce7d500c230923c82979dd69bf593b971ce679d561a066cecfa8476e89f75a2365276867118aba51a4a72921f9d84729b5ac99aa67e071a041557e6bfd4fcc879e03bf935c5672a28f1623f73a06c9e1bdaccc22fd4fbade9cf34cf8df46a34e6be31c1eaafc70919eecdeacefb17227ddaa05c36794f67aa432e8dcc1675d99642f46a522518db9d1a313e409378956966c0b7307ecbaab5a1519445f438f3cf50f61ae059738a613959d28dee2102fd6b804b6f4c9e61e1c0347e4a3379550e6f32d7c9597a495c41b57f08c49ace79fd54954bef3acd475a5486e2aff6f72966ceaec7336dd5d2618cae5ac78ae1a204e5ff30a65cfbfd25a7944945e1538ac1d2e1304ecb7db3c6181a7fc00b99362e5bd83efba4872262f16cdcb45ce758974f03e7af0b49373589deeb596f5ee8309ecd77cc8e47cd477758feff3c88d8b13fc30da33a5b9603364c804c620e9b3482b61da26f194fed012011c0d48e1c8b75f2b82329467d9ed3e58eb294e355041292fa39ff01d745d31e1c8db95eebff4084b38c76d56fc12fbfeee292f273e587d1f2a18088dc756f738d76878827b8d8a5d2556f7420c3e83db4b42a508f25845cd986938f349bf63fc2d3646a5b370eb93947c618286d286a7624cd185a0bbcbf74583d7141a602aa3bcc81e453f1a0f29c7ed1f97307034da51153b917ccb3186676b1598e01988816053d0fe304ab70e872828d5fec963aa24bf26552f3db28cbe38e853a1e09be52e10d9364cbc5e1a6170383347dea199d18af99fe33eff4cf1fa42556bee86fd73b49b61e68623c0ae7a4358761fd25f832250978e6cae4c5f86fd93a188764b51318abb3ba0d6a01149448f228fe24591a741807773c44206c6770f18ef4d058c92dc1d3f994fea4b67082c371709d896069a9569a5fc0cedff91bc71cf7dfbaf1c56b1ed89d56ebea796db8315d402b24901d5b27fc59334bab85b2a9fd28e24b3c4e7bb996bc3d701411cbb5e902d64843b6899b5a8e8f3baf4a107555ed8ef17a5be0d922d247029f3c4cb341107093771d85b7454de38758afb182ee5340c2ac255833a0f72bb3c8ea939989fdf17fa3b79648e8018dadbcd9aa4686915014f91873cb7f61aa465c2a762acefa2441cc778ad00b44f9e7c0a18929cc47c339ace57353dadceebf52274dd24bffc05b65c6459c50bc7344c023fc5f8a935324ca5e828f33af54cbea5c161861c03c7f09623ef2808f52200f3f0c6e3f496e071e9a319ae9a9731e7167030e1f7df53c2d8ad15fb32515d355330135afbb49fec793c761e38e5c0ca6fd9274f6bae0bd5e585eecdd57d1187358c6607e19fd662aafed9fb026afac4c48dd89905b6ee885e0e2ab1bf6c4496805dfecc2a2a3d5c20475257e5e798025eb0e5c2ea6634d1a0123f275871f8f0d1e12b19b883719547aae15950c08f81fecbf346b8a1d9d0384cc9d800cc605b30c9159de6447a3df9997c3fdcf15a5641e8086d8efce5663681a0a574242dde69728dab12caffe4bc08bdcffcdda979a8adccba8a8d45a67bdda5aa4fbc1d303df816947113b00eb2d0127ac2eadd1e4f3b01e52b5cb5bfeaa59bbb6ddb695389f770728653b944c986fd3d556c88434ba20892b108cced435922edd434d275a1d1902906246941207f5e35356012c77c331dd875238882f0edf5f1cd9bdb481756830e816a97831ba041a0b8cdc21191abbe9a34f7bf3db1b0a8eb777de706b8c4c82db2579d96598f1a6d628e80a1a27e63a62ca768c6cdacdf7845f06795041fac41043278a46cf44350b38d29494192ae2595d62c4b864c0eda36c679e70a9b1fc5acaaced71dfbd623a76c4da57e423878855fd2942db44ee949f74bcca6f394777fcfc2d4de4b76213d1ba1d51389f5e370793f491e971dbc0367f9d7839eb6eaf6764d5acdeadddee2ac6b87b2b73d007ea40db5b42207c4a332a5abd60d3d31073e6fce381bc1a7a67f7617e750ccf9c635bc772fd396e311877e4652f6469e4e16525d8980eede85ca3fd10c7d2b7219ea2c27b14dd4850e5acb850efedb7c009df6dc69dfdaa67917ac9c86aba4a85bdcb4648e5bf7eecd6dcc2e2856bc2a37551a41c426f58e4adeb5672a621772aa12f91d9c613eaffe42c19b5c51ef863e3428bd87a35800555bf638689cc21c2c948bf44d3ae5572ef52af1b50b6d2807b7c1d0194e73edfd0e32bea05b8a758ab8a745065ea4dd027d6e6bbce072c73e87cc318ee0efe56c5cc219215f46adf300503687a03903e22240bcadefaef5c2a97783e0817d14346960bd9eb43beb23ad864468b55c801ac1456c0b7275659ce61cce16ccd625b82022a08e4abf81a27fd7c2ee5bb4d0d79d7f1735c8718c39593c1f50c4d60bb85ec8edfa269a6382599b368534bcb80435bbfc68463d50f2ef577d3387d3423477170b2b298742fd5d730140b665915cb1a1581f82ff741900b48e1ddacf0642cf515f60f82f0676cc90b445d83805ba42bfc71fabbbd657a5210b797f2cefd71ed500e87b754b7b2fcde470f4fa5caa26d2223a5aefd569cfdcc8fa92b7548d2367351bfeb63a295a0df704852d11fb6c097d1fba4260317ef748c97c61f2962f1c5c1a85b59c72ed4354ec434ebd2565b8a21ba354ee6ed03ffc63b1209c112bd753f1cd026399976043f33e04060aa006ad7198ec0dd607f7ecd2b3570c4abc25322b8d0c603e30c556bd994637a616721aceaaa1ee70a18e8eedd76f6de14218ba547f3f930b0b7894622a07e0abfd92811b388a6c62bda92ac013afd4f0ce9414a4fa462a3398bdbc2f241bf40457472b756d83e9adbd33a212838b5067fce2c6f4d134b14a8b543d6a11b5532674d5be9a60a90facfdbaf622c367070d9f37ce5bb55404a83469388b6e61ca9474bfde39026c89c371b92054420d426a76592398628c82c5b18dc72bdb917cbedca447b04e13be11d62dd338fb97c980f1867b4edb27e879ae07a91f0172e7c015cab291a5a9e22e5f0bd4b806f983120fff1f2cd9344a3c3faa07e4231554fd5694f7a7b2e8725c994dff46a383011f4e0f5a387dc2eb911f8803e42e5c0986e95c511d49f37a2d2a5bc6295a1533b433f4d00c756ae6e4bb79de17bfe436d1c6ceb63e62d2aa53a8b2ba645f7ae7cbff99dde0c5e7aba7aa56157154038f0c4ddbd2558e735a3aab4c784587375fb09c7d2cb379dfc4b0788faaccfd5a843d5801fa1da99af34b455eb9fea9b246d0c7cda6594219c989950a418530068a6c3b74cf3fd83e5694f447dcc5bf2b8cefe84e33dfb7e427a9a1ff0ab60f82433017f9b87d5421fd03a9a8a8e3acde1e7fc2ee5c6673fbf9f0db0a42ebe63db88bd15d8acac792e38f40ba3c2a25ff8fb25b43bbbeb759d74676056bdcc42e434723c8384dcb081f603cc1e5f1436ea2209febac2beb2ddf4e1f286fb28e9e0db3dc52bdaa58358d028750e927f7d131de21a7c675a435f034b9a6560c0820bc9e28b251c0612bdc82b56f47a52d324c86d3b40df8386c0d08795561b383944ad17248503c2d32ea3af20a25ef16441641db6dd0a2bf7943f677646547eb34bb4ac70d214df4e7536358859150045c9d1dbae4fcea87deeef9fae2331a466311d2635286dc6aad0f63c4399dfe4489bb4d370a21276f4718522a03b885ba924b5c269422e17e77660d3579c9e73863d9cb55a0cb89bb71d30f2ddc70a303325b9e5809d2b62a54981d3d25b2bd88ec9ef7aa2f6280996539e57bd16fb380a46af0d6ae2be405a240641b6c813ea3414dc76db1cf5b6de445dc78f563371f2892f59d05574844b7b7a472961c1ef4d2d3f7c952d0697922528f7ed297368628400bda5702674a46f27159ef6e61d067ecc06dad8ece50f20aad08e1a48454b5b2897b83d9fe9fda09a5e1ae71d10bb01d77f752317c5b1c9294eef5ffac2047b7603efa3808aebb2ac02f0ec971247676b8afd629d824772c8fc3ca3eb4530011a67ea9973fee4dcfecc9c1ff777bd6708ee7193c110234ab7c30a38807266841b9ee5d4b9ee3e875992d36f1afb85d27144431210a4650023f0c12b74bda17d78e78cbfc5fb57380678216d64d80d5c3040fa30855bd5aa1b3f4a0db34a45b554ddce1d079a9c07d054ced310953537a66f7ecef74fdc1eb046844643bf0181dc3ec185c7b611178c572afd8340c2d3072e040aa90d08c7fc62a35a782c01c79697a311a43ebff3cc46815184b39842b7e6706c6f9fb380e2b9d1b1b107bfe5ad10e10a9d2de2782f0830cd7f4178c1c4a3db36cb6ab88755a4bae5d79a8c801c854541cbe543c9bae0f7b803b0191cf89900288b52245cd5b661a313165a91ac471c99bf78bd10ebad996c31407039b36c7c2d5faafb3bdde578394c0fd166b55a039ca29c43e1dc36a7ebf64832b414cecdcae7e989d0b56d309509d10914e691d177e0db94859fbe30f8acedbeb1a1e97dd4c3a596bc6bddd637a8b38fa5e4e7aab0da86cbd3b392fbff4e251a3b2492796f8b1588f6fc1f24025b4e0d5c689f0d77ed737f1b7252611390265c54ed9ed87c92d5c465d04177ae91b7c23c05cb50057bf579a64b016480ab02b340d7beebd06a0355c607391719311368aea4d8585cdce3f0faa17926f0041844427d62d6d33c5785b392c841b4a5affe95ea55f800df756c911ea38b94fd535dc5a8f0b511bb94f8a8f30da8f49f6df96ee814e099cd4b406c3bc434bcbb3f73ffce105c41cd35c3985ce68e5d397eeb488f417d7ebc55be03e0c1be93f46e9dfb1fc9cf57e66e6a25827e29b4c7b42fbfac413b965f90f8869b7f6bf0f3eb53f0313442ca028f45e0b7f49aab15cac1930f73b8b6c67b5ca8bd2ebc25c460440ac7843b4c3220d2f1063c85abf4132c0c8fd5f6647356e331baeb33e81064f7605ea55f52194dcfd27dfe6e789c869f1f19e8f5d416df18c290d1c3dc2c9a3c7fbe83845d5a32d5615f28275bd5b3c3ef40f6d15309d680264deef7125c1a811f8fd9d90add5e36ac03009efcf2761ad785f8e42444999a5b0e2ee97c457f22b6807fbad989603524b3b8f832170c55dc15788bd8a1fb47dc0f50feb75ca2610172c16a54aa6a2e8448c84c95093319a646d11d53a285244b12dae09f6ed714b86db5aba0bb5577775c69ed0fdd417985fa437d0640313fd0be348ad492055b035c8a32e09ed22b4fa6be8c56456351beab1b0a89366e4fa6e807dc6d09c3994797fbac441a052dcb470c0b1ba2d9eb7807ba26196ab72e596c97e164bcbd98e49db3c823e43b8b7863268bd5780ed67e43e5ddcc7d6abc0229eb5bcc25d3ae9de1dab8dced5c685f354157157c4f078f65d1b6df8970ba6b9e0a94adebc3e2e1f3866ab624a65ee673db62adbb8284d1662dc7da5f35b0108f6f200535b1cd3ed753401f0e153e1243f4b333f6020952a0f8e2f14dfa402efad8b00110ffe698af5cb9ffddac7e11aa1ec9e6ffacea739bc0b12cc6afc72a61c6db3216dd4a679905a94edc71120752e1cd0b460fa2901f2ebd1df61e5dbb08182de326675234eb0ccd1a5af4cf5f88ef5e93cccd6b991f37b083ff0ac97bfc3714efd51c3c890802397c695f53833348af927d00971c351773a9b3e9420f5b477d1b5405482b727470ed182d2460f18d2b93f9cb417bb6360c44424e8a21e49d290bb95dad00d421e85ee83083ffeceadd19fef434795185d1dc3d96fde23714b0261d8bf66969edfa47ea9165e19af6e9902cabe766c290ee70c5b010a9188489cf9691e1be1ba59a2f105bc70a89d07d9ae18cc8de0a72cf6d039a3eafd8df286e52aef3e462abff0056229b98589d9912f9d37923ebc000da1531d908b0b6dde6537c0f7cc321305d19a99d925af959cd7f40903324d14781b42999c436ba5c7a231fb118b08eb3a2e9107666ec10c30d5d5698b5d713fd7c174567ef7a116280ace436d0ea52f63f92f3c72b63db0df9c4be70d1eedb64f148b02bc53ced2fc7c4c399be84f4b211f5dc39a7db6f189c3fa2fa2e41c522333f01ba7b4c052677fcd8eb30e382d4d7f81790bcc1f01125c0aab710cc4123d9f3bda64c810c7d03a61fd57c0053b770e73cf623eaf1781ad4923316a031d0d01b475f5ea0a9da7c69781cb1977f444b957557db15ff6b35d5076ff60167a66dae828fb080250f723b86fb97861c708baa7422da18a8743975448a6979faf33bfb1f1157db2e93ed78892a5fd6d0e29d6701458ecc09d6d7bdc3e8f3e173f2d2fdd368f78639a994d9f32adbdf72acd83557c2553539e2bb3281d2f520a305f54097baf819de056e39f02d429d51f56c54f57ef493a27b20f4b5c73760008ea494d41a6aa456bc7afeb1af163555bc5a501c3dea2e24cfed2b1f7811d2223f1c472f94fa463e7143a006e87e33d262fcc06ad2d74ea3c4aa64ace5b206f5843e0a4c55ba59c1efc763ff3fe4fdd0fa5329ade97fe2f31ef0df0d68a5736fd91a6750367a19521b37c30e44556f37d58434e1ffc73f405828cd99ac1752c47fd00d4645c34af814315a3563b6770e2779fa9ecc559a567a71391dc972d211882d3119f9b74b130562ed74204826736b21ed30733363f1341218375bcf432d02a4cba5ae37ddf6da19ae66c4b261b8c4b4a4cb4f082dc604d2e74835ed643989077801c282a7a7c43cb0b21ed9732f606ad966cfc1b99e96635ae8bf34d57d2c64238d4fbb51d30ec687a0010d72cbf99b18c5ea805497e101774b2ddc3c3dc3d1286f27ccf6f9575cad5c8bf0599ce75f9ee56384c409a01b10dbadc51cf7452e467023a298b7af1cad2543cd8a1608258bf987b62b19012556b5c2cf80d4e4bc3a8af4a242cb64474fb1436130b2df17a8a5143f71b1efcb3de89adeebe8db9a6c054d219bd68c53cd6de2eb519495e8e39c4472ba36072a4f0d10b293bb865a0a27e01466276266e3eb3eefb728bf0e327ed16b9de0e51e6cba8d2b5b64b7a54fad65017693cf0bdae2466750289c889a9bd25643477e167761119fcfa707833c5f7d5d752142af7ce72b33a27acbcebc75efaedcf37c764b43dbcff8f3808c50cd1a1f6db8e37fa52c11fa4437af19894e57b4c88e685379a8072fc1a7bfca6b06986b625b4db509d84ad09310f403abe04428c7e4aaca0a8f226240700a3893c880b8f1db988dff54e91676dc39b31b6fedb998e8d087acc1aeb63f42094bb93ce0359d528611ef8fcbf29a2ff630d2b2032d7d19309f42330d7f2428524cf5e94221973406474463d76f49f780f55d290372f46c127e8a70079801b2b501529e32be355df478bbeb037abde798d433999e6072a0a8153182ca0424cc40dcb5aa02543fb2dee080026e3f66fbfd60a850bef4d3bb96f1c3d91454c04bcaa775f8a9b04d6c20aac35562ab19c42dc50ad7e8de4eb0875c1c64c3407637d4aa16110a35201aeb81c1e147a790d1a256db7d9bab99d0d02440bb536352a14827dc59c479a7ee5494c1221f410c174b46a322a18647a357ff18d2e0aec0e38f10ec448eb02728288de7babe3b29e1f39e0fa5e71cdb0b036edcaf392f5f1c199ce401bf9ca4d7d8abc1ae0273ab7db4d21bed9aacf4f6b619249c9e56ab3a0c591e68fa7c9dd95f58546fc67ad5e607c173b0ec5189ea019e1a9ac83618ffa128fb9ff1ccb17d39384ed08eee8742ca47e151525196115216687fdb72cc4576c5d5f98e2e0f169a227a341de77ce58ab6afd8ca31893ecdd71ffbe167a66e62911d7af776aaf86e390bf8f9e9a28db0fe322e576eb22e969b91b648bc72a919f294032227e87bda76afb3f9bace71ce8dc8fd29f252fbfb65c066fe5072b4bde8eac14a36ce6e0f0aea7a1c14cf4229e4d8ce5abedacfb94620c3cca9bd91a745c67dbaa0ba8424d3dd7bd937d9ca2ac76dee679fd962bb2c8207753b2181bf9da38d066bc33a1dc63615cd1f00601e14de2d9ab5a6d3f08e54987af7297f76e520115a9ebfe6a890b7d0fd290d9b9fd2d8ae4485fe1c9213cbd9087130f9474cd37738d18980e68830392c868aed1b7d848afee573f7ffde807a2f809e90dd91896b22ac7288864243b64b92bcc80760752e7b81c1b112fa65b7e7cbb0852fcd9d1236ae3789d129efa409b3446a3d3a82c9d0ed71c0ab01d4f5cfdaab063cc655933f6a8145c42e612168db32eb4c4adac0ac325563cf60b1d5aef4222591305804e5d522b71162057420ea5ae3f78c761ebef12e4563613f0e2f0a25f2391348d02ae1f95b3409446b512079b2a58f3a704f03ed72e08fc7a6f08091b325df58ed1e0540b88d57333faf23bda1c41c33de48d1952d72af68ba91759f00fa212d26b9eed604d6f9fd2164784be104904b220fc11ddfc71de34febe59861b3430a8b2ac2c31760c15efc38f4b06e5111dda31ff16e9f0d5d938f333d99dc4aa14bc759832a068405755d7c72a41c6382d544b6d7cc97ff46b376ad3b23c46b7edef0399aae3aab66c7deb079f4ca2a33222fbd9daf5eb5c2dcb5a7815a7c023a574072f039a7c15b1fa84e5b79323f13438e85ac3e1abb825e3ae05ae1416dbfe62a70be71e77adea3bca8f312e6b4883bd92b109761da1d2d0716f0f856cab39e5ef580464e1cbf2b1beae82f751422d046fbae52dd3d33db290f95a987118e65ed230d7783bd1db9fedfa45e97f7b222eb14d647dd1880dd39f8877115c2c6c2882d60c4a831f07538ed0a342de1399383c0b0f9cf18015ce1992c7e022d4f80cc69f46826c9d310c81f59779c6558e10efa7692f093e6a8247177f1b95bb51857c5a1d19e2325787e140748ba1a811f5216fb36544c28dd316168ad8f8ad06db2fcacb132ae75e0f15441a3f454d46f8e4f4fc93805b5b122c57be3b365abcc9ffe59d8e9cf0c4050e68d4a0ff0baae6c50dbae18a87573a63ee947c537218c92ad05ea58f79bcc1f1576d64fc9c8f93ce439e47af9443f0b726cf1f17f38181948c9c6bf3382d7aca8ce570a8a9e4b94a916cf92727cfe630b7bbc37f034b9577302b98e75fb8f061a57c0c9fa899fc93209db697298e31a7c799b85d17bbbf1b234c2b04b4489616d273e8fc88495e6e87e9ffbccf35df69d42dab883d6b55bce16eb64526a5f33a778642d2f76873f71655192cfd1ac573d00b1e7f8454436a17cb1aa04d2939c7bdcf00db40ac450a52b9a1dc72c1eceee04ee2521109b2730f508211b3c4fecb3bde2f3485043374fc405d90c05ce71a0ea4b37c3f54c4a69a8793eedf87932987430206e053683abb6afde190257e1886c2931fc9499b69e2012f049681af346d93395582279977c1065a460015c75a73152b9c61fb877c6043b7973cb2ae5f20a8855fbabea3f410c0845c6579249a309ebf2c68d6bae0214d55fef04e1791da3ce23d1bfc7ef44b022941ae104e0b6e223d2a5fb00fabab1e2eb939a649102058ada4db72824e19cc4009bcb96d2e95cbae080226f04efdc2011758dc25764d9a286f64a1004ec4f121187047e21587f0561132337776c2e1052cdf25008a3496a4ea081b2bbcdd7b0a0bbeb41b3a57f42dc1790c24d5e1a6ffd1e79e6fb2ad21b5a2ae2404193952ed41f7d20f3a408ad70cb69b7aa55a8d0b35a7a25f071421cc8e0778cf27b60b1e41f3f5843f3930f39c669d77005aaa49fec1b1a2a5641133ca400a1cba8ea13363518ebf427c694cea348a72c4a4c77c9d4da2bbc8d90ef456471dd2a7f41122de350d019dacfd059ac83148a510d3429b2575e7eb671eb2ce3fd7108116c410bd3eaa63b6a850b3e49e2659397af65dc5f9f183ca7483c83d159bac3ee3c263fc1746f8b5490c8f6b1702c0b2cab1354fc4961de56b518171167d23ec65a8a60fe79368c3eb94fe3338eb9aea06a81d328dcea058fed3aeff193cbf23d46e1438370a3f2e979f552ebc33c46e21f65c4ca2767105ca1a49182686db84bfb6ff80b4a3ed855a735b12a83d7387269aaeda1b8f5fd19f1bf4a889a6ffe1337fa5e63237e0255789f31dc5360440cdf25f33b19e4287330b37ed560efa27d6e507b0943d51311384b6a61bb165944e69850b46c6b99c7a25ba21549af6a3eb5c03570ec3aff197582c069cb1a5c7187e2bfaf02443b0a56423ba8555054f5d7aff19cac2f5aa5a74d662059aa2ee11d9e20091044db532d76a69d0b1be21c480e63070b3bbd13b52eb48c6e109b51413a96d5ac09f0aa36f18213c48687992a4d966c732f0bb0c65621a4294e5a5c838fe5cc1ac251381b2bdac1f8b95c9cb4034a4905d776d999934d012e0de65bbf09f5803b5de76ada21e2dd455351b5bcd089478777e099162e618a9cc484cdceda91c9f18ef2c3f5c795af2fc9b339874533c7f132d7a67d63b6ad655e4d08f628f0604f674d016a42a7d687f58d072aa2bc37ff6ef47a68e34bbf3defb9ab788d1465ca87472d9dc7f197a6575c0ba0abc4c54a741833445a4793a5d7a0d911aa8f1de9afc44247af97d159d59f6765697a545f0d6de9599f1d99f718981ac62129e900551bb2256c532085fe972eb1243e52cc7f0cb53879e3ffd210e908b34198a249fcea6c091ac275ce5bda5b8353671dbeb51fca9f78fc31d5b62950ce3d55f8f9b14c862ccd4ce790a870b7164e3387396befa821c26a55106d6ec8d07c17083e3e045e14c0ef027829d5143932373fbafacd79e4dbb7315208d61568113f25cf5bb41e5d27b47ca16b10c7027c8cd4f2db0732a0260a432fab73315c3dd29cf741e3182fdc9b26bd977810493298bb96842f3e34ffaa11dd64b6ef9d8b195d63817b534e2ce1e3ddcc55a9e9d68b415690fa2c7d77ec68f15c91c2530d761075af3102cc5ae37edcaa83404059d854a48b7753798f27e181c498f4caf9fcc5a2f8d5c2cc6d065fcb300fd3a7582ea0be6cf4f509c4360c252cd937b4077c526165609ccf56cf4eee912b34d27dd2637997da5de12f181b4bb9610c42883b9d7db9cada600f09c56e4390241c59aea288ed213bb6a5ed761a827f5a798457dd65241250bbe79b1f277ebcdcdafb83aece695e99ffdd2a37cb594cc8b674f71d97995068496da1a6d59d4cd871dd2b9bae499899e2286a817b29b5cc58974e62580cf6dec1243d230c0641601e125561cbad2077df2318f16c9ee6e30feea4c696256726d6bc07aee2a5a91577267636114a684742dd6138c5b01cb5ccb3700dece2cf78095f65f4120d869aa6dc055dca60dfc51236381b23726d943ec470e0a2a879b232d060827d93f4dd3f5956b47e70b6d66688bbb57ccb2b18da82d9850bd0c14d4d6dc3c557c2be4c8f8f6a958dd6115f2f10bd89c404df323a6797332f5d6ba2292f6129f074b8b4c8e3f1abb89c0c0c80d66ee925a82f0d5ce193c879f216cb0dad6fd6a5282da99b84c92ec27ff7e51b3f5c402aa975c86aec2f981d4139629133dfea793cac41bf02f9c5806463dbf6f91977001529f402072ad6acec340a9bc7f726de0d10c0cbfaac80e2c373956ceadfbb304dd19bf1091f4eeae95ea21c517e1b934b62c98595dedd63be82f2f0787ad27d2f362b72e6296616c43f7f2667c67a8a01c41b9e3516930539d7af1f5efed5c0e1f02f0501a8b151e04778fc9f739a7b769427fa2dc3715f4aa833a7a4891f89de1ae068ea01db86d1b29762cd23823c6b10fcb28f9e0ea1ecb981b9c579f20ce18c3f51d3daec2e47096ed48979f7f7bad61cfe0f9e116bb2c8e50ece781ba96a5d9b46fd8a11c0d0512fc0505a90cb3a62b66161b00ec8bff1ed134d284c9dbad7aad32f15b21acf2fb4bd5a74174532bf55cb4a5feaecf65c69fa03e1bce8b9c00a2d7da0229d5909e446332f1a7f01b7b4e674c488f16104a82ae557db37c484073eaf04056d6d24e19336296aee56b7044928c7e68eb039b82429a0395c7d4ed5912172d8aa3051e3b3a0314fccb61c28a561de56210741eef546d3b3dd3ed1190df43ce9e723faba47b74b1525f73e48533b71ac036ec4ad584d2ce9e35a5f2ce4d1e4b928de3ed02124f5b2ad00a89cbe2211c4035513d9553a8801e96cf53ff781ff78457e2edee4767a85993d4bbed639a81c7d2a0c84ced9b0d31e9ee822b6900e79d8cc5ab64051f000890310cf6774a4e00952e9b18d90e635217bb237051de26b4cdf5460f33296e64bb20767b4caa53a6b7f2ae1a4f0fb347de50e34057374ec51a6c3d0a26bda1f567c9b17061a4dcdc479daa5d6267929a4b4d8bf3c460dbc85afc8f607f9bbcd01b159bc24d38912ba75786b04c396abf8b79601103f69d8eac94a5a9c0edf43b8faacaa835a9dbdacdba2f49d689cb59eb40bd9cbb5ef58d8aee9f3afc33f3c6591c84797e6571549f6c625c588b7140d4d920c58ce5f398a7e03ca1fd8b62c545da07a34bf6aa83398cd3a6ed05db7145ea42fa38e290873bdbdd6f51e650a9ded7a1a79af0ffe786015a98de32531c88171af784c99cdf54c716ae8208c3a402e41df2af2c83c7d1f2fb3cae5e4949fd438389b5c5eba02d845bfde5f461190e5043d770811547f8ce72d7ce9166640c0304f72dbf7d2e4348fbe8c9c58a1766695db699430d0835e7c831a06ddac936a94ac5d090cc658d6a37fdb2a1fab84e6657e0af2c163466c31f5f83a8864d9548fd2fd5888af6bdd04738b8148c9f62984d6f99fde56034dbbc25664bf21a85a8f623264d9bb0ab6f2aa5de66c45fae8a9724c3cdf8b7f557a6fd93dad5a222df9394b8141fedde0bb78b01c7fa43d8561cf87e10906314c6a4c6e46ad3f3c317acc3acc8e1e5982f06ae3c3cb6f7d817d02687805fe8bd529202118f9c3a202ce40c8df206e7b13d6218aaa2b8439aa226433670636d7ec6e5898166884874b772b4be0045a5d32b8dfe692531b0a8c419b81dd64d55ccf66357626a84ed446f1cfd239d4b8b7e414358bca77c7c9abae2ae52c7d7e9f4822f2dbfa2d2fea91a6bba498633433ce1617f132836cbdfd63edfe13fd1bfac8476d98d4c61fb1b48525b62c89dd4e5d08e8f81982d1027db894eb6de42a927d1dd0f0061ce2074fc4fa02c860b5d53104f03c10c10716385585638cd8064b736518000d1062a90051499ec87a94a5cd84b5619f67bf967528813415e69abd666ca3d1868f99db02dc8f9f0bbcc46a5e71a85c308f157d7aed192a3f1075ebe09252caf6ae1dd194745e56492bd041c8e904703d8406e81faa86633e04ebeab848add46167e651955a9d556c0a48f326f27ecece6633b0d8720ddb5104630b3ee6c958957eba46e447d6dff51e396e83290b0a4a974e7705e181c8922b9605e7b41cf52de14dbd78bbf13da4fe2dad37b884141e9f407a1c042308e8da42c7f5808ee19d9aa50299cadf238fe02d92cc7239b6c9db56d58592eb77cf29f46af6ec1599cb25be112edfbd8ed4f5f474a09f6cde12cd97c5ce172ab5be2db90c46d606760ff80ff5f46c8ec7fddacc4edf1af9393fb82562224969da6c97ac3c6f5cb8d471c7d48a56491b63df7559bf5ee6c6244429036114ee8c443ceeaa90f7c4280ef23dbc57b4c6afc65be1f839a2ee9f9c0e7091e302b6157cf05539bab4f99e9ab2483f23a789bfc4d76dcc4af88f1ab500b6a074535ea1f495ccb094a25ac7f12a49c7305b2d78ac17cb7d6734c10c731c7330561616fec9e95a4ef72df769f50980a4a024dc7b1cd18e0790f969e6219a15d923800f149d2f6e6caa95ad933d752536f9779eb9a20beb55baea82d3ff8b7f339e7b46342d4b6edcdf87d6f437ca853e7e2a3326c7bdb29acc4934e76eb665e80e473e1c91bd774d96aee51f62d4db32a50d8d40d7a9f9f85392b9a405723e23856306c2a21a56536b81cdbcb6da995a1258510d2827369cd9e72685bef134be25a667bf16e2934c14a002c019dfbb1f7dde43fc9eb0ca045c783861db6a335dac4b909b9c0e842b2cf0aea59f0b55c09b66194797cf45e10747a4cdf16ac1f1f2c1731e2c8834ddfba2a13a787b6c20180c46330bb8f06b450810125530f87d545ba987ecf6cdaaa6cdb7425a0ffb393a4a79082f7d773324981c4679d9eacb0e5ece3d9a08aaccb82522c370859305d6f30ce625c6cf3804b23d633e89fa2f4e13f6ea846aee9e93b05b5e1568b2aa0126132f688c079bc33d727ed5b902ea4c83313d780c8f61c7897c3d296d576f76b53bb3407754b6155eb4df5845f3e6bd77763204320d4dd484c955bd1562a9715c3524e5372f1ea5b41f951deac1abd340c8a5a8b231171c09ef42ce71ffbc6cb5b83673d2546122cef0549ec08f6aafffe8499892a3d7ab056f4f82a1f26a00c7c70ea9b14b508a32bb25ea4fbf5cb3e26d1862c881073276a952f8dcebabec7970c3593878d5488b8dac10cedb7bcc89bd131dca22936e22d013f92c371ac35123202f3ba6e4a8cccdc458879ff23cdc7141e2e410843ca5346259d218f065d8554d94381993ffaec68e7ab5040e599af268e812d959d478a56c307ef2dd9c7b7285f74d1320b12381ff092bbd6d8822dcb55245903c877e06e910baee560278a597d81de43dcad09074ffd23b3867036898ada4a2d251c1c0abb3a9d851005f9dc7b89b1b5abc96056c780488fd336e271641ac10550eafe10e5879b818cccbe189c18f2474be4f5dcd79ca0bfd697c50373cb4f8219b5b205780a980753efaf89333ec25be14ccb7e53cdeff35031774f9d7957b5f510972df3b8b977dc8e9ef5c04b74853b51c31bcd5076c640d1b8b38846cd656903334cf9698b3e1924ac0aeaeba43a1df55fab5ac8a2cd619f1d2a30bd489de6ea2fd056889a2f05565a9b8a7bcf2abec217193c7e7fd918670dab4206fa137d8ce023c34514e28b4fc90b9ecb7112847fe9adf0dfb813a100bf29b550f6ef537f8b0401f7f0dc4c996511a8eb970aaaee54cccac28531f70319a44914045a8df3d5ada998aaa0ece257c17bc2f48395b49b377b0fea358057ad49ba78e006dc2f6b59fb43a31c860945403486e2b24bc5b17c5e18b15d19aa94e128db4be9f7220d49aeb8466c569c311f5fc68ec2a9488edd2080fff687b6be0cd143d2da320d54e5db194ad8b84931c74a158831a2a836f6da091bfb2a0cdc00e96acb80aaa25b5404ec82bacc81b3a3c719b2d664e9b4f86a7dbb95c940e2d8ba00fdc034e75fc88ff2d85cdd347d3cb242fa29468cd27464690bc17c0e3933ff8f5f2863a49eb91d5b683524c3fb4ff1c318bbac02ef92781d109a3ea394210895383969ac929cdb54fe78036c7babe9073d96083fe61e7b002e4800f0c182f452df7d2725538ed75f1d6d17d6921106ea23e2f5b4aef487648fe8a280d8f8173fc394982a8820b619091763038059fcb990c21f792a53245096f0b330bdf0327b3c6770d414ca2cb617c689c195df5cb0ff8409ef89209ad0d273794d27d852cda43f98b30301af989a62cee28acef44d95ce59ce66cc80204cddb18577c40708b2cfd63d1ebfa9588ed838a0bde7bc3c4bbf935e7e27f340b05d1b9b41b8e8368a8aebd6376c2df932aa8b48e1ace65106156ec47672f7b82f75e430f5aadd895e586505b91f072aa01e27a34cbc384e024e188ae7085a7c1065efb8900867af94885e07c4dd0a5c14378422845dfa53f64a8d8425969c558ed657f0cf80c63c773bd8557849145efe756c4c86562f3deba415a3a891d013012c722f03154be93aac84c1cbeefb8cbcf4f91ce6a26e6576164e6ae798b967a3d0b2850de8900d102dcfb3eb0713a9622ac458dfc3f192b070d151096a573b3605554c77d041240fd4191ad4d84cfc1e4374076ec36fd852031c8e7b0a00b1bc2aa3e9ce830e2b74dedc2f72ea7e1183db853ac5f827315a646403dfab65f1a19d72396d91674ad31c6b21f8c01c03238a6ed80b587bc674a0d007e37610f22df5161df47fb6faf0b39e77193f9921147bb06f3fe2e0ac4335c2f3fce1d95ce8f2973f9d31416c73695c6ff0c3923fe3d316f36b37d31ebb26f196a024e78afc0f2962d74ffc231d170c9ade11acdaec3023553c6e924bb9b4ca1cc29bab5668206aa4942790effe4c310b08c4250991d78ee6badc5d0c70a6a0b64a2a492c9692aa98fbfd9103323df40835feea7701ea0b8edb48953afdd74b3ceb62b6ff1e8c91be4a488e59b29fc99cabd9d237b225a26a29c10afe6f132a148e8cc0950a94678dede062167621ebbf631199569adc1d55c09a78e01a477da0a3daa78ec2f9ea3fb37c10944ba1b2e1d9f9c746c0dea00254744f627df85a3aa5d78437387c6e611050ec5eb9e06c8f58c441336ea76358d5b12373ae2139cb4d805ad9c23e943fde940e37e214369f2618a7f0476ec8108909d54b586b78eaa18c433e1d4ae95db8cabcec3a4fa632497f80e722dc949a6806e2e119c0a317f65ee27018ea7a1b54013c2243e524bac8c50bd9d980d1d0e7ad655dc8e020b16d4378fa1fb40e51a58ab3d3ac153fa21aa8f66120ad0163f3aba86dc02f30d378b965a2efe54ee24e03c26df163d3a5da357f0d72760e9fa0f08dc13fa71f05508f98079e7bd3ceb85668c14baa17b376ae236212708ce511de9014531992b73167ca164b8158611c8656f2df8345e8821e6c19aa2c10041c29b13e56879a6822c1116474780578e2294482c89e075f46f4d197f745b22a4ce5f6221b4471b45f959f03e54369db882007da2e50b0015484611d03f1f1c81835f0f7de79fcaa6abe2f5d222fdffcbfcb7d19b3333c77e8ded16c13b136cfdc1f8dfd6e68f6d70da59129447a55054adaff7060e982b43c1c7b11359a5b966dfc49facea0e3bcd013cc713618863cf7cd8e8ba495b3582a7ddcffe9d53b816510784820276cdd8770162da0cbacbc43ffd1a76c7ede1543effeedb40a833d810640c52fbf9c6d426537e19335aadfbfbf48bb93a5c73f848fdf39b586625dd5fd44226da39081797a86a5f54dc026b51ad8f22ee286d7cc2d3d0ab80bdf1ff1297b6d6eb6e40b75144b2d211a00011258af14087367c8b319bfafdac336b96a75c1487bbf9b6c3f9ba75f39cd0c73a9d6d8e91f6c9d9497cc67912a7af3cd88e940cde40e3feeb0989f678bb57820ff6631a053844881e03206c49f67a0a6ec49393e45c43d53aca5a825345f6901bef49ee6b615d5be74592b21c58508046433f436eed2f7a7a430233a01791c869409226047ec503a9d0c968b9b791f0dd3a4e973f9c9ba7df0dbd2d2d5ae9c24d6a57eee4fd29a3017afb2d1df6ec9fc1cc8bd4f020d2dff25ed0b45e9999d61e23ce7ffb8c182191488706dafd7b24bd07347cc2ff1669ea178af3a33195061756f849f9e59e517420c5eb69a1a9daa2b911a1ec127f070810b794c326c504c06f728c348fd88a0a6b4c74cbee9efc415f54fc8ee5ee3dfdd2321ed8bcfa9c1360d159ab8d283c7b38823958e15ac984d9eb549105e918f96798eda1d9202027137d0f50fddc22c287dff8b5433bf847a12aeeeee3d21b0cd7a5899b4331bc7c16116d7e3d61828e43b7fd2d742f85992b957df2c864e5627e42711d003f16c778dc5154f5242ffb7a61c3ee17c29b00e2fc4433a8c50cbd9384ad699c49250cda125a343a2589564c65763c262d622e2ffd42830556f18b2eaf01979d1c3f548d0079eb0b1725ff78845bc78ca397b64a23d9b5b02da3b26e8dfffec8c393d2451c9fa7ad00691dbaeea22884247fa2dc86ec328747bf3ff3e110a8acbc6c782ce62772caf22ebd0f4afb133b99784a7b52a2a37991d2147a73fa6618861754b274839973114af9d10667e3da38f15324646f75d35425c3e2fc59123b76aa6603260e141e859fb25b079093c1c90241b8d8c3b464ea44e79173ef9895bd52f0d44abd321c67b5ba37ba252ee0ab548666885f45e57ed45ce4d277de9b65ec9e8e496bb84bcc1c31c5071b8b283691c28ec24972d7a0d3d00c160e360a4f04950059d629b8fcde2519eedaadfea70c75b610b514581fc451bac1e4c313285a892e7d96e1ccdebbe05834d678dc8b58e7156671c0591750e2813f8b5c624593c0d1a5dc6f05143a1f5113a4e5e71f43fc20b2eab4ad045c0c0928d7d804d92539f205be8e411e7e3dfe9b5a52a933eb3c9c64536c7fd96990473884b7aaa9d37973034e2c4cbf0a9f93ff6fd7a40f6ec722382a47a4345122717070138029ee83b9712057e9256e7c9e3d78ce11064e9881010bd5a61ce331e48d1c5fcee897ada964203b5a08526e78d09684f34e486f8c9e1e9cf1275d9d4d21fb9ac705d84aa42f63b3b81d6cb01c5e3ea95d8fd212bd2459759f2431eda95d078a6de3b440119bcb342935d4687a9a1ac087b83c91f8fe637d45a0c3f5403b8f58da0d9f9789ce248538a48843568dfd52ecea0a280e3fd43ec73bc42fb89fdcfe06b728f24059e2b1e15bdbcf50961b05c2cf05446e4d8e124c71786436fac3295e3679f187241bb754811bc89fae44763afea67ad04ea7159b2364354aa819defe9caa4c4977e9139a9f8ccc8e601c8f7ac2487d402339a8fd90a438657ec035d7b442bcc1af0e1774c10eb269c9939f488e9f33324a8d399c4a1cc190bd3434468039563ea21cb05e8b56ac587b696ee4fd134f6a5207d3f8eaa6b5a27e6986ff73117206d61c1a8cf9cbb7a4cffbc967494e976d7218ec083b828971294b6fe5c6f4134c95f69d2610ca165d42f177efeca7ddeb19c232febd116ceaf38fc42071af44345cf82cf08a2fc109c0d453d756bdad9964e3c403ed04f67ac1a9d683d9f42400d2bb316f6520bf51e1a838375d863854cd8ae7f0fdd6b10dcf1a96326e81baf44010ed3a89d2a91adbe005d563cdea467d8f86d6edfb3e0d38909da22d2ecbb10f70e5bf051da59192519cedd9dd1cda07ddb6a39a4dffe88eee29e4d061d61df8f8e2d92e13d598da6f0d46a367e87735945f68b6a35766fa50e293e63339c0d1df3298192e2add06889544465a8f533db5ef8450f17fc0dc2b393ef408fac7bcf6e310f40c8ac5fc974fc5189bc81cd1c4e72c8726379f6a4deb072f5f2cf8a181c323b3f996d1dd67d3ef6b043bd1bdd00e119270b63bc6510836f8768181c6432421470a223b459b854e9b211e30612cf98f71bc877b389d827b61309e5e6a47e20038631f5b706936db470508d3d27a999cf8d6e78bd30e66eecb1976254a12d8bfa487d72cceb6e11f80ad77fc7111901f01fcaeb1d347e7d66f68334053197103e318e1d6eb1d1d7eebf882573c5302fc02415572d2d31c5ac1f4e1bc93b74a48576d1c1af57ce83da4945bd236caea97dea1e172f20b7cb0470635d1a56c10ab66c3fac6e2d2f36c5ea5a1913ceb521fbdaa4340218815bbdb9da5c2ecd1006347be0ba0b160117060b5eb4b910d4621222d059c6c2f620a41ce3632ad7ed14afa595393252adeb43bcb2135d5aaef4a6cff37d664ea01c62f21e2f0dca7c7711dd67cc9b5e0df16a54ddb840b34d6b6ede528890d8edbf6b1f56781ee2e4e4bcb161c3e7d85c2fcc0eeed1559835a0e9cb7031dbf4a4fc755daebd38ae7044a24121837bd4584495be2547bebc3e147918f5afb96ba2dd24d6ac66221588713fada85285693ccae9d634828072a97f2fcde9aee1c8b57d97f642facbabceb631965d89b91f3e889e3581c82f0331ee217ffe22da1229402d12101f38027e8f09a0fb6d97a73f2437114d13fdb525a372b4aee47a1804720d2d13c88c66e8d51fcd91567c160741845e8926f37d6716cbb39f5da8316f65d7fb69befac327e5ff40f6fd2e05f90906d34b062798e758a0b32568ec750be6850a86ee323a7741bbc723f35e3dfc3f32f43b0546f9c5790c2dba24dbc7025fe84d7e65679bf111ff6ccf4d8466a9525004c444ae1a37b45b2534de7506445e0a39b18c54f6342b25a2753bc3b5557dd6b6e1e3926b59163e15a27e18251d4173c95fa75e6c6ee8c3a1cc772898fce3a0c1e4a19928bf0986eb777aad6f84129eb78c5e79b573257af99abf3a1818577bcec5cb2d7735e2e2d1a6af71ce0f06d6f919f7c16f34cd327c0d952eea43facf6236ec72e83c4d16c208b5ab90fcaf9f44283cd42e5283e406fe08bf0e3949fa74276577afc9d8cb9793be49e27879f00840b7add926ac499bc3bad92f6e4986844caffae86ad233727bf9c1ec0046d192518bf3b627b6e0817ab62605017575d50eabb104c183d323eb23e46885674d81c430ec2a9eea3080719d0cd6125d67d853a4a6c906542164c6a1ed7214badc1e990ff5a13aaa71172d30fb1268f5bea5c6993ea5f5849eee2bc4d11378696db78de0efad60705ba9bcdcc220ee3dc6b3caf80f7a5aa8fa2687a576f511b3787fe91d7dff6229a30d71bca0dcce499ba23e7d7bfd09bc57dfeb04b2eddbe6d8c90c1b253769115391d6d04a5783879dc10b3afd699f2e16c9478c4bbe6eabea405992618a4098653c2d418fbf67729d35fba1523d73e8bf819981398e0a480c19d01eb99567e095f27c441e5d963f7e5e3cd6e2aaebe0b94375139a756055fda4dfefac8dff2b3994fc36dbb68ccdeddb316d4924315ebecf29421828bdae2078ca98d387cad7a2a8ea44435552c9d2d2131ba497d561e176f812bbe343819c8667b78014f6474c717954a26fe9568efcaa82edfee364abc3ed73dcca6ad69dc6cacc70c2465a222a7fac7664031d8882d8d23092113bfa879665e16dd117bcbbdaf9b670f42638fbc7380a650842a6e250af8fa0e8d95045ea3ea99b952651cb5240a1e9e841d57a701d37b8d67527a06cdf83e059e8415afaf91a8bbb9a80a380b84bc8d429062170db4842eeb5794fde1bf90c215f43aeedc223ca99ea5479f611342b2b87f8d897f3fc07ddbffbe62ef37ee688759a234b830a0e7f820592a1ee9bcac6185ab6f975c243cc256614df68d273935c92a48e9365350590d9f497dd606842e7b825303117dcb0dce339cfe29cfbb5de0a59a71eef5fb9e9279c7976323013ef9882655246c499f1de550284179c63611c4da3106e21c52488a9903971c91925fdcf6e016345089eb624393046c0c32576ef981fe197371d8c783163bc4cf893aabd70c8118b83de3fc030b04da02b5eaec20724fa95c3eba31075c4a515d51735c18add6c767fdc942b4d7a4d5ed5aa5942450d7b8669afcdff29299ecdae1030efa0722e21b4db098ad86a8f9181aa40d1026706da393e4a2cc5e2e8b882601be360531851e588e60ea89a8b8082b59a51974f4ad3156d32224ecf047c7059b7f870e5d10babb281820313af43648d14ed9e4c85eb2a50f71cfc2523b2b5c1c0a22cc2cffc97d47fd936730a70c1ab4b561ba0c95fdc13f979ef8c542b91823e89be7183dce592e7b3b0e272aec2934855352325362fa64c84f18c9108eee4414701dfe9abba4e8dfda7f4b7618ef64c7a12535d6f8b24e7ceb9678d0f6a1df1b2fc1f67f7eb7441d86579c7f790f822cb72580bc22a4639f813c54c4b8bda77981fc4c0450a973398ce8ebb00176868baf1d0768b182a6fc9cef1484d296fd5e21a9fc7aa4ef3c97b47b2df674e788d9b3314c079b5413044fda2ddb5cfc05a4d6d153873f11a70bc5af8253fac888765e3788fec4ce272292749095ce2f797941737f4c55117755bbcdad78f9df8659dcb4f84637735d3b17a52907776ce1645ed570bce1afab0069d84d973edd3ddbcfe6d22ed41b7a460a8ae227e3bfea2c47725d4f50c01974ad62dc0a405f89f595b4043fd1809b1a5b7fab2d3179832593d70c0c6d2c42a090e3ff9e42e764f3b6e33458b61feecde486c27ca092ba8893ced33773cb26a7e9ac7d44c7addba5f66a9155378e447b980d8092ef86c3744dd8a2dc060134c32374fadf7b2870d16df8594f819bbd890c70ae4df760c4f5dfca4d278d0b84828d726ca4eb250163486d33ada0c62e495ff193eb1eb5bc00a01861f42016c0d5a8be6ae5198409d767d1218e5e7000a82f3f8ec1c53d825e4d4587ba1827d75981569d71cdd5fbc3aebdbf30b5bbe32cd37fd0f196154665c11b98d7ff77b05905139cf11c4545efe6a09fc03a8a2c0448ac377a09e980f58d921e99e734593f3a7944c42f243b615db9e84d324e4d99fea597db69ccbe3c9faa63820406449ad1568e1beced23defcf570e6312c8a722b7ada40ad814cc97699044162ad82936d6dae48a830a6464458768a0867e67fc65a9aab88216fa3b12c05388f8f7f14027771db8e3d035683ed20f693081a24d29c154cbcc612adafc48c7ce5b21bd94b3c03baabaf45c4cc2fce3b962a7715b17d6fc4c763f223e776d92e533a5fa5ac0566cb87b4340772b2e162d925d74f008fb2843c84092d30c347d6030362123e0ac5edfa240848f316e2f16f029a96ef7e5f99441a74e581bd4ee9f5b5f2bd84f6a183a8a12dc6fb3102bbde767e02f1c6edff0ab00383a3d4f1d6307ad683d75dda1b939c164ba27e52665f9b9e9926a4f4ca029b155580a399dea1833dfd3af24c18cb302d0c195fe7925a10727677be8508d233c32e2957ead3cab189c654e73caea5b27fe9ea4e7e85a1b15bce5ae018dd88409d67b9ed034343ad01dfe3c3029a4665a4a53567b81fc97dd216601cc93dc55bb286e4700c8adec9b359cbe0b3355c6640934b4a3abaf4fd7d9dcc5897efaf56c82ee531f45319df5dc459e71fce9a196f158a12316ebf3814a3eda0020448fcab0351a755a3e13a6b449704fd874d75c755b70d4f6c9ce0435cd26638f03c15c31d78553296dc9fc7e34882712148fb40f71de15ed138aff045dc261f6a87fb66570ee7beb9bf33ff42c53a11212f11e73fb7f6a15227e49d0b675059b49b7151b4aa51e08754ad851449ed4643aa4e3b1b4bdd4afabdc2ddb5b49040f1885fc7a2c149207391255cf7b7d2ce6654618382cbc395a7831983575d44e8e343f1438657e026d2f8598ab85637d784bfb896c4fa92acb6051295853896da273a2f8889d989abfe0108087ffa98cecc9c90919b37bebfe2a3a3fd3fd435e3c3c83859b096c968dc8de0f7e0100e022492a9fd6b3b6fbc49fb1749ae2b432f369cc8b98ac33504a80986a95aa97f0e8d82f00c8b46f4e2c4accd48698fe4e918abe15390349a194dddfae77da6c9ee6278933df96bb2324bfec093ccd964083ff7f653b9c70b4a0588f6ae91577ded1f2dde221dd9e31e93ab87bf4d8689d0e94d7d469aff262c3e1405092e9e66d730a422b84c25aceaf814457438f8f4ae24a73b2ac5e25fccb7364a9dacd40fab6f4b4711612f356d09b137d09003fc50a5bc2cd91930e2331dbe647df68915531ca7a7bb80e6f7f44a6b81ac62cc8e1a27ca7f14a1d67ad1deea04de9f2c79afd526ddb39dff7ddbc91cbd4c8f70ccde6453a34588f5a160cce9241bc831dd0f2f29ffacdc9e959417740355399ca11d634a0d54f0e2ec7da0a9a04e81f68b4cd2181e445b222988f9fcf583a7ab41e1a7765a7ab77b82e5dd106a6609e2fc63911b92c5668d6f20c604019d0e77445eb382798b67a303248acce259b8c0a1cccb3e7a041b8584adaae12a79c742e3947fd31f4ed61731ab089c2906bfe86a57da4f236702383ed03e82abb28fffd7f132e3e1ae8ec60dbc3c69557da54f4a28a4de5f4b11b277e104c8b6f4546f903afab0fd205fc4cf584fa3e6765752aac06f69c28379379b1c8282fe0e7668e042fc7a80f66a06914385ce319a8dd385383135d1878ff014cf1b6b98f9f3c8afbc9114bd6891f44dc4abb30c73513413883d63c825ac90104025f14a82b21c0c5b2e073a812e551a0005ff2f0ecb37a9d73eb420efc4033f22aa1e494a6776ebb494f7d5be1f1055ff6eb99faee3fe4531a19fe2f3080609fcdb7505422590b692b2896bf1564623f948bb3f35f7e0c101d0361035edb2292ec8fca40b244df06fd5cc30c1612f816087e29f2ead5867c9286fbe025a9ebf47725583c32609dda3e6cc9b3eb9a3830fde605c0f08af7d24f841201bbe6b27aa09e8086977e004debbc78ec2b632abd5befbe9a44cf78413079d88a74f082182ebdcfc5c1523f98469074895cc19064895a14b37995f28ba5d468c9f375689bac15ff518556b3b1821334c44400e3d516c0eec235806cc32d221135262466be05d4e636dc4d22b96ed907a7ef624bcc8ec7cf472a7aea7f2a3b0d9e798ca03059a2321501053ebc9e8041e1875576e4fcbcb1f0d5c646a1da09b5fbd7d1a453fb08f392365db156be684f654fe4862c896d6e929b8d1db6727b65be2aac8b53de7e7ce08b84522225ea9ff7fe6d24d107ea976ddcb8191688e999be5aead66959f85714b98e92ecd248dd8c6b30ecf5f2c0cc08b96315b3d59141b7817e9537b582690d9e026c981a3b97df94321bb9cca017a5a23cee8f0429ebd2392a3b62896b942f0c5c3b56838710c7f44f7b71932f110d3360ee8e45dd53cfa1b87498b6204f638c618a4a7c3a80e6c5562ae68d138acd6f0685cdbf6ae8dce72ef19f9f55b114db8b070696e6f1b736a23c11f5d9d6b354678d1bbad2dc0345ecefa147916a962591f24f866b6859a5a17ba642c00cd139a673bd7c78a25340da4a625326df1581569a5cc943872e06f58345917ded13a49e4468ad3264281ebb0d816f002afee6b7300a99d250b9fc6b8e3fd9f76a68640b58b5dcacb506340d511b341be87097617856613f650523e6a516405176c53b317a2c83488cc6c6e7208c4c9d76d5466a03af490b81d6bf13979b2e2797c9945806a61239e31c9246ae01a679bd6c8d90a95994190bb2b034934f5fa3f0bd176a27efbbe7733e1bccaef61cd28f0ce498bc63f29ca7852f3f0fc5f378ead9c2133eaa6237a2feed136e44e4a20894d20bd3ae4754c4ce7d87b7870776858a42fc315be71bc6dbaa23812435947438df8a11bbd881dc323e14cf564f2b70fe936eacf0d438b69fbc7c573a1b3781837f685fba643171cdc025ff573bea98a4b1e155fdb09057e517ea452e17dcaf5a205bd4833dcb8d27bef2784b6d345807c743ff088477d40c8a627d4b33f9e28d248d6aca3162602c4df2af02dfd80c9ffe790fde14df999c93a45e7b5cdcf35a697522220599bc6be60d09b8ee09055c4d55171c6d0b71688554691d585735ca5816ef68b5debf7498970159cf692444f1234b8ccc8e807f7ec99a47622d2aa69d8d631b1f71f9a66999eb589ab06a54622fe29e00f14fe25f21f2659f319f28eb4976a6462874fcd3081c6da1ce1c66c9c876a976711c09ebe1ed8283f59860ec27b14b41a8ef6089dda298230f2a531284287bd20304e4394d9bfade9dae342732aafc92602feb3851f2b1b3dd9a23db9e84fdef3d63b5d79d1227cf035eddb4ff880df7df242db430ad8f8f3ada732dd2fa65f8e258349926d06549d87d9582e167b87088ec6dc3bc763ddcb10a0b2e426c3cd555a47b7de5f0e29d76b8956167b41142dc981084cc3f46f40f8cff1e0af32a20bfe64f6d5a7f962f86341567153b8e0d2b5af67824eab9c610a4d656ae865d03fdc8a2e6748e9140db039e46cef889010ca75f447b37bdc6c63a4adf9aa85990d1b9f4ef18cd99d0f892609173df95ef5669b48fd2e97fe970da1809275b2d8386e6649a686219d1d0c9ceb90c51ebe1811a9b98181ddf498adba2ed93e68299f01cf41fc5c6eb59c7175cd4ce040a74399112e41f511f811e8fa5d30ab0406f90af20f7b938eea8ec669b3b0cede7dd48eb5a7673987b86274f02b93c50ec1fef6e976dd1ba40b02a93956af3caf1a26708b9b6a04a5bc6b4055543360d27a4db876a1f0eeac43cd74bb360cf0d074b7323ae15e59912203c4f6a90ec4d024e55f6ab53d898bae9fee8be2147de1fefbf8aa0ac84afd009efe4e5a16a61f949370802b7aa77a407b9d43723e912dbbc531f9d5492aab04353de906debb0ed7fac2feee61f582274347e6a5d2f2868ce9ff6b62d64eb500c1e88172d635234dbff4a5241ccf960e5148508ec3e1c8a0a57fa37ecc4339b8b463225813076cf220a06a86361bae086036ebe6bee96f693d22e0d32e8d9f1efb4f330042d1ca86c96c778e7c8b55c434028c42430c92b11f38472f405a73ef4b5fc804cacce4aba20f0b461d9c086d7e3dd169235edcc517567ed951ba7e80560fe718b30b44c61fe8d8bff08403e17bc2fc48824bac7ead71808a90f1e6d39fe597345097af3a9cc0a8b5221dd84fa39e9a6d5441b49662f034d977f14e829b26a5f126b006bebb983d50e4a567e669b7e81d8e4c81e41447c099880dab97631fb180d4bf550fe45b5306b16b488855651f2288b541bc5f4fe8820de4668c188e0aa915ed6fd55dab4755daa749adaba95e61fe9aaf2dff0931523f1dcfafb518bf59cb1c7123c7b183dc57665da0d1a788deefd915619fe059e66bc26f87a0c1e31aec6067ab94f2ff3f4f0ad94d25144933c6d3686de4737cd9fc339e4bee7a2e984b95fe8cd4d0236cc149d42282b616946e921a0ec7eee63f5beaa0a1268a07badb82787f440ee2e8fe8e79ebf8db2a83ba4a513436e0060628e8f18d944366530f2daf79a33f1be8962170c738a2cb1a3333793b50d7db0d23def286becea9e47d05a12d7e1c76a0cd9ee8063044d961f7b4b9cf4ea39caae573597bcd993e9042582d2b2abaa2088570529844ea34f34562c16290723b5c6798f7786e232aa58de96abc107c3de3a82806b43448b5a0b6fe52c5bba7e28d77466bcaffb8da429d6cf38c95dbd302a3babefff15f24bb4f51b994be1aaf4a16f8fa0da52d26d7250b17fad7de3ccdeff89795497f42d9933a051748f342f474a879ad3b526d2d1e011823844d9237675ec62fc53b756b06e0bc8bca9128e46f1bc6d77014f00513b86fdb65e12906d39439c27b087188c437503739055af2c6a9a5781032b92d6b5db05a4ac9cfd13d22b44886589bb4715af7eb709430e420ecdeb75c2a8eb194072d7ef3f9a07e1e7aa8ebbdf0130c0093436f642ac9df15ab9b67c2aafee61b8472eb9fdcca93d8199e4c7470b9bb2d342293193f181186fea7cfa12371c260481fef3367a0d4daf325be466df2219560e80a081d72e0e1de9d04</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">æ‚¨å¥½ï¼Œè¿™ç¯‡æ–‡ç« æ˜¯éœ€è¦å¯†ç çš„ã€‚</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ€»ç»“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ ‡ç­¾ Tag Plugins</title>
      <link href="/2023/11/04/TagPlugins/"/>
      <url>/2023/11/04/TagPlugins/</url>
      
        <content type="html"><![CDATA[<h2 id="æ®µè½æ–‡æœ¬-p"><a href="#æ®µè½æ–‡æœ¬-p" class="headerlink" title="æ®µè½æ–‡æœ¬ p"></a>æ®µè½æ–‡æœ¬ p</h2><div class="tabs" id="p"><ul class="nav-tabs"><button type="button" class="tab " data-href="p-1">æ ‡ç­¾è¯­æ³•</button><button type="button" class="tab " data-href="p-2">é…ç½®å‚æ•°</button><button type="button" class="tab  active" data-href="p-3">æ ·å¼é¢„è§ˆ</button><button type="button" class="tab " data-href="p-4">ç¤ºä¾‹æºç </button></ul><div class="tab-contents"><div class="tab-item-content" id="p-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% p æ ·å¼å‚æ•°(å‚æ•°ä»¥ç©ºæ ¼åˆ’åˆ†), æ–‡æœ¬å†…å®¹ %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="p-2"><ol><li>å­—ä½“: logo, code</li><li>é¢œè‰²: <span class="p red">red</span>,<span class="p yellow">yellow</span>,<span class="p green">green</span>,<span class="p cyan">cyan</span>,<span class="p blue">blue</span>,<span class="p gray">gray</span></li><li>å¤§å°: small, h4, h3, h2, h1, large, huge, ultra</li><li>å¯¹é½æ–¹å‘: left, center, right</li></ol></div><div class="tab-item-content active" id="p-3"><ul><li>å½©è‰²æ–‡å­—<br>åœ¨ä¸€æ®µè¯ä¸­æ–¹ä¾¿æ’å…¥å„ç§é¢œè‰²çš„æ ‡ç­¾ï¼ŒåŒ…æ‹¬ï¼š<p class="p red">çº¢è‰²</p>ã€<p class="p yellow">é»„è‰²</p>ã€<p class="p green">ç»¿è‰²</p>ã€<p class="p cyan">é’è‰²</p>ã€<p class="p blue">è“è‰²</p>ã€<p class="p gray">ç°è‰²</p>ã€‚</li><li>è¶…å¤§å·æ–‡å­—<br>æ–‡æ¡£ã€Œå¼€å§‹ã€é¡µé¢ä¸­çš„æ ‡é¢˜éƒ¨åˆ†å°±æ˜¯è¶…å¤§å·æ–‡å­—ã€‚<p class="p center logo large">Volantis</p><p class="p center small">A Wonderful Theme for Hexo</p></li></ul></div><div class="tab-item-content" id="p-4"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> å½©è‰²æ–‡å­—</span><br><span class="line">  åœ¨ä¸€æ®µè¯ä¸­æ–¹ä¾¿æ’å…¥å„ç§é¢œè‰²çš„æ ‡ç­¾ï¼ŒåŒ…æ‹¬ï¼š&#123;% p red, çº¢è‰² %&#125;ã€&#123;% p yellow, é»„è‰² %&#125;ã€&#123;% p green, ç»¿è‰² %&#125;ã€&#123;% p cyan, é’è‰² %&#125;ã€&#123;% p blue, è“è‰² %&#125;ã€&#123;% p gray, ç°è‰² %&#125;ã€‚</span><br><span class="line"><span class="bullet">-</span> è¶…å¤§å·æ–‡å­—</span><br><span class="line">  æ–‡æ¡£ã€Œå¼€å§‹ã€é¡µé¢ä¸­çš„æ ‡é¢˜éƒ¨åˆ†å°±æ˜¯è¶…å¤§å·æ–‡å­—ã€‚</span><br><span class="line">  &#123;% p center logo large, Volantis %&#125;</span><br><span class="line">  &#123;% p center small, A Wonderful Theme for Hexo %&#125;</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="è¡Œå†…æ–‡æœ¬-span"><a href="#è¡Œå†…æ–‡æœ¬-span" class="headerlink" title="è¡Œå†…æ–‡æœ¬ span"></a>è¡Œå†…æ–‡æœ¬ span</h2><div class="tabs" id="span"><ul class="nav-tabs"><button type="button" class="tab " data-href="span-1">æ ‡ç­¾è¯­æ³•</button><button type="button" class="tab " data-href="span-2">é…ç½®å‚æ•°</button><button type="button" class="tab  active" data-href="span-3">æ ·å¼é¢„è§ˆ</button><button type="button" class="tab " data-href="span-4">ç¤ºä¾‹æºç </button></ul><div class="tab-contents"><div class="tab-item-content" id="span-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% span æ ·å¼å‚æ•°(å‚æ•°ä»¥ç©ºæ ¼åˆ’åˆ†), æ–‡æœ¬å†…å®¹ %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="span-2"><ol><li>å­—ä½“: logo, code</li><li>é¢œè‰²: <span class="p red">red</span>,<span class="p yellow">yellow</span>,<span class="p green">green</span>,<span class="p cyan">cyan</span>,<span class="p blue">blue</span>,<span class="p gray">gray</span></li><li>å¤§å°: small, h4, h3, h2, h1, large, huge, ultra</li><li>å¯¹é½æ–¹å‘: left, center, right</li></ol></div><div class="tab-item-content active" id="span-3"><ul><li>å½©è‰²æ–‡å­—<br>åœ¨ä¸€æ®µè¯ä¸­æ–¹ä¾¿æ’å…¥å„ç§é¢œè‰²çš„æ ‡ç­¾ï¼ŒåŒ…æ‹¬ï¼š<span class="p red">çº¢è‰²</span>ã€<span class="p yellow">é»„è‰²</span>ã€<span class="p green">ç»¿è‰²</span>ã€<span class="p cyan">é’è‰²</span>ã€<span class="p blue">è“è‰²</span>ã€<span class="p gray">ç°è‰²</span>ã€‚</li><li>è¶…å¤§å·æ–‡å­—<br>æ–‡æ¡£ã€Œå¼€å§‹ã€é¡µé¢ä¸­çš„æ ‡é¢˜éƒ¨åˆ†å°±æ˜¯è¶…å¤§å·æ–‡å­—ã€‚<br><span class="p center logo large">Volantis</span><br><span class="p center small">A Wonderful Theme for Hexo</span></li></ul></div><div class="tab-item-content" id="span-4"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> å½©è‰²æ–‡å­—</span><br><span class="line">  åœ¨ä¸€æ®µè¯ä¸­æ–¹ä¾¿æ’å…¥å„ç§é¢œè‰²çš„æ ‡ç­¾ï¼ŒåŒ…æ‹¬ï¼š&#123;% span red, çº¢è‰² %&#125;ã€&#123;% span yellow, é»„è‰² %&#125;ã€&#123;% span green, ç»¿è‰² %&#125;ã€&#123;% span cyan, é’è‰² %&#125;ã€&#123;% span blue, è“è‰² %&#125;ã€&#123;% span gray, ç°è‰² %&#125;ã€‚</span><br><span class="line"><span class="bullet">-</span> è¶…å¤§å·æ–‡å­—</span><br><span class="line">  æ–‡æ¡£ã€Œå¼€å§‹ã€é¡µé¢ä¸­çš„æ ‡é¢˜éƒ¨åˆ†å°±æ˜¯è¶…å¤§å·æ–‡å­—ã€‚</span><br><span class="line">  &#123;% span center logo large, Volantis %&#125;</span><br><span class="line">  &#123;% span center small, A Wonderful Theme for Hexo %&#125;</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="è¡Œå†…æ–‡æœ¬æ ·å¼-text"><a href="#è¡Œå†…æ–‡æœ¬æ ·å¼-text" class="headerlink" title="è¡Œå†…æ–‡æœ¬æ ·å¼ text"></a>è¡Œå†…æ–‡æœ¬æ ·å¼ text</h2><div class="tabs" id="text"><ul class="nav-tabs"><button type="button" class="tab " data-href="text-1">æ ‡ç­¾è¯­æ³•</button><button type="button" class="tab  active" data-href="text-2">æ ·å¼é¢„è§ˆ</button><button type="button" class="tab " data-href="text-3">ç¤ºä¾‹æºç </button></ul><div class="tab-contents"><div class="tab-item-content" id="text-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;% u æ–‡æœ¬å†…å®¹ %&#125;</span><br><span class="line">&#123;% emp æ–‡æœ¬å†…å®¹ %&#125;</span><br><span class="line">&#123;% wavy æ–‡æœ¬å†…å®¹ %&#125;</span><br><span class="line">&#123;% del æ–‡æœ¬å†…å®¹ %&#125;</span><br><span class="line">&#123;% kbd æ–‡æœ¬å†…å®¹ %&#125;</span><br><span class="line">&#123;% psw æ–‡æœ¬å†…å®¹ %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content active" id="text-2"><ol><li>å¸¦ <u>ä¸‹åˆ’çº¿</u> çš„æ–‡æœ¬</li><li>å¸¦ <emp>ç€é‡å·</emp> çš„æ–‡æœ¬</li><li>å¸¦ <wavy>æ³¢æµªçº¿</wavy> çš„æ–‡æœ¬</li><li>å¸¦ <del>åˆ é™¤çº¿</del> çš„æ–‡æœ¬</li><li>é”®ç›˜æ ·å¼çš„æ–‡æœ¬ <kbd>command</kbd> + <kbd>D</kbd></li><li>å¯†ç æ ·å¼çš„æ–‡æœ¬ï¼š<psw>è¿™é‡Œæ²¡æœ‰éªŒè¯ç </psw></li></ol></div><div class="tab-item-content" id="text-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> å¸¦ &#123;% u ä¸‹åˆ’çº¿ %&#125; çš„æ–‡æœ¬</span><br><span class="line"><span class="bullet">2.</span> å¸¦ &#123;% emp ç€é‡å· %&#125; çš„æ–‡æœ¬</span><br><span class="line"><span class="bullet">3.</span> å¸¦ &#123;% wavy æ³¢æµªçº¿ %&#125; çš„æ–‡æœ¬</span><br><span class="line"><span class="bullet">4.</span> å¸¦ &#123;% del åˆ é™¤çº¿ %&#125; çš„æ–‡æœ¬</span><br><span class="line"><span class="bullet">5.</span> é”®ç›˜æ ·å¼çš„æ–‡æœ¬ &#123;% kbd command %&#125; + &#123;% kbd D %&#125;</span><br><span class="line"><span class="bullet">6.</span> å¯†ç æ ·å¼çš„æ–‡æœ¬ï¼š&#123;% psw è¿™é‡Œæ²¡æœ‰éªŒè¯ç  %&#125;</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="åˆ†æ -tab"><a href="#åˆ†æ -tab" class="headerlink" title="åˆ†æ  tab"></a>åˆ†æ  tab</h2><div class="note blue anzhiyufont anzhiyu-icon-bullhorn simple"><p>åˆ†æ æ”¯æŒå†…ç½®é˜¿é‡Œå›¾æ ‡ï¼Œå¦‚æœå¼€å¯äº† <code>fontawesome</code>å¯ä»¥ä½¿ç”¨ fontawesome çš„å›¾æ ‡ï¼Œå¦åˆ™åªèƒ½ä½¿ç”¨é»˜å†…ç½®é˜¿é‡Œå›¾æ ‡</p></div><div class="tabs" id="folding"><ul class="nav-tabs"><button type="button" class="tab " data-href="folding-1">æ ‡ç­¾è¯­æ³•</button><button type="button" class="tab " data-href="folding-2">é…ç½®å‚æ•°</button><button type="button" class="tab  active" data-href="folding-3">æ ·å¼é¢„è§ˆ</button><button type="button" class="tab " data-href="folding-4">ç¤ºä¾‹æºç </button></ul><div class="tab-contents"><div class="tab-item-content" id="folding-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tabs Unique name, [index] %&#125;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab [Tab caption] [@icon] --&gt;</span><br><span class="line"></span><br><span class="line">Any content (support inline tags too).</span><br><span class="line"></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="folding-2"><ol><li>Unique name :<ul><li>é€‰é¡¹å¡å—æ ‡ç­¾çš„å”¯ä¸€åç§°ï¼Œä¸å¸¦é€—å·ã€‚</li><li>å°†åœ¨#id ä¸­ç”¨ä½œæ¯ä¸ªæ ‡ç­¾åŠå…¶ç´¢å¼•å·çš„å‰ç¼€ã€‚</li><li>å¦‚æœåç§°ä¸­åŒ…å«ç©ºæ ¼ï¼Œåˆ™å¯¹äºç”Ÿæˆ#idï¼Œæ‰€æœ‰ç©ºæ ¼å°†ç”±ç ´æŠ˜å·ä»£æ›¿ã€‚</li><li>ä»…å½“å‰å¸–å­&#x2F;é¡µé¢çš„ URL å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼</li></ul></li><li>[index]:<ul><li>æ´»åŠ¨é€‰é¡¹å¡çš„ç´¢å¼•å·ã€‚</li><li>å¦‚æœæœªæŒ‡å®šï¼Œå°†é€‰æ‹©ç¬¬ä¸€ä¸ªæ ‡ç­¾ï¼ˆ1ï¼‰ã€‚</li><li>å¦‚æœ index ä¸º-1ï¼Œåˆ™ä¸ä¼šé€‰æ‹©ä»»ä½•é€‰é¡¹å¡ã€‚</li><li>å¯é€‰å‚æ•°ã€‚</li></ul></li><li>[Tab caption]:<ul><li>å½“å‰é€‰é¡¹å¡çš„æ ‡é¢˜ã€‚</li><li>å¦‚æœæœªæŒ‡å®šæ ‡é¢˜ï¼Œåˆ™å¸¦æœ‰åˆ¶è¡¨ç¬¦ç´¢å¼•åç¼€çš„å”¯ä¸€åç§°å°†ç”¨ä½œåˆ¶è¡¨ç¬¦çš„æ ‡é¢˜ã€‚</li><li>å¦‚æœæœªæŒ‡å®šæ ‡é¢˜ï¼Œä½†æŒ‡å®šäº†å›¾æ ‡ï¼Œåˆ™æ ‡é¢˜å°†ä¸ºç©ºã€‚</li><li>å¯é€‰å‚æ•°ã€‚</li></ul></li><li>[@icon]: - FontAwesome å›¾æ ‡åç§°ï¼ˆå…¨åï¼Œçœ‹èµ·æ¥åƒâ€œ fas fa-fontâ€ï¼‰ - å¯ä»¥æŒ‡å®šå¸¦ç©ºæ ¼æˆ–ä¸å¸¦ç©ºæ ¼ï¼› - ä¾‹å¦‚â€™Tab caption @iconâ€™ å’Œ â€˜Tab caption@iconâ€™. - å¯é€‰å‚æ•°ã€‚</li></ol></div><div class="tab-item-content active" id="folding-3"><div class="note primary flat"><p>Demo 1 - é¢„è®¾é€‰æ‹©ç¬¬ä¸€ä¸ªã€é»˜è®¤ã€‘</p></div><div class="tabs" id="test1"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="test1-1">test1 1</button><button type="button" class="tab " data-href="test1-2">test1 2</button><button type="button" class="tab " data-href="test1-3">test1 3</button></ul><div class="tab-contents"><div class="tab-item-content active" id="test1-1"><p><strong>This is Tab 1.</strong></p></div><div class="tab-item-content" id="test1-2"><p><strong>This is Tab 2.</strong></p></div><div class="tab-item-content" id="test1-3"><p><strong>This is Tab 3.</strong></p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div class="note primary flat"><p>Demo 2 - é¢„è®¾é€‰æ‹© tabs</p></div><div class="tabs" id="test2"><ul class="nav-tabs"><button type="button" class="tab " data-href="test2-1">test2 1</button><button type="button" class="tab " data-href="test2-2">test2 2</button><button type="button" class="tab  active" data-href="test2-3">test2 3</button></ul><div class="tab-contents"><div class="tab-item-content" id="test2-1"><p><strong>This is Tab 1.</strong></p></div><div class="tab-item-content" id="test2-2"><p><strong>This is Tab 2.</strong></p></div><div class="tab-item-content active" id="test2-3"><p><strong>This is Tab 3.</strong></p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div class="note primary flat"><p>Demo 3 - æ²¡æœ‰é¢„è®¾å€¼</p></div><div class="tabs" id="test3"><ul class="nav-tabs no-default"><button type="button" class="tab " data-href="test3-1">test3 1</button><button type="button" class="tab " data-href="test3-2">test3 2</button><button type="button" class="tab " data-href="test3-3">test3 3</button></ul><div class="tab-contents"><div class="tab-item-content" id="test3-1"><p><strong>This is Tab 1.</strong></p></div><div class="tab-item-content" id="test3-2"><p><strong>This is Tab 2.</strong></p></div><div class="tab-item-content" id="test3-3"><p><strong>This is Tab 3.</strong></p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div class="note primary flat"><p>Demo 4 - è‡ªå®šä¹‰ Tab å + åªæœ‰ icon + icon å’Œ Tab å</p></div><div class="tabs" id="test4"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="test4-1">ç¬¬ä¸€ä¸ªTab</button><button type="button" class="tab " data-href="test4-2"><i class="anzhiyufont anzhiyu-icon-oranges" style="text-align: center;"></i></button><button type="button" class="tab " data-href="test4-3"><i class="anzhiyufont anzhiyu-icon-oranges"></i>ç‚¸å¼¹</button></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><p><strong>tab åå­—ä¸ºç¬¬ä¸€ä¸ª Tab</strong></p></div><div class="tab-item-content" id="test4-2"><p><strong>åªæœ‰å›¾æ ‡ æ²¡æœ‰ Tab åå­—</strong></p></div><div class="tab-item-content" id="test4-3"><p><strong>åå­—+icon</strong></p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div></div><div class="tab-item-content" id="folding-4"><div class="note primary flat"><p>Demo 1 - é¢„è®¾é€‰æ‹©ç¬¬ä¸€ä¸ªã€é»˜è®¤ã€‘</p></div><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tabs test1 %&#125;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"></span><br><span class="line"><span class="strong">**This is Tab 1.**</span></span><br><span class="line"></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"></span><br><span class="line"><span class="strong">**This is Tab 2.**</span></span><br><span class="line"></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"></span><br><span class="line"><span class="strong">**This is Tab 3.**</span></span><br><span class="line"></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure><div class="note primary flat"><p>Demo 2 - é¢„è®¾é€‰æ‹© tabs</p></div><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tabs test2, 3 %&#125;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"></span><br><span class="line"><span class="strong">**This is Tab 1.**</span></span><br><span class="line"></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"></span><br><span class="line"><span class="strong">**This is Tab 2.**</span></span><br><span class="line"></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"></span><br><span class="line"><span class="strong">**This is Tab 3.**</span></span><br><span class="line"></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure><div class="note primary flat"><p>Demo 3 - æ²¡æœ‰é¢„è®¾å€¼</p></div><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tabs test3, -1 %&#125;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"></span><br><span class="line"><span class="strong">**This is Tab 1.**</span></span><br><span class="line"></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"></span><br><span class="line"><span class="strong">**This is Tab 2.**</span></span><br><span class="line"></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab --&gt;</span><br><span class="line"></span><br><span class="line"><span class="strong">**This is Tab 3.**</span></span><br><span class="line"></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure><div class="note primary flat"><p>Demo 4 - è‡ªå®šä¹‰ Tab å + åªæœ‰ icon + icon å’Œ Tab å</p></div><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tabs test4 %&#125;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab ç¬¬ä¸€ä¸ªTab --&gt;</span><br><span class="line"></span><br><span class="line"><span class="strong">**tab åå­—ä¸ºç¬¬ä¸€ä¸ª Tab**</span></span><br><span class="line"></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab @fab fa-apple-pay --&gt;</span><br><span class="line"></span><br><span class="line"><span class="strong">**åªæœ‰å›¾æ ‡ æ²¡æœ‰ Tab åå­—**</span></span><br><span class="line"></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tab ç‚¸å¼¹@fas fa-bomb --&gt;</span><br><span class="line"></span><br><span class="line"><span class="strong">**åå­—+icon**</span></span><br><span class="line"></span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line"></span><br><span class="line">&#123;% endtabs %&#125;</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="æŒ‰é’®-btns"><a href="#æŒ‰é’®-btns" class="headerlink" title="æŒ‰é’® btns"></a>æŒ‰é’® btns</h2><div class="tabs" id="btns"><ul class="nav-tabs"><button type="button" class="tab " data-href="btns-1">æ ‡ç­¾è¯­æ³•</button><button type="button" class="tab " data-href="btns-2">å‚æ•°é…ç½®</button><button type="button" class="tab  active" data-href="btns-3">æ ·å¼é¢„è§ˆ</button><button type="button" class="tab " data-href="btns-4">ç¤ºä¾‹æºç </button></ul><div class="tab-contents"><div class="tab-item-content" id="btns-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% btns æ ·å¼å‚æ•° %&#125;</span><br><span class="line">&#123;% cell æ ‡é¢˜, é“¾æ¥, å›¾ç‰‡æˆ–è€…å›¾æ ‡ %&#125;</span><br><span class="line">&#123;% cell æ ‡é¢˜, é“¾æ¥, å›¾ç‰‡æˆ–è€…å›¾æ ‡ %&#125;</span><br><span class="line">&#123;% endbtns %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="btns-2"><ol><li>åœ†è§’æ ·å¼ï¼šrounded, circle</li><li>å¢åŠ æ–‡å­—æ ·å¼ï¼šå¯ä»¥åœ¨å®¹å™¨å†…å¢åŠ  <code>&lt;b&gt;æ ‡é¢˜&lt;/b&gt; </code>å’Œ<code> &lt;p&gt;æè¿°æ–‡å­—&lt;/p&gt;</code></li><li>å¸ƒå±€æ–¹å¼ï¼š<br>é»˜è®¤ä¸ºè‡ªåŠ¨å®½åº¦ï¼Œé€‚åˆè§†é‡å†…åªæœ‰ä¸€ä¸¤ä¸ªçš„æƒ…å†µã€‚</li></ol><table><thead><tr><th align="left">å‚æ•°</th><th align="left">å«ä¹‰</th></tr></thead><tbody><tr><td align="left">wide</td><td align="left">å®½ä¸€ç‚¹çš„æŒ‰é’®</td></tr><tr><td align="left">fill</td><td align="left">å¡«å……å¸ƒå±€ï¼Œè‡ªåŠ¨é“ºæ»¡è‡³å°‘ä¸€è¡Œï¼Œå¤šäº†ä¼šæ¢è¡Œ</td></tr><tr><td align="left">center</td><td align="left">å±…ä¸­ï¼ŒæŒ‰é’®ä¹‹é—´æ˜¯å›ºå®šé—´è·</td></tr><tr><td align="left">around</td><td align="left">å±…ä¸­åˆ†æ•£</td></tr><tr><td align="left">grid2</td><td align="left">ç­‰å®½æœ€å¤š 2 åˆ—ï¼Œå±å¹•å˜çª„ä¼šé€‚å½“å‡å°‘åˆ—æ•°</td></tr><tr><td align="left">grid3</td><td align="left">ç­‰å®½æœ€å¤š 3 åˆ—ï¼Œå±å¹•å˜çª„ä¼šé€‚å½“å‡å°‘åˆ—æ•°</td></tr><tr><td align="left">grid4</td><td align="left">ç­‰å®½æœ€å¤š 4 åˆ—ï¼Œå±å¹•å˜çª„ä¼šé€‚å½“å‡å°‘åˆ—æ•°</td></tr><tr><td align="left">grid5</td><td align="left">ç­‰å®½æœ€å¤š 5 åˆ—ï¼Œå±å¹•å˜çª„ä¼šé€‚å½“å‡å°‘åˆ—æ•°</td></tr></tbody></table></div><div class="tab-item-content active" id="btns-3"><ol><li>å¦‚æœéœ€è¦æ˜¾ç¤ºç±»ä¼¼ã€Œå›¢é˜Ÿæˆå‘˜ã€ä¹‹ç±»çš„ä¸€ç»„å«æœ‰å¤´åƒçš„é“¾æ¥ï¼š</li></ol><div class="btns circle grid5">            <a class="button no-text-decoration" href="https://xaoxuu.com" title="xaoxuu"><img src="https://bu.dusays.com/2023/06/01/64787e6a5816d.png">xaoxuu</a><a class="button no-text-decoration" href="https://xaoxuu.com" title="xaoxuu"><img src="https://bu.dusays.com/2023/06/01/64787e6a5816d.png">xaoxuu</a><a class="button no-text-decoration" href="https://xaoxuu.com" title="xaoxuu"><img src="https://bu.dusays.com/2023/06/01/64787e6a5816d.png">xaoxuu</a><a class="button no-text-decoration" href="https://xaoxuu.com" title="xaoxuu"><img src="https://bu.dusays.com/2023/06/01/64787e6a5816d.png">xaoxuu</a><a class="button no-text-decoration" href="https://xaoxuu.com" title="xaoxuu"><img src="https://bu.dusays.com/2023/06/01/64787e6a5816d.png">xaoxuu</a>          </div><ol start="2"><li>æˆ–è€…å«æœ‰å›¾æ ‡çš„æŒ‰é’®ï¼š</li></ol><div class="btns rounded grid5">            <a class="button no-text-decoration" href="/" title="ä¸‹è½½æºç "><i class="anzhiyufont anzhiyu-icon-bolt"></i>ä¸‹è½½æºç </a><a class="button no-text-decoration" href="/" title="æŸ¥çœ‹æ–‡æ¡£"><i class="anzhiyufont anzhiyu-icon-book"></i>æŸ¥çœ‹æ–‡æ¡£</a>          </div><ol start="3"><li>åœ†å½¢å›¾æ ‡ + æ ‡é¢˜ + æè¿° + å›¾ç‰‡ + ç½‘æ ¼ 5 åˆ— + å±…ä¸­</li></ol><div class="btns circle center grid5">            <a href="https://apps.apple.com/cn/app/heart-mate-pro-hrm-utility/id1463348922?ls=1" class="no-text-decoration"><i class="anzhiyufont anzhiyu-icon-heartbeat"></i><b>å¿ƒç‡ç®¡å®¶</b><p class="p red">ä¸“ä¸šç‰ˆ</p><img src="https://cdn1.tianli0.top/gh/xaoxuu/cdn-assets/qrcode/heartmate_pro.png"></a><a href="https://apps.apple.com/cn/app/heart-mate-lite-hrm-utility/id1475747930?ls=1" class="no-text-decoration"><i class="anzhiyufont anzhiyu-icon-heartbeat"></i><b>å¿ƒç‡ç®¡å®¶</b><p class="p green">å…è´¹ç‰ˆ</p><img src="https://cdn1.tianli0.top/gh/xaoxuu/cdn-assets/qrcode/heartmate_lite.png"></a>          </div></div><div class="tab-item-content" id="btns-4"><ol><li>å¦‚æœéœ€è¦æ˜¾ç¤ºç±»ä¼¼ã€Œå›¢é˜Ÿæˆå‘˜ã€ä¹‹ç±»çš„ä¸€ç»„å«æœ‰å¤´åƒçš„é“¾æ¥ï¼š</li></ol><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% btns circle grid5 %&#125;</span><br><span class="line">&#123;% cell xaoxuu, https://xaoxuu.com, https://bu.dusays.com/2023/06/01/64787e6a5816d.png %&#125;</span><br><span class="line">&#123;% cell xaoxuu, https://xaoxuu.com, https://bu.dusays.com/2023/06/01/64787e6a5816d.png %&#125;</span><br><span class="line">&#123;% cell xaoxuu, https://xaoxuu.com, https://bu.dusays.com/2023/06/01/64787e6a5816d.png %&#125;</span><br><span class="line">&#123;% cell xaoxuu, https://xaoxuu.com, https://bu.dusays.com/2023/06/01/64787e6a5816d.png %&#125;</span><br><span class="line">&#123;% cell xaoxuu, https://xaoxuu.com, https://bu.dusays.com/2023/06/01/64787e6a5816d.png %&#125;</span><br><span class="line">&#123;% endbtns %&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>æˆ–è€…å«æœ‰å›¾æ ‡çš„æŒ‰é’®ï¼š</li></ol><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% btns rounded grid5 %&#125;</span><br><span class="line">&#123;% cell ä¸‹è½½æºç , /, anzhiyufont anzhiyu-icon-bolt %&#125;</span><br><span class="line">&#123;% cell æŸ¥çœ‹æ–‡æ¡£, /, anzhiyufont anzhiyu-icon-book %&#125;</span><br><span class="line">&#123;% endbtns %&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>åœ†å½¢å›¾æ ‡ + æ ‡é¢˜ + æè¿° + å›¾ç‰‡ + ç½‘æ ¼ 5 åˆ— + å±…ä¸­</li></ol><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;% btns circle center grid5 %&#125;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#x27;https://apps.apple.com/cn/app/heart-mate-pro-hrm-utility/id1463348922?ls=1&#x27;</span> <span class="attr">class</span>=<span class="string">&quot;no-text-decoration&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&#x27;anzhiyufont anzhiyu-icon-heartbeat&#x27;</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">b</span>&gt;</span></span>å¿ƒç‡ç®¡å®¶<span class="language-xml"><span class="tag">&lt;/<span class="name">b</span>&gt;</span></span></span><br><span class="line">&#123;% p red, ä¸“ä¸šç‰ˆ %&#125;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;https://bu.dusays.com/2023/06/01/64787e2a1347c.png&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#x27;https://apps.apple.com/cn/app/heart-mate-lite-hrm-utility/id1475747930?ls=1&#x27;</span> <span class="attr">class</span>=<span class="string">&quot;no-text-decoration&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&#x27;anzhiyufont anzhiyu-icon-heartbeat&#x27;</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">b</span>&gt;</span></span>å¿ƒç‡ç®¡å®¶<span class="language-xml"><span class="tag">&lt;/<span class="name">b</span>&gt;</span></span></span><br><span class="line">&#123;% p green, å…è´¹ç‰ˆ %&#125;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;https://bu.dusays.com/2023/06/01/64787e515e261.png&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">&#123;% endbtns %&#125;</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="æŒ‰é’®-btn"><a href="#æŒ‰é’®-btn" class="headerlink" title="æŒ‰é’® btn"></a>æŒ‰é’® btn</h2><div class="tabs" id="btn"><ul class="nav-tabs"><button type="button" class="tab " data-href="btn-1">æ ‡ç­¾è¯­æ³•</button><button type="button" class="tab " data-href="btn-2">å‚æ•°é…ç½®</button><button type="button" class="tab  active" data-href="btn-3">æ ·å¼é¢„è§ˆ</button><button type="button" class="tab " data-href="btn-4">ç¤ºä¾‹æºç </button></ul><div class="tab-contents"><div class="tab-item-content" id="btn-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;% btn [url],[text],[icon],[color] [style] [layout] [position] [size] %&#125;</span><br><span class="line"></span><br><span class="line">[url] : é“¾æ¥</span><br><span class="line">[text] : æŒ‰é’®æ–‡å­—</span><br><span class="line">[icon] : [å¯é€‰] å›¾æ ‡</span><br><span class="line">[color] : [å¯é€‰] æŒ‰é’®èƒŒæ™¯é¡”è‰²(é»˜è®¤ style æ—¶ï¼‰</span><br><span class="line">æŒ‰é’®å­—ä½“å’Œè¾¹æ¡†é¡”è‰²(outline æ—¶)</span><br><span class="line">default/blue/pink/red/purple/orange/green</span><br><span class="line">[style] : [å¯é€‰] æŒ‰é’®æ ·å¼ é»˜è®¤å®å¿ƒ</span><br><span class="line">outline/ç•™ç©º</span><br><span class="line">[layout] : [å¯é€‰] æŒ‰é’®ä½ˆå±€ é»˜è®¤ä¸º line</span><br><span class="line">block/ç•™ç©º</span><br><span class="line">[position] : [å¯é€‰] æŒ‰é’®ä½ç½® å‰ææ˜¯è®¾ç½®äº† layout ä¸º block é»˜è®¤ä¸ºå·¦è¾¹</span><br><span class="line">center/right/ç•™ç©º</span><br><span class="line">[size] : [å¯é€‰] æŒ‰é’®å¤§å°</span><br><span class="line">larger/ç•™ç©º</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="btn-2"><table><thead><tr><th align="left">å‚æ•°</th><th align="left">å«ä¹‰</th></tr></thead><tbody><tr><td align="left">url</td><td align="left">é“¾æ¥</td></tr><tr><td align="left">text</td><td align="left">æŒ‰é’®æ–‡å­—</td></tr><tr><td align="left">icon</td><td align="left">[å¯é€‰] å›¾æ ‡ï¼Œå¦‚æœå¼€å¯äº† <code>fontawesome</code>å¯ä»¥ä½¿ç”¨ fontawesome çš„å›¾æ ‡ï¼Œå¦åˆ™åªèƒ½ä½¿ç”¨é»˜å†…ç½®å›¾æ ‡</td></tr><tr><td align="left">color</td><td align="left">[å¯é€‰] æŒ‰é’®èƒŒæ™¯é¡”è‰²(é»˜è®¤ style æ—¶ï¼‰æŒ‰é’®å­—ä½“å’Œè¾¹æ¡†é¡”è‰²(outline æ—¶)default&#x2F;blue&#x2F;pink&#x2F;red&#x2F;purple&#x2F;orange&#x2F;green</td></tr><tr><td align="left">style</td><td align="left">[å¯é€‰] æŒ‰é’®æ ·å¼ é»˜è®¤å®å¿ƒæ•°ï¼Œoutline&#x2F;ç•™ç©º</td></tr><tr><td align="left">layout</td><td align="left">[å¯é€‰] æŒ‰é’®ä½ˆå±€ é»˜è®¤ä¸º line block&#x2F;ç•™ç©º</td></tr><tr><td align="left">position</td><td align="left">[å¯é€‰] æŒ‰é’®ä½ç½® å‰ææ˜¯è®¾ç½®äº† layout ä¸º block é»˜è®¤ä¸ºå·¦è¾¹ center&#x2F;right&#x2F;ç•™ç©ºæ•°</td></tr><tr><td align="left">size</td><td align="left">[å¯é€‰] æŒ‰é’®å¤§å° larger&#x2F;ç•™ç©º</td></tr></tbody></table></div><div class="tab-item-content active" id="btn-3"><ol><li>ä¸€ç»„æŒ‰é’®</li></ol><p>This is my website, click the button <a class="btn-anzhiyu " href="https://anheyu.com/" title="AnZhiYu"><span>AnZhiYu</span></a><br>This is my website, click the button <a class="btn-anzhiyu " href="https://anheyu.com/" title="AnZhiYu"><i class="anzhiyufont anzhiyu-icon-circle-arrow-right"></i><span>AnZhiYu</span></a><br>This is my website, click the button <a class="btn-anzhiyu outline" href="https://anheyu.com/" title="AnZhiYu"><span>AnZhiYu</span></a><br>This is my website, click the button <a class="btn-anzhiyu outline" href="https://anheyu.com/" title="AnZhiYu"><i class="anzhiyufont anzhiyu-icon-circle-arrow-right"></i><span>AnZhiYu</span></a><br>This is my website, click the button <a class="btn-anzhiyu larger" href="https://anheyu.com/" title="AnZhiYu"><i class="anzhiyufont anzhiyu-icon-circle-arrow-right"></i><span>AnZhiYu</span></a></p><ol start="2"><li>è°ƒæ•´ä½ç½®&#x2F;å¤§å°</li></ol><p><a class="btn-anzhiyu block" href="https://anheyu.com/" title="AnZhiYu"><i class="anzhiyufont anzhiyu-icon-circle-arrow-right"></i><span>AnZhiYu</span></a><br><a class="btn-anzhiyu block center larger" href="https://anheyu.com/" title="AnZhiYu"><i class="anzhiyufont anzhiyu-icon-circle-arrow-right"></i><span>AnZhiYu</span></a><br><a class="btn-anzhiyu block right outline larger" href="https://anheyu.com/" title="AnZhiYu"><i class="anzhiyufont anzhiyu-icon-circle-arrow-right"></i><span>AnZhiYu</span></a></p><ol start="3"><li>more than one button in center</li></ol><span><a class="btn-anzhiyu larger" href="https://anheyu.com/" title="AnZhiYu"><i class="anzhiyufont anzhiyu-icon-circle-arrow-right"></i><span>AnZhiYu</span></a><a class="btn-anzhiyu blue larger" href="https://anheyu.com/" title="AnZhiYu"><i class="anzhiyufont anzhiyu-icon-circle-arrow-right"></i><span>AnZhiYu</span></a><a class="btn-anzhiyu pink larger" href="https://anheyu.com/" title="AnZhiYu"><i class="anzhiyufont anzhiyu-icon-circle-arrow-right"></i><span>AnZhiYu</span></a><a class="btn-anzhiyu red larger" href="https://anheyu.com/" title="AnZhiYu"><i class="anzhiyufont anzhiyu-icon-circle-arrow-right"></i><span>AnZhiYu</span></a><a class="btn-anzhiyu purple larger" href="https://anheyu.com/" title="AnZhiYu"><i class="anzhiyufont anzhiyu-icon-circle-arrow-right"></i><span>AnZhiYu</span></a><a class="btn-anzhiyu orange larger" href="https://anheyu.com/" title="AnZhiYu"><i class="anzhiyufont anzhiyu-icon-circle-arrow-right"></i><span>AnZhiYu</span></a><a class="btn-anzhiyu green larger" href="https://anheyu.com/" title="AnZhiYu"><i class="anzhiyufont anzhiyu-icon-circle-arrow-right"></i><span>AnZhiYu</span></a></span><ol start="4"><li>å±…ä¸­æŒ‰é’®</li></ol><div class="btn-center"><a class="btn-anzhiyu outline larger" href="https://anheyu.com/" title="AnZhiYu"><i class="anzhiyufont anzhiyu-icon-circle-arrow-right"></i><span>AnZhiYu</span></a><a class="btn-anzhiyu outline blue larger" href="https://anheyu.com/" title="AnZhiYu"><i class="anzhiyufont anzhiyu-icon-circle-arrow-right"></i><span>AnZhiYu</span></a><a class="btn-anzhiyu outline pink larger" href="https://anheyu.com/" title="AnZhiYu"><i class="anzhiyufont anzhiyu-icon-circle-arrow-right"></i><span>AnZhiYu</span></a><a class="btn-anzhiyu outline red larger" href="https://anheyu.com/" title="AnZhiYu"><i class="anzhiyufont anzhiyu-icon-circle-arrow-right"></i><span>AnZhiYu</span></a><a class="btn-anzhiyu outline purple larger" href="https://anheyu.com/" title="AnZhiYu"><i class="anzhiyufont anzhiyu-icon-circle-arrow-right"></i><span>AnZhiYu</span></a><a class="btn-anzhiyu outline orange larger" href="https://anheyu.com/" title="AnZhiYu"><i class="anzhiyufont anzhiyu-icon-circle-arrow-right"></i><span>AnZhiYu</span></a><a class="btn-anzhiyu outline green larger" href="https://anheyu.com/" title="AnZhiYu"><i class="anzhiyufont anzhiyu-icon-circle-arrow-right"></i><span>AnZhiYu</span></a></div></div><div class="tab-item-content" id="btn-4"><ol><li>ä¸€ç»„æŒ‰é’®</li></ol><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">This is my website, click the button &#123;% btn &#x27;https://anheyu.com/&#x27;,AnZhiYu %&#125;</span><br><span class="line">This is my website, click the button &#123;% btn &#x27;https://anheyu.com/&#x27;,AnZhiYu,anzhiyufont anzhiyu-icon-circle-arrow-right %&#125;</span><br><span class="line">This is my website, click the button &#123;% btn &#x27;https://anheyu.com/&#x27;,AnZhiYu,,outline %&#125;</span><br><span class="line">This is my website, click the button &#123;% btn &#x27;https://anheyu.com/&#x27;,AnZhiYu,anzhiyufont anzhiyu-icon-circle-arrow-right,outline %&#125;</span><br><span class="line">This is my website, click the button &#123;% btn &#x27;https://anheyu.com/&#x27;,AnZhiYu,anzhiyufont anzhiyu-icon-circle-arrow-right,larger %&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>è°ƒæ•´ä½ç½®&#x2F;å¤§å°</li></ol><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% btn &#x27;https://anheyu.com/&#x27;,AnZhiYu,anzhiyufont anzhiyu-icon-circle-arrow-right,block %&#125;</span><br><span class="line">&#123;% btn &#x27;https://anheyu.com/&#x27;,AnZhiYu,anzhiyufont anzhiyu-icon-circle-arrow-right,block center larger %&#125;</span><br><span class="line">&#123;% btn &#x27;https://anheyu.com/&#x27;,AnZhiYu,anzhiyufont anzhiyu-icon-circle-arrow-right,block right outline larger %&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>more than one button in center</li></ol><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span></span></span><br><span class="line">&#123;% btn &#x27;https://anheyu.com/&#x27;,AnZhiYu,anzhiyufont anzhiyu-icon-circle-arrow-right,larger %&#125;</span><br><span class="line">&#123;% btn &#x27;https://anheyu.com/&#x27;,AnZhiYu,anzhiyufont anzhiyu-icon-circle-arrow-right,blue larger %&#125;</span><br><span class="line">&#123;% btn &#x27;https://anheyu.com/&#x27;,AnZhiYu,anzhiyufont anzhiyu-icon-circle-arrow-right,pink larger %&#125;</span><br><span class="line">&#123;% btn &#x27;https://anheyu.com/&#x27;,AnZhiYu,anzhiyufont anzhiyu-icon-circle-arrow-right,red larger %&#125;</span><br><span class="line">&#123;% btn &#x27;https://anheyu.com/&#x27;,AnZhiYu,anzhiyufont anzhiyu-icon-circle-arrow-right,purple larger %&#125;</span><br><span class="line">&#123;% btn &#x27;https://anheyu.com/&#x27;,AnZhiYu,anzhiyufont anzhiyu-icon-circle-arrow-right,orange larger %&#125;</span><br><span class="line">&#123;% btn &#x27;https://anheyu.com/&#x27;,AnZhiYu,anzhiyufont anzhiyu-icon-circle-arrow-right,green larger %&#125;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br></pre></td></tr></table></figure><ol start="4"><li>å±…ä¸­æŒ‰é’®</li></ol><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;btn-center&quot;</span>&gt;</span></span></span><br><span class="line">&#123;% btn &#x27;https://anheyu.com/&#x27;,AnZhiYu,anzhiyufont anzhiyu-icon-circle-arrow-right,outline larger %&#125;</span><br><span class="line">&#123;% btn &#x27;https://anheyu.com/&#x27;,AnZhiYu,anzhiyufont anzhiyu-icon-circle-arrow-right,outline blue larger %&#125;</span><br><span class="line">&#123;% btn &#x27;https://anheyu.com/&#x27;,AnZhiYu,anzhiyufont anzhiyu-icon-circle-arrow-right,outline pink larger %&#125;</span><br><span class="line">&#123;% btn &#x27;https://anheyu.com/&#x27;,AnZhiYu,anzhiyufont anzhiyu-icon-circle-arrow-right,outline red larger %&#125;</span><br><span class="line">&#123;% btn &#x27;https://anheyu.com/&#x27;,AnZhiYu,anzhiyufont anzhiyu-icon-circle-arrow-right,outline purple larger %&#125;</span><br><span class="line">&#123;% btn &#x27;https://anheyu.com/&#x27;,AnZhiYu,anzhiyufont anzhiyu-icon-circle-arrow-right,outline orange larger %&#125;</span><br><span class="line">&#123;% btn &#x27;https://anheyu.com/&#x27;,AnZhiYu,anzhiyufont anzhiyu-icon-circle-arrow-right,outline green larger %&#125;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="ç½‘ç«™å¡ç‰‡-sites"><a href="#ç½‘ç«™å¡ç‰‡-sites" class="headerlink" title="ç½‘ç«™å¡ç‰‡ sites"></a>ç½‘ç«™å¡ç‰‡ sites</h2><div class="tabs" id="site"><ul class="nav-tabs"><button type="button" class="tab " data-href="site-1">æ ‡ç­¾è¯­æ³•</button><button type="button" class="tab  active" data-href="site-2">æ ·å¼é¢„è§ˆ</button><button type="button" class="tab " data-href="site-3">ç¤ºä¾‹æºç </button></ul><div class="tab-contents"><div class="tab-item-content" id="site-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% sitegroup %&#125;</span><br><span class="line">&#123;% site æ ‡é¢˜, url=é“¾æ¥, screenshot=æˆªå›¾é“¾æ¥, avatar=å¤´åƒé“¾æ¥ï¼ˆå¯é€‰ï¼‰, description=æè¿°ï¼ˆå¯é€‰ï¼‰ %&#125;</span><br><span class="line">&#123;% site æ ‡é¢˜, url=é“¾æ¥, screenshot=æˆªå›¾é“¾æ¥, avatar=å¤´åƒé“¾æ¥ï¼ˆå¯é€‰ï¼‰, description=æè¿°ï¼ˆå¯é€‰ï¼‰ %&#125;</span><br><span class="line">&#123;% endsitegroup %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content active" id="site-2"><div class="site-card-group"><a class="site-card" href="https://xaoxuu.com" data-title="ç®€çº¦é£æ ¼"><div class="wrapper cover"><img class="cover fadeIn" src="https://bu.dusays.com/2023/06/01/6478965ce6557.webp"></div><div class="info"><img class="flink-avatar" src="https://cdn1.tianli0.top/gh/xaoxuu/cdn-assets/avatar/avatar.png"><span class="site-title">xaoxuu</span></div></a><a class="site-card" href="https://colsrch.top" data-title="è¿™æ˜¯ä¸€æ®µå…³äºè¿™ä¸ªç½‘ç«™çš„æè¿°æ–‡å­—"><div class="wrapper cover"><img class="cover fadeIn" src="https://i.loli.net/2020/08/22/dFRWXm52OVu8qfK.png"></div><div class="info"><img class="flink-avatar" src="https://cdn1.tianli0.top/gh/Colsrch/images/Colsrch/avatar.jpg"><span class="site-title">Colsrch</span></div></a><a class="site-card" href="https://linhk1606.github.io" data-title="è¿™æ˜¯ä¸€æ®µå…³äºè¿™ä¸ªç½‘ç«™çš„æè¿°æ–‡å­—"><div class="wrapper cover"><img class="cover fadeIn" src="https://bu.dusays.com/2023/06/01/6478963584621.png"></div><div class="info"><img class="flink-avatar" src="https://bu.dusays.com/2023/06/01/6478968743368.png"><span class="site-title">Linhk1606</span></div></a></div></div><div class="tab-item-content" id="site-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% sitegroup %&#125;</span><br><span class="line">&#123;% site xaoxuu, url=https://xaoxuu.com, screenshot=https://bu.dusays.com/2023/06/01/6478965ce6557.webp, avatar=https://cdn1.tianli0.top/gh/xaoxuu/cdn-assets/avatar/avatar.png, description=ç®€çº¦é£æ ¼ %&#125;</span><br><span class="line">&#123;% site Colsrch, url=https://colsrch.top, screenshot=https://i.loli.net/2020/08/22/dFRWXm52OVu8qfK.png, avatar=https://cdn1.tianli0.top/gh/Colsrch/images/Colsrch/avatar.jpg, description=è¿™æ˜¯ä¸€æ®µå…³äºè¿™ä¸ªç½‘ç«™çš„æè¿°æ–‡å­— %&#125;</span><br><span class="line">&#123;% site Linhk1606, url=https://linhk1606.github.io, screenshot=https://bu.dusays.com/2023/06/01/6478963584621.png, avatar=https://bu.dusays.com/2023/06/01/6478968743368.png, description=è¿™æ˜¯ä¸€æ®µå…³äºè¿™ä¸ªç½‘ç«™çš„æè¿°æ–‡å­— %&#125;</span><br><span class="line">&#123;% endsitegroup %&#125;</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="å•å¼ å›¾ç‰‡-image"><a href="#å•å¼ å›¾ç‰‡-image" class="headerlink" title="å•å¼ å›¾ç‰‡ image"></a>å•å¼ å›¾ç‰‡ image</h2><div class="tabs" id="image"><ul class="nav-tabs"><button type="button" class="tab " data-href="image-1">æ ‡ç­¾è¯­æ³•</button><button type="button" class="tab " data-href="image-2">å‚æ•°é…ç½®</button><button type="button" class="tab  active" data-href="image-3">æ ·å¼é¢„è§ˆ</button><button type="button" class="tab " data-href="image-4">ç¤ºä¾‹æºç </button></ul><div class="tab-contents"><div class="tab-item-content" id="image-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% image é“¾æ¥, width=å®½åº¦ï¼ˆå¯é€‰ï¼‰, height=é«˜åº¦ï¼ˆå¯é€‰ï¼‰, alt=æè¿°ï¼ˆå¯é€‰ï¼‰, bg=å ä½é¢œè‰²ï¼ˆå¯é€‰ï¼‰ %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="image-2"><ol><li>å›¾ç‰‡å®½åº¦é«˜åº¦ï¼šwidth&#x3D;300px, height&#x3D;32px</li><li>å›¾ç‰‡æè¿°ï¼šalt&#x3D;å›¾ç‰‡æè¿°ï¼ˆbutterfly éœ€è¦åœ¨ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­å¼€å¯å›¾ç‰‡æè¿°ï¼‰</li><li>å ä½èƒŒæ™¯è‰²ï¼šbg&#x3D;#f2f2f2</li></ol></div><div class="tab-item-content active" id="image-3"><ol start="4"><li>æ·»åŠ æè¿°ï¼š</li></ol><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/06/01/6478937d7de6f.webp" alt="æ¯å¤©ä¸‹è¯¾å›å®¿èˆçš„è·¯ï¼Œæ²¡æœ‰ä»€ä¹ˆæ•…äº‹ã€‚"></div><span class="image-caption">æ¯å¤©ä¸‹è¯¾å›å®¿èˆçš„è·¯ï¼Œæ²¡æœ‰ä»€ä¹ˆæ•…äº‹ã€‚</span></div><ol start="2"><li>æŒ‡å®šå®½åº¦ï¼š</li></ol><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/06/01/6478937d7de6f.webp" style="width:400px;"></div></div><ol start="3"><li>æŒ‡å®šå®½åº¦å¹¶æ·»åŠ æè¿°ï¼š</li></ol><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/06/01/6478937d7de6f.webp" alt="æ¯å¤©ä¸‹è¯¾å›å®¿èˆçš„è·¯ï¼Œæ²¡æœ‰ä»€ä¹ˆæ•…äº‹ã€‚" style="width:400px;"></div><span class="image-caption">æ¯å¤©ä¸‹è¯¾å›å®¿èˆçš„è·¯ï¼Œæ²¡æœ‰ä»€ä¹ˆæ•…äº‹ã€‚</span></div><ol start="4"><li>è®¾ç½®å ä½èƒŒæ™¯è‰²ï¼š</li></ol><div class="img-wrap"><div class="img-bg" style="background:#1D0C04"><img class="img" src="https://bu.dusays.com/2023/06/01/6478937d7de6f.webp" alt="ä¼˜åŒ–ä¸åŒå®½åº¦æµè§ˆçš„è§‚æ„Ÿ" style="width:400px;"></div><span class="image-caption">ä¼˜åŒ–ä¸åŒå®½åº¦æµè§ˆçš„è§‚æ„Ÿ</span></div></div><div class="tab-item-content" id="image-4"><ol><li>æ·»åŠ æè¿°ï¼š</li></ol><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% image https://bu.dusays.com/2023/06/01/6478937d7de6f.webp, alt=æ¯å¤©ä¸‹è¯¾å›å®¿èˆçš„è·¯ï¼Œæ²¡æœ‰ä»€ä¹ˆæ•…äº‹ã€‚ %&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>æŒ‡å®šå®½åº¦ï¼š</li></ol><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% image https://bu.dusays.com/2023/06/01/6478937d7de6f.webp, width=400px %&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>æŒ‡å®šå®½åº¦å¹¶æ·»åŠ æè¿°ï¼š</li></ol><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% image https://bu.dusays.com/2023/06/01/6478937d7de6f.webp, width=400px, alt=æ¯å¤©ä¸‹è¯¾å›å®¿èˆçš„è·¯ï¼Œæ²¡æœ‰ä»€ä¹ˆæ•…äº‹ã€‚ %&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>è®¾ç½®å ä½èƒŒæ™¯è‰²ï¼š</li></ol><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% image https://bu.dusays.com/2023/06/01/6478937d7de6f.webp, width=400px, bg=#1D0C04, alt=ä¼˜åŒ–ä¸åŒå®½åº¦æµè§ˆçš„è§‚æ„Ÿ %&#125;</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="inlineImg-è¡Œå†…å›¾ç‰‡"><a href="#inlineImg-è¡Œå†…å›¾ç‰‡" class="headerlink" title="inlineImg è¡Œå†…å›¾ç‰‡"></a>inlineImg è¡Œå†…å›¾ç‰‡</h2><div class="tabs" id="inlineimg"><ul class="nav-tabs"><button type="button" class="tab " data-href="inlineimg-1">æ ‡ç­¾è¯­æ³•</button><button type="button" class="tab " data-href="inlineimg-2">å‚æ•°é…ç½®</button><button type="button" class="tab  active" data-href="inlineimg-3">æ ·å¼é¢„è§ˆ</button><button type="button" class="tab " data-href="inlineimg-4">ç¤ºä¾‹æºç </button></ul><div class="tab-contents"><div class="tab-item-content" id="inlineimg-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% inlineImg [src] [height] %&#125;</span><br><span class="line"></span><br><span class="line">[src] : å›¾ç‰‡é“¾æ¥</span><br><span class="line">[height] ï¼š å›¾ç‰‡é«˜åº¦é™åˆ¶ã€å¯é€‰ã€‘</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="inlineimg-2"><table><thead><tr><th align="left">å‚æ•°</th><th align="left">å«ä¹‰</th></tr></thead><tbody><tr><td align="left">src</td><td align="left">å›¾ç‰‡é“¾æ¥</td></tr><tr><td align="left">height</td><td align="left">å›¾ç‰‡é«˜åº¦é™åˆ¶ã€å¯é€‰ã€‘</td></tr></tbody></table></div><div class="tab-item-content active" id="inlineimg-3"><p>ä½ çœ‹æˆ‘é•¿å¾—æ¼‚äº®ä¸</p><p><img src="https://bu.dusays.com/2023/06/01/64787ded2ca1c.webp"></p><p>æˆ‘è§‰å¾—å¾ˆæ¼‚äº® <img class="inline-img" src="https://bu.dusays.com/2023/06/01/64787da5251b3.png" style="height:150px"></p></div><div class="tab-item-content" id="inlineimg-4"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ä½ çœ‹æˆ‘é•¿å¾—æ¼‚äº®ä¸</span><br><span class="line"></span><br><span class="line">![](https://i.loli.net/2021/03/19/2P6ivUGsdaEXSFI.png)</span><br><span class="line"></span><br><span class="line">æˆ‘è§‰å¾—å¾ˆæ¼‚äº® &#123;% inlineImg https://i.loli.net/2021/03/19/5M4jUB3ynq7ePgw.png 150px %&#125;</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="è¡Œå†…å›¾ç‰‡-inlineimage"><a href="#è¡Œå†…å›¾ç‰‡-inlineimage" class="headerlink" title="è¡Œå†…å›¾ç‰‡ inlineimage"></a>è¡Œå†…å›¾ç‰‡ inlineimage</h2><div class="tabs" id="inlineimage"><ul class="nav-tabs"><button type="button" class="tab " data-href="inlineimage-1">æ ‡ç­¾è¯­æ³•</button><button type="button" class="tab " data-href="inlineimage-2">å‚æ•°é…ç½®</button><button type="button" class="tab  active" data-href="inlineimage-3">æ ·å¼é¢„è§ˆ</button><button type="button" class="tab " data-href="inlineimage-4">ç¤ºä¾‹æºç </button></ul><div class="tab-contents"><div class="tab-item-content" id="inlineimage-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% inlineimage å›¾ç‰‡é“¾æ¥, height=é«˜åº¦ï¼ˆå¯é€‰ï¼‰ %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="inlineimage-2"><ol><li>é«˜åº¦ï¼šheight&#x3D;20px</li></ol></div><div class="tab-item-content active" id="inlineimage-3"><p>è¿™æ˜¯ <img no-lazy class="inline" src="https://bu.dusays.com/2023/06/01/647895232e5d5.webp" style="height:1.5em"> ä¸€æ®µè¯ã€‚</p><p>è¿™åˆæ˜¯ <img no-lazy class="inline" src="https://bu.dusays.com/2022/05/19/6285328a83ca7.gif" style="height:40px;"> ä¸€æ®µè¯ã€‚</p></div><div class="tab-item-content" id="inlineimage-4"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¿™æ˜¯ &#123;% inlineimage https://bu.dusays.com/2023/06/01/647895232e5d5.webp %&#125; ä¸€æ®µè¯ã€‚</span><br><span class="line"></span><br><span class="line">è¿™åˆæ˜¯ &#123;% inlineimage https://bu.dusays.com/2022/05/19/6285328a83ca7.gif, height=40px %&#125; ä¸€æ®µè¯ã€‚</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="label-æ ‡ç­¾"><a href="#label-æ ‡ç­¾" class="headerlink" title="label æ ‡ç­¾"></a>label æ ‡ç­¾</h2><div class="tabs" id="label"><ul class="nav-tabs"><button type="button" class="tab " data-href="label-1">æ ‡ç­¾è¯­æ³•</button><button type="button" class="tab " data-href="label-2">å‚æ•°é…ç½®</button><button type="button" class="tab  active" data-href="label-3">æ ·å¼é¢„è§ˆ</button><button type="button" class="tab " data-href="label-4">ç¤ºä¾‹æºç </button></ul><div class="tab-contents"><div class="tab-item-content" id="label-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% label text color %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="label-2"><table><thead><tr><th align="left">å‚æ•°</th><th align="left">å«ä¹‰</th></tr></thead><tbody><tr><td align="left">text</td><td align="left">æ–‡å­—</td></tr><tr><td align="left">color</td><td align="left">ã€å¯é€‰ã€‘èƒŒæ™¯é¢œè‰²ï¼Œé»˜è®¤ä¸º defaultï¼Œdefault&#x2F;blue&#x2F;pink&#x2F;red&#x2F;purple&#x2F;orange&#x2F;green</td></tr></tbody></table></div><div class="tab-item-content active" id="label-3"><p>è‡£äº®è¨€ï¼š<mark class="hl-label default">å…ˆå¸</mark> åˆ›ä¸šæœªåŠï¼Œè€Œ<mark class="hl-label blue">ä¸­é“å´©æ®‚</mark> ã€‚ä»Šå¤©ä¸‹ä¸‰åˆ†ï¼Œ<mark class="hl-label pink">ç›Šå·ç–²æ•</mark> ï¼Œæ­¤è¯š<mark class="hl-label red">å±æ€¥å­˜äº¡ä¹‹ç§‹</mark> ä¹Ÿï¼ç„¶ä¾è¡ä¹‹è‡£ï¼Œä¸æ‡ˆäºå†…ï¼›<mark class="hl-label purple">å¿ å¿—ä¹‹å£«</mark> ï¼Œå¿˜èº«äºå¤–è€…ï¼Œç›–è¿½å…ˆå¸ä¹‹æ®Šé‡ï¼Œæ¬²æŠ¥ä¹‹äºé™›ä¸‹ä¹Ÿã€‚è¯šå®œå¼€å¼ åœ£å¬ï¼Œä»¥å…‰å…ˆå¸é—å¾·ï¼Œæ¢å¼˜å¿—å£«ä¹‹æ°”ï¼›ä¸å®œå¦„è‡ªè²è–„ï¼Œå¼•å–»å¤±ä¹‰ï¼Œä»¥å¡å¿ è°ä¹‹è·¯ä¹Ÿã€‚<br>å®«ä¸­ã€åºœä¸­ï¼Œä¿±ä¸ºä¸€ä½“ï¼›é™Ÿç½šè‡§å¦ï¼Œä¸å®œå¼‚åŒã€‚è‹¥æœ‰<mark class="hl-label orange">ä½œå¥¸</mark> ã€<mark class="hl-label green">çŠ¯ç§‘</mark> ï¼ŒåŠä¸ºå¿ å–„è€…ï¼Œå®œä»˜æœ‰å¸ï¼Œè®ºå…¶åˆ‘èµï¼Œä»¥æ˜­é™›ä¸‹å¹³æ˜ä¹‹æ²»ï¼›ä¸å®œåç§ï¼Œä½¿å†…å¤–å¼‚æ³•ä¹Ÿã€‚</p></div><div class="tab-item-content" id="label-4"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è‡£äº®è¨€ï¼š&#123;% label å…ˆå¸ %&#125;åˆ›ä¸šæœªåŠï¼Œè€Œ&#123;% label ä¸­é“å´©æ®‚ blue %&#125;ã€‚ä»Šå¤©ä¸‹ä¸‰åˆ†ï¼Œ&#123;% label ç›Šå·ç–²æ• pink %&#125;ï¼Œæ­¤è¯š&#123;% label å±æ€¥å­˜äº¡ä¹‹ç§‹ red %&#125;ä¹Ÿï¼ç„¶ä¾è¡ä¹‹è‡£ï¼Œä¸æ‡ˆäºå†…ï¼›&#123;% label å¿ å¿—ä¹‹å£« purple %&#125;ï¼Œå¿˜èº«äºå¤–è€…ï¼Œç›–è¿½å…ˆå¸ä¹‹æ®Šé‡ï¼Œæ¬²æŠ¥ä¹‹äºé™›ä¸‹ä¹Ÿã€‚è¯šå®œå¼€å¼ åœ£å¬ï¼Œä»¥å…‰å…ˆå¸é—å¾·ï¼Œæ¢å¼˜å¿—å£«ä¹‹æ°”ï¼›ä¸å®œå¦„è‡ªè²è–„ï¼Œå¼•å–»å¤±ä¹‰ï¼Œä»¥å¡å¿ è°ä¹‹è·¯ä¹Ÿã€‚</span><br><span class="line">å®«ä¸­ã€åºœä¸­ï¼Œä¿±ä¸ºä¸€ä½“ï¼›é™Ÿç½šè‡§å¦ï¼Œä¸å®œå¼‚åŒã€‚è‹¥æœ‰&#123;% label ä½œå¥¸ orange %&#125;ã€&#123;% label çŠ¯ç§‘ green %&#125;ï¼ŒåŠä¸ºå¿ å–„è€…ï¼Œå®œä»˜æœ‰å¸ï¼Œè®ºå…¶åˆ‘èµï¼Œä»¥æ˜­é™›ä¸‹å¹³æ˜ä¹‹æ²»ï¼›ä¸å®œåç§ï¼Œä½¿å†…å¤–å¼‚æ³•ä¹Ÿã€‚</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="timeline"><a href="#timeline" class="headerlink" title="timeline"></a>timeline</h2><div class="tabs" id="timeline"><ul class="nav-tabs"><button type="button" class="tab " data-href="timeline-1">æ ‡ç­¾è¯­æ³•</button><button type="button" class="tab " data-href="timeline-2">å‚æ•°é…ç½®</button><button type="button" class="tab  active" data-href="timeline-3">æ ·å¼é¢„è§ˆ</button><button type="button" class="tab " data-href="timeline-4">ç¤ºä¾‹æºç </button></ul><div class="tab-contents"><div class="tab-item-content" id="timeline-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;% timeline title,color %&#125;</span><br><span class="line"></span><br><span class="line">&lt;!-- timeline title --&gt;</span><br><span class="line"></span><br><span class="line">xxxxx</span><br><span class="line"></span><br><span class="line">&lt;!-- endtimeline --&gt;</span><br><span class="line">&lt;!-- timeline title --&gt;</span><br><span class="line"></span><br><span class="line">xxxxx</span><br><span class="line"></span><br><span class="line">&lt;!-- endtimeline --&gt;</span><br><span class="line"></span><br><span class="line">&#123;% endtimeline %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="timeline-2"><table><thead><tr><th align="left">å‚æ•°</th><th align="left">å«ä¹‰</th></tr></thead><tbody><tr><td align="left">title</td><td align="left">æ ‡é¢˜&#x2F;æ—¶é—´çº¿</td></tr><tr><td align="left">color</td><td align="left">timeline é¢œè‰²ï¼Œdefault(ç•™ç©º) &#x2F; blue &#x2F; pink &#x2F; red &#x2F; purple &#x2F; orange &#x2F; green</td></tr></tbody></table></div><div class="tab-item-content active" id="timeline-3"><ol><li><p>é»˜è®¤é¢œè‰²</p><div class="timeline undefined"><div class="timeline-item headline"><div class="timeline-item-title"><div class="item-circle"><p>2022</p></div></div></div><div class="timeline-item"><div class="timeline-item-title"><div class="item-circle"><p>01-02</p></div></div><div class="timeline-item-content"><p>è¿™æ˜¯æµ‹è¯•é¡µé¢</p></div></div></div></li><li><p>blue</p><div class="timeline blue"><div class="timeline-item headline"><div class="timeline-item-title"><div class="item-circle"><p>2022</p></div></div></div><div class="timeline-item"><div class="timeline-item-title"><div class="item-circle"><p>01-02</p></div></div><div class="timeline-item-content"><p>è¿™æ˜¯æµ‹è¯•é¡µé¢</p></div></div></div></li><li><p>pink</p><div class="timeline pink"><div class="timeline-item headline"><div class="timeline-item-title"><div class="item-circle"><p>2022</p></div></div></div><div class="timeline-item"><div class="timeline-item-title"><div class="item-circle"><p>01-02</p></div></div><div class="timeline-item-content"><p>è¿™æ˜¯æµ‹è¯•é¡µé¢</p></div></div></div></li><li><p>red</p><div class="timeline red"><div class="timeline-item headline"><div class="timeline-item-title"><div class="item-circle"><p>2022</p></div></div></div><div class="timeline-item"><div class="timeline-item-title"><div class="item-circle"><p>01-02</p></div></div><div class="timeline-item-content"><p>è¿™æ˜¯æµ‹è¯•é¡µé¢</p></div></div></div></li><li><p>purple</p><div class="timeline purple"><div class="timeline-item headline"><div class="timeline-item-title"><div class="item-circle"><p>2022</p></div></div></div><div class="timeline-item"><div class="timeline-item-title"><div class="item-circle"><p>01-02</p></div></div><div class="timeline-item-content"><p>è¿™æ˜¯æµ‹è¯•é¡µé¢</p></div></div></div></li><li><p>orange</p><div class="timeline orange"><div class="timeline-item headline"><div class="timeline-item-title"><div class="item-circle"><p>2022</p></div></div></div><div class="timeline-item"><div class="timeline-item-title"><div class="item-circle"><p>01-02</p></div></div><div class="timeline-item-content"><p>è¿™æ˜¯æµ‹è¯•é¡µé¢</p></div></div></div></li><li><p>green</p><div class="timeline green"><div class="timeline-item headline"><div class="timeline-item-title"><div class="item-circle"><p>2022</p></div></div></div><div class="timeline-item"><div class="timeline-item-title"><div class="item-circle"><p>01-02</p></div></div><div class="timeline-item-content"><p>è¿™æ˜¯æµ‹è¯•é¡µé¢</p></div></div></div></li></ol></div><div class="tab-item-content" id="timeline-4"><ol><li>é»˜è®¤é¢œè‰²</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% timeline 2022 %&#125;</span><br><span class="line">&lt;!-- timeline 01-02 --&gt;</span><br><span class="line"></span><br><span class="line">è¿™æ˜¯æµ‹è¯•é¡µé¢</span><br><span class="line">&lt;!-- endtimeline --&gt;</span><br><span class="line"></span><br><span class="line">&#123;% endtimeline %&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>blue</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% timeline 2022,blue %&#125;</span><br><span class="line">&lt;!-- timeline 01-02 --&gt;</span><br><span class="line"></span><br><span class="line">è¿™æ˜¯æµ‹è¯•é¡µé¢</span><br><span class="line">&lt;!-- endtimeline --&gt;</span><br><span class="line"></span><br><span class="line">&#123;% endtimeline %&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>pink</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% timeline 2022,pink %&#125;</span><br><span class="line">&lt;!-- timeline 01-02 --&gt;</span><br><span class="line"></span><br><span class="line">è¿™æ˜¯æµ‹è¯•é¡µé¢</span><br><span class="line">&lt;!-- endtimeline --&gt;</span><br><span class="line"></span><br><span class="line">&#123;% endtimeline %&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>red</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% timeline 2022,red %&#125;</span><br><span class="line">&lt;!-- timeline 01-02 --&gt;</span><br><span class="line"></span><br><span class="line">è¿™æ˜¯æµ‹è¯•é¡µé¢</span><br><span class="line">&lt;!-- endtimeline --&gt;</span><br><span class="line"></span><br><span class="line">&#123;% endtimeline %&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li>purple</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% timeline 2022,purple %&#125;</span><br><span class="line">&lt;!-- timeline 01-02 --&gt;</span><br><span class="line"></span><br><span class="line">è¿™æ˜¯æµ‹è¯•é¡µé¢</span><br><span class="line">&lt;!-- endtimeline --&gt;</span><br><span class="line"></span><br><span class="line">&#123;% endtimeline %&#125;</span><br></pre></td></tr></table></figure><ol start="6"><li>orange</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% timeline 2022,orange %&#125;</span><br><span class="line">&lt;!-- timeline 01-02 --&gt;</span><br><span class="line"></span><br><span class="line">è¿™æ˜¯æµ‹è¯•é¡µé¢</span><br><span class="line">&lt;!-- endtimeline --&gt;</span><br><span class="line"></span><br><span class="line">&#123;% endtimeline %&#125;</span><br></pre></td></tr></table></figure><ol start="7"><li>green</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% timeline 2022,green %&#125;</span><br><span class="line">&lt;!-- timeline 01-02 --&gt;</span><br><span class="line"></span><br><span class="line">è¿™æ˜¯æµ‹è¯•é¡µé¢</span><br><span class="line">&lt;!-- endtimeline --&gt;</span><br><span class="line"></span><br><span class="line">&#123;% endtimeline %&#125;</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="flink-å‹é“¾æ ‡ç­¾"><a href="#flink-å‹é“¾æ ‡ç­¾" class="headerlink" title="flink å‹é“¾æ ‡ç­¾"></a>flink å‹é“¾æ ‡ç­¾</h2><div class="note blue anzhiyufont anzhiyu-icon-bullhorn simple"><p>å¯åœ¨ä»»ä½•ç•Œé¢æ’å…¥ç±»ä¼¼<code>å‹æƒ…é“¾æ¥</code>åˆ—è¡¨æ•ˆæœï¼Œå†…å®¹æ ¼å¼ä¸å‹æƒ…é“¾æ¥ç•Œé¢ä¸€æ ·ï¼Œæ”¯æŒ <code>yml æ ¼å¼</code>,æ³¨æ„<code>ymlæ•°æ®</code>å…·æœ‰æ ¼å¼è¦æ±‚ï¼Œè¯·æ³¨æ„æ ¼å¼å¯¹é½ï¼Œé˜²æ­¢è¢«ç¼–è¾‘å™¨æ ¼å¼åŒ–å¯¼è‡´æ ¼å¼é”™è¯¯ä»è€ŒæŠ¥é”™ã€‚</p></div><div class="tabs" id="btn"><ul class="nav-tabs"><button type="button" class="tab " data-href="btn-1">æ ‡ç­¾è¯­æ³•</button><button type="button" class="tab " data-href="btn-2">å‚æ•°é…ç½®</button><button type="button" class="tab  active" data-href="btn-3">æ ·å¼é¢„è§ˆ</button><button type="button" class="tab " data-href="btn-4">ç¤ºä¾‹æºç </button></ul><div class="tab-contents"><div class="tab-item-content" id="btn-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% flink %&#125;</span><br><span class="line">xxxxxx</span><br><span class="line">&#123;% endflink %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="btn-2"><table><thead><tr><th align="left">å‚æ•°</th><th align="left">å«ä¹‰</th></tr></thead><tbody><tr><td align="left">class_name</td><td align="left">h2 æ ‡é¢˜</td></tr><tr><td align="left">flink_style</td><td align="left">ã€å¯é€‰ã€‘å‹é“¾æ ·å¼ï¼Œé»˜è®¤ä¸º flexcardï¼Œflexcard&#x2F;anzhiyu</td></tr><tr><td align="left">link_list</td><td align="left">ã€å¯é€‰ã€‘å‹é“¾æ ·å¼ï¼Œé»˜è®¤ä¸º flexcardï¼Œflexcard&#x2F;anzhiyu</td></tr></tbody></table></div><div class="tab-item-content active" id="btn-3"><div class="flink"><div class="flink-name">æ¨èåšå®¢</div> <div class="flink-list"><div class="flexcard-flink-list">              <a href="https://anheyu.com/" title="å®‰çŸ¥é±¼" target="_blank" class="flink-list-card cf-friends-link">                <div class="wrapper cover">                    <img class="no-lightbox cover fadeIn" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/anheyu.com.jpg" onerror="this.onerror=null;this.src="/img/friend_404.gif"" alt="å®‰çŸ¥é±¼">                </div>                <div class="info">                  <img class="no-lightbox cf-friends-avatar flink-avatar" src="https://img02.anheyu.com/adminuploads/1/2022/09/15/63232b7d91d22.jpg" onerror="this.onerror=null;this.src="/img/friend_404.gif"" alt="å®‰çŸ¥é±¼">                  <span class="flink-sitename cf-friends-name">å®‰çŸ¥é±¼</span>                </div>              </a></div></div><div class="flink-name">ç½‘ç«™</div><div class="flink-desc">å€¼å¾—æ¨èçš„ç½‘ç«™</div> <div class="flink-list"><div class="anzhiyu-flink-list">            <div class="flink-list-item">              <a href="https://www.youtube.com/" title="Youtube" class="cf-friends-link" target="_blank">                <div class="flink-item-icon">                  <img class="no-lightbox cf-friends-avatar" src="https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png" onerror="this.onerror=null;this.src="/img/friend_404.gif"" alt="Youtube">                </div>                <div class="flink-item-info">                  <div class="flink-item-name">Youtube</div>                  <div class="flink-item-desc" title="è§†é¢‘ç½‘ç«™">è§†é¢‘ç½‘ç«™</div>                </div>              </a>            </div>            <div class="flink-list-item">              <a href="https://www.weibo.com/" title="Weibo" class="cf-friends-link" target="_blank">                <div class="flink-item-icon">                  <img class="no-lightbox cf-friends-avatar" src="https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png" onerror="this.onerror=null;this.src="/img/friend_404.gif"" alt="Weibo">                </div>                <div class="flink-item-info">                  <div class="flink-item-name">Weibo</div>                  <div class="flink-item-desc" title="ä¸­å›½æœ€å¤§ç¤¾äº¤åˆ†äº«å¹³å°">ä¸­å›½æœ€å¤§ç¤¾äº¤åˆ†äº«å¹³å°</div>                </div>              </a>            </div>            <div class="flink-list-item">              <a href="https://twitter.com/" title="Twitter" class="cf-friends-link" target="_blank">                <div class="flink-item-icon">                  <img class="no-lightbox cf-friends-avatar" src="https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png" onerror="this.onerror=null;this.src="/img/friend_404.gif"" alt="Twitter">                </div>                <div class="flink-item-info">                  <div class="flink-item-name">Twitter</div>                  <div class="flink-item-desc" title="ç¤¾äº¤åˆ†äº«å¹³å°">ç¤¾äº¤åˆ†äº«å¹³å°</div>                </div>              </a>            </div></div></div></div></div><div class="tab-item-content" id="btn-4"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;% flink %&#125;</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> class<span class="emphasis">_name: æ¨èåšå®¢</span></span><br><span class="line"><span class="emphasis">  flink_</span>style: flexcard</span><br><span class="line">  link<span class="emphasis">_list:</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">  - name: å®‰çŸ¥é±¼</span></span><br><span class="line"><span class="emphasis">    link: https://anheyu.com/</span></span><br><span class="line"><span class="emphasis">    avatar: https://img02.anheyu.com/adminuploads/1/2022/09/15/63232b7d91d22.jpg</span></span><br><span class="line"><span class="emphasis">    descr: ç”Ÿæ´»æ˜æœ—ï¼Œä¸‡ç‰©å¯çˆ±</span></span><br><span class="line"><span class="emphasis">    siteshot: https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/anheyu.com.jpg</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">- class_</span>name: ç½‘ç«™</span><br><span class="line">  class<span class="emphasis">_desc: å€¼å¾—æ¨èçš„ç½‘ç«™</span></span><br><span class="line"><span class="emphasis">  flink_</span>style: anzhiyu</span><br><span class="line">  link<span class="emphasis">_list: - name: Youtube</span></span><br><span class="line"><span class="emphasis">  link: https://www.youtube.com/</span></span><br><span class="line"><span class="emphasis">  avatar: https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png</span></span><br><span class="line"><span class="emphasis">  descr: è§†é¢‘ç½‘ç«™ - name: Weibo</span></span><br><span class="line"><span class="emphasis">  link: https://www.weibo.com/</span></span><br><span class="line"><span class="emphasis">  avatar: https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png</span></span><br><span class="line"><span class="emphasis">  descr: ä¸­å›½æœ€å¤§ç¤¾äº¤åˆ†äº«å¹³å° - name: Twitter</span></span><br><span class="line"><span class="emphasis">  link: https://twitter.com/</span></span><br><span class="line"><span class="emphasis">  avatar: https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png</span></span><br><span class="line"><span class="emphasis">  descr: ç¤¾äº¤åˆ†äº«å¹³å°</span></span><br><span class="line"><span class="emphasis">  &#123;% endflink %&#125;</span></span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="mermaid-å›¾"><a href="#mermaid-å›¾" class="headerlink" title="mermaid å›¾"></a>mermaid å›¾</h2><div class="note blue anzhiyufont anzhiyu-icon-bullhorn simple"><p>ä½¿ç”¨<code>mermaidæ ‡ç­¾</code>å¯ä»¥ç»˜åˆ¶ Flowchartï¼ˆæµç¨‹å›¾ï¼‰ã€Sequence diagramï¼ˆæ—¶åºå›¾ ï¼‰ã€Class Diagramï¼ˆç±»åˆ«å›¾ï¼‰ã€State Diagramï¼ˆçŠ¶æ€å›¾ï¼‰ã€Ganttï¼ˆç”˜ç‰¹å›¾ï¼‰å’Œ Pie Chartï¼ˆåœ†å½¢å›¾ï¼‰ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹<a href="https://mermaid.js.org/#/">mermaid æ–‡æ¡£</a></p></div><p>ä¿®æ”¹ <code>ä¸»é¢˜é…ç½®æ–‡ä»¶</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mermaid</span></span><br><span class="line"><span class="comment"># see https://github.com/mermaid-js/mermaid</span></span><br><span class="line"><span class="attr">mermaid:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># built-in themes: default/forest/dark/neutral</span></span><br><span class="line">  <span class="attr">theme:</span></span><br><span class="line">    <span class="attr">light:</span> <span class="string">default</span></span><br><span class="line">    <span class="attr">dark:</span> <span class="string">dark</span></span><br></pre></td></tr></table></figure><div class="tabs" id="mermaid"><ul class="nav-tabs"><button type="button" class="tab " data-href="mermaid-1">æ ‡ç­¾è¯­æ³•</button><button type="button" class="tab  active" data-href="mermaid-2">æ ·å¼é¢„è§ˆ</button><button type="button" class="tab " data-href="mermaid-3">ç¤ºä¾‹æºç </button></ul><div class="tab-contents"><div class="tab-item-content" id="mermaid-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% mermaid %&#125;</span><br><span class="line">å†…å®¹</span><br><span class="line">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content active" id="mermaid-2"><p><img src="https://bu.dusays.com/2023/06/01/647889d3a16f8.png" alt="mermaid"></p></div><div class="tab-item-content" id="mermaid-3"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;% mermaid %&#125;</span><br><span class="line">pie</span><br><span class="line">    title Key elements in Product X</span><br><span class="line">    &quot;Calcium&quot; : 42.96</span><br><span class="line">    &quot;Potassium&quot; : 50.05</span><br><span class="line">    &quot;Magnesium&quot; : 10.01</span><br><span class="line">    &quot;Iron&quot; :  5</span><br><span class="line">&#123;% endmermaid %&#125;</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="å¤é€‰åˆ—è¡¨-checkbox"><a href="#å¤é€‰åˆ—è¡¨-checkbox" class="headerlink" title="å¤é€‰åˆ—è¡¨ checkbox"></a>å¤é€‰åˆ—è¡¨ checkbox</h2><div class="tabs" id="checkbox"><ul class="nav-tabs"><button type="button" class="tab " data-href="checkbox-1">æ ‡ç­¾è¯­æ³•</button><button type="button" class="tab " data-href="checkbox-2">é…ç½®å‚æ•°</button><button type="button" class="tab  active" data-href="checkbox-3">æ ·å¼é¢„è§ˆ</button><button type="button" class="tab " data-href="checkbox-4">ç¤ºä¾‹æºç </button></ul><div class="tab-contents"><div class="tab-item-content" id="checkbox-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% checkbox æ ·å¼å‚æ•°ï¼ˆå¯é€‰ï¼‰, æ–‡æœ¬ï¼ˆæ”¯æŒç®€å•mdï¼‰ %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="checkbox-2"><ol><li>æ ·å¼: plus, minus, times</li><li>é¢œè‰²: <span class="p red">red</span>,<span class="p yellow">yellow</span>,<span class="p green">green</span>,<span class="p cyan">cyan</span>,<span class="p blue">blue</span>,<span class="p gray">gray</span></li><li>é€‰ä¸­çŠ¶æ€: checked</li></ol></div><div class="tab-item-content active" id="checkbox-3"><div class="checkbox"><input type="checkbox">            <p>çº¯æ–‡æœ¬æµ‹è¯•</p>            </div>   <div class="checkbox checked"><input type="checkbox" checked="checked">            <p>æ”¯æŒç®€å•çš„ <a href="https://guides.github.com/features/mastering-markdown/">markdown</a> è¯­æ³•</p>            </div>   <div class="checkbox red"><input type="checkbox">            <p>æ”¯æŒè‡ªå®šä¹‰é¢œè‰²</p>            </div>   <div class="checkbox green checked"><input type="checkbox" checked="checked">            <p>ç»¿è‰² + é»˜è®¤é€‰ä¸­</p>            </div>   <div class="checkbox yellow checked"><input type="checkbox" checked="checked">            <p>é»„è‰² + é»˜è®¤é€‰ä¸­</p>            </div>   <div class="checkbox cyan checked"><input type="checkbox" checked="checked">            <p>é’è‰² + é»˜è®¤é€‰ä¸­</p>            </div>   <div class="checkbox blue checked"><input type="checkbox" checked="checked">            <p>è“è‰² + é»˜è®¤é€‰ä¸­</p>            </div>   <div class="checkbox plus green checked"><input type="checkbox" checked="checked">            <p>å¢åŠ </p>            </div>   <div class="checkbox minus yellow checked"><input type="checkbox" checked="checked">            <p>å‡å°‘</p>            </div>   <div class="checkbox times red checked"><input type="checkbox" checked="checked">            <p>å‰</p>            </div></div><div class="tab-item-content" id="checkbox-4"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;% checkbox çº¯æ–‡æœ¬æµ‹è¯• %&#125;</span><br><span class="line">&#123;% checkbox checked, æ”¯æŒç®€å•çš„ [<span class="string">markdown</span>](<span class="link">https://guides.github.com/features/mastering-markdown/</span>) è¯­æ³• %&#125;</span><br><span class="line">&#123;% checkbox red, æ”¯æŒè‡ªå®šä¹‰é¢œè‰² %&#125;</span><br><span class="line">&#123;% checkbox green checked, ç»¿è‰² + é»˜è®¤é€‰ä¸­ %&#125;</span><br><span class="line">&#123;% checkbox yellow checked, é»„è‰² + é»˜è®¤é€‰ä¸­ %&#125;</span><br><span class="line">&#123;% checkbox cyan checked, é’è‰² + é»˜è®¤é€‰ä¸­ %&#125;</span><br><span class="line">&#123;% checkbox blue checked, è“è‰² + é»˜è®¤é€‰ä¸­ %&#125;</span><br><span class="line">&#123;% checkbox plus green checked, å¢åŠ  %&#125;</span><br><span class="line">&#123;% checkbox minus yellow checked, å‡å°‘ %&#125;</span><br><span class="line">&#123;% checkbox times red checked, å‰ %&#125;</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="dogeplayer-å¤šå‰äº‘æ’­æ”¾å™¨"><a href="#dogeplayer-å¤šå‰äº‘æ’­æ”¾å™¨" class="headerlink" title="dogeplayer å¤šå‰äº‘æ’­æ”¾å™¨"></a>dogeplayer å¤šå‰äº‘æ’­æ”¾å™¨</h2><div class="note blue anzhiyufont anzhiyu-icon-bullhorn simple"><p>å¿«æ·å¼•å…¥<a href="https://console.dogecloud.com/vod/overview">å¤šå‰äº‘è§†é¢‘</a></p></div><div class="tabs" id="label"><ul class="nav-tabs"><button type="button" class="tab " data-href="label-1">æ ‡ç­¾è¯­æ³•</button><button type="button" class="tab " data-href="label-2">å‚æ•°é…ç½®</button><button type="button" class="tab  active" data-href="label-3">æ ·å¼é¢„è§ˆ</button><button type="button" class="tab " data-href="label-4">ç¤ºä¾‹æºç </button></ul><div class="tab-contents"><div class="tab-item-content" id="label-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% dogeplayer 4945 ebb742fd1f0b5a7b %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="label-2"><p>è·å–<code>userId</code>ä¸<code>vcode</code></p><p><img src="https://bu.dusays.com/2023/06/01/64788b5bad729.webp"></p><table><thead><tr><th align="left">å‚æ•°</th><th align="left">å«ä¹‰</th></tr></thead><tbody><tr><td align="left">userId</td><td align="left">å¤šå‰äº‘ userId</td></tr><tr><td align="left">vcode</td><td align="left">è§†é¢‘ vcode</td></tr></tbody></table></div><div class="tab-item-content active" id="label-3"><p><img src="https://bu.dusays.com/2023/06/01/64788c12883b8.webp"></p></div><div class="tab-item-content" id="label-4"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% dogeplayer 4945 ebb742fd1f0b5a7b %&#125;</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="æŠ˜å æ¡†-folding"><a href="#æŠ˜å æ¡†-folding" class="headerlink" title="æŠ˜å æ¡† folding"></a>æŠ˜å æ¡† folding</h2><div class="note blue anzhiyufont anzhiyu-icon-bullhorn disabled"><p>æŠ˜å æ¡† folding</p></div><div class="tabs" id="folding"><ul class="nav-tabs"><button type="button" class="tab " data-href="folding-1">æ ‡ç­¾è¯­æ³•</button><button type="button" class="tab " data-href="folding-2">é…ç½®å‚æ•°</button><button type="button" class="tab  active" data-href="folding-3">æ ·å¼é¢„è§ˆ</button><button type="button" class="tab " data-href="folding-4">ç¤ºä¾‹æºç </button></ul><div class="tab-contents"><div class="tab-item-content" id="folding-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% folding å‚æ•°ï¼ˆå¯é€‰ï¼‰, æ ‡é¢˜ %&#125;</span><br><span class="line">![](<span class="link">https://bu.dusays.com/2023/06/01/64788d71c832d.webp</span>)</span><br><span class="line">&#123;% endfolding %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="folding-2"><ol><li>é¢œè‰²ï¼šblue, cyan, green, yellow, red</li><li>çŠ¶æ€ï¼šçŠ¶æ€å¡«å†™ open ä»£è¡¨é»˜è®¤æ‰“å¼€ã€‚</li></ol></div><div class="tab-item-content active" id="folding-3"><details class="folding-tag"><summary> æŸ¥çœ‹å›¾ç‰‡æµ‹è¯• </summary>              <div class="content">              <p><img src="https://bu.dusays.com/2023/06/01/64788d71c832d.webp"></p>              </div>            </details><details class="folding-tag" cyan open><summary> æŸ¥çœ‹é»˜è®¤æ‰“å¼€çš„æŠ˜å æ¡† </summary>              <div class="content">              <p>è¿™æ˜¯ä¸€ä¸ªé»˜è®¤æ‰“å¼€çš„æŠ˜å æ¡†ã€‚</p>              </div>            </details><details class="folding-tag" green><summary> æŸ¥çœ‹ä»£ç æµ‹è¯• </summary>              <div class="content">              <figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![](<span class="link">https://bu.dusays.com/2023/06/01/64788d71c832d.webp</span>)</span><br></pre></td></tr></table></figure>              </div>            </details><details class="folding-tag" yellow><summary> æŸ¥çœ‹åˆ—è¡¨æµ‹è¯• </summary>              <div class="content">              <ul><li>haha</li><li>hehe</li></ul>              </div>            </details><details class="folding-tag" red><summary> æŸ¥çœ‹åµŒå¥—æµ‹è¯• </summary>              <div class="content">              <details class="folding-tag" blue><summary> æŸ¥çœ‹åµŒå¥—æµ‹è¯•2 </summary>              <div class="content">              <details class="folding-tag"><summary> æŸ¥çœ‹åµŒå¥—æµ‹è¯•3 </summary>              <div class="content">              <p>hahaha <span><img src="https://bu.dusays.com/2023/06/01/64788cd5a356b.png" style="height:24px"></span></p>              </div>            </details>              </div>            </details>              </div>            </details></div><div class="tab-item-content" id="folding-4"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#123;% folding æŸ¥çœ‹å›¾ç‰‡æµ‹è¯• %&#125;</span><br><span class="line"></span><br><span class="line">![](<span class="link">https://bu.dusays.com/2023/06/01/64788d71c832d.webp</span>)</span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding cyan open, æŸ¥çœ‹é»˜è®¤æ‰“å¼€çš„æŠ˜å æ¡† %&#125;</span><br><span class="line"></span><br><span class="line">è¿™æ˜¯ä¸€ä¸ªé»˜è®¤æ‰“å¼€çš„æŠ˜å æ¡†ã€‚</span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding green, æŸ¥çœ‹ä»£ç æµ‹è¯• %&#125;</span><br><span class="line">å‡è£…è¿™é‡Œæœ‰ä»£ç å—ï¼ˆä»£ç å—æ²¡æ³•åµŒå¥—ä»£ç å—ï¼‰</span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding yellow, æŸ¥çœ‹åˆ—è¡¨æµ‹è¯• %&#125;</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> haha</span><br><span class="line"><span class="bullet">-</span> hehe</span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding red, æŸ¥çœ‹åµŒå¥—æµ‹è¯• %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding blue, æŸ¥çœ‹åµŒå¥—æµ‹è¯•2 %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% folding æŸ¥çœ‹åµŒå¥—æµ‹è¯•3 %&#125;</span><br><span class="line"></span><br><span class="line">hahaha <span class="language-xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;https://bu.dusays.com/2023/06/01/64788cd5a356b.png&#x27;</span> <span class="attr">style</span>=<span class="string">&#x27;height:24px&#x27;</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endfolding %&#125;</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="Gallery-ç›¸å†Œå›¾åº“"><a href="#Gallery-ç›¸å†Œå›¾åº“" class="headerlink" title="Gallery ç›¸å†Œå›¾åº“"></a>Gallery ç›¸å†Œå›¾åº“</h2><p>ä¸€ä¸ªå›¾åº“é›†åˆã€‚</p><div class="tabs" id="gallery"><ul class="nav-tabs"><button type="button" class="tab " data-href="gallery-1">æ ‡ç­¾è¯­æ³•</button><button type="button" class="tab " data-href="gallery-2">å‚æ•°é…ç½®</button><button type="button" class="tab  active" data-href="gallery-3">æ ·å¼é¢„è§ˆ</button><button type="button" class="tab " data-href="gallery-4">ç¤ºä¾‹æºç </button></ul><div class="tab-contents"><div class="tab-item-content" id="gallery-1"><ol><li><p>gallerygroup ç›¸å†Œå›¾åº“</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;gallery-group-main&quot;</span>&gt;</span></span></span><br><span class="line">&#123;% galleryGroup name description link img-url %&#125;</span><br><span class="line">&#123;% galleryGroup name description link img-url %&#125;</span><br><span class="line">&#123;% galleryGroup name description link img-url %&#125;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li><li><p>gallery ç›¸å†Œ</p></li></ol><div class="tabs" id="galleryç›¸å†Œ"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="galleryç›¸å†Œ-1">æœ¬åœ°</button><button type="button" class="tab " data-href="galleryç›¸å†Œ-2">è¿œç¨‹</button></ul><div class="tab-contents"><div class="tab-item-content active" id="galleryç›¸å†Œ-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;% gallery %&#125;</span><br><span class="line">markdown å›¾ç‰‡æ ¼å¼</span><br><span class="line">&#123;% endgallery %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% gallery true,220,10 %&#125;</span><br><span class="line">markdown å›¾ç‰‡æ ¼å¼</span><br><span class="line">&#123;% endgallery %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% gallery true,,10 %&#125;</span><br><span class="line">markdown å›¾ç‰‡æ ¼å¼</span><br><span class="line">&#123;% endgallery %&#125;</span><br></pre></td></tr></table></figure><table><thead><tr><th>å‚æ•°å</th><th>é‡Šä¹‰</th></tr></thead><tbody><tr><td>lazyload</td><td>ã€å¯é€‰ã€‘ç‚¹å‡»æŒ‰é’®åŠ è½½æ›´å¤šå›¾ç‰‡ï¼Œå¡«å†™ true&#x2F;falseã€‚é»˜è®¤ä¸º <code>false</code>ã€‚</td></tr><tr><td>rowHeight</td><td>ã€å¯é€‰ã€‘å›¾ç‰‡æ˜¾ç¤ºçš„é«˜åº¦ï¼Œå¦‚æœéœ€è¦ä¸€è¡Œæ˜¾ç¤ºæ›´å¤šçš„å›¾ç‰‡ï¼Œå¯è®¾ç½®æ›´å°çš„æ•°å­—ã€‚é»˜è®¤ä¸º <code>220</code>ã€‚</td></tr><tr><td>limit</td><td>ã€å¯é€‰ã€‘æ¯æ¬¡åŠ è½½å¤šå°‘å¼ ç…§ç‰‡ã€‚é»˜è®¤ä¸º <code>10</code>ã€‚</td></tr></tbody></table></div><div class="tab-item-content" id="galleryç›¸å†Œ-2"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% gallery url,[link],[lazyload],[rowHeight],[limit] %&#125;</span><br><span class="line">&#123;% endgallery %&#125;</span><br></pre></td></tr></table></figure><table><thead><tr><th>å‚æ•°å</th><th>é‡Šä¹‰</th></tr></thead><tbody><tr><td>url</td><td>ã€å¿…é¡»ã€‘ è¯†åˆ«è¯</td></tr><tr><td>link</td><td>ã€å¿…é¡»ã€‘è¿œç¨‹çš„ json é“¾æ¥</td></tr><tr><td>lazyload</td><td>ã€å¯é€‰ã€‘ç‚¹å‡»æŒ‰é’®åŠ è½½æ›´å¤šå›¾ç‰‡ï¼Œå¡«å†™ true&#x2F;falseã€‚é»˜è®¤ä¸º <code>false</code>ã€‚</td></tr><tr><td>rowHeight</td><td>ã€å¯é€‰ã€‘å›¾ç‰‡æ˜¾ç¤ºçš„é«˜åº¦ï¼Œå¦‚æœéœ€è¦ä¸€è¡Œæ˜¾ç¤ºæ›´å¤šçš„å›¾ç‰‡ï¼Œå¯è®¾ç½®æ›´å°çš„æ•°å­—ã€‚é»˜è®¤ä¸º <code>220</code>ã€‚</td></tr><tr><td>limit</td><td>ã€å¯é€‰ã€‘æ¯æ¬¡åŠ è½½å¤šå°‘å¼ ç…§ç‰‡ã€‚é»˜è®¤ä¸º <code>10</code>ã€‚</td></tr></tbody></table><blockquote><p>è¿œç¨‹é“¾æ¥ Json çš„ä¾‹å­</p></blockquote><p>æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œ<code>url</code>æ˜¯å¿…é¡»å­˜åœ¨çš„ï¼Œ<code>alt</code> å’Œ <code>title</code> å¯æœ‰ï¼Œä¹Ÿå¯æ²¡æœ‰ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://cdn1.tianli0.top/gh/jerryc127/CDN/img/IMG_0556.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;alt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;IMG_0556.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;è¿™æ˜¯title&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://cdn1.tianli0.top/gh/jerryc127/CDN/img/IMG_0472.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;alt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;IMG_0472.jpg&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://cdn1.tianli0.top/gh/jerryc127/CDN/img/IMG_0453.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;alt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://cdn1.tianli0.top/gh/jerryc127/CDN/img/IMG_0931.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;alt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><blockquote><p>ç¤ºä¾‹</p></blockquote><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;% gallery url,https://xxxx.com/sss.json %&#125;</span><br><span class="line">&#123;% endgallery %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% gallery url,https://xxxx.com/sss.json,true,220,10 %&#125;</span><br><span class="line">&#123;% endgallery %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% gallery url,https://xxxx.com/sss.json,true,,10 %&#125;</span><br><span class="line">&#123;% endgallery %&#125;</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div></div><div class="tab-item-content" id="gallery-2"><ul><li><p>gallerygroup ç›¸å†Œå›¾åº“</p><table><thead><tr><th align="left">å‚æ•°å</th><th align="left">é‡Šä¹‰</th></tr></thead><tbody><tr><td align="left">name</td><td align="left">å›¾åº“åå­—</td></tr><tr><td align="left">description</td><td align="left">å›¾åº“æè¿°</td></tr><tr><td align="left">link</td><td align="left">é“¾æ¥åˆ°å¯¹åº”ç›¸å†Œçš„åœ°å€</td></tr><tr><td align="left">img-url</td><td align="left">å›¾åº“å°é¢</td></tr></tbody></table></li></ul><div class="note info flat"><p>æ€ç»´æ‹“å±•ä¸€ä¸‹ï¼Œç›¸å†Œå›¾åº“çš„å®è´¨å…¶å®å°±æ˜¯ä¸ªå¿«æ·æ–¹å¼ï¼Œå¯ä»¥è‡ªå®šä¹‰æ·»åŠ æè¿°ã€å°é¢ã€é“¾æ¥ã€‚é‚£ä¹ˆæˆ‘ä»¬æœªå¿…è¦æŠŠå®ƒå½“åšä¸€ä¸ªç›¸å†Œï¼Œå®Œå…¨å¯ä»¥ä½œä¸ºä¸€ä¸ªé“¾æ¥å¡ç‰‡ï¼Œé“¾æ¥åˆ°è§†é¢‘ã€QQã€å‹é“¾éƒ½æ˜¯ä¸é”™çš„é€‰æ‹©ã€‚</p></div><ul><li>gallery ç›¸å†Œ<br>åŒºåˆ«äºæ—§ç‰ˆçš„ Gallery ç›¸å†Œ,æ–°çš„ Gallery ç›¸å†Œä¼šè‡ªåŠ¨æ ¹æ®å›¾ç‰‡é•¿åº¦è¿›è¡Œæ’ç‰ˆï¼Œä¹¦å†™ä¹Ÿæ›´åŠ æ–¹ä¾¿ï¼Œä¸ markdown æ ¼å¼ä¸€æ ·ã€‚å¯æ ¹æ®éœ€è¦æ’å…¥åˆ°ç›¸åº”çš„ mdã€‚æ— éœ€å†è‡ªå·±é…ç½®é•¿å®½ã€‚<strong>å»ºè®®åœ¨ç²˜è´´æ—¶æ•…æ„ä½¿ç”¨é•¿çŸ­ã€å¤§å°ã€æ¨ªç«–ä¸ä¸€çš„å›¾ç‰‡</strong>ï¼Œä¼šæœ‰æ›´å¥½çš„æ•ˆæœã€‚ï¼ˆå°ºå¯¸å®Œå…¨ç›¸åŒçš„å›¾ç‰‡åªä¼šå¹³é“ºè¾“å‡ºï¼Œæ•ˆæœå¾ˆç³Ÿç³•ï¼‰</li></ul><div class="tabs" id="galleryç›¸å†Œå‚æ•°"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="galleryç›¸å†Œå‚æ•°-1">æœ¬åœ°</button><button type="button" class="tab " data-href="galleryç›¸å†Œå‚æ•°-2">è¿œç¨‹</button></ul><div class="tab-contents"><div class="tab-item-content active" id="galleryç›¸å†Œå‚æ•°-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;% gallery %&#125;</span><br><span class="line">markdown å›¾ç‰‡æ ¼å¼</span><br><span class="line">&#123;% endgallery %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% gallery true,220,10 %&#125;</span><br><span class="line">markdown å›¾ç‰‡æ ¼å¼</span><br><span class="line">&#123;% endgallery %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% gallery true,,10 %&#125;</span><br><span class="line">markdown å›¾ç‰‡æ ¼å¼</span><br><span class="line">&#123;% endgallery %&#125;</span><br></pre></td></tr></table></figure><table><thead><tr><th>å‚æ•°å</th><th>é‡Šä¹‰</th></tr></thead><tbody><tr><td>lazyload</td><td>ã€å¯é€‰ã€‘ç‚¹å‡»æŒ‰é’®åŠ è½½æ›´å¤šå›¾ç‰‡ï¼Œå¡«å†™ true&#x2F;falseã€‚é»˜è®¤ä¸º <code>false</code>ã€‚</td></tr><tr><td>rowHeight</td><td>ã€å¯é€‰ã€‘å›¾ç‰‡æ˜¾ç¤ºçš„é«˜åº¦ï¼Œå¦‚æœéœ€è¦ä¸€è¡Œæ˜¾ç¤ºæ›´å¤šçš„å›¾ç‰‡ï¼Œå¯è®¾ç½®æ›´å°çš„æ•°å­—ã€‚é»˜è®¤ä¸º <code>220</code>ã€‚</td></tr><tr><td>limit</td><td>ã€å¯é€‰ã€‘æ¯æ¬¡åŠ è½½å¤šå°‘å¼ ç…§ç‰‡ã€‚é»˜è®¤ä¸º <code>10</code>ã€‚</td></tr></tbody></table></div><div class="tab-item-content" id="galleryç›¸å†Œå‚æ•°-2"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% gallery url,[link],[lazyload],[rowHeight],[limit] %&#125;</span><br><span class="line">&#123;% endgallery %&#125;</span><br></pre></td></tr></table></figure><table><thead><tr><th>å‚æ•°å</th><th>é‡Šä¹‰</th></tr></thead><tbody><tr><td>url</td><td>ã€å¿…é¡»ã€‘ è¯†åˆ«è¯</td></tr><tr><td>link</td><td>ã€å¿…é¡»ã€‘è¿œç¨‹çš„ json é“¾æ¥</td></tr><tr><td>lazyload</td><td>ã€å¯é€‰ã€‘ç‚¹å‡»æŒ‰é’®åŠ è½½æ›´å¤šå›¾ç‰‡ï¼Œå¡«å†™ true&#x2F;falseã€‚é»˜è®¤ä¸º <code>false</code>ã€‚</td></tr><tr><td>rowHeight</td><td>ã€å¯é€‰ã€‘å›¾ç‰‡æ˜¾ç¤ºçš„é«˜åº¦ï¼Œå¦‚æœéœ€è¦ä¸€è¡Œæ˜¾ç¤ºæ›´å¤šçš„å›¾ç‰‡ï¼Œå¯è®¾ç½®æ›´å°çš„æ•°å­—ã€‚é»˜è®¤ä¸º <code>220</code>ã€‚</td></tr><tr><td>limit</td><td>ã€å¯é€‰ã€‘æ¯æ¬¡åŠ è½½å¤šå°‘å¼ ç…§ç‰‡ã€‚é»˜è®¤ä¸º <code>10</code>ã€‚</td></tr></tbody></table><blockquote><p>è¿œç¨‹é“¾æ¥ Json çš„ä¾‹å­</p></blockquote><p>æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œ<code>url</code>æ˜¯å¿…é¡»å­˜åœ¨çš„ï¼Œ<code>alt</code> å’Œ <code>title</code> å¯æœ‰ï¼Œä¹Ÿå¯æ²¡æœ‰ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://cdn1.tianli0.top/gh/jerryc127/CDN/img/IMG_0556.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;alt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;IMG_0556.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;è¿™æ˜¯title&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://cdn1.tianli0.top/gh/jerryc127/CDN/img/IMG_0472.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;alt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;IMG_0472.jpg&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://cdn1.tianli0.top/gh/jerryc127/CDN/img/IMG_0453.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;alt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://cdn1.tianli0.top/gh/jerryc127/CDN/img/IMG_0931.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;alt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><blockquote><p>ç¤ºä¾‹</p></blockquote><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;% gallery url,https://xxxx.com/sss.json %&#125;</span><br><span class="line">&#123;% endgallery %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% gallery url,https://xxxx.com/sss.json,true,220,10 %&#125;</span><br><span class="line">&#123;% endgallery %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% gallery url,https://xxxx.com/sss.json,true,,10 %&#125;</span><br><span class="line">&#123;% endgallery %&#125;</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div></div><div class="tab-item-content active" id="gallery-3"><ul><li>gallerygroup ç›¸å†Œå›¾åº“</li></ul><div class="gallery-group-main">  <figure class="gallery-group">  <img class="gallery-group-img no-lightbox" src="https://bu.dusays.com/2023/06/01/64788f24d05bd.webp" alt="Group Image Gallery">  <figcaption>  <div class="gallery-group-name">MC</div>  <p>åœ¨Rikkaã®å…­èŠ±æœåŠ¡å™¨é‡Œç•™ä¸‹çš„è¶³è¿¹</p>  <a href="/wordScenery/"></a>  </figcaption>  </figure>    <figure class="gallery-group">  <img class="gallery-group-img no-lightbox" src="https://bu.dusays.com/2023/06/01/64788f456fc3d.webp" alt="Group Image Gallery">  <figcaption>  <div class="gallery-group-name">Gundam</div>  <p>å“¦å’§å“‡gundamå“’ï¼</p>  <a href="/thousand/"></a>  </figcaption>  </figure>    <figure class="gallery-group">  <img class="gallery-group-img no-lightbox" src="https://bu.dusays.com/2023/06/01/64788f83e5fa1.webp" alt="Group Image Gallery">  <figcaption>  <div class="gallery-group-name">I-am-Akilar</div>  <p>æŸç§æ„ä¹‰ä¸Šä¹Ÿç®—è‡ªæ‹å§</p>  <a href="/wallpaper/"></a>  </figcaption>  </figure>  </div><ul><li>gallery ç›¸å†Œ</li></ul><div class="gallery">  <div class="fj-gallery page_img_lazyload lazyload btn_album_detail_lazyload data" data-rowheight="220" data-limit="2">    <span class="gallery-data">[{"url":"https://bu.dusays.com/2023/06/01/647896b15759c.jpg","alt":""},{"url":"https://bu.dusays.com/2023/06/01/647896cabde59.jpg","alt":""},{"url":"https://bu.dusays.com/2023/06/01/647896eb0f3ea.jpg","alt":""},{"url":"https://bu.dusays.com/2023/06/01/647896ed810b3.jpg","alt":""},{"url":"https://i.loli.net/2019/12/25/6nepIJ1xTgufatZ.jpg","alt":""},{"url":"https://i.loli.net/2019/12/25/E7Jvr4eIPwUNmzq.jpg","alt":""},{"url":"https://i.loli.net/2019/12/25/mh19anwBSWIkGlH.jpg","alt":""},{"url":"https://i.loli.net/2019/12/25/2tu9JC8ewpBFagv.jpg","alt":""}]</span>  </div><button class="gallery-load-more" style="opacity:0">  <span>åŠ è½½æ›´å¤š</span>  <i class="anzhiyufont anzhiyu-icon-arrow-down"></i>  </button></div></div><div class="tab-item-content" id="gallery-4"><div class="note info flat"><p>å¯¹äºå¾ˆå¤šåŒå­¦æé—®çš„<code>gallerygroup</code>å’Œ<code>gallery</code>ç›¸å†Œé¡µçš„é“¾æ¥é—®é¢˜ã€‚è¿™é‡Œè¯´ä¸‹æˆ‘ä¸ªäººçš„ä½¿ç”¨ä¹ æƒ¯ã€‚<br>ä¸€èˆ¬ä½¿ç”¨ç›¸å†Œå›¾åº“çš„è¯ï¼Œå¯ä»¥åœ¨å¯¼èˆªæ åŠ ä¸€ä¸ª gallery çš„ page(<strong>ä½¿ç”¨æŒ‡ä»¤<code>hexo new page gallery</code>æ·»åŠ </strong>)ï¼Œé‡Œé¢æ”¾ç›¸å†Œå›¾åº“ä½œä¸ºå°é¢ã€‚ç„¶ååœ¨<code>[Blogroot]/source/gallery/</code>ä¸‹é¢å»ºç«‹ç›¸åº”çš„æ–‡ä»¶å¤¹ï¼Œä¾‹å¦‚è‹¥æŒ‰ç…§è¿™é‡Œçš„ç¤ºä¾‹ï¼Œè‹¥æ¬²ä½¿ç”¨<code>/gallery/MC/</code>è·¯å¾„è®¿é—® MC ç›¸å†Œï¼Œåˆ™éœ€è¦æ–°å»º<code>[Blogroot]/source/gallery/MC/index.md</code>ï¼Œå¹¶åœ¨é‡Œé¢å¡«å…¥<code>gallery</code>ç›¸å†Œå†…å®¹ã€‚</p><p>æ³¨æ„ âš ï¸ï¼šæœ¬ç«™ç›¸å†Œé›†ä¸ºå•ç‹¬ä¼˜åŒ–ï¼Œå¯å‚è€ƒ<a href="https://anheyu.com/posts/220c.html">é…ç½®ç›¸å†Œé¡µé¢</a>ã€‚</p></div><ol><li><p>gallerygroup ç›¸å†Œå›¾åº“</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;gallery-group-main&quot;</span>&gt;</span></span></span><br><span class="line"> &#123;% galleryGroup MC åœ¨Rikkaã®å…­èŠ±æœåŠ¡å™¨é‡Œç•™ä¸‹çš„è¶³è¿¹ &#x27;/wordScenery/&#x27; https://bu.dusays.com/2023/06/01/64788f24d05bd.webp %&#125;</span><br><span class="line"> &#123;% galleryGroup Gundam å“¦å’§å“‡gundamå“’ï¼ &#x27;/thousand/&#x27; https://bu.dusays.com/2023/06/01/64788f456fc3d.webp %&#125;</span><br><span class="line"> &#123;% galleryGroup I-am-Akilar æŸç§æ„ä¹‰ä¸Šä¹Ÿç®—è‡ªæ‹å§ &#x27;/wallpaper/&#x27; https://bu.dusays.com/2023/06/01/64788f83e5fa1.webp %&#125;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li><li><p>gallery ç›¸å†Œ</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;% gallery true,,2 %&#125;</span><br><span class="line">![](<span class="link">https://bu.dusays.com/2023/06/01/647896b15759c.jpg</span>)</span><br><span class="line">![](<span class="link">https://bu.dusays.com/2023/06/01/647896cabde59.jpg</span>)</span><br><span class="line">![](<span class="link">https://bu.dusays.com/2023/06/01/647896eb0f3ea.jpg</span>)</span><br><span class="line">![](<span class="link">https://bu.dusays.com/2023/06/01/647890012b1ec.webp</span>)</span><br><span class="line">![](<span class="link">https://i.loli.net/2019/12/25/6nepIJ1xTgufatZ.jpg</span>)</span><br><span class="line">![](<span class="link">https://i.loli.net/2019/12/25/E7Jvr4eIPwUNmzq.jpg</span>)</span><br><span class="line">![](<span class="link">https://i.loli.net/2019/12/25/mh19anwBSWIkGlH.jpg</span>)</span><br><span class="line">![](<span class="link">https://i.loli.net/2019/12/25/2tu9JC8ewpBFagv.jpg</span>)</span><br><span class="line">&#123;% endgallery %&#125;</span><br></pre></td></tr></table></figure></li></ol></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="tag-hide"><a href="#tag-hide" class="headerlink" title="tag-hide"></a>tag-hide</h2><div class="note blue anzhiyufont anzhiyu-icon-bullhorn flat"><p>å¦‚æœä½ æƒ³æŠŠä¸€äº›æ–‡å­—ã€å†…å®¹éšè—èµ·æ¥ï¼Œå¹¶æä¾›æŒ‰é’®è®©ç”¨æˆ·ç‚¹å‡»æ˜¾ç¤ºã€‚å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ ‡ç­¾å¤–æŒ‚ã€‚<br>è¯·æ³¨æ„ï¼Œtag-hide å†…çš„æ ‡ç­¾å¤–æŒ‚ content å†…éƒ½ä¸å»ºè®®æœ‰ h1 - h6 ç­‰æ ‡é¢˜ã€‚å› ä¸º Toc ä¼šæŠŠéšè—å†…å®¹æ ‡é¢˜ä¹Ÿæ˜¾ç¤ºå‡ºæ¥ï¼Œè€Œä¸”å½“æ»šåŠ¨å±å¹•æ—¶ï¼Œå¦‚æœéšè—å†…å®¹æ²¡æœ‰æ˜¾ç¤ºå‡ºæ¥ï¼Œä¼šå¯¼è‡´ Toc çš„æ»šåŠ¨å‡ºç°å¼‚å¸¸ã€‚</p></div><div class="tabs" id="tag-hide"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="tag-hide-1">inline</button><button type="button" class="tab " data-href="tag-hide-2">Block</button><button type="button" class="tab " data-href="tag-hide-3">Toggle</button></ul><div class="tab-contents"><div class="tab-item-content active" id="tag-hide-1"><p><code>inline</code> åœ¨æ–‡æœ¬é‡Œé¢æ·»åŠ æŒ‰é’®éšè—å†…å®¹ï¼Œåªé™æ–‡å­—</p><p>( content ä¸èƒ½åŒ…å«è‹±æ–‡é€—å·ï¼Œå¯ç”¨<code>&amp;sbquo;</code>)</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% hideInline content,display,bg,color %&#125;</span><br></pre></td></tr></table></figure><ul><li><p>content: æ–‡æœ¬å†…å®¹</p></li><li><p>display: æŒ‰é’®æ˜¾ç¤ºçš„æ–‡å­—(å¯é€‰)</p></li><li><p>bg: æŒ‰é’®çš„èƒŒæ™¯é¢œè‰²(å¯é€‰)</p></li><li><p>color: æŒ‰é’®æ–‡å­—çš„é¢œè‰²(å¯é€‰)</p></li></ul><blockquote><p>Demo</p></blockquote><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å“ªä¸ªè‹±æ–‡å­—æ¯æœ€é…·ï¼Ÿ &#123;% hideInline å› ä¸ºè¥¿è£…è£¤(Cè£…é…·),æŸ¥çœ‹ç­”æ¡ˆ,#FF7242,#fff %&#125;</span><br><span class="line"></span><br><span class="line">é—¨é‡Œç«™ç€ä¸€ä¸ªäºº? &#123;% hideInline é—ª %&#125;</span><br></pre></td></tr></table></figure><p>å“ªä¸ªè‹±æ–‡å­—æ¯æœ€é…·ï¼Ÿ <span class="hide-inline"><button type="button" class="hide-button" style="background-color: #FF7242;color: #fff">æŸ¥çœ‹ç­”æ¡ˆ<br>  </button><span class="hide-content">å› ä¸ºè¥¿è£…è£¤(Cè£…é…·)</span></span></p><p>é—¨é‡Œç«™ç€ä¸€ä¸ªäºº? <span class="hide-inline"><button type="button" class="hide-button" style>Click<br>  </button><span class="hide-content">é—ª</span></span></p></div><div class="tab-item-content" id="tag-hide-2"><p><code>block</code>ç‹¬ç«‹çš„ block éšè—å†…å®¹ï¼Œå¯ä»¥éšè—å¾ˆå¤šå†…å®¹ï¼ŒåŒ…æ‹¬å›¾ç‰‡ï¼Œä»£ç å—ç­‰ç­‰</p><p>( display ä¸èƒ½åŒ…å«è‹±æ–‡é€—å·ï¼Œå¯ç”¨<code>&amp;sbquo;</code>)</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% hideBlock display,bg,color %&#125;</span><br><span class="line">content</span><br><span class="line">&#123;% endhideBlock %&#125;</span><br></pre></td></tr></table></figure><ul><li><p>content: æ–‡æœ¬å†…å®¹</p></li><li><p>display: æŒ‰é’®æ˜¾ç¤ºçš„æ–‡å­—(å¯é€‰)</p></li><li><p>bg: æŒ‰é’®çš„èƒŒæ™¯é¢œè‰²(å¯é€‰)</p></li><li><p>color: æŒ‰é’®æ–‡å­—çš„é¢œè‰²(å¯é€‰)</p></li></ul><blockquote><p>Demo</p></blockquote><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">æŸ¥çœ‹ç­”æ¡ˆ</span><br><span class="line">&#123;% hideBlock æŸ¥çœ‹ç­”æ¡ˆ %&#125;</span><br><span class="line">å‚»å­ï¼Œæ€ä¹ˆå¯èƒ½æœ‰ç­”æ¡ˆ</span><br><span class="line">&#123;% endhideBlock %&#125;</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ç­”æ¡ˆ</p><div class="hide-block"><button type="button" class="hide-button" style>æŸ¥çœ‹ç­”æ¡ˆ    </button><div class="hide-content"><p>å‚»å­ï¼Œæ€ä¹ˆå¯èƒ½æœ‰ç­”æ¡ˆ</p></div></div></div><div class="tab-item-content" id="tag-hide-3"><p>å¦‚æœä½ éœ€è¦å±•ç¤ºçš„å†…å®¹å¤ªå¤šï¼Œå¯ä»¥æŠŠå®ƒéšè—åœ¨æ”¶ç¼©æ¡†é‡Œï¼Œéœ€è¦æ—¶å†æŠŠå®ƒå±•å¼€ã€‚</p><p>( display ä¸èƒ½åŒ…å«è‹±æ–‡é€—å·ï¼Œå¯ç”¨<code>&amp;sbquo;</code>)</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% hideToggle display,bg,color %&#125;</span><br><span class="line">content</span><br><span class="line">&#123;% endhideToggle %&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Demo</p></blockquote><details class="toggle"><summary class="toggle-button" style>AnZhiYuä¸»é¢˜å®‰è£…æ–¹æ³•</summary><div class="toggle-content"><p>åœ¨ä½ çš„åšå®¢æ ¹ç›®å½•é‡Œ</p><p>git clone -b master <a href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu.git">https://github.com/anzhiyu-c/hexo-theme-anzhiyu.git</a> themes&#x2F;anzhiyu</p><p>å¦‚æœæƒ³è¦å®‰è£…æ¯”è¾ƒæ–°çš„ dev åˆ†æ”¯ï¼Œå¯ä»¥</p><p>git clone -b dev <a href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu.git">https://github.com/anzhiyu-c/hexo-theme-anzhiyu.git</a> themes&#x2F;anzhiyu</p></div></details></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="é“¾æ¥å¡ç‰‡-link"><a href="#é“¾æ¥å¡ç‰‡-link" class="headerlink" title="é“¾æ¥å¡ç‰‡ link"></a>é“¾æ¥å¡ç‰‡ link</h2><div class="tabs" id="link"><ul class="nav-tabs"><button type="button" class="tab " data-href="link-1">æ ‡ç­¾è¯­æ³•</button><button type="button" class="tab  active" data-href="link-2">æ ·å¼é¢„è§ˆ</button><button type="button" class="tab " data-href="link-3">ç¤ºä¾‹æºç </button></ul><div class="tab-contents"><div class="tab-item-content" id="link-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% link æ ‡é¢˜, ç«™ç‚¹æè¿°, é“¾æ¥, å›¾ç‰‡é“¾æ¥ï¼ˆå¯é€‰ï¼‰ %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content active" id="link-2"><div calss="anzhiyu-tag-link"><a class="tag-Link" target="_blank" href="https://github.com/owen0o0/getFavicon">    <div class="tag-link-tips">å¼•ç”¨ç«™å¤–åœ°å€</div>    <div class="tag-link-bottom">        <div class="tag-link-left" style>          <i class="anzhiyufont anzhiyu-icon-link" style></i>        </div>        <div class="tag-link-right">            <div class="tag-link-title">è·å–ç½‘ç«™çš„Faviconå›¾æ ‡å¹¶æ˜¾ç¤ºåœ¨ä½ çš„ç½‘é¡µä¸Š</div>            <div class="tag-link-sitename">owen0o0</div>        </div>        <i class="anzhiyufont anzhiyu-icon-angle-right"></i>    </div>    </a></div></div><div class="tab-item-content" id="link-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% link è·å–ç½‘ç«™çš„Faviconå›¾æ ‡å¹¶æ˜¾ç¤ºåœ¨ä½ çš„ç½‘é¡µä¸Š,owen0o0,https://github.com/owen0o0/getFavicon %&#125;</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="å•é€‰åˆ—è¡¨-radio"><a href="#å•é€‰åˆ—è¡¨-radio" class="headerlink" title="å•é€‰åˆ—è¡¨ radio"></a>å•é€‰åˆ—è¡¨ radio</h2><div class="tabs" id="radio"><ul class="nav-tabs"><button type="button" class="tab " data-href="radio-1">æ ‡ç­¾è¯­æ³•</button><button type="button" class="tab " data-href="radio-2">é…ç½®å‚æ•°</button><button type="button" class="tab  active" data-href="radio-3">æ ·å¼é¢„è§ˆ</button><button type="button" class="tab " data-href="radio-4">ç¤ºä¾‹æºç </button></ul><div class="tab-contents"><div class="tab-item-content" id="radio-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% radio æ ·å¼å‚æ•°ï¼ˆå¯é€‰ï¼‰, æ–‡æœ¬ï¼ˆæ”¯æŒç®€å•mdï¼‰ %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="radio-2"><ol><li>é¢œè‰²: <span class="p red">red</span>,<span class="p yellow">yellow</span>,<span class="p green">green</span>,<span class="p cyan">cyan</span>,<span class="p blue">blue</span>,<span class="p gray">gray</span></li><li>é€‰ä¸­çŠ¶æ€: checked</li></ol></div><div class="tab-item-content active" id="radio-3"><div class="checkbox"><input type="radio">            <p>çº¯æ–‡æœ¬æµ‹è¯•</p>            </div>   <div class="checkbox checked"><input type="radio" checked="checked">            <p>æ”¯æŒç®€å•çš„ <a href="https://guides.github.com/features/mastering-markdown/">markdown</a> è¯­æ³•</p>            </div>   <div class="checkbox red"><input type="radio">            <p>æ”¯æŒè‡ªå®šä¹‰é¢œè‰²</p>            </div>   <div class="checkbox green"><input type="radio">            <p>ç»¿è‰²</p>            </div>   <div class="checkbox yellow"><input type="radio">            <p>é»„è‰²</p>            </div>   <div class="checkbox cyan"><input type="radio">            <p>é’è‰²</p>            </div>   <div class="checkbox blue"><input type="radio">            <p>è“è‰²</p>            </div></div><div class="tab-item-content" id="radio-4"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% radio çº¯æ–‡æœ¬æµ‹è¯• %&#125;</span><br><span class="line">&#123;% radio checked, æ”¯æŒç®€å•çš„ [<span class="string">markdown</span>](<span class="link">https://guides.github.com/features/mastering-markdown/</span>) è¯­æ³• %&#125;</span><br><span class="line">&#123;% radio red, æ”¯æŒè‡ªå®šä¹‰é¢œè‰² %&#125;</span><br><span class="line">&#123;% radio green, ç»¿è‰² %&#125;</span><br><span class="line">&#123;% radio yellow, é»„è‰² %&#125;</span><br><span class="line">&#123;% radio cyan, é’è‰² %&#125;</span><br><span class="line">&#123;% radio blue, è“è‰² %&#125;</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="ä¸Šæ ‡æ ‡ç­¾-tip"><a href="#ä¸Šæ ‡æ ‡ç­¾-tip" class="headerlink" title="ä¸Šæ ‡æ ‡ç­¾ tip"></a>ä¸Šæ ‡æ ‡ç­¾ tip</h2><div class="tip cogs"><p>ä¸»è¦æ ·å¼å‚è€ƒè‡ª<a href="https://www.antmoe.com/posts/3b43914f/">å°åº·çš„ butterfly æ¸å˜èƒŒæ™¯æ ‡ç­¾</a></p></div><div class="tabs" id="tip"><ul class="nav-tabs"><button type="button" class="tab " data-href="tip-1">æ ‡ç­¾è¯­æ³•</button><button type="button" class="tab " data-href="tip-2">é…ç½®å‚æ•°</button><button type="button" class="tab  active" data-href="tip-3">æ ·å¼é¢„è§ˆ</button><button type="button" class="tab " data-href="tip-4">ç¤ºä¾‹æºç </button></ul><div class="tab-contents"><div class="tab-item-content" id="tip-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tip [å‚æ•°ï¼Œå¯é€‰] %&#125;æ–‡æœ¬å†…å®¹&#123;% endtip %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="tip-2"><ol><li>æ ·å¼: success,error,warning,bolt,ban,home,sync,cogs,key,bell</li><li>è‡ªå®šä¹‰å›¾æ ‡: æ”¯æŒ fontawesomeã€‚</li></ol></div><div class="tab-item-content active" id="tip-3"><div class="tip "><p>default</p></div><div class="tip info"><p>info</p></div><div class="tip success"><p>success</p></div><div class="tip error"><p>error</p></div><div class="tip warning"><p>warning</p></div><div class="tip bolt"><p>bolt</p></div><div class="tip ban"><p>ban</p></div><div class="tip home"><p>home</p></div><div class="tip sync"><p>sync</p></div><div class="tip cogs"><p>cogs</p></div><div class="tip key"><p>key</p></div><div class="tip bell"><p>bell</p></div><div class="tip fa-atom"><p>è‡ªå®šä¹‰ font awesome å›¾æ ‡</p></div></div><div class="tab-item-content" id="tip-4"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tip %&#125;default&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip info %&#125;info&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip success %&#125;success&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip error %&#125;error&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip warning %&#125;warning&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip bolt %&#125;bolt&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip ban %&#125;ban&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip home %&#125;home&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip sync %&#125;sync&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip cogs %&#125;cogs&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip key %&#125;key&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip bell %&#125;bell&#123;% endtip %&#125;</span><br><span class="line">&#123;% tip fa-atom %&#125;è‡ªå®šä¹‰ font awesome å›¾æ ‡&#123;% endtip %&#125;</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="Note-Bootstrap-Callout"><a href="#Note-Bootstrap-Callout" class="headerlink" title="Note (Bootstrap Callout)"></a>Note (Bootstrap Callout)</h2><div class="tabs" id="note"><ul class="nav-tabs"><button type="button" class="tab " data-href="note-1">é€šç”¨é…ç½®</button><button type="button" class="tab " data-href="note-2">è¯­æ³•æ ¼å¼</button><button type="button" class="tab " data-href="note-3">é…ç½®å‚æ•°</button><button type="button" class="tab  active" data-href="note-4">æ ·å¼é¢„è§ˆ</button><button type="button" class="tab " data-href="note-5">ç¤ºä¾‹æºç </button></ul><div class="tab-contents"><div class="tab-item-content" id="note-1"><p>ä¿®æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">note:</span></span><br><span class="line">  <span class="comment"># Note tag style values:</span></span><br><span class="line">  <span class="comment">#  - simple    bs-callout old alert style. Default.</span></span><br><span class="line">  <span class="comment">#  - modern    bs-callout new (v2-v3) alert style.</span></span><br><span class="line">  <span class="comment">#  - flat      flat callout style with background, like on Mozilla or StackOverflow.</span></span><br><span class="line">  <span class="comment">#  - disabled  disable all CSS styles import of note tag.</span></span><br><span class="line">  <span class="attr">style:</span> <span class="string">simple</span></span><br><span class="line">  <span class="attr">icons:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">border_radius:</span> <span class="number">3</span></span><br><span class="line">  <span class="comment"># Offset lighter of background in % for modern and flat styles (modern: -12 | 12; flat: -18 | 6).</span></span><br><span class="line">  <span class="comment"># Offset also applied to label tag variables. This option can work with disabled note tag.</span></span><br><span class="line">  <span class="attr">light_bg_offset:</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><p><code>Note</code>æ ‡ç­¾å¤–æŒ‚æœ‰ä¸¤ç§ç”¨æ³•ã€‚<code>icons</code>å’Œ<code>light_bg_offset</code>åªå¯¹æ–¹æ³•ä¸€ç”Ÿæ•ˆã€‚</p><p><code>fontawesome</code>å›¾æ ‡éœ€å¼€å¯ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­<code>icons.fontawesome</code></p></div><div class="tab-item-content" id="note-2"><p><code>æ–¹æ³•ä¸€</code></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note [class] [no-icon] [style] %&#125;</span><br><span class="line">Any content (support inline tags too.io).</span><br><span class="line">&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p><code>æ–¹æ³•äºŒ</code></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note [color] [icon] [style] %&#125;</span><br><span class="line">Any content (support inline tags too.io).</span><br><span class="line">&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="note-3"><p><code>æ–¹æ³•ä¸€</code></p><table><thead><tr><th align="left">å‚æ•°</th><th align="left">ç”¨æ³•</th></tr></thead><tbody><tr><td align="left">class</td><td align="left">ã€å¯é€‰ã€‘æ ‡è¯†ï¼Œä¸åŒçš„æ ‡è¯†æœ‰ä¸åŒçš„é…è‰²<br>ï¼ˆ default &#x2F; primary &#x2F; success &#x2F; info &#x2F; warning &#x2F; danger ï¼‰</td></tr><tr><td align="left">no-icon</td><td align="left">ã€å¯é€‰ã€‘ä¸æ˜¾ç¤º icon</td></tr><tr><td align="left">style</td><td align="left">ã€å¯é€‰ã€‘å¯ä»¥è¦†ç›–é…ç½®ä¸­çš„ style<br>ï¼ˆsimple&#x2F;modern&#x2F;flat&#x2F;disabledï¼‰</td></tr></tbody></table><p><code>æ–¹æ³•äºŒ</code></p><table><thead><tr><th align="left">å‚æ•°</th><th align="left">ç”¨æ³•</th></tr></thead><tbody><tr><td align="left">class</td><td align="left">ã€å¯é€‰ã€‘æ ‡è¯†ï¼Œä¸åŒçš„æ ‡è¯†æœ‰ä¸åŒçš„é…è‰²<br>ï¼ˆ default &#x2F; blue &#x2F; pink &#x2F; red &#x2F; purple &#x2F; orange &#x2F; green ï¼‰</td></tr><tr><td align="left">no-icon</td><td align="left">ã€å¯é€‰ã€‘å¯é…ç½®è‡ªå®šä¹‰ icon (æ”¯æŒ fontawesome å›¾æ ‡å’Œä¸»é¢˜å†…ç½®çš„é˜¿é‡Œå›¾æ ‡,<code>fontawesome</code>å›¾æ ‡éœ€å¼€å¯ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­<code>icons.fontawesome</code>, ä¹Ÿå¯ä»¥é…ç½® no-icon )</td></tr><tr><td align="left">style</td><td align="left">ã€å¯é€‰ã€‘å¯ä»¥è¦†ç›–é…ç½®ä¸­çš„ style<br>ï¼ˆsimple&#x2F;modern&#x2F;flat&#x2F;disabledï¼‰</td></tr></tbody></table></div><div class="tab-item-content active" id="note-4"><p><code>æ–¹æ³•ä¸€</code></p><ol><li><code>simple</code>æ ·å¼</li></ol><div class="note simple"><p>é»˜è®¤ æç¤ºå—æ ‡ç­¾</p></div><div class="note default simple"><p>default æç¤ºå—æ ‡ç­¾</p></div><div class="note primary simple"><p>primary æç¤ºå—æ ‡ç­¾</p></div><div class="note success simple"><p>success æç¤ºå—æ ‡ç­¾</p></div><div class="note info simple"><p>info æç¤ºå—æ ‡ç­¾</p></div><div class="note warning simple"><p>warning æç¤ºå—æ ‡ç­¾</p></div><div class="note danger simple"><p>danger æç¤ºå—æ ‡ç­¾</p></div><ol start="2"><li><code>modern</code>æ ·å¼</li></ol><div class="note modern"><p>é»˜è®¤ æç¤ºå—æ ‡ç­¾</p></div><div class="note default modern"><p>default æç¤ºå—æ ‡ç­¾</p></div><div class="note primary modern"><p>primary æç¤ºå—æ ‡ç­¾</p></div><div class="note success modern"><p>success æç¤ºå—æ ‡ç­¾</p></div><div class="note info modern"><p>info æç¤ºå—æ ‡ç­¾</p></div><div class="note warning modern"><p>warning æç¤ºå—æ ‡ç­¾</p></div><div class="note danger modern"><p>danger æç¤ºå—æ ‡ç­¾</p></div><ol start="3"><li><code>flat</code>æ ·å¼</li></ol><div class="note flat"><p>é»˜è®¤ æç¤ºå—æ ‡ç­¾</p></div><div class="note default flat"><p>default æç¤ºå—æ ‡ç­¾</p></div><div class="note primary flat"><p>primary æç¤ºå—æ ‡ç­¾</p></div><div class="note success flat"><p>success æç¤ºå—æ ‡ç­¾</p></div><div class="note info flat"><p>info æç¤ºå—æ ‡ç­¾</p></div><div class="note warning flat"><p>warning æç¤ºå—æ ‡ç­¾</p></div><div class="note danger flat"><p>danger æç¤ºå—æ ‡ç­¾</p></div><ol start="4"><li><code>disabled</code>æ ·å¼</li></ol><div class="note disabled"><p>é»˜è®¤ æç¤ºå—æ ‡ç­¾</p></div><div class="note default disabled"><p>default æç¤ºå—æ ‡ç­¾</p></div><div class="note primary disabled"><p>primary æç¤ºå—æ ‡ç­¾</p></div><div class="note success disabled"><p>success æç¤ºå—æ ‡ç­¾</p></div><div class="note info disabled"><p>info æç¤ºå—æ ‡ç­¾</p></div><div class="note warning disabled"><p>warning æç¤ºå—æ ‡ç­¾</p></div><div class="note danger disabled"><p>danger æç¤ºå—æ ‡ç­¾</p></div><ol start="5"><li><code>no-icon</code>æ ·å¼</li></ol><div class="note no-icon flat"><p>é»˜è®¤ æç¤ºå—æ ‡ç­¾</p></div><div class="note default no-icon flat"><p>default æç¤ºå—æ ‡ç­¾</p></div><div class="note primary no-icon flat"><p>primary æç¤ºå—æ ‡ç­¾</p></div><div class="note success no-icon flat"><p>success æç¤ºå—æ ‡ç­¾</p></div><div class="note info no-icon flat"><p>info æç¤ºå—æ ‡ç­¾</p></div><div class="note warning no-icon flat"><p>warning æç¤ºå—æ ‡ç­¾</p></div><div class="note danger no-icon flat"><p>danger æç¤ºå—æ ‡ç­¾</p></div><p><code>æ–¹æ³•äºŒ</code></p><p>å›¾æ ‡æ”¯æŒ <code>fontawesome</code> å’Œ <code>ä¸»é¢˜å†…ç½®çš„é˜¿é‡Œå›¾æ ‡</code>ï¼Œä½¿ç”¨æ–¹æ³•ä¸ºåŠ ä¸Šå¯¹åº”çš„ç±»åï¼Œ<code>fontawesome</code>å›¾æ ‡éœ€å¼€å¯ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­<code>icons.fontawesome</code>ï¼Œé»˜è®¤æœªå¼€å¯ fontawesome</p><ol><li>simple æ ·å¼</li></ol><p><code>ä¸»é¢˜å†…ç½®é˜¿é‡Œå›¾æ ‡</code></p><div class="note anzhiyufont anzhiyu-icon-rocket simple"><p>ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay</p></div><div class="note blue anzhiyufont anzhiyu-icon-bullhorn simple"><p>2022 å¹´å¿«åˆ°äº†â€¦.</p></div><div class="note pink anzhiyufont anzhiyu-icon-instagram simple"><p>å°å¿ƒå¼€è½¦ å®‰å…¨è‡³ä¸Š</p></div><div class="note red anzhiyufont anzhiyu-icon-fan simple"><p>è¿™æ˜¯ä¸‰ç‰‡å‘¢ï¼Ÿè¿˜æ˜¯å››ç‰‡ï¼Ÿ</p></div><div class="note orange anzhiyufont anzhiyu-icon-dengpao simple"><p>ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay</p></div><div class="note purple anzhiyufont anzhiyu-icon-sanmingzhi simple"><p>å‰ªåˆ€çŸ³å¤´å¸ƒ</p></div><div class="note green anzhiyufont anzhiyu-icon-ic_train simple"><p>å‰ç«¯æœ€è®¨åŒçš„æµè§ˆå™¨</p></div><p><code>fontawesome å›¾æ ‡</code>ï¼Œå¼€å¯ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­çš„<code>icons.fontawesome</code>ä¸º<code>true</code>åå¯è§</p><div class="note icon-padding simple"><i class="note-icon fab fa-cc-visa"></i><p>ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay</p></div><div class="note blue icon-padding simple"><i class="note-icon fas fa-bullhorn"></i><p>2022 å¹´å¿«åˆ°äº†â€¦.</p></div><div class="note pink icon-padding simple"><i class="note-icon fas fa-car-crash"></i><p>å°å¿ƒå¼€è½¦ å®‰å…¨è‡³ä¸Š</p></div><div class="note red icon-fan simple"><p>è¿™æ˜¯ä¸‰ç‰‡å‘¢ï¼Ÿè¿˜æ˜¯å››ç‰‡ï¼Ÿ</p></div><div class="note orange icon-padding simple"><i class="note-icon fas fa-battery-half"></i><p>ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay</p></div><div class="note purple icon-padding simple"><i class="note-icon far fa-hand-scissors"></i><p>å‰ªåˆ€çŸ³å¤´å¸ƒ</p></div><div class="note green icon-padding simple"><i class="note-icon fab fa-internet-explorer"></i><p>å‰ç«¯æœ€è®¨åŒçš„æµå™¨</p></div><ol start="2"><li>modern æ ·å¼</li></ol><p><code>ä¸»é¢˜å†…ç½®é˜¿é‡Œå›¾æ ‡</code></p><div class="note anzhiyufont anzhiyu-icon-rocket modern"><p>ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay</p></div><div class="note blue anzhiyufont anzhiyu-icon-bullhorn modern"><p>2022 å¹´å¿«åˆ°äº†â€¦.</p></div><div class="note pink anzhiyufont anzhiyu-icon-instagram modern"><p>å°å¿ƒå¼€è½¦ å®‰å…¨è‡³ä¸Š</p></div><div class="note red anzhiyufont anzhiyu-icon-fan modern"><p>è¿™æ˜¯ä¸‰ç‰‡å‘¢ï¼Ÿè¿˜æ˜¯å››ç‰‡ï¼Ÿ</p></div><div class="note orange anzhiyufont anzhiyu-icon-dengpao modern"><p>ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay</p></div><div class="note purple anzhiyufont anzhiyu-icon-sanmingzhi modern"><p>å‰ªåˆ€çŸ³å¤´å¸ƒ</p></div><div class="note green anzhiyufont anzhiyu-icon-ic_train modern"><p>å‰ç«¯æœ€è®¨åŒçš„æµè§ˆå™¨</p></div><p><code>fontawesome å›¾æ ‡</code>ï¼Œå¼€å¯ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­çš„<code>icons.fontawesome</code>ä¸º<code>true</code>åå¯è§</p><div class="note icon-padding modern"><i class="note-icon fab fa-cc-visa"></i><p>ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay</p></div><div class="note blue icon-padding modern"><i class="note-icon fas fa-bullhorn"></i><p>2021 å¹´å¿«åˆ°äº†â€¦.</p></div><div class="note pink icon-padding modern"><i class="note-icon fas fa-car-crash"></i><p>å°å¿ƒå¼€è½¦ å®‰å…¨è‡³ä¸Š</p></div><div class="note red icon-fan modern"><p>è¿™æ˜¯ä¸‰ç‰‡å‘¢ï¼Ÿè¿˜æ˜¯å››ç‰‡ï¼Ÿ</p></div><div class="note orange icon-padding modern"><i class="note-icon fas fa-battery-half"></i><p>ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay</p></div><div class="note purple icon-padding modern"><i class="note-icon far fa-hand-scissors"></i><p>å‰ªåˆ€çŸ³å¤´å¸ƒ</p></div><div class="note green icon-padding modern"><i class="note-icon fab fa-internet-explorer"></i><p>å‰ç«¯æœ€è®¨åŒçš„æµè§ˆå™¨</p></div><ol start="3"><li>flat æ ·å¼</li></ol><p><code>ä¸»é¢˜å†…ç½®é˜¿é‡Œå›¾æ ‡</code></p><div class="note anzhiyufont anzhiyu-icon-rocket flat"><p>ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay</p></div><div class="note blue anzhiyufont anzhiyu-icon-bullhorn flat"><p>2022 å¹´å¿«åˆ°äº†â€¦.</p></div><div class="note pink anzhiyufont anzhiyu-icon-instagram flat"><p>å°å¿ƒå¼€è½¦ å®‰å…¨è‡³ä¸Š</p></div><div class="note red anzhiyufont anzhiyu-icon-fan flat"><p>è¿™æ˜¯ä¸‰ç‰‡å‘¢ï¼Ÿè¿˜æ˜¯å››ç‰‡ï¼Ÿ</p></div><div class="note orange anzhiyufont anzhiyu-icon-dengpao flat"><p>ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay</p></div><div class="note purple anzhiyufont anzhiyu-icon-sanmingzhi flat"><p>å‰ªåˆ€çŸ³å¤´å¸ƒ</p></div><div class="note green anzhiyufont anzhiyu-icon-ic_train flat"><p>å‰ç«¯æœ€è®¨åŒçš„æµè§ˆå™¨</p></div><p><code>fontawesome å›¾æ ‡</code>ï¼Œå¼€å¯ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­çš„<code>icons.fontawesome</code>ä¸º<code>true</code>åå¯è§</p><div class="note icon-padding flat"><i class="note-icon fab fa-cc-visa"></i><p>ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay</p></div><div class="note blue icon-padding flat"><i class="note-icon fas fa-bullhorn"></i><p>2021 å¹´å¿«åˆ°äº†â€¦.</p></div><div class="note pink icon-padding flat"><i class="note-icon fas fa-car-crash"></i><p>å°å¿ƒå¼€è½¦ å®‰å…¨è‡³ä¸Š</p></div><div class="note red icon-fan flat"><p>è¿™æ˜¯ä¸‰ç‰‡å‘¢ï¼Ÿè¿˜æ˜¯å››ç‰‡ï¼Ÿ</p></div><div class="note orange icon-padding flat"><i class="note-icon fas fa-battery-half"></i><p>ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay</p></div><div class="note purple icon-padding flat"><i class="note-icon far fa-hand-scissors"></i><p>å‰ªåˆ€çŸ³å¤´å¸ƒ</p></div><div class="note green icon-padding flat"><i class="note-icon fab fa-internet-explorer"></i><p>å‰ç«¯æœ€è®¨åŒçš„æµè§ˆå™¨</p></div><ol start="4"><li>disabled æ ·å¼</li></ol><p><code>ä¸»é¢˜å†…ç½®é˜¿é‡Œå›¾æ ‡</code></p><div class="note anzhiyufont anzhiyu-icon-rocket disabled"><p>ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay</p></div><div class="note blue anzhiyufont anzhiyu-icon-bullhorn disabled"><p>2022 å¹´å¿«åˆ°äº†â€¦.</p></div><div class="note pink anzhiyufont anzhiyu-icon-instagram disabled"><p>å°å¿ƒå¼€è½¦ å®‰å…¨è‡³ä¸Š</p></div><div class="note red anzhiyufont anzhiyu-icon-fan disabled"><p>è¿™æ˜¯ä¸‰ç‰‡å‘¢ï¼Ÿè¿˜æ˜¯å››ç‰‡ï¼Ÿ</p></div><div class="note orange anzhiyufont anzhiyu-icon-dengpao disabled"><p>ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay</p></div><div class="note purple anzhiyufont anzhiyu-icon-sanmingzhi disabled"><p>å‰ªåˆ€çŸ³å¤´å¸ƒ</p></div><div class="note green anzhiyufont anzhiyu-icon-ic_train disabled"><p>å‰ç«¯æœ€è®¨åŒçš„æµè§ˆå™¨</p></div><p><code>fontawesome å›¾æ ‡</code>ï¼Œå¼€å¯ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­çš„<code>icons.fontawesome</code>ä¸º<code>true</code>åå¯è§</p><div class="note icon-padding disabled"><i class="note-icon fab fa-cc-visa"></i><p>ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay</p></div><div class="note blue icon-padding disabled"><i class="note-icon fas fa-bullhorn"></i><p>2021 å¹´å¿«åˆ°äº†â€¦.</p></div><div class="note pink icon-padding disabled"><i class="note-icon fas fa-car-crash"></i><p>å°å¿ƒå¼€è½¦ å®‰å…¨è‡³ä¸Š</p></div><div class="note red icon-fan disabled"><p>è¿™æ˜¯ä¸‰ç‰‡å‘¢ï¼Ÿè¿˜æ˜¯å››ç‰‡ï¼Ÿ</p></div><div class="note orange icon-padding disabled"><i class="note-icon fas fa-battery-half"></i><p>ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay</p></div><div class="note purple icon-padding disabled"><i class="note-icon far fa-hand-scissors"></i><p>å‰ªåˆ€çŸ³å¤´å¸ƒ</p></div><div class="note green icon-padding disabled"><i class="note-icon fab fa-internet-explorer"></i><p>å‰ç«¯æœ€è®¨åŒçš„æµè§ˆå™¨</p></div><ol start="5"><li>no-icon æ ·å¼</li></ol><div class="note no-icon flat"><p>ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay</p></div><div class="note blue no-icon flat"><p>2021 å¹´å¿«åˆ°äº†â€¦.</p></div><div class="note pink no-icon flat"><p>å°å¿ƒå¼€è½¦ å®‰å…¨è‡³ä¸Š</p></div><div class="note red no-icon flat"><p>è¿™æ˜¯ä¸‰ç‰‡å‘¢ï¼Ÿè¿˜æ˜¯å››ç‰‡ï¼Ÿ</p></div><div class="note orange no-icon flat"><p>ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay</p></div><div class="note purple no-icon flat"><p>å‰ªåˆ€çŸ³å¤´å¸ƒ</p></div><div class="note green no-icon flat"><p>å‰ç«¯æœ€è®¨åŒçš„æµè§ˆå™¨</p></div></div><div class="tab-item-content" id="note-5"><p><code>æ–¹æ³•ä¸€</code></p><ol><li><code>simple</code>æ ·å¼</li></ol><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note simple %&#125;é»˜è®¤ æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note default simple %&#125;default æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note primary simple %&#125;primary æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note success simple %&#125;success æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note info simple %&#125;info æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note warning simple %&#125;warning æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note danger simple %&#125;danger æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li><code>modern</code>æ ·å¼</li></ol><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note modern %&#125;é»˜è®¤ æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note default modern %&#125;default æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note primary modern %&#125;primary æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note success modern %&#125;success æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note info modern %&#125;info æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note warning modern %&#125;warning æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note danger modern %&#125;danger æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li><code>flat</code>æ ·å¼</li></ol><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note flat %&#125;é»˜è®¤ æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note default flat %&#125;default æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note primary flat %&#125;primary æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note success flat %&#125;success æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note info flat %&#125;info æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note warning flat %&#125;warning æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note danger flat %&#125;danger æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li><code>disabled</code>æ ·å¼</li></ol><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note disabled %&#125;é»˜è®¤ æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note default disabled %&#125;default æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note primary disabled %&#125;primary æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note success disabled %&#125;success æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note info disabled %&#125;info æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note warning disabled %&#125;warning æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note danger disabled %&#125;danger æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li><code>no-icon</code>æ ·å¼</li></ol><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note no-icon %&#125;é»˜è®¤ æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note default no-icon %&#125;default æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note primary no-icon %&#125;primary æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note success no-icon %&#125;success æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note info no-icon %&#125;info æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note warning no-icon %&#125;warning æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br><span class="line">&#123;% note danger no-icon %&#125;danger æç¤ºå—æ ‡ç­¾&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure><p><code>æ–¹æ³•äºŒ</code></p><p>å›¾æ ‡æ”¯æŒ <code>fontawesome</code> å’Œ <code>ä¸»é¢˜å†…ç½®çš„é˜¿é‡Œå›¾æ ‡</code>ï¼Œä½¿ç”¨æ–¹æ³•ä¸ºåŠ ä¸Šå¯¹åº”çš„ç±»åï¼Œ<code>fontawesome</code>å›¾æ ‡éœ€å¼€å¯ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­<code>icons.fontawesome</code>ï¼Œé»˜è®¤æœªå¼€å¯ fontawesome</p><ol><li><p>simple æ ·å¼<br><code>ä¸»é¢˜å†…ç½®é˜¿é‡Œå›¾æ ‡</code></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note &#x27;anzhiyufont anzhiyu-icon-rocket&#x27; simple %&#125;ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay&#123;% endnote %&#125;</span><br><span class="line">&#123;% note blue &#x27;anzhiyufont anzhiyu-icon-bullhorn&#x27; simple %&#125;2022 å¹´å¿«åˆ°äº†....&#123;% endnote %&#125;</span><br><span class="line">&#123;% note pink &#x27;anzhiyufont anzhiyu-icon-instagram&#x27; simple %&#125;å°å¿ƒå¼€è½¦ å®‰å…¨è‡³ä¸Š&#123;% endnote %&#125;</span><br><span class="line">&#123;% note red &#x27;anzhiyufont anzhiyu-icon-fan&#x27; simple%&#125;è¿™æ˜¯ä¸‰ç‰‡å‘¢ï¼Ÿè¿˜æ˜¯å››ç‰‡ï¼Ÿ&#123;% endnote %&#125;</span><br><span class="line">&#123;% note orange &#x27;anzhiyufont anzhiyu-icon-dengpao&#x27; simple %&#125;ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay&#123;% endnote %&#125;</span><br><span class="line">&#123;% note purple &#x27;anzhiyufont anzhiyu-icon-sanmingzhi&#x27; simple %&#125;å‰ªåˆ€çŸ³å¤´å¸ƒ&#123;% endnote %&#125;</span><br><span class="line">&#123;% note green &#x27;anzhiyufont anzhiyu-icon-ic<span class="emphasis">_train&#x27; simple %&#125;å‰ç«¯æœ€è®¨åŒçš„æµè§ˆå™¨&#123;% endnote %&#125;</span></span><br></pre></td></tr></table></figure><p><code>fontawesome å›¾æ ‡</code>ï¼Œå¼€å¯ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­çš„<code>icons.fontawesome</code>ä¸º<code>true</code>åå¯è§</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note &#x27;fab fa-cc-visa&#x27; simple %&#125;ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay&#123;% endnote %&#125;</span><br><span class="line">&#123;% note blue &#x27;fas fa-bullhorn&#x27; simple %&#125;2022 å¹´å¿«åˆ°äº†....&#123;% endnote %&#125;</span><br><span class="line">&#123;% note pink &#x27;fas fa-car-crash&#x27; simple %&#125;å°å¿ƒå¼€è½¦ å®‰å…¨è‡³ä¸Š&#123;% endnote %&#125;</span><br><span class="line">&#123;% note red &#x27;icon-fan&#x27; simple%&#125;è¿™æ˜¯ä¸‰ç‰‡å‘¢ï¼Ÿè¿˜æ˜¯å››ç‰‡ï¼Ÿ&#123;% endnote %&#125;</span><br><span class="line">&#123;% note orange &#x27;fas fa-battery-half&#x27; simple %&#125;ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay&#123;% endnote %&#125;</span><br><span class="line">&#123;% note purple &#x27;far fa-hand-scissors&#x27; simple %&#125;å‰ªåˆ€çŸ³å¤´å¸ƒ&#123;% endnote %&#125;</span><br><span class="line">&#123;% note green &#x27;fab fa-internet-explorer&#x27; simple %&#125;å‰ç«¯æœ€è®¨åŒçš„æµè§ˆå™¨&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure></li><li><p>modern æ ·å¼<br><code>ä¸»é¢˜å†…ç½®é˜¿é‡Œå›¾æ ‡</code></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note &#x27;anzhiyufont anzhiyu-icon-rocket&#x27; modern %&#125;ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay&#123;% endnote %&#125;</span><br><span class="line">&#123;% note blue &#x27;anzhiyufont anzhiyu-icon-bullhorn&#x27; modern %&#125;2022 å¹´å¿«åˆ°äº†....&#123;% endnote %&#125;</span><br><span class="line">&#123;% note pink &#x27;anzhiyufont anzhiyu-icon-instagram&#x27; modern %&#125;å°å¿ƒå¼€è½¦ å®‰å…¨è‡³ä¸Š&#123;% endnote %&#125;</span><br><span class="line">&#123;% note red &#x27;anzhiyufont anzhiyu-icon-fan&#x27; modern%&#125;è¿™æ˜¯ä¸‰ç‰‡å‘¢ï¼Ÿè¿˜æ˜¯å››ç‰‡ï¼Ÿ&#123;% endnote %&#125;</span><br><span class="line">&#123;% note orange &#x27;anzhiyufont anzhiyu-icon-dengpao&#x27; modern %&#125;ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay&#123;% endnote %&#125;</span><br><span class="line">&#123;% note purple &#x27;anzhiyufont anzhiyu-icon-sanmingzhi&#x27; modern %&#125;å‰ªåˆ€çŸ³å¤´å¸ƒ&#123;% endnote %&#125;</span><br><span class="line">&#123;% note green &#x27;anzhiyufont anzhiyu-icon-ic<span class="emphasis">_train&#x27; modern %&#125;å‰ç«¯æœ€è®¨åŒçš„æµè§ˆå™¨&#123;% endnote %&#125;</span></span><br></pre></td></tr></table></figure><p><code>fontawesome å›¾æ ‡</code>ï¼Œå¼€å¯ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­çš„<code>icons.fontawesome</code>ä¸º<code>true</code>åå¯è§</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note &#x27;fab fa-cc-visa&#x27; modern %&#125;ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay&#123;% endnote %&#125;</span><br><span class="line">&#123;% note blue &#x27;fas fa-bullhorn&#x27; modern %&#125;2021 å¹´å¿«åˆ°äº†....&#123;% endnote %&#125;</span><br><span class="line">&#123;% note pink &#x27;fas fa-car-crash&#x27; modern %&#125;å°å¿ƒå¼€è½¦ å®‰å…¨è‡³ä¸Š&#123;% endnote %&#125;</span><br><span class="line">&#123;% note red &#x27;icon-fan&#x27; modern%&#125;è¿™æ˜¯ä¸‰ç‰‡å‘¢ï¼Ÿè¿˜æ˜¯å››ç‰‡ï¼Ÿ&#123;% endnote %&#125;</span><br><span class="line">&#123;% note orange &#x27;fas fa-battery-half&#x27; modern %&#125;ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay&#123;% endnote %&#125;</span><br><span class="line">&#123;% note purple &#x27;far fa-hand-scissors&#x27; modern %&#125;å‰ªåˆ€çŸ³å¤´å¸ƒ&#123;% endnote %&#125;</span><br><span class="line">&#123;% note green &#x27;fab fa-internet-explorer&#x27; modern %&#125;å‰ç«¯æœ€è®¨åŒçš„æµè§ˆå™¨&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure></li><li><p>flat æ ·å¼<br><code>ä¸»é¢˜å†…ç½®é˜¿é‡Œå›¾æ ‡</code></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note &#x27;anzhiyufont anzhiyu-icon-rocket&#x27; flat %&#125;ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay&#123;% endnote %&#125;</span><br><span class="line">&#123;% note blue &#x27;anzhiyufont anzhiyu-icon-bullhorn&#x27; flat %&#125;2022 å¹´å¿«åˆ°äº†....&#123;% endnote %&#125;</span><br><span class="line">&#123;% note pink &#x27;anzhiyufont anzhiyu-icon-instagram&#x27; flat %&#125;å°å¿ƒå¼€è½¦ å®‰å…¨è‡³ä¸Š&#123;% endnote %&#125;</span><br><span class="line">&#123;% note red &#x27;anzhiyufont anzhiyu-icon-fan&#x27; flat%&#125;è¿™æ˜¯ä¸‰ç‰‡å‘¢ï¼Ÿè¿˜æ˜¯å››ç‰‡ï¼Ÿ&#123;% endnote %&#125;</span><br><span class="line">&#123;% note orange &#x27;anzhiyufont anzhiyu-icon-dengpao&#x27; flat %&#125;ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay&#123;% endnote %&#125;</span><br><span class="line">&#123;% note purple &#x27;anzhiyufont anzhiyu-icon-sanmingzhi&#x27; flat %&#125;å‰ªåˆ€çŸ³å¤´å¸ƒ&#123;% endnote %&#125;</span><br><span class="line">&#123;% note green &#x27;anzhiyufont anzhiyu-icon-ic<span class="emphasis">_train&#x27; flat %&#125;å‰ç«¯æœ€è®¨åŒçš„æµè§ˆå™¨&#123;% endnote %&#125;</span></span><br></pre></td></tr></table></figure><p><code>fontawesome å›¾æ ‡</code>ï¼Œå¼€å¯ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­çš„<code>icons.fontawesome</code>ä¸º<code>true</code>åå¯è§</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note &#x27;fab fa-cc-visa&#x27; flat %&#125;ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay&#123;% endnote %&#125;</span><br><span class="line">&#123;% note blue &#x27;fas fa-bullhorn&#x27; flat %&#125;2021 å¹´å¿«åˆ°äº†....&#123;% endnote %&#125;</span><br><span class="line">&#123;% note pink &#x27;fas fa-car-crash&#x27; flat %&#125;å°å¿ƒå¼€è½¦ å®‰å…¨è‡³ä¸Š&#123;% endnote %&#125;</span><br><span class="line">&#123;% note red &#x27;icon-fan&#x27; flat%&#125;è¿™æ˜¯ä¸‰ç‰‡å‘¢ï¼Ÿè¿˜æ˜¯å››ç‰‡ï¼Ÿ&#123;% endnote %&#125;</span><br><span class="line">&#123;% note orange &#x27;fas fa-battery-half&#x27; flat %&#125;ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay&#123;% endnote %&#125;</span><br><span class="line">&#123;% note purple &#x27;far fa-hand-scissors&#x27; flat %&#125;å‰ªåˆ€çŸ³å¤´å¸ƒ&#123;% endnote %&#125;</span><br><span class="line">&#123;% note green &#x27;fab fa-internet-explorer&#x27; flat %&#125;å‰ç«¯æœ€è®¨åŒçš„æµè§ˆå™¨&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure></li><li><p>disabled æ ·å¼<br><code>ä¸»é¢˜å†…ç½®é˜¿é‡Œå›¾æ ‡</code></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note &#x27;anzhiyufont anzhiyu-icon-rocket&#x27; disabled %&#125;ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay&#123;% endnote %&#125;</span><br><span class="line">&#123;% note blue &#x27;anzhiyufont anzhiyu-icon-bullhorn&#x27; disabled %&#125;2022 å¹´å¿«åˆ°äº†....&#123;% endnote %&#125;</span><br><span class="line">&#123;% note pink &#x27;anzhiyufont anzhiyu-icon-instagram&#x27; disabled %&#125;å°å¿ƒå¼€è½¦ å®‰å…¨è‡³ä¸Š&#123;% endnote %&#125;</span><br><span class="line">&#123;% note red &#x27;anzhiyufont anzhiyu-icon-fan&#x27; disabled%&#125;è¿™æ˜¯ä¸‰ç‰‡å‘¢ï¼Ÿè¿˜æ˜¯å››ç‰‡ï¼Ÿ&#123;% endnote %&#125;</span><br><span class="line">&#123;% note orange &#x27;anzhiyufont anzhiyu-icon-dengpao&#x27; disabled %&#125;ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay&#123;% endnote %&#125;</span><br><span class="line">&#123;% note purple &#x27;anzhiyufont anzhiyu-icon-sanmingzhi&#x27; disabled %&#125;å‰ªåˆ€çŸ³å¤´å¸ƒ&#123;% endnote %&#125;</span><br><span class="line">&#123;% note green &#x27;anzhiyufont anzhiyu-icon-ic<span class="emphasis">_train&#x27; disabled %&#125;å‰ç«¯æœ€è®¨åŒçš„æµè§ˆå™¨&#123;% endnote %&#125;</span></span><br></pre></td></tr></table></figure><p><code>fontawesome å›¾æ ‡</code>ï¼Œå¼€å¯ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­çš„<code>icons.fontawesome</code>ä¸º<code>true</code>åå¯è§</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note &#x27;fab fa-cc-visa&#x27; disabled %&#125;ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay&#123;% endnote %&#125;</span><br><span class="line">&#123;% note blue &#x27;fas fa-bullhorn&#x27; disabled %&#125;2021 å¹´å¿«åˆ°äº†....&#123;% endnote %&#125;</span><br><span class="line">&#123;% note pink &#x27;fas fa-car-crash&#x27; disabled %&#125;å°å¿ƒå¼€è½¦ å®‰å…¨è‡³ä¸Š&#123;% endnote %&#125;</span><br><span class="line">&#123;% note red &#x27;icon-fan&#x27; disabled %&#125;è¿™æ˜¯ä¸‰ç‰‡å‘¢ï¼Ÿè¿˜æ˜¯å››ç‰‡ï¼Ÿ&#123;% endnote %&#125;</span><br><span class="line">&#123;% note orange &#x27;fas fa-battery-half&#x27; disabled %&#125;ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay&#123;% endnote %&#125;</span><br><span class="line">&#123;% note purple &#x27;far fa-hand-scissors&#x27; disabled %&#125;å‰ªåˆ€çŸ³å¤´å¸ƒ&#123;% endnote %&#125;</span><br><span class="line">&#123;% note green &#x27;fab fa-internet-explorer&#x27; disabled %&#125;å‰ç«¯æœ€è®¨åŒçš„æµè§ˆå™¨&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure></li><li><p>no-icon æ ·å¼</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note no-icon %&#125;ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay&#123;% endnote %&#125;</span><br><span class="line">&#123;% note blue no-icon %&#125;2021 å¹´å¿«åˆ°äº†....&#123;% endnote %&#125;</span><br><span class="line">&#123;% note pink no-icon %&#125;å°å¿ƒå¼€è½¦ å®‰å…¨è‡³ä¸Š&#123;% endnote %&#125;</span><br><span class="line">&#123;% note red no-icon %&#125;è¿™æ˜¯ä¸‰ç‰‡å‘¢ï¼Ÿè¿˜æ˜¯å››ç‰‡ï¼Ÿ&#123;% endnote %&#125;</span><br><span class="line">&#123;% note orange no-icon %&#125;ä½ æ˜¯åˆ· Visa è¿˜æ˜¯ UnionPay&#123;% endnote %&#125;</span><br><span class="line">&#123;% note purple no-icon %&#125;å‰ªåˆ€çŸ³å¤´å¸ƒ&#123;% endnote %&#125;</span><br><span class="line">&#123;% note green no-icon %&#125;å‰ç«¯æœ€è®¨åŒçš„æµè§ˆå™¨&#123;% endnote %&#125;</span><br></pre></td></tr></table></figure></li></ol></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="éŸ³é¢‘-audio"><a href="#éŸ³é¢‘-audio" class="headerlink" title="éŸ³é¢‘ audio"></a>éŸ³é¢‘ audio</h2><div class="tabs" id="audio"><ul class="nav-tabs"><button type="button" class="tab " data-href="audio-1">æ ‡ç­¾è¯­æ³•</button><button type="button" class="tab  active" data-href="audio-2">æ ·å¼é¢„è§ˆ</button><button type="button" class="tab " data-href="audio-3">ç¤ºä¾‹æºç </button></ul><div class="tab-contents"><div class="tab-item-content" id="audio-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% audio éŸ³é¢‘é“¾æ¥ %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content active" id="audio-2"><div class="audio"><audio controls preload><source src="https://npm.elemecdn.com/anzhiyu-music@1.0.4/%E9%9D%92%E8%8A%B1%E7%93%B7/%E9%9D%92%E8%8A%B1%E7%93%B7.mp3" type="audio/mp3">Your browser does not support the audio tag.</audio></div></div><div class="tab-item-content" id="audio-3"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% audio https://npm.elemecdn.com/anzhiyu-music@1.0.4/%E9%9D%92%E8%8A%B1%E7%93%B7/%E9%9D%92%E8%8A%B1%E7%93%B7.mp3 %&#125;</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="è§†é¢‘-video"><a href="#è§†é¢‘-video" class="headerlink" title="è§†é¢‘ video"></a>è§†é¢‘ video</h2><div class="tabs" id="video"><ul class="nav-tabs"><button type="button" class="tab " data-href="video-1">æ ‡ç­¾è¯­æ³•</button><button type="button" class="tab " data-href="video-2">å‚æ•°é…ç½®</button><button type="button" class="tab  active" data-href="video-3">æ ·å¼é¢„è§ˆ</button><button type="button" class="tab " data-href="video-4">ç¤ºä¾‹æºç </button></ul><div class="tab-contents"><div class="tab-item-content" id="video-1"><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% video è§†é¢‘é“¾æ¥ %&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="video-2"><ol><li>å¯¹å…¶æ–¹å‘ï¼šleft, center, right</li><li>åˆ—æ•°ï¼šé€—å·åé¢ç›´æ¥å†™åˆ—æ•°ï¼Œæ”¯æŒ 1 ï½ 4 åˆ—ã€‚</li></ol></div><div class="tab-item-content active" id="video-3"><ol start="3"><li>100%å®½åº¦</li></ol><p><img src="https://bu.dusays.com/2023/06/01/6478a1eeb1386.png" alt="100%å®½åº¦"></p><ol start="2"><li>50%å®½åº¦</li></ol><p><img src="https://bu.dusays.com/2023/06/01/6478a20a5f242.png" alt="50%å®½åº¦"></p><ol start="3"><li>25%å®½åº¦</li></ol><p><img src="https://bu.dusays.com/2023/06/01/6478a22b26088.png" alt="25%å®½åº¦"></p></div><div class="tab-item-content" id="video-4"><ol><li>100%å®½åº¦</li></ol><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG<span class="emphasis">_0341.mov %&#125;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>50%å®½åº¦</li></ol><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;% videos, 2 %&#125;</span><br><span class="line">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG<span class="emphasis">_0341.mov %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_</span>0341.mov %&#125;</span><br><span class="line">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG<span class="emphasis">_0341.mov %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_</span>0341.mov %&#125;</span><br><span class="line">&#123;% endvideos %&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>25%å®½åº¦</li></ol><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;% videos, 4 %&#125;</span><br><span class="line">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG<span class="emphasis">_0341.mov %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_</span>0341.mov %&#125;</span><br><span class="line">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG<span class="emphasis">_0341.mov %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_</span>0341.mov %&#125;</span><br><span class="line">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG<span class="emphasis">_0341.mov %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_</span>0341.mov %&#125;</span><br><span class="line">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG<span class="emphasis">_0341.mov %&#125;</span></span><br><span class="line"><span class="emphasis">&#123;% video https://github.com/volantis-x/volantis-docs/releases/download/assets/IMG_</span>0341.mov %&#125;</span><br><span class="line">&#123;% endvideos %&#125;</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><p>æœ¬æ–‡è½¬è½½è‡ª<a href="https://blog.anheyu.com/posts/d50a.html">å®‰çŸ¥é±¼</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Springæºç åˆ†æ</title>
      <link href="/2023/10/28/SpringAnalysis/"/>
      <url>/2023/10/28/SpringAnalysis/</url>
      
        <content type="html"><![CDATA[<h1 id="Springæºç åˆ†æ"><a href="#Springæºç åˆ†æ" class="headerlink" title="Springæºç åˆ†æ"></a>Springæºç åˆ†æ</h1><h2 id="AnnotationConfigApplicationContext"><a href="#AnnotationConfigApplicationContext" class="headerlink" title="AnnotationConfigApplicationContext"></a>AnnotationConfigApplicationContext</h2><p>åæ¨çŒœæµ‹åº”è¯¥å®Œæˆä»€ä¹ˆ?</p><ol><li>ç”Ÿæˆbeanå¯¹è±¡  -&gt;  åˆ›å»ºbeanFactory ï¼ˆbeanå·¥å‚ï¼‰</li><li>BeanDefinitionç±» (åŠ è½½beanä¿¡æ¯,  é€šè¿‡æ³¨è§£å¾—æ¥çš„ä¿¡æ¯)   -&gt;  æ³¨è§£é…ç½®è§£æå™¨AnnotationBeanDefinitionReaderç±»</li></ol><p>AnnotationBeanDefinitionReaderä¸­è¯»å–åˆ°ä¸åŒçš„æ³¨è§£ï¼Œæœ‰ä¸€ç³»åˆ—çš„æ³¨è§£è§£æå™¨å»è§£æä¸åŒçš„æ³¨è§£</p><ol start="3"><li>ç±»è·¯å¾„æ‰«æå™¨ ClassPathBeanDefinitionScanner</li><li>ç³»ç»Ÿå±æ€§æ‰«æå™¨ â€¦</li></ol><p>æ·±å…¥AnnotationConfigApplicationContextæ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">AnnotationConfigApplicationContext</span><span class="params">(Class&lt;?&gt;... componentClasses)</span> &#123; <span class="comment">// é…ç½®ç±»å¯ä»¥æœ‰å¤šä¸ª</span></span><br><span class="line">    <span class="comment">// è°ƒç”¨æ— å‚æ•°æ„é€ å‡½æ•°, åˆå§‹åŒ–ä¸‰ä¸ªé‡è¦å¯¹è±¡</span></span><br><span class="line">    <span class="comment">// 1. DefaultListableBeanFactoryå·¥å‚: ç”Ÿæˆbeanå¯¹è±¡çš„beanFactoryå·¥å‚</span></span><br><span class="line">    <span class="comment">// 2. AnnotatedBeanDefinitionReader: å¯¹åŠ äº†ç‰¹å®šæ³¨è§£(å¦‚@Serviceã€@Repository)çš„ç±»è¿›è¡Œè¯»å–è½¬æ¢ä¸ºBeanDefinitionå¯¹è±¡</span></span><br><span class="line">    <span class="comment">// è¿˜è¦æ³¨å†Œå„ç§å¤„ç†å™¨: registerAnnotationConfigProcessors(), é€šè¿‡æ­¤æ–¹æ³•æ·»åŠ å„ç§å†…ç½®å¤„ç†å™¨, å…¶ä¸­æœ€é‡è¦çš„:</span></span><br><span class="line">    <span class="comment">// 2.1 â˜…ConfigurationClassPostProcessor æ˜¯ä¸€ä¸ªbeanFactoryåç½®å¤„ç†å™¨,ç”¨æ¥å®Œæˆbeançš„æ‰«æä¸æ³¨å…¥</span></span><br><span class="line">    <span class="comment">// 2.2  AutowiredAnnotationBeanPostProcessoræ˜¯ä¸€ä¸ªbeançš„åç½®å¤„ç†å™¨, ä¾èµ–å®Œæˆ@Autowiredè‡ªåŠ¨æ³¨å…¥</span></span><br><span class="line">    <span class="comment">// 3. ClassPathBeanDefinitionScanner:å¯¹ç”¨æˆ·æŒ‡å®šçš„åŒ…ç›®å½•è¿›è¡Œæ‰«ææŸ¥æ‰¾beanå¯¹è±¡çš„è·¯å¾„ æ‰«æ</span></span><br><span class="line">    <span class="built_in">this</span>();</span><br><span class="line">    <span class="comment">// åˆ©ç”¨AnnotatedBeanDefinitionReaderå–å°†ä¼ è¿›æ¥çš„Configurationç±»åšè§£æ</span></span><br><span class="line">    <span class="comment">// å°†é…ç½®ç±»Configurationæ³¨å†Œåˆ°å®¹å™¨,ä½†ä¸å®ä¾‹åŒ–,å…¶ä¸­æœ€æ ¸å¿ƒçš„æ–¹æ³•ä¸º:doRegisterBean()</span></span><br><span class="line">    <span class="built_in">this</span>.register(componentClasses);</span><br><span class="line">    <span class="comment">// ***å®¹å™¨åˆ·æ–°***  @ComponentScanåœ¨è¿™é‡Œå®Œæˆè§£æ</span></span><br><span class="line">    <span class="built_in">this</span>.refresh();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="thisç±»ä¸­æ‰˜ç®¡çš„å„ç§æ³¨è§£è§£æå™¨bean"><a href="#thisç±»ä¸­æ‰˜ç®¡çš„å„ç§æ³¨è§£è§£æå™¨bean" class="headerlink" title="thisç±»ä¸­æ‰˜ç®¡çš„å„ç§æ³¨è§£è§£æå™¨bean"></a>thisç±»ä¸­æ‰˜ç®¡çš„å„ç§æ³¨è§£è§£æå™¨bean</h3><p><strong>this()æ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">AnnotationConfigApplicationContext</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();<span class="comment">//è°ƒç”¨çˆ¶ç±»æ— å‚æ•°æ„é€ æ–¹æ³•,çœç•¥äº†</span></span><br><span class="line">    <span class="comment">// startupStepç±»: è®°å½•Applicationå¯åŠ¨æœŸé—´å‘ç”Ÿçš„ç‰¹å®šé˜¶æ®µå’Œæ“ä½œçš„åº¦é‡æŒ‡æ ‡</span></span><br><span class="line">    <span class="type">StartupStep</span> <span class="variable">createAnnotatedBeanDefReader</span> <span class="operator">=</span> <span class="built_in">this</span>.getApplicationStartup().start(<span class="string">&quot;spring.context.annotated-bean-reader.create&quot;</span>);</span><br><span class="line">    <span class="comment">// ç”Ÿæˆå¹¶æ³¨å†ŒBeanDefinition</span></span><br><span class="line">    <span class="comment">// é…ç½®ç±»</span></span><br><span class="line">    <span class="comment">//1.org.springframework.context.annotation.internalConfigurationAnnotationProcessor </span></span><br><span class="line">    <span class="comment">// è‡ªåŠ¨é…ç½®</span></span><br><span class="line">    <span class="comment">//2.org.springframework.context.annotation.internalAutowiredAnnotationProcessor     </span></span><br><span class="line">    <span class="comment">// ç‰¹å®šæ³¨è§£</span></span><br><span class="line">    <span class="comment">//3.org.springframework.context.annotation.internalCommonAnnotationPostProcessor   </span></span><br><span class="line">    <span class="comment">// äº‹ä»¶ç›‘å¬</span></span><br><span class="line">    <span class="comment">//4.org.springframework.context.event.internalEventListenerProcessor</span></span><br><span class="line">    <span class="comment">// å·¥å‚</span></span><br><span class="line">    <span class="comment">//5.org.springframework.context.event.internalEventListenerFactory</span></span><br><span class="line">    <span class="built_in">this</span>.reader = <span class="keyword">new</span> <span class="title class_">AnnotatedBeanDefinitionReader</span>(<span class="built_in">this</span>);<span class="comment">// æ³¨è§£beanè¯»å–</span></span><br><span class="line">    createAnnotatedBeanDefReader.end();</span><br><span class="line">    <span class="comment">// æ³¨å†Œé»˜è®¤çš„includeFilter</span></span><br><span class="line">    <span class="built_in">this</span>.scanner = <span class="keyword">new</span> <span class="title class_">ClassPathBeanDefinitionScanner</span>(<span class="built_in">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤å‘ç°è¿˜å°‘äº†ä¸€ä¸ª<code>DefaultListableBeanFactory</code>çš„å·¥å‚åˆ›å»º</p><h4 id="æ„å»ºå·¥å‚"><a href="#æ„å»ºå·¥å‚" class="headerlink" title="æ„å»ºå·¥å‚"></a>æ„å»ºå·¥å‚</h4><p><code>super()</code></p><p>ç‚¹è¿›çˆ¶ç±» (GenericApplicationContext) -&gt; super()</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">GenericApplicationContext</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.customClassLoader = <span class="literal">false</span>;</span><br><span class="line">    <span class="built_in">this</span>.refreshed = <span class="keyword">new</span> <span class="title class_">AtomicBoolean</span>();</span><br><span class="line">    <span class="comment">// çˆ¶ç±»æ„é€ å™¨ä¸­åˆ›å»ºäº†ä¸€ä¸ªbeanå·¥å‚,é»˜è®¤åˆ—è¡¨beanå·¥å‚</span></span><br><span class="line">    <span class="built_in">this</span>.beanFactory = <span class="keyword">new</span> <span class="title class_">DefaultListableBeanFactory</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°è¿™å‘ç°æˆ‘ä»¬çŒœæƒ³çš„ä¸‰ä¸ªåŠŸèƒ½<strong>åœ¨this()ä¸­</strong>å…¨éƒ¨æ‰¾åˆ°</p><h4 id="æ³¨å†Œå„ç§å¤„ç†å™¨"><a href="#æ³¨å†Œå„ç§å¤„ç†å™¨" class="headerlink" title="æ³¨å†Œå„ç§å¤„ç†å™¨"></a>æ³¨å†Œå„ç§å¤„ç†å™¨</h4><p><code>this.reader = new AnnotatedBeanDefinitionReader(this)</code></p><p>æ³¨å†Œå¤„ç†å™¨, ç‚¹è¿›å»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">AnnotatedBeanDefinitionReader</span><span class="params">(BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºç³»ç»Ÿ å±æ€§åŠç¯å¢ƒå˜é‡ getOrCreateEnvironment()</span></span><br><span class="line">    <span class="comment">// æŸ¥çœ‹this(xx,yy)æ„é€ æ–¹æ³•</span></span><br><span class="line">    <span class="built_in">this</span>(registry, getOrCreateEnvironment(registry));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ„é€ æ–¹æ³•<code>this(xx,yy)</code>,ç‚¹è¿›å»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">AnnotatedBeanDefinitionReader</span><span class="params">(BeanDefinitionRegistry registry, Environment environment)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.beanNameGenerator = AnnotationBeanNameGenerator.INSTANCE;</span><br><span class="line">    <span class="built_in">this</span>.scopeMetadataResolver = <span class="keyword">new</span> <span class="title class_">AnnotationScopeMetadataResolver</span>();</span><br><span class="line">    Assert.notNull(registry, <span class="string">&quot;BeanDefinitionRegistry must not be null&quot;</span>);</span><br><span class="line">    Assert.notNull(environment, <span class="string">&quot;Environment must not be null&quot;</span>);</span><br><span class="line">    <span class="built_in">this</span>.registry = registry;</span><br><span class="line">    <span class="comment">// å†…éƒ¨ç±»ç”¨äºè§£æ @Conditionalæ³¨è§£</span></span><br><span class="line">    <span class="built_in">this</span>.conditionEvaluator = <span class="keyword">new</span> <span class="title class_">ConditionEvaluator</span>(registry, environment, (ResourceLoader)<span class="literal">null</span>);</span><br><span class="line">    <span class="comment">// æ³¨å†Œå¤šç§å†…ç½®æ³¨è§£é…ç½®è§£æå™¨</span></span><br><span class="line">    AnnotationConfigUtils.registerAnnotationConfigProcessors(<span class="built_in">this</span>.registry);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ·±å…¥<code>AnnotationConfigUtils.registerAnnotationConfigProcessors(this.registry)</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">registerAnnotationConfigProcessors</span><span class="params">(BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line">    registerAnnotationConfigProcessors(registry, (Object)<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Set&lt;BeanDefinitionHolder&gt; <span class="title function_">registerAnnotationConfigProcessors</span><span class="params">(BeanDefinitionRegistry registry, <span class="meta">@Nullable</span> Object source)</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºBeanå·¥å‚   beanFactory</span></span><br><span class="line">    <span class="type">DefaultListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> unwrapDefaultListableBeanFactory(registry);</span><br><span class="line">    <span class="keyword">if</span> (beanFactory != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// é€æ­¥è¿½åŠ ä¸€äº›é»˜è®¤ç»„ä»¶</span></span><br><span class="line">        <span class="comment">// ç¬¬ä¸€ä¸ªè¿½åŠ çš„ç»„ä»¶ AnnotationAwareOrderComparator</span></span><br><span class="line">        <span class="keyword">if</span> (!(beanFactory.getDependencyComparator() <span class="keyword">instanceof</span> AnnotationAwareOrderComparator)) &#123;</span><br><span class="line">            <span class="comment">// å¯¹@Orderã€@Priorityã€Orderedæ¥å£è¿›è¡Œæ’åºçš„æ¯”è¾ƒç±»</span></span><br><span class="line">            beanFactory.setDependencyComparator(AnnotationAwareOrderComparator.INSTANCE);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!(beanFactory.getAutowireCandidateResolver() <span class="keyword">instanceof</span> ContextAnnotationAutowireCandidateResolver)) &#123;</span><br><span class="line">            <span class="comment">// @Autowired @Qualifier @Lazyæ³¨è§£è§£æå™¨</span></span><br><span class="line">            beanFactory.setAutowireCandidateResolver(<span class="keyword">new</span> <span class="title class_">ContextAnnotationAutowireCandidateResolver</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// BeanDefinitionHolder: æœ‰åå­—å’Œåˆ«åçš„</span></span><br><span class="line">    Set&lt;BeanDefiniti onHolder&gt; beanDefs = <span class="keyword">new</span> <span class="title class_">LinkedHashSet</span>(<span class="number">8</span>);</span><br><span class="line">    RootBeanDefinition def;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­å®¹å™¨æ˜¯å¦æœ‰internalConfigurationAnnotationProcessor è¿™ä¸ªbean</span></span><br><span class="line">    <span class="keyword">if</span> (!registry.containsBeanDefinition(<span class="string">&quot;org.springframework.context.annotation.internalConfigurationAnnotationProcessor&quot;</span>)) &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªé…ç½®ç±»å¤„ç†å™¨,æ‰˜ç®¡æˆBean  ConfigurationClassPostProcessor</span></span><br><span class="line">        def = <span class="keyword">new</span> <span class="title class_">RootBeanDefinition</span>(ConfigurationClassPostProcessor.class);</span><br><span class="line">        <span class="comment">// è¡¥å……ä¸€ä¸ªå±æ€§å€¼  source</span></span><br><span class="line">        def.setSource(source);</span><br><span class="line">        <span class="comment">// åœ¨registerPostProcessor()ä¸­å°† RootBeanDefinition åŒ…è£…æˆ BeanDefinitionHolder, ä¸ºä»€ä¹ˆ?</span></span><br><span class="line">        <span class="comment">// BeanDefinitionæ·»åŠ äº†alias(åˆ«å)</span></span><br><span class="line">        <span class="comment">// å¦å¤–, æ³¨å†Œæ­¤beanåˆ°å®¹å™¨æ˜¯åœ¨ åœ¨registerPostProcessorå®Œæˆçš„ (ä»…ä»…æ˜¯åŠ è½½åˆ°å®¹å™¨ä¸­)</span></span><br><span class="line">        beanDefs.add(registerPostProcessor(registry, def, <span class="string">&quot;org.springframework.context.annotation.internalConfigurationAnnotationProcessor&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!registry.containsBeanDefinition(<span class="string">&quot;org.springframework.context.annotation.internalAutowiredAnnotationProcessor&quot;</span>)) &#123;</span><br><span class="line">        <span class="comment">// æ²¡æœ‰åˆ™åˆ›å»º AutowiredAnnotationBeanPostProcessor å¹¶ä¸”æ‰˜ç®¡</span></span><br><span class="line">        def = <span class="keyword">new</span> <span class="title class_">RootBeanDefinition</span>(AutowiredAnnotationBeanPostProcessor.class);</span><br><span class="line">        def.setSource(source);</span><br><span class="line">        beanDefs.add(registerPostProcessor(registry, def, <span class="string">&quot;org.springframework.context.annotation.internalAutowiredAnnotationProcessor&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// çœç•¥å…¶ä»–çš„å¤„ç†å™¨,å½“å‰ä»…ç•™ä¿©ä¸ªæ ·ä¾‹</span></span><br><span class="line">    <span class="keyword">return</span> beanDefs; <span class="comment">// è¿”å›BeanHolderProcessé›†åˆ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><mark class="hl-label pink">æ¢³ç†ä¸€ä¸‹:</mark> <p>super() : <strong>åˆå§‹åŒ–beanå·¥å‚</strong></p><p>new AnnotatedBeanDefinitionReader(this) : <strong>åˆ›å»ºå„ç§å„æ ·çš„å¤„ç†å™¨</strong></p><h3 id="registeræ³¨å†Œé…ç½®ç±»"><a href="#registeræ³¨å†Œé…ç½®ç±»" class="headerlink" title="registeræ³¨å†Œé…ç½®ç±»"></a>registeræ³¨å†Œé…ç½®ç±»</h3><p>æ³¨å†Œ@Configurationç±»</p><p><strong>this.register(componentClasses)</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(Class&lt;?&gt;... componentClasses)</span> &#123;</span><br><span class="line">    <span class="comment">// æ–­è¨€</span></span><br><span class="line">    Assert.notEmpty(componentClasses, <span class="string">&quot;At least one component class must be specified&quot;</span>);</span><br><span class="line">    <span class="type">StartupStep</span> <span class="variable">registerComponentClass</span> <span class="operator">=</span> <span class="built_in">this</span>.getApplicationStartup().start(<span class="string">&quot;spring.context.component-classes.register&quot;</span>).tag(<span class="string">&quot;classes&quot;</span>, () -&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> Arrays.toString(componentClasses);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// æ³¨å†Œé…ç½®ç±» (ç‚¹è¿›å»)</span></span><br><span class="line">    <span class="built_in">this</span>.reader.register(componentClasses);</span><br><span class="line">    registerComponentClass.end();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>this.reader.register(componentClasses);</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(Class&lt;?&gt;... componentClasses)</span> &#123;</span><br><span class="line">    Class[] var2 = componentClasses;</span><br><span class="line">    <span class="type">int</span> <span class="variable">var3</span> <span class="operator">=</span> componentClasses.length;</span><br><span class="line"><span class="comment">// å¾ªç¯éå†componentClassç»„ä»¶ç±»</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">var4</span> <span class="operator">=</span> <span class="number">0</span>; var4 &lt; var3; ++var4) &#123;</span><br><span class="line">        Class&lt;?&gt; componentClass = var2[var4];</span><br><span class="line">        <span class="comment">// æ³¨å†Œbean</span></span><br><span class="line">        <span class="built_in">this</span>.registerBean(componentClass);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœŸæ­£æ³¨å†Œbean çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> &lt;T&gt; <span class="keyword">void</span> <span class="title function_">doRegisterBean</span><span class="params">(Class&lt;T&gt; beanClass, <span class="meta">@Nullable</span> String name, <span class="meta">@Nullable</span> Class&lt;? extends Annotation&gt;[] qualifiers, <span class="meta">@Nullable</span> Supplier&lt;T&gt; supplier, <span class="meta">@Nullable</span> BeanDefinitionCustomizer[] customizers)</span> &#123;</span><br><span class="line">    <span class="comment">// è§£æåŒ…è£…ä¼ å…¥çš„ Configurationç±»,å˜æˆAnnotatedGenericBeanDefinitionå¯¹è±¡</span></span><br><span class="line">    <span class="type">AnnotatedGenericBeanDefinition</span> <span class="variable">abd</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotatedGenericBeanDefinition</span>(beanClass);</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦è¦è·³è¿‡,åˆ¤æ–­ä¾æ®æ˜¯æ­¤ç±»ä¸Šæ˜¯å¦æœ‰@Conditionalæ³¨è§£</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.conditionEvaluator.shouldSkip(abd.getMetadata())) &#123;</span><br><span class="line">        <span class="comment">// å›è°ƒå‡½æ•°</span></span><br><span class="line">        abd.setInstanceSupplier(supplier);</span><br><span class="line">        <span class="comment">// Scopeå€¼</span></span><br><span class="line">        <span class="type">ScopeMetadata</span> <span class="variable">scopeMetadata</span> <span class="operator">=</span> <span class="built_in">this</span>.scopeMetadataResolver.resolveScopeMetadata(abd);</span><br><span class="line">        <span class="comment">// é»˜è®¤è®¾ç½®scopeæ˜¯singleton</span></span><br><span class="line">        abd.setScope(scopeMetadata.getScopeName());</span><br><span class="line">        <span class="comment">// å¦‚æœæœ‰å®šä¹‰beançš„åå­—åˆ™ç”¨å®šä¹‰çš„,å¦åˆ™åˆ™è·å–å¹¶ç”Ÿæˆ</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">beanName</span> <span class="operator">=</span> name != <span class="literal">null</span> ? name : <span class="built_in">this</span>.beanNameGenerator.generateBeanName(abd, <span class="built_in">this</span>.registry);</span><br><span class="line">        <span class="comment">// å¤„ç†ç±»ä¸Šé¢çš„é€šç”¨æ³¨è§£: å¦‚@Lazy @Primary @DependsOn,è§£æå‡ºå·¦è¾¹çš„æ³¨è§£,ä¿å­˜åˆ°BeanDefinitionä¸­</span></span><br><span class="line">        AnnotationConfigUtils.processCommonDefinitionAnnotations(abd);</span><br><span class="line">        <span class="type">int</span> var10;</span><br><span class="line">        <span class="type">int</span> var11;</span><br><span class="line">        <span class="keyword">if</span> (qualifiers != <span class="literal">null</span>) &#123;</span><br><span class="line">            Class[] var9 = qualifiers;</span><br><span class="line">            var10 = qualifiers.length;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(var11 = <span class="number">0</span>; var11 &lt; var10; ++var11) &#123;</span><br><span class="line">                Class&lt;? <span class="keyword">extends</span> <span class="title class_">Annotation</span>&gt; qualifier = var9[var11];</span><br><span class="line">                <span class="keyword">if</span> (Primary.class == qualifier) &#123;</span><br><span class="line">                    abd.setPrimary(<span class="literal">true</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Lazy.class == qualifier) &#123;</span><br><span class="line">                    abd.setLazyInit(<span class="literal">true</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    abd.addQualifier(<span class="keyword">new</span> <span class="title class_">AutowireCandidateQualifier</span>(qualifier));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ç”¨æˆ·è‡ªå®šä¹‰æ³¨è§£</span></span><br><span class="line">        <span class="keyword">if</span> (customizers != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// ç±»å¿…é¡»å®ç°BeanDefinitionCustomizeræ¥å£</span></span><br><span class="line">            BeanDefinitionCustomizer[] var13 = customizers;</span><br><span class="line">            var10 = customizers.length;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(var11 = <span class="number">0</span>; var11 &lt; var10; ++var11) &#123;</span><br><span class="line">                <span class="type">BeanDefinitionCustomizer</span> <span class="variable">customizer</span> <span class="operator">=</span> var13[var11];</span><br><span class="line">                customizer.customize(abd);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// åˆ°æ­¤è¿˜æ²¡æœ‰å®ä¾‹åŒ–,ä»…ä»…æ˜¯æ„å»ºäº†ä¸€ä¸ªBeanDefinitionHolder</span></span><br><span class="line">        <span class="type">BeanDefinitionHolder</span> <span class="variable">definitionHolder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BeanDefinitionHolder</span>(abd, beanName);</span><br><span class="line">        <span class="comment">// åº”ç”¨scopeProxyMode  ä»£ç†æ¨¡å¼</span></span><br><span class="line">        definitionHolder = AnnotationConfigUtils.applyScopedProxyMode(scopeMetadata, definitionHolder, <span class="built_in">this</span>.registry);</span><br><span class="line">        <span class="comment">// æŠŠBeanDefinitionHolderæ³¨å†Œåˆ°registryå®¹å™¨ä¸­</span></span><br><span class="line">        BeanDefinitionReaderUtils.registerBeanDefinition(definitionHolder, <span class="built_in">this</span>.registry); </span><br><span class="line">        <span class="comment">// registerBeanDefinitionæ³¨å†Œbean</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><mark class="hl-label pink">æ¢³ç†ä¸€ä¸‹:</mark> <p>ä¸‰æ­¥: </p><ol><li>this()æ³¨å†Œäº†é»˜è®¤çš„Bean</li><li>register()æ³¨å†Œé…ç½®ç±»çš„Bean   (registerBeanDefinition()æ–¹æ³•)</li><li>é‚£ä¹ˆè¿˜å‰©ä¸€ä¸ªrefreshåˆ™æ˜¯ç”¨äº æ³¨å†Œè‡ªå®šä¹‰çš„Bean</li></ol><h3 id="refresh-æ‰€æœ‰çš„-bean-çš„åˆ›å»ºä»¥åŠåˆå§‹åŒ–"><a href="#refresh-æ‰€æœ‰çš„-bean-çš„åˆ›å»ºä»¥åŠåˆå§‹åŒ–" class="headerlink" title="refresh()æ‰€æœ‰çš„ bean çš„åˆ›å»ºä»¥åŠåˆå§‹åŒ–"></a>refresh()æ‰€æœ‰çš„ bean çš„åˆ›å»ºä»¥åŠåˆå§‹åŒ–</h3><p>Springçš„<code>refresh()</code>æ–¹æ³•ä¼šè§¦å‘æ‰€æœ‰beançš„<u>åˆ›å»º</u>å’Œ<u>åˆå§‹åŒ–</u>è¿‡ç¨‹ã€‚å½“è°ƒç”¨<code>refresh()</code>æ–¹æ³•æ—¶ï¼ŒSpringå®¹å™¨ä¼šæ‰§è¡Œä¸€ç³»åˆ—çš„æ­¥éª¤ï¼ŒåŒ…æ‹¬åˆ›å»ºBeanFactoryã€åŠ è½½Beanå®šä¹‰ã€å®ä¾‹åŒ–Beanã€ä¾èµ–æ³¨å…¥ã€åˆå§‹åŒ–Beanç­‰ã€‚</p><p>åœ¨<code>refresh()</code>æ–¹æ³•ä¸­ï¼ŒSpringä¼šéå†æ‰€æœ‰æ³¨å†Œçš„Beanå®šä¹‰ï¼Œæ ¹æ®å®šä¹‰åˆ›å»ºç›¸åº”çš„Beanå®ä¾‹ï¼Œå¹¶å¯¹è¿™äº›å®ä¾‹è¿›è¡Œåˆå§‹åŒ–ã€‚è¿™ä¸ªè¿‡ç¨‹åŒ…æ‹¬è°ƒç”¨Beançš„æ„é€ å‡½æ•°åˆ›å»ºå®ä¾‹ï¼Œè®¾ç½®Beançš„å±æ€§å€¼ï¼Œæ‰§è¡ŒBeançš„åˆå§‹åŒ–æ–¹æ³•ç­‰ã€‚è¿™æ ·ï¼Œæ‰€æœ‰çš„Beanéƒ½ä¼šç»è¿‡è¿™ä¸ªè¿‡ç¨‹ï¼Œå®Œæˆå®ƒä»¬çš„åˆ›å»ºå’Œåˆå§‹åŒ–ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>refresh()</code>æ–¹æ³•å¹¶<u>ä¸ä¼šé”€æ¯å·²ç»å­˜åœ¨</u>çš„Beanå®ä¾‹ã€‚å®ƒä¸»è¦ç”¨äºé‡å¯Springå®¹å™¨ï¼Œé‡æ–°åŠ è½½å’Œåˆå§‹åŒ–Beanã€‚å¦‚æœéœ€è¦é”€æ¯å·²ç»å­˜åœ¨çš„Beanå®ä¾‹ï¼Œå¯ä»¥ä½¿ç”¨<code>destroy()</code>æ–¹æ³•æˆ–è€…é€šè¿‡é…ç½®åˆé€‚çš„ä½œç”¨åŸŸï¼ˆå¦‚prototypeï¼‰æ¥æ§åˆ¶Beançš„ç”Ÿå‘½å‘¨æœŸã€‚</p><p>éå¸¸é‡è¦çš„æ–¹æ³• <span class="p red">invokeBeanFactoryPostProcessors</span> beanå·¥å‚çš„åç½®å¤„ç†å™¨</p><p>Refresh()</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">refresh</span><span class="params">()</span> <span class="keyword">throws</span> BeansException, IllegalStateException &#123;</span><br><span class="line">    <span class="keyword">synchronized</span>(<span class="built_in">this</span>.startupShutdownMonitor) &#123;<span class="comment">// è®¾ç½®åŒæ­¥æ ‡è¯†</span></span><br><span class="line">        <span class="type">StartupStep</span> <span class="variable">contextRefresh</span> <span class="operator">=</span> <span class="built_in">this</span>.applicationStartup.start(<span class="string">&quot;spring.context.refresh&quot;</span>);</span><br><span class="line"><span class="comment">// Prepare this context for refreshing.</span></span><br><span class="line"><span class="comment">// 1. è°ƒç”¨å®¹å™¨å‡†å¤‡åˆ·æ–°çš„æ–¹æ³•, è·å–å®¹å™¨çš„æ—¶é—´,åŒ…æ‹¬è®¾ç½®ä¸Šä¸‹æ–‡çŠ¶æ€,è·å–å±æ€§,éªŒè¯å¿…è¦çš„å±æ€§ç­‰</span></span><br><span class="line"><span class="comment">// â–¶å¯ä»¥å®ç°initPropertySources()æ–¹æ³•, æ·»åŠ å±æ€§æˆ–è®¾ç½®éœ€è¦éªŒè¯çš„å±æ€§</span></span><br><span class="line">        <span class="built_in">this</span>.prepareRefresh();</span><br><span class="line"><span class="comment">// Tell the subclass to refresh the internal bean factory</span></span><br><span class="line"><span class="comment">// 2. â˜…â˜…â˜…â˜…â˜…è·å–æ–°çš„beanFactory,åˆ·æ–°BeanFactoryå’Œè·å–getBeanFactory  --&gt; è·å–IOCå®¹å™¨</span></span><br><span class="line"><span class="comment">// å¦‚æœåœ¨è¿™é‡Œæ–­ç‚¹,åªä¼šå‘ç°å®ƒä»…ä»…å®Œæˆäº†beanFactoryè®¾ç½®åºåˆ—åŒ–id</span></span><br><span class="line">        <span class="type">ConfigurableListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> <span class="built_in">this</span>.obtainFreshBeanFactory();</span><br><span class="line"><span class="comment">// Prepare the bean factory for use in this context, ä¸ºBeanFactoryé…ç½®å®¹å™¨äºç§¤,å¦‚ç±»åŠ è½½å™¨,äº‹ä»¶å¤„ç†å™¨</span></span><br><span class="line"><span class="comment">// 3. å¡«å……BeanFactoryåŠŸèƒ½, é…ç½®å®¹å™¨ç‰¹æ€§</span></span><br><span class="line"><span class="comment">// ä¾‹å¦‚è®¾ç½®ClassLoader,è®¾ç½®SpELè¡¨è¾¾å¼è§£æå™¨,æ·»åŠ å¿½ç•¥æ³¨å…¥çš„æ¥å£,æ·»åŠ ä¸‰ä¸ªå’Œç¯å¢ƒç›¸å…³çš„bean  (SpEL: ä¾‹å¦‚@Value(&quot;#&#123;name&#125;&quot;)) </span></span><br><span class="line"><span class="comment">// æ·»åŠ ä¸¤ä¸ªbeanåç½®å¤„ç†å™¨BeanPostProcessor(ApplicationContextAwareProcessorå’ŒApplicationListenerDetector)ç­‰</span></span><br><span class="line">        <span class="built_in">this</span>.prepareBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">// Allows post-processing of the bean factory in context subclasses</span></span><br><span class="line"><span class="comment">// 4. åœ¨è¿™é‡Œæ˜¯ç©ºæ–¹æ³•(æ¨¡ç‰ˆè¯­æ³•),å­ç±»å¯ä»¥é‡å†™è¿™ä¸ªæ–¹æ³•,å¯ä»¥åœ¨BeanFactoryåˆ›å»ºå¹¶ä¸å‡†å¤‡å®Œæˆååšè¿›ä¸€æ­¥çš„è®¾ç½®</span></span><br><span class="line"><span class="comment">// å³å­ç±»å¤„ç†è‡ªå®šä¹‰çš„BeanFactoryPostProcess</span></span><br><span class="line">            <span class="built_in">this</span>.postProcessBeanFactory(beanFactory);<span class="comment">// ä¸ºå®¹å™¨çš„å­ç±»æŒ‡å®šç‰¹æ®Šçš„postäº‹ä»¶å¤„ç†å™¨</span></span><br><span class="line">            <span class="type">StartupStep</span> <span class="variable">beanPostProcess</span> <span class="operator">=</span> <span class="built_in">this</span>.applicationStartup.start(<span class="string">&quot;spring.context.beans.post-process&quot;</span>);</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">            ä»¥ä¸‹ä¸¤ç‚¹æ˜¯å…³äºåç½®å¤„ç†å™¨çš„æ¿€æ´»</span></span><br><span class="line"><span class="comment">            Springä¸­ä¼šå‘ç°æœ‰å¾ˆå¤šåç½®å¤„ç†å™¨,ä½†æœ€ç»ˆå¯ä»¥åˆ†ä¸ºä¸¤ç§</span></span><br><span class="line"><span class="comment">            (1)BeanFactoryPostProcessor,ç”¨äºå¹²é¢„BeanFactoryçš„åˆ›å»ºè¿‡ç¨‹</span></span><br><span class="line"><span class="comment">            (2)BeanPostProcessor,ç”¨äºå¹²é¢„Beançš„åˆ›å»ºè¿‡ç¨‹</span></span><br><span class="line"><span class="comment">            åç½®å¤„ç†å™¨çš„ä½œç”¨éå¸¸é‡è¦,Beançš„åˆ›å»ºä»¥åŠAOPçš„å®ç°å…¨éƒ¨ä¾èµ–åç½®å¤„ç†å™¨</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">            <span class="comment">// Invoke factory processor registered as beans in the context</span></span><br><span class="line"><span class="comment">// 5. â˜…â˜…â˜…â˜…â˜… æ¿€æ´»å„ç§BeanFactoryå¤„ç†å™¨,è°ƒç”¨æ‰€æœ‰æ³¨å†Œçš„BeanFactoryPostProcessorçš„Bean</span></span><br><span class="line">            <span class="comment">// BeanFactoryPostProcessorå¯ä»¥åœ¨å·¥å‚åˆå§‹åŒ–å,è®©ç”¨æˆ·åšä¸€äº›å®šåˆ¶å‹çš„å·¥ä½œ.(å®ç°æ­¤BeanFactoryPostProcessoræ¥å£)</span></span><br><span class="line">            <span class="comment">// æ‰§è¡Œæ‰€æœ‰çš„BeanFactoryPostProcessor,åŒ…æ‹¬è‡ªå®šä¹‰çš„,ä»¥åŠSpringå†…ç½®çš„</span></span><br><span class="line"><span class="comment">// é»˜è®¤æƒ…å†µä¸‹,å®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªBeanFactoryPostProcessor,å³Springå†…ç½®çš„ConfigurationClassPostProcessor(â˜…è¿™ä¸ªç±»å¾ˆé‡è¦)</span></span><br><span class="line"><span class="comment">// ä¼šå…ˆæ‰§è¡Œå®ç°äº†BeanDefinitionRegistryPostProcessoræ¥å£çš„ç±»,ç„¶åæ‰§è¡ŒBeanFactoryPostProcessorçš„ç±»</span></span><br><span class="line"><span class="comment">// â˜…â˜…â˜…â˜… ConfigurationClassPostProcessorç±»çš„postProcessorBeanFactory()æ–¹æ³•è¿›è¡Œäº†@Configurationç±»çš„è§£æ,@ComponentScançš„æ‰«æ,@Importæ³¨è§£çš„å¤„ç†</span></span><br><span class="line"><span class="comment">// è¿›è¿‡äº†è¿™ä¸€æ­¥ä»¥å,ä¼šå°†æ‰€æœ‰äº¤ç”±Springç®¡ç†çš„beanå¯¹åº”çš„BeanDefinitionæ”¾å…¥beanFactoryçš„beanDefinitionMapä¸­</span></span><br><span class="line"><span class="comment">// åŒæ—¶ConfigurationClassPostProcessorç±»çš„postProcessorBeanFactory()æ–¹æ³•æ‰§è¡Œå®Œå:</span></span><br><span class="line"><span class="comment">//å‘å®¹å™¨ä¸­æ·»åŠ äº†ä¸€ä¸ªåç½®å¤„ç†å™¨-- ImportAwareBeanPostProcessor</span></span><br><span class="line">            <span class="built_in">this</span>.invokeBeanFactoryPostProcessors(beanFactory);<span class="comment">//â˜…â˜…â˜…â˜…â˜…â˜… åŠå…¶é‡è¦,åœ¨è¿™é‡Œå®Œæˆäº† @ComponentScançš„æ‰«æ,@Importæ³¨è§£çš„å¤„ç†</span></span><br><span class="line">            <span class="comment">// Register bean processor that intercept creation.</span></span><br><span class="line"><span class="comment">// 6. â˜…â˜…â˜…æ³¨å†ŒBeanPostProcessoråç½®å¤„ç†å™¨</span></span><br><span class="line">            <span class="comment">// AutowiredAnnotationBeanPostProcessor(å¤„ç†è¢«@Autowiredæ³¨è§£ä¿®é¥°çš„bean,å¹¶æ³¨å…¥)</span></span><br><span class="line">            <span class="comment">// RequiredAnnotationBeanPostProcessor(å¤„ç†è¢«@Requiredæ³¨è§£ä¿®é¥°çš„æ–¹æ³•)</span></span><br><span class="line">            <span class="comment">// CommonAnnotationBeanPostProcessor(å¤„ç†@PreDestroy @PostConstruct @Resourceç­‰å¤šä¸ªæ³¨è§£çš„ä½œç”¨)ç­‰</span></span><br><span class="line">            <span class="comment">// AutoProxyCreator(å¤„ç†AOPä»£ç† @Aspect)</span></span><br><span class="line">            <span class="built_in">this</span>.registerBeanPostProcessors(beanFactory);</span><br><span class="line">            beanPostProcess.end();</span><br><span class="line"><span class="comment">// 7. åˆå§‹åŒ–ä¿¡æ¯æº(åšå›½é™…åŒ–åŠŸèƒ½: æ¶ˆæ¯ç»‘å®š,æ¶ˆæ¯è§£æ)</span></span><br><span class="line">            <span class="built_in">this</span>.initMessageSource();</span><br><span class="line"><span class="comment">// 8. åˆå§‹åŒ–äº‹ä»¶æ´¾å‘å™¨,åœ¨æ³¨å†Œç›‘å¬å™¨æ—¶ä¼šç”¨åˆ°</span></span><br><span class="line">            <span class="built_in">this</span>.initApplicationEventMulticaster();</span><br><span class="line"><span class="comment">// 9. è¿™ä¹Ÿæ˜¯ä¸€ä¸ªæŒ‚è½½ç‚¹,ä¸€ä¸ªç©ºæ–¹æ³•,ç”±å­ç±»å®ç°(ä¸åŒçš„Springå®¹å™¨åšä¸åŒçš„å®ç°),åœ¨å®¹å™¨ç›‘å¬çš„æ—¶å€™å¯ä»¥è‡ªå®šä¹‰é€»è¾‘</span></span><br><span class="line">            <span class="built_in">this</span>.onRefresh();</span><br><span class="line"><span class="comment">// 10. æ³¨å†Œç›‘å¬å™¨,æ´¾å‘ä¹‹å‰æ­¥éª¤äº§ç”Ÿçš„ä¸€äº›äº‹ä»¶(å°½å¯èƒ½æ²¡æœ‰)</span></span><br><span class="line">            <span class="built_in">this</span>.registerListeners();</span><br><span class="line"><span class="comment">// 11. ***** åˆå§‹åŒ–å‰©ä¸‹çš„å•ä¾‹Bean(éå»¶æ—¶åŠ è½½çš„) çœŸæ­£çš„åˆå§‹åŒ–beançš„æ–¹æ³•</span></span><br><span class="line">            <span class="built_in">this</span>.finishBeanFactoryInitialization(beanFactory);</span><br><span class="line"><span class="comment">// 12. åˆå§‹åŒ–å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶å¤„ç†å™¨,å¹¶å‘å¸ƒå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ </span></span><br><span class="line">            <span class="built_in">this</span>.finishRefresh();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (BeansException var10) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.logger.isWarnEnabled()) &#123;</span><br><span class="line">                <span class="built_in">this</span>.logger.warn(<span class="string">&quot;Exception encountered during context initialization - cancelling refresh attempt: &quot;</span> + var10);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">this</span>.destroyBeans();</span><br><span class="line">            <span class="built_in">this</span>.cancelRefresh(var10);</span><br><span class="line">            <span class="keyword">throw</span> var10;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.resetCommonCaches();</span><br><span class="line">            contextRefresh.end();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ComponentScanå±æ€§çš„è¯»å–"><a href="#ComponentScanå±æ€§çš„è¯»å–" class="headerlink" title="@ComponentScanå±æ€§çš„è¯»å–"></a>@ComponentScanå±æ€§çš„è¯»å–</h3><h4 id="é€æ­¥è¯»å–"><a href="#é€æ­¥è¯»å–" class="headerlink" title="é€æ­¥è¯»å–"></a>é€æ­¥è¯»å–</h4><span class="p red">ç›®æ ‡: è¯»å–basePackagesè®¾ç½®çš„ç±»</span><p>å¯»æ‰¾çš„ç›®å½•æŒ‡å¼•å¦‚ä¸‹:(ä»¥ä¸‹æ¯ä¸€æ­¥æ“ä½œå‡ä¸ºè¿½è¸ªæè¿°æ–¹æ³•åçš„æŒ‡å¼•ä»‹ç»)</p><ol><li>å…¥å£ AnnotationConfigApplicationContext </li><li>å½“å‰ç±»ä¸‹çš„æ„é€ å™¨å®ç°é‡è½½è§£æç±»çš„æ–¹æ³• æ‰¾åˆ°<code>refresh()</code>,</li><li><code>â˜…invokeBeanFactoryPostProcessors</code>æ–¹æ³•(é‡è¦),</li><li>ç„¶åå¯ä»¥æ‰¾åˆ°ä¸€ä¸ªåç½®å¤„ç†å™¨çš„å§”æ‰˜ä»£ç†ç±» (PostProcessorRegistrationDelegate) ,å…¶ä¸­æœ‰æ–¹æ³•ä¸º<em>invokeBeanFactoryPostProcessors</em></li><li>åœ¨å½“å‰æ–¹æ³•ä¸­æ‰¾åˆ° if-elseä¸­çš„<em>invokeBeanFactoryPostProcessors</em>æ–¹æ³•(ä¸­é—´å¤„ç†beanå·¥å‚ç±»ä¸ŠåŠ äº†æ³¨è§£çš„,æ¯”å¦‚@Primary,@Orderæ’åº),  ä¸è®ºèµ°ifè¿˜æ˜¯else éƒ½ä¼šæ¿€æ´»beanå·¥å‚çš„åç½®å¤„ç†å™¨</li></ol><p>invokeBeanFactoryPostProcessors <img no-lazy class="inline" src="https://bu.dusays.com/2022/05/19/6285328a83ca7.gif" style="height:40px;"></p><ol start="6"><li>æ‰¾åˆ°<code>postProcessor.postProcessBeanFactory(beanFactory)</code>è¿™ä¸€è¡Œ, å½“å‰è¡Œä¸ºåç½®å¤„ç†å™¨å¤„ç†beanå·¥å‚,  ç‚¹è¿›postProcessBeanFactoryæ–¹æ³•å‘ç°ä»€ä¹ˆéƒ½æ²¡æœ‰, ä»–æ˜¯ä¸€ä¸ª@FunctionalInterfaceæ¥å£(å‡½æ•°æ¥å£),  æ‰¾å®ç°ç±»(å¦‚ä¸‹å›¾),</li></ol><img src="/2023/10/28/SpringAnalysis/ComponentScan_ans.png" class title="spring @ComponentScanå±æ€§è¯»å–åˆ†æ--åç½®å¤„ç†å™¨å®ç°ç±»"><ol start="7"><li>æ‰¾åˆ° postProcessBeanFactory æ–¹æ³•(beanå·¥å‚çš„åç½®å¤„ç†å™¨)</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">factoryId</span> <span class="operator">=</span> System.identityHashCode(beanFactory);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.factoriesPostProcessed.contains(factoryId)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;postProcessBeanFactory already called on this post-processor against &quot;</span> + beanFactory);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.factoriesPostProcessed.add(factoryId);</span><br><span class="line">        <span class="comment">// BeanDefinitionRegistryPostProcessor hook apparently not supported...</span></span><br><span class="line">        <span class="comment">// Simply call processConfigurationClasses lazily at this point then</span></span><br><span class="line">        <span class="comment">// åˆ¤æ–­å·²æ³¨å†Œçš„PostProcessoræ˜¯å¦åŒ…å«äº†factoryId</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.registriesPostProcessed.contains(factoryId)) &#123;</span><br><span class="line">            <span class="comment">// â˜…æ­£å¼å¤„ç†é…ç½®Beanå®šä¹‰  @Configuration  -&gt; é‡Œé¢å¸¦äº†ä¸€ä¸ª@ComponentScan</span></span><br><span class="line">            <span class="built_in">this</span>.processConfigBeanDefinitions((BeanDefinitionRegistry)beanFactory);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">// ä»£ç†</span></span><br><span class="line">        <span class="built_in">this</span>.enhanceConfigurationClasses(beanFactory);</span><br><span class="line">        <span class="comment">// Importæ„ŸçŸ¥  @Import(&#123;A.class&#125;)</span></span><br><span class="line">        beanFactory.addBeanPostProcessor(<span class="keyword">new</span> <span class="title class_">ImportAwareBeanPostProcessor</span>(beanFactory));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="8"><li>è¿½è¸ªprocessConfigBeanDefinitions</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processConfigBeanDefinitions</span><span class="params">(BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line">    List&lt;BeanDefinitionHolder&gt; configCandidates = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">    String[] candidateNames = registry.getBeanDefinitionNames();</span><br><span class="line">    String[] var4 = candidateNames;</span><br><span class="line">    <span class="type">int</span> <span class="variable">var5</span> <span class="operator">=</span> candidateNames.length;</span><br><span class="line"><span class="comment">// è¿­ä»£æ‰€æœ‰å€™é€‰çš„beanåå­—</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">var6</span> <span class="operator">=</span> <span class="number">0</span>; var6 &lt; var5; ++var6) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">beanName</span> <span class="operator">=</span> var4[var6];</span><br><span class="line">        <span class="type">BeanDefinition</span> <span class="variable">beanDef</span> <span class="operator">=</span> registry.getBeanDefinition(beanName);</span><br><span class="line">        <span class="comment">// åˆ¤æ–­ä¸Šé¢æ˜¯å¦åŒ…å«ConfigurationClasså±æ€§</span></span><br><span class="line">        <span class="keyword">if</span> (beanDef.getAttribute(ConfigurationClassUtils.CONFIGURATION_CLASS_ATTRIBUTE) != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// ç•¥  (å¦‚æœæœ‰åˆ™åŠ å…¥å€™é€‰)</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!configCandidates.isEmpty()) &#123;</span><br><span class="line">        <span class="comment">// é…ç½®ç±»å€™é€‰æ’åº(@Order,@Priorityæ’åºæ ‡å¿—)</span></span><br><span class="line">        configCandidates.sort((bd1, bd2) -&gt; &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i1</span> <span class="operator">=</span> ConfigurationClassUtils.getOrder(bd1.getBeanDefinition());</span><br><span class="line">            <span class="type">int</span> <span class="variable">i2</span> <span class="operator">=</span> ConfigurationClassUtils.getOrder(bd2.getBeanDefinition());</span><br><span class="line">            <span class="keyword">return</span> Integer.compare(i1, i2);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="type">SingletonBeanRegistry</span> <span class="variable">sbr</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">// æ£€æŸ¥æ˜¯å¦ä¸ºå•ä¾‹bean</span></span><br><span class="line">        <span class="keyword">if</span> (registry <span class="keyword">instanceof</span> SingletonBeanRegistry) &#123;</span><br><span class="line">            sbr = (SingletonBeanRegistry)registry;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="built_in">this</span>.localBeanNameGeneratorSet) &#123;</span><br><span class="line">                <span class="type">BeanNameGenerator</span> <span class="variable">generator</span> <span class="operator">=</span> (BeanNameGenerator)sbr.getSingleton(<span class="string">&quot;org.springframework.context.annotation.internalConfigurationBeanNameGenerator&quot;</span>);</span><br><span class="line">                <span class="keyword">if</span> (generator != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="built_in">this</span>.componentScanBeanNameGenerator = generator;</span><br><span class="line">                    <span class="built_in">this</span>.importBeanNameGenerator = generator;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">// ç¯å¢ƒ,å¦‚æœæ²¡æœ‰åˆ™æ ‡å‡†ç¯å¢ƒ</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.environment == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.environment = <span class="keyword">new</span> <span class="title class_">StandardEnvironment</span>();</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">// Parse each @Configuration class</span></span><br><span class="line"><span class="comment">// â˜…â˜…â˜…â˜…è§£ææ¯ä¸€ä¸ª@Configurationç±»,åŒ…æ‹¬@ComponentScan</span></span><br><span class="line">        <span class="type">ConfigurationClassParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConfigurationClassParser</span>(<span class="built_in">this</span>.metadataReaderFactory, <span class="built_in">this</span>.problemReporter, <span class="built_in">this</span>.environment, <span class="built_in">this</span>.resourceLoader, <span class="built_in">this</span>.componentScanBeanNameGenerator, registry);</span><br><span class="line">        <span class="comment">// ä¸Šè¿°é…ç½®ç±»è§£æå™¨åŒ…æ‹¬ï¼šæ³¨è§£å…ƒä¿¡æ¯çš„è¯»å–å·¥å‚ã€é—®é¢˜æŠ¥å‘Šå™¨ã€æ ‡å‡†ç³»ç»Ÿç¯å¢ƒå˜é‡ã€èµ„æºåŠ è½½å™¨ã€ç»„ä»¶æ‰«æbeanåå­—æ„å»ºå™¨</span></span><br><span class="line">        Set&lt;BeanDefinitionHolder&gt; candidates = <span class="keyword">new</span> <span class="title class_">LinkedHashSet</span>(configCandidates);</span><br><span class="line">        Set&lt;ConfigurationClass&gt; alreadyParsed = <span class="keyword">new</span> <span class="title class_">HashSet</span>(configCandidates.size());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">do</span> &#123;<span class="comment">// ä¸€ä¸ªä¸€ä¸ªçš„è¯»å–å€™é€‰çš„é…ç½®(å¯ä»¥æœ‰å¤šä¸ªé…ç½®ç±»,ä¸€æ¬¡è¯»å–ä¸€ä¸ª)</span></span><br><span class="line">            <span class="type">StartupStep</span> <span class="variable">processConfig</span> <span class="operator">=</span> <span class="built_in">this</span>.applicationStartup.start(<span class="string">&quot;spring.context.config-classes.parse&quot;</span>);</span><br><span class="line"><span class="comment">// â˜…â˜…â˜…â˜…â˜…â˜…  çœŸæ­£çš„è§£æå™¨åœ¨æ­¤</span></span><br><span class="line">            parser.parse(candidates); <span class="comment">// candidate å€™é€‰é›†åˆ(å¤šä¸ªé…ç½®ç±»)</span></span><br><span class="line">            </span><br><span class="line">            parser.validate();</span><br><span class="line">            Set&lt;ConfigurationClass&gt; configClasses = <span class="keyword">new</span> <span class="title class_">LinkedHashSet</span>(parser.getConfigurationClasses());</span><br><span class="line">            <span class="comment">// ä¸‹é¢ä»£ç ç•¥</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="9"><li>è¿½è¸ªparse (8ä¸­æºç æ³¨é‡Šæ ‡â˜…â˜…â˜…â˜…â˜…â˜…)</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">parse</span><span class="params">(Set&lt;BeanDefinitionHolder&gt; configCandidates)</span> &#123;</span><br><span class="line">    <span class="type">Iterator</span> <span class="variable">var2</span> <span class="operator">=</span> configCandidates.iterator();</span><br><span class="line">    <span class="comment">// å¾ªç¯è¿­ä»£æ¯ä¸€ä¸ªConfigurationç±»,parse()è§£æ</span></span><br><span class="line">    <span class="keyword">while</span>(var2.hasNext()) &#123;</span><br><span class="line">        <span class="type">BeanDefinitionHolder</span> <span class="variable">holder</span> <span class="operator">=</span> (BeanDefinitionHolder)var2.next();</span><br><span class="line">        <span class="type">BeanDefinition</span> <span class="variable">bd</span> <span class="operator">=</span> holder.getBeanDefinition();</span><br><span class="line">        <span class="comment">// å¼€å§‹åˆ¤æ–­æ³¨è§£å±äºä»€ä¹ˆç±»</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (bd <span class="keyword">instanceof</span> AnnotatedBeanDefinition) &#123;</span><br><span class="line">                <span class="built_in">this</span>.parse(((AnnotatedBeanDefinition)bd).getMetadata(), holder.getBeanName());</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (bd <span class="keyword">instanceof</span> AbstractBeanDefinition &amp;&amp; ((AbstractBeanDefinition)bd).hasBeanClass()) &#123;</span><br><span class="line">                <span class="built_in">this</span>.parse(((AbstractBeanDefinition)bd).getBeanClass(), holder.getBeanName());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.parse(bd.getBeanClassName(), holder.getBeanName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="comment">// catchå¼‚å¸¸å¤„ç†å¤„(ç•¥)</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>.deferredImportSelectorHandler.process();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ­¤å¤„æ€»ç»“å‘ç°,  æºç ä¸­å‡¡æ˜¯åµŒå¥—if-elesçš„,  æœ€åéƒ½ä¼šè°ƒç”¨ åŒä¸€ä¸ªæ–¹æ³•,  <wavy>æ–¹æ³•çš„é‡è½½</wavy></p><ol start="10"><li>ç»§ç»­è¿½è¸ªé‡è½½çš„parse</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">parse</span><span class="params">(<span class="meta">@Nullable</span> String className, String beanName)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    Assert.notNull(className, <span class="string">&quot;No bean class name for configuration class bean definition&quot;</span>);</span><br><span class="line">    <span class="comment">// å…ƒæ•°æ®è¯»å–</span></span><br><span class="line">    <span class="type">MetadataReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="built_in">this</span>.metadataReaderFactory.getMetadataReader(className);</span><br><span class="line"><span class="comment">// â˜… å¤„ç†é…ç½®ç±»</span></span><br><span class="line">    <span class="built_in">this</span>.processConfigurationClass(<span class="keyword">new</span> <span class="title class_">ConfigurationClass</span>(reader, beanName), DEFAULT_EXCLUSION_FILTER);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="11"><li>è¿½è¸ªprocessConfigurationClass,â˜…â˜…â˜…â˜…â˜…ç„¶åè¿½è¸ªdo-whileé‡Œé¢çš„é€’å½’å¤„ç†é…ç½®ç±»</li></ol><p>åœ¨æ­¤å¤„å…ˆæ˜¯å¤„ç†æ¡ä»¶æ³¨è§£@Conditional, ç„¶ååˆ¤æ–­é…ç½®ç±», æ²¡å¯¼å…¥åˆ™åˆå¹¶ marginImport</p><p>do-whileä¸­é€’å½’è¯»å–é…ç½®ç±»æ–¹æ³•<code>doProcessConfigurationClass</code>.</p><p><strong>åœ¨@Configurationæ³¨è§£ä¸­å®ƒåŒ…æ‹¬äº†@Componentæ³¨è§£</strong>.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> SourceClass <span class="title function_">doProcessConfigurationClass</span><span class="params">(ConfigurationClass configClass, SourceClass sourceClass, Predicate&lt;String&gt; filter)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"><span class="comment">// ç¬¬ä¸€æ­¥åˆ¤æ–­é…ç½®ç±»ä¸Šæ˜¯å¦æœ‰@Componentæ³¨è§£</span></span><br><span class="line">    <span class="keyword">if</span> (configClass.getMetadata().isAnnotated(Component.class.getName())) &#123;</span><br><span class="line">        <span class="built_in">this</span>.processMemberClasses(configClass, sourceClass, filter);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// å±æ€§èµ„æºè¯»å– (eg: @PropertySource(&quot;classpath:db.properties&quot;))</span></span><br><span class="line">    <span class="type">Iterator</span> <span class="variable">var4</span> <span class="operator">=</span> AnnotationConfigUtils.attributesForRepeatable(sourceClass.getMetadata(), PropertySources.class, PropertySource.class).iterator();</span><br><span class="line"></span><br><span class="line">    AnnotationAttributes importResource;</span><br><span class="line">    <span class="keyword">while</span>(var4.hasNext()) &#123;</span><br><span class="line">        importResource = (AnnotationAttributes)var4.next();</span><br><span class="line">        <span class="comment">// æœ‰åˆ™å¤„ç†</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.environment <span class="keyword">instanceof</span> ConfigurableEnvironment) &#123;</span><br><span class="line">            <span class="built_in">this</span>.processPropertySource(importResource);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.logger.info(<span class="string">&quot;Ignoring @PropertySource annotation on [&quot;</span> + sourceClass.getMetadata().getClassName() + <span class="string">&quot;]. Reason: Environment must implement ConfigurableEnvironment&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// â˜…â˜…â˜…â˜…â˜…ç›®æ ‡åˆ°è¾¾â˜…â˜…â˜…â˜…â˜…</span></span><br><span class="line">    Set&lt;AnnotationAttributes&gt; componentScans = AnnotationConfigUtils.attributesForRepeatable(sourceClass.getMetadata(), ComponentScans.class, ComponentScan.class);</span><br><span class="line">    <span class="comment">// å¦‚æœåŒ…æ‰«ææ³¨è§£ä¸æ˜¯ç©º å¹¶ä¸” ä¸è·³è¿‡</span></span><br><span class="line">    <span class="keyword">if</span> (!componentScans.isEmpty() &amp;&amp; !<span class="built_in">this</span>.conditionEvaluator.shouldSkip(sourceClass.getMetadata(), ConfigurationPhase.REGISTER_BEAN)) &#123;</span><br><span class="line">        <span class="comment">// è¿­ä»£å™¨éå†åŒ…æ‰«æçš„æ³¨è§£</span></span><br><span class="line">        <span class="type">Iterator</span> <span class="variable">var14</span> <span class="operator">=</span> componentScans.iterator();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(var14.hasNext()) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="type">AnnotationAttributes</span> <span class="variable">componentScan</span> <span class="operator">=</span> (AnnotationAttributes)var14.next();</span><br><span class="line">            <span class="comment">// The config class is annotated with @ComponentScan -&gt; perform the scan immediatel</span></span><br><span class="line"><span class="comment">// â˜…â˜…â˜…â˜…â˜… è¿™ä¸ªparseçœŸæ­£å¤„ç†@ComponentScanä¸­çš„basePackages</span></span><br><span class="line">            Set&lt;BeanDefinitionHolder&gt; scannedBeanDefinitions = <span class="built_in">this</span>.componentScanParser.parse(componentScan, sourceClass.getMetadata().getClassName());</span><br><span class="line">            <span class="type">Iterator</span> <span class="variable">var8</span> <span class="operator">=</span> scannedBeanDefinitions.iterator();</span><br><span class="line"><span class="comment">// Check the set of scanned definitions for any further config classes and parse recursively if needed </span></span><br><span class="line">            <span class="keyword">while</span>(var8.hasNext()) &#123;</span><br><span class="line">                <span class="type">BeanDefinitionHolder</span> <span class="variable">holder</span> <span class="operator">=</span> (BeanDefinitionHolder)var8.next();</span><br><span class="line">                <span class="type">BeanDefinition</span> <span class="variable">bdCand</span> <span class="operator">=</span> holder.getBeanDefinition().getOriginatingBeanDefinition();</span><br><span class="line">                <span class="keyword">if</span> (bdCand == <span class="literal">null</span>) &#123;</span><br><span class="line">                    bdCand = holder.getBeanDefinition();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (ConfigurationClassUtils.checkConfigurationClassCandidate(bdCand, <span class="built_in">this</span>.metadataReaderFactory)) &#123;</span><br><span class="line">                    <span class="built_in">this</span>.parse(bdCand.getBeanClassName(), holder.getBeanName());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// @Import </span></span><br><span class="line">    <span class="built_in">this</span>.processImports(configClass, sourceClass, <span class="built_in">this</span>.getImports(sourceClass), filter, <span class="literal">true</span>);</span><br><span class="line">    importResource = AnnotationConfigUtils.attributesFor(sourceClass.getMetadata(), ImportResource.class);</span><br><span class="line">    <span class="comment">// ç•¥</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºä¸Šè¿°æºç çš„parse:</p><ol><li><p>é¦–å…ˆå»ºç«‹äº†ä¸€ä¸ªClassPathBeanDefinitionScanneræ‰«æå™¨,  æ‰«æ@ComponentScan,  ä»¥åŠæ˜¯å¦è¦è¿‡æ»¤(includeFilters)</p></li><li><p>åŒ…æ‰«æå™¨è·å–åå­—,  è·å–ä½œç”¨åŸŸ(è®¾ç½®),  èµ„æºæ¨¡å¼,  æ‰«æè¿‡æ»¤æ¡ä»¶(åŒ…å«è¿‡æ»¤å™¨,æ‰«æè¿‡æ»¤å™¨),  åˆ¤æ–­æ˜¯å¦ä¸ºæ‡’åŠ è½½(lazyInit)</p></li><li><p>â˜…â˜…â˜…â˜…â˜… æœŸç›¼çš„ (æ‰«æbasePackages)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æƒ…å†µä¸€ basePackages</span></span><br><span class="line">Set&lt;String&gt; basePackages = <span class="keyword">new</span> <span class="title class_">LinkedHashSet</span>();</span><br><span class="line">        String[] basePackagesArray = componentScan.getStringArray(<span class="string">&quot;basePackages&quot;</span>);</span><br><span class="line"><span class="comment">// æƒ…å†µäºŒ basePackageClasses</span></span><br><span class="line">Class[] var20 = componentScan.getClassArray(<span class="string">&quot;basePackageClasses&quot;</span>);</span><br></pre></td></tr></table></figure></li><li><p>åˆ¤æ–­æ˜¯å¦ä¸ºç©º,  å‡å¦‚ä¸ºç©º,  åˆ™è·å–<wavy>å½“å‰æ³¨è§£ç±»çš„åŒ…è·¯å¾„</wavy></p></li><li><p>æœ€åçœ‹çœ‹æ˜¯å¦æœ‰ç­›é€‰,  è¿‡æ»¤</p></li></ol><p>åˆ°æ­¤,åŒ…åå‡†å¤‡å®Œæ¯•, ç„¶å é€’å½’æ‰«æ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> scanner.doScan(StringUtils.toStringArray(basePackages));</span><br></pre></td></tr></table></figure><h4 id="doScané€’å½’æ‰«æ"><a href="#doScané€’å½’æ‰«æ" class="headerlink" title="doScané€’å½’æ‰«æ"></a>doScané€’å½’æ‰«æ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1. èµ„æºæ‰«æ</span></span><br><span class="line"><span class="comment">    æ‰«æåŒ…è·¯å¾„ä¸‹.classæ–‡ä»¶, å°†èµ„æºè½¬æ¢ä¸ºResource</span></span><br><span class="line"><span class="comment">2. èµ„æºåŠ è½½</span></span><br><span class="line"><span class="comment">    é€šè¿‡ASMæ¡†æ¶è·å–classå…ƒæ•°æ®,å°è£…BeanDefinition</span></span><br><span class="line"><span class="comment">3. èµ„æºè§£æ</span></span><br><span class="line"><span class="comment">    è·å–beanä¸Šæ³¨è§£çš„å±æ€§å€¼, å¦‚@Scope</span></span><br><span class="line"><span class="comment"> 4. ç”ŸæˆBean</span></span><br><span class="line"><span class="comment">     ç”ŸæˆbeanName, è®¾ç½®Beané»˜è®¤å€¼(æ‡’åŠ è½½,åˆå§‹åŒ–æ–¹æ³•ç­‰) ä»£ç†æ¨¡å¼</span></span><br><span class="line"><span class="comment"> 5. æ³¨å†ŒBean</span></span><br><span class="line"><span class="comment"> æŠŠBeanDefinitionæ”¾å…¥IOCå®¹å™¨DefaultListableBeanFactory</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">protected</span> Set&lt;BeanDefinitionHolder&gt; <span class="title function_">doScan</span><span class="params">(String... basePackages)</span> &#123;</span><br><span class="line">    Assert.notEmpty(basePackages, <span class="string">&quot;At least one base package must be specified&quot;</span>);</span><br><span class="line">    <span class="comment">//åˆ›å»ºä¸€ä¸ªé›†åˆ,å­˜æ”¾æ‰«æåˆ°çš„Beanå®šä¹‰å°è£…ç±»</span></span><br><span class="line">    <span class="comment">// æ— åº,ä¸å¯é‡å¤,  BeanDefinitionHolderåŒ…äº†ä¸€ä¸ªBeanDefinition: beançš„å®šä¹‰ç±»:å…³äºä¸€ä¸ªbeanæ‰€æœ‰çš„ç›¸å…³ä¿¡æ¯</span></span><br><span class="line">    <span class="comment">//                        (scope,lazy,initmethod,destroymethod...)</span></span><br><span class="line">    Set&lt;BeanDefinitionHolder&gt; beanDefinitions = <span class="keyword">new</span> <span class="title class_">LinkedHashSet</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">//éå†æ‰«ææ‰€æœ‰ç»™å®šçš„åŒ…è·¯å¾„</span></span><br><span class="line">    <span class="keyword">for</span> (String basePackage : basePackages) &#123;</span><br><span class="line">        <span class="comment">//** è°ƒç”¨çˆ¶ç±»ClassPathScanningCandidateComponentProviderçš„æ–¹æ³•</span></span><br><span class="line">        <span class="comment">// æ‰«ææŒ‡å®šç±»è·¯å¾„, è·å–ç¬¦åˆæ¡ä»¶çš„Beanå®šä¹‰, å¹¶å­˜å…¥é›†åˆbeanDefinitionsä¸­</span></span><br><span class="line">        Set&lt;BeanDefinition&gt; candidates = findCandidateComponents(basePackage);</span><br><span class="line">        <span class="comment">//éå†BeanDefinition  (æ‰«æåˆ°çš„bean)</span></span><br><span class="line">        <span class="keyword">for</span> (BeanDefinition candidate : candidates) &#123;</span><br><span class="line">            <span class="comment">//** è·å–@Scopeçš„å€¼,å³è·å–scopeçš„ä½œç”¨åŸŸ, scopeå–å€¼: singleton,prototype</span></span><br><span class="line">            <span class="type">ScopeMetadata</span> <span class="variable">scopeMetadata</span> <span class="operator">=</span> <span class="built_in">this</span>.scopeMetadataResolver.resolveScopeMetadata(candidate);</span><br><span class="line">            <span class="comment">// ä¸ºbean è®¾ç½®ä½œç”¨åŸŸ</span></span><br><span class="line">            candidate.setScope(scopeMetadata.getScopeName());</span><br><span class="line">            <span class="comment">//** ä¸ºbeanç”Ÿæˆåå­—</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">beanName</span> <span class="operator">=</span> <span class="built_in">this</span>.beanNameGenerator.generateBeanName(candidate, <span class="built_in">this</span>.registry);</span><br><span class="line">            <span class="comment">// è®¾ç½®Beançš„è‡ªåŠ¨ä¾èµ–æ³¨å…¥è£…é…å±æ€§ç­‰  ****è¿™é‡Œæ¯ä¸€ä¸ªbean å…ˆè®¾ç½®é»˜è®¤å€¼(lazy,autowiredMode,dependency,init,destroy)</span></span><br><span class="line">            <span class="keyword">if</span> (candidate <span class="keyword">instanceof</span> AbstractBeanDefinition) &#123;</span><br><span class="line">                <span class="comment">//*  -&gt; applyDefaults  ç»™é»˜è®¤å€¼è®¾ç½®ä¸€ä¸ªbeançš„å±æ€§</span></span><br><span class="line">                postProcessBeanDefinition((AbstractBeanDefinition) candidate, beanName);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å¦‚æœæ‰«æåˆ°çš„beanæ˜¯Springçš„æ³¨è§£bean,åˆ™å¤„ç†å…¶é€šç”¨çš„Springæ³¨è§£</span></span><br><span class="line">            <span class="comment">// å†è®¾ç½®è¿™ä¸ªbeanä¸Šçš„ç”¨æˆ·é…ç½®å€¼</span></span><br><span class="line">            <span class="keyword">if</span> (candidate <span class="keyword">instanceof</span> AnnotatedBeanDefinition) &#123;</span><br><span class="line">                <span class="comment">//** è§£æé€šç”¨æ³¨è§£(@Lazyã€@Primaryã€@DependsOnã€@Roleã€@Descriptionæ³¨è§£)ï¼Œä¸ºè¿™äº›æ³¨è§£è®¾ç½®å€¼</span></span><br><span class="line">                AnnotationConfigUtils.processCommonDefinitionAnnotations((AnnotatedBeanDefinition) candidate);</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">// å†²çªæ£€æŸ¥</span></span><br><span class="line">            <span class="keyword">if</span> (checkCandidate(beanName, candidate)) &#123;</span><br><span class="line">                <span class="type">BeanDefinitionHolder</span> <span class="variable">definitionHolder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BeanDefinitionHolder</span>(candidate, beanName);</span><br><span class="line">                definitionHolder =</span><br><span class="line">                    AnnotationConfigUtils.applyScopedProxyMode(scopeMetadata, definitionHolder, <span class="built_in">this</span>.registry);</span><br><span class="line">                beanDefinitions.add(definitionHolder);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//**  åœ¨å®¹å™¨ä¸­æ³¨å†Œæ‰«æåˆ°çš„bean</span></span><br><span class="line">                registerBeanDefinition(definitionHolder, <span class="built_in">this</span>.registry);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> beanDefinitions;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç®€åŒ–æ³¨å†Œæ‰«æ"><a href="#ç®€åŒ–æ³¨å†Œæ‰«æ" class="headerlink" title="ç®€åŒ–æ³¨å†Œæ‰«æ"></a>ç®€åŒ–æ³¨å†Œæ‰«æ</h4><p>ä»¥å¾€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfig.class);</span><br></pre></td></tr></table></figure><p>é€šè¿‡è¯»å–é…ç½®ç±»,  ç„¶åè¯»å–é…ç½®ç±»ä¸Šé¢çš„@ComponentScanæ³¨è§£,  ç„¶ååœ¨æ‰«æ</p><p>ç°åœ¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(basePackages = <span class="string">&quot;com.spring&quot;</span>);</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä½¿ç”¨AnnotationConfigApplicationContextçš„é‡è½½æ–¹æ³•,  ç›´æ¥æ‰«ææŒ‡å®šçš„basePackagesè·¯å¾„,  çœç•¥äº†è¯»å–é…ç½®ç±»åœ¨è¯»å–æ³¨è§£çš„æµç¨‹</p><p>ä½¿ç”¨è¿™ä¸ªæ–¹æ¡ˆ,  ä¹Ÿå°±æ˜¯ç›´æ¥èµ°åˆ°äº† <code>scanner.doScan(StringUtils.toStringArray(basePackages));</code>æ–¹æ³•è€Œä¸éœ€è¦ç»•æ¥ç»•å»çš„è§£æ</p><p>ç¼ºç‚¹:  è·¯å¾„å›ºå®š</p><h3 id="ä¸Šéƒ¨åˆ†å°æ€»ç»“"><a href="#ä¸Šéƒ¨åˆ†å°æ€»ç»“" class="headerlink" title="ä¸Šéƒ¨åˆ†å°æ€»ç»“"></a>ä¸Šéƒ¨åˆ†å°æ€»ç»“</h3><p>refresh</p><img src="/2023/10/28/SpringAnalysis/refresh.png" class title="refreshæµç¨‹"><h3 id="å®ä¾‹åŒ–-å¾ªç¯ä¾èµ–"><a href="#å®ä¾‹åŒ–-å¾ªç¯ä¾èµ–" class="headerlink" title="å®ä¾‹åŒ–(å¾ªç¯ä¾èµ–)"></a>å®ä¾‹åŒ–(å¾ªç¯ä¾èµ–)</h3><h4 id="æµç¨‹äº†è§£"><a href="#æµç¨‹äº†è§£" class="headerlink" title="æµç¨‹äº†è§£"></a>æµç¨‹äº†è§£</h4><p>æ—¢ç„¶éƒ½å¾—åˆ°äº†æ‰«æåˆ°çš„å¯¹è±¡ <code> Set&lt;BeanDefinition&gt;</code></p><p>æ¥ä¸‹æ¥éœ€è¦åšçš„å°±æ˜¯å®ä¾‹åŒ–å¯¹è±¡äº†</p><p>å…¶ä¸­å®ä¾‹åŒ–åŒ…æ‹¬</p><ol><li>@Value è®¾ç½®å±æ€§</li><li>@Autowired æ³¨å…¥ä¾èµ–</li></ol><p>ç„¶å å­˜å…¥map</p><p>é€šè¿‡getBean()è·å–IOCå®¹å™¨ä¸­çš„bean</p><p>ä»å®¹å™¨ä¸­å–çš„æµç¨‹:   </p><ul><li>æ‡’åŠ è½½æ¨¡å¼:  content.getBean() -&gt; getBean  -&gt;  doGetBean()</li><li>éæ‡’åŠ è½½æ¨¡å¼: finishBeanFactoryInitialization()   -&gt; beanFactory.preInstantiateSingletons()  ç”Ÿæˆ<u>ä¸€ä¸ªå•ä¾‹bean</u>  -&gt; getBean()  -&gt; doGetBean()</li></ul><p>æ‰€ä»¥ä¸¤ç±»éƒ½æ˜¯æ®Šé€”åŒå½’ <span class="p red">doGetBean()</span></p><h4 id="å¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–"><a href="#å¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–" class="headerlink" title="å¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–"></a>å¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–</h4><p>å¾ªç¯ä¾èµ–, ä¾èµ–æˆä¸ºä¸€ä¸ªç¯,  äº’ç›¸ä¾èµ–</p><h5 id="æ„é€ æ–¹æ³•å¾ªç¯ä¾èµ–"><a href="#æ„é€ æ–¹æ³•å¾ªç¯ä¾èµ–" class="headerlink" title="æ„é€ æ–¹æ³•å¾ªç¯ä¾èµ–"></a>æ„é€ æ–¹æ³•å¾ªç¯ä¾èµ–</h5><ol><li><p>åœ¨æ„é€ å™¨å¾ªç¯ä¾èµ–çš„æ¯ä¸€ä¸ªæ„é€ å™¨ä¸Šé¢åŠ æ³¨è§£<u>@Lazy</u></p></li><li><p>ä»£ç é‡æ„</p></li><li><p>æ”¹ä¸ºå­—æ®µä¾èµ–æ³¨å…¥</p></li></ol><p>ä½¿ç”¨æ³¨æ„ç‚¹æ˜¯:</p><p>@Lazyæ³¨è§£: </p><ul><li>åˆå§‹åŒ–æ³¨å…¥<strong>ä»£ç†å¯¹è±¡</strong>æ—¶, çœŸå®è°ƒç”¨æ—¶ä½¿ç”¨Spring AOPåŠ¨æ€ä»£ç†å»<strong>å…³è”</strong>çœŸå®å¯¹è±¡, ç„¶åé€šè¿‡åå°„å®Œæˆè°ƒç”¨</li><li>åŠ åœ¨æ„é€ å™¨ä¸Š,  ä½œç”¨åŸŸä¸ºæ„é€ å™¨æ‰€æœ‰å‚æ•°,  åŠ åœ¨æŸä¸ªå‚æ•°ä¸Š,  ä½œç”¨åŸŸä¸ºè¯¥å‚æ•°</li><li>ä½œç”¨åœ¨æ¥å£ä¸Š,  ä½¿ç”¨JDKåŠ¨æ€ä»£ç†,  è¿™æ ·åœ¨ç±»ä¸Š,  ä½¿ç”¨CGLibåŠ¨æ€ä»£ç†</li></ul><h5 id="Setterå¾ªç¯ä¾èµ–"><a href="#Setterå¾ªç¯ä¾èµ–" class="headerlink" title="Setterå¾ªç¯ä¾èµ–"></a>Setterå¾ªç¯ä¾èµ–</h5><p>å­—æ®µæ³¨å…¥å¾ªç¯ä¾èµ–,Springå®˜æ–¹é€šè¿‡ä¸‰å±‚ç¼“å­˜è§£å†³,  è§£å†³æ–¹æ¡ˆ:</p><p>setteræ³¨å…¥ä¸‹ å®ä¾‹åŒ– <strong>(æ— å‚æ„é€ æ–¹æ³•)</strong> å’Œä¾èµ–å±æ€§æ³¨å…¥**(setæˆ–å±æ€§)**æ˜¯åˆ†å¼€çš„, è¿™æ˜¯å…¶å¯ä»¥è§£å†³å¾ªç¯ä¾èµ–æœ€æ ¹æœ¬çš„åŸå› </p><h5 id="getBeanä¸­åˆ›å»ºBeançš„æµç¨‹"><a href="#getBeanä¸­åˆ›å»ºBeançš„æµç¨‹" class="headerlink" title="getBeanä¸­åˆ›å»ºBeançš„æµç¨‹"></a>getBeanä¸­åˆ›å»ºBeançš„æµç¨‹</h5><h6 id="doGetBean"><a href="#doGetBean" class="headerlink" title="doGetBean()"></a>doGetBean()</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> &lt;T&gt; T <span class="title function_">doGetBean</span><span class="params">(</span></span><br><span class="line"><span class="params">    String name, <span class="meta">@Nullable</span> Class&lt;T&gt; requiredType, <span class="meta">@Nullable</span> Object[] args, <span class="type">boolean</span> typeCheckOnly)</span></span><br><span class="line">    <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line"><span class="comment">// æ ¹æ®æŒ‡å®šçš„åç§°è·å–è¢«ç®¡ç†çš„Beançš„åå­—, å‰¥ç¦»æŒ‡å®šåç§°ä¸­å¯¹å®¹å™¨çš„ç›¸å…³ä¾èµ–</span></span><br><span class="line">    <span class="comment">// å¦‚æœæŒ‡å®šçš„æ˜¯åˆ«å,é‚£ä¹ˆå°†åˆ«åè½¬æ¢ä¸ºè§„èŒƒçš„Beanåç§°</span></span><br><span class="line"><span class="comment">// &lt;1&gt;è·å–beanName: ä¼ å…¥å‚æ•°nameå¯èƒ½æ˜¯åˆ«å,ä¹Ÿæœ‰å¯èƒ½æ˜¯FactoryBean, æ‰€ä»¥éœ€è¦ä¸€ç³»åˆ—çš„è§£æ</span></span><br><span class="line">    <span class="comment">//  ä¸ºFactoryBeanæ—¶,nameä¸º &quot;&amp;å·¥å‚å&quot; ,è¿˜è¦åˆ«åçš„æƒ…å†µ</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">beanName</span> <span class="operator">=</span> transformedBeanName(name);</span><br><span class="line">    Object beanInstance;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Eagerly check singleton cache for manually registered singletons.</span></span><br><span class="line">    <span class="comment">// ä»ç¼“å­˜ä¸­è·å–å·²è¢«åˆ›å»ºè¿‡çš„å•ä¾‹Bean</span></span><br><span class="line"><span class="comment">// ***&lt;2&gt;ä»ç¼“å­˜ä¸­è·å–å•ä¾‹bean,é¿å…å¾ªç¯ä¾èµ– </span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">sharedInstance</span> <span class="operator">=</span> getSingleton(beanName);<span class="comment">// å•ä¾‹æ¨¡å‹ (getSingletonæ–¹æ³•çœ‹ä¸‹é¢æºç éƒ¨åˆ†)</span></span><br><span class="line">    <span class="comment">// å¦‚æœç¼“å­˜ä¸­æœ‰æ­¤å•ä¾‹Bean</span></span><br><span class="line">    <span class="keyword">if</span> (sharedInstance != <span class="literal">null</span> &amp;&amp; args == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (isSingletonCurrentlyInCreation(beanName)) &#123;</span><br><span class="line">                logger.trace(<span class="string">&quot;Returning eagerly cached instance of singleton bean &#x27;&quot;</span> + beanName +</span><br><span class="line">                             <span class="string">&quot;&#x27; that is not fully initialized yet - a consequence of a circular reference&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                logger.trace(<span class="string">&quot;Returning cached instance of singleton bean &#x27;&quot;</span> + beanName + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        beanInstance = getObjectForBeanInstance(sharedInstance, name, beanName, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">// çœç•¥</span></span><br><span class="line">    &#125;</span><br><span class="line">        <span class="keyword">finally</span> &#123;</span><br><span class="line">            beanCreation.end();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> adaptBeanInstance(name, beanInstance, requiredType);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="getSingleton"><a href="#getSingleton" class="headerlink" title="getSingleton()"></a>getSingleton()</h6><p>åªæœ‰å•ä¾‹æ‰ä¼šæœ‰è¿™ä¸ª,åŸå‹æ¨¡å¼ä¸ä¼šè°ƒç”¨æ­¤æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Springå¯¹å•ä¾‹çš„beanåªä¼šåˆ›å»ºä¸€æ¬¡,åç»­è·å–åˆ™éƒ½æ˜¯åœ¨ç¼“å­˜ä¸­è·å–</span></span><br><span class="line"><span class="comment">// è¯¥è¿‡ç¨‹ä½“ç°åœ¨ #getSingleton(String beanName)ä¸­</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ä¸‰çº§ç¼“å­˜æœºåˆ¶çš„ç†è§£: ç›®æ ‡é¿å…å¾ªç¯ä¾èµ–</span></span><br><span class="line"><span class="comment">ä¸€çº§: ä»singletonObjectsè·å–å®ä¾‹</span></span><br><span class="line"><span class="comment">å¦åˆ™:ä»earlySingletonObjectsè·å–</span></span><br><span class="line"><span class="comment">å¦åˆ™: ä»singletonFactoriesè·å–beanNameå¯¹åº”çš„ObjectFactory,åœ¨è°ƒç”¨getObject()æ¥åˆ›å»ºbean,å¹¶æ”¾åˆ°earlySingletonObjectsä¸­</span></span><br><span class="line"><span class="comment">å¹¶ä»singletonFactoriesä¸­åˆ é™¤æ­¤ObjectFactory</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">protected</span> Object <span class="title function_">getSingleton</span><span class="params">(String beanName, <span class="type">boolean</span> allowEarlyReference)</span> &#123;</span><br><span class="line">    <span class="comment">// Quick check for existing instance without full singleton lock</span></span><br><span class="line">    <span class="comment">// ä»å•ä¾‹ç¼“å­˜(ä¸€çº§ç¼“å­˜)ä¸­è·å–å•ä¾‹bean: ç”¨æ¥å­˜å·²ç»å®Œæˆåˆå§‹åŒ–çš„å•ä¾‹bean</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">singletonObject</span> <span class="operator">=</span> <span class="built_in">this</span>.singletonObjects.get(beanName);</span><br><span class="line">    <span class="comment">// å¦‚æœç¼“å­˜ä¸­æ²¡æœ‰ å¹¶ä¸” è¯¥beançœŸæ­£åˆ›å»º(åœ¨singletonsCurrentlyInCreationé›†ä¸­å­˜åœ¨æ­¤beançš„åå­—)</span></span><br><span class="line">    <span class="comment">// â˜…â˜…â˜… isSingletonCurrentlyInCreation(beanName)</span></span><br><span class="line">    <span class="keyword">if</span> (singletonObject == <span class="literal">null</span> &amp;&amp; isSingletonCurrentlyInCreation(beanName)) &#123;</span><br><span class="line">        <span class="comment">// ä»äºŒçº§ç¼“å­˜earlySingletonObjectsä¸­å–  å·²ç»åˆ›å»ºä½†æ˜¯æ²¡æœ‰å±æ€§æ³¨å…¥</span></span><br><span class="line">        singletonObject = <span class="built_in">this</span>.earlySingletonObjects.get(beanName);</span><br><span class="line">        <span class="comment">// earlySingletonObjectsä¸­æ²¡æœ‰,ä¸”è¿è¡Œæå‰åˆ›å»º</span></span><br><span class="line">        <span class="keyword">if</span> (singletonObject == <span class="literal">null</span> &amp;&amp; allowEarlyReference) &#123;</span><br><span class="line">            <span class="comment">// åŒé‡æ£€æŸ¥é”</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">// é˜²æ­¢é‡å¤åˆ›å»º,ä½¿ç”¨æ­£å¼åˆ›å»ºbeanå‰é”å®š(å•ä¾‹æ¨¡å‹çš„åŒé‡æ£€æŸ¥é”:å½“å‰åˆ¤æ–­äº†ä¸¤æ¬¡singletonObject,åœ¨é”ä¹‹å‰å’Œé”ä¹‹å)</span></span><br><span class="line">            <span class="keyword">synchronized</span> (<span class="built_in">this</span>.singletonObjects) &#123;</span><br><span class="line">                <span class="comment">// Consistent creation of early reference within full singleton lock</span></span><br><span class="line">                singletonObject = <span class="built_in">this</span>.singletonObjects.get(beanName);</span><br><span class="line">                <span class="keyword">if</span> (singletonObject == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// earlySingletonObjectsä¸­æ²¡æœ‰,ä¸”è¿è¡Œæå‰åˆ›å»º</span></span><br><span class="line">                    singletonObject = <span class="built_in">this</span>.earlySingletonObjects.get(beanName);</span><br><span class="line">                    <span class="keyword">if</span> (singletonObject == <span class="literal">null</span>) &#123;</span><br><span class="line">                        <span class="comment">// ä»ä¸‰çº§ç¼“å­˜ singletonFactories ä¸­è·å–å¯¹åº”çš„ObjectFactory</span></span><br><span class="line">                        ObjectFactory&lt;?&gt; singletonFactory = <span class="built_in">this</span>.singletonFactories.get(beanName);</span><br><span class="line">                        <span class="keyword">if</span> (singletonFactory != <span class="literal">null</span>) &#123;</span><br><span class="line">                            <span class="comment">// ä»å•ä¾‹å·¥å‚ä¸­è·å–bean</span></span><br><span class="line">                            singletonObject = singletonFactory.getObject();</span><br><span class="line">                            <span class="comment">// å­˜å…¥(early, æ³¨æ„æ­¤æ—¶è¿˜æ²¡æœ‰æ·»åŠ å±æ€§(populateBeanç”¨æ¥æ³¨å…¥å±æ€§çš„),æ·»åŠ åˆ°äºŒçº§ç¼“å­˜)</span></span><br><span class="line">                            <span class="built_in">this</span>.earlySingletonObjects.put(beanName, singletonObject);</span><br><span class="line">                            <span class="comment">// ä»ä¸‰çº§ç¼“å­˜ä¸­åˆ é™¤</span></span><br><span class="line">                            <span class="built_in">this</span>.singletonFactories.remove(beanName);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> singletonObject;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‰çº§ç¼“å­˜çš„ç†è§£:ç›®æ ‡<strong>é¿å…å¾ªç¯ä¾èµ–</strong><br><u>ä¸€çº§</u>: ä»<u>singletonObjects</u>è·å–å®ä¾‹<br><u>äºŒçº§</u>â€”â€”&gt;å¦åˆ™:ä»<u>earlySingletonObjects</u>è·å–<br><u>ä¸‰çº§</u>â€”â€”â€”â€”&gt;å¦åˆ™: ä»<u>singletonFactories</u>è·å–beanNameå¯¹åº”çš„ObjectFactory,åœ¨è°ƒç”¨getObject()æ¥åˆ›å»ºbean,å¹¶æ”¾åˆ°earlySingletonObjectsä¸­<br>â€”â€”â€”â€”â€”â€”&gt;å¹¶ä»singletonFactoriesä¸­åˆ é™¤æ­¤ObjectFactory</p><hr><p>ä¸€çº§ç¼“å­˜(singletonObjects): æ˜¯ä¸€ä¸ª<strong>å®Œæ•´</strong>çš„Bean    -</p><p>äºŒçº§ç¼“å­˜(earlySingletonObjects): beançš„å®ä¾‹,ä½†æ˜¯<strong>æ²¡æœ‰å±æ€§</strong>( å±æ€§è¿˜æ²¡æœ‰æ³¨å…¥,æ‰€ä»¥è¯´æ„é€ æ–¹å¼æ²¡åŠæ³•è§£å†³å¾ªç¯ä¾èµ–,setæ³¨å…¥å¯ä»¥ ) ,  æ—©æœŸçš„bean</p><p>ä¸‰çº§ç¼“å­˜(singletonFactories ): å­˜æ”¾beançš„åŸå§‹å·¥å‚ï¼Œå…¶å†…å®¹ä¸äºŒçº§ç¼“å­˜ä¸­çš„æ— å¼‚</p><p>Springè§£å†³å¾ªç¯ä¾èµ–(åœ¨æ­¤ä»…è€ƒè™‘<strong>set&#x2F;å±æ€§æ³¨å…¥,å•ä¾‹</strong>æƒ…å†µ)æ˜¯ä¾é <span class="p red">Beançš„ä¸­é—´æ€</span>(ä¸€çº§:å®Œæ•´bean äºŒçº§:æ²¡æœ‰å±æ€§çš„bean ä¸‰çº§;ObjectFactory)è¿™ä¸ªæ¦‚å¿µ, è€Œä¸­é—´æ€æ˜¯æŒ‡beançš„åˆå§‹åŒ–çŠ¶æ€</p><p>å®ä¾‹åŒ–çš„è¿‡ç¨‹åˆæ˜¯é€šè¿‡æ„é€ å™¨åˆ›å»ºçš„,å¦‚æœAè¿˜æ²¡åˆ›å»ºå‡ºæ¥å°±ä¸èƒ½æå‰æ›å…‰(å¯¹è±¡å·¥å‚,ä¸‰çº§ç¼“å­˜ObjectFactory), æ‰€ä»¥æ„é€ å™¨çš„å¾ªç¯ä¾èµ–æ— æ³•è§£å†³</p><hr><span class="p red">åŒé‡æ£€æŸ¥é”</span>: å•ä¾‹,  åœ¨ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜ååŠ é”,åŠ é”åå†èµ°ä¸€éåˆ¤æ–­ä¸€çº§äºŒçº§ç¼“å­˜ä¸­æ˜¯å­˜åœ¨singletonObjectå¯¹è±¡]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æºç åˆ†æ </tag>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue</title>
      <link href="/2023/10/25/Vue/"/>
      <url>/2023/10/25/Vue/</url>
      
        <content type="html"><![CDATA[<div class="tip cogs"><p>æ­¤æ–‡ç« ç”¨äºè®°å½•åœ¨Vueé‡åˆ°çš„ä¸€äº›é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ</p></div><h1 id="Vueå¯¹äºaxiosçš„å¹¶è¡Œè¯·æ±‚å¤„ç†"><a href="#Vueå¯¹äºaxiosçš„å¹¶è¡Œè¯·æ±‚å¤„ç†" class="headerlink" title="Vueå¯¹äºaxiosçš„å¹¶è¡Œè¯·æ±‚å¤„ç†"></a>Vueå¯¹äºaxiosçš„å¹¶è¡Œè¯·æ±‚å¤„ç†</h1><p>ä½¿ç”¨è¯¥æ–¹æ³•,  <u>ä¼˜åŒ–æ€§èƒ½ä¸æ•°æ®æ¸²æŸ“æ•ˆæœ</u>, <wavy>axios.allå’Œaxios.spread</wavy> ,  æ‰€æœ‰è¯·æ±‚åŒæ—¶è¿›è¡Œ,  ç­‰è¯·æ±‚å…¨éƒ¨å‘é€åå†å¯¹æ•°æ®å¤„ç†</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®˜æ–¹ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getUserAccount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// å°è£…Promiseè¯·æ±‚</span></span><br><span class="line">  <span class="keyword">return</span> axios.<span class="title function_">get</span>(<span class="string">&#x27;/user/12345&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getUserPermissions</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> axios.<span class="title function_">get</span>(<span class="string">&#x27;/user/12345/permissions&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">axios.<span class="title function_">all</span>([<span class="title function_">getUserAccount</span>(), <span class="title function_">getUserPermissions</span>()])</span><br><span class="line"><span class="comment">// spreadå°†å„è¯·æ±‚ç»“æœæ‹†åˆ†è¿”å›</span></span><br><span class="line">    .<span class="title function_">then</span>(axios.<span class="title function_">spread</span>(<span class="keyword">function</span> (<span class="params">resp1, resp2</span>) &#123;</span><br><span class="line">    <span class="comment">// ä¸¤ä¸ªè¯·æ±‚ç°åœ¨éƒ½æ‰§è¡Œå®Œæˆ</span></span><br><span class="line">   <span class="comment">// æ­¤æ—¶ä¾‹å¦‚æˆ‘éœ€è¦å¯¹è¿™ä¸¤ä¸ªè¯·æ±‚è¿›è¡Œå¤„ç†</span></span><br><span class="line">    <span class="keyword">let</span> permissions = resp1.<span class="property">data</span>;<span class="comment">// å¯ä»¥ä½¿ç”¨æ­¤æ–¹æ¡ˆæ¥æ”¶</span></span><br><span class="line">    <span class="keyword">if</span>(permissions.<span class="property">code</span> == <span class="number">200</span>)&#123;&#125;<span class="comment">// è¿›è¡Œæ•°æ®å¤„ç†</span></span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure><p>axios.allæ–¹æ³•æ¥å—ä¸€ä¸ªæ•°ç»„ä½œä¸ºå‚æ•°ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªè¯·æ±‚ï¼Œè¿”å›ä¸€ä¸ª<a href="https://so.csdn.net/so/search?q=promise&spm=1001.2101.3001.7020">promise</a>å¯¹è±¡ï¼Œå½“æ•°ç»„ä¸­æ‰€æœ‰è¯·æ±‚å‡å·²å®Œæˆæ—¶ï¼Œæ‰§è¡Œthenæ–¹æ³•ã€‚<br>åœ¨thenæ–¹æ³•ä¸­æ‰§è¡Œäº† axios.spread æ–¹æ³•ã€‚è¯¥æ–¹æ³•æ˜¯æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ã€‚æ¥æ”¶çš„å‚æ•°å‡½æ•°çš„å‚æ•°æ˜¯axios.allæ–¹æ³•ä¸­æ¯ä¸ª<u>è¯·æ±‚è¿”å›çš„å“åº”</u></p><p>åº”ç”¨åœºæ™¯: </p><p><strong>å¹¶å‘è¯·æ±‚</strong>: å½“æ‚¨éœ€è¦åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚ï¼Œå¹¶åœ¨æ‰€æœ‰è¯·æ±‚å®Œæˆåå¤„ç†å®ƒä»¬çš„å“åº”æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿™äº›æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªé¡µé¢ä¸ŠåŠ è½½å¤šä¸ªèµ„æºæˆ–ä»å¤šä¸ª API ç«¯ç‚¹è·å–æ•°æ®æ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ axios.all æ¥åŒæ—¶å‘é€è¿™äº›è¯·æ±‚ï¼Œå¹¶ä½¿ç”¨ axios.spread æ¥å¤„ç†æ¯ä¸ªè¯·æ±‚çš„å“åº”æ•°æ®ã€‚</p><p><strong>ä¾èµ–å…³ç³»è¯·æ±‚</strong>: æœ‰æ—¶ï¼Œæ‚¨å¯èƒ½éœ€è¦åœ¨ä¸€ä¸ªè¯·æ±‚çš„ç»“æœä¸­ä½¿ç”¨å¦ä¸€ä¸ªè¯·æ±‚çš„ç»“æœã€‚ä½¿ç”¨ axios.allï¼Œæ‚¨å¯ä»¥å¹¶å‘å‘é€è¿™äº›è¯·æ±‚ï¼Œå¹¶åœ¨å®ƒä»¬éƒ½å®Œæˆåä½¿ç”¨ axios.spread æ¥å¤„ç†å®ƒä»¬çš„å“åº”ã€‚è¿™å¯ä»¥å¸®åŠ©æ‚¨æ›´é«˜æ•ˆåœ°å¤„ç†å…·æœ‰ä¾èµ–å…³ç³»çš„è¯·æ±‚ã€‚</p><p><strong>æ‰¹é‡æ“ä½œ</strong>: å¦‚æœæ‚¨éœ€è¦æ‰§è¡Œä¸€ç³»åˆ—ç±»ä¼¼çš„æ“ä½œï¼Œä¾‹å¦‚åˆ›å»ºã€æ›´æ–°æˆ–åˆ é™¤å¤šä¸ªèµ„æºï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ axios.all æ–¹æ³•æ¥åŒæ—¶å‘é€è¿™äº›è¯·æ±‚ï¼Œå¹¶ä½¿ç”¨ axios.spread æ¥å¤„ç†æ¯ä¸ªè¯·æ±‚çš„ç»“æœã€‚è¿™æ ·å¯ä»¥å‡å°‘è¯·æ±‚çš„æ•°é‡å’Œç½‘ç»œå»¶è¿Ÿã€‚</p><h1 id="MVVMæ¨¡å‹"><a href="#MVVMæ¨¡å‹" class="headerlink" title="MVVMæ¨¡å‹"></a>MVVMæ¨¡å‹</h1><p>ä»€ä¹ˆæ˜¯MVVM? <wavy>MVVM å…¶å®è¡¨ç¤ºçš„æ˜¯ View-ViewModel-Model</wavy></p><p>å…¶ä¸­å¯¹åº”çš„å°±æ˜¯:è§†å›¾å±‚-è§†å›¾æ¨¡å‹å±‚-æ¨¡å‹å±‚,  Model æ˜¯ä½œä¸ºæ¨¡å‹å±‚ï¼Œå®ƒæ˜¯è´Ÿè´£<strong>å¤„ç†ä¸šåŠ¡é€»è¾‘</strong>ä»¥åŠå’Œ<strong>æœåŠ¡å™¨ç«¯è¿›è¡Œäº¤äº’</strong>çš„ï¼›ViewModel æ˜¯ä½œä¸ºè§†å›¾æ¨¡å‹å±‚ï¼Œä¹Ÿå°±æ˜¯ Vue æ¡†æ¶æ‰€èµ·åˆ°çš„ä½œç”¨äº†ï¼Œä¸»è¦æ˜¯ä½œä¸º View å±‚å’Œ Model å±‚ä¹‹é—´çš„<strong>é€šä¿¡æ¡¥æ¢</strong>,</p><h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><p>åœ¨é¡µé¢è§†å›¾æ¸²æŸ“å®Œæˆä¹‹åå†å¾€å·²ç»æ¸²æŸ“å®Œæˆçš„dataæ¨¡å‹æ·»åŠ æ–°å±æ€§,  ä»è€Œåç»­çš„Vueæ“ä½œåœ¨é¡µé¢æ¸²æŸ“ä¸ç”Ÿæ•ˆ,  ä½†æ˜¯é€šè¿‡debugæŸ¥æ‰¾,  æ¸²æŸ“æ¨¡å‹å·²ç»æœ‰å±æ€§äº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æ˜¾ç¤º</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> jsonModel åˆ†é¡µæ•°æ®(åç«¯è¿”å›åŸå§‹æ•°æ®)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="title function_">displayPage</span>(<span class="params">jsonModel</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> _this = <span class="variable language_">this</span></span><br><span class="line">    <span class="keyword">if</span>(jsonModel.<span class="property">code</span> === <span class="number">200</span>)&#123;</span><br><span class="line">        _this.<span class="property">pageInfo</span> = jsonModel.<span class="property">data</span></span><br><span class="line">        _this.<span class="property">foods</span> = jsonModel.<span class="property">data</span>.<span class="property">data</span></span><br><span class="line">        <span class="comment">// foods: dataæ¨¡å‹</span></span><br><span class="line">        _this.<span class="property">foods</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">            item.<span class="property">status</span> = <span class="literal">false</span> <span class="comment">// å¾€foodsæ¨¡å‹é‡Œé¢æ·»åŠ å­—æ®µstatus</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“å‰ä¸ºé—®é¢˜æ ·ä¾‹: </p><p>jsonModelæ˜¯åå°ä¼ çš„åŸå§‹æ•°æ®å¯¹è±¡,  å½“å‰æ“ä½œæ˜¯å…ˆç»™æ¨¡å‹å›ºå®šæ•°æ®,  ç„¶ååœ¨è¿›è¡Œå¯¹æ¨¡å‹æ·»åŠ å­—æ®µ,  æ‰€å¸¦æ¥çš„é—®é¢˜æ˜¯: é¡µé¢æ¨¡å‹å·²ç»æ¸²æŸ“,  å¹¶ä¸”<u>å½“å‰æ–°æ·»åŠ çš„å­—æ®µæ•°æ®æ›´æ–°,  å®ƒä¸ä¼šè§¦å‘Vueçš„Observeç›‘å¬</u></p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æ˜¾ç¤º</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> jsonModel åˆ†é¡µæ•°æ®</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="title function_">displayPage</span>(<span class="params">jsonModel</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> _this = <span class="variable language_">this</span></span><br><span class="line">    <span class="keyword">if</span>(jsonModel.<span class="property">code</span> === <span class="number">200</span>)&#123;</span><br><span class="line">        <span class="comment">// Vue æ˜¯MVVMæ¨¡å‹ ,æˆ‘ä»¬éœ€è¦åœ¨æ¸²æŸ“å‰ä¿®æ”¹æ¨¡å‹æ•°æ®</span></span><br><span class="line">        <span class="comment">// æ¸²æŸ“æ¨¡å‹</span></span><br><span class="line">        jsonModel.<span class="property">data</span>.<span class="property">data</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">            item.<span class="property">status</span> = <span class="literal">false</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">// è¿›è¡Œé¡µé¢æ¨¡å‹å¯¹è±¡æ¸²æŸ“</span></span><br><span class="line">        _this.<span class="property">pageInfo</span> = jsonModel.<span class="property">data</span></span><br><span class="line">        _this.<span class="property">foods</span> = jsonModel.<span class="property">data</span>.<span class="property">data</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>åœ¨é¡µé¢å¯¹è±¡æ¨¡å‹æ¸²æŸ“<strong>å‰</strong>,  å¯¹æ¨¡å‹æ•°æ®è¿›è¡Œä¿®æ”¹</p><h1 id="ES6å¼‚æ­¥"><a href="#ES6å¼‚æ­¥" class="headerlink" title="ES6å¼‚æ­¥"></a>ES6å¼‚æ­¥</h1><h2 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h2><p>Promiseæ˜¯ä¸€ä¸ªå¯¹è±¡</p><h3 id="Promise-çŠ¶æ€-å¯¹è±¡-éœ€è¦å®ä¾‹åŒ–"><a href="#Promise-çŠ¶æ€-å¯¹è±¡-éœ€è¦å®ä¾‹åŒ–" class="headerlink" title="Promise çŠ¶æ€(å¯¹è±¡,éœ€è¦å®ä¾‹åŒ–)"></a>Promise çŠ¶æ€(å¯¹è±¡,éœ€è¦å®ä¾‹åŒ–)</h3><p>Promiseæ“ä½œæœ‰ä¸‰ç§çŠ¶æ€:</p><ol><li>pending(è¿›è¡Œä¸­)</li><li>fulfilled(å·²æˆåŠŸ)</li><li>rejected(å·²å¤±è´¥)</li></ol><p>é™¤äº†å¼‚æ­¥æ“ä½œçš„ç»“æœ,ä»»ä½•å…¶ä»–æ“ä½œéƒ½æ— æ³•æ”¹å˜è¿™ä¸ªçŠ¶æ€</p><blockquote><p>Promise å¯¹è±¡åªæœ‰ï¼šä» pending å˜ä¸º fulfilled å’Œä» pending å˜ä¸º rejected çš„çŠ¶æ€æ”¹å˜ã€‚åªè¦å¤„äº fulfilled å’Œ rejected ï¼ŒçŠ¶æ€å°±ä¸ä¼šå†å˜äº†å³ resolvedï¼ˆå·²å®šå‹ï¼‰ã€‚</p></blockquote><p>ç¼ºç‚¹:1.æ— æ³•å–æ¶ˆ Promise ï¼Œä¸€æ—¦æ–°å»ºå®ƒå°±ä¼šç«‹å³æ‰§è¡Œï¼Œæ— æ³•ä¸­é€”å–æ¶ˆã€‚ 2.å¦‚æœä¸è®¾ç½®å›è°ƒå‡½æ•°ï¼ŒPromise å†…éƒ¨æŠ›å‡ºçš„é”™è¯¯ï¼Œä¸ä¼šååº”åˆ°å¤–éƒ¨ã€‚ 3.å½“å¤„äº pending çŠ¶æ€æ—¶ï¼Œæ— æ³•å¾—çŸ¥ç›®å‰è¿›å±•åˆ°å“ªä¸€ä¸ªé˜¶æ®µï¼ˆåˆšåˆšå¼€å§‹è¿˜æ˜¯å³å°†å®Œæˆï¼‰ã€‚</p><h3 id="then"><a href="#then" class="headerlink" title=".then"></a>.then</h3><p>then æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ Promise æ‰§è¡ŒæˆåŠŸæ—¶çš„å›è°ƒï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ Promise æ‰§è¡Œå¤±è´¥æ—¶çš„å›è°ƒï¼Œä¸¤ä¸ªå‡½æ•°åªä¼šæœ‰ä¸€ä¸ªè¢«è°ƒç”¨ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve, reject</span>)&#123;</span><br><span class="line">    <span class="comment">// ä¾‹:</span></span><br><span class="line">    <span class="comment">// è®¿é—®åå°url</span></span><br><span class="line">    <span class="comment">// å¾—åˆ°ç»“æœ: jsonModel =&gt; 1</span></span><br><span class="line">    <span class="comment">// axios.get()</span></span><br><span class="line">    <span class="keyword">var</span> jsonModel = &#123;<span class="attr">name</span>:<span class="string">&#x27;then&#x27;</span>,age=<span class="number">18</span>&#125;</span><br><span class="line">    <span class="title function_">resolve</span>(jsonModel)</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">value</span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(value) <span class="comment">// 1 å¤„ç†è¿™ä¸ªvalue  -&gt; jsonModel</span></span><br><span class="line">    <span class="keyword">return</span> value <span class="comment">// å¦‚æœéœ€è¦è¿ç»­å‘è¯·æ±‚çš„è¯,è¯¥è¿”å›å€¼åˆä¼šè¢«åŒ…è£…æˆPromiseå¯¹è±¡</span></span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">value</span>)&#123;</span><br><span class="line">    <span class="comment">// å½“å‰thenå›è°ƒæ²¡æœ‰è¿”å›å€¼</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(value.<span class="property">age</span>) <span class="comment">// 18</span></span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">value</span>)&#123;</span><br><span class="line">    <span class="comment">// ä¸Šä¸€ä¸ªå‡½æ•°æ²¡æœ‰è¿”å›å€¼ç»™è¿™ä¸ªå‡½æ•°</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(value) <span class="comment">// undefined</span></span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">value</span>)&#123;</span><br><span class="line">    <span class="comment">// å¼‚å¸¸å¤„ç†</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>then æ–¹æ³•å°†è¿”å›ä¸€ä¸ª <wavy>resolved</wavy> æˆ– <wavy>rejected</wavy>çŠ¶æ€çš„ Promise å¯¹è±¡ç”¨äºé“¾å¼è°ƒç”¨ï¼Œä¸” Promise å¯¹è±¡çš„å€¼å°±æ˜¯è¿™ä¸ªè¿”å›å€¼ã€‚</li></ul><h3 id="catch"><a href="#catch" class="headerlink" title=".catch"></a>.catch</h3><p>Promise.catch()æ–¹æ³•æ˜¯promise.then(undefined,onRejected)æ–¹æ³•çš„ä¸€ä¸ªåˆ«åï¼Œè¯¥æ–¹æ³•ç”¨æ¥æ³¨å†Œå½“promiseå¯¹è±¡çŠ¶æ€å˜ä¸ºRejectedçš„å›è°ƒå‡½æ•°ã€‚</p><p>é€šä¿—æ¥è¯´å°±æ˜¯:å‘ç”Ÿå¼‚å¸¸æ‰§è¡Œçš„</p><h3 id="all-é™æ€æ–¹æ³•"><a href="#all-é™æ€æ–¹æ³•" class="headerlink" title=".all(é™æ€æ–¹æ³•)"></a>.all(é™æ€æ–¹æ³•)</h3><p>Promise.allå¯ä»¥æ¥å—ä¸€ä¸ªå…ƒç´ ä¸ºPromiseå¯¹è±¡çš„æ•°ç»„ä½œä¸ºå‚æ•°ï¼Œå½“è¿™ä¸ªæ•°ç»„é‡Œé¢æ‰€æœ‰çš„promiseå¯¹è±¡éƒ½å˜ä¸ºresolveæ—¶ï¼Œè¯¥æ–¹æ³•æ‰ä¼šè¿”å›ã€‚Promise.allæ–¹æ³•ä¸­ä¼šæŒ‰ç…§æ•°ç»„çš„åŸå…ˆé¡ºåºå°†ç»“æœè¿”å›;</p><p>ä¾‹å¦‚:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> promise1 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve</span>)[</span><br><span class="line">    <span class="comment">// setInterval()  å®šæ—¶ä»»åŠ¡</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="string">&#x27;è¯·æ±‚1&#x27;</span>)</span><br><span class="line">    &#125;,<span class="number">3000</span>)</span><br><span class="line">])</span><br><span class="line"><span class="keyword">var</span> promise2 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve</span>)[</span><br><span class="line">    <span class="comment">// setInterval()  å®šæ—¶ä»»åŠ¡</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="string">&#x27;è¯·æ±‚2&#x27;</span>)</span><br><span class="line">    &#125;,<span class="number">1000</span>)</span><br><span class="line">])</span><br><span class="line"><span class="comment">// allè¡¨ç¤ºä»¥ä¸Šä¸¤ä¸ªå‡½æ•°éƒ½æ‰§è¡Œå®Œ</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([ promise1,promise2 ]),<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(value) <span class="comment">// åˆ™ä¼šæ‰“å° [è¯·æ±‚1,è¯·æ±‚2]</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å½“å‰å°ç»“å¤„å¯ä»¥æŸ¥çœ‹å½“å‰æ–‡æ¡£çš„ #Vueå¯¹äºaxiosçš„å¹¶è¡Œè¯·æ±‚å¤„ç† </p><h3 id="race"><a href="#race" class="headerlink" title=".race"></a>.race</h3><p>Promise.raceçš„å«ä¹‰æ˜¯åªè¦æœ‰ä¸€ä¸ªpromiseå¯¹è±¡è¿›å…¥FulFilledæˆ–è€…RejectedçŠ¶æ€çš„è¯ï¼Œç¨‹åºå°±ä¼šåœæ­¢ï¼Œä¸”ä¼šç»§ç»­åé¢çš„å¤„ç†é€»è¾‘</p><p>å¯ä»¥å‚è€ƒ<a href="https://www.cnblogs.com/tugenhua0707/p/4771528.html">ES6çš„promiseå¯¹è±¡ç ”ç©¶ - é¾™æ©0707 - åšå®¢å›­ (cnblogs.com)</a></p><h2 id="Generator"><a href="#Generator" class="headerlink" title="Generator"></a>Generator</h2><wavy>æ„å»ºå™¨</wavy><p>å¯ä»¥é€šè¿‡ yield å…³é”®å­—ï¼ŒæŠŠå‡½æ•°çš„æ‰§è¡ŒæµæŒ‚èµ·ï¼Œä¸ºæ”¹å˜æ‰§è¡Œæµç¨‹æä¾›äº†å¯èƒ½ï¼Œä»è€Œä¸ºå¼‚æ­¥ç¼–ç¨‹æä¾›è§£å†³æ–¹æ¡ˆã€‚</p><p>å’Œä¸€èˆ¬æ–¹æ³•ä¸åŒçš„æ˜¯: 1.åœ¨ function åé¢ï¼Œå‡½æ•°åä¹‹å‰æœ‰ä¸ª * 2.å‡½æ•°å†…éƒ¨æœ‰ yield è¡¨è¾¾å¼</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">fun</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;one&quot;</span>);</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”¨æ³•:</p><p>è°ƒç”¨ Generator å‡½æ•°å’Œè°ƒç”¨æ™®é€šå‡½æ•°ä¸€æ ·ï¼Œåœ¨å‡½æ•°ååé¢åŠ ä¸Š()å³å¯ï¼Œä½†æ˜¯ Generator å‡½æ•°ä¸ä¼šåƒæ™®é€šå‡½æ•°ä¸€æ ·ç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæŒ‡å‘å†…éƒ¨çŠ¶æ€å¯¹è±¡çš„æŒ‡é’ˆï¼Œæ‰€ä»¥è¦è°ƒç”¨éå†å™¨å¯¹è±¡Iterator çš„ next æ–¹æ³•ï¼ŒæŒ‡é’ˆå°±ä¼šä»å‡½æ•°å¤´éƒ¨æˆ–è€…ä¸Šä¸€æ¬¡åœä¸‹æ¥çš„åœ°æ–¹å¼€å§‹æ‰§è¡Œ</p><p>è¿™ä¸ªå°±æœ‰ç‚¹ç±»ä¼¼äºJavaçš„è¿­ä»£å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Iterator&lt;String&gt; it = list.iterator();</span><br><span class="line"><span class="keyword">while</span>(it.hasNext())&#123;</span><br><span class="line">    it.next();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å•å‘ç§»åŠ¨,  æŒ‡é’ˆåç§»</p><h2 id="æ–‡ä»¶å¯¹è±¡"><a href="#æ–‡ä»¶å¯¹è±¡" class="headerlink" title="æ–‡ä»¶å¯¹è±¡"></a>æ–‡ä»¶å¯¹è±¡</h2><p>åœ¨æ—¥å¸¸,  å¯¹äºæ–‡ä»¶çš„ä¸Šä¼ æ“ä½œæ˜¯å¿…è¦çš„</p><h3 id="å›¾ç‰‡ä¸Šä¼ "><a href="#å›¾ç‰‡ä¸Šä¼ " class="headerlink" title="å›¾ç‰‡ä¸Šä¼ "></a>å›¾ç‰‡ä¸Šä¼ </h3><p>é¡µé¢ä»£ç æ¡ˆä¾‹:</p><p>éœ€æ±‚:æˆ‘éœ€è¦å¯¹<code>id=fphoto</code>çš„æ–‡ä»¶å¯¹è±¡è¿›è¡Œå¤„ç†</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;fphoto&quot;</span>&gt;</span>å›¾ç‰‡<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;fphoto&quot;</span> <span class="attr">name</span>=<span class="string">&quot;fphoto&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;detail&quot;</span>&gt;</span>è¯¦æƒ…<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">v-model</span>=<span class="string">&quot;detail&quot;</span> <span class="attr">rows</span>=<span class="string">&quot;5&quot;</span> <span class="attr">cols</span>=<span class="string">&quot;50&quot;</span> <span class="attr">id</span>=<span class="string">&quot;detail&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-default&quot;</span>&gt;</span>ä¸Šæ¶<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¸¸è§æ–¹æ¡ˆ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">submit</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> _this = <span class="variable language_">this</span></span><br><span class="line">    <span class="comment">// å¯¹äºæ–‡ä»¶ä¸Šä¼ , å¿…é¡»ä¸ºpost, å¹¶ä¸”éœ€è¦æŒ‡å®šContent-Type: multipart/form-data</span></span><br><span class="line">    <span class="keyword">let</span> fphoto = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#fphoto&quot;</span>).<span class="property">files</span>[<span class="number">0</span>] <span class="comment">// è¿™ä¸ªå¯ä»¥å–å¤šä¸ªæ–‡ä»¶, æˆ‘ä»¬åªå–ä¸€ä¸ª</span></span><br><span class="line">    <span class="comment">// åˆ›å»ºformdataå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">let</span> formdata = <span class="keyword">new</span> <span class="title class_">FormData</span>()</span><br><span class="line">    formdata.<span class="title function_">append</span>(<span class="string">&quot;fphoto&quot;</span>,fphoto) <span class="comment">// æ–‡ä»¶å¯¹è±¡</span></span><br><span class="line">    <span class="comment">// å…¶ä»–çš„å¯¹è±¡å‚æ•°(appendè¿›å»)</span></span><br><span class="line">    formdata.<span class="title function_">append</span>(<span class="string">&quot;detail&quot;</span>, _this.<span class="property">detail</span>)</span><br><span class="line">    <span class="keyword">const</span> req = &#123;</span><br><span class="line">        <span class="attr">headers</span>:&#123;</span><br><span class="line">            <span class="string">&quot;Content-Type&quot;</span>:<span class="string">&quot;multipart/form-data&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¯·æ±‚å‚æ•°é…ç½®</span></span><br><span class="line">    <span class="title function_">axios</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>:<span class="string">&#x27;/upload&#x27;</span>,</span><br><span class="line">        <span class="attr">method</span>:<span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>:formdata,</span><br><span class="line">        <span class="attr">headers</span>: req.<span class="property">headers</span></span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// å¤„ç†è¯·æ±‚  å½“å‰ç« èŠ‚æ¬¡è¦</span></span><br><span class="line">        <span class="keyword">let</span> jsonModel = res.<span class="property">data</span></span><br><span class="line">        <span class="keyword">if</span>(jsonModel.<span class="property">code</span> === <span class="number">200</span>)&#123;</span><br><span class="line"><span class="keyword">let</span> jsonModel = res.<span class="property">data</span></span><br><span class="line">            <span class="keyword">if</span>(jsonModel.<span class="property">code</span> === <span class="number">200</span>)&#123;</span><br><span class="line">                <span class="title function_">alert</span>(<span class="string">&quot;ä¸Šä¼ æˆåŠŸ!&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¥æ¡ˆä¾‹æ€»ç»“</p><ul><li>å¯¹äºæ–‡ä»¶ä¸Šä¼ , å¿…é¡»ä¸ºpost</li><li>å¹¶ä¸”éœ€è¦åœ¨headersæŒ‡å®šContent-Type: multipart&#x2F;form-data</li><li>å‰©ä¸‹çš„å‚æ•°éƒ½ç”¨formdataåŒ…è£…å³å¯</li></ul><h1 id="å‰ç«¯å¯¼å‡ºExcel"><a href="#å‰ç«¯å¯¼å‡ºExcel" class="headerlink" title="å‰ç«¯å¯¼å‡ºExcel"></a>å‰ç«¯å¯¼å‡ºExcel</h1><p>å‰ç«¯ä»£ç ,  åç«¯ç”¨EasyExcelå®ç°, è¯¦æƒ…è§æ–‡æ¡£</p><p>å¯¼å‡ºexcel,  æµè§ˆå™¨å¼¹çª—ä¸‹è½½<a href="https://easyexcel.opensource.alibaba.com/docs/current/">å…³äºEasyexcel | Easy Excel (alibaba.com)</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">axios</span>(&#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">    <span class="comment">// è¯·æ±‚åå°åœ°å€</span></span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;http://localhost:9000/upload/export/forEmployee&quot;</span>,</span><br><span class="line">    <span class="attr">responseType</span>: <span class="string">&quot;blob&quot;</span>, <span class="comment">//è®¾ç½®è¿”å›ä¿¡æ¯ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé»˜è®¤ä¸ºjson</span></span><br><span class="line">    <span class="comment">// éœ€è¦å¯¼å‡ºçš„æ•°æ®</span></span><br><span class="line">    <span class="attr">data</span>: <span class="variable language_">this</span>.<span class="property">employeeList</span>, <span class="comment">//åå°ç…§å¸¸ç”¨@RequestBodyæ¥æ”¶å³å¯</span></span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// è¿™ä¸ªåœ°æ–¹æˆ‘ä»¬åº”è¯¥æ‹¿åˆ°åç«¯å“åº”ä¿¡æ¯é‡Œé¢çš„æ–‡ä»¶ä¿¡æ¯, æ­¤å¤„åˆ†æå…¶æ–‡ä»¶åœ¨res.dataä¸­</span></span><br><span class="line">    <span class="keyword">let</span> blob = <span class="keyword">new</span> <span class="title class_">Blob</span>([res.<span class="property">data</span>], &#123; <span class="attr">type</span>: <span class="string">&quot;application/xlsx&quot;</span> &#125;);</span><br><span class="line">    <span class="keyword">let</span> url = <span class="variable language_">window</span>.<span class="property">URL</span>.<span class="title function_">createObjectURL</span>(blob);</span><br><span class="line">    <span class="keyword">const</span> link = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;a&quot;</span>); <span class="comment">//åˆ›å»ºaæ ‡ç­¾</span></span><br><span class="line">    link.<span class="property">href</span> = url;</span><br><span class="line">    link.<span class="property">download</span> = <span class="string">&quot;å‘˜å·¥ä¿¡æ¯_&quot;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>() + <span class="string">&quot;.xlsx&quot;</span>; <span class="comment">//é‡å‘½åæ–‡ä»¶</span></span><br><span class="line">    link.<span class="title function_">click</span>();</span><br><span class="line">    <span class="variable constant_">URL</span>.<span class="title function_">revokeObjectURL</span>(url);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="ç»„ä»¶é€šä¿¡"><a href="#ç»„ä»¶é€šä¿¡" class="headerlink" title="ç»„ä»¶é€šä¿¡"></a>ç»„ä»¶é€šä¿¡</h1><p>æ¡ˆä¾‹éœ€æ±‚:  ç‚¹å‡»å·¦è¾¹&#x2F;å³è¾¹å…ƒç´ ,  ç„¶åç‚¹å‡»å·¦ç§»,   å®ç°å…ƒç´ ç§»åŠ¨</p><table border="1" width="500" height="200" align="center" cellpadding="10" cellspacing="0">    <!-- è¡¨æ ¼è¡Œæ ‡ç­¾ -->    <tr align="center">        <!-- è¡¨æ ¼è¡¨å¤´å•å…ƒæ ¼æ ‡ç­¾ -->        <th>left</th>         <th>operate</th>        <th>right</th>    </tr>    <tr align="center">        <!-- è¡¨æ ¼æ™®é€šå•å…ƒæ ¼æ ‡ç­¾ -->        <td>A</td>        <td rowspan="3">å·¦ç§» | å³ç§»</td>        <td>D</td>    </tr>    <tr align="center">        <!-- è¡¨æ ¼æ™®é€šå•å…ƒæ ¼æ ‡ç­¾ -->        <td>B</td>        <td>E</td>    </tr>    <tr align="center">        <!-- è¡¨æ ¼æ™®é€šå•å…ƒæ ¼æ ‡ç­¾ -->        <td>C</td>        <td>F</td>    </tr></table><p>App.vue</p><details class="folding-tag" green><summary> æŸ¥çœ‹ä»£ç æµ‹è¯• </summary>              <div class="content">              <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">MyCross</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:left</span>=<span class="string">&quot;this.left&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:right</span>=<span class="string">&quot;this.right&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">moveLeft</span>=<span class="string">&quot;moveLeft&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">moveRight</span>=<span class="string">&quot;moveRight&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">moveAllLeft</span>=<span class="string">&quot;moveLeftAll&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">moveAllRight</span>=<span class="string">&quot;moveRightAll&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">MyCross</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">MyCross</span> <span class="keyword">from</span> <span class="string">&quot;./components/Cross.vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Cross</span>,</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">left</span>: [</span></span><br><span class="line"><span class="language-javascript">        &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;æ—å†²&quot;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">        &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&quot;æ­¦æ¾&quot;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">        &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">&quot;ç™½èƒœ&quot;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">      ],</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">right</span>: [</span></span><br><span class="line"><span class="language-javascript">        &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;æ—å†²&quot;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">        &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&quot;å“ˆå“ˆ&quot;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">      ],</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">moveRight</span>(<span class="params">item</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">right</span>.<span class="title function_">push</span>(item);</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">left</span> = <span class="variable language_">this</span>.<span class="property">left</span>.<span class="title function_">filter</span>(<span class="function">(<span class="params">i</span>) =&gt;</span> i !== item);</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">moveLeft</span>(<span class="params">item</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">left</span>.<span class="title function_">push</span>(item);</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">right</span> = <span class="variable language_">this</span>.<span class="property">right</span>.<span class="title function_">filter</span>(<span class="function">(<span class="params">i</span>) =&gt;</span> i !== item);</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">moveLeftAll</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">right</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">left</span>.<span class="title function_">push</span>(item);</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">right</span> = [];</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">moveRightAll</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">left</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">right</span>.<span class="title function_">push</span>(item);</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">left</span> = [];</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>              </div>            </details><p>Cross.vue</p><details class="folding-tag" green><summary> å­ç»„ä»¶ä»£ç  </summary>              <div class="content">              <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;display: flex&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;item in left&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.id&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;moveRight(item)&quot;</span>&gt;</span></span><br><span class="line">        &#123;&#123; item.name &#125;&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;padding-top: 50px&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;moveAllLeft()&quot;</span>&gt;</span>â†â†<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;moveAllRight()&quot;</span>&gt;</span>â†’â†’<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;item in right&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.id&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;moveLeft(item)&quot;</span>&gt;</span></span><br><span class="line">        &#123;&#123; item.name &#125;&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">props</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">left</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Array</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">required</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">right</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">type</span>: <span class="title class_">Array</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">required</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">moveRight</span>(<span class="params">item</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.$emit(<span class="string">&#x27;moveRight&#x27;</span>,item)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">moveLeft</span>(<span class="params">item</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.$emit(<span class="string">&#x27;moveLeft&#x27;</span>,item)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">moveAllLeft</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.$emit(<span class="string">&#x27;moveAllLeft&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">moveAllRight</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.$emit(<span class="string">&#x27;moveAllRight&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>              </div>            </details><blockquote><p> è¯´æ˜:  App.vueä¸ºçˆ¶ç»„ä»¶,  Cross.vueä¸ºå­ç»„ä»¶</p></blockquote><p>å…ˆæ³¨å†Œç»„ä»¶</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯¼å…¥ç»„ä»¶</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">MyCross</span> <span class="keyword">from</span> <span class="string">&quot;./components/Cross.vue&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">components</span>: &#123;</span><br><span class="line">    <span class="comment">// æ³¨å†Œç»„ä»¶</span></span><br><span class="line">    <span class="title class_">Cross</span>,</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><h2 id="çˆ¶ä¼ å­props"><a href="#çˆ¶ä¼ å­props" class="headerlink" title="çˆ¶ä¼ å­props"></a>çˆ¶ä¼ å­props</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">MyCross</span></span></span><br><span class="line"><span class="tag">         <span class="attr">:left</span>=<span class="string">&quot;this.left&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">:right</span>=<span class="string">&quot;this.right&quot;</span></span></span><br><span class="line"><span class="tag">         @<span class="attr">moveLeft</span>=<span class="string">&quot;moveLeft&quot;</span></span></span><br><span class="line"><span class="tag">         @<span class="attr">moveRight</span>=<span class="string">&quot;moveRight&quot;</span></span></span><br><span class="line"><span class="tag">         @<span class="attr">moveAllLeft</span>=<span class="string">&quot;moveLeftAll&quot;</span></span></span><br><span class="line"><span class="tag">         @<span class="attr">moveAllRight</span>=<span class="string">&quot;moveRightAll&quot;</span></span></span><br><span class="line"><span class="tag">         &gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">MyCross</span>&gt;</span></span><br></pre></td></tr></table></figure><p>çˆ¶ç»„ä»¶ä¸­å¼•ç”¨å­ç»„ä»¶</p><p>é€šè¿‡è¯­æ³•ç³–(1)  :left  , å°†çˆ¶ç»„ä»¶ä¸­çš„this.leftæ•°æ®ä¼ é€’ç»™å­ç»„ä»¶,  å­ç»„ä»¶ä¸­åŒæ ·éœ€è¦ä½¿ç”¨è¯¥åæ¥æ”¶</p><p>è¯­æ³•ç³–(2) @moveLeft: å­ç»„ä»¶é€šçŸ¥çš„äº‹ä»¶å,  é€šçŸ¥åä¼šè°ƒç”¨çˆ¶ç»„ä»¶ä¸­ç­‰å·å³ä¾§çš„æ–¹æ³•</p><p>åœ¨å­ç»„ä»¶ä¸­: </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="comment">// æ¥æ”¶çˆ¶ç»„ä»¶ä¸­ä¼ çš„å€¼(é€šè¿‡çˆ¶ç»„ä»¶çš„è¯­æ³•ç³–), å¯ä»¥çº¦æŸç±»å‹</span></span><br><span class="line">    <span class="attr">left</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Array</span>,</span><br><span class="line">      <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">right</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Array</span>,</span><br><span class="line">      <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å‡å¦‚çˆ¶ç»„ä»¶ä¸­ä¼ äº†å€¼è¿‡æ¥,  å³å¯ä»¥ç›´æ¥ä½¿ç”¨è¯¥å­—æ®µäº†,  åœ¨å­ç»„ä»¶ä¸­ä½¿ç”¨ä¾‹å¦‚:   this.left</p><h2 id="å­ä¼ çˆ¶-emit"><a href="#å­ä¼ çˆ¶-emit" class="headerlink" title="å­ä¼ çˆ¶$emit"></a>å­ä¼ çˆ¶$emit</h2><p>å­ä¼ çˆ¶,   ä¾‹å¦‚æ­¤æ—¶éœ€è¦é€šè¿‡ç‚¹å‡»äº‹ä»¶è§¦å‘</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;moveLeft()&quot;</span>&gt;</span>â†â†<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ­¤æŒ‰é’®ä½œç”¨ä¸º:  ç‚¹å‡»äº†æ­¤æŒ‰é’®å¹¶ä¸”é€‰ä¸­äº†ä¸€ä¸ªå…ƒç´ ,  åˆ™å®ç°å·¦ç§»</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">methods</span>:&#123;</span><br><span class="line">    <span class="comment">// æ–¹æ³•å¦‚ä¸‹</span></span><br><span class="line">    <span class="title function_">moveLeft</span>(<span class="params">item</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.$emit(<span class="string">&#x27;moveLeft&#x27;</span>,item) <span class="comment">// ä¼ è¾“å¯¹è±¡ç»™çˆ¶ç»„ä»¶</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è¯­æ³•  $emité€šçŸ¥çˆ¶ç»„ä»¶,  å¹¶ä¸”ä¼ äº†ä¸€ä¸ªå‚æ•°itemè¿‡å»</p><p>å¯ä»¥å¾ˆå®¹æ˜“çš„çœ‹å‡º,  é€šçŸ¥çˆ¶ç»„ä»¶çš„æ–¹æ³•ä¸º moveLeft,  é‚£ä¹ˆçˆ¶ç»„ä»¶ä¸­è°ƒç”¨å­ç»„ä»¶çš„è¯­æ³•ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚ä¸‹æ“ä½œ:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">MyCross</span> @<span class="attr">moveLeft</span>=<span class="string">&quot;moveLeftFunc&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">MyCross</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é€šè¿‡@moveLeftæ¥æ”¶é€šçŸ¥,  å¹¶ä¸”è§¦å‘è°ƒç”¨çˆ¶ç»„ä»¶ä¸­çš„æ–¹æ³•moveLeftFunc,  å½¢å‚æ¥æ”¶å­ç»„ä»¶ä¼ è¾“çš„å¯¹è±¡</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">moveLeftFunc</span>(<span class="params">item</span>) &#123; <span class="comment">// itemä¸ºå­ç»„ä»¶ä¸­ä¼ è¾“çš„å¯¹è±¡</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">left</span>.<span class="title function_">push</span>(item);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">right</span> = <span class="variable language_">this</span>.<span class="property">right</span>.<span class="title function_">filter</span>(<span class="function">(<span class="params">i</span>) =&gt;</span> i !== item);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h1 id="Vue-Admin-Templateåˆå§‹åŒ–"><a href="#Vue-Admin-Templateåˆå§‹åŒ–" class="headerlink" title="Vue-Admin-Templateåˆå§‹åŒ–"></a>Vue-Admin-Templateåˆå§‹åŒ–</h1><h2 id="vue-config-js"><a href="#vue-config-js" class="headerlink" title="vue.config.js"></a>vue.config.js</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * You will need to set publicPath if you plan to deploy your site under a sub path,</span></span><br><span class="line"><span class="comment">   * for example GitHub Pages. If you plan to deploy your site to https://foo.github.io/bar/,</span></span><br><span class="line"><span class="comment">   * then publicPath should be set to &quot;/bar/&quot;.</span></span><br><span class="line"><span class="comment">   * In most cases please use &#x27;/&#x27; !!!</span></span><br><span class="line"><span class="comment">   * Detail: https://cli.vuejs.org/config/#publicpath</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">publicPath</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">  <span class="attr">outputDir</span>: <span class="string">&quot;dist&quot;</span>,</span><br><span class="line">  <span class="attr">assetsDir</span>: <span class="string">&quot;static&quot;</span>,</span><br><span class="line">  <span class="comment">// å…³é—­eslint</span></span><br><span class="line">  <span class="comment">// lintOnSave: process.env.NODE_ENV === &quot;development&quot;,</span></span><br><span class="line">  <span class="attr">lintOnSave</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">productionSourceMap</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">port</span>: port,</span><br><span class="line">    <span class="attr">open</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">overlay</span>: &#123;</span><br><span class="line">      <span class="attr">warnings</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">errors</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">proxy</span>: &#123;</span><br><span class="line">      [process.<span class="property">env</span>.<span class="property">VUE_APP_BASE_API</span>]: &#123;</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;http://127.0.0.1:9000&quot;</span>,</span><br><span class="line">        <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">pathRewrite</span>: &#123;</span><br><span class="line">          [<span class="string">&quot;^&quot;</span> + process.<span class="property">env</span>.<span class="property">VUE_APP_BASE_API</span>]: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// before: require(&#x27;./mock/mock-server.js&#x27;)</span></span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><p>å…³é—­æœ¬åœ°mockæ¨¡æ‹Ÿæ¥å£,  ä½¿ç”¨è‡ªå®šä¹‰åç«¯æ¥å£</p><h2 id="env-development"><a href="#env-development" class="headerlink" title=".env.development"></a>.env.development</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># just a flag</span><br><span class="line">ENV = &#x27;development&#x27;</span><br><span class="line"> </span><br><span class="line"># base api</span><br><span class="line"># VUE_APP_BASE_API = &#x27;api&#x27;</span><br><span class="line">VUE_APP_BASE_API = &#x27;http://localhost:9000&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># vue-cli uses the VUE_CLI_BABEL_TRANSPILE_MODULES environment variable,</span><br><span class="line"># to control whether the babel-plugin-dynamic-import-node plugin is enabled.</span><br><span class="line"># It only does one thing by converting all import() to require().</span><br><span class="line"># This configuration can significantly increase the speed of hot updates,</span><br><span class="line"># when you have a large number of pages.</span><br><span class="line"># Detail:  https://github.com/vuejs/vue-cli/blob/dev/packages/@vue/babel-preset-app/index.js</span><br><span class="line"></span><br><span class="line">VUE_CLI_BABEL_TRANSPILE_MODULES = true</span><br></pre></td></tr></table></figure><h2 id="routr-index-js"><a href="#routr-index-js" class="headerlink" title="routr&#x2F;index.js"></a>routr&#x2F;index.js</h2><p>è°ƒæ•´è·¯ç”±</p><h2 id="utils-request-js"><a href="#utils-request-js" class="headerlink" title="utils&#x2F;request.js"></a>utils&#x2F;request.js</h2><p>æŠŠå“åº”è¿”å›å€¼åˆ¤æ–­æ”¹æˆ200</p>]]></content>
      
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LeetCode</title>
      <link href="/2023/10/21/LeetCode/"/>
      <url>/2023/10/21/LeetCode/</url>
      
        <content type="html"><![CDATA[<p>åˆ®å¼€çœ‹çœ‹ï¼š<psw>è¿™é‡Œå•¥éƒ½æ²¡æœ‰(è¿˜æ²¡æœ‰ç¬”è®°å–”)</psw></p>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginx</title>
      <link href="/2023/10/20/Nginx/"/>
      <url>/2023/10/20/Nginx/</url>
      
        <content type="html"><![CDATA[<p>åˆ®å¼€çœ‹çœ‹ï¼š<psw>è¿™é‡Œå•¥éƒ½æ²¡æœ‰</psw></p>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nginx </tag>
            
            <tag> è´Ÿè½½å‡è¡¡ </tag>
            
            <tag> åå‘ä»£ç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker</title>
      <link href="/2023/10/16/Docker/"/>
      <url>/2023/10/16/Docker/</url>
      
        <content type="html"><![CDATA[<p>åˆ®å¼€çœ‹çœ‹ï¼š<psw>å¼€å§‹æ…¢æ…¢æœ‰ç¬”è®°äº†</psw></p><h2 id="Dockerå®‰è£…"><a href="#Dockerå®‰è£…" class="headerlink" title="Dockerå®‰è£…"></a>Dockerå®‰è£…</h2><h3 id="å¸è½½"><a href="#å¸è½½" class="headerlink" title="å¸è½½"></a>å¸è½½</h3><p>å¦‚æœä¹‹å‰æœ‰å®‰è£…è¿‡æ—§ç‰ˆæœ¬çš„Docker,åˆ™é€šè¿‡å‘½ä»¤å¸è½½æ—§ç‰ˆæœ¬çš„Docker</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-selinux \</span><br><span class="line">                  docker-engine-selinux \</span><br><span class="line">                  docker-engine \</span><br><span class="line">                  docker-ce</span><br></pre></td></tr></table></figure><p>æ²¡æœ‰ä»»ä½•åŒ¹é…ï¼Œè¯´æ˜æ²¡è£…è¿‡docker</p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>é¦–å…ˆéœ€è¦è™šæ‹Ÿæœºè”ç½‘ï¼Œå®‰è£…yumå·¥å…·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils \</span><br><span class="line">           device-mapper-persistent-data \</span><br><span class="line">           lvm2 --skip-broken</span><br></pre></td></tr></table></figure><p>è¿è¡Œè€å¿ƒç­‰å¾…ä¸€ä¸‹ï¼Œå®‰è£…å®Œæˆ(æœ€åæ˜¾ç¤º å®Œæ¯•!)</p><p>ç„¶åæ›´æ–°æœ¬åœ°é•œåƒæºï¼šé…ç½®é˜¿é‡Œäº‘çš„ä»“åº“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®dockeré•œåƒæº</span></span><br><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">    </span><br><span class="line">sed -i <span class="string">&#x27;s/download.docker.com/mirrors.aliyun.com\/docker-ce/g&#x27;</span> /etc/yum.repos.d/docker-ce.repo</span><br><span class="line"></span><br><span class="line">yum makecache fast</span><br></pre></td></tr></table></figure><p>å®‰è£…docker</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y docker-ce</span><br></pre></td></tr></table></figure><p>docker-ce: ç¤¾åŒºç‰ˆ</p><h3 id="å¯åŠ¨Docker"><a href="#å¯åŠ¨Docker" class="headerlink" title="å¯åŠ¨Docker"></a>å¯åŠ¨Docker</h3><p>é˜²ç«å¢™è®¾ç½®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…³é—­</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line"><span class="comment"># ç¦æ­¢å¼€æœºå¯åŠ¨é˜²ç«å¢™</span></span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld</span><br><span class="line"><span class="comment"># å¯ä»¥æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€</span></span><br><span class="line">systemctl status firewalld</span><br></pre></td></tr></table></figure><p>å¯åŠ¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker  # å¯åŠ¨dockeræœåŠ¡</span><br><span class="line"></span><br><span class="line">systemctl stop docker  # åœæ­¢dockeræœåŠ¡</span><br><span class="line"></span><br><span class="line">systemctl restart docker  # é‡å¯dockeræœåŠ¡</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹dockerçŠ¶æ€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status docker</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹dockerç‰ˆæœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker -v</span><br></pre></td></tr></table></figure><h3 id="é…ç½®é•œåƒåŠ é€Ÿ"><a href="#é…ç½®é•œåƒåŠ é€Ÿ" class="headerlink" title="é…ç½®é•œåƒåŠ é€Ÿ"></a>é…ç½®é•œåƒåŠ é€Ÿ</h3><p>dockerå®˜æ–¹é•œåƒä»“åº“ç½‘é€Ÿè¾ƒå·®ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®å›½å†…é•œåƒæœåŠ¡ï¼š<br>å‚è€ƒé˜¿é‡Œäº‘çš„é•œåƒåŠ é€Ÿæ–‡æ¡£ï¼š<a href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors">https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> -p /etc/docker</span><br><span class="line">sudo <span class="built_in">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://gtxivg4h.mirror.aliyuncs.com&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure><h2 id="éƒ¨ç½²MySQL"><a href="#éƒ¨ç½²MySQL" class="headerlink" title="éƒ¨ç½²MySQL"></a>éƒ¨ç½²MySQL</h2><p>å…ˆåœæ‰è™šæ‹Ÿæœºä¸­çš„MySQLï¼Œç¡®ä¿è™šæ‹Ÿæœºå·²ç»å®‰è£…Dockerï¼Œä¸”ç½‘ç»œå¼€é€šçš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤å³å¯å®‰è£…MySQL</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">  --name mysql \</span><br><span class="line">  -p 3306:3306 \</span><br><span class="line">  -e TZ=Asia/Shanghai \</span><br><span class="line">  -e MYSQL_ROOT_PASSWORD=123456 \</span><br><span class="line">  mysql</span><br></pre></td></tr></table></figure><p>è§£è¯»ï¼š</p><p><strong>docker run -d</strong> ï¼šåˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªå®¹å™¨ï¼Œ**-d**åˆ™æ˜¯è®©å®¹å™¨ä»¥åå°è¿›ç¨‹è¿è¡Œ</p><p><strong>â€“name mysql</strong> : ç»™å®¹å™¨èµ·ä¸ªåå­—å«mysql,å¿…é¡»å”¯ä¸€</p><p><strong>-p 3306:3306</strong> : è®¾ç½®ç«¯å£æ˜ å°„ã€‚(åé¢è¿™ä¸ªæ˜¯å®¹å™¨å†…MySQLé»˜è®¤ç«¯å£,å‰é¢æ˜¯æ˜ å°„å‡ºå»çš„ç«¯å£(å®¿ä¸»æœº),æ¯”å¦‚3307)</p><p>å®¹å™¨æ˜¯éš”ç¦»ç¯å¢ƒï¼Œå¤–ç•Œä¸å¯è®¿é—®ã€‚ä½†æ˜¯å¯ä»¥å°†å®¿ä¸»æœºç«¯å£æ˜ å°„å®¹å™¨å†…åˆ°ç«¯å£ï¼Œå½“è®¿é—®å®¿ä¸»æœºæŒ‡å®šç«¯å£æ—¶ï¼Œå°±æ˜¯åœ¨è®¿é—®å®¹å™¨å†…çš„ç«¯å£äº†ã€‚</p><p>å®¹å™¨å†…ç«¯å£å¾€å¾€æ˜¯ç”±å®¹å™¨å†…çš„è¿›ç¨‹å†³å®šï¼Œä¾‹å¦‚MySQLè¿›ç¨‹é»˜è®¤ç«¯å£æ˜¯3306ï¼Œå› æ­¤å®¹å™¨å†…ç«¯å£ä¸€å®šæ˜¯3306ï¼›è€Œå®¿ä¸»æœºç«¯å£åˆ™å¯ä»¥ä»»æ„æŒ‡å®šï¼Œä¸€èˆ¬ä¸å®¹å™¨å†…ä¿æŒä¸€è‡´ã€‚</p><p>æ ¼å¼ï¼š -p å®¿ä¸»æœºç«¯å£:å®¹å™¨å†…ç«¯å£ï¼Œç¤ºä¾‹ä¸­å°±æ˜¯å°†å®¿ä¸»æœºçš„3306æ˜ å°„åˆ°å®¹å™¨å†…çš„3306ç«¯å£</p><p><strong>-e</strong> TZ&#x3D;Asia&#x2F;Shanghai : é…ç½®å®¹å™¨å†…è¿›ç¨‹è¿è¡Œæ—¶çš„ä¸€äº›å‚æ•°(eâ€“&gt;environment)</p><p>æ ¼å¼ï¼š**-e KEY&#x3D;VALUE**ï¼ŒKEYå’ŒVALUEéƒ½ç”±å®¹å™¨å†…è¿›ç¨‹å†³å®š</p><p>æ¡ˆä¾‹ä¸­ï¼ŒTZ&#x3D;Asia&#x2F;Shanghaiæ˜¯è®¾ç½®æ—¶åŒºï¼›MYSQL_ROOT_PASSWORD&#x3D;123456æ˜¯è®¾ç½®MySQLé»˜è®¤å¯†ç </p><p><strong>mysql</strong> : è®¾ç½®é•œåƒåç§°ï¼ŒDockerä¼šæ ¹æ®è¿™ä¸ªåå­—æœç´¢å¹¶ä¸‹è½½é•œåƒ</p><p>æ ¼å¼ï¼šREPOSITORY:TAGï¼Œä¾‹å¦‚mysql:8.0ï¼Œå…¶ä¸­REPOSITORYå¯ä»¥ç†è§£ä¸ºé•œåƒåï¼ŒTAGæ˜¯ç‰ˆæœ¬å·</p><p>åœ¨æœªæŒ‡å®šTAGçš„æƒ…å†µä¸‹ï¼Œé»˜è®¤æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯mysql:latest</p><h3 id="è¿æ¥è¿œç¨‹æ•°æ®åº“"><a href="#è¿æ¥è¿œç¨‹æ•°æ®åº“" class="headerlink" title="è¿æ¥è¿œç¨‹æ•°æ®åº“"></a>è¿æ¥è¿œç¨‹æ•°æ®åº“</h3><p>æ‰“å¼€æ•°æ®åº“è¿æ¥å·¥å…·</p><p>å¦‚æœå‡ºç°<strong>æ²¡æœ‰æƒé™</strong>,åˆ™åœ¨Dockerå®¹å™¨ä¸­,è¾“å…¥æŒ‡ä»¤,<em>è¿›å…¥å®¹å™¨,æŸ¥çœ‹å®¹å™¨å†…ç›®å½•</em> </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it container_name /bin/bash</span><br></pre></td></tr></table></figure><p>ç™»å½•MySQL</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹æƒé™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ALTER USER &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;123456&#x27;;</span><br><span class="line"># æ›´æ–°userä¸ºrootï¼Œhostä¸º% çš„å¯†ç ä¸º123456</span><br><span class="line"> </span><br><span class="line">ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;123456&#x27;;</span><br><span class="line"># æ›´æ–°userä¸ºrootï¼Œhostä¸ºlocalhost çš„å¯†ç ä¸º123456</span><br></pre></td></tr></table></figure><p>åˆ·æ–°æƒé™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FLUSH PRIVILEGES; #åˆ·æ–°æƒé™</span><br></pre></td></tr></table></figure><p>æœ€åæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯   (æŸ¥çœ‹rootç”¨æˆ·)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select host,user,plugin,authentication_string from mysql.user;</span><br></pre></td></tr></table></figure><p>è¿æ¥æˆåŠŸåˆ™å¯ä»¥åƒåœ¨Windowsæ“ä½œæœ¬åœ°æ•°æ®åº“ä¸€æ ·çš„äº†</p><h2 id="DockeråŸºç¡€"><a href="#DockeråŸºç¡€" class="headerlink" title="DockeråŸºç¡€"></a>DockeråŸºç¡€</h2><h3 id="å¸¸è§å‘½ä»¤"><a href="#å¸¸è§å‘½ä»¤" class="headerlink" title="å¸¸è§å‘½ä»¤"></a>å¸¸è§å‘½ä»¤</h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>docker pull</td><td>æ‹‰å–é•œåƒ</td></tr><tr><td>docker push</td><td>æ¨é€é•œåƒåˆ°DockerRegistry</td></tr><tr><td>docker images</td><td>æŸ¥çœ‹æœ¬åœ°é•œåƒ</td></tr><tr><td>docker rmi</td><td>åˆ é™¤æœ¬åœ°é•œåƒ</td></tr><tr><td>docker run</td><td>åˆ›å»ºå¹¶è¿è¡Œå®¹å™¨ï¼ˆä¸èƒ½é‡å¤åˆ›å»ºï¼‰</td></tr><tr><td>docker stop</td><td>åœæ­¢æŒ‡å®šå®¹å™¨</td></tr><tr><td>docker start</td><td>å¯åŠ¨æŒ‡å®šå®¹å™¨</td></tr><tr><td>docker restart</td><td>é‡æ–°å¯åŠ¨å®¹å™¨</td></tr><tr><td>docker rm</td><td>åˆ é™¤æŒ‡å®šå®¹å™¨</td></tr><tr><td>docker ps</td><td>æŸ¥çœ‹å®¹å™¨</td></tr><tr><td>docker logs</td><td>æŸ¥çœ‹å®¹å™¨è¿è¡Œæ—¥å¿—</td></tr><tr><td>docker exec</td><td>è¿›å…¥å®¹å™¨</td></tr><tr><td>docker save</td><td>ä¿å­˜é•œåƒåˆ°æœ¬åœ°å‹ç¼©æ–‡ä»¶</td></tr><tr><td>docker load</td><td>åŠ è½½æœ¬åœ°å‹ç¼©æ–‡ä»¶åˆ°é•œåƒ</td></tr><tr><td>docker inspect</td><td>æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯</td></tr></tbody></table><p>Dockeræ–‡æ¡£<a href="https://docs.docker.com/">Docker Docs</a></p><img src="/2023/10/16/Docker/docker_1.png" class title="éƒ¨åˆ†æ“ä½œå›¾è§£"><h3 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h3><p>ä»¥æ‹‰å–Nginxä¸ºä¾‹:</p><p>éœ€æ±‚:</p><ul><li>åœ¨DockerHubä¸­æœç´¢Nginxé•œåƒ,æŸ¥çœ‹é•œåƒçš„åç§°</li><li>æ‹‰å–Nginxé•œåƒ</li><li>æŸ¥çœ‹æœ¬åœ°é•œåƒåˆ—è¡¨</li><li>åˆ›å»ºå¹¶è¿è¡ŒNginxå®¹å™¨</li><li>æŸ¥çœ‹å®¹å™¨</li><li>åœæ­¢å®¹å™¨</li><li>å†æ¬¡å¯åŠ¨å®¹å™¨</li><li>è¿›å…¥Nginxå®¹å™¨</li><li>åˆ é™¤å®¹å™¨</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.è®¿é—®Docker Hubæœç´¢é•œåƒ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.æ‹‰å–Nginxé•œåƒ,ä¸æŒ‡å®šç‰ˆæœ¬å³é»˜è®¤ä¸ºlatestæœ€æ–°</span></span><br><span class="line">docker pull nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.æŸ¥çœ‹æœ¬åœ°é•œåƒåˆ—è¡¨</span></span><br><span class="line">docker images</span><br><span class="line"><span class="comment"># ç»“æœå¦‚ä¸‹</span></span><br><span class="line">[root@localhost ~]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">nginx        latest    605c77e624dd   22 months ago   141MB</span><br><span class="line">mysql        latest    3218b38490ce   22 months ago   516MB</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.åˆ›å»ºå¹¶è¿è¡ŒNginxå®¹å™¨</span></span><br><span class="line">docker run -d --name nginx -p 80:80 nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.æŸ¥çœ‹å®¹å™¨</span></span><br><span class="line">docker ps</span><br><span class="line"><span class="comment"># 5.1æŸ¥çœ‹å®¹å™¨æ ¼å¼åŒ–(æ ¼å¼ä¼šæ›´åŠ æ¸…çˆ½)</span></span><br><span class="line">docker ps --format <span class="string">&quot;table &#123;&#123;.ID&#125;&#125;\t&#123;&#123;.Image&#125;&#125;\t&#123;&#123;.Ports&#125;&#125;\t&#123;&#123;.Status&#125;&#125;\t&#123;&#123;.Names&#125;&#125;&quot;</span></span><br><span class="line"><span class="comment"># ç»“æœ</span></span><br><span class="line">[root@localhost ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                   CREATED         STATUS         PORTS                               NAMES</span><br><span class="line">b83c1bfa9956   nginx     <span class="string">&quot;/docker-entrypoint.â€¦&quot;</span>   2 minutes ago   Up 2 minutes   0.0.0.0:80-&gt;80/tcp, :::80-&gt;80/tcp   nginx</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># docker ps --format &quot;table &#123;&#123;.ID&#125;&#125;\t&#123;&#123;.Image&#125;&#125;\t&#123;&#123;.Ports&#125;&#125;\t&#123;&#123;.Status&#125;&#125;\t&#123;&#123;.Names&#125;&#125;&quot;</span></span><br><span class="line">CONTAINER ID   IMAGE     PORTS                               STATUS         NAMES</span><br><span class="line">b83c1bfa9956   nginx     0.0.0.0:80-&gt;80/tcp, :::80-&gt;80/tcp   Up 2 minutes   nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.åœæ­¢å®¹å™¨</span></span><br><span class="line">docker stop nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.1æŸ¥çœ‹æ‰€æœ‰å®¹å™¨  docker ps -a</span></span><br><span class="line">docker ps -a --format <span class="string">&quot;table &#123;&#123;.ID&#125;&#125;\t&#123;&#123;.Image&#125;&#125;\t&#123;&#123;.Ports&#125;&#125;\t&#123;&#123;.Status&#125;&#125;\t&#123;&#123;.Names&#125;&#125;&quot;</span></span><br><span class="line"><span class="comment"># ç»“æœ:(åˆšåˆšåœæ­¢çš„Nginxçš„çŠ¶æ€ä¸ºExited)</span></span><br><span class="line">[root@localhost ~]<span class="comment"># docker ps -a --format &quot;table &#123;&#123;.ID&#125;&#125;\t&#123;&#123;.Image&#125;&#125;\t&#123;&#123;.Ports&#125;&#125;\t&#123;&#123;.Status&#125;&#125;\t&#123;&#123;.Names&#125;&#125;&quot;</span></span><br><span class="line">CONTAINER ID   IMAGE     PORTS                 STATUS                     NAMES</span><br><span class="line">b83c1bfa9956   nginx                           Exited (0) 3 minutes ago   nginx</span><br><span class="line">107a163cba71   mysql     3306/tcp, 33060/tcp   Created                    xenodochial_allen</span><br><span class="line">b32527ef7193   mysql                           Exited (0) 25 hours ago    mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7.å¯åŠ¨å®¹å™¨</span></span><br><span class="line">docker start nginx</span><br><span class="line"><span class="comment"># 8.è¿›å…¥å®¹å™¨,æŸ¥çœ‹å®¹å™¨å†…ç›®å½•</span></span><br><span class="line">docker <span class="built_in">exec</span> -it nginx bash <span class="comment"># ecec:æ‰§è¡Œ -it:æ¨¡æ‹Ÿå¯è¾“å…¥ç»ˆç«¯ bash:å‘½ä»¤è¡Œäº¤äº’</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 9.æŸ¥çœ‹æ—¥å¿—</span></span><br><span class="line">docker logs nginx    <span class="comment"># æŸ¥çœ‹nginxæ—¥å¿—</span></span><br><span class="line">docker logs -f nginx <span class="comment"># ä¸€ç›´æŸ¥çœ‹Nginxæ—¥å¿—</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 10.é€€å‡ºå®¹å™¨</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 11.åˆ é™¤å®¹å™¨</span></span><br><span class="line">docker <span class="built_in">rm</span> nginx <span class="comment"># åœ¨è¿è¡Œçš„å®¹å™¨åˆ é™¤ä¼šæç¤º</span></span><br><span class="line"><span class="comment"># æ— æ³•åˆ é™¤,åˆ™éœ€è¦å…ˆåœæ­¢(stopåœ¨rm),æˆ–è€…</span></span><br><span class="line">docker <span class="built_in">rm</span> -f nginx</span><br></pre></td></tr></table></figure><h3 id="å‘½ä»¤åˆ«å"><a href="#å‘½ä»¤åˆ«å" class="headerlink" title="å‘½ä»¤åˆ«å"></a>å‘½ä»¤åˆ«å</h3><p>æ¯”å¦‚åœ¨å‰é¢çš„æ¡ˆä¾‹ä¸­,æˆ‘ä»¬éœ€è¦å¯¹docker psæ˜¾ç¤ºçš„å†…å®¹è¿›è¡Œæ ¼å¼åŒ–(format),æŒ‡ä»¤è¿‡é•¿,æ¯ä¸€æ¬¡éƒ½è¦è¾“å…¥è¿™ä¹ˆå¤š,  éå¸¸éº»çƒ¦</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹/root/.bashrcæ–‡ä»¶</span></span><br><span class="line">vi /root/.bashrc</span><br><span class="line">å†…å®¹å¦‚ä¸‹ï¼š</span><br><span class="line"><span class="comment"># .bashrc</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># User specific aliases and functions</span></span><br><span class="line"> </span><br><span class="line"><span class="built_in">alias</span> <span class="built_in">rm</span>=<span class="string">&#x27;rm -i&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> <span class="built_in">cp</span>=<span class="string">&#x27;cp -i&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> <span class="built_in">mv</span>=<span class="string">&#x27;mv -i&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> dps=<span class="string">&#x27;docker ps --format &quot;table &#123;&#123;.ID&#125;&#125;\t&#123;&#123;.Image&#125;&#125;\t&#123;&#123;.Ports&#125;&#125;\t&#123;&#123;.Status&#125;&#125;\t&#123;&#123;.Names&#125;&#125;&quot;&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> dis=<span class="string">&#x27;docker images&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># Source global definitions</span></span><br><span class="line"><span class="keyword">if</span> [ -f /etc/bashrc ]; <span class="keyword">then</span></span><br><span class="line">        . /etc/bashrc</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œæ‰§è¡Œå‘½ä»¤ä½¿åˆ«åç”Ÿæ•ˆï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /root/.bashrc</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥å½“æˆ‘ä»¬è®¾ç½®äº†è¿™ä¸ª,  å¦‚æœéœ€è¦æŸ¥çœ‹é•œåƒçš„æƒ…å†µ,  åˆ™å¯ä»¥ä½¿ç”¨dpsæ ¼å¼åŒ–åˆ«åæŒ‡ä»¤</p><h2 id="æ•°æ®å·"><a href="#æ•°æ®å·" class="headerlink" title="æ•°æ®å·"></a>æ•°æ®å·</h2><p>å®¹å™¨æ˜¯éš”ç¦»ç¯å¢ƒï¼Œå®¹å™¨å†…ç¨‹åºçš„æ–‡ä»¶ã€é…ç½®ã€è¿è¡Œæ—¶äº§ç”Ÿçš„å®¹å™¨éƒ½åœ¨å®¹å™¨å†…éƒ¨ï¼Œæˆ‘ä»¬è¦è¯»å†™å®¹å™¨å†…çš„æ–‡ä»¶éå¸¸ä¸æ–¹ä¾¿  (æ¯”å¦‚æˆ‘ä»¬è¿›å…¥åˆ°å®¹å™¨ä¸­ä½¿ç”¨viæŒ‡ä»¤ä¿®æ”¹index.htmlä¼šæç¤ºæ²¡æœ‰æŒ‡ä»¤).</p><p><strong>æ•°æ®å·ï¼ˆvolumeï¼‰</strong>æ˜¯ä¸€ä¸ªè™šæ‹Ÿç›®å½•ï¼Œæ˜¯<strong>å®¹å™¨å†…ç›®å½•</strong>ä¸<strong>å®¿ä¸»æœºç›®å½•</strong>ä¹‹é—´æ˜ å°„çš„æ¡¥æ¢</p><p>ä»¥Nginxä¸ºä¾‹,ä¼—æ‰€å‘¨çŸ¥</p><ul><li>html: æ”¾é™æ€èµ„æº</li><li>conf: æ”¾é…ç½®æ–‡ä»¶</li></ul><p>å¦‚æœæˆ‘ä»¬è¦è®©Nginxä»£ç†æˆ‘ä»¬çš„é™æ€èµ„æºï¼Œæœ€å¥½æ˜¯æ”¾åˆ°<code>html</code>ç›®å½•ï¼›å¦‚æœæˆ‘ä»¬è¦ä¿®æ”¹Nginxçš„é…ç½®ï¼Œæœ€å¥½æ˜¯æ‰¾åˆ°<code>conf</code>ä¸‹çš„<code>nginx.conf</code>æ–‡ä»¶</p><p>ä½†æ˜¯éå¸¸é—æ†¾çš„ä¸€ç‚¹æ˜¯,  ä¸èƒ½ç›´æ¥å»ä¿®æ”¹å®ƒ(åŸå®¹å™¨), å®¹å™¨è¿è¡Œçš„Nginxæ‰€æœ‰çš„æ–‡ä»¶éƒ½åœ¨å®¹å™¨å†…éƒ¨ã€‚æ‰€ä»¥æˆ‘ä»¬å¿…é¡»åˆ©ç”¨æ•°æ®å·å°†ä¸¤ä¸ªç›®å½•ä¸å®¿ä¸»æœºç›®å½•å…³è”ï¼Œæ–¹ä¾¿æˆ‘ä»¬æ“ä½œã€‚å¦‚å›¾ï¼š</p><img src="/2023/10/16/Docker/docker_2.png" class title="ä»¥Nginxä¸ºä¾‹çš„æ•°æ®å·"><p>ä¸Šå›¾è§£ç­”:</p><p>æˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªæ•°æ®å·htmlå’Œconf</p><p>å…¶ä¸­htmlå¯¹åº”nginxå®¹å™¨ä¸­çš„&#x2F;html,  é€šè¿‡æ•°æ®å·æŒ‡å‘äº†å®¿ä¸»æœºä¸­çš„æ–‡ä»¶&#x2F;html,  _dataæ˜¯ç”¨æ¥å­˜æ”¾æ•°æ®è‡ªåŠ¨åˆ›å»ºçš„,  è¿™æ ·ä¸€æ¥å®¹å™¨å’Œå®¿ä¸»æœºå°±è¢«<wavy>å…³è”</wavy>èµ·æ¥äº†äº†,  ç§°ä¹‹ä¸º<span class="p red">æŒ‚è½½</span></p><p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨å®¿ä¸»æœºä¸­çš„ &#x2F;var&#x2F;lib&#x2F;docker&#x2F;volumes&#x2F;html&#x2F;_data å­˜æ”¾èµ„æº,  é‚£ä¹ˆå®¹å™¨ä¸­çš„æ•°æ®ä¹Ÿä¼šè¢«å®¹å™¨ç›¸å¯¹åº”çš„ç›®å½•æ‰€æ˜ å°„</p><p>å½“å‰æ“ä½œä¸º  <span class="p red">åŒå‘ç»‘å®š</span>,  å®¿ä¸»æœºè‡ªåŠ¨æ˜ å°„åˆ°å®¹å™¨</p><p>&#x2F;var&#x2F;lib&#x2F;docker&#x2F;volumesç›®å½•ä¸ºé»˜è®¤å­˜æ”¾æ‰€æœ‰å®¹å™¨æ•°æ®å·çš„ç›®å½•,  åœ¨ä¸‹æ ¹æ®æ•°æ®å·çš„åç§°åˆ›å»ºæ–°ç›®å½•,  ä¾‹å¦‚:  &#x2F;æ•°æ®å·åç§°&#x2F;_data</p><h3 id="æ•°æ®å·å‘½ä»¤"><a href="#æ•°æ®å·å‘½ä»¤" class="headerlink" title="æ•°æ®å·å‘½ä»¤"></a>æ•°æ®å·å‘½ä»¤</h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>docker volume create</td><td>åˆ›å»ºæ•°æ®å·</td></tr><tr><td>docker volume ls</td><td>æŸ¥çœ‹æ‰€æœ‰æ•°æ®å·</td></tr><tr><td>docker volume rm</td><td>åˆ é™¤æŒ‡å®šæ•°æ®å·</td></tr><tr><td>docker volume inspect</td><td>æŸ¥çœ‹æŸä¸ªæ•°æ®å·çš„è¯¦æƒ…</td></tr><tr><td>docker volume prune</td><td>æ¸…é™¤æ•°æ®å·</td></tr></tbody></table><p>Dockeræ–‡æ¡£<a href="https://docs.docker.com/">Docker Docs</a></p><p><strong>æ³¨æ„ï¼š</strong>å®¹å™¨ä¸æ•°æ®å·çš„æŒ‚è½½è¦åœ¨åˆ›å»ºå®¹å™¨æ—¶é…ç½®ï¼Œå¯¹äºåˆ›å»ºå¥½çš„å®¹å™¨ï¼Œæ˜¯ä¸èƒ½è®¾ç½®æ•°æ®å·çš„ã€‚è€Œä¸”<strong>åˆ›å»ºå®¹å™¨çš„è¿‡ç¨‹ä¸­ï¼Œæ•°æ®å·ä¼šè‡ªåŠ¨åˆ›å»º</strong>ã€‚</p><h3 id="æ¡ˆä¾‹-1"><a href="#æ¡ˆä¾‹-1" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h3><p>éœ€æ±‚;</p><ul><li>åˆ›å»ºNginxå®¹å™¨,  ä¿®æ”¹nginxå®¹å™¨å†…çš„htmlç›®å½•ä¸‹çš„index.htmlæ–‡ä»¶å†…å®¹</li><li>å°†é™æ€èµ„æºéƒ¨ç½²åˆ°nginxçš„htmlç›®å½•</li></ul><blockquote><p>æç¤º: åœ¨æ‰§è¡Œdocker run å‘½ä»¤æ—¶,  ä½¿ç”¨ <span class="p red">-v æ•°æ®å·:å®¹å™¨å†…ç›®å½•</span>   å¯ä»¥å®Œæˆæ•°æ®å·æŒ‚è½½</p><p>å½“åˆ›å»ºå®¹å™¨æ—¶,  å¦‚æœæŒ‚è½½äº†æ•°æ®å·ä¸”æ•°æ®å·ä¸å­˜åœ¨,  åˆ™ä¼šè‡ªåŠ¨åˆ›å»ºæ•°æ®å·</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.é¦–å…ˆåˆ›å»ºå®¹å™¨å¹¶æŒ‡å®šæ•°æ®å·ï¼Œæ³¨æ„é€šè¿‡ -v å‚æ•°æ¥æŒ‡å®šæ•°æ®å·</span></span><br><span class="line">docker run -d --name nginx -p 80:80 -v html:/usr/share/nginx/html nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.ç„¶åæŸ¥çœ‹æ•°æ®å·</span></span><br><span class="line">docker volume <span class="built_in">ls</span></span><br><span class="line"><span class="comment"># ç»“æœ</span></span><br><span class="line">[root@localhost ~]<span class="comment"># docker volume ls</span></span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line"><span class="built_in">local</span>     a8bcfc131404273c3d5a5a450fbcc270dbf414d1367648190e864eebfc7802ad</span><br><span class="line"><span class="built_in">local</span>     html    <span class="comment"># åˆšåˆšåˆ›å»ºçš„å·åœ¨è¿™</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.æŸ¥çœ‹æ•°æ®å·è¯¦æƒ…</span></span><br><span class="line">docker volume inspect html</span><br><span class="line"><span class="comment"># ç»“æœ</span></span><br><span class="line">[root@localhost ~]<span class="comment"># docker volume inspect html</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;CreatedAt&quot;</span>: <span class="string">&quot;2023-11-05T21:18:52+08:00&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Labels&quot;</span>: null,</span><br><span class="line">        <span class="string">&quot;Mountpoint&quot;</span>: <span class="string">&quot;/var/lib/docker/volumes/html/_data&quot;</span>, <span class="comment"># å®¿ä¸»æœºä½ç½®(æ˜ å°„)</span></span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;html&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Options&quot;</span>: null,</span><br><span class="line">        <span class="string">&quot;Scope&quot;</span>: <span class="string">&quot;local&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.æŸ¥çœ‹/var/lib/docker/volumes/html/_dataç›®å½•</span></span><br><span class="line">[root@localhost ~]<span class="comment"># ll /var/lib/docker/volumes/html/_data</span></span><br><span class="line">æ€»ç”¨é‡ 8</span><br><span class="line">-rw-r--r--. 1 root root 497 12æœˆ 28 2021 50x.html</span><br><span class="line">-rw-r--r--. 1 root root 615 12æœˆ 28 2021 index.html</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.è¿›å…¥è¯¥ç›®å½•ï¼Œå¹¶éšæ„ä¿®æ”¹index.htmlå†…å®¹</span></span><br><span class="line">[root@localhost ~]<span class="comment"># cd /var/lib/docker/volumes/html/_data</span></span><br><span class="line"><span class="comment">#ä¿®æ”¹</span></span><br><span class="line">[root@localhost _data]<span class="comment"># vi index.html  </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.è¿›å…¥å®¹å™¨å†…éƒ¨ï¼ŒæŸ¥çœ‹/usr/share/nginx/htmlç›®å½•å†…çš„æ–‡ä»¶æ˜¯å¦å˜åŒ–</span></span><br><span class="line">docker <span class="built_in">exec</span> -it nginx bash</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /usr/share/nginx/html</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸æŒ‡å®šæŒ‚è½½ç›®å½•ï¼Œè‡ªåŠ¨ä¼šä¸ºä½ æŒ‚è½½åˆ°&#x2F;usr&#x2F;libä¸‹</p><h3 id="æŒ‚è½½æœ¬åœ°ç›®å½•æˆ–æ–‡ä»¶"><a href="#æŒ‚è½½æœ¬åœ°ç›®å½•æˆ–æ–‡ä»¶" class="headerlink" title="æŒ‚è½½æœ¬åœ°ç›®å½•æˆ–æ–‡ä»¶"></a>æŒ‚è½½æœ¬åœ°ç›®å½•æˆ–æ–‡ä»¶</h3><p>æ•°æ®å·çš„ç›®å½•ç»“æ„è¾ƒæ·±ï¼Œå¦‚æœæˆ‘ä»¬å»æ“ä½œæ•°æ®å·ç›®å½•ä¼šä¸å¤ªæ–¹ä¾¿ã€‚åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šç›´æ¥å°†å®¹å™¨ç›®å½•ä¸å®¿ä¸»æœºæŒ‡å®šç›®å½•æŒ‚è½½ã€‚æŒ‚è½½è¯­æ³•ä¸æ•°æ®å·ç±»ä¼¼ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŒ‚è½½æœ¬åœ°ç›®å½•</span></span><br><span class="line">-v æœ¬åœ°ç›®å½•:å®¹å™¨å†…ç›®å½•</span><br><span class="line"><span class="comment"># æŒ‚è½½æœ¬åœ°æ–‡ä»¶</span></span><br><span class="line">-v æœ¬åœ°æ–‡ä»¶:å®¹å™¨å†…æ–‡ä»¶</span><br></pre></td></tr></table></figure><span class="p red">æ³¨æ„:</span> æœ¬åœ°ç›®å½•æˆ–æ–‡ä»¶å¿…é¡»ä»¥ `/` æˆ– `./`å¼€å¤´ï¼Œå¦‚æœç›´æ¥ä»¥åå­—å¼€å¤´ï¼Œä¼šè¢«è¯†åˆ«ä¸ºæ•°æ®å·åè€Œéæœ¬åœ°ç›®å½•åã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-v mysql:/var/lib/mysql <span class="comment"># ä¼šè¢«è¯†åˆ«ä¸ºä¸€ä¸ªæ•°æ®å·å«mysqlï¼Œè¿è¡Œæ—¶ä¼šè‡ªåŠ¨åˆ›å»ºè¿™ä¸ªæ•°æ®å·</span></span><br><span class="line">-v ./mysql:/var/lib/mysql <span class="comment"># ä¼šè¢«è¯†åˆ«ä¸ºå½“å‰ç›®å½•ä¸‹çš„mysqlç›®å½•ï¼Œè¿è¡Œæ—¶å¦‚æœä¸å­˜åœ¨ä¼šåˆ›å»ºç›®å½•</span></span><br></pre></td></tr></table></figure><p>æ¡ˆä¾‹éœ€æ±‚:</p><ul><li>æŒ‚è½½<code>/root/mysql/data</code>åˆ°å®¹å™¨å†…çš„<code>/var/lib/mysql</code>ç›®å½•</li><li>æŒ‚è½½<code>/root/mysql/init</code>åˆ°å®¹å™¨å†…çš„<code>/docker-entrypoint-initdb.d</code>ç›®å½•ï¼ˆåˆå§‹åŒ–çš„SQLè„šæœ¬ç›®å½• â€”&gt; åªæœ‰ç¬¬ä¸€æ¬¡æ‰ç”Ÿæ•ˆï¼‰</li><li>æŒ‚è½½<code>/root/mysql/conf</code>åˆ°å®¹å™¨å†…çš„<code>/etc/mysql/conf.d</code>ç›®å½•ï¼ˆè¿™ä¸ªæ˜¯MySQLé…ç½®æ–‡ä»¶ç›®å½•ï¼‰</li></ul><blockquote><p> è§£é‡Š: initä¸ºSQLè„šæœ¬åˆå§‹åŒ–,  confä¸ºé…ç½®æ–‡ä»¶,  å…¶ä¸­é…ç½®æ–‡ä»¶ä¸»è¦æ˜¯é…ç½®ä¸€äº›MySQLé»˜è®¤ç¼–ç ,  utf8mb4</p></blockquote><p>æˆ‘ä»¬åœ¨è™šæ‹Ÿæœºåˆ›å»ºå¯¹åº”çš„ç›®å½•,data,  init,  conf</p><p>æœ¬åœ°ç›®å½•æŒ‚è½½:(å…³äºMySQLçš„æŒ‚è½½è¯¦æƒ…ç›´è¾¾<a href="https://hub.docker.com/_/mysql">MySQL Image | Docker Hub</a>)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.åˆ é™¤åŸæ¥çš„MySQLå®¹å™¨</span></span><br><span class="line">docker <span class="built_in">rm</span> -f mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.è¿›å…¥rootç›®å½•(:éœ€è¦è®¾ç½®æŒ‚è½½çš„ç›®å½•,æå‰åˆ›å»ºå¥½æŒ‚è½½ç›®å½•)</span></span><br><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.åˆ›å»ºå¹¶è¿è¡Œæ–°çš„MySQLå®¹å™¨,å¹¶ä¸”æŒ‚è½½(-v)åˆ°æœ¬åœ°ç›®å½•</span></span><br><span class="line"><span class="comment"># å½“å‰ä½¿ç”¨çš„è·¯å¾„ä¸ºå…¨è·¯å¾„ /root/mysql, ä¹Ÿå¯ä»¥./root/mysql</span></span><br><span class="line">docker run -d \</span><br><span class="line">--name mysql \</span><br><span class="line">-p 3306:3306 \</span><br><span class="line">    -e TZ=Asia/Shanghai \</span><br><span class="line">    -e MYSQL_ROOT_PASSWORD=123456 \</span><br><span class="line">    -v /root/mysql/data:/var/lib/mysql \</span><br><span class="line">    -v /root/mysql/conf:/etc/mysql/conf.d \</span><br><span class="line">    -v /root/mysql/init:/docker-entrypoint-initdb.d \</span><br><span class="line">mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.æŸ¥çœ‹MySQLå®¹å™¨å†…æ•°æ®</span></span><br><span class="line"><span class="comment"># æŸ¥çœ‹dataç›®å½•ï¼Œä¼šå‘ç°é‡Œé¢æœ‰å¤§é‡æ•°æ®åº“æ•°æ®ï¼Œè¯´æ˜æ•°æ®åº“å®Œæˆäº†åˆå§‹åŒ–</span></span><br><span class="line"><span class="built_in">ls</span> -l data</span><br><span class="line"><span class="comment"># 4.1 è¿›å…¥MySQL</span></span><br><span class="line">docker <span class="built_in">exec</span> -it mysql bash</span><br><span class="line"><span class="comment"># 4.2 ç™»å½•mysql</span></span><br><span class="line"><span class="comment"># 4.3 æŸ¥çœ‹ç¼–ç è¡¨</span></span><br><span class="line">show variables like <span class="string">&quot;%char%&quot;</span></span><br><span class="line"><span class="comment"># ç»“æœ,å‘ç°ç¼–ç æ˜¯é¢„è®¾çš„utf8mb4æ²¡æœ‰é—®é¢˜</span></span><br><span class="line">+--------------------------+--------------------------------+</span><br><span class="line">| Variable_name            | Value                          |</span><br><span class="line">+--------------------------+--------------------------------+</span><br><span class="line">| character_set_client     | utf8mb4                        |</span><br><span class="line">| character_set_connection | utf8mb4                        |</span><br><span class="line">| character_set_database   | utf8mb4                        |</span><br><span class="line">| character_set_filesystem | binary                         |</span><br><span class="line">| character_set_results    | utf8mb4                        |</span><br><span class="line">| character_set_server     | utf8mb4                        |</span><br><span class="line">| character_set_system     | utf8mb3                        |</span><br><span class="line">| character_sets_dir       | /usr/share/mysql-8.0/charsets/ |</span><br><span class="line">+--------------------------+--------------------------------+</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.æŸ¥çœ‹æ•°æ®(å…¶å®å°±æ˜¯SQLè¯­è¨€äº†)</span></span><br></pre></td></tr></table></figure><h2 id="é•œåƒ"><a href="#é•œåƒ" class="headerlink" title="é•œåƒ"></a>é•œåƒ</h2><p>åœ¨è¿™ä¹‹å‰,  å‰é¢éƒ½æ˜¯pullåˆ«äººçš„é•œåƒ,  å¦‚æœæˆ‘ä¹Ÿéœ€è¦éƒ¨ç½²ä¸€ä¸ªè‡ªå·±çš„é•œåƒ,  é‚£ä¹ˆè¯¥æ€ä¹ˆåšå‘¢?</p><h3 id="é•œåƒç»“æ„"><a href="#é•œåƒç»“æ„" class="headerlink" title="é•œåƒç»“æ„"></a>é•œåƒç»“æ„</h3><p>åœ¨æ„å»ºé•œåƒä¹‹å‰,  æˆ‘ä»¬éœ€è¦å…ˆäº†è§£é•œåƒçš„ç»“æœ.</p><p>é•œåƒä¹‹æ‰€ä»¥å¯ä»¥è®©æˆ‘ä»¬<span class="p red">å¿«é€Ÿ</span>è·¨æ“ä½œç³»ç»Ÿéƒ¨ç½²åº”ç”¨è€Œå¿½ç•¥å…¶è¿è¡Œç¯å¢ƒã€é…ç½®ï¼Œå°±æ˜¯å› ä¸ºé•œåƒä¸­åŒ…å«äº†ç¨‹åºè¿è¡Œéœ€è¦çš„ç³»ç»Ÿå‡½æ•°åº“ã€ç¯å¢ƒã€é…ç½®ã€ä¾èµ–ã€‚</p><p>æ‰€ä»¥ä¸å®¹æ˜“çœ‹å‡º,  è‡ªå®šä¹‰é•œåƒçš„æœ¬è´¨å°±æ˜¯ä¾æ¬¡å‡†å¤‡å¥½ç¨‹åºè¿è¡Œçš„åŸºç¡€ç¯å¢ƒã€ä¾èµ–ã€åº”ç”¨æœ¬èº«ã€è¿è¡Œé…ç½®ç­‰æ–‡ä»¶ï¼Œå¹¶ä¸”æ‰“åŒ…è€Œæˆ</p><p>é•œåƒæ˜¯ç”±<strong>å±‚çº§ç»“æ„</strong>ç»„æˆ: (åœ¨æˆ‘ä»¬pullé•œåƒçš„æ—¶å€™å°±ä¸éš¾çœ‹å‡º)</p><img src="/2023/10/16/Docker/mirror.png" class title="é•œåƒå±‚çº§ç»“æ„"><h3 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h3><p>Dockerfileå°±æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶,  å…¶ä¸­åŒ…å«äº†ä¸€ä¸ªä¸ªçš„<strong>æŒ‡ä»¤(Instruction)</strong>,  ç”¨æŒ‡ä»¤æ¥è¯´æ˜è¦æ‰§è¡Œä»€ä¹ˆæ“ä½œæ¥æ„å»ºé•œåƒã€‚å°†æ¥Dockerå¯ä»¥æ ¹æ®Dockerfileæ¥å¸®æˆ‘ä»¬æ„å»ºé•œåƒã€‚å¸¸è§æŒ‡ä»¤å¦‚ä¸‹:</p><table><thead><tr><th>æŒ‡ä»¤</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><strong>FROM</strong></td><td>æŒ‡å®šåŸºç¡€é•œåƒ</td><td>from centos:6</td></tr><tr><td><strong>ENV</strong></td><td>è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œå¯åœ¨åé¢æŒ‡ä»¤ä½¿ç”¨</td><td>enu alue</td></tr><tr><td><strong>COPY</strong></td><td>æ‹·è´æœ¬åœ°æ–‡ä»¶åˆ°é•œåƒçš„æŒ‡å®šç›®å½•</td><td>copy .&#x2F;xx.jar &#x2F;tmp&#x2F;app.jar</td></tr><tr><td><strong>RUN</strong></td><td>æ‰§è¡ŒLinuxçš„shellå‘½ä»¤ï¼Œä¸€èˆ¬æ˜¯å®‰è£…è¿‡ç¨‹çš„å‘½ä»¤</td><td>run yum install gcc</td></tr><tr><td><strong>EXPOSE</strong></td><td>æŒ‡å®šå®¹å™¨è¿è¡Œæ—¶ç›‘å¬çš„ç«¯å£ï¼Œæ˜¯ç»™é•œåƒä½¿ç”¨è€…çœ‹çš„</td><td>expose 8080</td></tr><tr><td><strong>ENTRYPOINT</strong></td><td>é•œåƒä¸­åº”ç”¨çš„å¯åŠ¨å‘½ä»¤ï¼Œå®¹å™¨è¿è¡Œæ—¶è°ƒç”¨</td><td>entrypoint java -jar xx.jar</td></tr></tbody></table><p>æ›´å¤šè¯¦ç»†è¯­æ³•,  è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ <a href="https://docs.docker.com/engine/reference/builder/">Dockerfile reference | Docker Docs</a></p><p>ä¾‹å¦‚éœ€è¦åŸºäºUbuntuæ„å»ºä¸€ä¸ªJavaåº”ç”¨,  å…¶ä¸­Dockerfileå†…å®¹å¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŒ‡å®šåŸºç¡€é•œåƒ</span></span><br><span class="line">FROM ubuntu:16.04</span><br><span class="line"><span class="comment"># é…ç½®ç¯å¢ƒå˜é‡ï¼ŒJDKçš„å®‰è£…ç›®å½•ã€å®¹å™¨å†…æ—¶åŒº</span></span><br><span class="line">ENV JAVA_DIR=/usr/local</span><br><span class="line">ENV TZ=Asia/Shanghai</span><br><span class="line"><span class="comment"># æ‹·è´jdkå’Œjavaé¡¹ç›®çš„åŒ…</span></span><br><span class="line">COPY ./jdk8.tar.gz <span class="variable">$JAVA_DIR</span>/</span><br><span class="line">COPY ./docker-demo.jar /tmp/app.jar</span><br><span class="line"><span class="comment"># è®¾å®šæ—¶åŒº</span></span><br><span class="line">RUN <span class="built_in">ln</span> -snf /usr/share/zoneinfo/<span class="variable">$TZ</span> /etc/localtime &amp;&amp; <span class="built_in">echo</span> <span class="variable">$TZ</span> &gt; /etc/timezone</span><br><span class="line"><span class="comment"># å®‰è£…JDK</span></span><br><span class="line">RUN <span class="built_in">cd</span> <span class="variable">$JAVA_DIR</span> \</span><br><span class="line"> &amp;&amp; tar -xf ./jdk8.tar.gz \</span><br><span class="line"> &amp;&amp; <span class="built_in">mv</span> ./jdk1.8.0_144 ./java8</span><br><span class="line"><span class="comment"># é…ç½®ç¯å¢ƒå˜é‡</span></span><br><span class="line">ENV JAVA_HOME=<span class="variable">$JAVA_DIR</span>/java8</span><br><span class="line">ENV PATH=<span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin</span><br><span class="line"><span class="comment"># æŒ‡å®šé¡¹ç›®ç›‘å¬çš„ç«¯å£</span></span><br><span class="line">EXPOSE 8080</span><br><span class="line"><span class="comment"># å…¥å£ï¼Œjavaé¡¹ç›®çš„å¯åŠ¨å‘½ä»¤</span></span><br><span class="line">ENTRYPOINT [<span class="string">&quot;java&quot;</span>, <span class="string">&quot;-jar&quot;</span>, <span class="string">&quot;/app.jar&quot;</span>]</span><br></pre></td></tr></table></figure><p>å¯¹äºJDKé•œåƒé…ç½®,  æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åˆ«äººæä¾›çš„JDKåŸºç¡€é•œåƒ,  ç®€åŒ–Dockerfile</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŸºç¡€é•œåƒ</span></span><br><span class="line">FROM openjdk:11.0-jre-buster   <span class="comment"># çœå»JDké…ç½®</span></span><br><span class="line"><span class="comment"># è®¾å®šæ—¶åŒº</span></span><br><span class="line">ENV TZ=Asia/Shanghai</span><br><span class="line">RUN <span class="built_in">ln</span> -snf /usr/share/zoneinfo/<span class="variable">$TZ</span> /etc/localtime &amp;&amp; <span class="built_in">echo</span> <span class="variable">$TZ</span> &gt; /etc/timezone</span><br><span class="line"><span class="comment"># æ‹·è´jaråŒ…</span></span><br><span class="line">COPY docker-demo.jar /app.jar</span><br><span class="line"><span class="comment"># å…¥å£</span></span><br><span class="line">ENTRYPOINT [<span class="string">&quot;java&quot;</span>, <span class="string">&quot;-jar&quot;</span>, <span class="string">&quot;/app.jar&quot;</span>]</span><br></pre></td></tr></table></figure><p>æœ€åç›¸å¯¹äºä¸Šé¢é‚£ä¸ª, ä¸‹é¢è¿™ä¸ªç®€æ´äº†å¾ˆå¤šäº†</p><h3 id="æ„å»ºé•œåƒ"><a href="#æ„å»ºé•œåƒ" class="headerlink" title="æ„å»ºé•œåƒ"></a>æ„å»ºé•œåƒ</h3><p>å½“Dockerfileç¼–å†™å¥½ä¹‹å,  å°±å¯ä»¥ä½¿ç”¨å‘½ä»¤æ¥æ„å»ºé•œåƒäº†,  ä¾‹å¦‚åœ¨å½“å‰ç›®å½•ä¸‹å‡†å¤‡å¥½äº†ä¸€ä¸ª<code>Dockerfile</code>æ–‡ä»¶å’Œ<code>ClickCount.jar</code>é¡¹ç›®jaråŒ…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥å­˜æ”¾æ–‡ä»¶çš„ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /root/demo</span><br><span class="line"><span class="comment"># å¼€å§‹æ„å»º</span></span><br><span class="line">docker build -t click:1.0 .</span><br></pre></td></tr></table></figure><p>å‘½ä»¤è¯´æ˜:</p><ul><li><code>docker build</code>: æ„å»ºä¸€ä¸ªdockeré•œåƒ</li><li><code>-t</code>:æ˜¯ç»™é•œåƒèµ·å, æ ¼å¼ä¸€äººæ’’repository:tagçš„æ ¼å¼, å¦‚æœä¸æŒ‡å®štag,åˆ™é»˜è®¤ä¸ºlatest</li><li><code>.</code>:æœ€åçš„ç‚¹ä»£è¡¨å½“å‰ç›®å½•(Dockerfileæ‰€åœ¨ç›®å½•),  ä¹Ÿå¯ä»¥æŒ‡å®šå…¶ä»–ç›®å½•çš„Dockerfile</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¾‹å¦‚æŒ‡å®š/root/dockerfile_demoç›®å½•</span></span><br><span class="line">docker build -t click:1.0 /root/dockerfile_dem</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹é•œåƒåˆ—è¡¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹é•œåƒåˆ—è¡¨ï¼š</span></span><br><span class="line">docker images</span><br><span class="line"><span class="comment"># ç»“æœ</span></span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">click      1.0       d6ab0b9e64b9   10 minutes ago   89MB</span><br><span class="line">nginx         latest    605c77e624dd   16 months ago    141MB</span><br><span class="line">mysql         latest    3218b38490ce   17 months ago    517MB</span><br></pre></td></tr></table></figure><h2 id="ç½‘ç»œ"><a href="#ç½‘ç»œ" class="headerlink" title="ç½‘ç»œ"></a>ç½‘ç»œ</h2><p>åœ¨ä¸Šé¢çš„æ¡ˆä¾‹,  æˆ‘ä»¬å·²ç»åˆ›å»ºäº†Javaé¡¹ç›®çš„å®¹å™¨,  å…¶ä¸­å¾€å¾€Javaé¡¹ç›®éœ€è¦è®¿é—®å…¶ä»–å®¹å™¨ä¸­é—´ä»¶(MySQL,Redisç­‰),  ä»–ä»¬éœ€è¦è®¿é—®åˆ™éœ€è¦é€šè¿‡ç½‘ç»œ</p><p>é»˜è®¤æƒ…å†µä¸‹,  æ‰€æœ‰å®¹å™¨éƒ½æ˜¯ä»¥bridge(ç½‘æ¡¥)æ–¹å¼è¿æ¥åˆ°Dockerçš„ä¸€ä¸ªè™šæ‹Ÿç½‘æ¡¥ä¸Š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.ç”¨åŸºæœ¬å‘½ä»¤ï¼Œå¯»æ‰¾Networks.bridge.IPAddresså±æ€§</span></span><br><span class="line">docker inspect mysql</span><br><span class="line"><span class="comment"># ä¹Ÿå¯ä»¥ä½¿ç”¨formatè¿‡æ»¤ç»“æœ</span></span><br><span class="line">docker inspect --format=<span class="string">&#x27;&#123;&#123;range .NetworkSettings.Networks&#125;&#125;&#123;&#123;println .IPAddress&#125;&#125;&#123;&#123;end&#125;&#125;&#x27;</span> mysql</span><br><span class="line"><span class="comment"># å¾—åˆ°IPåœ°å€å¦‚ä¸‹ï¼š</span></span><br><span class="line">172.17.0.2</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 2.ç„¶åé€šè¿‡å‘½ä»¤è¿›å…¥ddå®¹å™¨</span></span><br><span class="line">docker <span class="built_in">exec</span> -it <span class="built_in">dd</span> bash</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 3.åœ¨å®¹å™¨å†…ï¼Œé€šè¿‡pingå‘½ä»¤æµ‹è¯•ç½‘ç»œ</span></span><br><span class="line">ping 172.17.0.2</span><br><span class="line"><span class="comment"># ç»“æœ</span></span><br><span class="line">PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.053 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=2 ttl=64 time=0.059 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=3 ttl=64 time=0.058 ms</span><br></pre></td></tr></table></figure><p>å‘ç°Pingé€š,  å¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜</p><p>ä½†æ˜¯ï¼Œå®¹å™¨çš„ç½‘ç»œIPå…¶å®æ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„IPï¼Œå…¶å€¼å¹¶ä¸å›ºå®šä¸æŸä¸€ä¸ªå®¹å™¨ç»‘å®šï¼Œå¦‚æœæˆ‘ä»¬åœ¨å¼€å‘æ—¶å†™æ­»æŸä¸ªIPï¼Œè€Œåœ¨éƒ¨ç½²æ—¶å¾ˆå¯èƒ½MySQLå®¹å™¨çš„IPä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿æ¥ä¼šå¤±è´¥</p><p>å®˜æ–¹æ–‡æ¡£<a href="https://docs.docker.com/engine/reference/commandline/network/">docker network | Docker Docs</a></p><p>å¸¸è§ç½‘ç»œå‘½ä»¤æœ‰:</p><table><thead><tr><th><strong>å‘½ä»¤</strong></th><th><strong>è¯´æ˜</strong></th><th><strong>æ–‡æ¡£åœ°å€</strong></th></tr></thead><tbody><tr><td>docker network create</td><td>åˆ›å»ºä¸€ä¸ªç½‘ç»œ</td><td><a href="https://docs.docker.com/engine/reference/commandline/network_create/">docker network create</a></td></tr><tr><td>docker network ls</td><td>æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œ</td><td><a href="https://docs.docker.com/engine/reference/commandline/network_ls/">docs.docker.com</a></td></tr><tr><td>docker network rm</td><td>åˆ é™¤æŒ‡å®šç½‘ç»œ</td><td><a href="https://docs.docker.com/engine/reference/commandline/network_rm/">docs.docker.com</a></td></tr><tr><td>docker network prune</td><td>æ¸…é™¤æœªä½¿ç”¨çš„ç½‘ç»œ</td><td><a href="https://docs.docker.com/engine/reference/commandline/network_prune/">docs.docker.com</a></td></tr><tr><td>docker network connect</td><td>ä½¿æŒ‡å®šå®¹å™¨è¿æ¥åŠ å…¥æŸç½‘ç»œ</td><td><a href="https://docs.docker.com/engine/reference/commandline/network_connect/">docs.docker.com</a></td></tr><tr><td>docker network disconnect</td><td>ä½¿æŒ‡å®šå®¹å™¨è¿æ¥ç¦»å¼€æŸç½‘ç»œ</td><td><a href="https://docs.docker.com/engine/reference/commandline/network_disconnect/">docker network disconnect</a></td></tr><tr><td>docker network inspect</td><td>æŸ¥çœ‹ç½‘ç»œè¯¦ç»†ä¿¡æ¯</td><td><a href="https://docs.docker.com/engine/reference/commandline/network_inspect/">docker network inspect</a></td></tr></tbody></table><h3 id="è‡ªå®šä¹‰ç½‘ç»œ"><a href="#è‡ªå®šä¹‰ç½‘ç»œ" class="headerlink" title="è‡ªå®šä¹‰ç½‘ç»œ"></a>è‡ªå®šä¹‰ç½‘ç»œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.é¦–å…ˆé€šè¿‡å‘½ä»¤åˆ›å»ºä¸€ä¸ªç½‘ç»œ</span></span><br><span class="line">docker network create qlh</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 2.ç„¶åæŸ¥çœ‹ç½‘ç»œ</span></span><br><span class="line">docker network <span class="built_in">ls</span></span><br><span class="line"><span class="comment"># ç»“æœï¼š</span></span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">e070f0159014   bridge    bridge    <span class="built_in">local</span></span><br><span class="line">cfb0c477c4dc   host      host      <span class="built_in">local</span></span><br><span class="line">9393a7da1c50   none      null      <span class="built_in">local</span></span><br><span class="line">f5084a25485a   qlh       bridge    <span class="built_in">local</span></span><br><span class="line"><span class="comment"># å…¶ä¸­ï¼Œé™¤äº†qlhä»¥å¤–ï¼Œå…¶å®ƒéƒ½æ˜¯é»˜è®¤çš„ç½‘ç»œ</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 3.è®©ddå’Œmysqléƒ½åŠ å…¥è¯¥ç½‘ç»œï¼Œæ³¨æ„ï¼Œåœ¨åŠ å…¥ç½‘ç»œæ—¶å¯ä»¥é€šè¿‡--aliasç»™å®¹å™¨èµ·åˆ«å</span></span><br><span class="line"><span class="comment"># è¿™æ ·è¯¥ç½‘ç»œå†…çš„å…¶å®ƒå®¹å™¨å¯ä»¥ç”¨åˆ«åäº’ç›¸è®¿é—®ï¼</span></span><br><span class="line"><span class="comment"># 3.1.mysqlå®¹å™¨ï¼ŒæŒ‡å®šåˆ«åä¸ºdbï¼Œå¦å¤–æ¯ä¸€ä¸ªå®¹å™¨éƒ½æœ‰ä¸€ä¸ªåˆ«åæ˜¯å®¹å™¨å</span></span><br><span class="line">docker network connect qlh mysql --<span class="built_in">alias</span> db</span><br><span class="line"><span class="comment"># 3.2.dbå®¹å™¨ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„javaé¡¹ç›®</span></span><br><span class="line">docker network connect qlh <span class="built_in">dd</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 4.è¿›å…¥ddå®¹å™¨ï¼Œå°è¯•åˆ©ç”¨åˆ«åè®¿é—®db</span></span><br><span class="line"><span class="comment"># 4.1.è¿›å…¥å®¹å™¨</span></span><br><span class="line">docker <span class="built_in">exec</span> -it <span class="built_in">dd</span> bash</span><br><span class="line"><span class="comment"># 4.2.ç”¨dbåˆ«åè®¿é—®</span></span><br><span class="line">ping db</span><br><span class="line"><span class="comment"># ç»“æœ</span></span><br><span class="line">PING db (172.18.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from mysql.qlh (172.18.0.2): icmp_seq=1 ttl=64 time=0.070 ms</span><br><span class="line">64 bytes from mysql.qlh (172.18.0.2): icmp_seq=2 ttl=64 time=0.056 ms</span><br><span class="line"><span class="comment"># 4.3.ç”¨å®¹å™¨åè®¿é—®</span></span><br><span class="line">ping mysql</span><br><span class="line"><span class="comment"># ç»“æœï¼š</span></span><br><span class="line">PING mysql (172.18.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from mysql.qlh (172.18.0.2): icmp_seq=1 ttl=64 time=0.044 ms</span><br><span class="line">64 bytes from mysql.qlh (172.18.0.2): icmp_seq=2 ttl=64 time=0.054 ms</span><br></pre></td></tr></table></figure><p>ç°åœ¨å¯ä»¥é€šè¿‡åˆ«å(ä¾‹å¦‚: db)è®¿é—®</p><p>æ€»ç»“:</p><ul><li>åœ¨è‡ªå®šä¹‰ç½‘ç»œä¸­ï¼Œå¯ä»¥ç»™å®¹å™¨èµ·å¤šä¸ªåˆ«åï¼Œé»˜è®¤çš„åˆ«åæ˜¯å®¹å™¨åæœ¬èº«</li><li>åœ¨åŒä¸€ä¸ªè‡ªå®šä¹‰ç½‘ç»œä¸­çš„å®¹å™¨ï¼Œå¯ä»¥é€šè¿‡åˆ«åäº’ç›¸è®¿é—®</li></ul><h2 id="é¡¹ç›®éƒ¨ç½²ç¤ºä¾‹"><a href="#é¡¹ç›®éƒ¨ç½²ç¤ºä¾‹" class="headerlink" title="é¡¹ç›®éƒ¨ç½²ç¤ºä¾‹"></a>é¡¹ç›®éƒ¨ç½²ç¤ºä¾‹</h2><p>å°è¯•éƒ¨ç½²é»‘é©¬å•†åŸ</p><p>é¡¹ç›®ç»“æ„:</p><ul><li>hmall:  å•†åŸçš„åç«¯ä»£ç </li><li>hmall-portalï¼šå•†åŸç”¨æˆ·ç«¯çš„å‰ç«¯ä»£ç </li><li>hmall-adminï¼šå•†åŸç®¡ç†ç«¯çš„å‰ç«¯ä»£ç </li></ul><p>éƒ¨ç½²çš„å®¹å™¨åŠç«¯å£è¯´æ˜ï¼š</p><table><thead><tr><th><strong>é¡¹ç›®</strong></th><th><strong>å®¹å™¨å</strong></th><th><strong>ç«¯å£</strong></th><th><strong>å¤‡æ³¨</strong></th></tr></thead><tbody><tr><td>hmall</td><td>hmall</td><td>8080</td><td>é»‘é©¬å•†åŸåç«¯APIå…¥å£</td></tr><tr><td>hmall-portal</td><td>nginx</td><td>18080</td><td>é»‘é©¬å•†åŸç”¨æˆ·ç«¯å…¥å£</td></tr><tr><td>hmall-admin</td><td>nginx</td><td>18081</td><td>é»‘é©¬å•†åŸç®¡ç†ç«¯å…¥å£</td></tr><tr><td>mysql</td><td>mysql</td><td>3306</td><td>æ•°æ®åº“</td></tr></tbody></table><p>åœ¨æ­£å¼éƒ¨ç½²å‰ï¼Œæˆ‘ä»¬å…ˆåˆ é™¤ä¹‹å‰çš„nginxã€ddä¸¤ä¸ªå®¹å™¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">rm</span> -f nginx <span class="built_in">dd</span></span><br></pre></td></tr></table></figure><p>mysqlå®¹å™¨ä¸­å·²ç»å‡†å¤‡å¥½äº†å•†åŸçš„æ•°æ®ï¼Œæ‰€ä»¥å°±ä¸å†åˆ é™¤äº†ã€‚</p><h3 id="éƒ¨ç½²SpringBooté¡¹ç›®"><a href="#éƒ¨ç½²SpringBooté¡¹ç›®" class="headerlink" title="éƒ¨ç½²SpringBooté¡¹ç›®"></a>éƒ¨ç½²SpringBooté¡¹ç›®</h3><p>hamllé¡¹ç›®æ˜¯ä¸€ä¸ªmavenèšåˆé¡¹ç›®,  æ‰“å¼€é¡¹ç›®ç»“æ„å¦‚ä¸‹</p><hr><p>hamll</p><p>â€”â€“&gt;hm-common   é€šç”¨å·¥å…·æ¨¡å—</p><p>â€”â€“&gt;hm-service   ä¸šåŠ¡æ¨¡å—</p><hr><p>å…¶ä¸­æˆ‘ä»¬éœ€è¦éƒ¨ç½²çš„æ˜¯hm-serviceæ¨¡å—,  å…¶ä¸­é…ç½®æ–‡ä»¶é‡‡ç”¨äº†å¤šç¯å¢ƒçš„æ–¹å¼</p><ul><li>application.yml</li><li>application-dev.yml</li><li>application-local.yml</li></ul><blockquote><p>å…¶ä¸­çš„<code>application-dev.yaml</code>æ˜¯éƒ¨ç½²åˆ°å¼€å‘ç¯å¢ƒçš„é…ç½®ï¼Œ<code>application-local.yaml</code>æ˜¯æœ¬åœ°è¿è¡Œæ—¶çš„é…ç½®</p></blockquote><p>æŸ¥çœ‹application.yamlï¼Œä¼šå‘ç°å…¶ä¸­çš„JDBCåœ°å€å¹¶æœªå†™æ­»ï¼Œè€Œæ˜¯è¯»å–å˜é‡ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨ç«¯å£</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9000</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="comment"># ç¯å¢ƒä¿®æ”¹</span></span><br><span class="line">  <span class="attr">profile:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line">  <span class="comment"># æ•°æ®åº“ç›¸å…³   1. db.host  2. db.pw</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://$&#123;db.host&#125;:3306/hmall?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=UTC&amp;useSSL=true</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">$&#123;db.pw&#125;</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ä¸ªå˜é‡åœ¨<code>application-dev.yml</code>å’Œ<code>application-local.yml</code>ä¸­å¹¶ä¸ç›¸åŒ:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application-dev.yml</span></span><br><span class="line"><span class="attr">db:</span></span><br><span class="line">  <span class="attr">host:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">pw:</span> <span class="number">123</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># application-local.yml</span></span><br><span class="line"><span class="attr">db:</span></span><br><span class="line">  <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">  <span class="attr">pw:</span> <span class="number">123456</span></span><br></pre></td></tr></table></figure><p>åœ¨devå¼€å‘ç¯å¢ƒï¼ˆä¹Ÿå°±æ˜¯Dockeréƒ¨ç½²æ—¶ï¼‰é‡‡ç”¨äº†mysqlä½œä¸ºåœ°å€ï¼Œåˆšå¥½æ˜¯æˆ‘ä»¬çš„mysqlå®¹å™¨åï¼Œåªè¦ä¸¤è€…åœ¨ä¸€ä¸ªç½‘ç»œï¼Œå°±ä¸€å®šèƒ½äº’ç›¸è®¿é—®</p><p>å°†<code>hm-service</code>ç›®å½•ä¸‹çš„<code>Dockerfile</code>å’Œ<code>hm-service/target</code>ç›®å½•ä¸‹çš„<code>hm-service.jar</code>ä¸€èµ·ä¸Šä¼ åˆ°è™šæ‹Ÿæœºçš„<code>root</code>ç›®å½•</p><p>éƒ¨ç½²é¡¹ç›®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.æ„å»ºé¡¹ç›®é•œåƒï¼Œä¸æŒ‡å®štagï¼Œåˆ™é»˜è®¤ä¸ºlatest</span></span><br><span class="line">docker build -t hmall .</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 2.æŸ¥çœ‹é•œåƒ</span></span><br><span class="line">docker images</span><br><span class="line"><span class="comment"># ç»“æœ</span></span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">hmall         latest    0bb07b2c34b9   43 seconds ago   362MB</span><br><span class="line">docker-demo   1.0       49743484da68   24 hours ago     327MB</span><br><span class="line">nginx         latest    605c77e624dd   16 months ago    141MB</span><br><span class="line">mysql         latest    3218b38490ce   17 months ago    516MB</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 3.åˆ›å»ºå¹¶è¿è¡Œå®¹å™¨ï¼Œå¹¶é€šè¿‡--networkå°†å…¶åŠ å…¥hmallç½‘ç»œï¼Œè¿™æ ·æ‰èƒ½é€šè¿‡å®¹å™¨åè®¿é—®mysql</span></span><br><span class="line">docker run -d --name hmall --network hmall -p 8080:8080 hmall</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼Œé€šè¿‡æµè§ˆå™¨è®¿é—®ï¼šhttp:&#x2F;&#x2F;ä½ çš„è™šæ‹Ÿæœºåœ°å€:8080&#x2F;search&#x2F;listã€‚</p><h3 id="éƒ¨ç½²å‰ç«¯"><a href="#éƒ¨ç½²å‰ç«¯" class="headerlink" title="éƒ¨ç½²å‰ç«¯"></a>éƒ¨ç½²å‰ç«¯</h3><p><code>hmall-portal</code>å’Œ<code>hmall-admin</code>æ˜¯å‰ç«¯ä»£ç ï¼Œéœ€è¦åŸºäºnginxéƒ¨ç½²ã€‚åœ¨é»‘é©¬èµ„æ–™ä¸­å·²ç»æä¾›äº†nginxçš„éƒ¨ç½²ç›®å½•</p><p>å…¶ä¸­ï¼š</p><ul><li><code>html</code>æ˜¯é™æ€èµ„æºç›®å½•ï¼Œæˆ‘ä»¬éœ€è¦æŠŠ<code>hmall-portal</code>ä»¥åŠ<code>hmall-admin</code>éƒ½å¤åˆ¶è¿›å»</li><li><code>nginx.conf</code>æ˜¯nginxçš„é…ç½®æ–‡ä»¶ï¼Œä¸»è¦æ˜¯å®Œæˆå¯¹<code>html</code>ä¸‹çš„ä¸¤ä¸ªé™æ€èµ„æºç›®å½•åšä»£ç†</li></ul><p>æˆ‘ä»¬ç°åœ¨è¦åšçš„å°±æ˜¯æŠŠæ•´ä¸ªnginxç›®å½•ä¸Šä¼ åˆ°è™šæ‹Ÿæœºçš„<code>/root</code>ç›®å½•ä¸‹ï¼š</p><p>ç„¶ååˆ›å»ºnginxå®¹å™¨å¹¶å®Œæˆä¸¤ä¸ªæŒ‚è½½ï¼š</p><ul><li>æŠŠ<code>/root/nginx/nginx.conf</code>æŒ‚è½½åˆ°<code>/etc/nginx/nginx.conf</code></li><li>æŠŠ<code>/root/nginx/html</code>æŒ‚è½½åˆ°<code>/usr/share/nginx/html</code></li></ul><p>ç”±äºéœ€è¦è®©nginxåŒæ—¶ä»£ç†hmall-portalå’Œhmall-adminä¸¤å¥—å‰ç«¯èµ„æºï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æš´éœ²ä¸¤ä¸ªç«¯å£ï¼š</p><ul><li>18080ï¼šå¯¹åº”hmall-portal</li><li>18081ï¼šå¯¹åº”hmall-admin</li></ul><p>å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">  --name nginx \</span><br><span class="line">  -p 18080:18080 \</span><br><span class="line">  -p 18081:18081 \</span><br><span class="line">  -v /root/nginx/html:/etc/nginx/html \</span><br><span class="line">  -v /root/nginx/nginx.conf:/etc/nginx/nginx.conf \</span><br><span class="line">  --network hmall \</span><br><span class="line">  nginx</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼Œé€šè¿‡æµè§ˆå™¨è®¿é—®ï¼šhttp:&#x2F;&#x2F;ä½ çš„è™šæ‹Ÿæœºip:18080</p><h2 id="DockerCompose"><a href="#DockerCompose" class="headerlink" title="DockerCompose"></a>DockerCompose</h2><p>åœ¨å½“å‰çš„é¡¹ç›®éƒ¨ç½²ç¤ºä¾‹ä¸­, æˆ‘ä»¬éƒ¨ç½²äº† 1)MySQLå®¹å™¨  2)Nginxå®¹å™¨  3) Javaé¡¹ç›®,  ä½†æ˜¯åœ¨ä»¥åå¤æ‚çš„é¡¹ç›®ä¸­,  å½“ç„¶è¿˜è¦éƒ¨ç½²å…¶ä»–çš„ä¸­é—´ä»¶,  ä»è€Œè¿œè¿œä¸æ­¢ç±»ä¼¼äºå½“å‰çš„ä¸‰ä¸ªå®¹å™¨,  å¦‚æœè¿˜åƒä¹‹å‰é‚£æ ·éƒ¨ç½²,  éå¸¸éº»çƒ¦</p><p>è€ŒDocker Composeå°±å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°<strong>å¤šä¸ªç›¸äº’å…³è”çš„Dockerå®¹å™¨çš„å¿«é€Ÿéƒ¨ç½²</strong>ã€‚å®ƒå…è®¸ç”¨æˆ·é€šè¿‡ä¸€ä¸ªå•ç‹¬çš„ docker-compose.yml æ¨¡æ¿æ–‡ä»¶ï¼ˆYAML æ ¼å¼ï¼‰æ¥å®šä¹‰ä¸€ç»„ç›¸å…³è”çš„åº”ç”¨å®¹å™¨</p><h3 id="åŸºæœ¬è¯­æ³•"><a href="#åŸºæœ¬è¯­æ³•" class="headerlink" title="åŸºæœ¬è¯­æ³•"></a>åŸºæœ¬è¯­æ³•</h3><p>Docker Composeçš„YMLè¯­æ³•è¯¦æƒ…è§<a href="https://docs.docker.com/compose/compose-file/compose-file-v3/">Compose file version 3 reference | Docker Docs</a></p><p>åœ¨docker-composeæ–‡ä»¶ä¸­å¯ä»¥å®šä¹‰å¤šä¸ªç›¸äº’å…³è”çš„åº”ç”¨å®¹å™¨ï¼Œæ¯ä¸€ä¸ªåº”ç”¨å®¹å™¨è¢«ç§°ä¸ºä¸€ä¸ªæœåŠ¡</p><p>åœ¨ä¹‹å‰çš„MySQLéƒ¨ç½²æ—¶,  æˆ‘ä»¬ä½¿ç”¨çš„å‘½ä»¤ç¤ºä¾‹æ˜¯è¿™æ ·çš„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">  --name mysql \</span><br><span class="line">  -p 3306:3306 \</span><br><span class="line">  -e TZ=Asia/Shanghai \</span><br><span class="line">  -e MYSQL_ROOT_PASSWORD=123456 \</span><br><span class="line">  -v ./mysql/data:/var/lib/mysql \</span><br><span class="line">  -v ./mysql/conf:/etc/mysql/conf.d \</span><br><span class="line">  -v ./mysql/init:/docker-entrypoint-initdb.d \</span><br><span class="line">  --network hmall</span><br><span class="line">  mysql</span><br></pre></td></tr></table></figure><p>è€Œä½¿ç”¨Compose,  æ˜¯è¿™æ ·çš„</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.8&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mysql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3306:3306&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="number">123</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./mysql/conf:/etc/mysql/conf.d&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./mysql/data:/var/lib/mysql&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">new</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">new:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">hmall</span></span><br></pre></td></tr></table></figure><p>å¯¹æ¯”å¦‚ä¸‹:</p><table><thead><tr><th><strong>docker run å‚æ•°</strong></th><th><strong>docker compose æŒ‡ä»¤</strong></th><th><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td>â€“name</td><td>container_name</td><td>å®¹å™¨åç§°</td></tr><tr><td>-p</td><td>ports</td><td>ç«¯å£æ˜ å°„</td></tr><tr><td>-e</td><td>environment</td><td>ç¯å¢ƒå˜é‡</td></tr><tr><td>-v</td><td>volumes</td><td>æ•°æ®å·é…ç½®</td></tr><tr><td>â€“network</td><td>networks</td><td>ç½‘ç»œ</td></tr></tbody></table><p>é‚£ä¹ˆå¯¹äºåˆšåˆšé¡¹ç›®éƒ¨ç½²çš„æ ·ä¾‹åˆ™å¯ä»¥ä¿®æ”¹ä¸º</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.8&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mysql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3306:3306&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./mysql/conf:/etc/mysql/conf.d&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./mysql/data:/var/lib/mysql&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./mysql/init:/docker-entrypoint-initdb.d&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">hm-net</span></span><br><span class="line">  <span class="attr">hmall:</span></span><br><span class="line">    <span class="attr">build:</span> </span><br><span class="line">      <span class="attr">context:</span> <span class="string">.</span></span><br><span class="line">      <span class="attr">dockerfile:</span> <span class="string">Dockerfile</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">hmall</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8080:8080&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">hm-net</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">nginx:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;18080:18080&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;18081:18081&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./nginx/nginx.conf:/etc/nginx/nginx.conf&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;./nginx/html:/usr/share/nginx/html&quot;</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">hmall</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">hm-net</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">hm-net:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">hmall</span></span><br></pre></td></tr></table></figure><h3 id="åŸºæœ¬å‘½ä»¤"><a href="#åŸºæœ¬å‘½ä»¤" class="headerlink" title="åŸºæœ¬å‘½ä»¤"></a>åŸºæœ¬å‘½ä»¤</h3><p>ç¼–å†™å¥½äº†Yamlæ–‡ä»¶,  å°±å¯ä»¥éƒ¨ç½²é¡¹ç›®äº†</p><p>å¯¹äºä¸€äº›å¸¸è§çš„å‘½ä»¤ <a href="https://docs.docker.com/compose/reference/">Overview of docker compose CLI | Docker Docs</a></p><p>è¯­æ³•å¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose [OPTIONS] [COMMAND]</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼ŒOPTIONSå’ŒCOMMANDéƒ½æ˜¯å¯é€‰å‚æ•°ï¼Œæ¯”è¾ƒå¸¸è§çš„æœ‰:</p><table><thead><tr><th colspan="1" rowspan="1"> <p><strong>ç±»å‹</strong></p> </th><th colspan="1" rowspan="1"> <p><strong>å‚æ•°æˆ–æŒ‡ä»¤</strong></p> </th><th colspan="1" rowspan="1"> <p><strong>è¯´æ˜</strong></p> </th></tr></thead><tbody><tr><td colspan="1" rowspan="2"> <p>Options</p> </td><td colspan="1" rowspan="1"> <p>-f</p> </td><td colspan="1" rowspan="1"> <p>æŒ‡å®šcomposeæ–‡ä»¶çš„è·¯å¾„å’Œåç§°</p> </td></tr><tr><td colspan="1" rowspan="1"> <p>-p</p> </td><td colspan="1" rowspan="1"> <p>æŒ‡å®šprojectåç§°ã€‚projectå°±æ˜¯å½“å‰composeæ–‡ä»¶ä¸­è®¾ç½®çš„å¤šä¸ªserviceçš„é›†åˆ&#xff0c;æ˜¯é€»è¾‘æ¦‚å¿µ</p> </td></tr><tr><td colspan="1" rowspan="9"> <p>Commands</p> </td><td colspan="1" rowspan="1"> <p>up</p> </td><td colspan="1" rowspan="1"> <p>åˆ›å»ºå¹¶å¯åŠ¨æ‰€æœ‰serviceå®¹å™¨</p> </td></tr><tr><td colspan="1" rowspan="1"> <p>down</p> </td><td colspan="1" rowspan="1"> <p>åœæ­¢å¹¶ç§»é™¤æ‰€æœ‰å®¹å™¨ã€ç½‘ç»œ</p> </td></tr><tr><td colspan="1" rowspan="1"> <p>ps</p> </td><td colspan="1" rowspan="1"> <p>åˆ—å‡ºæ‰€æœ‰å¯åŠ¨çš„å®¹å™¨</p> </td></tr><tr><td colspan="1" rowspan="1"> <p>logs</p> </td><td colspan="1" rowspan="1"> <p>æŸ¥çœ‹æŒ‡å®šå®¹å™¨çš„æ—¥å¿—</p> </td></tr><tr><td colspan="1" rowspan="1"> <p>stop</p> </td><td colspan="1" rowspan="1"> <p>åœæ­¢å®¹å™¨</p> </td></tr><tr><td colspan="1" rowspan="1"> <p>start</p> </td><td colspan="1" rowspan="1"> <p>å¯åŠ¨å®¹å™¨</p> </td></tr><tr><td colspan="1" rowspan="1"> <p>restart</p> </td><td colspan="1" rowspan="1"> <p>é‡å¯å®¹å™¨</p> </td></tr><tr><td colspan="1" rowspan="1"> <p>top</p> </td><td colspan="1" rowspan="1"> <p>æŸ¥çœ‹è¿è¡Œçš„è¿›ç¨‹</p> </td></tr><tr><td colspan="1" rowspan="1"> <p>exec</p> </td><td colspan="1" rowspan="1"> <p>åœ¨æŒ‡å®šçš„è¿è¡Œä¸­å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤</p> </td></tr></tbody></table> <h2 id="æ ·ä¾‹-Dockeræ•´åˆFastDFS"><a href="#æ ·ä¾‹-Dockeræ•´åˆFastDFS" class="headerlink" title="æ ·ä¾‹: Dockeræ•´åˆFastDFS"></a>æ ·ä¾‹: Dockeræ•´åˆFastDFS</h2><p>é•œåƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. æŸ¥æ‰¾FastDFS</span></span><br><span class="line">docker search fastdfs</span><br><span class="line"><span class="comment"># 2. æ‹‰å–é•œåƒ</span></span><br><span class="line">docker pull delron/fastdfs</span><br></pre></td></tr></table></figure><p>trackerå®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name tracker --network=yournetwork -v E:\dockercontainers\fastdfs\tracker:/var/fdfs delron/fastdfs tracker</span><br></pre></td></tr></table></figure><ul><li><code> E:\dockercontainers\fastdfs\tracker</code>ä¸ºæŒ‚è½½åˆ°æœ¬åœ°çš„è·¯å¾„</li><li><code>--network=yournetwork</code>åŠ å…¥çš„ç½‘æ¡¥</li></ul><p>storageå®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8888:8888 --name storage --network=yournetwork  -e TRACKER_SERVER=172.18.0.2:22122  -v E:\dockercontainers\fastdfs\storage:/var/fdfs -e GROUP_NAME=group1 delron/fastdfs storage</span><br></pre></td></tr></table></figure><ul><li><code>TRACKER_SERVER</code>ä¸ºä¸Šé¢çš„<code>tracker</code>è¿æ¥åˆ°çš„ç½‘æ¡¥çš„åœ°å€</li><li><code>GROUP_NAME</code>åˆ†ç»„å</li></ul><hr><p>æµ‹è¯•: åœ¨storageå®¹å™¨ä¸­æµ‹è¯•ä½¿ç”¨å‘½ä»¤ä¸Šä¼ å›¾ç‰‡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥å®¹å™¨å†…bashæŒ‡ä»¤æ¨¡å¼</span></span><br><span class="line">docker <span class="built_in">exec</span> -it storage bash</span><br><span class="line"><span class="comment"># è¿›å…¥/var/fdfsç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /var/fdfs</span><br><span class="line"><span class="comment"># åŠ è½½ä½äºE:\dockercontainers\fastdfs\storageä¸‹çš„æ–‡ä»¶ 3.png</span></span><br><span class="line"><span class="comment"># E:\dockercontainers\fastdfs\storageä¸ºæ˜ å°„åœ°å€</span></span><br><span class="line"><span class="comment"># åŠ è½½å®Œæˆä¼šè¿”å›ä¸€ä¸²å­—ç¬¦è·¯å¾„ group1/M00/00/00/rBIAA2VLaFSAXi66AABGbuqCV2g017.jpg</span></span><br><span class="line">/usr/bin/fdfs_upload_file /etc/fdfs/client.conf 3.png</span><br><span class="line"><span class="comment"># æœ€åé€šè¿‡æ˜ å°„ç«¯å£è®¿é—®</span></span><br><span class="line">http://localhost:8888/group1/M00/00/00/rBIAA2VLaFSAXi66AABGbuqCV2g017.jpg</span><br></pre></td></tr></table></figure><h3 id="åº”ç”¨-SpringBootæ•´åˆFastDFS"><a href="#åº”ç”¨-SpringBootæ•´åˆFastDFS" class="headerlink" title="åº”ç”¨: SpringBootæ•´åˆFastDFS"></a>åº”ç”¨: SpringBootæ•´åˆFastDFS</h3><p>å¯¼å…¥ç¬¬ä¸‰æ–¹ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--fastDFS--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.luhuiguo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastdfs-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é…ç½®SpringBoot Yaml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">fdfs:</span></span><br><span class="line">  <span class="comment"># dockerç½‘æ¡¥åˆ†é…çš„IPåœ°å€  trackerçš„åœ°å€</span></span><br><span class="line">  <span class="attr">tracker-list:</span> <span class="number">172.18</span><span class="number">.0</span><span class="number">.4</span><span class="string">:22122</span></span><br><span class="line">  <span class="attr">so-timeout:</span> <span class="number">6000</span>  <span class="comment"># è®¾ç½®è¯»å–æ—¶é—´</span></span><br><span class="line">  <span class="attr">connect-timeout:</span> <span class="number">1000</span> <span class="comment">#  è®¾ç½®è¿æ¥æ—¶é—´</span></span><br></pre></td></tr></table></figure><p>ç¼–å†™ä¸€ä¸ªç®€å•çš„UploadService</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ³¨å…¥Fastå®¢æˆ·ç«¯</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> FastFileStorageClient fastFileStorageClient;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">uploadFile</span><span class="params">(MultipartFile multipartFile)</span> &#123;</span><br><span class="line">    <span class="type">StorePath</span> <span class="variable">storePath</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        storePath = fastFileStorageClient.uploadFile(<span class="string">&quot;&quot;</span>,</span><br><span class="line">                                                     multipartFile.getInputStream()</span><br><span class="line">                                                     , multipartFile.getSize()</span><br><span class="line">                                                     , <span class="string">&quot;jpg&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;Group:&#123;&#125;,Path:&#123;&#125;,FullPath:&#123;&#125;&quot;</span>,</span><br><span class="line">                 storePath.getGroup(),</span><br><span class="line">                 storePath.getPath(),</span><br><span class="line">                 storePath.getFullPath());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        log.error(<span class="string">&quot;uploadFileå‘ç”Ÿäº†å¼‚å¸¸ï¼Œ&#123;&#125;&quot;</span>, e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> storePath.getFullPath();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¥starteræºç å‚è€ƒ: [luhuiguo](<a href="https://github.com/luhuiguo/fastdfs-spring-boot-starter">luhuiguo&#x2F;fastdfs-spring-boot-starter: Spring Boot FastDFS Starter (github.com)</a>), å…³äºæ­¤ä¾èµ–ç‰ˆæœ¬,  å‚è€ƒ<a href="https://mvnrepository.com/">mavenä»“åº“</a>,  æœç´¢fastdfs (å½“å‰githubä¸­çš„readmeæ–‡ä»¶ä»‹ç»æŒ‡å®šçš„æ˜¯0.1.0)</p><h2 id="åº”ç”¨é€šä¿¡"><a href="#åº”ç”¨é€šä¿¡" class="headerlink" title="åº”ç”¨é€šä¿¡"></a>åº”ç”¨é€šä¿¡</h2><p>ç¯å¢ƒ: SpringBooté¡¹ç›®,Dockerå®¹å™¨æœ‰: Redis, MySQL,  FastDFS</p><p>å½“å‰é¡¹ç›®çš„æ‹“æ‰‘å›¾ç¤ºä¾‹å¦‚ä¸‹:</p><img src="/2023/10/16/Docker/docker_3.png" class title="é€šä¿¡æ‹“æ‰‘å›¾"><ul><li><p>å¯¹äºWindowsè®¿é—®å®¹å™¨:  Windowsè®¿é—®<wavy>æš´éœ²çš„ç«¯å£</wavy>,  ä¾‹å¦‚è®¿é—®dockerå®¹å™¨ä¸­çš„nginxæš´éœ²çš„8888ç«¯å£,  ä»è€Œè®¿é—®FastDFSå­˜å‚¨çš„ç…§ç‰‡</p></li><li><p>å¯¹äºDockerå®¹å™¨å†…éƒ¨é€šä¿¡:  å®¹å™¨ä¹‹é—´å¯ä»¥é€šè¿‡ç½‘æ¡¥é€šä¿¡,  ä¾‹å¦‚æˆ‘çš„Applicationåº”ç”¨(SpringBoot),  éœ€è¦è®¿é—®MySQLå’ŒRedisç­‰å®¹å™¨,  åˆ™å¯ä»¥è®¿é—®<span class="p red">ç½‘æ¡¥</span>åˆ†é…çš„ipåœ°å€(å¦‚å›¾),  å®ç°é€šä¿¡ã€‚æŸ¥çœ‹å¦‚ä½•æŸ¥è¯¢ç½‘æ¡¥æƒ…å†µï¼š <psw>docker network inspect your_bridge</psw></p></li></ul><p>å…³äºçº¿ä¸Šç¯å¢ƒ: åœ¨Dockerå†…éƒ¨åˆ™æ˜¯é€šè¿‡ç½‘æ¡¥è®¿é—®å®¹å™¨åŸç”Ÿç«¯å£(ä¾‹å¦‚MySQL:3306),  SpringBootçš„é…ç½®æ–‡ä»¶é…ç½®æ ·ä¾‹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">fdfs:</span></span><br><span class="line">  <span class="comment"># dockerç½‘æ¡¥åˆ†é…çš„IPåœ°å€  trackerçš„åœ°å€</span></span><br><span class="line">  <span class="attr">tracker-list:</span> <span class="number">172.18</span><span class="number">.0</span><span class="number">.4</span><span class="string">:22122</span></span><br><span class="line">  <span class="attr">so-timeout:</span> <span class="number">6000</span>  <span class="comment"># è®¾ç½®è¯»å–æ—¶é—´</span></span><br><span class="line">  <span class="attr">connect-timeout:</span> <span class="number">1000</span> <span class="comment">#  è®¾ç½®è¿æ¥æ—¶é—´</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9999</span>  <span class="comment"># æœåŠ¡ç«¯å£</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="comment"># dockerç½‘æ¡¥åˆ†é…çš„IPåœ°å€</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://172.18.0.2:3306/test?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=UTC&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">  <span class="comment">#Redisç›¸å…³é…ç½®</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">172.18</span><span class="number">.0</span><span class="number">.5</span>  <span class="comment"># dockerç½‘æ¡¥åˆ†é…çš„IPåœ°å€</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="comment">#password:123456</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">0</span> <span class="comment">#0æ˜¯0å·æ•°æ®åº“ï¼Œredisé»˜è®¤å¼€å¯çš„16ä¸ªæ•°æ®åº“</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="number">5000</span> <span class="comment">#è¶…æ—¶æ—¶é—´</span></span><br></pre></td></tr></table></figure><blockquote><p>ä¾‹å¦‚Redisåœ¨ç½‘æ¡¥ä¸Šçš„IPä¸º172.18.0.5,  åˆ™éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®ç½‘æ¡¥åœ°å€ã€‚ (ç»“æ„å›¾å‚è€ƒè¯¥å°ç»“é¦–ç…§ç‰‡)</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> å®¹å™¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBoot</title>
      <link href="/2023/10/08/SpringBoot/"/>
      <url>/2023/10/08/SpringBoot/</url>
      
        <content type="html"><![CDATA[<p>SpringBootç¬”è®°æŒç»­æ›´æ–°ä¸­!</p><h2 id="SpringBoot"><a href="#SpringBoot" class="headerlink" title="SpringBoot"></a>SpringBoot</h2><h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><h4 id="è¯»å–YMLé…ç½®æ–‡ä»¶ä¿¡æ¯"><a href="#è¯»å–YMLé…ç½®æ–‡ä»¶ä¿¡æ¯" class="headerlink" title="è¯»å–YMLé…ç½®æ–‡ä»¶ä¿¡æ¯"></a>è¯»å–YMLé…ç½®æ–‡ä»¶ä¿¡æ¯</h4><p>å¯¼å…¥ä¾èµ–:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- é…ç½®æ–‡ä»¶å¤„ç†å™¨: æ˜¯SpringBootå¤„ç†yml,yaml,propertiesé…ç½®æ–‡ä»¶ --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    1. ä»¥æµçš„æ–¹å¼è¯»å– application.yml</span></span><br><span class="line"><span class="comment">    2. ä»¥åå°„çš„æ–¹å¼ å°†application.ymlçš„å€¼ å­˜å‚¨åˆ°å¯¹è±¡ä¸­(setXxx()æ–¹æ³•)</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å¯é€‰,å®ƒå°†é€‰æ‹©æƒäº¤ç»™ä¸Šçº§åº”ç”¨ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ymlæ ·ä¾‹:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">product:</span></span><br><span class="line">  <span class="attr">pname:</span> <span class="string">apple</span></span><br><span class="line">  <span class="attr">price:</span> <span class="number">20.5</span></span><br><span class="line">  <span class="attr">is-used:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">man-date:</span> <span class="number">2021</span><span class="string">/09/09</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">attributes:</span> &#123;<span class="attr">&#x27;color&#x27;:</span> <span class="string">&#x27;red&#x27;</span>,<span class="string">&#x27;type&#x27;</span><span class="string">:&#x27;good&#x27;</span>&#125;</span><br><span class="line">  <span class="attr">address:</span></span><br><span class="line">    <span class="attr">province:</span> <span class="string">æ¹–å—çœ</span></span><br><span class="line">    <span class="attr">city:</span> <span class="string">é•¿æ²™</span></span><br><span class="line">  <span class="attr">types:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">æ°´æœ</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">é›¶é£Ÿ</span></span><br></pre></td></tr></table></figure><p>å¯¹åº”çš„å®ä½“ç±»:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span>     <span class="comment">// Get Set</span></span><br><span class="line"><span class="comment">// å½“processorè¯»å–åˆ°application.ymlé…ç½®æ–‡ä»¶ä»¥product,å­˜å‚¨åˆ°å½“å‰å¯¹è±¡ä¸­</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;product&quot;)</span></span><br><span class="line"><span class="meta">@Component</span> <span class="comment">// IOC</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String pname;</span><br><span class="line">    <span class="keyword">private</span> Double price;</span><br><span class="line">    <span class="keyword">private</span> Boolean isUsed; <span class="comment">// is-used</span></span><br><span class="line">    <span class="keyword">private</span> Date manDate;   <span class="comment">// man-date</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; attributes;</span><br><span class="line">    <span class="keyword">private</span> Address address;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; types;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Address</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String province;</span><br><span class="line">    <span class="keyword">private</span> String city;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç±»:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest()</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductTest</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Product product;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testProduct</span><span class="params">()</span> &#123;</span><br><span class="line">        Assert.assertNotNull(product);</span><br><span class="line">        Assert.assertEquals(<span class="string">&quot;apple&quot;</span>, product.getPname());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å…¶ä¸­æˆ‘ä»¬éœ€è¦å¯¼å…¥çš„junitçš„åŒ…æ˜¯è¿™ä¸ª import org.junit.Test;</p><p>ä¸æ˜¯ import org.junit.jupiter.api.Test;</p><p>ä¸ç„¶ä¼šæŠ¥é”™ Runner org.junit.internal.runners.ErrorReportingRunner does not support filtering and will ther</p></blockquote><h4 id="è¯»å–å…¶ä»–é…ç½®æ–‡ä»¶å†…å®¹"><a href="#è¯»å–å…¶ä»–é…ç½®æ–‡ä»¶å†…å®¹" class="headerlink" title="è¯»å–å…¶ä»–é…ç½®æ–‡ä»¶å†…å®¹"></a>è¯»å–å…¶ä»–é…ç½®æ–‡ä»¶å†…å®¹</h4><p>1.è¯»å–ä¾‹å¦‚propertiesé…ç½® <code>@PropertySource()</code></p><p>åœ¨é…ç½®æ–‡ä»¶ä¸­åŠ å…¥æ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.è¯»å–ä¾‹å¦‚propertiesé…ç½®  å¹¶ä»¥key valueå­˜å‚¨</span></span><br><span class="line"><span class="meta">@PropertySource(value = &#123;&quot;classpath:db.properties&quot;&#125;)</span><span class="comment">// valueå¯ä»¥åŠ å¤šä¸ª</span></span><br></pre></td></tr></table></figure><p>db.propertiesé…ç½®æ–‡ä»¶</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">password</span>=<span class="string">123456</span></span><br></pre></td></tr></table></figure><p>å¦‚ä½•åœ¨Springä¸­ä½¿ç”¨å‘¢? ä½¿ç”¨<code>@Value($&#123;username&#125;)</code>æ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value($&#123;username&#125;)</span></span><br><span class="line"><span class="keyword">private</span> String username;  <span class="comment">// root</span></span><br></pre></td></tr></table></figure><p>2.è¯»å–ä¾‹å¦‚xmlé…ç½® <code>@ImportResource</code></p><p>åœ¨é…ç½®æ–‡ä»¶ä¸­åŠ å…¥æ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2.è¯»å–spring.xmlé…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="meta">@ImportResource(locations = &#123;&quot;classpath:spring.xml&quot;&#125;)</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;us&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hang.springboot.entity.User&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;zhang&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¯»å–:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Qualifier(value = &quot;us&quot;)</span> <span class="comment">// æ ¹æ®beançš„å”¯ä¸€idè·å–,å› ä¸ºåœ¨Userç±»é‡Œé¢åŠ äº†@Componentæ³¨è§£,å·²ç»æ³¨å…¥è¿‡äº†(id=user)</span></span><br><span class="line"><span class="keyword">private</span> User user;</span><br></pre></td></tr></table></figure><h4 id="åœ¨è¿è¡Œæ—¶ä¿®æ”¹é…ç½®æ–‡ä»¶ä¿¡æ¯"><a href="#åœ¨è¿è¡Œæ—¶ä¿®æ”¹é…ç½®æ–‡ä»¶ä¿¡æ¯" class="headerlink" title="åœ¨è¿è¡Œæ—¶ä¿®æ”¹é…ç½®æ–‡ä»¶ä¿¡æ¯"></a>åœ¨è¿è¡Œæ—¶ä¿®æ”¹é…ç½®æ–‡ä»¶ä¿¡æ¯</h4><ol><li><p>åœ¨å‘½ä»¤è¡Œå‚æ•°ä¸­é…ç½®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar xxx.jar --server.port=9090</span><br></pre></td></tr></table></figure><blockquote><p>æ­¤é¡¹ä½¿ç”¨å¿…é¡»å»ºç«‹åœ¨å¯åŠ¨ç±»çš„runæ–¹æ³•ä¸­,ä¼ å…¥äº†mainå‡½æ•°ä¸­çš„argså‚æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line"> <span class="comment">// å‘½ä»¤è¡Œå‚æ•°é…ç½®(ä¼ ç»™SpringBootçš„)  --server.port=xxx</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">     <span class="comment">// 1. ä¼ å…¥å‚æ•°çš„å¯åŠ¨ç±»,å¯ä»¥è¯»å–å‘½ä»¤è¡Œé…ç½®</span></span><br><span class="line">     SpringApplication.run(Application.class, args);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p>2.ä¼ å…¥è™šæ‹Ÿæœºç³»ç»Ÿå±æ€§</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -Dserver.port=<span class="number">9090</span> -jar xxx.jar</span><br></pre></td></tr></table></figure><blockquote><p>-D è®¾ç½®è™šæ‹Ÿå‚æ•°  å…¶ä¸­server.portæ˜¯è‡ªå·±éœ€è¦ä¿®æ”¹çš„é…ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">     <span class="comment">// æ²¡æœ‰ä¼ å…¥å‚æ•°</span></span><br><span class="line">     SpringApplication.run(Application.class);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p>åœ¨æœ€å,æˆ‘ä»¬è¿˜èƒ½æ·»åŠ å±æ€§åœ¨é…ç½®æ–‡ä»¶é‡Œé¢,ä¾‹å¦‚æˆ‘éœ€è¦åŠ å±æ€§: name&#x3D;qiuqiu</p><p>eg: <code>java -jar xxx.jar --server.port=9090 --name=qiuqiu</code> </p><p>â€‹      <code>java -Dserver.port=9090 -Dname=qiuqiu -jar xxx.jar</code> </p><h4 id="SpringBootè¯»å–é…ç½®ä¿¡æ¯ã€ç¯å¢ƒå˜é‡"><a href="#SpringBootè¯»å–é…ç½®ä¿¡æ¯ã€ç¯å¢ƒå˜é‡" class="headerlink" title="SpringBootè¯»å–é…ç½®ä¿¡æ¯ã€ç¯å¢ƒå˜é‡"></a>SpringBootè¯»å–é…ç½®ä¿¡æ¯ã€ç¯å¢ƒå˜é‡</h4><ol><li>EnvironmentåŸºæœ¬çš„ç¯å¢ƒå˜é‡</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¯»å–ç¯å¢ƒå˜é‡ä¿¡æ¯,springå¯åŠ¨æ—¶,è‡ªåŠ¨åŠ è½½</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> Environment environment;</span><br></pre></td></tr></table></figure><p>â€‹2.ConfigurableEnvironmentç¯å¢ƒå˜é‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> ConfigurableEnvironment configurableEnvironment;</span><br></pre></td></tr></table></figure><p><strong>ConfigurableEnvironmentæ˜¯Environmentçš„å­æ¥å£,åŠŸèƒ½æ›´å¤š</strong></p><p>æ³¨å…¥ä¹‹å,ç›´æ¥è°ƒç”¨å³å¯</p><h4 id="å¤šç¯å¢ƒé…ç½®-å¤šæ•°æ®æºé…ç½®"><a href="#å¤šç¯å¢ƒé…ç½®-å¤šæ•°æ®æºé…ç½®" class="headerlink" title="å¤šç¯å¢ƒé…ç½® å¤šæ•°æ®æºé…ç½®"></a>å¤šç¯å¢ƒé…ç½® å¤šæ•°æ®æºé…ç½®</h4><p><strong>å¤šç¯å¢ƒ:</strong></p><p>å¼€å‘æ—¶åˆ†ä¸ºå¤šä¸ªç¯å¢ƒ: å¼€å‘ç¯å¢ƒ (dev) , æµ‹è¯•ç¯å¢ƒ (test) , ç”Ÿäº§ç¯å¢ƒ (prod)</p><p>ç³»ç»Ÿé»˜è®¤<code>application.yml</code></p><img src="/2023/10/08/SpringBoot/dev_env.png" class><p>1.é€šè¿‡åœ¨<code>application.xml</code>é»˜è®¤é…ç½®æ–‡ä»¶ä¸­é…ç½®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¿€æ´»æŒ‡å®šä½¿ç”¨å“ªä¸ªç¯å¢ƒé…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br></pre></td></tr></table></figure><p>2.é€šè¿‡æ³¨è§£é…ç½® <code>@Profile(&quot;dev&quot;)</code>,åŠ å…¥åœ¨å¸¦<code>@Configuration</code>æ³¨è§£çš„é…ç½®ç±»ä¸­</p><blockquote><p> å¤šç¯å¢ƒé…ç½®,å¦‚æœè®¾ç½®çš„ç¯å¢ƒè·Ÿé»˜è®¤ç¯å¢ƒæœ‰ç›¸åŒçš„é…ç½® , åˆ™å½“å‰è®¾ç½®çš„ç¯å¢ƒä¼š<strong>è¦†ç›–é»˜è®¤ç¯å¢ƒçš„ç›¸åŒé…ç½®å±æ€§</strong></p></blockquote><p><strong>å¤šæ•°æ®æº:</strong></p><p>åœ¨<code>@Configuration</code>ä¿®é¥°çš„é…ç½®ç±»ä¸­é…ç½®æ•°æ®æº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;$&#123;driverClassName&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String driverName;</span><br><span class="line"><span class="meta">@Value(&quot;$&#123;username&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String username;</span><br><span class="line"><span class="meta">@Value(&quot;$&#123;password&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String password;</span><br><span class="line"><span class="meta">@Value(&quot;$&#123;url&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String url;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="comment">// è¡¨ç¤ºæŒ‡å®šäº† spring.profiles.active: testçš„æ—¶å€™ç”¨è¿™ä¸ªæ•°æ®æº</span></span><br><span class="line"><span class="meta">@Profile(&quot;test&quot;)</span> <span class="comment">// æµ‹è¯•æ•°æ®æº</span></span><br><span class="line"><span class="keyword">public</span> DataSource <span class="title function_">localDataSource</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">DriverManagerDataSource</span> <span class="variable">source</span> <span class="operator">=</span> </span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">DriverManagerDataSource</span>();</span><br><span class="line">    source.setDriverClassName(driverName);</span><br><span class="line">    source.setUsername(username);</span><br><span class="line">    source.setPassword(password);</span><br><span class="line">    source.setUrl(url);</span><br><span class="line">    <span class="keyword">return</span> source;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="comment">// è¡¨ç¤ºæŒ‡å®šäº† spring.profiles.active: prodçš„æ—¶å€™ç”¨è¿™ä¸ªæ•°æ®æº</span></span><br><span class="line"><span class="meta">@Profile(&quot;prod&quot;)</span> </span><br><span class="line"><span class="keyword">public</span> DataSource <span class="title function_">localDataSource</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">DruidDataSource</span> <span class="variable">source</span> <span class="operator">=</span> </span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">    source.setDriverClassName(driverName);</span><br><span class="line">    source.setUsername(username);</span><br><span class="line">    source.setPassword(password);</span><br><span class="line">    source.setUrl(url);</span><br><span class="line">    <span class="keyword">return</span> source;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶åˆ™åªä¼šæœ‰ä¸€ä¸ªæ•°æ®æºçš„bean</p><h4 id="æ—¥å¿—é…ç½®"><a href="#æ—¥å¿—é…ç½®" class="headerlink" title="æ—¥å¿—é…ç½®"></a>æ—¥å¿—é…ç½®</h4><p><strong>åŸºç¡€é…ç½®</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ—¥å¿—é…ç½®</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="comment"># æ—¥å¿—çº§åˆ«</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">  <span class="comment"># æ ¹æ—¥å¿—é…ç½® æ—¥å¿—çº§åˆ«</span></span><br><span class="line">    <span class="attr">root:</span> <span class="string">debug</span></span><br><span class="line">    <span class="comment"># é…ç½®è¯¥è·¯å¾„ä¸‹çš„æ—¥å¿—çº§åˆ«</span></span><br><span class="line">    <span class="attr">org.springframework:</span> <span class="string">error</span></span><br><span class="line">    <span class="attr">org.apache:</span> <span class="string">error</span></span><br><span class="line">  <span class="comment"># æ—¥å¿—è¾“å‡º</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">  <span class="comment"># nameå’Œpathåªèƒ½è®¾ç½®ä¸€ä¸ª,é»˜è®¤è¾“å‡ºåœ¨å½“å‰æ¨¡å—çš„æ ¹ç›®å½•</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">spring.log</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">logs/</span></span><br></pre></td></tr></table></figure><p><strong>æ»šåŠ¨é…ç½®</strong></p><p>æš‚æ— </p><h3 id="Pomæ–‡ä»¶ç›¸å…³"><a href="#Pomæ–‡ä»¶ç›¸å…³" class="headerlink" title="Pomæ–‡ä»¶ç›¸å…³"></a>Pomæ–‡ä»¶ç›¸å…³</h3><p><code>spring-boot-start-test</code></p><p>å¯¹äº<code>spring-boot-starter-test</code>çš„ä¾èµ–, é»˜è®¤æ˜¯å¼•å…¥junit4å’Œjunit5</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æ’é™¤junit4--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>dockeræ‰“åŒ…</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.spotify<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dockerfile-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>default<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">goal</span>&gt;</span>build<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">goal</span>&gt;</span>push<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span>javastack/$&#123;project.name&#125;<span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tag</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">buildArgs</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">JAR_FILE</span>&gt;</span>$&#123;project.build.finalName&#125;.jar<span class="tag">&lt;/<span class="name">JAR_FILE</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">buildArgs</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dockerfile</span>&gt;</span>Dockerfile<span class="tag">&lt;/<span class="name">dockerfile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•ç±»"><a href="#æµ‹è¯•ç±»" class="headerlink" title="æµ‹è¯•ç±»"></a>æµ‹è¯•ç±»</h3><h4 id="ä¸€ã€æ™®é€šæµ‹è¯•ç±»-å’Œ-å¥—ä»¶"><a href="#ä¸€ã€æ™®é€šæµ‹è¯•ç±»-å’Œ-å¥—ä»¶" class="headerlink" title="ä¸€ã€æ™®é€šæµ‹è¯•ç±» å’Œ å¥—ä»¶"></a>ä¸€ã€æ™®é€šæµ‹è¯•ç±» å’Œ å¥—ä»¶</h4><p>ä¾‹å¦‚æ­¤æ—¶æˆ‘æœ‰ä¸€ä¸ªserviceç±»éœ€è¦æµ‹è¯•:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Calculator</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>é¦–å…ˆéœ€è¦åŠ æ³¨è§£@Component äº¤ç»™Springç®¡ç†</li><li>ç„¶ååœ¨å½“å‰çš„åŒ…ä¸­å³é”®,ç‚¹å‡»Go To -&gt; Test -&gt; Create New Test ä¸€èˆ¬ç‚¹å‡»OKå³å¯</li><li>ç„¶åideaåœ¨teståŒ…ä¸‹å°±ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªè·Ÿå½“å‰ç±»åŒæ ·ç»“æ„çš„æµ‹è¯•ç±»</li><li>åœ¨æµ‹è¯•ç±»ä¸­éœ€è¦å¼•å…¥æ³¨è§£</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–springbootçš„å¯åŠ¨ç±»</span></span><br><span class="line"><span class="meta">@SpringBootTest(classes = SpringBootApplication.class)</span> </span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•(å•æ–¹æ³•,å•ç±»):</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest()</span> <span class="comment">// è·å–springbootçš„å¯åŠ¨ç±»</span></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CalculatorTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// springæ”¯æŒIOC: æ§åˆ¶åè½¬  å†è¿›è¡ŒDIæ³¨å…¥</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Calculator calculator;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">add</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">add</span> <span class="operator">=</span> calculator.add(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="comment">// ä¼ ç»Ÿsoutè¾“å‡º   ä¸æ¨è</span></span><br><span class="line">        <span class="comment">// æ¨è  æ–­è¨€</span></span><br><span class="line">        <span class="comment">// ä¼˜ç‚¹: ä¸é¢„æœŸç»“æœä¸€è‡´,ç»¿   ä¸ä¸€è‡´:çº¢   ä¾¿äºæ•æ‰æ²¡é€šè¿‡é¢„æœŸçš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">//        System.out.println(&quot;add = &quot; + add);</span></span><br><span class="line">        Assert.assertEquals(<span class="number">3</span>, add); <span class="comment">// ç»¿</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç°åœ¨éœ€æ±‚æ˜¯: å‡å¦‚æœ‰å¤šä¸ªç±»,ç±»é‡Œé¢æœ‰å¾ˆå¤šæ–¹æ³•éœ€è¦æµ‹è¯•,é‚£è¯¥æ€ä¹ˆå®ç°ä¸€èµ·è‡ªåŠ¨åŒ–æµ‹è¯•?</strong></p><p>: ä½¿ç”¨SpringBootçš„å¥—ä»¶æµ‹è¯• , é¡¾åæ€ä¹‰:æŠŠæµ‹è¯•æ–¹æ³•ç±»å…¨éƒ¨æ”¾ä¸€èµ·æµ‹è¯•,å°±è·Ÿä¸€ä¸ªæ•´ä½“å¥—ä»¶ä¸€æ ·</p><p>å¯åŠ¨å½“å‰ç±»å°±å¯ä»¥äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å½“å‰æ–¹æ³•æ˜¯æµ‹è¯•å¥—ä»¶</span></span><br><span class="line"><span class="comment"> * å°±æ˜¯æŠŠCalculatorTest å’Œ OtherTest </span></span><br><span class="line"><span class="comment"> * ä¸¤ä¸ªç±»é‡Œé¢çš„æ–¹æ³• å…¨éƒ¨ä¸€èµ·æµ‹è¯•,å‡å¦‚ç”¨äº†æ–­è¨€ æµ‹è¯•å®Œæˆå</span></span><br><span class="line"><span class="comment"> * é€šè¿‡ä¸æœªé€šè¿‡ä¸€ç›®äº†ç„¶</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith(Suite.class)</span></span><br><span class="line"><span class="meta">@Suite</span>.SuiteClasses(&#123;CalculatorTest.class,OtherTest.class&#125;) <span class="comment">// æµ‹è¯•æŒ‡å®šç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SuiteTest</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="äºŒã€å…¶ä»–çš„æ³¨è§£"><a href="#äºŒã€å…¶ä»–çš„æ³¨è§£" class="headerlink" title="äºŒã€å…¶ä»–çš„æ³¨è§£:"></a>äºŒã€å…¶ä»–çš„æ³¨è§£:</h4><h4 id="1-Disabled"><a href="#1-Disabled" class="headerlink" title="1) @Disabled"></a><code>1) @Disabled</code></h4><p>ï¼šç¦ç”¨æµ‹è¯•æ–¹æ³•,  ç”¨äºå½“å‰æ–¹æ³•ç°åœ¨ä¸éœ€è¦è¿›è¡Œæµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@Disabled(&quot;This test is not ready yet.&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">disabledTest</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// æ²¡æœ‰å†™å®Œçš„é€»è¾‘ æˆ–æ˜¯ å·²ç»ä¸éœ€è¦æµ‹è¯•çš„é€»è¾‘</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-TestMethodOrder-å’Œ-Order"><a href="#2-TestMethodOrder-å’Œ-Order" class="headerlink" title="2) @TestMethodOrder å’Œ @Order"></a><code>2) @TestMethodOrder</code> å’Œ <code>@Order</code></h4><p>ï¼šé…ç½®æµ‹è¯•æ–¹æ³•çš„æ‰§è¡Œé¡ºåº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TestMethodOrder(MethodOrderer.OrderAnnotation.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Order(1)</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMethod1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// åœ¨è¿™é‡Œå†™æµ‹è¯•é€»è¾‘</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Order(2)</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMethod2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// åœ¨è¿™é‡Œå†™æµ‹è¯•é€»è¾‘</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-BeforeAll-å’Œ-AfterAll"><a href="#3-BeforeAll-å’Œ-AfterAll" class="headerlink" title="3) @BeforeAll å’Œ @AfterAll"></a><code>3) @BeforeAll</code> å’Œ <code>@AfterAll</code></h4><p>ï¼šåœ¨æµ‹è¯•ç±»çš„æ‰€æœ‰æµ‹è¯•æ–¹æ³•å‰å’Œåæ‰§è¡Œä¸€æ¬¡ï¼Œå¯ç”¨äºå…¨å±€åˆå§‹åŒ–å’Œé”€æ¯èµ„æº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@BeforeAll</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">initOperate</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–æ“ä½œ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@AfterAll</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">destoryOperate</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// èµ„æºé”€æ¯æ“ä½œ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-BeforeEach-å’Œ-AfterEach"><a href="#4-BeforeEach-å’Œ-AfterEach" class="headerlink" title="4) @BeforeEach å’Œ @AfterEach"></a><code>4) @BeforeEach</code> å’Œ <code>@AfterEach</code></h4><p>ï¼šåœ¨æµ‹è¯•ç±»çš„æ¯ä¸ªæµ‹è¯•æ–¹æ³•å‰å’Œåéƒ½ä¼šæ‰§è¡Œä¸€æ¬¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@BeforeEach</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeEachTest</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// æ‰§è¡Œå‰çš„å‡†å¤‡å·¥ä½œ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@AfterEach</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterEachTest</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// æ‰§è¡Œåçš„æ¸…ç†å·¥ä½œ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="5-RepeatedTest"><a href="#5-RepeatedTest" class="headerlink" title="5) @RepeatedTest"></a><code>5) @RepeatedTest</code></h4><p>ï¼šæŒ‡å®šæµ‹è¯•æ–¹æ³•é‡å¤æ‰§è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RepeatedTest(6)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">repeatedTest</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// è¯¥æµ‹è¯•æ–¹æ³•ä¼šé‡å¤æ‰§è¡Œ6æ¬¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="6-ParameterizedTest-å’Œ-ValueSource"><a href="#6-ParameterizedTest-å’Œ-ValueSource" class="headerlink" title="6) @ParameterizedTest å’Œ @ValueSource"></a><code>6) @ParameterizedTest</code> å’Œ <code>@ValueSource</code></h4><p>ï¼šç”¨äºå‚æ•°åŒ–æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ParameterizedTest</span></span><br><span class="line"><span class="meta">@ValueSource(strings = &#123; &quot;name1&quot;, &quot;name2&quot;, &quot;name3&quot; &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testParameter</span><span class="params">(String name)</span> &#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨å‚æ•°åŒ–çš„åç§°è¿›è¡Œæµ‹è¯•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="7-AutoConfigureMockMvc"><a href="#7-AutoConfigureMockMvc" class="headerlink" title="7) @AutoConfigureMockMvc"></a><code>7) @AutoConfigureMockMvc</code></h4><p>ï¼šå¯ç”¨MockMvcçš„è‡ªåŠ¨é…ç½®ï¼Œå¯ç”¨äºæµ‹è¯•æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@AutoConfigureMockMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyControllerIntegrationTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MockMvc mockMvc;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testController</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        mockMvc.perform(get(<span class="string">&quot;/api/someendpoint&quot;</span>))</span><br><span class="line">                .andExpect(status().isOk())</span><br><span class="line">                .andExpect(content().contentType(MediaType.APPLICATION_JSON));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ‡æ¢æœåŠ¡å™¨"><a href="#åˆ‡æ¢æœåŠ¡å™¨" class="headerlink" title="åˆ‡æ¢æœåŠ¡å™¨"></a>åˆ‡æ¢æœåŠ¡å™¨</h3><p>åœ¨pom.xmlé‡Œé¢ä¿®æ”¹,ä¾‹å¦‚éœ€è¦æŠŠtomcatä¿®æ”¹ä¸ºundertow</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 1. ä»starter-webä¸­æ’é™¤tomcat(åŸæ¥çš„æœåŠ¡å™¨)ä¾èµ– --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  2. åŠ å…¥æ–°çš„æœåŠ¡å™¨ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-undertow<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>éƒ¨åˆ†æ‰§è¡Œæ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹</p><img src="/2023/10/08/SpringBoot/Snipaste_2023-10-11_21-04-37.png" class></blockquote><h3 id="å®šæ—¶å™¨"><a href="#å®šæ—¶å™¨" class="headerlink" title="å®šæ—¶å™¨"></a>å®šæ—¶å™¨</h3><ol><li>åœ¨å¯åŠ¨ç±»ä¸­æ ‡æ˜æ³¨è§£<code>@EnableScheduling</code></li><li>ç¼–å†™ä¸€ä¸ªJobä»»åŠ¡ç±»,åœ¨ç±»ä¸Šé¢æ ‡æ˜@Componentæ³¨è§£ç»™springæ‰˜ç®¡</li><li>åœ¨@<code>Scheduled</code>ä¸­å†™cronè¡¨è¾¾å¼è®¾ç½®å®šæ—¶</li></ol><p>ä»¥Redisç¼“å­˜æ–‡ç« æµè§ˆé‡åŒæ­¥æ•°æ®åº“ä¸ºä¾‹: (å½“å‰éœ€è¦åœ¨<strong>å¯åŠ¨æ—¶</strong>,éœ€è¦æœ‰ç¼“å­˜,éœ€è¦çœ‹ä¸‹é¢çš„<strong>å¯åŠ¨ä»»åŠ¡</strong>)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UpdateViewCountJob</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisCache redisCache;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ArticleService articleService;</span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0 */10 * * * ?&quot;)</span> <span class="comment">// å¼€å¯å®šæ—¶ä»»åŠ¡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateViewCountJob</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// è·å–redisä¸­å­˜å–çš„æµè§ˆé‡</span></span><br><span class="line">        Map&lt;String, Integer&gt; viewCountMap = redisCache.getCacheMap(SystemConstants.ARTICLE_VIEW_COUNT);</span><br><span class="line">        <span class="comment">// åŒåˆ—é›†åˆä¸èƒ½ç”¨æµ,å¯ä»¥å…ˆè½¬entrySet(é”®å€¼å¯¹)æˆ–è€…keySet</span></span><br><span class="line">        List&lt;Article&gt; articleList = viewCountMap.entrySet()</span><br><span class="line">                .stream()                            <span class="comment">//  key(long)  value(long)</span></span><br><span class="line">                .map(entry -&gt; <span class="keyword">new</span> <span class="title class_">Article</span>(Long.valueOf(entry.getKey()), entry.getValue().longValue()))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        <span class="comment">// æ›´æ–°åˆ°æ•°æ®åº“</span></span><br><span class="line">        articleService.updateBatchById(articleList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨å‰é¢„åŠ è½½æœåŠ¡"><a href="#å¯åŠ¨å‰é¢„åŠ è½½æœåŠ¡" class="headerlink" title="å¯åŠ¨å‰é¢„åŠ è½½æœåŠ¡"></a>å¯åŠ¨å‰é¢„åŠ è½½æœåŠ¡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> ViewCountRunner</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> åœ¨å¯åŠ¨ä¹‹å‰å¯¹æµè§ˆé‡è¿›è¡ŒæŸ¥è¯¢ ç„¶åç¼“å­˜åˆ°redisé‡Œé¢</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ViewCountRunner</span> <span class="keyword">implements</span> <span class="title class_">CommandLineRunner</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ArticleMapper articleMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisCache redisCache;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// æŸ¥è¯¢åšå®¢ä¿¡æ¯ id + viewCount           key value</span></span><br><span class="line">        List&lt;Article&gt; articleList = articleMapper.selectList(<span class="literal">null</span>);</span><br><span class="line">        Map&lt;String, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"><span class="comment">//        articleList.forEach(item-&gt;&#123;</span></span><br><span class="line"><span class="comment">//            map.put(String.valueOf(item.getId()),item.getViewCount());</span></span><br><span class="line"><span class="comment">//        &#125;);</span></span><br><span class="line">        map = articleList.stream()</span><br><span class="line">                .collect(Collectors.toMap(article -&gt; article.getId().toString(), <span class="comment">// key</span></span><br><span class="line">                        article -&gt; &#123;                                  <span class="comment">// value</span></span><br><span class="line">                            <span class="keyword">return</span> article.getViewCount().intValue();   <span class="comment">// 1L åœ¨redisä¸­è¦ç”¨Integer</span></span><br><span class="line">                        &#125;));</span><br><span class="line">        <span class="comment">// å­˜å‚¨åˆ°redis</span></span><br><span class="line">        redisCache.setCacheMap(SystemConstants.ARTICLE_VIEW_COUNT,map);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰çš„Runnerå®ç°äº†<code>CommandLineRunner</code>ç±»,é‡å†™runæ–¹æ³•,è¯¥æ–¹æ³•åœ¨SpringBootå¯åŠ¨æ—¶ä¹Ÿä¼šåŒæ­¥æ‰§è¡Œè¯¥ä»»åŠ¡,è¿™ä¸ªæ˜¯SpringBootæä¾›çš„ç®€å•ç±»</p><p>: å¦‚æœåœ¨ä¸Šä¸‹æ–‡ä¸­ï¼Œå­˜åœ¨å¤šä¸ªè¯¥æ¥å£å®ç°ç±»ï¼Œå¯ä»¥é€šè¿‡@orderæ³¨è§£ï¼ŒæŒ‡å®šåŠ è½½é¡ºåº</p><p>@Orderå†™åœ¨å®ç°ç±»ä¸Š  ä¾‹å¦‚@Order(value &#x3D; 1)   è¶Šå‰è¶Šå¿«æ‰§è¡Œ</p><hr><h3 id="SpringBootçš„è‡ªåŠ¨é…ç½®"><a href="#SpringBootçš„è‡ªåŠ¨é…ç½®" class="headerlink" title="SpringBootçš„è‡ªåŠ¨é…ç½®"></a>SpringBootçš„è‡ªåŠ¨é…ç½®</h3><h4 id="1ã€äº†è§£æ³¨è§£åŠä¸€äº›ç±»"><a href="#1ã€äº†è§£æ³¨è§£åŠä¸€äº›ç±»" class="headerlink" title="1ã€äº†è§£æ³¨è§£åŠä¸€äº›ç±»"></a>1ã€äº†è§£æ³¨è§£åŠä¸€äº›ç±»</h4><h5 id="Configurationç»“åˆ-Bean"><a href="#Configurationç»“åˆ-Bean" class="headerlink" title="@Configurationç»“åˆ@Bean"></a><code>@Configurationç»“åˆ@Bean</code></h5><p>eg. <code>@Configuration</code>,é‡Œé¢çš„<code>proxyBeanMethods</code>å±æ€§ true : false</p><p>proxyBeanMethodsé…ç½®ç±»æ˜¯ç”¨æ¥æŒ‡å®š@Beanæ³¨è§£æ ‡æ³¨çš„æ–¹æ³•æ˜¯å¦ä½¿ç”¨ä»£ç†ï¼Œ<strong>é»˜è®¤æ˜¯trueä½¿ç”¨åŠ¨æ€ä»£ç†</strong>ï¼Œç›´æ¥ä»IOCå®¹å™¨ä¹‹ä¸­å–å¾—å¯¹è±¡ï¼›<br>å¦‚æœè®¾ç½®ä¸ºfalse,ä¹Ÿå°±æ˜¯ä¸ä½¿ç”¨æ³¨è§£ï¼Œæ¯æ¬¡è°ƒç”¨@Beanæ ‡æ³¨çš„æ–¹æ³•è·å–åˆ°çš„å¯¹è±¡å’ŒIOCå®¹å™¨ä¸­çš„éƒ½ä¸ä¸€æ ·ï¼Œæ˜¯ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†æ­¤å±æ€§è®¾ç½®ä¸ºfalseæ¥<strong>æé«˜æ€§èƒ½</strong>,ä½†æ˜¯ä¸èƒ½æ‰©å±•,ä¾‹å¦‚AOPåˆ‡é¢</p><p><strong>ä¼˜ç¼ºç‚¹</strong>ï¼š è®¾ç½®trueåŠ¨æ€ä»£ç†çš„å¯ä»¥åæœŸè¢«åˆ‡é¢å¢å¼ºï¼Œä½†æ˜¯å¯åŠ¨é€Ÿåº¦æ€§èƒ½æ…¢äº›ï¼Œè®¾ç½®falseåˆ™ä½¿ç”¨newå¯¹è±¡ï¼Œæé«˜æ€§èƒ½ä½†æ˜¯ä¸èƒ½è¢«å¢å¼º</p><h5 id="EnableAutoConfiguration-xx-class"><a href="#EnableAutoConfiguration-xx-class" class="headerlink" title="@EnableAutoConfiguration(xx.class)"></a><code>@EnableAutoConfiguration(xx.class)</code></h5><p>å¸®åŠ©SpringBootåº”ç”¨å°†æ‰€æœ‰<strong>ç¬¦åˆæ¡ä»¶</strong>çš„<code>@Configuration</code>é…ç½®éƒ½åŠ è½½åˆ°å½“å‰SpringBootï¼Œå¹¶åˆ›å»ºå¯¹åº”<strong>é…ç½®ç±»çš„Bean</strong>ï¼Œå¹¶æŠŠè¯¥Beanå®ä½“äº¤ç»™IoCå®¹å™¨è¿›è¡Œç®¡ç† </p><p>è¯¥æ³¨è§£çš„åŠŸèƒ½æ›´å¼ºå¤§,<strong>æ‰˜ç®¡é…ç½®ç±»å¹¶æŠŠbeanæ‰˜ç®¡</strong>,<strong>å¯ä»¥è¯»å–å±æ€§æ–‡ä»¶æ³¨å…¥</strong></p><h5 id="ConfigurationProperties-prefix"><a href="#ConfigurationProperties-prefix" class="headerlink" title="@ConfigurationProperties(prefix = &quot;&quot;)"></a><code>@ConfigurationProperties(prefix = &quot;&quot;)</code></h5><p>ä¸€æ¬¡æ€§è¯»å–ç¬¦åˆå‰ç¼€çš„å±æ€§é…ç½®æ–‡ä»¶,åªèƒ½æ³¨å…¥å±æ€§</p><h5 id="Import"><a href="#Import" class="headerlink" title="@Import"></a><code>@Import</code></h5><ol><li><p>å¯¼å…¥å¤–éƒ¨çš„classæ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import(&#123;Apple.class,Product.class&#125;)</span> <span class="comment">// å¯¼å…¥ä¸¤ä¸ªclass</span></span><br><span class="line"><span class="comment">// æ­¤æ—¶çš„å®ä¾‹åŒ–æ³¨å…¥å¯¹è±¡,æ˜¯è¿™ç§å½¢å¼çš„ ä¾‹å¦‚ Appleç±»åŸæ¥åœ¨å¤–éƒ¨æ–‡ä»¶ä¸­ org.friutä¸­</span></span><br><span class="line"><span class="comment">// é‚£ä¹ˆç”±è¯¥æ–¹æ³•å®ä¾‹åŒ–çš„å¯¹è±¡çš„idæ˜¯è¿™æ ·çš„  &quot;org.friut.Apple&quot; </span></span><br></pre></td></tr></table></figure><p>2.å¯¼å…¥ä¸€ä¸ªåŒ…çš„å¤šä¸ªç±»</p></li></ol><p>å‡å¦‚éœ€è¦å¯¼å…¥çš„ç±»å¤šäº†,é‚£ä¹ˆåˆ™éœ€è¦ä½¿ç”¨è¯¥æ–¹å¼,æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç±»å®ç°<code>ImportSelector</code>æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ImportList</span> <span class="keyword">implements</span> <span class="title class_">ImportSelector</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] selectImports(AnnotationMetadata importingClassMetadata) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;META-INF/&quot;</span></span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> File file = new File(url); // å°†æ‰€æœ‰éœ€è¦çš„å…¨ç±»å å°è£…åˆ°ä¸€ä¸ªå›ºå®šçš„æ–‡ä»¶å†… åœ¨ä¾æ¬¡è¯»å–</span></span><br><span class="line">        <span class="comment">// file.listFile();</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;</span><br><span class="line">            <span class="comment">// æŠŠæ‰«æåˆ°çš„æ–‡ä»¶åæ·»åŠ åˆ°æ­¤å¤„</span></span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åä½¿ç”¨<code>@Import(&#123;ImportList.class,Other.class&#125;)</code>å¯¼å…¥åˆšåˆšçš„ç±»</p><h5 id="ApplicationContextAwareæ¥å£åœ¨ç±»ä¸­æ³¨å…¥Springå®¹å™¨å¯¹è±¡"><a href="#ApplicationContextAwareæ¥å£åœ¨ç±»ä¸­æ³¨å…¥Springå®¹å™¨å¯¹è±¡" class="headerlink" title="ApplicationContextAwareæ¥å£åœ¨ç±»ä¸­æ³¨å…¥Springå®¹å™¨å¯¹è±¡"></a>ApplicationContextAwareæ¥å£åœ¨ç±»ä¸­æ³¨å…¥Springå®¹å™¨å¯¹è±¡</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringBeansGetInfoClass</span> <span class="keyword">implements</span> <span class="title class_">ApplicationContextAware</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> ApplicationContext context;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="built_in">this</span>.context = applicationContext;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¯»å–beanName</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/getSpringBeanInfo&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getBeanNameInfo</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (String name : <span class="built_in">this</span>.context.getBeanDefinitionNames()) &#123;</span><br><span class="line">            System.out.println(name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å®ç°<code>ApplicationContextAware</code>æ¥å£çš„ç±»å¿…é¡»è¢«Springæ‰€ç®¡ç†</p><p>ä½œç”¨: æ¢å¥è¯è¯´ï¼Œå°±æ˜¯è¿™ä¸ªç±»å¯ä»¥ç›´æ¥è·å–Springé…ç½®æ–‡ä»¶ä¸­ï¼Œæ‰€æœ‰æœ‰å¼•ç”¨åˆ°çš„Beanå¯¹è±¡</p></blockquote><h5 id="Conditional"><a href="#Conditional" class="headerlink" title="@Conditional"></a><code>@Conditional</code></h5><p><strong>æ¡ä»¶åˆ¤æ–­æ³¨è§£</strong></p><p>ä¾‹å¦‚,æˆ‘éœ€è¦åŠ¨æ€åŠ è½½Tomcatæˆ–JettyæœåŠ¡å™¨,å³ å¦‚æœå®¹å™¨ä¸­æœ‰æœåŠ¡å™¨æŸBeanåˆ™åŠ è½½,å½“ç„¶è¿˜è¦åˆ¤æ–­æ˜¯å¦æœ‰å¤šä¸ªæœåŠ¡å™¨åˆ¤æ–­(å½“å‰å®ä¾‹æœªåšåˆ¤æ–­,å…·ä½“çœ‹<a href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AEWebServer%E6%9C%8D%E5%8A%A1">è‡ªåŠ¨é…ç½®WebServeræœåŠ¡</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  è¿™ä¸ªæ˜¯ä¸€ä¸ªWebServerè‡ªåŠ¨é…ç½®ç±»</span></span><br><span class="line"><span class="comment"> *  è¯¥æ¡ˆä¾‹ä¸ºåŠ¨æ€åˆ‡æ¢Tomcatå’ŒJettyæœåŠ¡å™¨çš„å®ä¾‹é…ç½®ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span> <span class="comment">// äº¤ç»™Springç®¡ç†</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebServerAutoConfiguration</span> &#123;</span><br><span class="line">    <span class="comment">// Springé…ç½®æ–‡ä»¶</span></span><br><span class="line">    <span class="comment">// WebServerè‡ªåŠ¨é…ç½®ç±»</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="comment">// æ¡ä»¶åŠ è½½,æ ¹æ®TomcatConditionä¸­çº¦æŸçš„æ¡ä»¶,åŠ¨æ€æ³¨å…¥Bean</span></span><br><span class="line">    <span class="meta">@Conditional(TomcatCondition.class)</span> </span><br><span class="line">    <span class="keyword">public</span> TomcatWebServer <span class="title function_">tomcatWebServer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TomcatWebServer</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Conditional(JettyCondition.class)</span> <span class="comment">// JettyæœåŠ¡å™¨æ¡ä»¶åŠ è½½åˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">public</span> JettyWebServer <span class="title function_">jettyWebServer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JettyWebServer</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¡ä»¶åˆ¤æ–­ç±» å¿…é¡»å®ç°Conditionæ¥å£,é‡å†™matchesæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TomcatCondition</span> <span class="keyword">implements</span> <span class="title class_">Condition</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(ConditionContext conditionContext, AnnotatedTypeMetadata annotatedTypeMetadata)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ¤æ–­é¡¹ç›®ä¸­æ˜¯å¦æœ‰ç¬¦åˆæ¡ä»¶çš„ä¾èµ–</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// åˆ©ç”¨ç±»åŠ è½½å™¨,åŠ è½½éœ€è¦åˆ¤æ–­çš„ç±»</span></span><br><span class="line">  conditionContext.getClassLoader().loadClass(<span class="string">&quot;org.apache.catalina.startup.Tomcat&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;<span class="comment">// èƒ½èµ°åˆ°è¿™ä¸ªåœ°æ–¹ è¯æ˜æœ‰</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// æ²¡æœ‰è¯¥ç±»</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        // å¦‚æœè¿”å›true,åˆ™ç¬¦åˆæ¡ä»¶</span></span><br><span class="line"><span class="comment">//        return false;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2ã€è‡ªåŠ¨é…ç½®start"><a href="#2ã€è‡ªåŠ¨é…ç½®start" class="headerlink" title="2ã€è‡ªåŠ¨é…ç½®start"></a>2ã€è‡ªåŠ¨é…ç½®start</h4><h5 id="æ ·ä¾‹ä¸€-DataSource"><a href="#æ ·ä¾‹ä¸€-DataSource" class="headerlink" title="æ ·ä¾‹ä¸€: DataSource"></a>æ ·ä¾‹ä¸€: DataSource</h5><p>ä»¥è¯»å–<code>spring.datasource</code>ä¸ºä¾‹:</p><p>ä¾‹å¦‚æˆ‘çš„<code>application.yml</code>å¦‚ä¸‹:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=UTC&amp;useSSL=true</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br><span class="line">    <span class="attr">time-zone:</span> <span class="string">GMT+8</span></span><br><span class="line">    <span class="attr">serialization:</span></span><br><span class="line">      <span class="attr">write-dates-as-timestamps:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æºç </p><img src="/2023/10/08/SpringBoot/jdbc.png" class><p>æˆ‘ä»¬ç®€å•çš„æŸ¥çœ‹åˆ°,è¯¥ç±»é‡Œé¢åŒ…å«ä¸€äº›é€šç”¨çš„æ•°æ®æºå±æ€§,å¹¶ä¸”é€šè¿‡æ³¨è§£<code>@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)</code>è¯»å–<code>application.yml</code>é…ç½®æ–‡ä»¶è®¾ç½®çš„å€¼,  <strong>ä½†æ˜¯æ³¨æ„åˆ°,è¯¥å±æ€§åœ¨æ­¤å¤„å¹¶æœªåœ¨springå®¹å™¨ä¸­æ³¨å…¥</strong>,é‚£ä¹ˆspringæ˜¯å¦‚ä½•è¿›è¡Œåˆå§‹åŒ–çš„å‘¢?</p><p>å½“å‰æ˜¯è‡ªåŠ¨è£…é…,é‚£å½“ç„¶æ˜¯è‡ªåŠ¨è£…é…äº†,é‚£ä¹ˆæ˜¯åœ¨å“ªå„¿è‡ªåŠ¨è£…é…? </p><p>: åœ¨æ­¤åŒ…ä¸­ , å¾ˆå®¹æ˜“æ‰¾åˆ°ä¸€ä¸ªåä¸º<code>DatasourceAutoConfiguration</code>çš„ç±» ,é€šè¿‡ç±»åæ³¨æ„åˆ°è¿™å¾ˆæ˜¾ç„¶æ˜¯ä¸€ä¸ª<strong>è‡ªåŠ¨è£…é…æ•°æ®æºçš„ç±»</strong></p><img src="/2023/10/08/SpringBoot/reg_ioc.png" class><p>æ‰¾åˆ°è‡ªåŠ¨é…ç½®ç±», å³ å¸¦<code>@EnableConfigurationProperties</code>æ³¨è§£çš„ç±», é€šè¿‡æ­¤æ³¨è§£å¯¹åˆšåˆšå·²ç»æ³¨å…¥å±æ€§çš„ç±»è¿›è¡ŒIOCæ³¨å†Œ, é‚£ä¹ˆè¿™ä¸ªå°±è¢«è‡ªåŠ¨è£…é…äº†</p><hr><h5 id="æ ·ä¾‹äºŒ-WebServer"><a href="#æ ·ä¾‹äºŒ-WebServer" class="headerlink" title="æ ·ä¾‹äºŒ: WebServer"></a>æ ·ä¾‹äºŒ: WebServer</h5><p>åœ¨æ­¤å¤„,å†ä¸¾ä¸€ä¸ªä¾‹å­(<strong>æ ·ä¾‹äºŒ</strong>)å¦‚ä¸‹,ä¾‹å¦‚æˆ‘éœ€è¦å¯¹æœåŠ¡å™¨çš„é…ç½® , æ¯”å¦‚<code>server.port=9090</code>æœåŠ¡å™¨çš„ç«¯å£ç­‰ </p><p>æ­¥éª¤ä¸€: å¯¹æœåŠ¡å™¨çš„åŸºç¡€é…ç½®è¿›è¡Œè¯»å–</p><p>æ–‡ä»¶åœ¨<code>org.springframework.boot</code>çš„ <code>spring-boot-autoconfigure</code>é‡Œé¢çš„<code>org.springframework.boot.autoconfigure.web.ServerProperties</code></p><p>ServerPropertiesç±» é‡Œé¢åŒæ ·å¯ä»¥çœ‹åˆ°æ³¨è§£<code>@ConfigurationProperties</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(</span></span><br><span class="line"><span class="meta">    prefix = &quot;server&quot;, // è¯»å–é…ç½®æ–‡ä»¶å±æ€§</span></span><br><span class="line"><span class="meta">    ignoreUnknownFields = true</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServerProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer port;</span><br><span class="line">    <span class="keyword">private</span> InetAddress address;</span><br><span class="line">    <span class="meta">@NestedConfigurationProperty</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ErrorProperties</span> <span class="variable">error</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ErrorProperties</span>();</span><br><span class="line">    <span class="keyword">private</span> ForwardHeadersStrategy forwardHeadersStrategy;</span><br><span class="line">    <span class="keyword">private</span> String serverHeader;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">DataSize</span> <span class="variable">maxHttpHeaderSize</span> <span class="operator">=</span> DataSize.ofKilobytes(<span class="number">8L</span>);</span><br><span class="line">    <span class="keyword">private</span> Shutdown shutdown;</span><br><span class="line">    <span class="meta">@NestedConfigurationProperty</span></span><br><span class="line">    <span class="keyword">private</span> Ssl ssl;</span><br><span class="line">    <span class="meta">@NestedConfigurationProperty</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Compression compression;</span><br><span class="line">    <span class="meta">@NestedConfigurationProperty</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Http2 http2;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Servlet servlet;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Reactive reactive;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Tomcat tomcat;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Jetty jetty;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Netty netty;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Undertow undertow;</span><br><span class="line"><span class="comment">// æ–¹æ³•çœç•¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¥éª¤äºŒ: å¯¹æœåŠ¡å™¨é…ç½®å®Œæˆçš„ç±»åœ¨IOCå®¹å™¨ä¸­è¿›è¡Œæ³¨å†Œbean</p><p>åœ¨å½“å‰çš„packageä¸‹çš„</p><p><code>org.springframework.boot.autoconfigure.web.embedded.EmbeddedWebServerFactoryCustomizerAutoConfiguration</code></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç†Ÿæ‚‰çš„ç»“æ„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfiguration</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span>  <span class="comment">// æ³¨å†ŒServerPropertiesé…ç½®ç±»</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;ServerProperties.class&#125;)</span> <span class="comment">// ä¸»è¦æ³¨è§£</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmbeddedWebServerFactoryCustomizerAutoConfiguration</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">EmbeddedWebServerFactoryCustomizerAutoConfiguration</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Configuration(</span></span><br><span class="line"><span class="meta">        proxyBeanMethods = false</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="meta">@ConditionalOnClass(&#123;HttpServer.class&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">NettyWebServerFactoryCustomizerConfiguration</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">NettyWebServerFactoryCustomizerConfiguration</span><span class="params">()</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="keyword">public</span> NettyWebServerFactoryCustomizer <span class="title function_">nettyWebServerFactoryCustomizer</span><span class="params">(Environment environment, ServerProperties serverProperties)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">NettyWebServerFactoryCustomizer</span>(environment, serverProperties);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä»¥ä¸‹çš„çœç•¥   </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ä¸¤ä¸ªæ ·ä¾‹æ€»ç»“"><a href="#ä¸¤ä¸ªæ ·ä¾‹æ€»ç»“" class="headerlink" title="ä¸¤ä¸ªæ ·ä¾‹æ€»ç»“"></a><strong>ä¸¤ä¸ªæ ·ä¾‹æ€»ç»“</strong></h5><p>ä»ä»¥ä¸Šæ­¥éª¤å¯ä»¥çœ‹å‡ºspring-boot-starterçš„é…ç½®æµç¨‹è¾ƒç®€å•ï¼Œç®€åŒ–ä¸€ä¸‹æµç¨‹å³ä¸ºï¼š</p><p>1.æ·»åŠ <code>@ConfigurationProperties</code>è¯»å–application.ymlé…ç½®æ–‡ä»¶<br>2.é…ç½®<code>@EnableAutoConfiguration</code>æ³¨è§£ç±»ï¼Œè‡ªåŠ¨æ‰«æpackageç”Ÿæˆæ‰€éœ€bean<br>3.æ·»åŠ <strong>spring.factories</strong>é…ç½®è®©spring-boot-autoconfigureå¯¹å½“å‰é¡¹ç›®è¿›è¡ŒAutoConfiguration</p><h5 id="SpringBootè‡ªåŠ¨é…ç½®"><a href="#SpringBootè‡ªåŠ¨é…ç½®" class="headerlink" title="SpringBootè‡ªåŠ¨é…ç½®"></a>SpringBootè‡ªåŠ¨é…ç½®</h5><p>æ ·ä¾‹æ€»ç»“ è¯´åˆ°è¯»å–<strong>spring.factories</strong>,é‚£ä¹ˆspringbootåº•å±‚æ˜¯å¦‚ä½•è¿›è¡Œè¯»å–,å¹¶ä¸”è‡ªåŠ¨é…ç½®å‘¢?</p><p>é¦–å…ˆæˆ‘ä»¬ä»å¯åŠ¨ç±»å…¥å£å…¥æ‰‹,<code>@SpringBootApplication</code> , è¿½è¸ªå‘ç°æ³¨è§£<code>@EnableAutoConfiguration</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span> <span class="comment">// è‡ªåŠ¨è£…é…</span></span><br><span class="line"><span class="meta">@ComponentScan(</span></span><br><span class="line"><span class="meta">    excludeFilters = &#123;@Filter(</span></span><br><span class="line"><span class="meta">    type = FilterType.CUSTOM,</span></span><br><span class="line"><span class="meta">    classes = &#123;TypeExcludeFilter.class&#125;</span></span><br><span class="line"><span class="meta">), @Filter(</span></span><br><span class="line"><span class="meta">    type = FilterType.CUSTOM,</span></span><br><span class="line"><span class="meta">    classes = &#123;AutoConfigurationExcludeFilter.class&#125;</span></span><br><span class="line"><span class="meta">)&#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootApplication &#123;</span><br><span class="line">    <span class="meta">@AliasFor(</span></span><br><span class="line"><span class="meta">        annotation = EnableAutoConfiguration.class</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    Class&lt;?&gt;[] exclude() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"><span class="comment">// ç•¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰“å¼€<code>@EnableAutoConfiguration</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@AutoConfigurationPackage</span></span><br><span class="line"><span class="meta">@Import(&#123;AutoConfigurationImportSelector.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAutoConfiguration &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">ENABLED_OVERRIDE_PROPERTY</span> <span class="operator">=</span> <span class="string">&quot;spring.boot.enableautoconfiguration&quot;</span>;</span><br><span class="line">    Class&lt;?&gt;[] exclude() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">    String[] excludeName() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ƒå¯¼å…¥äº†ä¸€ä¸ªåä¸º<code>AutoConfigurationImportSelector</code>çš„è‡ªåŠ¨è£…é…ç±»é€‰æ‹©å™¨ , å¹¶ä¸”è¿½è¸ª, å®ƒå®ç°äº†DeferredImportSelector è¯¥ç±»ä¸º ImportSelectorçš„å­ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AutoConfigurationImportSelector</span> <span class="keyword">implements</span> <span class="title class_">DeferredImportSelector</span>, BeanClassLoaderAware, ResourceLoaderAware, BeanFactoryAware, EnvironmentAware, Ordered &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">AutoConfigurationEntry</span> <span class="variable">EMPTY_ENTRY</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AutoConfigurationEntry</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] NO_IMPORTS = <span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Log</span> <span class="variable">logger</span> <span class="operator">=</span> LogFactory.getLog(AutoConfigurationImportSelector.class);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PROPERTY_NAME_AUTOCONFIGURE_EXCLUDE</span> <span class="operator">=</span> <span class="string">&quot;spring.autoconfigure.exclude&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> ConfigurableListableBeanFactory beanFactory;</span><br><span class="line">    <span class="keyword">private</span> Environment environment;</span><br><span class="line">    <span class="keyword">private</span> ClassLoader beanClassLoader;</span><br><span class="line">    <span class="keyword">private</span> ResourceLoader resourceLoader;</span><br><span class="line">    <span class="keyword">private</span> ConfigurationClassFilter configurationClassFilter;</span><br><span class="line"><span class="comment">// æ­¤å¤„æ–¹æ³•æ„é€ å™¨çœç•¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ImportSelectorç±»,å®ç°è¯¥ç±»é‡å†™æ–¹æ³•è·å–éœ€è¦æ‰«æçš„åŒ… , å¹¶ä¸”è¿”å›å…¨ç±»å</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ImportSelector</span> &#123;</span><br><span class="line">    <span class="comment">// é‡å†™è¯¥æ–¹æ³•</span></span><br><span class="line">    String[] selectImports(AnnotationMetadata importingClassMetadata);</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">default</span> Predicate&lt;String&gt; <span class="title function_">getExclusionFilter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨AutoConfigurationImportSelectorä¸­å®ç°äº†selectImportsæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„,ä¿å­˜æ‰«æç±»çš„è·¯å¾„</span></span><br><span class="line"><span class="keyword">public</span> String[] selectImports(AnnotationMetadata annotationMetadata) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.isEnabled(annotationMetadata)) &#123;</span><br><span class="line">        <span class="keyword">return</span> NO_IMPORTS;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">AutoConfigurationEntry</span> <span class="variable">autoConfigurationEntry</span> <span class="operator">=</span> </span><br><span class="line">            <span class="comment">// é€šè¿‡è¯¥æ–¹æ³•(getAutoConfigurationEntry)è·å–è‡ªåŠ¨é…ç½®çš„é¡¹</span></span><br><span class="line">            <span class="built_in">this</span>.getAutoConfigurationEntry(annotationMetadata);</span><br><span class="line">        <span class="keyword">return</span> StringUtils.toStringArray(autoConfigurationEntry.getConfigurations());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>getAutoConfigurationEntryæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> AutoConfigurationEntry <span class="title function_">getAutoConfigurationEntry</span><span class="params">(AnnotationMetadata annotationMetadata)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.isEnabled(annotationMetadata)) &#123;</span><br><span class="line">        <span class="keyword">return</span> EMPTY_ENTRY;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">AnnotationAttributes</span> <span class="variable">attributes</span> <span class="operator">=</span> <span class="built_in">this</span>.getAttributes(annotationMetadata);</span><br><span class="line">        List&lt;String&gt; configurations = </span><br><span class="line">            <span class="comment">// è·å–å€™é€‰çš„é…ç½®å±æ€§  (ç‚¹è¿›æ–¹æ³•)</span></span><br><span class="line">            <span class="built_in">this</span>.getCandidateConfigurations(annotationMetadata, attributes);</span><br><span class="line">        configurations = <span class="built_in">this</span>.removeDuplicates(configurations);</span><br><span class="line">        Set&lt;String&gt; exclusions = <span class="built_in">this</span>.getExclusions(annotationMetadata, attributes);</span><br><span class="line">        <span class="built_in">this</span>.checkExcludedClasses(configurations, exclusions);</span><br><span class="line">        configurations.removeAll(exclusions);</span><br><span class="line">        configurations = <span class="built_in">this</span>.getConfigurationClassFilter().filter(configurations);</span><br><span class="line">        <span class="built_in">this</span>.fireAutoConfigurationImportEvents(configurations, exclusions);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AutoConfigurationEntry</span>(configurations, exclusions);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>getCandidateConfigurationsæ–¹æ³•  è·å–å€™é€‰çš„é…ç½®å±æ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> List&lt;String&gt; <span class="title function_">getCandidateConfigurations</span><span class="params">(AnnotationMetadata metadata, AnnotationAttributes attributes)</span> &#123;</span><br><span class="line">    List&lt;String&gt; configurations = <span class="keyword">new</span> </span><br><span class="line">        <span class="comment">// åŠ è½½å·¥å‚ bean  -&gt;  loadFactoryNames()</span></span><br><span class="line">        ArrayList(SpringFactoriesLoader.loadFactoryNames(<span class="built_in">this</span>.getSpringFactoriesLoaderFactoryClass(), <span class="built_in">this</span>.getBeanClassLoader()));</span><br><span class="line">     <span class="comment">// è¯»å–ç¬¬äºŒä¸ªé…ç½®æ–‡ä»¶ -&gt;  load()</span></span><br><span class="line">    ImportCandidates.load(AutoConfiguration.class, <span class="built_in">this</span>.getBeanClassLoader()).forEach(configurations::add);</span><br><span class="line">    Assert.notEmpty(configurations, <span class="string">&quot;No auto configuration classes found in META-INF/spring.factories nor in META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports. If you are using a custom packaging, make sure that file is correct.&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> configurations;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾ˆå®¹æ˜“å‘ç° , springbootä½¿ç”¨springçš„ç±»åŠ è½½å™¨,åŠ è½½ç±» , åœ¨æ–­è¨€å¤„,å‘ç°ä¸èƒ½ä¸ºç©ºçš„æ–­è¨€,åˆ†æ: <strong>æ²¡æœ‰è‡ªåŠ¨é…ç½®ç±»</strong>æ‰¾åˆ°åœ¨è·¯å¾„<code>META-INF/spring.factories nor in META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code>ä¸­,ä¹Ÿå°±æ˜¯è¯´ è¯»å–é…ç½®ç±»æ˜¯è¯»å–å›ºå®šè·¯å¾„(è¿™ç§æœºåˆ¶å«åš<strong>SPI</strong>æœºåˆ¶),æ˜¯ä¸€ç§<strong>æœåŠ¡æä¾›å‘ç°æœºåˆ¶</strong>, ç„¶åè¯»å–äº†ä¸¤ä¸ªæ–‡ä»¶</p><img src="/2023/10/08/SpringBoot/read_Configuration.png" class><blockquote><p>å…¶ä¸­è¿™ä¸¤ä¸ªæ–‡ä»¶,åŒ…å«äº†å¤§é‡SpringBootå¯åŠ¨æ—¶éœ€è¦è¯»å–çš„é…ç½®ç±»</p></blockquote><p>æ‰“å¼€åŠ è½½å·¥å‚beanæ–¹æ³• <code>loadFactoryNames</code> (è¯¥æ–¹æ³•è¯»å–çš„æ˜¯ç¬¬ä¸€ä¸ªé…ç½®æ–‡ä»¶ <code>spring.factories</code>)</p><img src="/2023/10/08/SpringBoot/spring_class_load.png" class><p>é€šè¿‡ç±»åŠ è½½å™¨,é€šè¿‡æ–‡ä»¶é…ç½®</p><p>è¯»å–ç¬¬äºŒä¸ªé…ç½®æ–‡ä»¶ é€šè¿‡  load()æ–¹æ³•,ç‚¹å¼€å‘ç°</p><img src="/2023/10/08/SpringBoot/read_Configuration2.png" class><p>é€šè¿‡æµçš„è¯»å–,æŠŠé…ç½®æ–‡ä»¶æŒ‰è¡Œè¯»å–,å½¢æˆä¸€ä¸ªæ•°ç»„</p><p>åœ¨ç¬¬äºŒä¸ªé…ç½®æ–‡ä»¶ä¸­è¯»å–åˆ°ä¾‹å¦‚<code>org.springframework.boot.autoconfigure.web.embedded.EmbeddedWebServerFactoryCustomizerAutoConfiguration</code>çš„WebæœåŠ¡å™¨ç±»,springåˆ™ä¼šå»è‡ªåŠ¨è¯»å–æ‰«æé…ç½®WebæœåŠ¡çš„é…ç½®ç±»å¹¶ä¸”æ³¨å…¥æ‰˜ç®¡,å°±æ˜¯å‰é¢è¯´åˆ°çš„[Webé…ç½®æµç¨‹](#æ ·ä¾‹äºŒ: WebServer) ,ç»å† é…ç½®æ–‡ä»¶è¯»å–,é…ç½®ç±»è¯»å–,é…ç½®ç±»æ ¹æ®æ¡ä»¶æ³¨å…¥,beanæ‰˜ç®¡ç­‰æµç¨‹</p><h4 id="SpringBoot-Starteråˆ†æåŠè‡ªå®šä¹‰"><a href="#SpringBoot-Starteråˆ†æåŠè‡ªå®šä¹‰" class="headerlink" title="SpringBoot Starteråˆ†æåŠè‡ªå®šä¹‰"></a>SpringBoot Starteråˆ†æåŠè‡ªå®šä¹‰</h4><p>SpringBoot Starter: å¯åŠ¨ç±»   åˆ†æstarterçš„å¯åŠ¨æµç¨‹:</p><h5 id="ä¾èµ–åˆ†æ-ä»SpringBoot-starterå¼€å§‹"><a href="#ä¾èµ–åˆ†æ-ä»SpringBoot-starterå¼€å§‹" class="headerlink" title="ä¾èµ–åˆ†æ: ä»SpringBoot starterå¼€å§‹"></a>ä¾èµ–åˆ†æ: ä»SpringBoot starterå¼€å§‹</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿½è¸ªå‘ç° åŒ…å«ä¾èµ–:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å†è¿½è¸ª: ç„¶åå‘ç°äº†æœ‰ä¸€ä¸ªä¾èµ–æ˜¯<code>spring-boot-autoconfigure</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--è‡ªåŠ¨é…ç½®ä¾èµ–--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-autoconfigure<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ‰“å¼€ä¾èµ– <code>org.springframework.boot:spring-boot-starter</code></p><p>idea ä¸­çš„ mavenä¾èµ–ç»“æ„å¦‚ä¸‹:</p><blockquote><p>spring-boot-starter</p><p>â€‹META-INF</p><p>â€‹LICENSE.txt</p><p>â€‹MANIFEST.MF</p><p>â€‹NOTICE.txt</p></blockquote><p>æ‰€ä»¥:å…¶å®è¿™ä¸ªstarteræœ€é‡è¦çš„å°±æ˜¯<code>pom.xml</code>æ–‡ä»¶,å®ƒå¼•å…¥äº†<code>autoconfiguration</code>çš„jaråŒ…</p><p>éœ€è¦æ‰“å¼€æœ¬åœ°åŠ è½½çš„ä¾èµ–æ–‡ä»¶æ‰èƒ½çœ‹åˆ°å…·ä½“çš„ç»“æ„</p><p>ä¾èµ–ç»“æ„:</p><img src="/2023/10/08/SpringBoot/auto.png" class><p>æ ‡å‡†çš„SpringBootæ˜¯å°†æ‰€æœ‰çš„è‡ªåŠ¨é…ç½®ç±»éƒ½å†™åœ¨äº† <code>xxx.factories</code>,ä½†æˆ‘ä»¬è‡ªå®šä¹‰çš„starteræ˜¯å°†é…ç½®ç±»éƒ½å†™åœ¨äº†<code>spring.factories</code>æ–‡ä»¶ä¸­</p><h5 id="MyBatis-Starter"><a href="#MyBatis-Starter" class="headerlink" title="MyBatis Starter"></a>MyBatis Starter</h5><p>ç»“æ„å¦‚ä¸‹</p><img src="/2023/10/08/SpringBoot/autoconfig.png" class title="Mybatisè‡ªåŠ¨é…ç½®"><p>å…¶ä¸­<code>mybatis</code>çš„<code>spring.factories</code>çš„å†…å®¹å¦‚ä¸‹:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Auto Configure</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span></span><br><span class="line"><span class="string">org.mybatis.spring.boot.autoconfigure.MybatisLanguageDriverAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.mybatis.spring.boot.autoconfigure.MybatisAutoConfiguration</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##### ä¸¤ä¸ªæ¡ˆä¾‹æ€»ç»“:</span><br><span class="line"></span><br><span class="line">åŒ…å«ä¸¤ä¸ªæ¨¡å—:</span><br><span class="line"></span><br><span class="line">ä¸€ä¸ªæ˜¯```starter```,ä¸€ä¸ªæ˜¯```autoconfiguration```</span><br><span class="line"></span><br><span class="line">å…¶ä¸­åœ¨starteré‡Œé¢ä¸»è¦å°±æ˜¯**å¼•å…¥autoconfiguration** ä»¥åŠå¸®æˆ‘ä»¬ç‰ˆæœ¬ä»²è£å…¶å®ƒjaråŒ…</span><br><span class="line"></span><br><span class="line">åœ¨```autoconfiguration```ä¸­æ˜¯**æ‰˜ç®¡é…ç½®ç±»** , æ¯”å¦‚æˆ‘å½“å‰å¼€å‘çš„Jdbcæ¨¡å—:é‚£ä¹ˆæˆ‘çš„starteråˆ™éœ€è¦å¯¼å…¥ä¸€äº›ä¾èµ–,**é‡ç‚¹æ˜¯å¯¼å…¥æˆ‘çš„JdbcAutoConfigurationé…ç½®ç±»**,å…¶ä¸­å®ƒéœ€è¦è¯»å–ä¸€äº›å±æ€§é…ç½®æ–‡ä»¶```Properties```,å®ƒåŒ…å«äº†å½“å‰æ¨¡å—çš„é…ç½®å±æ€§ä¿¡æ¯, ä½äº```META-INF/spring.factories```çš„é…ç½®æ–‡ä»¶åˆ™æ˜¯SpringBootä¼šè‡ªåŠ¨è¯»å–çš„é…ç½®æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line"># Auto Configure ä½¿ç”¨SpringBootè‡ªåŠ¨é…ç½®ç±» è¯»å–é…ç½®ç±» INF/spring.factories   </span><br><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">  com.hang.myAutoConfiguration.JdbcAutoConfiguration</span><br></pre></td></tr></table></figure><p>å…¶ä¸­startä¸­çš„pomæ–‡ä»¶<strong>ä¾èµ–äº†autoconfiguration</strong>åŒ…</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- starteråªåšäº†è¿™ä¸€ä»¶äº‹æƒ…:</span></span><br><span class="line"><span class="comment">        å¼•å…¥AutoConfigurationé…ç½®ç±»--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.hang<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>JdbcAutoConfiguration<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è‡³æ­¤: æˆ‘ä»¬åªéœ€è¦åœ¨SpringBooté¡¹ç›®ä¸­<strong>å¼•å…¥è‡ªå®šä¹‰çš„starterå³å¯</strong></p><h5 id="è‡ªå®šä¹‰starter"><a href="#è‡ªå®šä¹‰starter" class="headerlink" title="è‡ªå®šä¹‰starter"></a>è‡ªå®šä¹‰starter</h5><p>ä»¥æ—¥æœŸæ ¼å¼åŒ–DateFormatä¸ºä¾‹</p><ol><li>å®šä¹‰ä¸€ä¸ªautoconfigurationæ¨¡å—(åŒ…å«AutoConfigurationå’ŒProperties)</li></ol><p>AutoConfiguration</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123;TimeFunction.class&#125;)</span> <span class="comment">// å¦‚æœæœ‰è¿™ä¸ªç±»å­—èŠ‚ç æ‰åŠ è½½</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;TimeProperties.class&#125;)</span> <span class="comment">// IOC å±æ€§ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DateFormatAutoConfiguration</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> TimeFunction <span class="title function_">timeFunction</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TimeFunction</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Properties</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;hang.time&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TimeProperties</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">format</span> <span class="operator">=</span> <span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getFormat</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> format;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFormat</span><span class="params">(String format)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.format = format;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ymlé…ç½® (æ—¥æœŸæ ¼å¼åŒ–è‡ªå®šä¹‰)</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">hang:</span></span><br><span class="line">  <span class="attr">time:</span></span><br><span class="line">    <span class="attr">format:</span> <span class="string">yyyyå¹´MMæœˆddæ—¥</span> <span class="string">HH:mm:ss</span></span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰å‡½æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¦æ‰˜ç®¡è¿™ä¸ªç±» -&gt; @Beanæ³¨è§£å°†è¿™ä¸ªç±»åœ¨@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TimeFunction</span> &#123; </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TimeProperties timeProperties;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">showTime</span><span class="params">(String name)</span>&#123;</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        <span class="type">DateFormat</span> <span class="variable">df</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(timeProperties.getFormat());</span><br><span class="line">        <span class="type">String</span> <span class="variable">format</span> <span class="operator">=</span> df.format(date);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;æ¬¢è¿æ‚¨:&quot;</span> + name + <span class="string">&quot;ç°åœ¨æ˜¯:&quot;</span> + format;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>å®šä¹‰ä¸€ä¸ªstarteræ¨¡å—</li></ol><p>è¿™ä¸ªæ¨¡å—ä¸»è¦æ˜¯å¼•å…¥<strong>autoconfiguration</strong>æ¨¡å—</p><ol start="3"><li>å®šä¹‰spring.factoriesæ–‡ä»¶(ä½äºautoconfigurationçš„<code>resource/META-INF</code>ä¸‹)</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨SpringBootè‡ªåŠ¨é…ç½®ç±»æ–‡ä»¶ è¯»å–é…ç½®ç±»AutoConfiguration</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span></span><br><span class="line">  <span class="string">com.hang.dateFormatAutoConfiguration.DateFormatAutoConfiguration</span></span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœä¸ç”¨starterè‡ªåŠ¨é…ç½®,æ‰‹åŠ¨é…ç½®,éœ€è¦é…ç½®å±æ€§æ–‡ä»¶è§£æConfiguration-processorä¾èµ–</p><p>é…ç½®æ–‡ä»¶ç±»é€šè¿‡@ConfigurationProperties(profix&#x3D;â€â€)è¯»å–é…ç½®æ–‡ä»¶</p><p>é€šè¿‡@Componentæ³¨å…¥spring,æ–¹æ³•ç­‰ç”¨@Beanæ³¨å…¥</p></blockquote><h4 id="ComponentScan"><a href="#ComponentScan" class="headerlink" title="@ComponentScan"></a><code>@ComponentScan</code></h4><h5 id="æ’é™¤è¿‡æ»¤å™¨"><a href="#æ’é™¤è¿‡æ»¤å™¨" class="headerlink" title="æ’é™¤è¿‡æ»¤å™¨"></a>æ’é™¤è¿‡æ»¤å™¨</h5><h6 id="AutoConfigurationExcludeFilter"><a href="#AutoConfigurationExcludeFilter" class="headerlink" title="AutoConfigurationExcludeFilter"></a>AutoConfigurationExcludeFilter</h6><p>å¯¹äºé‡Œé¢çš„è¿‡æ»¤å™¨åˆ†æ:(æ¡ˆä¾‹)</p><p> å¦‚æœæ’é™¤ä¸­æœ‰ä¸€ä¸ªç¬¦åˆæ¡ä»¶,  åˆ™æ’é™¤æ‰«ææ’é™¤</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(excludeFilters = &#123;</span></span><br><span class="line"><span class="meta">        @ComponentScan.Filter(</span></span><br><span class="line"><span class="meta">                type = FilterType.CUSTOM,</span></span><br><span class="line"><span class="meta">                classes = &#123;TypeExcludeFilter.class&#125;</span></span><br><span class="line"><span class="meta">        ),@ComponentScan.Filter(</span></span><br><span class="line"><span class="meta">                type = FilterType.CUSTOM,</span></span><br><span class="line"><span class="meta">        classes = &#123;AutoConfigurationExcludeFilter.class&#125;</span></span><br><span class="line"><span class="meta">        )</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚æˆ‘æœ‰ä¸€ä¸ªé…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span>()&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> OrderService <span class="title function_">orderService</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OrderService</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‡å¦‚æˆ‘åœ¨ resourceä¸‹çš„META_INFä¸‹é¢çš„spring.factoriesä¸­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Auto Configure</span><br><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">com.hang.AppConfig</span><br></pre></td></tr></table></figure><p>ä¼—æ‰€å‘¨çŸ¥,  åœ¨è¿™ä¸ªæ–‡ä»¶ä¸‹é…ç½®äº†æ‰«æè·¯å¾„ä¹Ÿä¼šè¢«è§£æ,  é‚£ä¹ˆåˆ™ä¼š<strong>è¢«è§£æä¸¤æ¬¡</strong>.</p><p>å¦‚æœé…ç½®äº†æ­¤é¡¹, åˆ™åªä¼šè¢«è§£æä¸€æ¬¡</p><h6 id="TypeExcludeFilter"><a href="#TypeExcludeFilter" class="headerlink" title="TypeExcludeFilter"></a>TypeExcludeFilter</h6><p>é…ç½®æ­¤é¡¹éœ€è¦å•ç‹¬å®šä¹‰ä¸€ä¸ªæ’é™¤è¿‡æ»¤å™¨,  ç»§æ‰¿è‡ª TypeExcludeFilter,  é‡å†™matchæ–¹æ³•</p><p>ä¾‹å¦‚æˆ‘éœ€è¦æ’é™¤æˆ‘çš„UserService</p><p>åˆ™é€šè¿‡é‡å†™ç±»å½¢å‚ä¸­çš„MetadataReaderè·å–ç±»ä¿¡æ¯ç„¶ååˆ¤æ–­å³å¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HangTypeExcludeFilter</span> <span class="keyword">extends</span> <span class="title class_">TypeExcludeFilter</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">match</span><span class="params">(MetadataReader metadataReader,  MetadataReaderFactory metadataReaderFactory)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> metadataReader.getClassMetadata().getClassName()</span><br><span class="line">            .equals(UserService.class.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…‰é…ç½®äº†æ­¤é¡¹è¿˜ä¸å¤Ÿ,  å› ä¸ºåœ¨æ‰§è¡Œå½“å‰æ–¹æ³•è¿‡æ»¤æ—¶,  å¹¶ä¸çŸ¥é“å®¹å™¨ä¸­æœ‰æ²¡æœ‰æ‰«æåˆ°æˆ–è€…æ³¨å†Œbean(å¤§æ¦‚),  ä»è€Œå¯¼è‡´å·²ç»å¼€å§‹è¿‡æ»¤,  ç„¶åå¯¼è‡´å¤±æ•ˆ</p><p>æˆ‘ä»¬åœ¨æ‰«æä¹‹é—´å°±å¾—æ”¾ç½®ä¸€äº›bean, è¯¥æ€ä¹ˆåšå‘¢?</p><p>åœ¨spring.factoriesä¸­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># åˆå§‹åŒ–å™¨åœ¨åˆ›å»ºå®¹å™¨å¯¹è±¡å,æ‰«æå‰æ‰§è¡Œ</span><br><span class="line">+ # Initializersa</span><br><span class="line">+ org.springframework.context.ApplicationContextInitializer=\</span><br><span class="line">+ com.hang.ApplicationContextInitializer</span><br><span class="line"></span><br><span class="line"># Auto Configure   # -&gt; åˆšåˆšåœ¨ä¸Šä¸€ä¸ªæ¡ˆä¾‹å†™çš„</span><br><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">com.hang.AppConfig</span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰ä¸€ä¸ªåˆå§‹åŒ–å™¨</p><p>HangApplicationContextInitializer</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HangApplicationContextInitializer</span> <span class="keyword">implements</span> <span class="title class_">ApplicationContextInitializer</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(ConfigurableApplicationContext applicationContext)</span>&#123;</span><br><span class="line">        <span class="comment">// æ·»åŠ ä¸€ä¸ªå•ä¾‹bean(æ’é™¤è¿‡æ»¤å™¨)</span></span><br><span class="line">        applicationContext.getBeanFactory()</span><br><span class="line">            .regiseterSingleton(<span class="string">&quot;HangTypeExcludeFilter&quot;</span>,<span class="keyword">new</span> <span class="title class_">HangTypeExcludeFilter</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶åˆ™åˆšåˆšå†™çš„HangTypeExcludeFilter ä¸­çš„ matchåŒ¹é…è¿‡æ»¤åˆ™ä¼šç”Ÿæ•ˆäº†</p><h3 id="SpringBoot-Sessionæ•´åˆRedis"><a href="#SpringBoot-Sessionæ•´åˆRedis" class="headerlink" title="SpringBoot Sessionæ•´åˆRedis"></a>SpringBoot Sessionæ•´åˆRedis</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--springbootæ•´åˆredis session--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.session<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-session-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="ä¿®æ”¹SessionæœªåŒæ­¥é—®é¢˜"><a href="#ä¿®æ”¹SessionæœªåŒæ­¥é—®é¢˜" class="headerlink" title="ä¿®æ”¹SessionæœªåŒæ­¥é—®é¢˜"></a>ä¿®æ”¹SessionæœªåŒæ­¥é—®é¢˜</h4><div class="checkbox checked"><input type="checkbox" checked="checked">            <p>å½“å‰é—®é¢˜ä»…ä»…é€‚ç”¨äºå½“å‰æ¡ˆä¾‹æƒ…å†µ</p>            </div><p>åœ¨Sessionæœªæ•´åˆRedisä¹‹å‰,  å¯¹æ•°æ®çš„æ“ä½œä¸º<wavy>å¼•ç”¨æ•°æ®ç±»å‹</wavy>,  å³ä¿®æ”¹å·²å­˜åœ¨çš„sessionå€¼,  è‡ªåŠ¨åŒæ­¥</p><details class="folding-tag" green><summary> æ¡ˆä¾‹ä»£ç  </summary>              <div class="content">              <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  æ·»åŠ è´­ç‰©è½¦</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/addCart&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">addCart</span><span class="params">(<span class="meta">@RequestParam(&quot;fid&quot;)</span> Integer fid,</span></span><br><span class="line"><span class="params">                      <span class="meta">@RequestParam(&quot;num&quot;)</span> Integer num,</span></span><br><span class="line"><span class="params">                      HttpSession session)</span> &#123;</span><br><span class="line">    <span class="comment">// æ ¹æ®fidå»æŸ¥å•†å“</span></span><br><span class="line">    <span class="type">Resfood</span> <span class="variable">food</span> <span class="operator">=</span> resfoodService.getById(fid);</span><br><span class="line">    <span class="keyword">if</span> (Objects.isNull(food)) &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;æ²¡æœ‰æ­¤å•†å“&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä»sessionå»Cart(map)</span></span><br><span class="line">    Map&lt;Integer, CartItem&gt; cart = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (Objects.nonNull(session.getAttribute(<span class="string">&quot;cart&quot;</span>))) &#123;</span><br><span class="line">        cart = (Map&lt;Integer, CartItem&gt;) session.getAttribute(<span class="string">&quot;cart&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        session.setAttribute(<span class="string">&quot;cart&quot;</span>, cart);</span><br><span class="line">    &#125;</span><br><span class="line">    CartItem cartItem;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­è¿™ä¸ªè§†é¢‘åœ¨mapæ˜¯å¦æœ‰</span></span><br><span class="line">    <span class="keyword">if</span> (cart.containsKey(fid)) &#123;</span><br><span class="line">        cartItem = cart.get(fid);</span><br><span class="line">        cartItem.setNum(cartItem.getNum() + <span class="number">1</span>);</span><br><span class="line">        cart.put(fid, cartItem);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        cartItem = <span class="keyword">new</span> <span class="title class_">CartItem</span>();</span><br><span class="line">        cartItem.setNum(num);</span><br><span class="line">        cartItem.setResfood(food);</span><br><span class="line">        cart.put(fid, cartItem);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¤„ç†æ•°é‡</span></span><br><span class="line">    <span class="keyword">if</span> (cartItem.getNum() &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        cart.remove(fid);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é—®é¢˜å‡ºç°å¤„: åŸä»£ç æ²¡æœ‰åŠ è¿™ä¸ª</span></span><br><span class="line">+   session.setAttribute(<span class="string">&quot;cart&quot;</span>, cart);</span><br><span class="line">    <span class="comment">// æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">return</span> Result.*ok*(cart.values());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>              </div>            </details><p>æ ·ä¾‹ä¸­ç¬¬37è¡Œå¤„,  åœ¨æ²¡æœ‰æŠŠSessionæ·»åŠ åˆ°Redisä¸­å‰,  ç”¨æˆ·åœ¨å¯¹sessionçš„å€¼ä¿®æ”¹å, tomcatè‡ªåŠ¨åŒæ­¥æ›´æ–°sessionçš„æ•°æ®,  å³æ·»åŠ è´­ç‰©è½¦ä¸ä¼šå‡ºç° <span class="p red">æ•°é‡é™åˆ¶é—®é¢˜</span></p><p>ä½†æ˜¯å°†Sessionæ·»åŠ åˆ°Spring session data redisä¸­çš„æ—¶å€™,  ä»ä¸€å¼€å§‹çš„å¼•ç”¨ç±»å‹å˜æˆäº†ç±»ä¼¼äºå€¼å¼•ç”¨ç±»å‹äº†,  å³å¼•ç”¨redisé‡Œé¢çš„sessionå€¼,  å¹¶ä¸ä¼šè¿›è¡ŒåŒæ­¥ä¿®æ”¹</p><p>ç»æŸ¥æºç :  åœ¨Springæ•´åˆRedis Sessionæ—¶é‡‡ç”¨äº† <span class="p red">äº‹ä»¶ç›‘å¬</span> çš„æ–¹å¼,  å³éœ€è¦å†æ¬¡é‡å¤è®¾ç½®sessionçš„æ“ä½œ<psw>session.setAttribute()</psw>,  Redisä¸­çš„Sessionæ‰ä¼šåŒæ­¥ä¿®æ”¹</p><h3 id="SpringBoot-Mockitoæµ‹è¯•"><a href="#SpringBoot-Mockitoæµ‹è¯•" class="headerlink" title="SpringBoot Mockitoæµ‹è¯•"></a>SpringBoot Mockitoæµ‹è¯•</h3><h4 id="æ¡ˆä¾‹-Controllerå±‚"><a href="#æ¡ˆä¾‹-Controllerå±‚" class="headerlink" title="æ¡ˆä¾‹ Controllerå±‚"></a>æ¡ˆä¾‹ Controllerå±‚</h4><p>å½“å‰æµ‹è¯•ç¯å¢ƒ:JDK8 , SpringBoot2.7.3  , Junit4, MyBatis-Plus3.x</p><p>é¦–å…ˆç¬¬ä¸€æ­¥å…ˆåˆ›å»ºä¸€ä¸ªç®€å•çš„MVCæ¡†æ¶çš„æµ‹è¯•ç”¨ä¾‹,æˆ‘ä»¬åœ¨Controllerä¸­å³é”®Go toåˆ›å»ºæµ‹è¯•ç”¨ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/getById&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getById</span><span class="params">(<span class="meta">@RequestParam(&quot;id&quot;)</span> Integer id)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userService.getUserInfoById(id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@PostMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userService.saveUserInfo(user)</span><br><span class="line">                ? <span class="string">&quot;ä¿å­˜æˆåŠŸ&quot;</span> : <span class="string">&quot;ä¿å­˜å¤±è´¥&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•åŒ…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span> <span class="comment">// Junit4</span></span><br><span class="line"><span class="meta">@SpringBootTest(classes = &#123;MockApplication.class&#125;,</span></span><br><span class="line"><span class="meta">// åœ¨æ¯ä¸€æ¬¡è¿›è¡Œmockæµ‹è¯•æ—¶ å¯ç”¨éšæœºç«¯å£å¯åŠ¨ ä¸ºä¾‹é¿å…å¤šä¸ªæµ‹è¯•ç”¨ä¾‹åŒæ—¶å¯åŠ¨æ—¶ä¸ä¼šäº§ç”Ÿç«¯å£å ç”¨é—®é¢˜</span></span><br><span class="line"><span class="meta">        webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)</span></span><br><span class="line"><span class="comment">// è‡ªåŠ¨é…ç½®å’Œå¯ç”¨MockMvcé…ç½®  å¦‚æœä¸åŠ è¿™ä¸ªæ³¨è§£ ä¸‹é¢æ˜¯ä¸èƒ½æ³¨å…¥çš„</span></span><br><span class="line"><span class="meta">@AutoConfigureMockMvc(addFilters = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserControllerTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MockMvc mockMvc;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getById</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// é¢„æœŸå¯¹è±¡</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1</span>, <span class="string">&quot;w&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;æ‚Ÿç©º&quot;</span>,</span><br><span class="line">                <span class="string">&quot;song@foxmail.com&quot;</span>, <span class="string">&quot;13283718600&quot;</span>, <span class="string">&quot;ç”·&quot;</span>,</span><br><span class="line">                <span class="number">1</span>, <span class="literal">null</span>, <span class="string">&quot;å¤©å­è„šä¸‹&quot;</span>);</span><br><span class="line">        <span class="comment">// ä½¿ç”¨æ³¨å…¥çš„mockMvcæ¨¡æ‹Ÿå‘é€è¯·æ±‚</span></span><br><span class="line">        <span class="comment">// MockMvcRequestBuilders: è¯·æ±‚æ„å»ºå™¨</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">id</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">            <span class="comment">// åœ¨è¯·æ±‚åé¢è¿˜å¯ä»¥æŒ‡å®šè¯·æ±‚ç±»å‹ ä¾‹å¦‚APPLICATION_JSON_VALUE</span></span><br><span class="line">            mockMvc.perform(MockMvcRequestBuilders.get(<span class="string">&quot;/user/getById&quot;</span>)</span><br><span class="line">                            .contentType(MediaType.APPLICATION_JSON_VALUE)</span><br><span class="line">                            <span class="comment">// è¿™é‡Œè¿˜èƒ½è®¾ç½®header</span></span><br><span class="line">                            .param(<span class="string">&quot;id&quot;</span>,<span class="string">&quot;1&quot;</span>)</span><br><span class="line">                    )</span><br><span class="line">                    <span class="comment">// MockMvcResultMatchers: mockMvcç»“æœåŒ¹é…å™¨</span></span><br><span class="line">                    .andExpect(MockMvcResultMatchers.status().isOk()) <span class="comment">// ä¾‹å¦‚å½“å‰ä¸º åŒ¹é…çŠ¶æ€ç ä¸º200æˆ–è€…å…¶ä»–å¯ä»¥è¡¨ç¤ºæˆåŠŸçš„</span></span><br><span class="line">                    <span class="comment">// è¿™ä¸ªæ˜¯ç”¨äºå–è¿”å›bodyçš„  $.nameä»£è¡¨å–bodyé‡Œé¢çš„nameå­—æ®µ å‡å¦‚è¿˜æœ‰</span></span><br><span class="line">                    .andExpect(MockMvcResultMatchers.jsonPath(<span class="string">&quot;$.name&quot;</span>, Matchers.equalToIgnoringCase(user.getName())))</span><br><span class="line">                    <span class="comment">// å¦‚æœçŠ¶æ€ç ç¬¦åˆé¢„æœŸ åˆ™è¿›è¡Œprintè¾“å‡ºå“åº”ä¿¡æ¯</span></span><br><span class="line">                    .andDo(MockMvcResultHandlers.print())</span><br><span class="line">                    <span class="comment">// çœŸæ­£è¯·æ±‚å¾—åˆ°å“åº”çš„å†…å®¹,çœŸæ­£æ‰§è¡Œçš„è¿”å›å€¼</span></span><br><span class="line">                    .andReturn();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;å½“å‰æ–¹æ³•ä¸º:&#123;&#125;,å‘ç”Ÿäº†å¼‚å¸¸&quot;</span>, <span class="string">&quot;getById&quot;</span>);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨å½“å‰æµ‹è¯•ç”¨ä¾‹ä¸­</p><ol><li><p>æ³¨æ„åˆ°<code>@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)</code>,å…¶ä¸­å®ƒä»£è¡¨ :<strong>åœ¨æ¯ä¸€æ¬¡è¿›è¡Œmockæµ‹è¯•æ—¶ å¯ç”¨éšæœºç«¯å£å¯åŠ¨ ä¸ºä¾‹é¿å…å¤šä¸ªæµ‹è¯•ç”¨ä¾‹åŒæ—¶å¯åŠ¨æ—¶ä¸ä¼šäº§ç”Ÿç«¯å£å ç”¨é—®é¢˜</strong></p></li><li><p><code>@AutoConfigureMockMvc(addFilters = false)</code> : è¿™ä¸ªç”¨äº<strong>è‡ªåŠ¨é…ç½®å’Œå¯ç”¨MockMvcé…ç½®</strong></p></li><li><p>æ³¨å…¥mockMvc</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> MockMvc mockMvc;</span><br></pre></td></tr></table></figure></li><li><p>åœ¨mockMvcå®ä¾‹ä¸­,ä½¿ç”¨<code>perform</code>æ‰§è¡Œä¸€ä¸ªHTTPè¯·æ±‚, å…¥å£å‚æ•°ä¸ºRequestBuilderï¼Œè¾“å‡ºç»“æœä¸ºResultAction</p></li><li><p>åœ¨<code>performä¸­</code>,ä½¿ç”¨<code>MockMvcRequestBuilders</code>è¯·æ±‚æ„å»ºå™¨æ„é€ è¯·æ±‚, å¯ä»¥ä½¿ç”¨getæˆ–è€…postè¯·æ±‚,åœ¨getæˆ–posté‡Œé¢å†™å…¥è¯·æ±‚è·¯å¾„,åœ¨åé¢è¿˜å¯ä»¥åŠ è¯·æ±‚å†…å®¹ç±»å‹<code>contentType(MediaType.APPLICATION_JSON_VALUE)</code>,å…¶ä¸­è¿˜èƒ½åƒSpringMVCä¸€æ ·è®¾ç½®å…¶ä»–çš„æ¯”å¦‚header,param</p></li><li><p><code>andExpect</code>æœŸæœ›, ä½¿ç”¨<code>MockMvcResultMatchers</code> :mockMvcç»“æœåŒ¹é…å™¨æ–­è¨€, åœ¨æˆ‘çš„æµ‹è¯•ç”¨ä¾‹ä¸­,ä½¿ç”¨äº†ä¸¤ä¸ªåŒ¹é…æ–­è¨€ </p><p>6.1 ã€<code>.andExpect(MockMvcResultMatchers.status().isOk())</code>: ç”¨äºåŒ¹é…è¿”å›çŠ¶æ€ç æ˜¯å¦ä¸ºok,å…¶ä¸­ä¸€èˆ¬æŒ‡200</p><p>6.2ã€<code>.andExpect(MockMvcResultMatchers.jsonPath(&quot;$.name&quot;, Matchers.equalToIgnoringCase(user.getName())))</code>,å…¶ä¸­userä¸º<strong>è‡ªå®šä¹‰çš„æœŸæœ›å¯¹è±¡</strong>, å¯¹äº<code>jsonPath</code>å¯¹è±¡,ä¸€èˆ¬ç”¨äºå–è¿”å›çš„Bodyå¯¹è±¡, å¯¹äºå½“å‰è¿”å›çš„ç»“æœå¦‚ä¸‹ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MockHttpServletResponse:</span><br><span class="line">           Status = <span class="number">200</span></span><br><span class="line">    <span class="type">Error</span> <span class="variable">message</span> <span class="operator">=</span> <span class="type">null</span></span><br><span class="line">          <span class="variable">Headers</span> <span class="operator">=</span> [Content-Type:<span class="string">&quot;application/json&quot;</span>]</span><br><span class="line">     <span class="type">Content</span> <span class="variable">type</span> <span class="operator">=</span> application/<span class="type">json</span></span><br><span class="line">             <span class="variable">Body</span> <span class="operator">=</span> &#123;<span class="string">&quot;uid&quot;</span>:<span class="number">1</span>,<span class="string">&quot;username&quot;</span>:<span class="string">&quot;w&quot;</span>,<span class="string">&quot;password&quot;</span>:<span class="string">&quot;a&quot;</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;æ‚Ÿç©º&quot;</span>,<span class="string">&quot;email&quot;</span>:<span class="string">&quot;song@foxmail.com&quot;</span>,<span class="string">&quot;phone&quot;</span>:<span class="string">&quot;13283718600&quot;</span>,<span class="string">&quot;sex&quot;</span>:<span class="string">&quot;ç”·&quot;</span>,<span class="string">&quot;state&quot;</span>:<span class="number">1</span>,<span class="string">&quot;code&quot;</span>:<span class="literal">null</span>,<span class="string">&quot;addr&quot;</span>:<span class="string">&quot;å¤©å­è„šä¸‹&quot;</span>&#125;</span><br><span class="line">    <span class="type">Forwarded</span> <span class="variable">URL</span> <span class="operator">=</span> <span class="literal">null</span></span><br><span class="line">   <span class="type">Redirected</span> <span class="variable">URL</span> <span class="operator">=</span> <span class="type">null</span></span><br><span class="line">          <span class="variable">Cookies</span> <span class="operator">=</span> []</span><br></pre></td></tr></table></figure><p>å‡å¦‚Bodyä¸­çš„jsonæ•°æ®æœ‰åµŒå¥—,åŒæ ·ä¹Ÿæ˜¯ä½¿ç”¨å¦‚: <code>$.games[0].name</code> å–game[0]å¯¹è±¡çš„nameå±æ€§</p></li><li><p><code>.andDo(MockMvcResultHandlers.print())</code></p></li></ol><p>å¦‚æœç¬¦åˆé¢„æœŸç»“æœ åˆ™è¿›è¡Œprintè¾“å‡ºå“åº”è¯¦ç»†çš„ä¿¡æ¯:åŒ…æ‹¬è¯·æ±‚å¤´,è¯·æ±‚ä½“ç­‰å¸¸è§çš„å­—æ®µ,æ¯”å¦‚è¿˜æœ‰ModelAndView,Response</p><ol start="8"><li><code>.andReturn();</code></li></ol><p>çœŸæ­£è¯·æ±‚å¾—åˆ°å“åº”çš„å†…å®¹,çœŸæ­£æ‰§è¡Œçš„è¿”å›å€¼,è¿”å›å€¼å¯ä»¥newä¸€ä¸ª<code>MockMvc</code>å¯¹è±¡è¿”å›</p><ol start="9"><li>å…¶ä¸­è¿˜åŒ…æ‹¬ä¸€äº›å…¶ä»–çš„å‡½æ•°,è¯¦æƒ…è§ <a href="https://docs.spring.io/spring-framework/reference/testing/spring-mvc-test-framework.html">SpringBootÂ TestÂ Doc</a> æ–‡æ¡£</li></ol><p>å¦‚æœä½¿ç”¨è¿™ç§æ–¹å¼å‘ç”Ÿæ³¨å…¥é”™è¯¯,æ‰¾ä¸åˆ°ä¸€ä¸ªBeanä¸ºMockMvcçš„,é‚£ä¹ˆä½¿ç”¨ä¸‹é¢è¿™ç§æ–¹æ¡ˆæ³¨å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest(classes = &#123;MockApplication.class&#125;,</span></span><br><span class="line"><span class="meta">// åœ¨æ¯ä¸€æ¬¡è¿›è¡Œmockæµ‹è¯•æ—¶ å¯ç”¨éšæœºç«¯å£å¯åŠ¨ ä¸ºä¾‹é¿å…å¤šä¸ªæµ‹è¯•ç”¨ä¾‹åŒæ—¶å¯åŠ¨æ—¶ä¸ä¼šäº§ç”Ÿç«¯å£å ç”¨é—®é¢˜</span></span><br><span class="line"><span class="meta">        webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)</span></span><br><span class="line"><span class="comment">// è‡ªåŠ¨é…ç½®å’Œå¯ç”¨MockMvcé…ç½®  å¦‚æœä¸åŠ è¿™ä¸ªæ³¨è§£ ä¸‹é¢æ˜¯ä¸èƒ½æ³¨å…¥çš„</span></span><br><span class="line"><span class="comment">//@AutoConfigureMockMvc(addFilters = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserControllerTest</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WebApplicationContext webApplicationContext;</span><br><span class="line">    <span class="keyword">private</span> MockMvc mockMvc;</span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> &#123;</span><br><span class="line">        mockMvc = MockMvcBuilders.webAppContextSetup(webApplicationContext).build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;æ–‡æœ¬å“åº”æµ‹è¯•ç”¨ä¾‹&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getById</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// æµ‹è¯•ä»£ç </span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>æ³¨æ„åˆ°é¦–å…ˆæ³¨å…¥äº†<code>WebApplicationContext</code>å¯¹è±¡,ç„¶åæœ‰ä¸€ä¸ªæ²¡æœ‰åˆå§‹åŒ–çš„MockMvcå®ä¾‹</li><li><code>@Before</code>æ³¨è§£: åœ¨æ¯ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ä¹‹å‰è°ƒç”¨,æ¯ä¸€æ¬¡éƒ½ä¼šä½¿ç”¨ MockMvcBuilderså¯¹<code>webApplicationContext</code>è¿›è¡Œæ„å»º,ä»è€Œå¾—åˆ°ä¸€ä¸ª<strong>å®ä¾‹å¯¹è±¡mockMvc</strong></li><li><code>@DisplayName(&quot;æ–‡æœ¬å“åº”æµ‹è¯•ç”¨ä¾‹&quot;)</code>æ³¨è§£: ä½œç”¨å¦‚å›¾ä¾‹</li></ol><img src="/2023/10/08/SpringBoot/mock1.png" class><blockquote><p> æ³¨å…¥æ–¹å¼ä¸€: è‡ªåŠ¨é…ç½®åœ¨<code>org.springframework.boot:spring-boot-test-autoconfiguration</code>ä¸‹çš„<code>web.servlet.MockMvcAutoConfiguration</code>é…ç½®ç±»,</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨ä»¥ä¸‹ç¤ºä¾‹è¿›è¡Œæ³¨å…¥</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> WebApplicationContext webApplicationContext;</span><br><span class="line"><span class="keyword">private</span> MockMvc mockMvc;</span><br><span class="line"><span class="meta">@Before</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> &#123;</span><br><span class="line">    mockMvc = MockMvcBuilders.webAppContextSetup(webApplicationContext).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨å…¥æ–¹å¼äºŒ: è‡ªåŠ¨é…ç½®åœ¨<code>org.springframework.boot:spring-boot-test-autoconfiguration</code>ä¸‹çš„<code>web.servlet.AutoConfigurationMockMvc</code>æ³¨è§£ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. åœ¨å½“å‰æµ‹è¯•ç±»ä¸ŠåŠ æ³¨è§£ </span></span><br><span class="line"><span class="meta">@AutoConfigureMockMvc(addFilters = false)</span></span><br><span class="line"><span class="comment">// 2. AutoWiredæ³¨å…¥MockMvc</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> MockMvc mockMvc;</span><br></pre></td></tr></table></figure></blockquote><p>å¯¹äºGetè¯·æ±‚ ç¤ºä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨è¯·æ±‚åé¢è¿˜å¯ä»¥æŒ‡å®šè¯·æ±‚ç±»å‹ ä¾‹å¦‚APPLICATION_JSON_VALUE</span></span><br><span class="line">mockMvc.perform(MockMvcRequestBuilders.get(<span class="string">&quot;/user/getById&quot;</span>)</span><br><span class="line">                .contentType(MediaType.APPLICATION_JSON_VALUE)</span><br><span class="line">                .param(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">               )</span><br><span class="line">    <span class="comment">// MockMvcResultMatchers: mockMvcç»“æœåŒ¹é…å™¨</span></span><br><span class="line">    .andExpect(MockMvcResultMatchers.status().isOk()) <span class="comment">// ä¾‹å¦‚å½“å‰ä¸º åŒ¹é…çŠ¶æ€ç ä¸º200æˆ–è€…å…¶ä»–å¯ä»¥è¡¨ç¤ºæˆåŠŸçš„</span></span><br><span class="line">    <span class="comment">// è¿™ä¸ªæ˜¯ç”¨äºå–è¿”å›bodyçš„</span></span><br><span class="line">    .andExpect(MockMvcResultMatchers.jsonPath(<span class="string">&quot;$.name&quot;</span>, Matchers.equalToIgnoringCase(user.getName())))</span><br><span class="line">    <span class="comment">// å¦‚æœçŠ¶æ€ç ç¬¦åˆé¢„æœŸ åˆ™è¿›è¡Œprintè¾“å‡ºå“åº”ä¿¡æ¯</span></span><br><span class="line">    .andDo(print())</span><br><span class="line">    <span class="comment">// çœŸæ­£è¯·æ±‚å¾—åˆ°å“åº”çš„å†…å®¹,çœŸæ­£æ‰§è¡Œçš„è¿”å›å€¼</span></span><br><span class="line">    .andReturn();</span><br></pre></td></tr></table></figure><p>å¯¹äºPostè¯·æ±‚ ç¤ºä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JSON æ ¼å¼ -&gt; content</span></span><br><span class="line">mockMvc.perform(MockMvcRequestBuilders.post(<span class="string">&quot;/user/save&quot;</span>)</span><br><span class="line">                .contentType(MediaType.APPLICATION_JSON)</span><br><span class="line">                .content(<span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">                         <span class="string">&quot;  \&quot;uid\&quot;: \&quot;1\&quot;,\n&quot;</span> +</span><br><span class="line">                         <span class="string">&quot;  \&quot;username\&quot;: \&quot;w\&quot;&quot;</span> +</span><br><span class="line">                         <span class="string">&quot;&#125;&quot;</span>)</span><br><span class="line">                <span class="comment">// MockMvcResultMatchers: mockMvcç»“æœåŒ¹é…å™¨</span></span><br><span class="line">                .accept(MediaType.APPLICATION_JSON))</span><br><span class="line">    .andDo(print());</span><br><span class="line"><span class="comment">// From æ ¼å¼ -&gt; param</span></span><br><span class="line">mockMvc.perform(MockMvcRequestBuilders.post(<span class="string">&quot;/user/save&quot;</span>)</span><br><span class="line">                .contentType(MediaType.APPLICATION_FORM_URLENCODED)</span><br><span class="line">                .param(<span class="string">&quot;uid&quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">                .param(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;w&quot;</span>)</span><br><span class="line">                .accept(MediaType.APPLICATION_JSON))</span><br><span class="line">    .andDo(print());</span><br></pre></td></tr></table></figure><h4 id="æ¡ˆä¾‹-Serviceå±‚"><a href="#æ¡ˆä¾‹-Serviceå±‚" class="headerlink" title="æ¡ˆä¾‹ Serviceå±‚"></a>æ¡ˆä¾‹ Serviceå±‚</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest(classes = &#123;MockApplication.class&#125;,</span></span><br><span class="line"><span class="meta">// åœ¨æ¯ä¸€æ¬¡è¿›è¡Œmockæµ‹è¯•æ—¶ å¯ç”¨éšæœºç«¯å£å¯åŠ¨ ä¸ºä¾‹é¿å…å¤šä¸ªæµ‹è¯•ç”¨ä¾‹åŒæ—¶å¯åŠ¨æ—¶ä¸ä¼šäº§ç”Ÿç«¯å£å ç”¨é—®é¢˜</span></span><br><span class="line"><span class="meta">        webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@MockBean</span> <span class="comment">// æ¨¡æ‹ŸBean:Mockito ä¼šå¸®æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå‡çš„ Mock å¯¹è±¡ï¼Œæ›¿æ¢æ‰ Spring ä¸­å·²å­˜åœ¨çš„é‚£ä¸ªçœŸå®çš„ userDao Bean</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;æµ‹è¯•æ²¡æœ‰daoæ•°æ®è®¿é—®å±‚&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testEmptyMapper</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">expectUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1</span>, <span class="string">&quot;æµ‹è¯•æ²¡æœ‰daoæ•°æ®è®¿é—®å±‚&quot;</span>, <span class="string">&quot;11&quot;</span>, <span class="string">&quot;æµ‹è¯•æ²¡æœ‰daoæ•°æ®è®¿é—®å±‚&quot;</span>,<span class="string">&quot;song@foxmail.com&quot;</span>, <span class="string">&quot;13283718600&quot;</span>, <span class="string">&quot;ç”·&quot;</span>, <span class="number">1</span>, <span class="literal">null</span>, <span class="string">&quot;å¤©å­è„šä¸‹&quot;</span>);</span><br><span class="line">        <span class="comment">// Mockito.when( å¯¹è±¡.æ–¹æ³•å() ).thenReturn( è‡ªå®šä¹‰ç»“æœ )</span></span><br><span class="line">        Mockito.when(userMapper.selectById(<span class="number">1</span>))</span><br><span class="line">                .thenReturn(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1</span>, <span class="string">&quot;æµ‹è¯•æ²¡æœ‰daoæ•°æ®è®¿é—®å±‚&quot;</span>, <span class="string">&quot;11&quot;</span>, <span class="string">&quot;æµ‹è¯•æ²¡æœ‰daoæ•°æ®è®¿é—®å±‚&quot;</span>,<span class="string">&quot;song@foxmail.com&quot;</span>, <span class="string">&quot;13283718600&quot;</span>, <span class="string">&quot;ç”·&quot;</span>, <span class="number">1</span>, <span class="literal">null</span>, <span class="string">&quot;å¤©å­è„šä¸‹&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getUserInfoById(<span class="number">1</span>); <span class="comment">// è®¿é—®æ¨¡æ‹Ÿçš„Dao</span></span><br><span class="line">        Assert.assertEquals(expectUser,user);       <span class="comment">// æ–­è¨€æ­£ç¡®</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;æµ‹è¯•Service&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// Mockito.when( å¯¹è±¡.æ–¹æ³•å() ).thenReturn( è‡ªå®šä¹‰ç»“æœ )</span></span><br><span class="line">        Mockito.when(userService.getUserInfoById(<span class="number">1</span>))</span><br><span class="line">                .thenReturn(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1</span>, <span class="string">&quot;æµ‹è¯•Service&quot;</span>, <span class="string">&quot;11&quot;</span>, <span class="string">&quot;æµ‹è¯•æ²¡æœ‰daoæ•°æ®è®¿é—®å±‚&quot;</span>,<span class="string">&quot;song@foxmail.com&quot;</span>, <span class="string">&quot;13283718600&quot;</span>, <span class="string">&quot;ç”·&quot;</span>, <span class="number">1</span>, <span class="literal">null</span>, <span class="string">&quot;å¤©å­è„šä¸‹&quot;</span>));</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getUserInfoById(<span class="number">1</span>);</span><br><span class="line">        log.info(user.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1.<code>@MockBean</code>: æ¨¡æ‹ŸBean:Mockito ä¼šå¸®æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå‡çš„ Mock å¯¹è±¡ï¼Œæ›¿æ¢æ‰ Spring ä¸­å·²å­˜åœ¨çš„é‚£ä¸ªçœŸå®çš„ userDao Bean</p><p>2.<code>when</code>: æ¨¡æ‹Ÿå¼•å¯¼è®¿é—®çš„ <strong>å¯¹è±¡.æ–¹æ³•å()</strong></p><p>3.<code>thenReturn</code>: å¼•å¯¼è®¿é—®çš„è¿”å›ç»“æœ </p><p>å½“å‰æ ·ä¾‹1: <code>Mockito.anyInt()</code>,ä»»æ„çš„Intç±»å‹å€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Mockito.when(userService.getUserById(Mockito.anyInt()))</span><br><span class="line">       .thenReturn(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">3</span>, <span class="string">&quot;Calyee&quot;</span>));</span><br><span class="line"><span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> userService.getUserById(<span class="number">3</span>); <span class="comment">// å›ä¼ çš„userçš„åå­—ä¸ºCalyee</span></span><br><span class="line"><span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> userService.getUserById(<span class="number">200</span>); <span class="comment">// å›ä¼ çš„userçš„åå­—ä¹Ÿä¸ºCalyee</span></span><br></pre></td></tr></table></figure><p>å½“å‰æ ·ä¾‹2:  <strong>æŒ‡å®šçš„å€¼</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Mockito.when(userService.getUserById(<span class="number">3</span>)).thenReturn(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">3</span>, <span class="string">&quot;Calyee&quot;</span>));</span><br><span class="line"><span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> userService.getUserById(<span class="number">3</span>); <span class="comment">// å›ä¼ çš„userçš„åå­—ä¸ºCalyee -&gt; ä¸ºé¢„è®¾æœŸç›¼</span></span><br><span class="line"><span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> userService.getUserById(<span class="number">200</span>); <span class="comment">// å›ä¼ çš„userä¸ºnull</span></span><br></pre></td></tr></table></figure><p>å½“å‰æ ·ä¾‹3:  å½“è°ƒç”¨Insertçš„æ—¶å€™<strong>ä¸è®ºä¼ å…¥çš„Userå­—èŠ‚ç å¯¹è±¡</strong>æ˜¯è°,éƒ½è¿”å›100</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Mockito.when(userService.insertUser(Mockito.any(User.class))).thenReturn(<span class="number">100</span>);</span><br><span class="line"><span class="type">Integer</span> <span class="variable">i</span> <span class="operator">=</span> userService.insertUser(<span class="keyword">new</span> <span class="title class_">User</span>()); <span class="comment">//ä¼šè¿”å›100</span></span><br></pre></td></tr></table></figure><p>å…¶ä»–æ³¨è§£:</p><p>4.<code>thenThrow</code>: å½“è¯·æ±‚æ–¹æ³•ä¼ å…¥çš„å€¼ä¸º1æ—¶,æŠ›å‡ºä¸€ä¸ªRuntimeException (<strong>é€‚ç”¨äº æœ‰å‡ºå‚çš„æ–¹æ³•</strong>)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Mockito.when(userService.getUserById(<span class="number">1</span>))</span><br><span class="line">       .thenThrow(<span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;mock throw exception&quot;</span>));</span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getUserById(<span class="number">1</span>); <span class="comment">//ä¼šæŠ›å‡ºä¸€ä¸ªRuntimeException</span></span><br></pre></td></tr></table></figure><p>5.<code>doThrow</code> å¦‚æœæ–¹æ³•æ²¡æœ‰è¿”å›å€¼çš„è¯ï¼ˆå³æ˜¯æ–¹æ³•å®šä¹‰ä¸º public void myMethod() {â€¦}ï¼‰ï¼Œè¦æ”¹ç”¨ doThrow() æŠ›å‡º Exception, doThrow ( <strong>é€‚ç”¨äº æ²¡æœ‰å‡ºå‚çš„æ–¹æ³•</strong>)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Mockito.doThrow(<span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;mock throw exception&quot;</span>))</span><br><span class="line">       .when(userService).print();</span><br><span class="line">userService.print(); <span class="comment">//ä¼šæŠ›å‡ºä¸€ä¸ªRuntimeException</span></span><br></pre></td></tr></table></figure><h2 id="ç®€å•æ¨¡æ‹ŸSpringBoot"><a href="#ç®€å•æ¨¡æ‹ŸSpringBoot" class="headerlink" title="ç®€å•æ¨¡æ‹ŸSpringBoot"></a>ç®€å•æ¨¡æ‹ŸSpringBoot</h2><h3 id="åˆå§‹åŒ–Springé¡¹ç›®"><a href="#åˆå§‹åŒ–Springé¡¹ç›®" class="headerlink" title="åˆå§‹åŒ–Springé¡¹ç›®"></a>åˆå§‹åŒ–Springé¡¹ç›®</h3><p>1.åˆ›å»ºmavenå·¥ç¨‹,å»ºä¸¤ä¸ª<code>Module</code></p><img src="/2023/10/08/SpringBoot/create_module.png" class><ol><li>springbootæ¨¡å—ï¼Œè¡¨ç¤ºspringbootæ¡†æ¶çš„æºç å®ç°</li><li>useråŒ…ï¼Œè¡¨ç¤ºç”¨æˆ·ä¸šåŠ¡ç³»ç»Ÿï¼Œç”¨æ¥å†™ä¸šåŠ¡ä»£ç æ¥æµ‹è¯•æˆ‘ä»¬æ‰€æ¨¡æ‹Ÿå‡ºæ¥çš„SpringBoot</li></ol><p>2.å…¶ä¸­SpringBootä¹Ÿæ˜¯ä¾èµ–äºSpring,æˆ‘ä»¬éœ€è¦å¤„ç†è¯·æ±‚,æ•…éœ€è¦å¯¼å…¥SpringMVC,å½“ç„¶è¿˜æœ‰Tomcatç­‰ä¾èµ–</p><p>å¯¼å…¥ä¾èµ– (å…¶ä¸­Java JDKç‰ˆæœ¬ä¸º1.8)</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.11.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.11.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.11.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.embed<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-embed-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>9.0.65<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨Useræµ‹è¯•æ¨¡å—ä¸­å¼•å…¥åˆšåˆšåˆ›å»ºçš„SpringBootæ¨¡å—(è¿™ä¸ªæ˜¯å¦å¤–ä¸€ä¸ªæ¨¡å—çš„)</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springboot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springboot<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨Useræ¨¡å—ä¸­åˆ›å»ºä¸€ä¸ªæ ‡å‡†çš„æµ‹è¯•ç»“æ„</p><p>Controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/test&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userService.test();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Service</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello My SpringBoot!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ ¸å¿ƒæ³¨è§£ä¸æ ¸å¿ƒç±»"><a href="#æ ¸å¿ƒæ³¨è§£ä¸æ ¸å¿ƒç±»" class="headerlink" title="æ ¸å¿ƒæ³¨è§£ä¸æ ¸å¿ƒç±»"></a><strong>æ ¸å¿ƒæ³¨è§£ä¸æ ¸å¿ƒç±»</strong></h4><p>å¯åŠ¨ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> MyApplication</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> è‡ªå®šä¹‰SpringBoot</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> QiuLiHang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@HangSpringBootApplication</span> <span class="comment">// è¯¥æ³¨è§£é‡Œé¢åŒ…å«äº†ComponentScanæ³¨è§£</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        HangSpringApplication.run(MyApplication.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨springbootæ¨¡å—ä¸­åˆ›å»º</p><p>å¯åŠ¨ç±»æ ‡è®°æ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span>  <span class="comment">// é»˜è®¤æ‰«æå½“å‰è§£æç±»çš„åŒ…è·¯å¾„,ä¼ ç»™runæ–¹æ³•çš„ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> HangSpringBootApplication &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯åŠ¨SpringBootåº”ç”¨çš„å¯åŠ¨ç±» -&gt; run()æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HangSpringApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(Class clazz)</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="runæ–¹æ³•"><a href="#runæ–¹æ³•" class="headerlink" title="runæ–¹æ³•"></a>runæ–¹æ³•</h4><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦çš„æ˜¯,å¯åŠ¨ç±»æ‰§è¡Œå®Œæˆ,å°±å¯ä»¥åƒåŸç”ŸSpringBootä¸€æ ·åœ¨æµè§ˆå™¨ä¸Šå¯ä»¥è®¿é—®åˆ°<code>localhost:8081/test</code> æ–¹æ³•</p><p>é‚£ä¹ˆæ­¤æ—¶è‚¯å®šè¦<strong>å¯åŠ¨Tomcatå®¹å™¨</strong>,è¦æƒ³å¤„ç†è¯·æ±‚,åœ¨Springå®¹å™¨ä¸­æ·»åŠ åˆ›å»ºçš„<code>DispatcherServlet</code>å¯¹è±¡æ·»åŠ åˆ°Tomcaté‡Œé¢,æœ€åå¯åŠ¨Tomcat</p><h4 id="åˆ›å»ºSpringå®¹å™¨"><a href="#åˆ›å»ºSpringå®¹å™¨" class="headerlink" title="åˆ›å»ºSpringå®¹å™¨"></a>åˆ›å»ºSpringå®¹å™¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HangSpringApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(Class clazz)</span>&#123;</span><br><span class="line">         <span class="comment">// åˆ›å»ºSpringå®¹å™¨</span></span><br><span class="line">        <span class="type">AnnotationConfigWebApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">AnnotationConfigWebApplicationContext</span>();</span><br><span class="line">        <span class="comment">// æ³¨å†Œ: clazz -&gt; Springå®¹å™¨çš„é…ç½®ç±»</span></span><br><span class="line">        applicationContext.register(clazz);</span><br><span class="line">        <span class="comment">// åˆ·æ–°å®¹å™¨,åŠ è½½è¢«æ‰«æçš„bean</span></span><br><span class="line">        applicationContext.refresh();</span><br><span class="line">        <span class="comment">// å¯åŠ¨Tomcat (æ­¤å¤„æœªå®ç°å¯åŠ¨å…¶ä»–æœåŠ¡å™¨)</span></span><br><span class="line">        startTomcat(applicationContext);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡<code>AnnotationConfigWebApplicationContext</code>åˆ›å»ºçš„å®¹å™¨,æŠŠä¼ å…¥çš„clazzä½œä¸ºå®¹å™¨çš„é…ç½®ç±», æ¯”å¦‚æ­¤æ—¶æˆ‘ä¼ å…¥çš„æ˜¯<code>MyApplication.class</code>ç±»,å½“å‰ç±»ä½œä¸ºé…ç½®ç±»,ç”±äºå½“å‰ç±»å¤´ä¸Šå¸¦æœ‰æˆ‘ä»¬åˆšåˆš<strong>è‡ªå®šä¹‰çš„å¯åŠ¨ç±»æ³¨è§£</strong><code>@HangSpringBootApplication</code>, å…¶ä¸­å½“å‰æ³¨è§£å†…éƒ¨å¸¦æœ‰<strong>æ‰«ææ³¨è§£</strong><code> @ComponentScan</code> é‚£ä¹ˆå°†ä¼šè‡ªåŠ¨é»˜è®¤æ‰«æ<strong>å½“å‰è§£æç±»çš„åŒ…è·¯å¾„(ä¼ å…¥runæ–¹æ³•çš„ç±»åŒ…è·¯å¾„)</strong>,å‡å¦‚è®¾ç½®äº†æ˜ç¤ºäº†æ‰«æè·¯å¾„,åˆ™æ‰«æè‡ªå®šä¹‰è·¯å¾„, é‚£ä¹ˆåˆ™ä¼šæ‰«æåˆ°æˆ‘ä»¬çš„<code>UserService å’Œ UserController</code> , ç„¶åæ·»åŠ åˆ°Springå®¹å™¨é‡Œé¢</p><p>ä¸€èˆ¬æƒ…å†µ æˆ‘ä»¬ä¼š<strong>ç›´æ¥æŠŠå¯åŠ¨ç±»å½“æˆé…ç½®ç±»</strong></p><p>è€Œä¸ä¼šè¿›è¡Œå¦‚ä¸‹æ“ä½œ: åœ¨å…¶ä»–ç±»ä¸­åˆ›å»ºå¯åŠ¨ç±»,ç„¶ååœ¨mainæ–¹æ³•(<strong>ä¸æ˜¯å¯åŠ¨ç±»äº†,æ²¡æœ‰å¸¦å¯åŠ¨ç±»æ ‡è¯†æ³¨è§£</strong>)ä¸­è¿›è¡Œ<code>HangSpringApplication.run(MyApplication.class)</code>æ“ä½œ <strong>(å¯åŠ¨ç±»æ ‡è¯†@HangSpringBootApplicationå½“å‰æ ‡æ˜åœ¨MyApplicationç±»ä¸Š)</strong></p><h4 id="å¯åŠ¨Tomcat"><a href="#å¯åŠ¨Tomcat" class="headerlink" title="å¯åŠ¨Tomcat"></a>å¯åŠ¨Tomcat</h4><p>å¯¹äºSpringBoot,å®ƒä½¿ç”¨çš„æ˜¯å†…åµŒTomcatæ–¹å¼,å¯¹äºå†…åµŒTomcat,æˆ‘ä»¬éœ€è¦è¿›è¡Œé…ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">startTomcat</span><span class="params">(WebApplicationContext applicationContext)</span>&#123;</span><br><span class="line"><span class="comment">// å¯åŠ¨ Tomcat</span></span><br><span class="line">        <span class="type">Tomcat</span> <span class="variable">tomcat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Tomcat</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">Server</span> <span class="variable">server</span> <span class="operator">=</span> tomcat.getServer();</span><br><span class="line">        <span class="type">Service</span> <span class="variable">service</span> <span class="operator">=</span> server.findService(<span class="string">&quot;Tomcat&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Connector</span> <span class="variable">connector</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Connector</span>();</span><br><span class="line">        connector.setPort(<span class="number">8081</span>); <span class="comment">// è¿æ¥ç«¯å£</span></span><br><span class="line"></span><br><span class="line">        <span class="type">Engine</span> <span class="variable">engine</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardEngine</span>();</span><br><span class="line">        engine.setDefaultHost(<span class="string">&quot;localhost&quot;</span>);<span class="comment">// æœ¬åœ°æµ‹è¯•</span></span><br><span class="line"></span><br><span class="line">        <span class="type">Host</span> <span class="variable">host</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardHost</span>();</span><br><span class="line">        host.setName(<span class="string">&quot;localhost&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">contextPath</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardContext</span>();</span><br><span class="line">        context.setPath(contextPath);</span><br><span class="line">        context.addLifecycleListener(<span class="keyword">new</span> <span class="title class_">Tomcat</span>.FixContextListener());</span><br><span class="line"></span><br><span class="line">        host.addChild(context);</span><br><span class="line">        engine.addChild(host);</span><br><span class="line"></span><br><span class="line">        service.setContainer(engine);</span><br><span class="line">        service.addConnector(connector);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// SpringMVC å¤„ç†è¯·æ±‚  æ³¨å†ŒDispatcherServlet</span></span><br><span class="line">        tomcat.addServlet(contextPath, <span class="string">&quot;dispatcher&quot;</span>,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">DispatcherServlet</span>(applicationContext));<span class="comment">// ä¼ å…¥Springå®¹å™¨</span></span><br><span class="line">        context.addServletMappingDecoded(<span class="string">&quot;/*&quot;</span>, <span class="string">&quot;dispatcher&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            tomcat.start();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (LifecycleException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å°±èƒ½å¯åŠ¨Tomcatäº†,å¯ä»¥æ­£å¸¸å¯åŠ¨äº†,å…¶ä¸­æ§åˆ¶å°ä¼šè¾“å‡ºtomcatå¯åŠ¨æƒ…å†µ,ä¾‹å¦‚åˆšåˆšè®¾ç½®çš„8081ç«¯å£</p><p> æµè§ˆå™¨è®¿é—®<code>localhost:8081/test</code>,ç»“æœè¿”å›äº†<code>&quot;Hello My SpringBoot!&quot;</code></p><h4 id="ä¿®æ”¹å…¶ä»–çš„æœåŠ¡å™¨"><a href="#ä¿®æ”¹å…¶ä»–çš„æœåŠ¡å™¨" class="headerlink" title="ä¿®æ”¹å…¶ä»–çš„æœåŠ¡å™¨"></a>ä¿®æ”¹å…¶ä»–çš„æœåŠ¡å™¨</h4><p>1.åœ¨springbootä¸­åˆ›å»ºä¸€ä¸ªæŠ½è±¡æ–¹æ³•ä¸º:<code>WebServer</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¯¹è‡ªå®šä¹‰æœåŠ¡å™¨è°ƒç”¨ å®ç°æŠ½è±¡åŒ–</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">WebServer</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æœåŠ¡å¯åŠ¨æŠ½è±¡æ¥å£</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">(WebApplicationContext applicationContext)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.å®šä¹‰å…¶ä»–æœåŠ¡å™¨æ¥å£å®ç°ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> TomcatWebServer</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> TomcatæœåŠ¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> QiuLiHang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TomcatWebServer</span> <span class="keyword">implements</span> <span class="title class_">WebServer</span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *TomcatæœåŠ¡å¯åŠ¨ç±»</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">(WebApplicationContext applicationContext)</span> &#123;</span><br><span class="line">        <span class="type">Tomcat</span> <span class="variable">tomcat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Tomcat</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">Server</span> <span class="variable">server</span> <span class="operator">=</span> tomcat.getServer();</span><br><span class="line">        <span class="type">Service</span> <span class="variable">service</span> <span class="operator">=</span> server.findService(<span class="string">&quot;Tomcat&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Connector</span> <span class="variable">connector</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Connector</span>();</span><br><span class="line">        connector.setPort(<span class="number">8081</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Engine</span> <span class="variable">engine</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardEngine</span>();</span><br><span class="line">        engine.setDefaultHost(<span class="string">&quot;localhost&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Host</span> <span class="variable">host</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardHost</span>();</span><br><span class="line">        host.setName(<span class="string">&quot;localhost&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">contextPath</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardContext</span>();</span><br><span class="line">        context.setPath(contextPath);</span><br><span class="line">        context.addLifecycleListener(<span class="keyword">new</span> <span class="title class_">Tomcat</span>.FixContextListener());</span><br><span class="line"></span><br><span class="line">        host.addChild(context);</span><br><span class="line">        engine.addChild(host);</span><br><span class="line"></span><br><span class="line">        service.setContainer(engine);</span><br><span class="line">        service.addConnector(connector);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// SpringMVC å¤„ç†è¯·æ±‚</span></span><br><span class="line">        tomcat.addServlet(contextPath, <span class="string">&quot;dispatcher&quot;</span>,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">DispatcherServlet</span>(applicationContext));<span class="comment">// ä¼ å…¥Springå®¹å™¨</span></span><br><span class="line">        context.addServletMappingDecoded(<span class="string">&quot;/*&quot;</span>, <span class="string">&quot;dispatcher&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            tomcat.start();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (LifecycleException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> JettyWebServer</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> JettyæœåŠ¡å¯åŠ¨ç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> QiuLiHang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JettyWebServer</span> <span class="keyword">implements</span> <span class="title class_">WebServer</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">(WebApplicationContext applicationContext)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å¯åŠ¨jetty&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šæ·»åŠ äº†ä¸¤ä¸ªç¤ºä¾‹æœåŠ¡å®ç°ç±»</p><p>å†æ¬¡ä¿®æ”¹runæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HangSpringApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(Class clazz)</span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºSpringå®¹å™¨</span></span><br><span class="line">        <span class="type">AnnotationConfigWebApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">AnnotationConfigWebApplicationContext</span>();</span><br><span class="line">        <span class="comment">// æ³¨å†Œ: clazz -&gt; Springå®¹å™¨çš„é…ç½®ç±»</span></span><br><span class="line">        applicationContext.register(clazz);</span><br><span class="line">        <span class="comment">// åˆ·æ–°å®¹å™¨,åŠ è½½è¢«æ‰«æçš„bean</span></span><br><span class="line">        applicationContext.refresh();</span><br><span class="line">        <span class="comment">// å¯åŠ¨Tomcat  -&gt; å½“å‰æ–¹æ³•åªèƒ½å¯åŠ¨tomcat</span></span><br><span class="line">        <span class="comment">// startTomcat(applicationContext); // åŸæ–¹æ³•</span></span><br><span class="line">        <span class="comment">// é‚£ä¹ˆå¦‚ä½•ä¼˜é›…çš„å¯åŠ¨è‡ªå®šä¹‰çš„æœåŠ¡å™¨å‘¢? å³pomä¸­å¯¼å…¥çš„æœåŠ¡å™¨</span></span><br><span class="line">        <span class="comment">// 1. è·å–WebServerç±» (å¤šæ€)</span></span><br><span class="line">        <span class="type">WebServer</span> <span class="variable">webServer</span> <span class="operator">=</span> getWebServer(applicationContext);</span><br><span class="line">        <span class="comment">// 2. è°ƒç”¨å­ç±»å¯åŠ¨æœåŠ¡</span></span><br><span class="line">        webServer.start(applicationContext);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *   è·å–Springå®¹å™¨ä¸­çš„WebServerå¯¹è±¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> WebServer <span class="title function_">getWebServer</span><span class="params">(WebApplicationContext webApplicationContext)</span> &#123;</span><br><span class="line">        <span class="comment">// keyä¸ºbeanName,valueä¸ºBeanå¯¹è±¡</span></span><br><span class="line">        Map&lt;String,WebServer&gt; webServers =</span><br><span class="line">                webApplicationContext.getBeansOfType(WebServer.class);<span class="comment">// è·å–WebServerç±»å‹çš„å¯¹è±¡</span></span><br><span class="line">        <span class="comment">// é™åˆ¶Springå®¹å™¨ä¸­çš„WebServerå¯¹è±¡</span></span><br><span class="line">        <span class="comment">// 1.ä¸èƒ½ä¸ºç©º</span></span><br><span class="line">        <span class="keyword">if</span>(webServers.isEmpty())&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2.åªèƒ½å­˜åœ¨ä¸€ä¸ª</span></span><br><span class="line">        <span class="keyword">if</span>(webServers.size() &gt; <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è¿”å›å”¯ä¸€çš„ä¸€ä¸ª</span></span><br><span class="line">        <span class="keyword">return</span> webServers.values().stream().findFirst().get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶,åœ¨å¯åŠ¨ç±»ä¸­æ·»åŠ ä¸€ä¸ªTomcat çš„Bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@HangSpringBootApplication</span> <span class="comment">// è¯¥æ³¨è§£é‡Œé¢åŒ…å«äº†ComponentScanæ³¨è§£</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Springé…ç½®ç±»ä¸­é…ç½®çš„bean</span></span><br><span class="line">    <span class="comment">// ä¼šè¢«åŠ å…¥åˆ°SpringIOCå®¹å™¨é‡Œé¢,åœ¨åé¢å¯åŠ¨WebServerçš„æ—¶å€™ ä¼šè¢«æ‰«æåˆ°</span></span><br><span class="line">    <span class="comment">// ç„¶åé€šè¿‡å¤šæ€ å¯åŠ¨å­ç±»å®ç°çš„æœåŠ¡æ¥å£</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> TomcatWebServer <span class="title function_">tomcatWebServer</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TomcatWebServer</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        HangSpringApplication.run(MyApplication.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“å‰æƒ…å†µå¯åŠ¨ç»“æœå¦‚ä¸‹</p><img src="/2023/10/08/SpringBoot/tomcat_bean.png" class><p>å½“ç„¶,è‡ªå·±åœ¨å¯åŠ¨ç±»ä¸­é…ç½®æœåŠ¡å™¨çš„bean,æ˜¾ç„¶è€¦åˆåº¦å¤ªé«˜äº†,è‡³æ­¤æˆ‘ä»¬éœ€è¦å¼•å…¥æ–°çš„æ–¹æ¡ˆ</p><h5 id="è‡ªåŠ¨é…ç½®WebServeræœåŠ¡"><a href="#è‡ªåŠ¨é…ç½®WebServeræœåŠ¡" class="headerlink" title="è‡ªåŠ¨é…ç½®WebServeræœåŠ¡"></a><strong>è‡ªåŠ¨é…ç½®WebServeræœåŠ¡</strong></h5><p>é¦–å…ˆåœ¨springbootæ¨¡å—ä¸­æ·»åŠ <code>WebServerAutoConfiguration</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span> WebServerAutoConfiguration</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> WebServerè‡ªåŠ¨é…ç½®ç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> QiuLiHang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span> <span class="comment">// äº¤ç»™Springç®¡ç†</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebServerAutoConfiguration</span> &#123;</span><br><span class="line">    <span class="comment">// Springé…ç½®æ–‡ä»¶</span></span><br><span class="line">    <span class="comment">// WebServerè‡ªåŠ¨é…ç½®ç±»</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Conditional(TomcatCondition.class)</span></span><br><span class="line">    <span class="keyword">public</span> TomcatWebServer <span class="title function_">tomcatWebServer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TomcatWebServer</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Conditional(JettyCondition.class)</span></span><br><span class="line">    <span class="keyword">public</span> JettyWebServer <span class="title function_">jettyWebServer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JettyWebServer</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­å‘ç°æœ‰ä¸€ä¸ªæ³¨è§£ä¸º <code>@Conditional(TomcatCondition.class)</code></p><p>è¯¥æ³¨è§£,å½“è¯¥Condition.classåˆ¤æ–­è¿”å›çš„booleanç»“æœ,ä½œä¸ºæ˜¯å¦æ‰§è¡Œè¯¥æ–¹æ³•çš„æ¡ä»¶,å¦‚æœè¿”å›trueåˆ™è¯¥æ³¨è§£ä¿®é¥°çš„è¯¥æ–¹æ³•å¯æ‰§è¡Œ</p><p>å…¶ä¸­<code>TomcatCondition</code>ç±»éœ€è¦è‡ªå®šä¹‰:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TomcatCondition</span> <span class="keyword">implements</span> <span class="title class_">Condition</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(ConditionContext conditionContext, AnnotatedTypeMetadata annotatedTypeMetadata)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ¤æ–­é¡¹ç›®ä¸­æ˜¯å¦æœ‰ç¬¦åˆæ¡ä»¶çš„ä¾èµ–</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// åˆ©ç”¨ç±»åŠ è½½å™¨,åŠ è½½éœ€è¦åˆ¤æ–­çš„ç±»</span></span><br><span class="line">  conditionContext.getClassLoader().loadClass(<span class="string">&quot;org.apache.catalina.startup.Tomcat&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;<span class="comment">// èƒ½èµ°åˆ°è¿™ä¸ªåœ°æ–¹ è¯æ˜æœ‰</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// æ²¡æœ‰è¯¥ç±»</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        // å¦‚æœè¿”å›true,åˆ™ç¬¦åˆæ¡ä»¶</span></span><br><span class="line"><span class="comment">//        return false;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>èµ°åˆ°è¿™äº†, ä¸Šé¢çš„ç›®æ ‡å°±æ˜¯,æ£€æŸ¥å½“å‰ä¾èµ–æ˜¯å¦åŒ…å«ä¿®é¥°çš„ä¾èµ–é¡¹, å®ç°è‡ªåŠ¨åˆ¤æ–­</p><p>ç°åœ¨è¿˜ä¼šå‡ºç°é—®é¢˜, å°±æ˜¯ ä¸èƒ½åƒSpringBootä¸€æ ·,é»˜è®¤Tomcat, æ’é™¤å…¶ä»–çš„æœåŠ¡å™¨ä¾èµ–ç»™å­é¡¹ç›®, æ­¤æ—¶è¦åœ¨çˆ¶é¡¹ç›®ä¸­çš„pom.xmlä¸­è®¾ç½®<code>&lt;optional&gt;true&lt;/optional&gt;</code>å±æ€§: è¯¥ä¾èµ–åœ¨<strong>é¡¹ç›®ä¹‹é—´ä¾èµ–ä¸ä¼ é€’</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.embed<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-embed-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>9.0.65<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.eclipse.jetty<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jetty-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>9.4.14.v20181114<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">          åŠ äº†è¿™ä¸ªè®¾ç½®,ç¦æ­¢ä¾èµ–ä¼ é€’,å³ä¼ ç»™å­ç±»</span></span><br><span class="line"><span class="comment">          (å› ä¸ºSpringBootä¹Ÿæ˜¯é»˜è®¤ä¼ é€’Tomcatè€Œä¸ä¼ é€’jettyç­‰å…¶ä»–)</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶, å¦‚æœåœ¨å­æ¨¡å—ä¸­æƒ³åˆ‡æ¢<code>jetty</code> ,åœ¨ä¾èµ–çˆ¶é¡¹ç›®å¤„ä½¿ç”¨<code>exclusion</code>æ’é™¤çˆ¶é¡¹ç›®ä¼ é€’çš„ä¾èµ–, å†æ·»åŠ å…¶ä»–ä¾èµ–, ç¤ºä¾‹å¦‚ä¸‹</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.hang<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springboot<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--æ’é™¤tomcat--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.embed<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-embed-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--åˆ‡æ¢ä¸ºjetty--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.eclipse.jetty<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jetty-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>9.4.14.v20181114<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="æ¨¡æ‹Ÿæ¡ä»¶æ³¨è§£"><a href="#æ¨¡æ‹Ÿæ¡ä»¶æ³¨è§£" class="headerlink" title="æ¨¡æ‹Ÿæ¡ä»¶æ³¨è§£"></a>æ¨¡æ‹Ÿæ¡ä»¶æ³¨è§£</h4><p>åœ¨ä¸Šé¢çš„æ¨¡æ‹Ÿæ–¹æ¡ˆ,  åŸºäºä¸¤ä¸ªæœåŠ¡å™¨çš„é€‰æ‹©ä»è€Œå®šä¹‰äº†ä¸¤ä¸ªConditionç±»: 1.TomcatCondition  2.JettyCondition</p><p>å¤§èƒ†æƒ³è±¡,  åŠ å…¥æœ‰å¾ˆå¤šæœåŠ¡å™¨éœ€è¦ç­›é€‰,  ç„¶åå‘ç°å…¨éƒ¨éƒ½æ˜¯é‡å¤çš„ä»£ç ,  ä½•ä¸å¦‚å°è£…ä¸€ä¸‹å‘¢</p><p>ä»¿SpringBootçš„<code>ConditionalOnClass</code>ç¼–å†™ä¸€ä¸ª<code>HangConditionalOnClass</code>.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE, ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Conditional(HangCondition.class)</span>  <span class="comment">// å°è£…çš„æ¡ä»¶æ’é™¤ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> HangConditionalOnClass &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‹¿åˆ°çš„ç±»å</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>HangConditionç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HangCondition</span> <span class="keyword">implements</span> <span class="title class_">Condition</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(ConditionContext conditionContext, AnnotatedTypeMetadata annotatedTypeMetadata)</span> &#123;</span><br><span class="line">        <span class="comment">// AnnotatedTypeMetadata é‡Œé¢æœ‰è§£æåˆ°HangConditionalOnClassæ³¨è§£çš„Valueä¿¡æ¯</span></span><br><span class="line">        <span class="comment">// å› ä¸ºæ˜¯è§£æåˆ°HangConditionalOnClassæ³¨è§£æ‰è¿›æ¥è¿™é‡Œçš„</span></span><br><span class="line">        Map&lt;String, Object&gt; annotationAttributes = annotatedTypeMetadata.getAnnotationAttributes(HangConditionalOnClass.class.getName());</span><br><span class="line">        <span class="type">String</span> <span class="variable">values</span> <span class="operator">=</span> (String) annotationAttributes.get(<span class="string">&quot;value&quot;</span>); <span class="comment">// æ‹¿åˆ°Value</span></span><br><span class="line">        <span class="comment">// åˆ¤æ–­é¡¹ç›®ä¸­æ˜¯å¦æœ‰ç¬¦åˆæ¡ä»¶çš„ä¾èµ–</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// åˆ©ç”¨ç±»åŠ è½½å™¨,åŠ è½½éœ€è¦åˆ¤æ–­çš„ç±»</span></span><br><span class="line">            conditionContext.getClassLoader().loadClass(values);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;<span class="comment">// èƒ½èµ°åˆ°è¿™ä¸ªåœ°æ–¹ è¯æ˜æœ‰</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// æ²¡æœ‰è¯¥ç±»</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è‡ªåŠ¨é…ç½®ç±»"><a href="#è‡ªåŠ¨é…ç½®ç±»" class="headerlink" title="è‡ªåŠ¨é…ç½®ç±»"></a>è‡ªåŠ¨é…ç½®ç±»</h4><p>æœ‰äº†æ¡ä»¶æ³¨è§£ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¥ä½¿â½¤å®ƒäº†ï¼Œé‚£å¦‚ä½•å®ç°å‘¢ï¼Ÿè¿™â¾¥å°±è¦â½¤åˆ°â¾ƒåŠ¨é…ç½®ç±»çš„æ¦‚å¿µï¼Œæˆ‘ä»¬å…ˆçœ‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebServiceAutoConfiguration</span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@HangConditionalOnClass(&quot;org.apache.catalina.startup.Tomcat&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> TomcatWebServer <span class="title function_">tomcatWebServer</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TomcatWebServer</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@HangConditionalOnClass(&quot;org.eclipse.jetty.server.Server&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JettyWebServer <span class="title function_">jettyWebServer</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JettyWebServer</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä»£ç è·Ÿæœ€å¼€å§‹çš„å¤§åŒå°å¼‚,  åªä¸è¿‡åŠ äº†æˆ‘ä»¬çš„æ¡ä»¶æ³¨è§£</p><p>è¦å®ç°æœåŠ¡å™¨è‡ªåŠ¨é…ç½®åªéœ€è¦åœ¨è¿‡æ»¤æ‰æ‰€æœ‰beanç•™ä¸‹å”¯ä¸€çš„beanå°±è¡Œäº†</p><p>è¿™æ ·æ•´ä½“SpringBootå¯åŠ¨é€»è¾‘å°±æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>åˆ›å»ºâ¼€ä¸ªAnnotationConfigWebApplicationContextå®¹å™¨</li><li>è§£æMyApplicationç±»ï¼Œç„¶åè¿›â¾æ‰«æ</li><li>é€šè¿‡getWebServerâ½…æ³•ä»Springå®¹å™¨ä¸­è·å–WebServerç±»å‹çš„Bean</li><li>è°ƒâ½¤WebServerå¯¹è±¡çš„startâ½…æ³•</li></ol><p>æœ‰äº†ä»¥ä¸Šæ­¥éª¤ï¼Œæˆ‘ä»¬è¿˜å·®äº†â¼€ä¸ªå…³é”®æ­¥éª¤ï¼Œå°±æ˜¯Springè¦èƒ½è§£æåˆ°WebServiceAutoConfigurationè¿™ä¸ªâ¾ƒåŠ¨é…ç½®ç±»ï¼Œå› ä¸ºä¸ç®¡è¿™ä¸ªç±»â¾¥å†™äº†ä»€ä¹ˆä»£ç ï¼ŒSpringä¸å»è§£æå®ƒï¼Œé‚£éƒ½æ˜¯æ²¡â½¤çš„ï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦SpringBootåœ¨runâ½…æ³•ä¸­ï¼Œèƒ½æ‰¾åˆ°WebServiceAutoConfigurationè¿™ä¸ªé…ç½®ç±»å¹¶æ·»åŠ åˆ°Springå®¹å™¨ä¸­ã€‚</p><p>åŸºäºåŒ…æ‰«æ,  åœ¨SpringBootä¸­è‡ªå·±å®ç°äº†ä¸€å¥—SPIæœºåˆ¶,  ä¹Ÿå°±æ˜¯ç†Ÿæ‚‰çš„<u>spring.factories</u></p><h4 id="å‘ç°è‡ªåŠ¨é…ç½®ç±»"><a href="#å‘ç°è‡ªåŠ¨é…ç½®ç±»" class="headerlink" title="å‘ç°è‡ªåŠ¨é…ç½®ç±»"></a>å‘ç°è‡ªåŠ¨é…ç½®ç±»</h4><p>åŸºäºSPIæœºåˆ¶, SpringBootçº¦å®šåœ¨é¡¹ç›®çš„resourceç›®å½•ä¸‹çš„META_INFä¸­åˆ›å»ºspring.factories,  é…ç½®SpringBootä¸­æ‰€éœ€æ‰«æçš„ç±»</p><p>å¹¶ä¸”æä¾›ä¸€ä¸ªæ¥å£</p><p>HangAutoConfiguration</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">HangAutoConfiguration</span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨WebServiceAutoConfigurationå®ç°æ­¤æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebServiceAutoConfiguration</span> <span class="keyword">implements</span> <span class="title class_">HangAutoConfiguration</span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@HangConditionalOnClass(&quot;org.apache.catalina.startup.Tomcat&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> TomcatWebServer <span class="title function_">tomcatWebServer</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TomcatWebServer</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@HangConditionalOnClass(&quot;org.eclipse.jetty.server.Server&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JettyWebServer <span class="title function_">jettyWebServer</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JettyWebServer</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶ååˆ©ç”¨springä¸­çš„@ImportæŠ€æœ¯å¯¼å…¥è¿™äº›é…ç½®ç±»,  æˆ‘ä»¬åœ¨@HangSpringBootApplicationçš„å®šä¹‰ä¸Šå¢åŠ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import(HangImportSelect.class)</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ZhouyuImportSelect</span> <span class="keyword">implements</span> <span class="title class_">DeferredImportSelector</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] selectImports(AnnotationMetadata  importingClassMetadata)  &#123;</span><br><span class="line">        ServiceLoader&lt;AutoConfiguration&gt; serviceLoader =  ServiceLoader.load(AutoConfiguration.class);</span><br><span class="line">        List&lt;String&gt; list = <span class="keyword">new</span>  <span class="title class_">ArrayList</span>&lt;&gt;();  </span><br><span class="line">        <span class="keyword">for</span>(AutoConfiguration autoConfiguration : serviceLoader)&#123;</span><br><span class="line">            list.add(autoConfiguration.getClass().getName());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list.toArray(<span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™å°±å®Œæˆäº†ä»com.zhouyu.springboot.AutoConfigurationâ½‚ä»¶ä¸­è·å–â¾ƒåŠ¨é…ç½®ç±»çš„åå­—ï¼Œå¹¶å¯¼â¼Šåˆ°Springå®¹å™¨ä¸­ï¼Œä»â½½Springå®¹å™¨å°±çŸ¥é“äº†è¿™äº›é…ç½®ç±»çš„å­˜åœ¨ï¼Œâ½½å¯¹äºuseré¡¹â½¬â½½â¾”ï¼Œæ˜¯ä¸éœ€è¦ä¿®æ”¹ä»£ç çš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> åç«¯ </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringMVC</title>
      <link href="/2023/10/06/SpringMVC/"/>
      <url>/2023/10/06/SpringMVC/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="ä¸€ã€SpringMVCç®€ä»‹"><a href="#ä¸€ã€SpringMVCç®€ä»‹" class="headerlink" title="ä¸€ã€SpringMVCç®€ä»‹"></a>ä¸€ã€SpringMVCç®€ä»‹</h1><h3 id="1ã€ä»€ä¹ˆæ˜¯MVC"><a href="#1ã€ä»€ä¹ˆæ˜¯MVC" class="headerlink" title="1ã€ä»€ä¹ˆæ˜¯MVC"></a>1ã€ä»€ä¹ˆæ˜¯MVC</h3><p>MVCæ˜¯ä¸€ç§è½¯ä»¶æ¶æ„çš„æ€æƒ³ï¼Œå°†è½¯ä»¶æŒ‰ç…§æ¨¡å‹ã€è§†å›¾ã€æ§åˆ¶å™¨æ¥åˆ’åˆ†</p><p>Mï¼šModelï¼Œæ¨¡å‹å±‚ï¼ŒæŒ‡å·¥ç¨‹ä¸­çš„JavaBeanï¼Œä½œç”¨æ˜¯å¤„ç†æ•°æ®</p><p>JavaBeanåˆ†ä¸ºä¸¤ç±»ï¼š</p><ul><li>ä¸€ç±»ç§°ä¸ºå®ä½“ç±»Beanï¼šä¸“é—¨å­˜å‚¨ä¸šåŠ¡æ•°æ®çš„ï¼Œå¦‚ Studentã€User ç­‰</li><li>ä¸€ç±»ç§°ä¸ºä¸šåŠ¡å¤„ç† Beanï¼šæŒ‡ Service æˆ– Dao å¯¹è±¡ï¼Œä¸“é—¨ç”¨äºå¤„ç†ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®è®¿é—®ã€‚</li></ul><p>Vï¼šViewï¼Œè§†å›¾å±‚ï¼ŒæŒ‡å·¥ç¨‹ä¸­çš„htmlæˆ–jspç­‰é¡µé¢ï¼Œä½œç”¨æ˜¯ä¸ç”¨æˆ·è¿›è¡Œäº¤äº’ï¼Œå±•ç¤ºæ•°æ®</p><p>Cï¼šControllerï¼Œæ§åˆ¶å±‚ï¼ŒæŒ‡å·¥ç¨‹ä¸­çš„servletï¼Œä½œç”¨æ˜¯æ¥æ”¶è¯·æ±‚å’Œå“åº”æµè§ˆå™¨</p><p>MVCçš„å·¥ä½œæµç¨‹ï¼š<br>ç”¨æˆ·é€šè¿‡è§†å›¾å±‚å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œåœ¨æœåŠ¡å™¨ä¸­è¯·æ±‚è¢«Controlleræ¥æ”¶ï¼ŒControllerè°ƒç”¨ç›¸åº”çš„Modelå±‚å¤„ç†è¯·æ±‚ï¼Œå¤„ç†å®Œæ¯•å°†ç»“æœè¿”å›åˆ°Controllerï¼ŒControllerå†æ ¹æ®è¯·æ±‚å¤„ç†çš„ç»“æœæ‰¾åˆ°ç›¸åº”çš„Viewè§†å›¾ï¼Œæ¸²æŸ“æ•°æ®åæœ€ç»ˆå“åº”ç»™æµè§ˆå™¨</p><h3 id="2ã€ä»€ä¹ˆæ˜¯SpringMVC"><a href="#2ã€ä»€ä¹ˆæ˜¯SpringMVC" class="headerlink" title="2ã€ä»€ä¹ˆæ˜¯SpringMVC"></a>2ã€ä»€ä¹ˆæ˜¯SpringMVC</h3><p>SpringMVCæ˜¯Springçš„ä¸€ä¸ªåç»­äº§å“ï¼Œæ˜¯Springçš„ä¸€ä¸ªå­é¡¹ç›®</p><p>SpringMVC æ˜¯ Spring ä¸ºè¡¨è¿°å±‚å¼€å‘æä¾›çš„ä¸€æ•´å¥—å®Œå¤‡çš„è§£å†³æ–¹æ¡ˆã€‚åœ¨è¡¨è¿°å±‚æ¡†æ¶å†ç» Strustã€WebWorkã€Strust2 ç­‰è¯¸å¤šäº§å“çš„å†ä»£æ›´è¿­ä¹‹åï¼Œç›®å‰ä¸šç•Œæ™®éé€‰æ‹©äº† SpringMVC ä½œä¸º Java EE é¡¹ç›®è¡¨è¿°å±‚å¼€å‘çš„<strong>é¦–é€‰æ–¹æ¡ˆ</strong>ã€‚</p><blockquote><p>æ³¨ï¼šä¸‰å±‚æ¶æ„åˆ†ä¸ºè¡¨è¿°å±‚ï¼ˆæˆ–è¡¨ç¤ºå±‚ï¼‰ã€ä¸šåŠ¡é€»è¾‘å±‚ã€æ•°æ®è®¿é—®å±‚ï¼Œè¡¨è¿°å±‚è¡¨ç¤ºå‰å°é¡µé¢å’Œåå°servlet</p></blockquote><h3 id="3ã€SpringMVCçš„ç‰¹ç‚¹"><a href="#3ã€SpringMVCçš„ç‰¹ç‚¹" class="headerlink" title="3ã€SpringMVCçš„ç‰¹ç‚¹"></a>3ã€SpringMVCçš„ç‰¹ç‚¹</h3><ul><li><strong>Spring å®¶æ—åŸç”Ÿäº§å“</strong>ï¼Œä¸ IOC å®¹å™¨ç­‰åŸºç¡€è®¾æ–½æ— ç¼å¯¹æ¥</li><li><strong>åŸºäºåŸç”Ÿçš„Servlet</strong>ï¼Œé€šè¿‡äº†åŠŸèƒ½å¼ºå¤§çš„<strong>å‰ç«¯æ§åˆ¶å™¨DispatcherServlet</strong>ï¼Œå¯¹è¯·æ±‚å’Œå“åº”è¿›è¡Œç»Ÿä¸€å¤„ç†</li><li>è¡¨è¿°å±‚å„ç»†åˆ†é¢†åŸŸéœ€è¦è§£å†³çš„é—®é¢˜<strong>å…¨æ–¹ä½è¦†ç›–</strong>ï¼Œæä¾›<strong>å…¨é¢è§£å†³æ–¹æ¡ˆ</strong></li><li><strong>ä»£ç æ¸…æ–°ç®€æ´</strong>ï¼Œå¤§å¹…åº¦æå‡å¼€å‘æ•ˆç‡</li><li>å†…éƒ¨ç»„ä»¶åŒ–ç¨‹åº¦é«˜ï¼Œå¯æ’æ‹”å¼ç»„ä»¶<strong>å³æ’å³ç”¨</strong>ï¼Œæƒ³è¦ä»€ä¹ˆåŠŸèƒ½é…ç½®ç›¸åº”ç»„ä»¶å³å¯</li><li><strong>æ€§èƒ½å“è‘—</strong>ï¼Œå°¤å…¶é€‚åˆç°ä»£å¤§å‹ã€è¶…å¤§å‹äº’è”ç½‘é¡¹ç›®è¦æ±‚</li></ul><h1 id="äºŒã€HelloWorld"><a href="#äºŒã€HelloWorld" class="headerlink" title="äºŒã€HelloWorld"></a>äºŒã€HelloWorld</h1><h3 id="1ã€å¼€å‘ç¯å¢ƒ"><a href="#1ã€å¼€å‘ç¯å¢ƒ" class="headerlink" title="1ã€å¼€å‘ç¯å¢ƒ"></a>1ã€å¼€å‘ç¯å¢ƒ</h3><p>IDEï¼šidea 2023.1</p><p>æœåŠ¡å™¨ï¼štomcat8</p><p>Springç‰ˆæœ¬ï¼š5.3.1</p><h3 id="2ã€åˆ›å»ºmavenå·¥ç¨‹"><a href="#2ã€åˆ›å»ºmavenå·¥ç¨‹" class="headerlink" title="2ã€åˆ›å»ºmavenå·¥ç¨‹"></a>2ã€åˆ›å»ºmavenå·¥ç¨‹</h3><h5 id="a-æ·»åŠ webæ¨¡å—"><a href="#a-æ·»åŠ webæ¨¡å—" class="headerlink" title="a&gt;æ·»åŠ webæ¨¡å—"></a>a&gt;æ·»åŠ webæ¨¡å—</h5><h5 id="b-æ‰“åŒ…æ–¹å¼ï¼šwar"><a href="#b-æ‰“åŒ…æ–¹å¼ï¼šwar" class="headerlink" title="b&gt;æ‰“åŒ…æ–¹å¼ï¼šwar"></a>b&gt;æ‰“åŒ…æ–¹å¼ï¼šwar</h5><h5 id="c-å¼•å…¥ä¾èµ–"><a href="#c-å¼•å…¥ä¾èµ–" class="headerlink" title="c&gt;å¼•å…¥ä¾èµ–"></a>c&gt;å¼•å…¥ä¾èµ–</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- SpringMVC --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- æ—¥å¿— --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ServletAPI --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Spring5å’ŒThymeleafæ•´åˆåŒ… --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.thymeleaf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf-spring5<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.12.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3ã€é…ç½®web-xml"><a href="#3ã€é…ç½®web-xml" class="headerlink" title="3ã€é…ç½®web.xml"></a>3ã€é…ç½®web.xml</h3><p>æ³¨å†ŒSpringMVCçš„å‰ç«¯æ§åˆ¶å™¨DispatcherServlet</p><h5 id="a-é»˜è®¤é…ç½®æ–¹å¼"><a href="#a-é»˜è®¤é…ç½®æ–¹å¼" class="headerlink" title="a&gt;é»˜è®¤é…ç½®æ–¹å¼"></a>a&gt;é»˜è®¤é…ç½®æ–¹å¼</h5><p>æ­¤é…ç½®ä½œç”¨ä¸‹ï¼ŒSpringMVCçš„é…ç½®æ–‡ä»¶é»˜è®¤ä½äºWEB-INFä¸‹ï¼Œé»˜è®¤åç§°ä¸º&#x2F;<servlet-name>-servlet.xmlï¼Œä¾‹å¦‚ï¼Œä»¥ä¸‹é…ç½®æ‰€å¯¹åº”SpringMVCçš„é…ç½®æ–‡ä»¶ä½äºWEB-INFä¸‹ï¼Œæ–‡ä»¶åä¸ºspringMVC-servlet.xml</servlet-name></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- é…ç½®SpringMVCçš„å‰ç«¯æ§åˆ¶å™¨ï¼Œå¯¹æµè§ˆå™¨å‘é€çš„è¯·æ±‚ç»Ÿä¸€è¿›è¡Œå¤„ç† --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        è®¾ç½®springMVCçš„æ ¸å¿ƒæ§åˆ¶å™¨æ‰€èƒ½å¤„ç†çš„è¯·æ±‚çš„è¯·æ±‚è·¯å¾„</span></span><br><span class="line"><span class="comment">        /æ‰€åŒ¹é…çš„è¯·æ±‚å¯ä»¥æ˜¯/loginæˆ–.htmlæˆ–.jsæˆ–.cssæ–¹å¼çš„è¯·æ±‚è·¯å¾„</span></span><br><span class="line"><span class="comment">        ä½†æ˜¯/ä¸èƒ½åŒ¹é….jspè¯·æ±‚è·¯å¾„çš„è¯·æ±‚</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="b-æ‰©å±•é…ç½®æ–¹å¼"><a href="#b-æ‰©å±•é…ç½®æ–¹å¼" class="headerlink" title="b&gt;æ‰©å±•é…ç½®æ–¹å¼"></a>b&gt;æ‰©å±•é…ç½®æ–¹å¼</h5><p>å¯é€šè¿‡init-paramæ ‡ç­¾è®¾ç½®SpringMVCé…ç½®æ–‡ä»¶çš„ä½ç½®å’Œåç§°ï¼Œé€šè¿‡load-on-startupæ ‡ç­¾è®¾ç½®SpringMVCå‰ç«¯æ§åˆ¶å™¨DispatcherServletçš„åˆå§‹åŒ–æ—¶é—´</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- é…ç½®SpringMVCçš„å‰ç«¯æ§åˆ¶å™¨ï¼Œå¯¹æµè§ˆå™¨å‘é€çš„è¯·æ±‚ç»Ÿä¸€è¿›è¡Œå¤„ç† --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- é€šè¿‡åˆå§‹åŒ–å‚æ•°æŒ‡å®šSpringMVCé…ç½®æ–‡ä»¶çš„ä½ç½®å’Œåç§° --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- contextConfigLocationä¸ºå›ºå®šå€¼ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- ä½¿ç”¨classpath:è¡¨ç¤ºä»ç±»è·¯å¾„æŸ¥æ‰¾é…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚mavenå·¥ç¨‹ä¸­çš„src/main/resources --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springMVC.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment"> ä½œä¸ºæ¡†æ¶çš„æ ¸å¿ƒç»„ä»¶ï¼Œåœ¨å¯åŠ¨è¿‡ç¨‹ä¸­æœ‰å¤§é‡çš„åˆå§‹åŒ–æ“ä½œè¦åš</span></span><br><span class="line"><span class="comment">è€Œè¿™äº›æ“ä½œæ”¾åœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶æ‰æ‰§è¡Œä¼šä¸¥é‡å½±å“è®¿é—®é€Ÿåº¦</span></span><br><span class="line"><span class="comment">å› æ­¤éœ€è¦é€šè¿‡æ­¤æ ‡ç­¾å°†å¯åŠ¨æ§åˆ¶DispatcherServletçš„åˆå§‹åŒ–æ—¶é—´æå‰åˆ°æœåŠ¡å™¨å¯åŠ¨æ—¶</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springMVC<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        è®¾ç½®springMVCçš„æ ¸å¿ƒæ§åˆ¶å™¨æ‰€èƒ½å¤„ç†çš„è¯·æ±‚çš„è¯·æ±‚è·¯å¾„</span></span><br><span class="line"><span class="comment">        /æ‰€åŒ¹é…çš„è¯·æ±‚å¯ä»¥æ˜¯/loginæˆ–.htmlæˆ–.jsæˆ–.cssæ–¹å¼çš„è¯·æ±‚è·¯å¾„</span></span><br><span class="line"><span class="comment">        ä½†æ˜¯/ä¸èƒ½åŒ¹é….jspè¯·æ±‚è·¯å¾„çš„è¯·æ±‚</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨ï¼š</p><p>&#x2F;<url-pattern>æ ‡ç­¾ä¸­ä½¿ç”¨&#x2F;å’Œ&#x2F;*çš„åŒºåˆ«ï¼š</url-pattern></p><p>&#x2F;æ‰€åŒ¹é…çš„è¯·æ±‚å¯ä»¥æ˜¯&#x2F;loginæˆ–.htmlæˆ–.jsæˆ–.cssæ–¹å¼çš„è¯·æ±‚è·¯å¾„ï¼Œä½†æ˜¯&#x2F;ä¸èƒ½åŒ¹é….jspè¯·æ±‚è·¯å¾„çš„è¯·æ±‚</p><p>å› æ­¤å°±å¯ä»¥é¿å…åœ¨è®¿é—®jspé¡µé¢æ—¶ï¼Œè¯¥è¯·æ±‚è¢«DispatcherServletå¤„ç†ï¼Œä»è€Œæ‰¾ä¸åˆ°ç›¸åº”çš„é¡µé¢</p><p>&#x2F;*åˆ™èƒ½å¤ŸåŒ¹é…æ‰€æœ‰è¯·æ±‚ï¼Œä¾‹å¦‚åœ¨ä½¿ç”¨è¿‡æ»¤å™¨æ—¶ï¼Œè‹¥éœ€è¦å¯¹æ‰€æœ‰è¯·æ±‚è¿›è¡Œè¿‡æ»¤ï¼Œå°±éœ€è¦ä½¿ç”¨&#x2F;&#x2F;*çš„å†™æ³•</p></blockquote><h3 id="4ã€åˆ›å»ºè¯·æ±‚æ§åˆ¶å™¨"><a href="#4ã€åˆ›å»ºè¯·æ±‚æ§åˆ¶å™¨" class="headerlink" title="4ã€åˆ›å»ºè¯·æ±‚æ§åˆ¶å™¨"></a>4ã€åˆ›å»ºè¯·æ±‚æ§åˆ¶å™¨</h3><p>ç”±äºå‰ç«¯æ§åˆ¶å™¨å¯¹æµè§ˆå™¨å‘é€çš„è¯·æ±‚è¿›è¡Œäº†ç»Ÿä¸€çš„å¤„ç†ï¼Œä½†æ˜¯å…·ä½“çš„è¯·æ±‚æœ‰ä¸åŒçš„å¤„ç†è¿‡ç¨‹ï¼Œå› æ­¤éœ€è¦åˆ›å»ºå¤„ç†å…·ä½“è¯·æ±‚çš„ç±»ï¼Œå³è¯·æ±‚æ§åˆ¶å™¨</p><p>è¯·æ±‚æ§åˆ¶å™¨ä¸­æ¯ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„æ–¹æ³•æˆä¸ºæ§åˆ¶å™¨æ–¹æ³•</p><p>å› ä¸ºSpringMVCçš„æ§åˆ¶å™¨ç”±ä¸€ä¸ªPOJOï¼ˆæ™®é€šçš„Javaç±»ï¼‰æ‹…ä»»ï¼Œå› æ­¤éœ€è¦é€šè¿‡@Controlleræ³¨è§£å°†å…¶æ ‡è¯†ä¸ºä¸€ä¸ªæ§åˆ¶å±‚ç»„ä»¶ï¼Œäº¤ç»™Springçš„IoCå®¹å™¨ç®¡ç†ï¼Œæ­¤æ—¶SpringMVCæ‰èƒ½å¤Ÿè¯†åˆ«æ§åˆ¶å™¨çš„å­˜åœ¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5ã€åˆ›å»ºspringMVCçš„é…ç½®æ–‡ä»¶"><a href="#5ã€åˆ›å»ºspringMVCçš„é…ç½®æ–‡ä»¶" class="headerlink" title="5ã€åˆ›å»ºspringMVCçš„é…ç½®æ–‡ä»¶"></a>5ã€åˆ›å»ºspringMVCçš„é…ç½®æ–‡ä»¶</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- è‡ªåŠ¨æ‰«æåŒ… --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.hang.mvc.controller&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- é…ç½®Thymeleafè§†å›¾è§£æå™¨ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;viewResolver&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.thymeleaf.spring5.view.ThymeleafViewResolver&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;order&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;characterEncoding&quot;</span> <span class="attr">value</span>=<span class="string">&quot;UTF-8&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;templateEngine&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.thymeleaf.spring5.SpringTemplateEngine&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;templateResolver&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.thymeleaf.spring5.templateresolver.SpringResourceTemplateResolver&quot;</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- è§†å›¾å‰ç¼€ --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/templates/&quot;</span>/&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- è§†å›¾åç¼€ --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.html&quot;</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;templateMode&quot;</span> <span class="attr">value</span>=<span class="string">&quot;HTML5&quot;</span>/&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;characterEncoding&quot;</span> <span class="attr">value</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">   å¤„ç†é™æ€èµ„æºï¼Œä¾‹å¦‚htmlã€jsã€cssã€jpg</span></span><br><span class="line"><span class="comment">  è‹¥åªè®¾ç½®è¯¥æ ‡ç­¾ï¼Œåˆ™åªèƒ½è®¿é—®é™æ€èµ„æºï¼Œå…¶ä»–è¯·æ±‚åˆ™æ— æ³•è®¿é—®</span></span><br><span class="line"><span class="comment">  æ­¤æ—¶å¿…é¡»è®¾ç½®&lt;mvc:annotation-driven/&gt;è§£å†³é—®é¢˜</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- å¼€å¯mvcæ³¨è§£é©±åŠ¨ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:message-converters</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å¤„ç†å“åº”ä¸­æ–‡å†…å®¹ä¹±ç  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.http.converter.StringHttpMessageConverter&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;defaultCharset&quot;</span> <span class="attr">value</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;supportedMediaTypes&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>text/html<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>application/json<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:message-converters</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="6ã€æµ‹è¯•HelloWorld"><a href="#6ã€æµ‹è¯•HelloWorld" class="headerlink" title="6ã€æµ‹è¯•HelloWorld"></a>6ã€æµ‹è¯•HelloWorld</h3><h5 id="a-å®ç°å¯¹é¦–é¡µçš„è®¿é—®"><a href="#a-å®ç°å¯¹é¦–é¡µçš„è®¿é—®" class="headerlink" title="a&gt;å®ç°å¯¹é¦–é¡µçš„è®¿é—®"></a>a&gt;å®ç°å¯¹é¦–é¡µçš„è®¿é—®</h5><p>åœ¨è¯·æ±‚æ§åˆ¶å™¨ä¸­åˆ›å»ºå¤„ç†è¯·æ±‚çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @RequestMappingæ³¨è§£ï¼šå¤„ç†è¯·æ±‚å’Œæ§åˆ¶å™¨æ–¹æ³•ä¹‹é—´çš„æ˜ å°„å…³ç³»</span></span><br><span class="line"><span class="comment">// @RequestMappingæ³¨è§£çš„valueå±æ€§å¯ä»¥é€šè¿‡è¯·æ±‚åœ°å€åŒ¹é…è¯·æ±‚ï¼Œ/è¡¨ç¤ºçš„å½“å‰å·¥ç¨‹çš„ä¸Šä¸‹æ–‡è·¯å¾„</span></span><br><span class="line"><span class="comment">// localhost:8080/springMVC/</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">index</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//è®¾ç½®è§†å›¾åç§°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="b-é€šè¿‡è¶…é“¾æ¥è·³è½¬åˆ°æŒ‡å®šé¡µé¢"><a href="#b-é€šè¿‡è¶…é“¾æ¥è·³è½¬åˆ°æŒ‡å®šé¡µé¢" class="headerlink" title="b&gt;é€šè¿‡è¶…é“¾æ¥è·³è½¬åˆ°æŒ‡å®šé¡µé¢"></a>b&gt;é€šè¿‡è¶…é“¾æ¥è·³è½¬åˆ°æŒ‡å®šé¡µé¢</h5><p>åœ¨ä¸»é¡µindex.htmlä¸­è®¾ç½®è¶…é“¾æ¥</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>é¦–é¡µ<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>é¦–é¡µ<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/hello&#125;&quot;</span>&gt;</span>HelloWorld<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨è¯·æ±‚æ§åˆ¶å™¨ä¸­åˆ›å»ºå¤„ç†è¯·æ±‚çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">HelloWorld</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;target&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7ã€æ€»ç»“"><a href="#7ã€æ€»ç»“" class="headerlink" title="7ã€æ€»ç»“"></a>7ã€æ€»ç»“</h3><p>æµè§ˆå™¨å‘é€è¯·æ±‚ï¼Œè‹¥è¯·æ±‚åœ°å€ç¬¦åˆå‰ç«¯æ§åˆ¶å™¨çš„url-patternï¼Œè¯¥è¯·æ±‚å°±ä¼šè¢«å‰ç«¯æ§åˆ¶å™¨DispatcherServletå¤„ç†ã€‚å‰ç«¯æ§åˆ¶å™¨ä¼šè¯»å–SpringMVCçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œé€šè¿‡æ‰«æç»„ä»¶æ‰¾åˆ°æ§åˆ¶å™¨ï¼Œå°†è¯·æ±‚åœ°å€å’Œæ§åˆ¶å™¨ä¸­@RequestMappingæ³¨è§£çš„valueå±æ€§å€¼è¿›è¡ŒåŒ¹é…ï¼Œè‹¥åŒ¹é…æˆåŠŸï¼Œè¯¥æ³¨è§£æ‰€æ ‡è¯†çš„æ§åˆ¶å™¨æ–¹æ³•å°±æ˜¯å¤„ç†è¯·æ±‚çš„æ–¹æ³•ã€‚å¤„ç†è¯·æ±‚çš„æ–¹æ³•éœ€è¦è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„è§†å›¾åç§°ï¼Œè¯¥è§†å›¾åç§°ä¼šè¢«è§†å›¾è§£æå™¨è§£æï¼ŒåŠ ä¸Šå‰ç¼€å’Œåç¼€ç»„æˆè§†å›¾çš„è·¯å¾„ï¼Œé€šè¿‡Thymeleafå¯¹è§†å›¾è¿›è¡Œæ¸²æŸ“ï¼Œæœ€ç»ˆè½¬å‘åˆ°è§†å›¾æ‰€å¯¹åº”é¡µé¢</p><h1 id="ä¸‰ã€-RequestMappingæ³¨è§£"><a href="#ä¸‰ã€-RequestMappingæ³¨è§£" class="headerlink" title="ä¸‰ã€@RequestMappingæ³¨è§£"></a>ä¸‰ã€@RequestMappingæ³¨è§£</h1><h3 id="1ã€-RequestMappingæ³¨è§£çš„åŠŸèƒ½"><a href="#1ã€-RequestMappingæ³¨è§£çš„åŠŸèƒ½" class="headerlink" title="1ã€@RequestMappingæ³¨è§£çš„åŠŸèƒ½"></a>1ã€@RequestMappingæ³¨è§£çš„åŠŸèƒ½</h3><p>ä»æ³¨è§£åç§°ä¸Šæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ@RequestMappingæ³¨è§£çš„ä½œç”¨å°±æ˜¯å°†è¯·æ±‚å’Œå¤„ç†è¯·æ±‚çš„æ§åˆ¶å™¨æ–¹æ³•å…³è”èµ·æ¥ï¼Œå»ºç«‹æ˜ å°„å…³ç³»ã€‚</p><p>SpringMVC æ¥æ”¶åˆ°æŒ‡å®šçš„è¯·æ±‚ï¼Œå°±ä¼šæ¥æ‰¾åˆ°åœ¨æ˜ å°„å…³ç³»ä¸­å¯¹åº”çš„æ§åˆ¶å™¨æ–¹æ³•æ¥å¤„ç†è¿™ä¸ªè¯·æ±‚ã€‚</p><h3 id="2ã€-RequestMappingæ³¨è§£çš„ä½ç½®"><a href="#2ã€-RequestMappingæ³¨è§£çš„ä½ç½®" class="headerlink" title="2ã€@RequestMappingæ³¨è§£çš„ä½ç½®"></a>2ã€@RequestMappingæ³¨è§£çš„ä½ç½®</h3><p>@RequestMappingæ ‡è¯†ä¸€ä¸ªç±»ï¼šè®¾ç½®æ˜ å°„è¯·æ±‚çš„è¯·æ±‚è·¯å¾„çš„åˆå§‹ä¿¡æ¯</p><p>@RequestMappingæ ‡è¯†ä¸€ä¸ªæ–¹æ³•ï¼šè®¾ç½®æ˜ å°„è¯·æ±‚è¯·æ±‚è·¯å¾„çš„å…·ä½“ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestMappingController</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ­¤æ—¶è¯·æ±‚æ˜ å°„æ‰€æ˜ å°„çš„è¯·æ±‚çš„è¯·æ±‚è·¯å¾„ä¸ºï¼š/test/testRequestMapping</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/testRequestMapping&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testRequestMapping</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€-RequestMappingæ³¨è§£çš„valueå±æ€§"><a href="#3ã€-RequestMappingæ³¨è§£çš„valueå±æ€§" class="headerlink" title="3ã€@RequestMappingæ³¨è§£çš„valueå±æ€§"></a>3ã€@RequestMappingæ³¨è§£çš„valueå±æ€§</h3><p>@RequestMappingæ³¨è§£çš„valueå±æ€§é€šè¿‡è¯·æ±‚çš„è¯·æ±‚åœ°å€åŒ¹é…è¯·æ±‚æ˜ å°„</p><p>@RequestMappingæ³¨è§£çš„valueå±æ€§æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„æ•°ç»„ï¼Œè¡¨ç¤ºè¯¥è¯·æ±‚æ˜ å°„èƒ½å¤ŸåŒ¹é…å¤šä¸ªè¯·æ±‚åœ°å€æ‰€å¯¹åº”çš„è¯·æ±‚</p><p>@RequestMappingæ³¨è§£çš„valueå±æ€§å¿…é¡»è®¾ç½®ï¼Œè‡³å°‘é€šè¿‡è¯·æ±‚åœ°å€åŒ¹é…è¯·æ±‚æ˜ å°„</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/testRequestMapping&#125;&quot;</span>&gt;</span>æµ‹è¯•@RequestMappingçš„valueå±æ€§--&gt;/testRequestMapping<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/test&#125;&quot;</span>&gt;</span>æµ‹è¯•@RequestMappingçš„valueå±æ€§--&gt;/test<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(</span></span><br><span class="line"><span class="meta">        value = &#123;&quot;/testRequestMapping&quot;, &quot;/test&quot;&#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testRequestMapping</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4ã€-RequestMappingæ³¨è§£çš„methodå±æ€§"><a href="#4ã€-RequestMappingæ³¨è§£çš„methodå±æ€§" class="headerlink" title="4ã€@RequestMappingæ³¨è§£çš„methodå±æ€§"></a>4ã€@RequestMappingæ³¨è§£çš„methodå±æ€§</h3><p>@RequestMappingæ³¨è§£çš„methodå±æ€§é€šè¿‡è¯·æ±‚çš„è¯·æ±‚æ–¹å¼ï¼ˆgetæˆ–postï¼‰åŒ¹é…è¯·æ±‚æ˜ å°„</p><p>@RequestMappingæ³¨è§£çš„methodå±æ€§æ˜¯ä¸€ä¸ªRequestMethodç±»å‹çš„æ•°ç»„ï¼Œè¡¨ç¤ºè¯¥è¯·æ±‚æ˜ å°„èƒ½å¤ŸåŒ¹é…å¤šç§è¯·æ±‚æ–¹å¼çš„è¯·æ±‚</p><p>è‹¥å½“å‰è¯·æ±‚çš„è¯·æ±‚åœ°å€æ»¡è¶³è¯·æ±‚æ˜ å°„çš„valueå±æ€§ï¼Œä½†æ˜¯è¯·æ±‚æ–¹å¼ä¸æ»¡è¶³methodå±æ€§ï¼Œåˆ™æµè§ˆå™¨æŠ¥é”™405ï¼šRequest method â€˜POSTâ€™ not supported</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/test&#125;&quot;</span>&gt;</span>æµ‹è¯•@RequestMappingçš„valueå±æ€§--&gt;/test<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/test&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(</span></span><br><span class="line"><span class="meta">        value = &#123;&quot;/testRequestMapping&quot;, &quot;/test&quot;&#125;,</span></span><br><span class="line"><span class="meta">        method = &#123;RequestMethod.GET, RequestMethod.POST&#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testRequestMapping</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨ï¼š</p><p>1ã€å¯¹äºå¤„ç†æŒ‡å®šè¯·æ±‚æ–¹å¼çš„æ§åˆ¶å™¨æ–¹æ³•ï¼ŒSpringMVCä¸­æä¾›äº†@RequestMappingçš„æ´¾ç”Ÿæ³¨è§£</p><p>å¤„ç†getè¯·æ±‚çš„æ˜ å°„â€“&gt;@GetMapping</p><p>å¤„ç†postè¯·æ±‚çš„æ˜ å°„â€“&gt;@PostMapping</p><p>å¤„ç†putè¯·æ±‚çš„æ˜ å°„â€“&gt;@PutMapping</p><p>å¤„ç†deleteè¯·æ±‚çš„æ˜ å°„â€“&gt;@DeleteMapping</p><p>2ã€å¸¸ç”¨çš„è¯·æ±‚æ–¹å¼æœ‰getï¼Œpostï¼Œputï¼Œdelete</p><p>ä½†æ˜¯ç›®å‰æµè§ˆå™¨åªæ”¯æŒgetå’Œpostï¼Œè‹¥åœ¨formè¡¨å•æäº¤æ—¶ï¼Œä¸ºmethodè®¾ç½®äº†å…¶ä»–è¯·æ±‚æ–¹å¼çš„å­—ç¬¦ä¸²ï¼ˆputæˆ–deleteï¼‰ï¼Œåˆ™æŒ‰ç…§é»˜è®¤çš„è¯·æ±‚æ–¹å¼getå¤„ç†</p><p>è‹¥è¦å‘é€putå’Œdeleteè¯·æ±‚ï¼Œåˆ™éœ€è¦é€šè¿‡springæä¾›çš„è¿‡æ»¤å™¨HiddenHttpMethodFilterï¼Œåœ¨RESTfuléƒ¨åˆ†ä¼šè®²åˆ°</p></blockquote><h3 id="5ã€-RequestMappingæ³¨è§£çš„paramså±æ€§ï¼ˆäº†è§£ï¼‰"><a href="#5ã€-RequestMappingæ³¨è§£çš„paramså±æ€§ï¼ˆäº†è§£ï¼‰" class="headerlink" title="5ã€@RequestMappingæ³¨è§£çš„paramså±æ€§ï¼ˆäº†è§£ï¼‰"></a>5ã€@RequestMappingæ³¨è§£çš„paramså±æ€§ï¼ˆäº†è§£ï¼‰</h3><p>@RequestMappingæ³¨è§£çš„paramså±æ€§é€šè¿‡è¯·æ±‚çš„è¯·æ±‚å‚æ•°åŒ¹é…è¯·æ±‚æ˜ å°„</p><p>@RequestMappingæ³¨è§£çš„paramså±æ€§æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„æ•°ç»„ï¼Œå¯ä»¥é€šè¿‡å››ç§è¡¨è¾¾å¼è®¾ç½®è¯·æ±‚å‚æ•°å’Œè¯·æ±‚æ˜ å°„çš„åŒ¹é…å…³ç³»</p><p>â€œparamâ€ï¼šè¦æ±‚è¯·æ±‚æ˜ å°„æ‰€åŒ¹é…çš„è¯·æ±‚å¿…é¡»æºå¸¦paramè¯·æ±‚å‚æ•°</p><p>â€œ!paramâ€ï¼šè¦æ±‚è¯·æ±‚æ˜ å°„æ‰€åŒ¹é…çš„è¯·æ±‚å¿…é¡»ä¸èƒ½æºå¸¦paramè¯·æ±‚å‚æ•°</p><p>â€œparam&#x3D;valueâ€ï¼šè¦æ±‚è¯·æ±‚æ˜ å°„æ‰€åŒ¹é…çš„è¯·æ±‚å¿…é¡»æºå¸¦paramè¯·æ±‚å‚æ•°ä¸”param&#x3D;value</p><p>â€œparam!&#x3D;valueâ€ï¼šè¦æ±‚è¯·æ±‚æ˜ å°„æ‰€åŒ¹é…çš„è¯·æ±‚å¿…é¡»æºå¸¦paramè¯·æ±‚å‚æ•°ä½†æ˜¯param!&#x3D;value</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/test(username=&#x27;admin&#x27;,password=123456)&quot;</span>&gt;</span>æµ‹è¯•@RequestMappingçš„paramså±æ€§--&gt;/test<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(</span></span><br><span class="line"><span class="meta">        value = &#123;&quot;/testRequestMapping&quot;, &quot;/test&quot;&#125;</span></span><br><span class="line"><span class="meta">        ,method = &#123;RequestMethod.GET, RequestMethod.POST&#125;</span></span><br><span class="line"><span class="meta">        ,params = &#123;&quot;username&quot;,&quot;password!=123456&quot;&#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testRequestMapping</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨ï¼š</p><p>è‹¥å½“å‰è¯·æ±‚æ»¡è¶³@RequestMappingæ³¨è§£çš„valueå’Œmethodå±æ€§ï¼Œä½†æ˜¯ä¸æ»¡è¶³paramså±æ€§ï¼Œæ­¤æ—¶é¡µé¢å›æŠ¥é”™400ï¼šParameter conditions â€œusername, password!&#x3D;123456â€ not met for actual request parameters: username&#x3D;{admin}, password&#x3D;{123456}</p></blockquote><h3 id="6ã€-RequestMappingæ³¨è§£çš„headerså±æ€§ï¼ˆäº†è§£ï¼‰"><a href="#6ã€-RequestMappingæ³¨è§£çš„headerså±æ€§ï¼ˆäº†è§£ï¼‰" class="headerlink" title="6ã€@RequestMappingæ³¨è§£çš„headerså±æ€§ï¼ˆäº†è§£ï¼‰"></a>6ã€@RequestMappingæ³¨è§£çš„headerså±æ€§ï¼ˆäº†è§£ï¼‰</h3><p>@RequestMappingæ³¨è§£çš„headerså±æ€§é€šè¿‡è¯·æ±‚çš„è¯·æ±‚å¤´ä¿¡æ¯åŒ¹é…è¯·æ±‚æ˜ å°„</p><p>@RequestMappingæ³¨è§£çš„headerså±æ€§æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„æ•°ç»„ï¼Œå¯ä»¥é€šè¿‡å››ç§è¡¨è¾¾å¼è®¾ç½®è¯·æ±‚å¤´ä¿¡æ¯å’Œè¯·æ±‚æ˜ å°„çš„åŒ¹é…å…³ç³»</p><p>â€œheaderâ€ï¼šè¦æ±‚è¯·æ±‚æ˜ å°„æ‰€åŒ¹é…çš„è¯·æ±‚å¿…é¡»æºå¸¦headerè¯·æ±‚å¤´ä¿¡æ¯</p><p>â€œ!headerâ€ï¼šè¦æ±‚è¯·æ±‚æ˜ å°„æ‰€åŒ¹é…çš„è¯·æ±‚å¿…é¡»ä¸èƒ½æºå¸¦headerè¯·æ±‚å¤´ä¿¡æ¯</p><p>â€œheader&#x3D;valueâ€ï¼šè¦æ±‚è¯·æ±‚æ˜ å°„æ‰€åŒ¹é…çš„è¯·æ±‚å¿…é¡»æºå¸¦headerè¯·æ±‚å¤´ä¿¡æ¯ä¸”header&#x3D;value</p><p>â€œheader!&#x3D;valueâ€ï¼šè¦æ±‚è¯·æ±‚æ˜ å°„æ‰€åŒ¹é…çš„è¯·æ±‚å¿…é¡»æºå¸¦headerè¯·æ±‚å¤´ä¿¡æ¯ä¸”header!&#x3D;value</p><p>è‹¥å½“å‰è¯·æ±‚æ»¡è¶³@RequestMappingæ³¨è§£çš„valueå’Œmethodå±æ€§ï¼Œä½†æ˜¯ä¸æ»¡è¶³headerså±æ€§ï¼Œæ­¤æ—¶é¡µé¢æ˜¾ç¤º404é”™è¯¯ï¼Œå³èµ„æºæœªæ‰¾åˆ°</p><h3 id="7ã€SpringMVCæ”¯æŒanté£æ ¼çš„è·¯å¾„"><a href="#7ã€SpringMVCæ”¯æŒanté£æ ¼çš„è·¯å¾„" class="headerlink" title="7ã€SpringMVCæ”¯æŒanté£æ ¼çš„è·¯å¾„"></a>7ã€SpringMVCæ”¯æŒanté£æ ¼çš„è·¯å¾„</h3><p>ï¼Ÿï¼šè¡¨ç¤ºä»»æ„çš„å•ä¸ªå­—ç¬¦</p><p>*ï¼šè¡¨ç¤ºä»»æ„çš„0ä¸ªæˆ–å¤šä¸ªå­—ç¬¦</p><p>&#x2F;**ï¼šè¡¨ç¤ºä»»æ„çš„ä¸€å±‚æˆ–å¤šå±‚ç›®å½•</p><p>æ³¨æ„ï¼šåœ¨ä½¿ç”¨&#x2F;<strong>æ—¶ï¼Œåªèƒ½ä½¿ç”¨&#x2F;</strong>&#x2F;xxxçš„æ–¹å¼</p><h3 id="8ã€SpringMVCæ”¯æŒè·¯å¾„ä¸­çš„å ä½ç¬¦ï¼ˆé‡ç‚¹ï¼‰"><a href="#8ã€SpringMVCæ”¯æŒè·¯å¾„ä¸­çš„å ä½ç¬¦ï¼ˆé‡ç‚¹ï¼‰" class="headerlink" title="8ã€SpringMVCæ”¯æŒè·¯å¾„ä¸­çš„å ä½ç¬¦ï¼ˆé‡ç‚¹ï¼‰"></a>8ã€SpringMVCæ”¯æŒè·¯å¾„ä¸­çš„å ä½ç¬¦ï¼ˆé‡ç‚¹ï¼‰</h3><p>åŸå§‹æ–¹å¼ï¼š&#x2F;deleteUser?id&#x3D;1</p><p>restæ–¹å¼ï¼š&#x2F;deleteUser&#x2F;1</p><p>SpringMVCè·¯å¾„ä¸­çš„å ä½ç¬¦å¸¸ç”¨äºRESTfulé£æ ¼ä¸­ï¼Œå½“è¯·æ±‚è·¯å¾„ä¸­å°†æŸäº›æ•°æ®é€šè¿‡è·¯å¾„çš„æ–¹å¼ä¼ è¾“åˆ°æœåŠ¡å™¨ä¸­ï¼Œå°±å¯ä»¥åœ¨ç›¸åº”çš„@RequestMappingæ³¨è§£çš„valueå±æ€§ä¸­é€šè¿‡å ä½ç¬¦{xxx}è¡¨ç¤ºä¼ è¾“çš„æ•°æ®ï¼Œåœ¨é€šè¿‡@PathVariableæ³¨è§£ï¼Œå°†å ä½ç¬¦æ‰€è¡¨ç¤ºçš„æ•°æ®èµ‹å€¼ç»™æ§åˆ¶å™¨æ–¹æ³•çš„å½¢å‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/testRest/1/admin&#125;&quot;</span>&gt;</span>æµ‹è¯•è·¯å¾„ä¸­çš„å ä½ç¬¦--&gt;/testRest<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testRest/&#123;id&#125;/&#123;username&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testRest</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> String id, <span class="meta">@PathVariable(&quot;username&quot;)</span> String username)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;id:&quot;</span>+id+<span class="string">&quot;,username:&quot;</span>+username);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æœ€ç»ˆè¾“å‡ºçš„å†…å®¹ä¸º--&gt;id:1,username:admin</span></span><br></pre></td></tr></table></figure><h1 id="å››ã€SpringMVCè·å–è¯·æ±‚å‚æ•°"><a href="#å››ã€SpringMVCè·å–è¯·æ±‚å‚æ•°" class="headerlink" title="å››ã€SpringMVCè·å–è¯·æ±‚å‚æ•°"></a>å››ã€SpringMVCè·å–è¯·æ±‚å‚æ•°</h1><h3 id="1ã€é€šè¿‡ServletAPIè·å–"><a href="#1ã€é€šè¿‡ServletAPIè·å–" class="headerlink" title="1ã€é€šè¿‡ServletAPIè·å–"></a>1ã€é€šè¿‡ServletAPIè·å–</h3><p>å°†HttpServletRequestä½œä¸ºæ§åˆ¶å™¨æ–¹æ³•çš„å½¢å‚ï¼Œæ­¤æ—¶HttpServletRequestç±»å‹çš„å‚æ•°è¡¨ç¤ºå°è£…äº†å½“å‰è¯·æ±‚çš„è¯·æ±‚æŠ¥æ–‡çš„å¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testParam&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testParam</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;username:&quot;</span>+username+<span class="string">&quot;,password:&quot;</span>+password);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€é€šè¿‡æ§åˆ¶å™¨æ–¹æ³•çš„å½¢å‚è·å–è¯·æ±‚å‚æ•°"><a href="#2ã€é€šè¿‡æ§åˆ¶å™¨æ–¹æ³•çš„å½¢å‚è·å–è¯·æ±‚å‚æ•°" class="headerlink" title="2ã€é€šè¿‡æ§åˆ¶å™¨æ–¹æ³•çš„å½¢å‚è·å–è¯·æ±‚å‚æ•°"></a>2ã€é€šè¿‡æ§åˆ¶å™¨æ–¹æ³•çš„å½¢å‚è·å–è¯·æ±‚å‚æ•°</h3><p>åœ¨æ§åˆ¶å™¨æ–¹æ³•çš„å½¢å‚ä½ç½®ï¼Œè®¾ç½®å’Œè¯·æ±‚å‚æ•°åŒåçš„å½¢å‚ï¼Œå½“æµè§ˆå™¨å‘é€è¯·æ±‚ï¼ŒåŒ¹é…åˆ°è¯·æ±‚æ˜ å°„æ—¶ï¼Œåœ¨DispatcherServletä¸­å°±ä¼šå°†è¯·æ±‚å‚æ•°èµ‹å€¼ç»™ç›¸åº”çš„å½¢å‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/testParam(username=&#x27;admin&#x27;,password=123456)&#125;&quot;</span>&gt;</span>æµ‹è¯•è·å–è¯·æ±‚å‚æ•°--&gt;/testParam<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testParam&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testParam</span><span class="params">(String username, String password)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;username:&quot;</span>+username+<span class="string">&quot;,password:&quot;</span>+password);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨ï¼š</p><p>è‹¥è¯·æ±‚æ‰€ä¼ è¾“çš„è¯·æ±‚å‚æ•°ä¸­æœ‰å¤šä¸ªåŒåçš„è¯·æ±‚å‚æ•°ï¼Œæ­¤æ—¶å¯ä»¥åœ¨æ§åˆ¶å™¨æ–¹æ³•çš„å½¢å‚ä¸­è®¾ç½®å­—ç¬¦ä¸²æ•°ç»„æˆ–è€…å­—ç¬¦ä¸²ç±»å‹çš„å½¢å‚æ¥æ”¶æ­¤è¯·æ±‚å‚æ•°</p><p>è‹¥ä½¿ç”¨å­—ç¬¦ä¸²æ•°ç»„ç±»å‹çš„å½¢å‚ï¼Œæ­¤å‚æ•°çš„æ•°ç»„ä¸­åŒ…å«äº†æ¯ä¸€ä¸ªæ•°æ®</p><p>è‹¥ä½¿ç”¨å­—ç¬¦ä¸²ç±»å‹çš„å½¢å‚ï¼Œæ­¤å‚æ•°çš„å€¼ä¸ºæ¯ä¸ªæ•°æ®ä¸­é—´ä½¿ç”¨é€—å·æ‹¼æ¥çš„ç»“æœ</p></blockquote><h3 id="3ã€-RequestParam"><a href="#3ã€-RequestParam" class="headerlink" title="3ã€@RequestParam"></a>3ã€@RequestParam</h3><p>@RequestParamæ˜¯å°†è¯·æ±‚å‚æ•°å’Œæ§åˆ¶å™¨æ–¹æ³•çš„å½¢å‚åˆ›å»ºæ˜ å°„å…³ç³»</p><p>@RequestParamæ³¨è§£ä¸€å…±æœ‰ä¸‰ä¸ªå±æ€§ï¼š</p><p>valueï¼šæŒ‡å®šä¸ºå½¢å‚èµ‹å€¼çš„è¯·æ±‚å‚æ•°çš„å‚æ•°å</p><p>requiredï¼šè®¾ç½®æ˜¯å¦å¿…é¡»ä¼ è¾“æ­¤è¯·æ±‚å‚æ•°ï¼Œé»˜è®¤å€¼ä¸ºtrue</p><p>è‹¥è®¾ç½®ä¸ºtrueæ—¶ï¼Œåˆ™å½“å‰è¯·æ±‚å¿…é¡»ä¼ è¾“valueæ‰€æŒ‡å®šçš„è¯·æ±‚å‚æ•°ï¼Œè‹¥æ²¡æœ‰ä¼ è¾“è¯¥è¯·æ±‚å‚æ•°ï¼Œä¸”æ²¡æœ‰è®¾ç½®defaultValueå±æ€§ï¼Œåˆ™é¡µé¢æŠ¥é”™400ï¼šRequired String parameter â€˜xxxâ€™ is not presentï¼›è‹¥è®¾ç½®ä¸ºfalseï¼Œåˆ™å½“å‰è¯·æ±‚ä¸æ˜¯å¿…é¡»ä¼ è¾“valueæ‰€æŒ‡å®šçš„è¯·æ±‚å‚æ•°ï¼Œè‹¥æ²¡æœ‰ä¼ è¾“ï¼Œåˆ™æ³¨è§£æ‰€æ ‡è¯†çš„å½¢å‚çš„å€¼ä¸ºnull</p><p>defaultValueï¼šä¸ç®¡requiredå±æ€§å€¼ä¸ºtrueæˆ–falseï¼Œå½“valueæ‰€æŒ‡å®šçš„è¯·æ±‚å‚æ•°æ²¡æœ‰ä¼ è¾“æˆ–ä¼ è¾“çš„å€¼ä¸ºâ€â€æ—¶ï¼Œåˆ™ä½¿ç”¨é»˜è®¤å€¼ä¸ºå½¢å‚èµ‹å€¼</p><h3 id="4ã€-RequestHeader"><a href="#4ã€-RequestHeader" class="headerlink" title="4ã€@RequestHeader"></a>4ã€@RequestHeader</h3><p>@RequestHeaderæ˜¯å°†è¯·æ±‚å¤´ä¿¡æ¯å’Œæ§åˆ¶å™¨æ–¹æ³•çš„å½¢å‚åˆ›å»ºæ˜ å°„å…³ç³»</p><p>@RequestHeaderæ³¨è§£ä¸€å…±æœ‰ä¸‰ä¸ªå±æ€§ï¼švalueã€requiredã€defaultValueï¼Œç”¨æ³•åŒ@RequestParam</p><h3 id="5ã€-CookieValue"><a href="#5ã€-CookieValue" class="headerlink" title="5ã€@CookieValue"></a>5ã€@CookieValue</h3><p>@CookieValueæ˜¯å°†cookieæ•°æ®å’Œæ§åˆ¶å™¨æ–¹æ³•çš„å½¢å‚åˆ›å»ºæ˜ å°„å…³ç³»</p><p>@CookieValueæ³¨è§£ä¸€å…±æœ‰ä¸‰ä¸ªå±æ€§ï¼švalueã€requiredã€defaultValueï¼Œç”¨æ³•åŒ@RequestParam</p><h3 id="6ã€é€šè¿‡POJOè·å–è¯·æ±‚å‚æ•°"><a href="#6ã€é€šè¿‡POJOè·å–è¯·æ±‚å‚æ•°" class="headerlink" title="6ã€é€šè¿‡POJOè·å–è¯·æ±‚å‚æ•°"></a>6ã€é€šè¿‡POJOè·å–è¯·æ±‚å‚æ•°</h3><p>å¯ä»¥åœ¨æ§åˆ¶å™¨æ–¹æ³•çš„å½¢å‚ä½ç½®è®¾ç½®ä¸€ä¸ªå®ä½“ç±»ç±»å‹çš„å½¢å‚ï¼Œæ­¤æ—¶è‹¥æµè§ˆå™¨ä¼ è¾“çš„è¯·æ±‚å‚æ•°çš„å‚æ•°åå’Œå®ä½“ç±»ä¸­çš„å±æ€§åä¸€è‡´ï¼Œé‚£ä¹ˆè¯·æ±‚å‚æ•°å°±ä¼šä¸ºæ­¤å±æ€§èµ‹å€¼</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/testpojo&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    ç”¨æˆ·åï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    å¯†ç ï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    æ€§åˆ«ï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ç”·&quot;</span>&gt;</span>ç”·<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å¥³&quot;</span>&gt;</span>å¥³<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    å¹´é¾„ï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    é‚®ç®±ï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testpojo&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testPOJO</span><span class="params">(User user)</span>&#123;</span><br><span class="line">    System.out.println(user);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æœ€ç»ˆç»“æœ--&gt;User&#123;id=null, username=&#x27;å¼ ä¸‰&#x27;, password=&#x27;123&#x27;, age=23, sex=&#x27;ç”·&#x27;, email=&#x27;123@qq.com&#x27;&#125;</span></span><br></pre></td></tr></table></figure><h3 id="7ã€è§£å†³è·å–è¯·æ±‚å‚æ•°çš„ä¹±ç é—®é¢˜"><a href="#7ã€è§£å†³è·å–è¯·æ±‚å‚æ•°çš„ä¹±ç é—®é¢˜" class="headerlink" title="7ã€è§£å†³è·å–è¯·æ±‚å‚æ•°çš„ä¹±ç é—®é¢˜"></a>7ã€è§£å†³è·å–è¯·æ±‚å‚æ•°çš„ä¹±ç é—®é¢˜</h3><p>è§£å†³è·å–è¯·æ±‚å‚æ•°çš„ä¹±ç é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨SpringMVCæä¾›çš„ç¼–ç è¿‡æ»¤å™¨CharacterEncodingFilterï¼Œä½†æ˜¯å¿…é¡»åœ¨web.xmlä¸­è¿›è¡Œæ³¨å†Œ</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®springMVCçš„ç¼–ç è¿‡æ»¤å™¨--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceResponseEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨ï¼š</p><p>SpringMVCä¸­å¤„ç†ç¼–ç çš„è¿‡æ»¤å™¨ä¸€å®šè¦é…ç½®åˆ°å…¶ä»–è¿‡æ»¤å™¨ä¹‹å‰ï¼Œå¦åˆ™æ— æ•ˆ</p></blockquote><h1 id="äº”ã€åŸŸå¯¹è±¡å…±äº«æ•°æ®"><a href="#äº”ã€åŸŸå¯¹è±¡å…±äº«æ•°æ®" class="headerlink" title="äº”ã€åŸŸå¯¹è±¡å…±äº«æ•°æ®"></a>äº”ã€åŸŸå¯¹è±¡å…±äº«æ•°æ®</h1><h3 id="1ã€ä½¿ç”¨ServletAPIå‘requeståŸŸå¯¹è±¡å…±äº«æ•°æ®"><a href="#1ã€ä½¿ç”¨ServletAPIå‘requeståŸŸå¯¹è±¡å…±äº«æ•°æ®" class="headerlink" title="1ã€ä½¿ç”¨ServletAPIå‘requeståŸŸå¯¹è±¡å…±äº«æ•°æ®"></a>1ã€ä½¿ç”¨ServletAPIå‘requeståŸŸå¯¹è±¡å…±äº«æ•°æ®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testServletAPI&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testServletAPI</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">    request.setAttribute(<span class="string">&quot;testScope&quot;</span>, <span class="string">&quot;hello,servletAPI&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€ä½¿ç”¨ModelAndViewå‘requeståŸŸå¯¹è±¡å…±äº«æ•°æ®"><a href="#2ã€ä½¿ç”¨ModelAndViewå‘requeståŸŸå¯¹è±¡å…±äº«æ•°æ®" class="headerlink" title="2ã€ä½¿ç”¨ModelAndViewå‘requeståŸŸå¯¹è±¡å…±äº«æ•°æ®"></a>2ã€ä½¿ç”¨ModelAndViewå‘requeståŸŸå¯¹è±¡å…±äº«æ•°æ®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testModelAndView&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">testModelAndView</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ModelAndViewæœ‰Modelå’ŒViewçš„åŠŸèƒ½</span></span><br><span class="line"><span class="comment">     * Modelä¸»è¦ç”¨äºå‘è¯·æ±‚åŸŸå…±äº«æ•°æ®</span></span><br><span class="line"><span class="comment">     * Viewä¸»è¦ç”¨äºè®¾ç½®è§†å›¾ï¼Œå®ç°é¡µé¢è·³è½¬</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">ModelAndView</span> <span class="variable">mav</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>();</span><br><span class="line">    <span class="comment">//å‘è¯·æ±‚åŸŸå…±äº«æ•°æ®</span></span><br><span class="line">    mav.addObject(<span class="string">&quot;testScope&quot;</span>, <span class="string">&quot;hello,ModelAndView&quot;</span>);</span><br><span class="line">    <span class="comment">//è®¾ç½®è§†å›¾ï¼Œå®ç°é¡µé¢è·³è½¬</span></span><br><span class="line">    mav.setViewName(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> mav;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€ä½¿ç”¨Modelå‘requeståŸŸå¯¹è±¡å…±äº«æ•°æ®"><a href="#3ã€ä½¿ç”¨Modelå‘requeståŸŸå¯¹è±¡å…±äº«æ•°æ®" class="headerlink" title="3ã€ä½¿ç”¨Modelå‘requeståŸŸå¯¹è±¡å…±äº«æ•°æ®"></a>3ã€ä½¿ç”¨Modelå‘requeståŸŸå¯¹è±¡å…±äº«æ•°æ®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testModel&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testModel</span><span class="params">(Model model)</span>&#123;</span><br><span class="line">    model.addAttribute(<span class="string">&quot;testScope&quot;</span>, <span class="string">&quot;hello,Model&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4ã€ä½¿ç”¨mapå‘requeståŸŸå¯¹è±¡å…±äº«æ•°æ®"><a href="#4ã€ä½¿ç”¨mapå‘requeståŸŸå¯¹è±¡å…±äº«æ•°æ®" class="headerlink" title="4ã€ä½¿ç”¨mapå‘requeståŸŸå¯¹è±¡å…±äº«æ•°æ®"></a>4ã€ä½¿ç”¨mapå‘requeståŸŸå¯¹è±¡å…±äº«æ•°æ®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testMap&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testMap</span><span class="params">(Map&lt;String, Object&gt; map)</span>&#123;</span><br><span class="line">    map.put(<span class="string">&quot;testScope&quot;</span>, <span class="string">&quot;hello,Map&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5ã€ä½¿ç”¨ModelMapå‘requeståŸŸå¯¹è±¡å…±äº«æ•°æ®"><a href="#5ã€ä½¿ç”¨ModelMapå‘requeståŸŸå¯¹è±¡å…±äº«æ•°æ®" class="headerlink" title="5ã€ä½¿ç”¨ModelMapå‘requeståŸŸå¯¹è±¡å…±äº«æ•°æ®"></a>5ã€ä½¿ç”¨ModelMapå‘requeståŸŸå¯¹è±¡å…±äº«æ•°æ®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testModelMap&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testModelMap</span><span class="params">(ModelMap modelMap)</span>&#123;</span><br><span class="line">    modelMap.addAttribute(<span class="string">&quot;testScope&quot;</span>, <span class="string">&quot;hello,ModelMap&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6ã€Modelã€ModelMapã€Mapçš„å…³ç³»"><a href="#6ã€Modelã€ModelMapã€Mapçš„å…³ç³»" class="headerlink" title="6ã€Modelã€ModelMapã€Mapçš„å…³ç³»"></a>6ã€Modelã€ModelMapã€Mapçš„å…³ç³»</h3><p>Modelã€ModelMapã€Mapç±»å‹çš„å‚æ•°å…¶å®æœ¬è´¨ä¸Šéƒ½æ˜¯ BindingAwareModelMap ç±»å‹çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public interface Model&#123;&#125;</span><br><span class="line">public class ModelMap extends LinkedHashMap&lt;String, Object&gt; &#123;&#125;</span><br><span class="line">public class ExtendedModelMap extends ModelMap implements Model &#123;&#125;</span><br><span class="line">public class BindingAwareModelMap extends ExtendedModelMap &#123;&#125;</span><br></pre></td></tr></table></figure><h3 id="7ã€å‘sessionåŸŸå…±äº«æ•°æ®"><a href="#7ã€å‘sessionåŸŸå…±äº«æ•°æ®" class="headerlink" title="7ã€å‘sessionåŸŸå…±äº«æ•°æ®"></a>7ã€å‘sessionåŸŸå…±äº«æ•°æ®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testSession&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testSession</span><span class="params">(HttpSession session)</span>&#123;</span><br><span class="line">    session.setAttribute(<span class="string">&quot;testSessionScope&quot;</span>, <span class="string">&quot;hello,session&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8ã€å‘applicationåŸŸå…±äº«æ•°æ®"><a href="#8ã€å‘applicationåŸŸå…±äº«æ•°æ®" class="headerlink" title="8ã€å‘applicationåŸŸå…±äº«æ•°æ®"></a>8ã€å‘applicationåŸŸå…±äº«æ•°æ®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testApplication&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testApplication</span><span class="params">(HttpSession session)</span>&#123;</span><br><span class="line"><span class="type">ServletContext</span> <span class="variable">application</span> <span class="operator">=</span> session.getServletContext();</span><br><span class="line">    application.setAttribute(<span class="string">&quot;testApplicationScope&quot;</span>, <span class="string">&quot;hello,application&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å…­ã€SpringMVCçš„è§†å›¾"><a href="#å…­ã€SpringMVCçš„è§†å›¾" class="headerlink" title="å…­ã€SpringMVCçš„è§†å›¾"></a>å…­ã€SpringMVCçš„è§†å›¾</h1><p>SpringMVCä¸­çš„è§†å›¾æ˜¯Viewæ¥å£ï¼Œè§†å›¾çš„ä½œç”¨æ¸²æŸ“æ•°æ®ï¼Œå°†æ¨¡å‹Modelä¸­çš„æ•°æ®å±•ç¤ºç»™ç”¨æˆ·</p><p>SpringMVCè§†å›¾çš„ç§ç±»å¾ˆå¤šï¼Œé»˜è®¤æœ‰è½¬å‘è§†å›¾å’Œé‡å®šå‘è§†å›¾</p><p>å½“å·¥ç¨‹å¼•å…¥jstlçš„ä¾èµ–ï¼Œè½¬å‘è§†å›¾ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºJstlView</p><p>è‹¥ä½¿ç”¨çš„è§†å›¾æŠ€æœ¯ä¸ºThymeleafï¼Œåœ¨SpringMVCçš„é…ç½®æ–‡ä»¶ä¸­é…ç½®äº†Thymeleafçš„è§†å›¾è§£æå™¨ï¼Œç”±æ­¤è§†å›¾è§£æå™¨è§£æä¹‹åæ‰€å¾—åˆ°çš„æ˜¯ThymeleafView</p><h3 id="1ã€ThymeleafView"><a href="#1ã€ThymeleafView" class="headerlink" title="1ã€ThymeleafView"></a>1ã€ThymeleafView</h3><p>å½“æ§åˆ¶å™¨æ–¹æ³•ä¸­æ‰€è®¾ç½®çš„è§†å›¾åç§°æ²¡æœ‰ä»»ä½•å‰ç¼€æ—¶ï¼Œæ­¤æ—¶çš„è§†å›¾åç§°ä¼šè¢«SpringMVCé…ç½®æ–‡ä»¶ä¸­æ‰€é…ç½®çš„è§†å›¾è§£æå™¨è§£æï¼Œè§†å›¾åç§°æ‹¼æ¥è§†å›¾å‰ç¼€å’Œè§†å›¾åç¼€æ‰€å¾—åˆ°çš„æœ€ç»ˆè·¯å¾„ï¼Œä¼šé€šè¿‡è½¬å‘çš„æ–¹å¼å®ç°è·³è½¬</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testHello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testHello</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€è½¬å‘è§†å›¾"><a href="#2ã€è½¬å‘è§†å›¾" class="headerlink" title="2ã€è½¬å‘è§†å›¾"></a>2ã€è½¬å‘è§†å›¾</h3><p>SpringMVCä¸­é»˜è®¤çš„è½¬å‘è§†å›¾æ˜¯InternalResourceView</p><p>SpringMVCä¸­åˆ›å»ºè½¬å‘è§†å›¾çš„æƒ…å†µï¼š</p><p>å½“æ§åˆ¶å™¨æ–¹æ³•ä¸­æ‰€è®¾ç½®çš„è§†å›¾åç§°ä»¥â€forward:â€ä¸ºå‰ç¼€æ—¶ï¼Œåˆ›å»ºInternalResourceViewè§†å›¾ï¼Œæ­¤æ—¶çš„è§†å›¾åç§°ä¸ä¼šè¢«SpringMVCé…ç½®æ–‡ä»¶ä¸­æ‰€é…ç½®çš„è§†å›¾è§£æå™¨è§£æï¼Œè€Œæ˜¯ä¼šå°†å‰ç¼€â€forward:â€å»æ‰ï¼Œå‰©ä½™éƒ¨åˆ†ä½œä¸ºæœ€ç»ˆè·¯å¾„é€šè¿‡è½¬å‘çš„æ–¹å¼å®ç°è·³è½¬</p><p>ä¾‹å¦‚â€forward:&#x2F;â€œï¼Œâ€forward:&#x2F;employeeâ€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testForward&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testForward</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;forward:/testHello&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€é‡å®šå‘è§†å›¾"><a href="#3ã€é‡å®šå‘è§†å›¾" class="headerlink" title="3ã€é‡å®šå‘è§†å›¾"></a>3ã€é‡å®šå‘è§†å›¾</h3><p>SpringMVCä¸­é»˜è®¤çš„é‡å®šå‘è§†å›¾æ˜¯RedirectView</p><p>å½“æ§åˆ¶å™¨æ–¹æ³•ä¸­æ‰€è®¾ç½®çš„è§†å›¾åç§°ä»¥â€redirect:â€ä¸ºå‰ç¼€æ—¶ï¼Œåˆ›å»ºRedirectViewè§†å›¾ï¼Œæ­¤æ—¶çš„è§†å›¾åç§°ä¸ä¼šè¢«SpringMVCé…ç½®æ–‡ä»¶ä¸­æ‰€é…ç½®çš„è§†å›¾è§£æå™¨è§£æï¼Œè€Œæ˜¯ä¼šå°†å‰ç¼€â€redirect:â€å»æ‰ï¼Œå‰©ä½™éƒ¨åˆ†ä½œä¸ºæœ€ç»ˆè·¯å¾„é€šè¿‡é‡å®šå‘çš„æ–¹å¼å®ç°è·³è½¬</p><p>ä¾‹å¦‚â€redirect:&#x2F;â€œï¼Œâ€redirect:&#x2F;employeeâ€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testRedirect&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testRedirect</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:/testHello&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨ï¼š</p><p>é‡å®šå‘è§†å›¾åœ¨è§£ææ—¶ï¼Œä¼šå…ˆå°†redirect:å‰ç¼€å»æ‰ï¼Œç„¶åä¼šåˆ¤æ–­å‰©ä½™éƒ¨åˆ†æ˜¯å¦ä»¥&#x2F;å¼€å¤´ï¼Œè‹¥æ˜¯åˆ™ä¼šè‡ªåŠ¨æ‹¼æ¥ä¸Šä¸‹æ–‡è·¯å¾„</p></blockquote><h3 id="4ã€è§†å›¾æ§åˆ¶å™¨view-controller"><a href="#4ã€è§†å›¾æ§åˆ¶å™¨view-controller" class="headerlink" title="4ã€è§†å›¾æ§åˆ¶å™¨view-controller"></a>4ã€è§†å›¾æ§åˆ¶å™¨view-controller</h3><p>å½“æ§åˆ¶å™¨æ–¹æ³•ä¸­ï¼Œä»…ä»…ç”¨æ¥å®ç°é¡µé¢è·³è½¬ï¼Œå³åªéœ€è¦è®¾ç½®è§†å›¾åç§°æ—¶ï¼Œå¯ä»¥å°†å¤„ç†å™¨æ–¹æ³•ä½¿ç”¨view-controlleræ ‡ç­¾è¿›è¡Œè¡¨ç¤º</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">pathï¼šè®¾ç½®å¤„ç†çš„è¯·æ±‚åœ°å€</span></span><br><span class="line"><span class="comment">view-nameï¼šè®¾ç½®è¯·æ±‚åœ°å€æ‰€å¯¹åº”çš„è§†å›¾åç§°</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:view-controller</span> <span class="attr">path</span>=<span class="string">&quot;/testView&quot;</span> <span class="attr">view-name</span>=<span class="string">&quot;success&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:view-controller</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨ï¼š</p><p>å½“SpringMVCä¸­è®¾ç½®ä»»ä½•ä¸€ä¸ªview-controlleræ—¶ï¼Œå…¶ä»–æ§åˆ¶å™¨ä¸­çš„è¯·æ±‚æ˜ å°„å°†å…¨éƒ¨å¤±æ•ˆï¼Œæ­¤æ—¶éœ€è¦åœ¨SpringMVCçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­è®¾ç½®å¼€å¯mvcæ³¨è§£é©±åŠ¨çš„æ ‡ç­¾ï¼š</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span> /&gt;</span></span><br></pre></td></tr></table></figure><h1 id="ä¸ƒã€RESTful"><a href="#ä¸ƒã€RESTful" class="headerlink" title="ä¸ƒã€RESTful"></a>ä¸ƒã€RESTful</h1><h3 id="1ã€RESTfulç®€ä»‹"><a href="#1ã€RESTfulç®€ä»‹" class="headerlink" title="1ã€RESTfulç®€ä»‹"></a>1ã€RESTfulç®€ä»‹</h3><p>RESTï¼š<strong>Re</strong>presentational <strong>S</strong>tate <strong>T</strong>ransferï¼Œè¡¨ç°å±‚èµ„æºçŠ¶æ€è½¬ç§»ã€‚</p><h5 id="a-èµ„æº"><a href="#a-èµ„æº" class="headerlink" title="a&gt;èµ„æº"></a>a&gt;èµ„æº</h5><p>èµ„æºæ˜¯ä¸€ç§çœ‹å¾…æœåŠ¡å™¨çš„æ–¹å¼ï¼Œå³ï¼Œå°†æœåŠ¡å™¨çœ‹ä½œæ˜¯ç”±å¾ˆå¤šç¦»æ•£çš„èµ„æºç»„æˆã€‚æ¯ä¸ªèµ„æºæ˜¯æœåŠ¡å™¨ä¸Šä¸€ä¸ªå¯å‘½åçš„æŠ½è±¡æ¦‚å¿µã€‚å› ä¸ºèµ„æºæ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µï¼Œæ‰€ä»¥å®ƒä¸ä»…ä»…èƒ½ä»£è¡¨æœåŠ¡å™¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¸€ä¸ªæ–‡ä»¶ã€æ•°æ®åº“ä¸­çš„ä¸€å¼ è¡¨ç­‰ç­‰å…·ä½“çš„ä¸œè¥¿ï¼Œå¯ä»¥å°†èµ„æºè®¾è®¡çš„è¦å¤šæŠ½è±¡æœ‰å¤šæŠ½è±¡ï¼Œåªè¦æƒ³è±¡åŠ›å…è®¸è€Œä¸”å®¢æˆ·ç«¯åº”ç”¨å¼€å‘è€…èƒ½å¤Ÿç†è§£ã€‚ä¸é¢å‘å¯¹è±¡è®¾è®¡ç±»ä¼¼ï¼Œèµ„æºæ˜¯ä»¥åè¯ä¸ºæ ¸å¿ƒæ¥ç»„ç»‡çš„ï¼Œé¦–å…ˆå…³æ³¨çš„æ˜¯åè¯ã€‚ä¸€ä¸ªèµ„æºå¯ä»¥ç”±ä¸€ä¸ªæˆ–å¤šä¸ªURIæ¥æ ‡è¯†ã€‚URIæ—¢æ˜¯èµ„æºçš„åç§°ï¼Œä¹Ÿæ˜¯èµ„æºåœ¨Webä¸Šçš„åœ°å€ã€‚å¯¹æŸä¸ªèµ„æºæ„Ÿå…´è¶£çš„å®¢æˆ·ç«¯åº”ç”¨ï¼Œå¯ä»¥é€šè¿‡èµ„æºçš„URIä¸å…¶è¿›è¡Œäº¤äº’ã€‚</p><h5 id="b-èµ„æºçš„è¡¨è¿°"><a href="#b-èµ„æºçš„è¡¨è¿°" class="headerlink" title="b&gt;èµ„æºçš„è¡¨è¿°"></a>b&gt;èµ„æºçš„è¡¨è¿°</h5><p>èµ„æºçš„è¡¨è¿°æ˜¯ä¸€æ®µå¯¹äºèµ„æºåœ¨æŸä¸ªç‰¹å®šæ—¶åˆ»çš„çŠ¶æ€çš„æè¿°ã€‚å¯ä»¥åœ¨å®¢æˆ·ç«¯-æœåŠ¡å™¨ç«¯ä¹‹é—´è½¬ç§»ï¼ˆäº¤æ¢ï¼‰ã€‚èµ„æºçš„è¡¨è¿°å¯ä»¥æœ‰å¤šç§æ ¼å¼ï¼Œä¾‹å¦‚HTML&#x2F;XML&#x2F;JSON&#x2F;çº¯æ–‡æœ¬&#x2F;å›¾ç‰‡&#x2F;è§†é¢‘&#x2F;éŸ³é¢‘ç­‰ç­‰ã€‚èµ„æºçš„è¡¨è¿°æ ¼å¼å¯ä»¥é€šè¿‡åå•†æœºåˆ¶æ¥ç¡®å®šã€‚è¯·æ±‚-å“åº”æ–¹å‘çš„è¡¨è¿°é€šå¸¸ä½¿ç”¨ä¸åŒçš„æ ¼å¼ã€‚</p><h5 id="c-çŠ¶æ€è½¬ç§»"><a href="#c-çŠ¶æ€è½¬ç§»" class="headerlink" title="c&gt;çŠ¶æ€è½¬ç§»"></a>c&gt;çŠ¶æ€è½¬ç§»</h5><p>çŠ¶æ€è½¬ç§»è¯´çš„æ˜¯ï¼šåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ä¹‹é—´è½¬ç§»ï¼ˆtransferï¼‰ä»£è¡¨èµ„æºçŠ¶æ€çš„è¡¨è¿°ã€‚é€šè¿‡è½¬ç§»å’Œæ“ä½œèµ„æºçš„è¡¨è¿°ï¼Œæ¥é—´æ¥å®ç°æ“ä½œèµ„æºçš„ç›®çš„ã€‚</p><h3 id="2ã€RESTfulçš„å®ç°"><a href="#2ã€RESTfulçš„å®ç°" class="headerlink" title="2ã€RESTfulçš„å®ç°"></a>2ã€RESTfulçš„å®ç°</h3><p>å…·ä½“è¯´ï¼Œå°±æ˜¯ HTTP åè®®é‡Œé¢ï¼Œå››ä¸ªè¡¨ç¤ºæ“ä½œæ–¹å¼çš„åŠ¨è¯ï¼šGETã€POSTã€PUTã€DELETEã€‚</p><p>å®ƒä»¬åˆ†åˆ«å¯¹åº”å››ç§åŸºæœ¬æ“ä½œï¼šGET ç”¨æ¥è·å–èµ„æºï¼ŒPOST ç”¨æ¥æ–°å»ºèµ„æºï¼ŒPUT ç”¨æ¥æ›´æ–°èµ„æºï¼ŒDELETE ç”¨æ¥åˆ é™¤èµ„æºã€‚</p><p>REST é£æ ¼æå€¡ URL åœ°å€ä½¿ç”¨ç»Ÿä¸€çš„é£æ ¼è®¾è®¡ï¼Œä»å‰åˆ°åå„ä¸ªå•è¯ä½¿ç”¨æ–œæ åˆ†å¼€ï¼Œä¸ä½¿ç”¨é—®å·é”®å€¼å¯¹æ–¹å¼æºå¸¦è¯·æ±‚å‚æ•°ï¼Œè€Œæ˜¯å°†è¦å‘é€ç»™æœåŠ¡å™¨çš„æ•°æ®ä½œä¸º URL åœ°å€çš„ä¸€éƒ¨åˆ†ï¼Œä»¥ä¿è¯æ•´ä½“é£æ ¼çš„ä¸€è‡´æ€§ã€‚</p><table><thead><tr><th>æ“ä½œ</th><th>ä¼ ç»Ÿæ–¹å¼</th><th>RESTé£æ ¼</th></tr></thead><tbody><tr><td>æŸ¥è¯¢æ“ä½œ</td><td>getUserById?id&#x3D;1</td><td>user&#x2F;1â€“&gt;getè¯·æ±‚æ–¹å¼</td></tr><tr><td>ä¿å­˜æ“ä½œ</td><td>saveUser</td><td>userâ€“&gt;postè¯·æ±‚æ–¹å¼</td></tr><tr><td>åˆ é™¤æ“ä½œ</td><td>deleteUser?id&#x3D;1</td><td>user&#x2F;1â€“&gt;deleteè¯·æ±‚æ–¹å¼</td></tr><tr><td>æ›´æ–°æ“ä½œ</td><td>updateUser</td><td>userâ€“&gt;putè¯·æ±‚æ–¹å¼</td></tr></tbody></table><h3 id="3ã€HiddenHttpMethodFilter"><a href="#3ã€HiddenHttpMethodFilter" class="headerlink" title="3ã€HiddenHttpMethodFilter"></a>3ã€HiddenHttpMethodFilter</h3><p>ç”±äºæµè§ˆå™¨åªæ”¯æŒå‘é€getå’Œpostæ–¹å¼çš„è¯·æ±‚ï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•å‘é€putå’Œdeleteè¯·æ±‚å‘¢ï¼Ÿ</p><p>SpringMVC æä¾›äº† <strong>HiddenHttpMethodFilter</strong> å¸®åŠ©æˆ‘ä»¬<strong>å°† POST è¯·æ±‚è½¬æ¢ä¸º DELETE æˆ– PUT è¯·æ±‚</strong></p><p><strong>HiddenHttpMethodFilter</strong> å¤„ç†putå’Œdeleteè¯·æ±‚çš„æ¡ä»¶ï¼š</p><p>a&gt;å½“å‰è¯·æ±‚çš„è¯·æ±‚æ–¹å¼å¿…é¡»ä¸º <strong>post</strong></p><p>b&gt;å½“å‰è¯·æ±‚å¿…é¡»ä¼ è¾“è¯·æ±‚å‚æ•° <strong>_method</strong></p><p>æ»¡è¶³ä»¥ä¸Šæ¡ä»¶ï¼Œ<strong>HiddenHttpMethodFilter</strong> è¿‡æ»¤å™¨å°±ä¼šå°†å½“å‰è¯·æ±‚çš„è¯·æ±‚æ–¹å¼è½¬æ¢ä¸ºè¯·æ±‚å‚æ•°_methodçš„å€¼ï¼Œå› æ­¤è¯·æ±‚å‚æ•°&#x2F;_methodçš„å€¼æ‰æ˜¯æœ€ç»ˆçš„è¯·æ±‚æ–¹å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;form th:action=<span class="string">&quot;@&#123;/update&#125;&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;_method&quot;</span> value=<span class="string">&quot;PUT&quot;</span>&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;ä¿®æ”¹&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure><blockquote><p>åŸç†å°±æ˜¯: åœ¨æ¥æ”¶åˆ°è¯·æ±‚ä¸ºpostæ—¶,åœ¨HiddenHttpMethodFilterè¿‡æ»¤å™¨ä¸­,åœ¨form è¡¨å•æäº¤ä¸­ é€šè¿‡è¯·æ±‚åˆ¤æ–­form è¡¨å•ä¸­éšè—åŸŸæ˜¯name&#x3D;â€_methodâ€  value&#x3D;â€DELETEâ€é‡æ–°èµ‹å€¼ä¿®æ”¹,ç„¶åè½¬æ¢æˆä¸ºäº†deleteæˆ–è€…putè¯·æ±‚(å…·ä½“å–å†³äºvalueçš„å€¼)</p></blockquote><p>åœ¨web.xmlä¸­æ³¨å†Œ<strong>HiddenHttpMethodFilter</strong> </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨ï¼š</p><p>ç›®å‰ä¸ºæ­¢ï¼ŒSpringMVCä¸­æä¾›äº†ä¸¤ä¸ªè¿‡æ»¤å™¨ï¼šCharacterEncodingFilterå’ŒHiddenHttpMethodFilter</p><p>åœ¨web.xmlä¸­æ³¨å†Œæ—¶ï¼Œå¿…é¡»å…ˆæ³¨å†ŒCharacterEncodingFilterï¼Œå†æ³¨å†ŒHiddenHttpMethodFilter</p><p>åŸå› ï¼š</p><ul><li><p>åœ¨ CharacterEncodingFilter ä¸­é€šè¿‡ request.setCharacterEncoding(encoding) æ–¹æ³•è®¾ç½®å­—ç¬¦é›†çš„</p></li><li><p>request.setCharacterEncoding(encoding) æ–¹æ³•è¦æ±‚å‰é¢ä¸èƒ½æœ‰ä»»ä½•è·å–è¯·æ±‚å‚æ•°çš„æ“ä½œ</p></li><li><p>è€Œ HiddenHttpMethodFilter æ°æ°æœ‰ä¸€ä¸ªè·å–è¯·æ±‚æ–¹å¼çš„æ“ä½œï¼š</p></li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">paramValue</span> <span class="operator">=</span> request.getParameter(<span class="built_in">this</span>.methodParam);</span><br></pre></td></tr></table></figure><h1 id="å…«ã€RESTfulæ¡ˆä¾‹"><a href="#å…«ã€RESTfulæ¡ˆä¾‹" class="headerlink" title="å…«ã€RESTfulæ¡ˆä¾‹"></a>å…«ã€RESTfulæ¡ˆä¾‹</h1><h3 id="1ã€å‡†å¤‡å·¥ä½œ"><a href="#1ã€å‡†å¤‡å·¥ä½œ" class="headerlink" title="1ã€å‡†å¤‡å·¥ä½œ"></a>1ã€å‡†å¤‡å·¥ä½œ</h3><p>å’Œä¼ ç»Ÿ CRUD ä¸€æ ·ï¼Œå®ç°å¯¹å‘˜å·¥ä¿¡æ¯çš„å¢åˆ æ”¹æŸ¥ã€‚</p><ul><li><p>æ­å»ºç¯å¢ƒ</p></li><li><p>å‡†å¤‡å®ä½“ç±»</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoConstructor</span></span><br><span class="line"><span class="meta">@AllConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="comment">//1 male, 0 female</span></span><br><span class="line">    <span class="keyword">private</span> Integer gender;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å‡†å¤‡daoæ¨¡æ‹Ÿæ•°æ®</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;Integer, Employee&gt; employees = <span class="literal">null</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">    employees = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;Integer, Employee&gt;();</span><br><span class="line"></span><br><span class="line">    employees.put(<span class="number">1001</span>, <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">1001</span>, <span class="string">&quot;E-AA&quot;</span>, <span class="string">&quot;aa@163.com&quot;</span>, <span class="number">1</span>));</span><br><span class="line">    employees.put(<span class="number">1002</span>, <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">1002</span>, <span class="string">&quot;E-BB&quot;</span>, <span class="string">&quot;bb@163.com&quot;</span>, <span class="number">1</span>));</span><br><span class="line">    employees.put(<span class="number">1003</span>, <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">1003</span>, <span class="string">&quot;E-CC&quot;</span>, <span class="string">&quot;cc@163.com&quot;</span>, <span class="number">0</span>));</span><br><span class="line">    employees.put(<span class="number">1004</span>, <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">1004</span>, <span class="string">&quot;E-DD&quot;</span>, <span class="string">&quot;dd@163.com&quot;</span>, <span class="number">0</span>));</span><br><span class="line">    employees.put(<span class="number">1005</span>, <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">1005</span>, <span class="string">&quot;E-EE&quot;</span>, <span class="string">&quot;ee@163.com&quot;</span>, <span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Integer</span> <span class="variable">initId</span> <span class="operator">=</span> <span class="number">1006</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(Employee employee)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(employee.getId() == <span class="literal">null</span>)&#123;</span><br><span class="line">        employee.setId(initId++);</span><br><span class="line">    &#125;</span><br><span class="line">    employees.put(employee.getId(), employee);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Collection&lt;Employee&gt; <span class="title function_">getAll</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> employees.values();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Employee <span class="title function_">get</span><span class="params">(Integer id)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> employees.get(id);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(Integer id)</span>&#123;</span><br><span class="line">    employees.remove(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€åŠŸèƒ½æ¸…å•"><a href="#2ã€åŠŸèƒ½æ¸…å•" class="headerlink" title="2ã€åŠŸèƒ½æ¸…å•"></a>2ã€åŠŸèƒ½æ¸…å•</h3><table><thead><tr><th>åŠŸèƒ½</th><th>URL åœ°å€</th><th>è¯·æ±‚æ–¹å¼</th></tr></thead><tbody><tr><td>è®¿é—®é¦–é¡µâˆš</td><td>&#x2F;</td><td>GET</td></tr><tr><td>æŸ¥è¯¢å…¨éƒ¨æ•°æ®âˆš</td><td>&#x2F;employee</td><td>GET</td></tr><tr><td>åˆ é™¤âˆš</td><td>&#x2F;employee&#x2F;2</td><td>DELETE</td></tr><tr><td>è·³è½¬åˆ°æ·»åŠ æ•°æ®é¡µé¢âˆš</td><td>&#x2F;toAdd</td><td>GET</td></tr><tr><td>æ‰§è¡Œä¿å­˜âˆš</td><td>&#x2F;employee</td><td>POST</td></tr><tr><td>è·³è½¬åˆ°æ›´æ–°æ•°æ®é¡µé¢âˆš</td><td>&#x2F;employee&#x2F;2</td><td>GET</td></tr><tr><td>æ‰§è¡Œæ›´æ–°âˆš</td><td>&#x2F;employee</td><td>PUT</td></tr></tbody></table><h3 id="3ã€å…·ä½“åŠŸèƒ½ï¼šè®¿é—®é¦–é¡µ"><a href="#3ã€å…·ä½“åŠŸèƒ½ï¼šè®¿é—®é¦–é¡µ" class="headerlink" title="3ã€å…·ä½“åŠŸèƒ½ï¼šè®¿é—®é¦–é¡µ"></a>3ã€å…·ä½“åŠŸèƒ½ï¼šè®¿é—®é¦–é¡µ</h3><h5 id="a-é…ç½®view-controller"><a href="#a-é…ç½®view-controller" class="headerlink" title="a&gt;é…ç½®view-controller"></a>a&gt;é…ç½®view-controller</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:view-controller</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">view-name</span>=<span class="string">&quot;index&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h5 id="b-åˆ›å»ºé¡µé¢"><a href="#b-åˆ›å»ºé¡µé¢" class="headerlink" title="b&gt;åˆ›å»ºé¡µé¢"></a>b&gt;åˆ›å»ºé¡µé¢</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>é¦–é¡µ<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/employee&#125;&quot;</span>&gt;</span>è®¿é—®å‘˜å·¥ä¿¡æ¯<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="4ã€å…·ä½“åŠŸèƒ½ï¼šæŸ¥è¯¢æ‰€æœ‰å‘˜å·¥æ•°æ®"><a href="#4ã€å…·ä½“åŠŸèƒ½ï¼šæŸ¥è¯¢æ‰€æœ‰å‘˜å·¥æ•°æ®" class="headerlink" title="4ã€å…·ä½“åŠŸèƒ½ï¼šæŸ¥è¯¢æ‰€æœ‰å‘˜å·¥æ•°æ®"></a>4ã€å…·ä½“åŠŸèƒ½ï¼šæŸ¥è¯¢æ‰€æœ‰å‘˜å·¥æ•°æ®</h3><h5 id="a-æ§åˆ¶å™¨æ–¹æ³•"><a href="#a-æ§åˆ¶å™¨æ–¹æ³•" class="headerlink" title="a&gt;æ§åˆ¶å™¨æ–¹æ³•"></a>a&gt;æ§åˆ¶å™¨æ–¹æ³•</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/employee&quot;, method = RequestMethod.GET)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getEmployeeList</span><span class="params">(Model model)</span>&#123;</span><br><span class="line">    Collection&lt;Employee&gt; employeeList = employeeDao.getAll();</span><br><span class="line">    model.addAttribute(<span class="string">&quot;employeeList&quot;</span>, employeeList);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;employee_list&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="b-åˆ›å»ºemployee-list-html"><a href="#b-åˆ›å»ºemployee-list-html" class="headerlink" title="b&gt;åˆ›å»ºemployee_list.html"></a>b&gt;åˆ›å»ºemployee_list.html</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Employee Info<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/static/js/vue.js&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">&quot;1&quot;</span> <span class="attr">cellpadding</span>=<span class="string">&quot;0&quot;</span> <span class="attr">cellspacing</span>=<span class="string">&quot;0&quot;</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;dataTable&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">colspan</span>=<span class="string">&quot;5&quot;</span>&gt;</span>Employee Info<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>id<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>lastName<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>email<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>gender<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>options(<span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/toAdd&#125;&quot;</span>&gt;</span>add<span class="tag">&lt;/<span class="name">a</span>&gt;</span>)<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">&quot;employee : $&#123;employeeList&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;employee.id&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;employee.lastName&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;employee.email&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;employee.gender&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;deleteA&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;deleteEmployee&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;&#x27;/employee/&#x27;+$&#123;employee.id&#125;&#125;&quot;</span>&gt;</span>delete<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;&#x27;/employee/&#x27;+$&#123;employee.id&#125;&#125;&quot;</span>&gt;</span>update<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="5ã€å…·ä½“åŠŸèƒ½ï¼šåˆ é™¤"><a href="#5ã€å…·ä½“åŠŸèƒ½ï¼šåˆ é™¤" class="headerlink" title="5ã€å…·ä½“åŠŸèƒ½ï¼šåˆ é™¤"></a>5ã€å…·ä½“åŠŸèƒ½ï¼šåˆ é™¤</h3><h5 id="a-åˆ›å»ºå¤„ç†deleteè¯·æ±‚æ–¹å¼çš„è¡¨å•"><a href="#a-åˆ›å»ºå¤„ç†deleteè¯·æ±‚æ–¹å¼çš„è¡¨å•" class="headerlink" title="a&gt;åˆ›å»ºå¤„ç†deleteè¯·æ±‚æ–¹å¼çš„è¡¨å•"></a>a&gt;åˆ›å»ºå¤„ç†deleteè¯·æ±‚æ–¹å¼çš„è¡¨å•</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ä½œç”¨ï¼šé€šè¿‡è¶…é“¾æ¥æ§åˆ¶è¡¨å•çš„æäº¤ï¼Œå°†postè¯·æ±‚è½¬æ¢ä¸ºdeleteè¯·æ±‚ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;delete_form&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- HiddenHttpMethodFilterè¦æ±‚ï¼šå¿…é¡»ä¼ è¾“_methodè¯·æ±‚å‚æ•°ï¼Œå¹¶ä¸”å€¼ä¸ºæœ€ç»ˆçš„è¯·æ±‚æ–¹å¼ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;delete&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="b-åˆ é™¤è¶…é“¾æ¥ç»‘å®šç‚¹å‡»äº‹ä»¶"><a href="#b-åˆ é™¤è¶…é“¾æ¥ç»‘å®šç‚¹å‡»äº‹ä»¶" class="headerlink" title="b&gt;åˆ é™¤è¶…é“¾æ¥ç»‘å®šç‚¹å‡»äº‹ä»¶"></a>b&gt;åˆ é™¤è¶…é“¾æ¥ç»‘å®šç‚¹å‡»äº‹ä»¶</h5><p>å¼•å…¥vue.js</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/static/js/vue.js&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åˆ é™¤è¶…é“¾æ¥</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;deleteA&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;deleteEmployee&quot;</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;&#x27;/employee/&#x27;+$&#123;employee.id&#125;&#125;&quot;</span>&gt;</span>delete<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡vueå¤„ç†ç‚¹å‡»äº‹ä»¶</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> vue = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>:<span class="string">&quot;#dataTable&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//eventè¡¨ç¤ºå½“å‰äº‹ä»¶</span></span></span><br><span class="line"><span class="language-javascript">            <span class="attr">deleteEmployee</span>:<span class="keyword">function</span> (<span class="params">event</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//é€šè¿‡idè·å–è¡¨å•æ ‡ç­¾</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> delete_form = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;delete_form&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//å°†è§¦å‘äº‹ä»¶çš„è¶…é“¾æ¥çš„hrefå±æ€§ä¸ºè¡¨å•çš„actionå±æ€§èµ‹å€¼</span></span></span><br><span class="line"><span class="language-javascript">                delete_form.<span class="property">action</span> = event.<span class="property">target</span>.<span class="property">href</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//æäº¤è¡¨å•</span></span></span><br><span class="line"><span class="language-javascript">                delete_form.<span class="title function_">submit</span>();</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">//é˜»æ­¢è¶…é“¾æ¥çš„é»˜è®¤è·³è½¬è¡Œä¸º</span></span></span><br><span class="line"><span class="language-javascript">                event.<span class="title function_">preventDefault</span>();</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="c-æ§åˆ¶å™¨æ–¹æ³•"><a href="#c-æ§åˆ¶å™¨æ–¹æ³•" class="headerlink" title="c&gt;æ§åˆ¶å™¨æ–¹æ³•"></a>c&gt;æ§åˆ¶å™¨æ–¹æ³•</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/employee/&#123;id&#125;&quot;, method = RequestMethod.DELETE)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">deleteEmployee</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>&#123;</span><br><span class="line">    employeeDao.delete(id);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:/employee&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6ã€å…·ä½“åŠŸèƒ½ï¼šè·³è½¬åˆ°æ·»åŠ æ•°æ®é¡µé¢"><a href="#6ã€å…·ä½“åŠŸèƒ½ï¼šè·³è½¬åˆ°æ·»åŠ æ•°æ®é¡µé¢" class="headerlink" title="6ã€å…·ä½“åŠŸèƒ½ï¼šè·³è½¬åˆ°æ·»åŠ æ•°æ®é¡µé¢"></a>6ã€å…·ä½“åŠŸèƒ½ï¼šè·³è½¬åˆ°æ·»åŠ æ•°æ®é¡µé¢</h3><h5 id="a-é…ç½®view-controller-1"><a href="#a-é…ç½®view-controller-1" class="headerlink" title="a&gt;é…ç½®view-controller"></a>a&gt;é…ç½®view-controller</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:view-controller</span> <span class="attr">path</span>=<span class="string">&quot;/toAdd&quot;</span> <span class="attr">view-name</span>=<span class="string">&quot;employee_add&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:view-controller</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="b-åˆ›å»ºemployee-add-html"><a href="#b-åˆ›å»ºemployee-add-html" class="headerlink" title="b&gt;åˆ›å»ºemployee_add.html"></a>b&gt;åˆ›å»ºemployee_add.html</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Add Employee<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/employee&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    lastName:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;lastName&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    email:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    gender:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span>male</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>&gt;</span>female<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;add&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="7ã€å…·ä½“åŠŸèƒ½ï¼šæ‰§è¡Œä¿å­˜"><a href="#7ã€å…·ä½“åŠŸèƒ½ï¼šæ‰§è¡Œä¿å­˜" class="headerlink" title="7ã€å…·ä½“åŠŸèƒ½ï¼šæ‰§è¡Œä¿å­˜"></a>7ã€å…·ä½“åŠŸèƒ½ï¼šæ‰§è¡Œä¿å­˜</h3><h5 id="a-æ§åˆ¶å™¨æ–¹æ³•-1"><a href="#a-æ§åˆ¶å™¨æ–¹æ³•-1" class="headerlink" title="a&gt;æ§åˆ¶å™¨æ–¹æ³•"></a>a&gt;æ§åˆ¶å™¨æ–¹æ³•</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/employee&quot;, method = RequestMethod.POST)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">addEmployee</span><span class="params">(Employee employee)</span>&#123;</span><br><span class="line">    employeeDao.save(employee);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:/employee&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8ã€å…·ä½“åŠŸèƒ½ï¼šè·³è½¬åˆ°æ›´æ–°æ•°æ®é¡µé¢"><a href="#8ã€å…·ä½“åŠŸèƒ½ï¼šè·³è½¬åˆ°æ›´æ–°æ•°æ®é¡µé¢" class="headerlink" title="8ã€å…·ä½“åŠŸèƒ½ï¼šè·³è½¬åˆ°æ›´æ–°æ•°æ®é¡µé¢"></a>8ã€å…·ä½“åŠŸèƒ½ï¼šè·³è½¬åˆ°æ›´æ–°æ•°æ®é¡µé¢</h3><h5 id="a-ä¿®æ”¹è¶…é“¾æ¥"><a href="#a-ä¿®æ”¹è¶…é“¾æ¥" class="headerlink" title="a&gt;ä¿®æ”¹è¶…é“¾æ¥"></a>a&gt;ä¿®æ”¹è¶…é“¾æ¥</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;&#x27;/employee/&#x27;+$&#123;employee.id&#125;&#125;&quot;</span>&gt;</span>update<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="b-æ§åˆ¶å™¨æ–¹æ³•"><a href="#b-æ§åˆ¶å™¨æ–¹æ³•" class="headerlink" title="b&gt;æ§åˆ¶å™¨æ–¹æ³•"></a>b&gt;æ§åˆ¶å™¨æ–¹æ³•</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/employee/&#123;id&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getEmployeeById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id, Model model)</span>&#123;</span><br><span class="line">    <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> employeeDao.get(id);</span><br><span class="line">    model.addAttribute(<span class="string">&quot;employee&quot;</span>, employee);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;employee_update&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="c-åˆ›å»ºemployee-update-html"><a href="#c-åˆ›å»ºemployee-update-html" class="headerlink" title="c&gt;åˆ›å»ºemployee_update.html"></a>c&gt;åˆ›å»ºemployee_update.html</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Update Employee<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/employee&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;put&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;employee.id&#125;&quot;</span>&gt;</span></span><br><span class="line">    lastName:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;lastName&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;employee.lastName&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    email:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">th:value</span>=<span class="string">&quot;$&#123;employee.email&#125;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        th:field=&quot;$&#123;employee.gender&#125;&quot;å¯ç”¨äºå•é€‰æ¡†æˆ–å¤é€‰æ¡†çš„å›æ˜¾</span></span><br><span class="line"><span class="comment">        è‹¥å•é€‰æ¡†çš„valueå’Œemployee.genderçš„å€¼ä¸€è‡´ï¼Œåˆ™æ·»åŠ checked=&quot;checked&quot;å±æ€§</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    gender:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;$&#123;employee.gender&#125;&quot;</span>&gt;</span>male</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span> <span class="attr">th:field</span>=<span class="string">&quot;$&#123;employee.gender&#125;&quot;</span>&gt;</span>female<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;update&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="9ã€å…·ä½“åŠŸèƒ½ï¼šæ‰§è¡Œæ›´æ–°"><a href="#9ã€å…·ä½“åŠŸèƒ½ï¼šæ‰§è¡Œæ›´æ–°" class="headerlink" title="9ã€å…·ä½“åŠŸèƒ½ï¼šæ‰§è¡Œæ›´æ–°"></a>9ã€å…·ä½“åŠŸèƒ½ï¼šæ‰§è¡Œæ›´æ–°</h3><h5 id="a-æ§åˆ¶å™¨æ–¹æ³•-2"><a href="#a-æ§åˆ¶å™¨æ–¹æ³•-2" class="headerlink" title="a&gt;æ§åˆ¶å™¨æ–¹æ³•"></a>a&gt;æ§åˆ¶å™¨æ–¹æ³•</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/employee&quot;, method = RequestMethod.PUT)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">updateEmployee</span><span class="params">(Employee employee)</span>&#123;</span><br><span class="line">    employeeDao.save(employee);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:/employee&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å…«ã€HttpMessageConverter"><a href="#å…«ã€HttpMessageConverter" class="headerlink" title="å…«ã€HttpMessageConverter"></a>å…«ã€HttpMessageConverter</h1><p>HttpMessageConverterï¼ŒæŠ¥æ–‡ä¿¡æ¯è½¬æ¢å™¨ï¼Œå°†è¯·æ±‚æŠ¥æ–‡è½¬æ¢ä¸ºJavaå¯¹è±¡ï¼Œæˆ–å°†Javaå¯¹è±¡è½¬æ¢ä¸ºå“åº”æŠ¥æ–‡</p><p>HttpMessageConverteræä¾›äº†ä¸¤ä¸ªæ³¨è§£å’Œä¸¤ä¸ªç±»å‹ï¼š@RequestBodyï¼Œ@ResponseBodyï¼ŒRequestEntityï¼Œ</p><p>ResponseEntity</p><h3 id="1ã€-RequestBody"><a href="#1ã€-RequestBody" class="headerlink" title="1ã€@RequestBody"></a>1ã€@RequestBody</h3><p>@RequestBodyå¯ä»¥è·å–è¯·æ±‚ä½“ï¼Œéœ€è¦åœ¨æ§åˆ¶å™¨æ–¹æ³•è®¾ç½®ä¸€ä¸ªå½¢å‚ï¼Œä½¿ç”¨@RequestBodyè¿›è¡Œæ ‡è¯†ï¼Œå½“å‰è¯·æ±‚çš„è¯·æ±‚ä½“å°±ä¼šä¸ºå½“å‰æ³¨è§£æ‰€æ ‡è¯†çš„å½¢å‚èµ‹å€¼</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/testRequestBody&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    ç”¨æˆ·åï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    å¯†ç ï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testRequestBody&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testRequestBody</span><span class="params">(<span class="meta">@RequestBody</span> String requestBody)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;requestBody:&quot;</span>+requestBody);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><p>requestBody:username&#x3D;admin&amp;password&#x3D;123456</p><h3 id="2ã€RequestEntity"><a href="#2ã€RequestEntity" class="headerlink" title="2ã€RequestEntity"></a>2ã€RequestEntity</h3><p>RequestEntityå°è£…è¯·æ±‚æŠ¥æ–‡çš„ä¸€ç§ç±»å‹ï¼Œéœ€è¦åœ¨æ§åˆ¶å™¨æ–¹æ³•çš„å½¢å‚ä¸­è®¾ç½®è¯¥ç±»å‹çš„å½¢å‚ï¼Œå½“å‰è¯·æ±‚çš„è¯·æ±‚æŠ¥æ–‡å°±ä¼šèµ‹å€¼ç»™è¯¥å½¢å‚ï¼Œå¯ä»¥é€šè¿‡getHeaders()è·å–è¯·æ±‚å¤´ä¿¡æ¯ï¼Œé€šè¿‡getBody()è·å–è¯·æ±‚ä½“ä¿¡æ¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testRequestEntity&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testRequestEntity</span><span class="params">(RequestEntity&lt;String&gt; requestEntity)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;requestHeader:&quot;</span>+requestEntity.getHeaders());</span><br><span class="line">    System.out.println(<span class="string">&quot;requestBody:&quot;</span>+requestEntity.getBody());</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š<br>requestHeader:[host:â€localhost:8080â€, connection:â€keep-aliveâ€, content-length:â€27â€, cache-control:â€max-age&#x3D;0â€, sec-ch-ua:â€â€ Not A;Brandâ€;v&#x3D;â€99â€, â€œChromiumâ€;v&#x3D;â€90â€, â€œGoogle Chromeâ€;v&#x3D;â€90â€â€, sec-ch-ua-mobile:â€?0â€, upgrade-insecure-requests:â€1â€, origin:â€<a href="http://localhost:8080/">http://localhost:8080</a>â€œ, user-agent:â€Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;90.0.4430.93 Safari&#x2F;537.36â€]<br>requestBody:username&#x3D;admin&amp;password&#x3D;123</p><h3 id="3ã€-ResponseBody"><a href="#3ã€-ResponseBody" class="headerlink" title="3ã€@ResponseBody"></a>3ã€@ResponseBody</h3><p>@ResponseBodyç”¨äºæ ‡è¯†ä¸€ä¸ªæ§åˆ¶å™¨æ–¹æ³•ï¼Œå¯ä»¥å°†è¯¥æ–¹æ³•çš„è¿”å›å€¼ç›´æ¥ä½œä¸ºå“åº”æŠ¥æ–‡çš„å“åº”ä½“å“åº”åˆ°æµè§ˆå™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testResponseBody&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testResponseBody</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœï¼šæµè§ˆå™¨é¡µé¢æ˜¾ç¤ºsuccess</p><h3 id="4ã€SpringMVCå¤„ç†json"><a href="#4ã€SpringMVCå¤„ç†json" class="headerlink" title="4ã€SpringMVCå¤„ç†json"></a>4ã€SpringMVCå¤„ç†json</h3><p>@ResponseBodyå¤„ç†jsonçš„æ­¥éª¤ï¼š</p><p>a&gt;å¯¼å…¥jacksonçš„ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.12.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>b&gt;åœ¨SpringMVCçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­å¼€å¯mvcçš„æ³¨è§£é©±åŠ¨ï¼Œæ­¤æ—¶åœ¨HandlerAdaptorä¸­ä¼šè‡ªåŠ¨è£…é…ä¸€ä¸ªæ¶ˆæ¯è½¬æ¢å™¨ï¼šMappingJackson2HttpMessageConverterï¼Œå¯ä»¥å°†å“åº”åˆ°æµè§ˆå™¨çš„Javaå¯¹è±¡è½¬æ¢ä¸ºJsonæ ¼å¼çš„å­—ç¬¦ä¸²</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;mvc:annotation-driven /&gt;</span><br></pre></td></tr></table></figure><p>c&gt;åœ¨å¤„ç†å™¨æ–¹æ³•ä¸Šä½¿ç”¨@ResponseBodyæ³¨è§£è¿›è¡Œæ ‡è¯†</p><p>d&gt;å°†Javaå¯¹è±¡ç›´æ¥ä½œä¸ºæ§åˆ¶å™¨æ–¹æ³•çš„è¿”å›å€¼è¿”å›ï¼Œå°±ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºJsonæ ¼å¼çš„å­—ç¬¦ä¸²</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testResponseUser&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">testResponseUser</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1001</span>,<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;123456&quot;</span>,<span class="number">23</span>,<span class="string">&quot;ç”·&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµè§ˆå™¨çš„é¡µé¢ä¸­å±•ç¤ºçš„ç»“æœï¼š</p><p>{â€œidâ€:1001,â€usernameâ€:â€adminâ€,â€passwordâ€:â€123456â€,â€ageâ€:23,â€sexâ€:â€ç”·â€}</p><h3 id="5ã€SpringMVCå¤„ç†ajax"><a href="#5ã€SpringMVCå¤„ç†ajax" class="headerlink" title="5ã€SpringMVCå¤„ç†ajax"></a>5ã€SpringMVCå¤„ç†ajax</h3><p>a&gt;è¯·æ±‚è¶…é“¾æ¥ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/testAjax&#125;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;testAjax&quot;</span>&gt;</span>testAjax<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>b&gt;é€šè¿‡vueå’Œaxioså¤„ç†ç‚¹å‡»äº‹ä»¶ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/static/js/vue.js&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/static/js/axios.min.js&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> vue = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">el</span>:<span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">methods</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">testAjax</span>:<span class="keyword">function</span> (<span class="params">event</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">axios</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">method</span>:<span class="string">&quot;post&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">url</span>:event.<span class="property">target</span>.<span class="property">href</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">params</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">username</span>:<span class="string">&quot;admin&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">password</span>:<span class="string">&quot;123456&quot;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">response</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="title function_">alert</span>(response.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">                event.<span class="title function_">preventDefault</span>();</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>c&gt;æ§åˆ¶å™¨æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testAjax&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testAjax</span><span class="params">(String username, String password)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;username:&quot;</span>+username+<span class="string">&quot;,password:&quot;</span>+password);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello,ajax&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6ã€-RestControlleræ³¨è§£"><a href="#6ã€-RestControlleræ³¨è§£" class="headerlink" title="6ã€@RestControlleræ³¨è§£"></a>6ã€@RestControlleræ³¨è§£</h3><p>@RestControlleræ³¨è§£æ˜¯springMVCæä¾›çš„ä¸€ä¸ªå¤åˆæ³¨è§£ï¼Œæ ‡è¯†åœ¨æ§åˆ¶å™¨çš„ç±»ä¸Šï¼Œå°±ç›¸å½“äºä¸ºç±»æ·»åŠ äº†@Controlleræ³¨è§£ï¼Œå¹¶ä¸”ä¸ºå…¶ä¸­çš„æ¯ä¸ªæ–¹æ³•æ·»åŠ äº†@ResponseBodyæ³¨è§£</p><h3 id="7ã€ResponseEntity"><a href="#7ã€ResponseEntity" class="headerlink" title="7ã€ResponseEntity"></a>7ã€ResponseEntity</h3><p>ResponseEntityç”¨äºæ§åˆ¶å™¨æ–¹æ³•çš„è¿”å›å€¼ç±»å‹ï¼Œè¯¥æ§åˆ¶å™¨æ–¹æ³•çš„è¿”å›å€¼å°±æ˜¯å“åº”åˆ°æµè§ˆå™¨çš„å“åº”æŠ¥æ–‡</p><h1 id="ä¹ã€æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½"><a href="#ä¹ã€æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½" class="headerlink" title="ä¹ã€æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½"></a>ä¹ã€æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½</h1><h3 id="1ã€æ–‡ä»¶ä¸‹è½½"><a href="#1ã€æ–‡ä»¶ä¸‹è½½" class="headerlink" title="1ã€æ–‡ä»¶ä¸‹è½½"></a>1ã€æ–‡ä»¶ä¸‹è½½</h3><p>ä½¿ç”¨ResponseEntityå®ç°ä¸‹è½½æ–‡ä»¶çš„åŠŸèƒ½</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testDown&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;<span class="type">byte</span>[]&gt; testResponseEntity(HttpSession session) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">//è·å–ServletContextå¯¹è±¡</span></span><br><span class="line">    <span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span> session.getServletContext();</span><br><span class="line">    <span class="comment">//è·å–æœåŠ¡å™¨ä¸­æ–‡ä»¶çš„çœŸå®è·¯å¾„</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">realPath</span> <span class="operator">=</span> servletContext.getRealPath(<span class="string">&quot;/static/img/1.jpg&quot;</span>);</span><br><span class="line">    <span class="comment">//åˆ›å»ºè¾“å…¥æµ</span></span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(realPath);</span><br><span class="line">    <span class="comment">//åˆ›å»ºå­—èŠ‚æ•°ç»„</span></span><br><span class="line">    <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[is.available()];</span><br><span class="line">    <span class="comment">//å°†æµè¯»åˆ°å­—èŠ‚æ•°ç»„ä¸­</span></span><br><span class="line">    is.read(bytes);</span><br><span class="line">    <span class="comment">//åˆ›å»ºHttpHeaderså¯¹è±¡è®¾ç½®å“åº”å¤´ä¿¡æ¯</span></span><br><span class="line">    MultiValueMap&lt;String, String&gt; headers = <span class="keyword">new</span> <span class="title class_">HttpHeaders</span>();</span><br><span class="line">    <span class="comment">//è®¾ç½®è¦ä¸‹è½½æ–¹å¼ä»¥åŠä¸‹è½½æ–‡ä»¶çš„åå­—</span></span><br><span class="line">    headers.add(<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment;filename=1.jpg&quot;</span>);</span><br><span class="line">    <span class="comment">//è®¾ç½®å“åº”çŠ¶æ€ç </span></span><br><span class="line">    <span class="type">HttpStatus</span> <span class="variable">statusCode</span> <span class="operator">=</span> HttpStatus.OK;</span><br><span class="line">    <span class="comment">//åˆ›å»ºResponseEntityå¯¹è±¡</span></span><br><span class="line">    ResponseEntity&lt;<span class="type">byte</span>[]&gt; responseEntity = <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(bytes, headers, statusCode);</span><br><span class="line">    <span class="comment">//å…³é—­è¾“å…¥æµ</span></span><br><span class="line">    is.close();</span><br><span class="line">    <span class="keyword">return</span> responseEntity;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€æ–‡ä»¶ä¸Šä¼ "><a href="#2ã€æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="2ã€æ–‡ä»¶ä¸Šä¼ "></a>2ã€æ–‡ä»¶ä¸Šä¼ </h3><p>æ–‡ä»¶ä¸Šä¼ è¦æ±‚formè¡¨å•çš„è¯·æ±‚æ–¹å¼å¿…é¡»ä¸ºpostï¼Œå¹¶ä¸”æ·»åŠ å±æ€§enctype&#x3D;â€multipart&#x2F;form-dataâ€</p><p>SpringMVCä¸­å°†ä¸Šä¼ çš„æ–‡ä»¶å°è£…åˆ°MultipartFileå¯¹è±¡ä¸­ï¼Œé€šè¿‡æ­¤å¯¹è±¡å¯ä»¥è·å–æ–‡ä»¶ç›¸å…³ä¿¡æ¯</p><p>ä¸Šä¼ æ­¥éª¤ï¼š</p><p>a&gt;æ·»åŠ ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/commons-fileupload/commons-fileupload --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>b&gt;åœ¨SpringMVCçš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ é…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--å¿…é¡»é€šè¿‡æ–‡ä»¶è§£æå™¨çš„è§£ææ‰èƒ½å°†æ–‡ä»¶è½¬æ¢ä¸ºMultipartFileå¯¹è±¡--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;multipartResolver&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>c&gt;æ§åˆ¶å™¨æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testUp&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testUp</span><span class="params">(MultipartFile photo, HttpSession session)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">//è·å–ä¸Šä¼ çš„æ–‡ä»¶çš„æ–‡ä»¶å</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> photo.getOriginalFilename();</span><br><span class="line">    <span class="comment">//å¤„ç†æ–‡ä»¶é‡åé—®é¢˜</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">hzName</span> <span class="operator">=</span> fileName.substring(fileName.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">    fileName = UUID.randomUUID().toString() + hzName;</span><br><span class="line">    <span class="comment">//è·å–æœåŠ¡å™¨ä¸­photoç›®å½•çš„è·¯å¾„</span></span><br><span class="line">    <span class="type">ServletContext</span> <span class="variable">servletContext</span> <span class="operator">=</span> session.getServletContext();</span><br><span class="line">    <span class="type">String</span> <span class="variable">photoPath</span> <span class="operator">=</span> servletContext.getRealPath(<span class="string">&quot;photo&quot;</span>);</span><br><span class="line">    <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(photoPath);</span><br><span class="line">    <span class="keyword">if</span>(!file.exists())&#123;</span><br><span class="line">        file.mkdir();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">String</span> <span class="variable">finalPath</span> <span class="operator">=</span> photoPath + File.separator + fileName;</span><br><span class="line">    <span class="comment">//å®ç°ä¸Šä¼ åŠŸèƒ½</span></span><br><span class="line">    photo.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(finalPath));</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="åã€æ‹¦æˆªå™¨"><a href="#åã€æ‹¦æˆªå™¨" class="headerlink" title="åã€æ‹¦æˆªå™¨"></a>åã€æ‹¦æˆªå™¨</h1><h3 id="1ã€æ‹¦æˆªå™¨çš„é…ç½®"><a href="#1ã€æ‹¦æˆªå™¨çš„é…ç½®" class="headerlink" title="1ã€æ‹¦æˆªå™¨çš„é…ç½®"></a>1ã€æ‹¦æˆªå™¨çš„é…ç½®</h3><p>SpringMVCä¸­çš„æ‹¦æˆªå™¨ç”¨äºæ‹¦æˆªæ§åˆ¶å™¨æ–¹æ³•çš„æ‰§è¡Œ</p><p>SpringMVCä¸­çš„æ‹¦æˆªå™¨éœ€è¦å®ç°HandlerInterceptor</p><p>SpringMVCçš„æ‹¦æˆªå™¨å¿…é¡»åœ¨SpringMVCçš„é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.hang.interceptor.FirstInterceptor&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;firstInterceptor&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ä»¥ä¸Šä¸¤ç§é…ç½®æ–¹å¼éƒ½æ˜¯å¯¹DispatcherServletæ‰€å¤„ç†çš„æ‰€æœ‰çš„è¯·æ±‚è¿›è¡Œæ‹¦æˆª --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/**&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">&quot;/testRequestEntity&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;firstInterceptor&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">ä»¥ä¸Šé…ç½®æ–¹å¼å¯ä»¥é€šè¿‡refæˆ–beanæ ‡ç­¾è®¾ç½®æ‹¦æˆªå™¨ï¼Œ</span></span><br><span class="line"><span class="comment">    é€šè¿‡mvc:mappingè®¾ç½®éœ€è¦æ‹¦æˆªçš„è¯·æ±‚ï¼Œ</span></span><br><span class="line"><span class="comment">    é€šè¿‡mvc:exclude-mappingè®¾ç½®éœ€è¦æ’é™¤çš„è¯·æ±‚ï¼Œå³ä¸éœ€è¦æ‹¦æˆªçš„è¯·æ±‚</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2ã€æ‹¦æˆªå™¨çš„ä¸‰ä¸ªæŠ½è±¡æ–¹æ³•"><a href="#2ã€æ‹¦æˆªå™¨çš„ä¸‰ä¸ªæŠ½è±¡æ–¹æ³•" class="headerlink" title="2ã€æ‹¦æˆªå™¨çš„ä¸‰ä¸ªæŠ½è±¡æ–¹æ³•"></a>2ã€æ‹¦æˆªå™¨çš„ä¸‰ä¸ªæŠ½è±¡æ–¹æ³•</h3><p>SpringMVCä¸­çš„æ‹¦æˆªå™¨æœ‰ä¸‰ä¸ªæŠ½è±¡æ–¹æ³•ï¼š</p><p>preHandleï¼šæ§åˆ¶å™¨æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡ŒpreHandle()ï¼Œå…¶booleanç±»å‹çš„è¿”å›å€¼è¡¨ç¤ºæ˜¯å¦æ‹¦æˆªæˆ–æ”¾è¡Œï¼Œè¿”å›trueä¸ºæ”¾è¡Œï¼Œå³è°ƒç”¨æ§åˆ¶å™¨æ–¹æ³•ï¼›è¿”å›falseè¡¨ç¤ºæ‹¦æˆªï¼Œå³ä¸è°ƒç”¨æ§åˆ¶å™¨æ–¹æ³•</p><p>postHandleï¼šæ§åˆ¶å™¨æ–¹æ³•æ‰§è¡Œä¹‹åæ‰§è¡ŒpostHandle()</p><p>afterComplationï¼šå¤„ç†å®Œè§†å›¾å’Œæ¨¡å‹æ•°æ®ï¼Œæ¸²æŸ“è§†å›¾å®Œæ¯•ä¹‹åæ‰§è¡ŒafterComplation()</p><h3 id="3ã€å¤šä¸ªæ‹¦æˆªå™¨çš„æ‰§è¡Œé¡ºåº"><a href="#3ã€å¤šä¸ªæ‹¦æˆªå™¨çš„æ‰§è¡Œé¡ºåº" class="headerlink" title="3ã€å¤šä¸ªæ‹¦æˆªå™¨çš„æ‰§è¡Œé¡ºåº"></a>3ã€å¤šä¸ªæ‹¦æˆªå™¨çš„æ‰§è¡Œé¡ºåº</h3><p>a&gt;è‹¥æ¯ä¸ªæ‹¦æˆªå™¨çš„preHandle()éƒ½è¿”å›true</p><p>æ­¤æ—¶å¤šä¸ªæ‹¦æˆªå™¨çš„æ‰§è¡Œé¡ºåºå’Œæ‹¦æˆªå™¨åœ¨SpringMVCçš„é…ç½®æ–‡ä»¶çš„é…ç½®é¡ºåºæœ‰å…³ï¼š</p><p>preHandle()ä¼šæŒ‰ç…§é…ç½®çš„é¡ºåºæ‰§è¡Œï¼Œè€ŒpostHandle()å’ŒafterComplation()ä¼šæŒ‰ç…§é…ç½®çš„ååºæ‰§è¡Œ</p><p>b&gt;è‹¥æŸä¸ªæ‹¦æˆªå™¨çš„preHandle()è¿”å›äº†false</p><p>preHandle()è¿”å›falseå’Œå®ƒä¹‹å‰çš„æ‹¦æˆªå™¨çš„preHandle()éƒ½ä¼šæ‰§è¡Œï¼ŒpostHandle()éƒ½ä¸æ‰§è¡Œï¼Œè¿”å›falseçš„æ‹¦æˆªå™¨ä¹‹å‰çš„æ‹¦æˆªå™¨çš„afterComplation()ä¼šæ‰§è¡Œ</p><h1 id="åä¸€ã€å¼‚å¸¸å¤„ç†å™¨"><a href="#åä¸€ã€å¼‚å¸¸å¤„ç†å™¨" class="headerlink" title="åä¸€ã€å¼‚å¸¸å¤„ç†å™¨"></a>åä¸€ã€å¼‚å¸¸å¤„ç†å™¨</h1><h3 id="1ã€åŸºäºé…ç½®çš„å¼‚å¸¸å¤„ç†"><a href="#1ã€åŸºäºé…ç½®çš„å¼‚å¸¸å¤„ç†" class="headerlink" title="1ã€åŸºäºé…ç½®çš„å¼‚å¸¸å¤„ç†"></a>1ã€åŸºäºé…ç½®çš„å¼‚å¸¸å¤„ç†</h3><p>SpringMVCæä¾›äº†ä¸€ä¸ªå¤„ç†æ§åˆ¶å™¨æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰€å‡ºç°çš„å¼‚å¸¸çš„æ¥å£ï¼šHandlerExceptionResolver</p><p>HandlerExceptionResolveræ¥å£çš„å®ç°ç±»æœ‰ï¼šDefaultHandlerExceptionResolverå’ŒSimpleMappingExceptionResolver</p><p>SpringMVCæä¾›äº†è‡ªå®šä¹‰çš„å¼‚å¸¸å¤„ç†å™¨SimpleMappingExceptionResolverï¼Œä½¿ç”¨æ–¹å¼ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.handler.SimpleMappingExceptionResolver&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;exceptionMappings&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        propertiesçš„é”®è¡¨ç¤ºå¤„ç†å™¨æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°çš„å¼‚å¸¸</span></span><br><span class="line"><span class="comment">        propertiesçš„å€¼è¡¨ç¤ºè‹¥å‡ºç°æŒ‡å®šå¼‚å¸¸æ—¶ï¼Œè®¾ç½®ä¸€ä¸ªæ–°çš„è§†å›¾åç§°ï¼Œè·³è½¬åˆ°æŒ‡å®šé¡µé¢</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;java.lang.ArithmeticException&quot;</span>&gt;</span>error<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    exceptionAttributeå±æ€§è®¾ç½®ä¸€ä¸ªå±æ€§åï¼Œå°†å‡ºç°çš„å¼‚å¸¸ä¿¡æ¯åœ¨è¯·æ±‚åŸŸä¸­è¿›è¡Œå…±äº«</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;exceptionAttribute&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ex&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2ã€åŸºäºæ³¨è§£çš„å¼‚å¸¸å¤„ç†"><a href="#2ã€åŸºäºæ³¨è§£çš„å¼‚å¸¸å¤„ç†" class="headerlink" title="2ã€åŸºäºæ³¨è§£çš„å¼‚å¸¸å¤„ç†"></a>2ã€åŸºäºæ³¨è§£çš„å¼‚å¸¸å¤„ç†</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@ControllerAdviceå°†å½“å‰ç±»æ ‡è¯†ä¸ºå¼‚å¸¸å¤„ç†çš„ç»„ä»¶</span></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExceptionController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//@ExceptionHandlerç”¨äºè®¾ç½®æ‰€æ ‡è¯†æ–¹æ³•å¤„ç†çš„å¼‚å¸¸</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(ArithmeticException.class)</span></span><br><span class="line">    <span class="comment">//exè¡¨ç¤ºå½“å‰è¯·æ±‚å¤„ç†ä¸­å‡ºç°çš„å¼‚å¸¸å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">handleArithmeticException</span><span class="params">(Exception ex, Model model)</span>&#123;</span><br><span class="line">        model.addAttribute(<span class="string">&quot;ex&quot;</span>, ex);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="åäºŒã€æ³¨è§£é…ç½®SpringMVC"><a href="#åäºŒã€æ³¨è§£é…ç½®SpringMVC" class="headerlink" title="åäºŒã€æ³¨è§£é…ç½®SpringMVC"></a>åäºŒã€æ³¨è§£é…ç½®SpringMVC</h1><p>ä½¿ç”¨é…ç½®ç±»å’Œæ³¨è§£ä»£æ›¿web.xmlå’ŒSpringMVCé…ç½®æ–‡ä»¶çš„åŠŸèƒ½</p><h3 id="1ã€åˆ›å»ºåˆå§‹åŒ–ç±»ï¼Œä»£æ›¿web-xml"><a href="#1ã€åˆ›å»ºåˆå§‹åŒ–ç±»ï¼Œä»£æ›¿web-xml" class="headerlink" title="1ã€åˆ›å»ºåˆå§‹åŒ–ç±»ï¼Œä»£æ›¿web.xml"></a>1ã€åˆ›å»ºåˆå§‹åŒ–ç±»ï¼Œä»£æ›¿web.xml</h3><p>åœ¨Servlet3.0ç¯å¢ƒä¸­ï¼Œå®¹å™¨ä¼šåœ¨ç±»è·¯å¾„ä¸­æŸ¥æ‰¾å®ç°javax.servlet.ServletContainerInitializeræ¥å£çš„ç±»ï¼Œå¦‚æœæ‰¾åˆ°çš„è¯å°±ç”¨å®ƒæ¥é…ç½®Servletå®¹å™¨ã€‚<br>Springæä¾›äº†è¿™ä¸ªæ¥å£çš„å®ç°ï¼Œåä¸ºSpringServletContainerInitializerï¼Œè¿™ä¸ªç±»åè¿‡æ¥åˆä¼šæŸ¥æ‰¾å®ç°WebApplicationInitializerçš„ç±»å¹¶å°†é…ç½®çš„ä»»åŠ¡äº¤ç»™å®ƒä»¬æ¥å®Œæˆã€‚Spring3.2å¼•å…¥äº†ä¸€ä¸ªä¾¿åˆ©çš„WebApplicationInitializeråŸºç¡€å®ç°ï¼Œåä¸ºAbstractAnnotationConfigDispatcherServletInitializerï¼Œå½“æˆ‘ä»¬çš„ç±»æ‰©å±•äº†AbstractAnnotationConfigDispatcherServletInitializerå¹¶å°†å…¶éƒ¨ç½²åˆ°Servlet3.0å®¹å™¨çš„æ—¶å€™ï¼Œå®¹å™¨ä¼šè‡ªåŠ¨å‘ç°å®ƒï¼Œå¹¶ç”¨å®ƒæ¥é…ç½®Servletä¸Šä¸‹æ–‡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebInit</span> <span class="keyword">extends</span> <span class="title class_">AbstractAnnotationConfigDispatcherServletInitializer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŒ‡å®šspringçš„é…ç½®ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt;[] getRootConfigClasses() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;SpringConfig.class&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŒ‡å®šSpringMVCçš„é…ç½®ç±»</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt;[] getServletConfigClasses() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;WebConfig.class&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŒ‡å®šDispatcherServletçš„æ˜ å°„è§„åˆ™ï¼Œå³url-pattern</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> String[] getServletMappings() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;/&quot;</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·»åŠ (æ³¨å†Œ)è¿‡æ»¤å™¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Filter[] getServletFilters() &#123;</span><br><span class="line">        <span class="type">CharacterEncodingFilter</span> <span class="variable">encodingFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CharacterEncodingFilter</span>();</span><br><span class="line">        encodingFilter.setEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        encodingFilter.setForceRequestEncoding(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">HiddenHttpMethodFilter</span> <span class="variable">hiddenHttpMethodFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HiddenHttpMethodFilter</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Filter</span>[]&#123;encodingFilter, hiddenHttpMethodFilter&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€åˆ›å»ºSpringConfigé…ç½®ç±»ï¼Œä»£æ›¿springçš„é…ç½®æ–‡ä»¶"><a href="#2ã€åˆ›å»ºSpringConfigé…ç½®ç±»ï¼Œä»£æ›¿springçš„é…ç½®æ–‡ä»¶" class="headerlink" title="2ã€åˆ›å»ºSpringConfigé…ç½®ç±»ï¼Œä»£æ›¿springçš„é…ç½®æ–‡ä»¶"></a>2ã€åˆ›å»ºSpringConfigé…ç½®ç±»ï¼Œä»£æ›¿springçš„é…ç½®æ–‡ä»¶</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line"><span class="comment">//ssmæ•´åˆä¹‹åï¼Œspringçš„é…ç½®ä¿¡æ¯å†™åœ¨æ­¤ç±»ä¸­</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€åˆ›å»ºWebConfigé…ç½®ç±»ï¼Œä»£æ›¿SpringMVCçš„é…ç½®æ–‡ä»¶"><a href="#3ã€åˆ›å»ºWebConfigé…ç½®ç±»ï¼Œä»£æ›¿SpringMVCçš„é…ç½®æ–‡ä»¶" class="headerlink" title="3ã€åˆ›å»ºWebConfigé…ç½®ç±»ï¼Œä»£æ›¿SpringMVCçš„é…ç½®æ–‡ä»¶"></a>3ã€åˆ›å»ºWebConfigé…ç½®ç±»ï¼Œä»£æ›¿SpringMVCçš„é…ç½®æ–‡ä»¶</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  ä»£æ›¿SpringMVCçš„é…ç½®æ–‡ä»¶:</span></span><br><span class="line"><span class="comment"> *  1ã€æ‰«æç»„ä»¶  ComponentScan()</span></span><br><span class="line"><span class="comment"> *  2ã€è§†å›¾è§£æå™¨</span></span><br><span class="line"><span class="comment"> *  3ã€view-controller  </span></span><br><span class="line"><span class="comment"> *  4ã€default-servlet-handler</span></span><br><span class="line"><span class="comment"> *  5ã€mvcé©±åŠ¨æ³¨å†Œ</span></span><br><span class="line"><span class="comment"> *  6ã€æ–‡ä»¶ä¸Šä¼ è§£æå™¨</span></span><br><span class="line"><span class="comment"> *  7ã€å¼‚å¸¸å¤„ç†</span></span><br><span class="line"><span class="comment"> *  8ã€æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//æ‰«æç»„ä»¶</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.hang.mvc.controller&quot;)</span> <span class="comment">// æ­¤æ—¶æ˜¯æ‰«æcontroller</span></span><br><span class="line"><span class="comment">//å¼€å¯MVCæ³¨è§£é©±åŠ¨</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨é»˜è®¤çš„servletå¤„ç†é™æ€èµ„æº</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureDefaultServletHandling</span><span class="params">(DefaultServletHandlerConfigurer configurer)</span> &#123;</span><br><span class="line">        configurer.enable();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é…ç½®æ–‡ä»¶ä¸Šä¼ è§£æå™¨</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CommonsMultipartResolver <span class="title function_">multipartResolver</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CommonsMultipartResolver</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é…ç½®æ‹¦æˆªå™¨</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        <span class="type">FirstInterceptor</span> <span class="variable">firstInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FirstInterceptor</span>();</span><br><span class="line">        registry.addInterceptor(firstInterceptor)</span><br><span class="line">            .addPathPatterns(<span class="string">&quot;/**&quot;</span>); <span class="comment">// æ‹¦æˆªæ‰€æœ‰çš„è¯·æ±‚</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é…ç½®è§†å›¾æ§åˆ¶</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*@Override</span></span><br><span class="line"><span class="comment">    public void addViewControllers(ViewControllerRegistry registry) &#123;</span></span><br><span class="line"><span class="comment">        registry.addViewController(&quot;/&quot;).setViewName(&quot;index&quot;);</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é…ç½®å¼‚å¸¸æ˜ å°„å¤„ç†</span></span><br><span class="line">    <span class="comment">/*@Override</span></span><br><span class="line"><span class="comment">    public void configureHandlerExceptionResolvers(List&lt;HandlerExceptionResolver&gt; resolvers) &#123;</span></span><br><span class="line"><span class="comment">        SimpleMappingExceptionResolver exceptionResolver = new SimpleMappingExceptionResolver();</span></span><br><span class="line"><span class="comment">        Properties prop = new Properties();</span></span><br><span class="line"><span class="comment">        prop.setProperty(&quot;java.lang.ArithmeticException&quot;, &quot;error&quot;);</span></span><br><span class="line"><span class="comment">        //è®¾ç½®å¼‚å¸¸æ˜ å°„</span></span><br><span class="line"><span class="comment">        exceptionResolver.setExceptionMappings(prop);</span></span><br><span class="line"><span class="comment">        //è®¾ç½®å…±äº«å¼‚å¸¸ä¿¡æ¯çš„é”®</span></span><br><span class="line"><span class="comment">        exceptionResolver.setExceptionAttribute(&quot;ex&quot;);</span></span><br><span class="line"><span class="comment">        resolvers.add(exceptionResolver);</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// é…ç½®ç”Ÿæˆæ¨¡æ¿è§£æå™¨</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ITemplateResolver <span class="title function_">templateResolver</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">WebApplicationContext</span> <span class="variable">webApplicationContext</span> <span class="operator">=</span> ContextLoader.getCurrentWebApplicationContext();</span><br><span class="line">        <span class="comment">// ServletContextTemplateResolveréœ€è¦ä¸€ä¸ªServletContextä½œä¸ºæ„é€ å‚æ•°ï¼Œå¯é€šè¿‡WebApplicationContext çš„æ–¹æ³•è·å¾—</span></span><br><span class="line">        <span class="type">ServletContextTemplateResolver</span> <span class="variable">templateResolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletContextTemplateResolver</span>(</span><br><span class="line">                webApplicationContext.getServletContext());</span><br><span class="line">        templateResolver.setPrefix(<span class="string">&quot;/WEB-INF/templates/&quot;</span>);</span><br><span class="line">        templateResolver.setSuffix(<span class="string">&quot;.html&quot;</span>);</span><br><span class="line">        templateResolver.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        templateResolver.setTemplateMode(TemplateMode.HTML);</span><br><span class="line">        <span class="keyword">return</span> templateResolver;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”Ÿæˆæ¨¡æ¿å¼•æ“å¹¶ä¸ºæ¨¡æ¿å¼•æ“æ³¨å…¥æ¨¡æ¿è§£æå™¨</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SpringTemplateEngine <span class="title function_">templateEngine</span><span class="params">(ITemplateResolver templateResolver)</span> &#123;</span><br><span class="line">        <span class="type">SpringTemplateEngine</span> <span class="variable">templateEngine</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpringTemplateEngine</span>();</span><br><span class="line">        templateEngine.setTemplateResolver(templateResolver);</span><br><span class="line">        <span class="keyword">return</span> templateEngine;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç”Ÿæˆè§†å›¾è§£æå™¨å¹¶æœªè§£æå™¨æ³¨å…¥æ¨¡æ¿å¼•æ“</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ViewResolver <span class="title function_">viewResolver</span><span class="params">(SpringTemplateEngine templateEngine)</span> &#123;</span><br><span class="line">        <span class="type">ThymeleafViewResolver</span> <span class="variable">viewResolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThymeleafViewResolver</span>();</span><br><span class="line">        viewResolver.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        viewResolver.setTemplateEngine(templateEngine);</span><br><span class="line">        <span class="keyword">return</span> viewResolver;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4ã€æµ‹è¯•åŠŸèƒ½"><a href="#4ã€æµ‹è¯•åŠŸèƒ½" class="headerlink" title="4ã€æµ‹è¯•åŠŸèƒ½"></a>4ã€æµ‹è¯•åŠŸèƒ½</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">index</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="åä¸‰ã€SpringMVCæ‰§è¡Œæµç¨‹"><a href="#åä¸‰ã€SpringMVCæ‰§è¡Œæµç¨‹" class="headerlink" title="åä¸‰ã€SpringMVCæ‰§è¡Œæµç¨‹"></a>åä¸‰ã€SpringMVCæ‰§è¡Œæµç¨‹</h1><h3 id="1ã€SpringMVCå¸¸ç”¨ç»„ä»¶"><a href="#1ã€SpringMVCå¸¸ç”¨ç»„ä»¶" class="headerlink" title="1ã€SpringMVCå¸¸ç”¨ç»„ä»¶"></a>1ã€SpringMVCå¸¸ç”¨ç»„ä»¶</h3><ul><li>DispatcherServletï¼š<strong>å‰ç«¯æ§åˆ¶å™¨</strong>ï¼Œä¸éœ€è¦å·¥ç¨‹å¸ˆå¼€å‘ï¼Œç”±æ¡†æ¶æä¾›</li></ul><p>ä½œç”¨ï¼šç»Ÿä¸€å¤„ç†è¯·æ±‚å’Œå“åº”ï¼Œæ•´ä¸ªæµç¨‹æ§åˆ¶çš„ä¸­å¿ƒï¼Œç”±å®ƒè°ƒç”¨å…¶å®ƒç»„ä»¶å¤„ç†ç”¨æˆ·çš„è¯·æ±‚</p><ul><li>HandlerMappingï¼š<strong>å¤„ç†å™¨æ˜ å°„å™¨</strong>ï¼Œä¸éœ€è¦å·¥ç¨‹å¸ˆå¼€å‘ï¼Œç”±æ¡†æ¶æä¾›</li></ul><p>ä½œç”¨ï¼šæ ¹æ®è¯·æ±‚çš„urlã€methodç­‰ä¿¡æ¯æŸ¥æ‰¾Handlerï¼Œå³æ§åˆ¶å™¨æ–¹æ³•</p><ul><li>Handlerï¼š<strong>å¤„ç†å™¨</strong>ï¼Œéœ€è¦å·¥ç¨‹å¸ˆå¼€å‘</li></ul><p>ä½œç”¨ï¼šåœ¨DispatcherServletçš„æ§åˆ¶ä¸‹Handlerå¯¹å…·ä½“çš„ç”¨æˆ·è¯·æ±‚è¿›è¡Œå¤„ç†</p><ul><li>HandlerAdapterï¼š<strong>å¤„ç†å™¨é€‚é…å™¨</strong>ï¼Œä¸éœ€è¦å·¥ç¨‹å¸ˆå¼€å‘ï¼Œç”±æ¡†æ¶æä¾›</li></ul><p>ä½œç”¨ï¼šé€šè¿‡HandlerAdapterå¯¹å¤„ç†å™¨ï¼ˆæ§åˆ¶å™¨æ–¹æ³•ï¼‰è¿›è¡Œæ‰§è¡Œ</p><ul><li>ViewResolverï¼š<strong>è§†å›¾è§£æå™¨</strong>ï¼Œä¸éœ€è¦å·¥ç¨‹å¸ˆå¼€å‘ï¼Œç”±æ¡†æ¶æä¾›</li></ul><p>ä½œç”¨ï¼šè¿›è¡Œè§†å›¾è§£æï¼Œå¾—åˆ°ç›¸åº”çš„è§†å›¾ï¼Œä¾‹å¦‚ï¼šThymeleafViewã€InternalResourceViewã€RedirectView</p><ul><li>Viewï¼š<strong>è§†å›¾</strong></li></ul><p>ä½œç”¨ï¼šå°†æ¨¡å‹æ•°æ®é€šè¿‡é¡µé¢å±•ç¤ºç»™ç”¨æˆ·</p><h3 id="2ã€â˜…DispatcherServletåˆå§‹åŒ–è¿‡ç¨‹"><a href="#2ã€â˜…DispatcherServletåˆå§‹åŒ–è¿‡ç¨‹" class="headerlink" title="2ã€â˜…DispatcherServletåˆå§‹åŒ–è¿‡ç¨‹"></a>2ã€â˜…DispatcherServletåˆå§‹åŒ–è¿‡ç¨‹</h3><p>DispatcherServlet æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª Servletï¼Œæ‰€ä»¥å¤©ç„¶çš„éµå¾ª Servlet çš„ç”Ÿå‘½å‘¨æœŸã€‚æ‰€ä»¥å®è§‚ä¸Šæ˜¯ Servlet ç”Ÿå‘½å‘¨æœŸæ¥è¿›è¡Œè°ƒåº¦ã€‚</p><img src="/2023/10/06/SpringMVC/img005.png" class title="images"><h5 id="a-åˆå§‹åŒ–WebApplicationContext"><a href="#a-åˆå§‹åŒ–WebApplicationContext" class="headerlink" title="a&gt;åˆå§‹åŒ–WebApplicationContext"></a>a&gt;åˆå§‹åŒ–WebApplicationContext</h5><p>æ‰€åœ¨ç±»ï¼šorg.springframework.web.servlet.FrameworkServlet</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> WebApplicationContext <span class="title function_">initWebApplicationContext</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">WebApplicationContext</span> <span class="variable">rootContext</span> <span class="operator">=</span></span><br><span class="line">        WebApplicationContextUtils.getWebApplicationContext(getServletContext());</span><br><span class="line">    <span class="type">WebApplicationContext</span> <span class="variable">wac</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.webApplicationContext != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// A context instance was injected at construction time -&gt; use it </span></span><br><span class="line">        <span class="comment">// è¯‘:ä½¿ç”¨å®ƒ -&gt; åœ¨æ„é€ æ—¶æ³¨å…¥äº†ä¸Šä¸‹æ–‡å®ä¾‹</span></span><br><span class="line">        wac = <span class="built_in">this</span>.webApplicationContext;</span><br><span class="line">        <span class="keyword">if</span> (wac <span class="keyword">instanceof</span> ConfigurableWebApplicationContext) &#123;</span><br><span class="line">            <span class="type">ConfigurableWebApplicationContext</span> <span class="variable">cwac</span> <span class="operator">=</span> (ConfigurableWebApplicationContext) wac;</span><br><span class="line">            <span class="keyword">if</span> (!cwac.isActive()) &#123;</span><br><span class="line">                <span class="comment">// The context has not yet been refreshed -&gt; provide services such as</span></span><br><span class="line">                <span class="comment">// ä¸Šä¸‹æ–‡å°šæœªåˆ·æ–°-&gt;æä¾›æœåŠ¡ï¼Œå¦‚</span></span><br><span class="line">                <span class="comment">// setting the parent context, setting the application context id, etc</span></span><br><span class="line">                <span class="comment">// è®¾ç½®çˆ¶ä¸Šä¸‹æ–‡ï¼Œè®¾ç½®åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡idï¼Œç­‰ç­‰</span></span><br><span class="line">                <span class="keyword">if</span> (cwac.getParent() == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// The context instance was injected without an explicit parent -&gt; set</span></span><br><span class="line">                    <span class="comment">// åœ¨æ²¡æœ‰æ˜¾å¼çš„çˆ¶å®¹å™¨-&gt;è®¾ç½®çš„æƒ…å†µä¸‹æ³¨å…¥ä¸Šä¸‹æ–‡å®ä¾‹</span></span><br><span class="line">                    <span class="comment">// the root application context (if any; may be null) as the parent</span></span><br><span class="line">                    <span class="comment">// æ ¹åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡(å¦‚æœæœ‰çš„è¯;å¯èƒ½æ˜¯ç©ºçš„)ä½œä¸ºçˆ¶å®¹å™¨</span></span><br><span class="line">                    cwac.setParent(rootContext);</span><br><span class="line">                &#125;</span><br><span class="line">                configureAndRefreshWebApplicationContext(cwac);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (wac == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// No context instance was injected at construction time -&gt; see if one</span></span><br><span class="line">        <span class="comment">// has been registered in the servlet context. If one exists, it is assumed</span></span><br><span class="line">        <span class="comment">// that the parent context (if any) has already been set and that the</span></span><br><span class="line">        <span class="comment">// user has performed any initialization such as setting the context id</span></span><br><span class="line">        wac = findWebApplicationContext();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (wac == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// No context instance is defined for this servlet -&gt; create a local one</span></span><br><span class="line">        <span class="comment">// b&gt;åˆ›å»ºWebApplicationContext</span></span><br><span class="line">        wac = createWebApplicationContext(rootContext);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.refreshEventReceived) &#123;</span><br><span class="line">        <span class="comment">// Either the context is not a ConfigurableApplicationContext with refresh</span></span><br><span class="line">        <span class="comment">// support or the context injected at construction time had already been</span></span><br><span class="line">        <span class="comment">// refreshed -&gt; trigger initial onRefresh manually here.</span></span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="built_in">this</span>.onRefreshMonitor) &#123;</span><br><span class="line">            <span class="comment">// åˆ·æ–°WebApplicationContext</span></span><br><span class="line">            onRefresh(wac);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.publishContext) &#123;</span><br><span class="line">        <span class="comment">// Publish the context as a servlet context attribute.</span></span><br><span class="line">        <span class="comment">// å°†IOCå®¹å™¨åœ¨åº”ç”¨åŸŸå…±äº«</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">attrName</span> <span class="operator">=</span> getServletContextAttributeName();</span><br><span class="line">        getServletContext().setAttribute(attrName, wac);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wac;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="b-åˆ›å»ºWebApplicationContext"><a href="#b-åˆ›å»ºWebApplicationContext" class="headerlink" title="b&gt;åˆ›å»ºWebApplicationContext"></a>b&gt;åˆ›å»ºWebApplicationContext</h5><p>æ‰€åœ¨ç±»ï¼šorg.springframework.web.servlet.FrameworkServlet</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> WebApplicationContext <span class="title function_">createWebApplicationContext</span><span class="params">(<span class="meta">@Nullable</span> ApplicationContext parent)</span> &#123;</span><br><span class="line">    Class&lt;?&gt; contextClass = getContextClass();</span><br><span class="line">    <span class="keyword">if</span> (!ConfigurableWebApplicationContext.class.isAssignableFrom(contextClass)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ApplicationContextException</span>(</span><br><span class="line">            <span class="string">&quot;Fatal initialization error in servlet with name &#x27;&quot;</span> + getServletName() +</span><br><span class="line">            <span class="string">&quot;&#x27;: custom WebApplicationContext class [&quot;</span> + contextClass.getName() +</span><br><span class="line">            <span class="string">&quot;] is not of type ConfigurableWebApplicationContext&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é€šè¿‡åå°„åˆ›å»º IOC å®¹å™¨å¯¹è±¡</span></span><br><span class="line">    <span class="type">ConfigurableWebApplicationContext</span> <span class="variable">wac</span> <span class="operator">=</span></span><br><span class="line">        (ConfigurableWebApplicationContext) BeanUtils.instantiateClass(contextClass);</span><br><span class="line"></span><br><span class="line">    wac.setEnvironment(getEnvironment());</span><br><span class="line">    <span class="comment">// è®¾ç½®çˆ¶å®¹å™¨ è®¾ç½®springçš„å®¹å™¨ä¸ºSpringMVCçš„çˆ¶å®¹å™¨</span></span><br><span class="line">    wac.setParent(parent);</span><br><span class="line">    <span class="type">String</span> <span class="variable">configLocation</span> <span class="operator">=</span> getContextConfigLocation();</span><br><span class="line">    <span class="keyword">if</span> (configLocation != <span class="literal">null</span>) &#123;</span><br><span class="line">        wac.setConfigLocation(configLocation);</span><br><span class="line">    &#125;</span><br><span class="line">    configureAndRefreshWebApplicationContext(wac);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> wac;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="c-DispatcherServletåˆå§‹åŒ–ç­–ç•¥"><a href="#c-DispatcherServletåˆå§‹åŒ–ç­–ç•¥" class="headerlink" title="c&gt;DispatcherServletåˆå§‹åŒ–ç­–ç•¥"></a>c&gt;DispatcherServletåˆå§‹åŒ–ç­–ç•¥</h5><p>FrameworkServletåˆ›å»ºWebApplicationContextåï¼Œåˆ·æ–°å®¹å™¨ï¼Œè°ƒç”¨onRefresh(wac)ï¼Œæ­¤æ–¹æ³•åœ¨DispatcherServletä¸­è¿›è¡Œäº†é‡å†™ï¼Œè°ƒç”¨äº†initStrategies(context)æ–¹æ³•ï¼Œåˆå§‹åŒ–ç­–ç•¥ï¼Œå³åˆå§‹åŒ–DispatcherServletçš„å„ä¸ªç»„ä»¶</p><p>æ‰€åœ¨ç±»ï¼šorg.springframework.web.servlet.DispatcherServlet</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">initStrategies</span><span class="params">(ApplicationContext context)</span> &#123;</span><br><span class="line">   initMultipartResolver(context);</span><br><span class="line">   initLocaleResolver(context);</span><br><span class="line">   initThemeResolver(context);</span><br><span class="line">   initHandlerMappings(context);</span><br><span class="line">   initHandlerAdapters(context);</span><br><span class="line">   initHandlerExceptionResolvers(context);</span><br><span class="line">   initRequestToViewNameTranslator(context);</span><br><span class="line">   initViewResolvers(context);</span><br><span class="line">   initFlashMapManager(context);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€â˜…DispatcherServletè°ƒç”¨ç»„ä»¶å¤„ç†è¯·æ±‚"><a href="#3ã€â˜…DispatcherServletè°ƒç”¨ç»„ä»¶å¤„ç†è¯·æ±‚" class="headerlink" title="3ã€â˜…DispatcherServletè°ƒç”¨ç»„ä»¶å¤„ç†è¯·æ±‚"></a>3ã€â˜…DispatcherServletè°ƒç”¨ç»„ä»¶å¤„ç†è¯·æ±‚</h3><h5 id="a-processRequest"><a href="#a-processRequest" class="headerlink" title="a&gt;processRequest()"></a>a&gt;processRequest()</h5><p>FrameworkServleté‡å†™HttpServletä¸­çš„service()å’ŒdoXxx()ï¼Œè¿™äº›æ–¹æ³•ä¸­è°ƒç”¨äº†processRequest(request, response)</p><p>æ‰€åœ¨ç±»ï¼šorg.springframework.web.servlet.FrameworkServlet</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">processRequest</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line">    <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    <span class="type">Throwable</span> <span class="variable">failureCause</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">LocaleContext</span> <span class="variable">previousLocaleContext</span> <span class="operator">=</span> LocaleContextHolder.getLocaleContext();</span><br><span class="line">    <span class="type">LocaleContext</span> <span class="variable">localeContext</span> <span class="operator">=</span> buildLocaleContext(request);</span><br><span class="line"></span><br><span class="line">    <span class="type">RequestAttributes</span> <span class="variable">previousAttributes</span> <span class="operator">=</span> RequestContextHolder.getRequestAttributes();</span><br><span class="line">    <span class="type">ServletRequestAttributes</span> <span class="variable">requestAttributes</span> <span class="operator">=</span> buildRequestAttributes(request, response, previousAttributes);</span><br><span class="line"></span><br><span class="line">    <span class="type">WebAsyncManager</span> <span class="variable">asyncManager</span> <span class="operator">=</span> WebAsyncUtils.getAsyncManager(request);</span><br><span class="line">    asyncManager.registerCallableInterceptor(FrameworkServlet.class.getName(), <span class="keyword">new</span> <span class="title class_">RequestBindingInterceptor</span>());</span><br><span class="line"></span><br><span class="line">    initContextHolders(request, localeContext, requestAttributes);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">// æ‰§è¡ŒæœåŠ¡ï¼ŒdoService()æ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œåœ¨DispatcherServletä¸­è¿›è¡Œäº†é‡å†™</span></span><br><span class="line">        doService(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (ServletException | IOException ex) &#123;</span><br><span class="line">        failureCause = ex;</span><br><span class="line">        <span class="keyword">throw</span> ex;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">        failureCause = ex;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NestedServletException</span>(<span class="string">&quot;Request processing failed&quot;</span>, ex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">finally</span> &#123;</span><br><span class="line">        resetContextHolders(request, previousLocaleContext, previousAttributes);</span><br><span class="line">        <span class="keyword">if</span> (requestAttributes != <span class="literal">null</span>) &#123;</span><br><span class="line">            requestAttributes.requestCompleted();</span><br><span class="line">        &#125;</span><br><span class="line">        logResult(request, response, failureCause, asyncManager);</span><br><span class="line">        publishRequestHandledEvent(request, response, startTime, failureCause);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="b-doService"><a href="#b-doService" class="headerlink" title="b&gt;doService()"></a>b&gt;doService()</h5><p>æ‰€åœ¨ç±»ï¼šorg.springframework.web.servlet.DispatcherServlet</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doService</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    logRequest(request);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Keep a snapshot of the request attributes in case of an include,</span></span><br><span class="line">    <span class="comment">// to be able to restore the original attributes after the include.</span></span><br><span class="line">    Map&lt;String, Object&gt; attributesSnapshot = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (WebUtils.isIncludeRequest(request)) &#123;</span><br><span class="line">        attributesSnapshot = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        Enumeration&lt;?&gt; attrNames = request.getAttributeNames();</span><br><span class="line">        <span class="keyword">while</span> (attrNames.hasMoreElements()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">attrName</span> <span class="operator">=</span> (String) attrNames.nextElement();</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.cleanupAfterInclude || attrName.startsWith(DEFAULT_STRATEGIES_PREFIX)) &#123;</span><br><span class="line">                attributesSnapshot.put(attrName, request.getAttribute(attrName));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Make framework objects available to handlers and view objects.</span></span><br><span class="line">    request.setAttribute(WEB_APPLICATION_CONTEXT_ATTRIBUTE, getWebApplicationContext());</span><br><span class="line">    request.setAttribute(LOCALE_RESOLVER_ATTRIBUTE, <span class="built_in">this</span>.localeResolver);</span><br><span class="line">    request.setAttribute(THEME_RESOLVER_ATTRIBUTE, <span class="built_in">this</span>.themeResolver);</span><br><span class="line">    request.setAttribute(THEME_SOURCE_ATTRIBUTE, getThemeSource());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.flashMapManager != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">FlashMap</span> <span class="variable">inputFlashMap</span> <span class="operator">=</span> <span class="built_in">this</span>.flashMapManager.retrieveAndUpdate(request, response);</span><br><span class="line">        <span class="keyword">if</span> (inputFlashMap != <span class="literal">null</span>) &#123;</span><br><span class="line">            request.setAttribute(INPUT_FLASH_MAP_ATTRIBUTE, Collections.unmodifiableMap(inputFlashMap));</span><br><span class="line">        &#125;</span><br><span class="line">        request.setAttribute(OUTPUT_FLASH_MAP_ATTRIBUTE, <span class="keyword">new</span> <span class="title class_">FlashMap</span>());</span><br><span class="line">        request.setAttribute(FLASH_MAP_MANAGER_ATTRIBUTE, <span class="built_in">this</span>.flashMapManager);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">RequestPath</span> <span class="variable">requestPath</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.parseRequestPath &amp;&amp; !ServletRequestPathUtils.hasParsedRequestPath(request)) &#123;</span><br><span class="line">        requestPath = ServletRequestPathUtils.parseAndCache(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// å¤„ç†è¯·æ±‚å’Œå“åº”</span></span><br><span class="line">        doDispatch(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!WebAsyncUtils.getAsyncManager(request).isConcurrentHandlingStarted()) &#123;</span><br><span class="line">            <span class="comment">// Restore the original attribute snapshot, in case of an include.</span></span><br><span class="line">            <span class="keyword">if</span> (attributesSnapshot != <span class="literal">null</span>) &#123;</span><br><span class="line">                restoreAttributesAfterInclude(request, attributesSnapshot);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (requestPath != <span class="literal">null</span>) &#123;</span><br><span class="line">            ServletRequestPathUtils.clearParsedRequestPath(request);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="c-doDispatch"><a href="#c-doDispatch" class="headerlink" title="c&gt;doDispatch()"></a>c&gt;doDispatch()</h5><p>æ‰€åœ¨ç±»ï¼šorg.springframework.web.servlet.DispatcherServlet</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doDispatch</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">HttpServletRequest</span> <span class="variable">processedRequest</span> <span class="operator">=</span> request;</span><br><span class="line">    <span class="type">HandlerExecutionChain</span> <span class="variable">mappedHandler</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">multipartRequestParsed</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">WebAsyncManager</span> <span class="variable">asyncManager</span> <span class="operator">=</span> WebAsyncUtils.getAsyncManager(request);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">ModelAndView</span> <span class="variable">mv</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">Exception</span> <span class="variable">dispatchException</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            processedRequest = checkMultipart(request);</span><br><span class="line">            multipartRequestParsed = (processedRequest != request);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Determine handler for the current request.</span></span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">            mappedHandlerï¼šè°ƒç”¨é“¾</span></span><br><span class="line"><span class="comment">                åŒ…å«handlerã€interceptorListã€interceptorIndex</span></span><br><span class="line"><span class="comment">            handlerï¼šæµè§ˆå™¨å‘é€çš„è¯·æ±‚æ‰€åŒ¹é…çš„æ§åˆ¶å™¨æ–¹æ³•</span></span><br><span class="line"><span class="comment">            interceptorListï¼šå¤„ç†æ§åˆ¶å™¨æ–¹æ³•çš„æ‰€æœ‰æ‹¦æˆªå™¨é›†åˆ</span></span><br><span class="line"><span class="comment">            interceptorIndexï¼šæ‹¦æˆªå™¨ç´¢å¼•ï¼Œæ§åˆ¶æ‹¦æˆªå™¨afterCompletion()çš„æ‰§è¡Œ</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">            mappedHandler = getHandler(processedRequest);</span><br><span class="line">            <span class="keyword">if</span> (mappedHandler == <span class="literal">null</span>) &#123;</span><br><span class="line">                noHandlerFound(processedRequest, response);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Determine handler adapter for the current request.</span></span><br><span class="line">           <span class="comment">// é€šè¿‡æ§åˆ¶å™¨æ–¹æ³•åˆ›å»ºç›¸åº”çš„å¤„ç†å™¨é€‚é…å™¨ï¼Œè°ƒç”¨æ‰€å¯¹åº”çš„æ§åˆ¶å™¨æ–¹æ³•</span></span><br><span class="line">            <span class="type">HandlerAdapter</span> <span class="variable">ha</span> <span class="operator">=</span> getHandlerAdapter(mappedHandler.getHandler());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Process last-modified header, if supported by the handler.</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> request.getMethod();</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">isGet</span> <span class="operator">=</span> <span class="string">&quot;GET&quot;</span>.equals(method);</span><br><span class="line">            <span class="keyword">if</span> (isGet || <span class="string">&quot;HEAD&quot;</span>.equals(method)) &#123;</span><br><span class="line">                <span class="type">long</span> <span class="variable">lastModified</span> <span class="operator">=</span> ha.getLastModified(request, mappedHandler.getHandler());</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">new</span> <span class="title class_">ServletWebRequest</span>(request, response).checkNotModified(lastModified) &amp;&amp; isGet) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è°ƒç”¨æ‹¦æˆªå™¨çš„preHandle()</span></span><br><span class="line">            <span class="keyword">if</span> (!mappedHandler.applyPreHandle(processedRequest, response)) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Actually invoke the handler.</span></span><br><span class="line">            <span class="comment">// ç”±å¤„ç†å™¨é€‚é…å™¨è°ƒç”¨å…·ä½“çš„æ§åˆ¶å™¨æ–¹æ³•ï¼Œæœ€ç»ˆè·å¾—ModelAndViewå¯¹è±¡</span></span><br><span class="line">            mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (asyncManager.isConcurrentHandlingStarted()) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            applyDefaultViewName(processedRequest, mv);</span><br><span class="line">            <span class="comment">// è°ƒç”¨æ‹¦æˆªå™¨çš„postHandle()</span></span><br><span class="line">            mappedHandler.applyPostHandle(processedRequest, response, mv);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            dispatchException = ex;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Throwable err) &#123;</span><br><span class="line">            <span class="comment">// As of 4.3, we&#x27;re processing Errors thrown from handler methods as well,</span></span><br><span class="line">            <span class="comment">// making them available for @ExceptionHandler methods and other scenarios.</span></span><br><span class="line">            dispatchException = <span class="keyword">new</span> <span class="title class_">NestedServletException</span>(<span class="string">&quot;Handler dispatch failed&quot;</span>, err);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// åç»­å¤„ç†ï¼šå¤„ç†æ¨¡å‹æ•°æ®å’Œæ¸²æŸ“è§†å›¾</span></span><br><span class="line">        processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">        triggerAfterCompletion(processedRequest, response, mappedHandler, ex);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Throwable err) &#123;</span><br><span class="line">        triggerAfterCompletion(processedRequest, response, mappedHandler,</span><br><span class="line">                               <span class="keyword">new</span> <span class="title class_">NestedServletException</span>(<span class="string">&quot;Handler processing failed&quot;</span>, err));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (asyncManager.isConcurrentHandlingStarted()) &#123;</span><br><span class="line">            <span class="comment">// Instead of postHandle and afterCompletion</span></span><br><span class="line">            <span class="keyword">if</span> (mappedHandler != <span class="literal">null</span>) &#123;</span><br><span class="line">                mappedHandler.applyAfterConcurrentHandlingStarted(processedRequest, response);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Clean up any resources used by a multipart request.</span></span><br><span class="line">            <span class="keyword">if</span> (multipartRequestParsed) &#123;</span><br><span class="line">                cleanupMultipart(processedRequest);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="d-processDispatchResult"><a href="#d-processDispatchResult" class="headerlink" title="d&gt;processDispatchResult()"></a>d&gt;processDispatchResult()</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">processDispatchResult</span><span class="params">(HttpServletRequest request, HttpServletResponse response,</span></span><br><span class="line"><span class="params">                                   <span class="meta">@Nullable</span> HandlerExecutionChain mappedHandler, <span class="meta">@Nullable</span> ModelAndView mv,</span></span><br><span class="line"><span class="params">                                   <span class="meta">@Nullable</span> Exception exception)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">errorView</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (exception != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (exception <span class="keyword">instanceof</span> ModelAndViewDefiningException) &#123;</span><br><span class="line">            logger.debug(<span class="string">&quot;ModelAndViewDefiningException encountered&quot;</span>, exception);</span><br><span class="line">            mv = ((ModelAndViewDefiningException) exception).getModelAndView();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">handler</span> <span class="operator">=</span> (mappedHandler != <span class="literal">null</span> ? mappedHandler.getHandler() : <span class="literal">null</span>);</span><br><span class="line">            mv = processHandlerException(request, response, handler, exception);</span><br><span class="line">            errorView = (mv != <span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Did the handler return a view to render?</span></span><br><span class="line">    <span class="keyword">if</span> (mv != <span class="literal">null</span> &amp;&amp; !mv.wasCleared()) &#123;</span><br><span class="line">        <span class="comment">// å¤„ç†æ¨¡å‹æ•°æ®å’Œæ¸²æŸ“è§†å›¾</span></span><br><span class="line">        render(mv, request, response);</span><br><span class="line">        <span class="keyword">if</span> (errorView) &#123;</span><br><span class="line">            WebUtils.clearErrorRequestAttributes(request);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">            logger.trace(<span class="string">&quot;No view rendering, null ModelAndView returned.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (WebAsyncUtils.getAsyncManager(request).isConcurrentHandlingStarted()) &#123;</span><br><span class="line">        <span class="comment">// Concurrent handling started during a forward</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (mappedHandler != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// Exception (if any) is already handled..</span></span><br><span class="line">        <span class="comment">// è°ƒç”¨æ‹¦æˆªå™¨çš„afterCompletion()</span></span><br><span class="line">        mappedHandler.triggerAfterCompletion(request, response, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4ã€â˜…SpringMVCçš„æ‰§è¡Œæµç¨‹"><a href="#4ã€â˜…SpringMVCçš„æ‰§è¡Œæµç¨‹" class="headerlink" title="4ã€â˜…SpringMVCçš„æ‰§è¡Œæµç¨‹"></a>4ã€â˜…SpringMVCçš„æ‰§è¡Œæµç¨‹</h3><ol><li><p>ç”¨æˆ·å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œè¯·æ±‚è¢«SpringMVC å‰ç«¯æ§åˆ¶å™¨ DispatcherServletæ•è·ã€‚</p></li><li><p>DispatcherServletå¯¹è¯·æ±‚URLè¿›è¡Œè§£æï¼Œå¾—åˆ°è¯·æ±‚èµ„æºæ ‡è¯†ç¬¦ï¼ˆURIï¼‰ï¼Œåˆ¤æ–­è¯·æ±‚URIå¯¹åº”çš„æ˜ å°„ï¼š</p></li></ol><p>a) ä¸å­˜åœ¨</p><p>i. å†åˆ¤æ–­æ˜¯å¦é…ç½®äº†mvc:default-servlet-handler</p><p>ii. å¦‚æœæ²¡é…ç½®ï¼Œåˆ™æ§åˆ¶å°æŠ¥æ˜ å°„æŸ¥æ‰¾ä¸åˆ°ï¼Œå®¢æˆ·ç«¯å±•ç¤º404é”™è¯¯</p><p>iii. å¦‚æœæœ‰é…ç½®ï¼Œåˆ™è®¿é—®ç›®æ ‡èµ„æºï¼ˆä¸€èˆ¬ä¸ºé™æ€èµ„æºï¼Œå¦‚ï¼šJS,CSS,HTMLï¼‰ï¼Œæ‰¾ä¸åˆ°å®¢æˆ·ç«¯ä¹Ÿä¼šå±•ç¤º404é”™è¯¯</p><p>b) å­˜åœ¨åˆ™æ‰§è¡Œä¸‹é¢çš„æµç¨‹</p><ol start="3"><li><p>æ ¹æ®è¯¥URIï¼Œè°ƒç”¨HandlerMappingè·å¾—è¯¥Handleré…ç½®çš„æ‰€æœ‰ç›¸å…³çš„å¯¹è±¡ï¼ˆåŒ…æ‹¬Handlerå¯¹è±¡ä»¥åŠHandlerå¯¹è±¡å¯¹åº”çš„æ‹¦æˆªå™¨ -&gt; handlerChainï¼‰ï¼Œæœ€åä»¥HandlerExecutionChainæ‰§è¡Œé“¾å¯¹è±¡çš„å½¢å¼è¿”å›ã€‚</p></li><li><p>DispatcherServlet æ ¹æ®è·å¾—çš„Handlerï¼Œé€‰æ‹©ä¸€ä¸ªåˆé€‚çš„HandlerAdapterã€‚</p></li><li><p>å¦‚æœæˆåŠŸè·å¾—HandlerAdapterï¼Œæ­¤æ—¶å°†å¼€å§‹æ‰§è¡Œæ‹¦æˆªå™¨çš„preHandler(â€¦)æ–¹æ³•ã€æ­£å‘æ‰§è¡Œã€‘</p></li><li><p>æå–Requestä¸­çš„æ¨¡å‹æ•°æ®ï¼Œå¡«å……Handlerå…¥å‚ï¼Œå¼€å§‹æ‰§è¡ŒHandlerï¼ˆController)æ–¹æ³•ï¼Œå¤„ç†è¯·æ±‚ã€‚åœ¨å¡«å……Handlerçš„å…¥å‚è¿‡ç¨‹ä¸­ï¼Œæ ¹æ®ä½ çš„é…ç½®ï¼ŒSpringå°†å¸®ä½ åšä¸€äº›é¢å¤–çš„å·¥ä½œï¼š</p></li></ol><p>a) HttpMessageConveterï¼š å°†è¯·æ±‚æ¶ˆæ¯ï¼ˆå¦‚Jsonã€xmlç­‰æ•°æ®ï¼‰è½¬æ¢æˆä¸€ä¸ªå¯¹è±¡ï¼Œå°†å¯¹è±¡è½¬æ¢ä¸ºæŒ‡å®šçš„å“åº”ä¿¡æ¯</p><p>b) æ•°æ®è½¬æ¢ï¼šå¯¹è¯·æ±‚æ¶ˆæ¯è¿›è¡Œæ•°æ®è½¬æ¢ã€‚å¦‚Stringè½¬æ¢æˆIntegerã€Doubleç­‰</p><p>c) æ•°æ®æ ¼å¼åŒ–ï¼šå¯¹è¯·æ±‚æ¶ˆæ¯è¿›è¡Œæ•°æ®æ ¼å¼åŒ–ã€‚ å¦‚å°†å­—ç¬¦ä¸²è½¬æ¢æˆæ ¼å¼åŒ–æ•°å­—æˆ–æ ¼å¼åŒ–æ—¥æœŸç­‰</p><p>d) æ•°æ®éªŒè¯ï¼š éªŒè¯æ•°æ®çš„æœ‰æ•ˆæ€§ï¼ˆé•¿åº¦ã€æ ¼å¼ç­‰ï¼‰ï¼ŒéªŒè¯ç»“æœå­˜å‚¨åˆ°BindingResultæˆ–Errorä¸­</p><ol start="7"><li><p>Handleræ‰§è¡Œå®Œæˆåï¼Œå‘DispatcherServlet è¿”å›ä¸€ä¸ªModelAndViewå¯¹è±¡ã€‚</p></li><li><p>æ­¤æ—¶å°†å¼€å§‹æ‰§è¡Œæ‹¦æˆªå™¨çš„postHandle(â€¦)æ–¹æ³•ã€é€†å‘ã€‘ã€‚</p></li><li><p>æ ¹æ®è¿”å›çš„ModelAndViewï¼ˆæ­¤æ—¶ä¼šåˆ¤æ–­æ˜¯å¦å­˜åœ¨å¼‚å¸¸ï¼šå¦‚æœå­˜åœ¨å¼‚å¸¸ï¼Œåˆ™æ‰§è¡ŒHandlerExceptionResolverè¿›è¡Œå¼‚å¸¸å¤„ç†ï¼‰é€‰æ‹©ä¸€ä¸ªé€‚åˆçš„ViewResolverè¿›è¡Œè§†å›¾è§£æï¼Œæ ¹æ®Modelå’ŒViewï¼Œæ¥æ¸²æŸ“è§†å›¾ã€‚</p></li><li><p>æ¸²æŸ“è§†å›¾å®Œæ¯•æ‰§è¡Œæ‹¦æˆªå™¨çš„afterCompletion(â€¦)æ–¹æ³•ã€é€†å‘ã€‘ã€‚</p></li><li><p>å°†æ¸²æŸ“ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> åç«¯ </tag>
            
            <tag> SpringMVC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis</title>
      <link href="/2023/10/05/Redis/"/>
      <url>/2023/10/05/Redis/</url>
      
        <content type="html"><![CDATA[<h2 id="Redisçš„å‘å¸ƒå’Œè®¢é˜…"><a href="#Redisçš„å‘å¸ƒå’Œè®¢é˜…" class="headerlink" title="Redisçš„å‘å¸ƒå’Œè®¢é˜…"></a>Redisçš„å‘å¸ƒå’Œè®¢é˜…</h2><h3 id="ä»€ä¹ˆæ˜¯å‘å¸ƒå’Œè®¢é˜…"><a href="#ä»€ä¹ˆæ˜¯å‘å¸ƒå’Œè®¢é˜…" class="headerlink" title="ä»€ä¹ˆæ˜¯å‘å¸ƒå’Œè®¢é˜…"></a>ä»€ä¹ˆæ˜¯å‘å¸ƒå’Œè®¢é˜…</h3><p>Redis å‘å¸ƒè®¢é˜… (pub&#x2F;sub) æ˜¯ä¸€ç§<wavy>æ¶ˆæ¯é€šä¿¡æ¨¡å¼</wavy>ï¼šå‘é€è€… (pub) å‘é€æ¶ˆæ¯ï¼Œè®¢é˜…è€… (sub) æ¥æ”¶æ¶ˆæ¯ã€‚</p><p>Redis å®¢æˆ·ç«¯å¯ä»¥è®¢é˜…ä»»æ„æ•°é‡çš„é¢‘é“</p><h3 id="å‘å¸ƒå’Œè®¢é˜…"><a href="#å‘å¸ƒå’Œè®¢é˜…" class="headerlink" title="å‘å¸ƒå’Œè®¢é˜…"></a>å‘å¸ƒå’Œè®¢é˜…</h3><ol><li>å®¢æˆ·ç«¯å¯ä»¥è®¢é˜…é¢‘é“å¦‚ä¸‹å›¾</li></ol><p>â€‹                               <img src="/2023/10/05/Redis/image-20231021201021063.png" class title="image-20231021201021063"></p><ol start="2"><li>å½“ç»™è¿™ä¸ªé¢‘é“å‘å¸ƒæ¶ˆæ¯åï¼Œæ¶ˆæ¯å°±ä¼šå‘é€ç»™è®¢é˜…çš„å®¢æˆ·ç«¯</li></ol> <img src="/2023/10/05/Redis/image-20231021201100483.png" class title="image-20231021201100483"><h3 id="å‘å¸ƒè®¢é˜…å‘½ä»¤è¡Œå®ç°"><a href="#å‘å¸ƒè®¢é˜…å‘½ä»¤è¡Œå®ç°" class="headerlink" title="å‘å¸ƒè®¢é˜…å‘½ä»¤è¡Œå®ç°"></a>å‘å¸ƒè®¢é˜…å‘½ä»¤è¡Œå®ç°</h3><ol><li>æ‰“å¼€ä¸€ä¸ªå®¢æˆ·ç«¯è®¢é˜… channel1</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SUBSCRIBE channel1</span><br></pre></td></tr></table></figure><p>å…¶ä¸­å¯ä»¥åœ¨æ§åˆ¶å°çœ‹åˆ°å¦‚ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; SUBSCRIBE channel1</span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line">1) &quot;subscribe&quot;</span><br><span class="line">2) &quot;channel1&quot;</span><br><span class="line">3) (integer) 1</span><br></pre></td></tr></table></figure><ol start="2"><li>æ‰“å¼€å¦å¤–ä¸€ä¸ªå®¢æˆ·ç«¯, ç»™channel1å‘å¸ƒæ¶ˆæ¯ hello</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">publish channel1 hello</span><br></pre></td></tr></table></figure><p>å½“å‰å®¢æˆ·ç«¯ä¼šåé¦ˆ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; publish channel1 hello</span><br><span class="line">(integer) 1   # è¿”å›çš„1æ˜¯è®¢é˜…è€…æ•°é‡</span><br></pre></td></tr></table></figure><ol start="3"><li>è®¢é˜…å®¢æˆ·ç«¯å¯ä»¥çœ‹åˆ°å‘é€çš„æ¶ˆæ¯</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; SUBSCRIBE channel1</span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line">1) &quot;subscribe&quot;</span><br><span class="line">2) &quot;channel1&quot;</span><br><span class="line">3) (integer) 1</span><br><span class="line">1) &quot;message&quot;</span><br><span class="line">2) &quot;channel1&quot;</span><br><span class="line">3) &quot;hello&quot;  # åˆšåˆšå‘å¸ƒçš„ä¿¡æ¯</span><br></pre></td></tr></table></figure><blockquote><p> æ³¨ï¼šå‘å¸ƒçš„æ¶ˆæ¯æ²¡æœ‰æŒä¹…åŒ–ï¼Œå¦‚æœåœ¨è®¢é˜…çš„å®¢æˆ·ç«¯æ”¶ä¸åˆ°helloï¼Œåªèƒ½æ”¶åˆ°è®¢é˜…åå‘å¸ƒçš„æ¶ˆæ¯</p></blockquote><h2 id="Redisçš„æ–°æ•°æ®ç±»å‹"><a href="#Redisçš„æ–°æ•°æ®ç±»å‹" class="headerlink" title="Redisçš„æ–°æ•°æ®ç±»å‹"></a>Redisçš„æ–°æ•°æ®ç±»å‹</h2><h3 id="Bitmapsä½å›¾"><a href="#Bitmapsä½å›¾" class="headerlink" title="Bitmapsä½å›¾"></a>Bitmapsä½å›¾</h3><h4 id="setbit"><a href="#setbit" class="headerlink" title="setbit"></a><code>setbit</code></h4><p>setbit<key><offset><value>è®¾ç½®Bitmapsä¸­æŸä¸ªåç§»é‡çš„å€¼ï¼ˆ0æˆ–1ï¼‰</value></offset></key></p><p>*offset:åç§»é‡ä»0å¼€å§‹</p><p>å®ä¾‹:  æ¯ä¸ªç‹¬ç«‹ç”¨æˆ·æ˜¯å¦è®¿é—®è¿‡ç½‘ç«™å­˜æ”¾åœ¨Bitmapsä¸­ï¼Œ å°†è®¿é—®çš„ç”¨æˆ·è®°åš1ï¼Œ æ²¡æœ‰è®¿é—®çš„ç”¨æˆ·è®°åš0ï¼Œ ç”¨åç§»é‡ä½œä¸ºç”¨æˆ·çš„idã€‚</p><p>è®¾ç½®é”®çš„ç¬¬offsetä¸ªä½çš„å€¼ï¼ˆä»0ç®—èµ·ï¼‰ ï¼Œ å‡è®¾ç°åœ¨æœ‰6ä¸ªç”¨æˆ·ï¼Œuserid&#x3D;1ï¼Œ 3ï¼Œ 5 çš„ç”¨æˆ·å¯¹ç½‘ç«™è¿›è¡Œäº†è®¿é—®ï¼Œ é‚£ä¹ˆå½“å‰Bitmapsåˆå§‹åŒ–ç»“æœå¦‚å›¾</p><table><thead><tr><th align="center">Bitmaps</th><th align="center">0</th><th align="center">1</th><th align="center">0</th><th align="center">1</th><th align="center">0</th><th align="center">1</th></tr></thead><tbody><tr><td align="center">ç”¨æˆ·</td><td align="center">0</td><td align="center">1</td><td align="center">2</td><td align="center">3</td><td align="center">4</td><td align="center">5</td></tr></tbody></table><blockquote><p> æ³¨: å¾ˆå¤šåº”ç”¨çš„ç”¨æˆ·idä»¥ä¸€ä¸ªæŒ‡å®šæ•°å­—ï¼ˆä¾‹å¦‚10000ï¼‰ å¼€å¤´ï¼Œ ç›´æ¥å°†ç”¨æˆ·idå’ŒBitmapsçš„åç§»é‡å¯¹åº”åŠ¿å¿…ä¼šé€ æˆä¸€å®šçš„æµªè´¹ï¼Œ é€šå¸¸çš„åšæ³•æ˜¯æ¯æ¬¡åšsetbitæ“ä½œæ—¶å°†ç”¨æˆ·idå‡å»è¿™ä¸ªæŒ‡å®šæ•°å­—ã€‚</p><p>åœ¨ç¬¬ä¸€æ¬¡åˆå§‹åŒ–Bitmapsæ—¶ï¼Œ å‡å¦‚åç§»é‡éå¸¸å¤§ï¼Œ é‚£ä¹ˆæ•´ä¸ªåˆå§‹åŒ–è¿‡ç¨‹æ‰§è¡Œä¼šæ¯”è¾ƒæ…¢ï¼Œ å¯èƒ½ä¼šé€ æˆRedisçš„é˜»å¡ã€‚</p></blockquote><h4 id="getbit"><a href="#getbit" class="headerlink" title="getbit"></a><code>getbit</code></h4><p> è·å–Bitmapsä¸­æŸä¸ªåç§»é‡çš„å€¼ : <code>getbit&lt;key&gt;&lt;offset&gt;</code></p><p>ä¾‹å¦‚(å‡å¦‚åˆšåˆšçš„æ¡ˆä¾‹ä¸ºk1): <code>getbit k1 1</code> , é‚£ä¹ˆåˆ™è¿”å›çš„æ˜¯ 1  </p><h4 id="bitcount"><a href="#bitcount" class="headerlink" title="bitcount"></a><code>bitcount</code></h4><p>ç»Ÿè®¡<strong>å­—ç¬¦ä¸²</strong>è¢«è®¾ç½®ä¸º1çš„bitæ•°ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç»™å®šçš„æ•´ä¸ªå­—ç¬¦ä¸²éƒ½ä¼šè¢«è¿›è¡Œè®¡æ•°ï¼Œé€šè¿‡æŒ‡å®šé¢å¤–çš„ start æˆ– end å‚æ•°ï¼Œå¯ä»¥è®©è®¡æ•°åªåœ¨ç‰¹å®šçš„ä½ä¸Šè¿›è¡Œã€‚start å’Œ end å‚æ•°çš„è®¾ç½®ï¼Œéƒ½å¯ä»¥ä½¿ç”¨è´Ÿæ•°å€¼ï¼šæ¯”å¦‚ -1 è¡¨ç¤ºæœ€åä¸€ä¸ªä½ï¼Œè€Œ -2 è¡¨ç¤ºå€’æ•°ç¬¬äºŒä¸ªä½ï¼Œstartã€end æ˜¯æŒ‡bitç»„çš„å­—èŠ‚çš„ä¸‹æ ‡æ•°ï¼ŒäºŒè€…çš†åŒ…å«.</p><p>ç»Ÿè®¡å­—ç¬¦ä¸²ä»startå­—èŠ‚åˆ°endå­—èŠ‚æ¯”ç‰¹å€¼ä¸º1çš„æ•°é‡ : <code>bitcount&lt;key&gt;[start end] </code></p><p>ä¸¾ä¾‹ï¼š K1 ã€01000001 01000000 00000000 00100001ã€‘ï¼Œå¯¹åº”ã€0ï¼Œ1ï¼Œ2ï¼Œ3ã€‘</p><p>bitcount K1 1 2 ï¼š ç»Ÿè®¡ä¸‹æ ‡1ã€2å­—èŠ‚ç»„ä¸­bit&#x3D;1çš„ä¸ªæ•°ï¼Œå³01000000 00000000</p><p>â€“&gt;<code>bitcount K1 1 2</code>ã€€ã€€â€“&gt; 1</p><p>bitcount K1 1 3 ï¼š ç»Ÿè®¡ä¸‹æ ‡1ã€3å­—èŠ‚ç»„ä¸­bit&#x3D;1çš„ä¸ªæ•°ï¼Œå³01000000 00000000 00100001</p><p>â€“&gt;<code> bitcount K1 1 3</code>ã€€ã€€â€“&gt; 3</p><p>bitcount K1 0 -2 ï¼š ç»Ÿè®¡ä¸‹æ ‡0åˆ°ä¸‹æ ‡å€’æ•°ç¬¬2ï¼Œå­—èŠ‚ç»„ä¸­bit&#x3D;1çš„ä¸ªæ•°ï¼Œå³01000001 01000000  00000000</p><p>â€“&gt; <code>bitcount K1 0 -2</code>ã€€ã€€â€“&gt; 3</p><blockquote><p>æ³¨æ„ï¼šredisçš„setbitè®¾ç½®æˆ–æ¸…é™¤çš„æ˜¯bitä½ç½®ï¼Œè€Œbitcountè®¡ç®—çš„æ˜¯byteä½ç½®ã€‚</p></blockquote><h4 id="bitop"><a href="#bitop" class="headerlink" title="bitop"></a><code>bitop</code></h4><p><code>bitop and(or/not/xor) &lt;destkey&gt; [keyâ€¦]</code></p><p>bitopæ˜¯ä¸€ä¸ªå¤åˆæ“ä½œï¼Œ å®ƒå¯ä»¥åšå¤šä¸ªBitmapsçš„andï¼ˆäº¤é›†ï¼‰ ã€ orï¼ˆå¹¶é›†ï¼‰ ã€ notï¼ˆéï¼‰ ã€ xorï¼ˆå¼‚æˆ–ï¼‰ æ“ä½œå¹¶å°†ç»“æœä¿å­˜åœ¨destkeyä¸­ã€‚</p><p>å®ä¾‹ 2020-11-04 æ—¥è®¿é—®ç½‘ç«™çš„userid&#x3D;1,2,5,9ã€‚</p><p>setbit users:20201104 1 1</p><p>setbit users:20201104 2 1</p><p>setbit users:20201104 5 1</p><p>setbit users:20201104 9 1</p><p>2020-11-03 æ—¥è®¿é—®ç½‘ç«™çš„userid&#x3D;0,1,4,9ã€‚</p><p>setbit users:20201103 0 1</p><p>setbit users:20201103 1 1</p><p>setbit users:20201103 4 1</p><p>setbit users:20201103 9 1</p><p>è®¡ç®—å‡ºä¸¤å¤©éƒ½è®¿é—®è¿‡ç½‘ç«™çš„ç”¨æˆ·æ•°é‡</p><p><code>bitop and users:and:20201104_03  users:20201103 users:20201104</code></p><p>users:and:20201104_03  -&gt;  20201104å’Œ20201103çš„</p><img src="/2023/10/05/Redis/redis-bitop.png" class title="users:and:20201104_03: è§£æå›¾"><h4 id="Bitmapsä¸setå¯¹æ¯”"><a href="#Bitmapsä¸setå¯¹æ¯”" class="headerlink" title="Bitmapsä¸setå¯¹æ¯”"></a>Bitmapsä¸setå¯¹æ¯”</h4><p>å‡è®¾ç½‘ç«™æœ‰1äº¿ç”¨æˆ·ï¼Œ æ¯å¤©ç‹¬ç«‹è®¿é—®çš„ç”¨æˆ·æœ‰5åƒä¸‡ï¼Œ å¦‚æœæ¯å¤©ç”¨é›†åˆç±»å‹å’ŒBitmapsåˆ†åˆ«å­˜å‚¨æ´»è·ƒç”¨æˆ·å¯ä»¥å¾—åˆ°è¡¨</p><table><thead><tr><th>setå’ŒBitmapså­˜å‚¨ä¸€å¤©æ´»è·ƒç”¨æˆ·å¯¹æ¯”</th><th></th><th></th><th></th></tr></thead><tbody><tr><td>æ•°æ®  ç±»å‹</td><td>æ¯ä¸ªç”¨æˆ·idå ç”¨ç©ºé—´</td><td>éœ€è¦å­˜å‚¨çš„ç”¨æˆ·é‡</td><td>å…¨éƒ¨å†…å­˜é‡</td></tr><tr><td>é›†åˆ  ç±»å‹</td><td>64ä½</td><td>50000000</td><td>64ä½*50000000 &#x3D; 400MB</td></tr><tr><td>Bitmaps</td><td>1ä½</td><td>100000000</td><td>1ä½*100000000 &#x3D; 12.5MB</td></tr></tbody></table><p>å¾ˆæ˜æ˜¾ï¼Œ è¿™ç§æƒ…å†µä¸‹ä½¿ç”¨Bitmapsèƒ½èŠ‚çœå¾ˆå¤šçš„å†…å­˜ç©ºé—´ï¼Œ å°¤å…¶æ˜¯éšç€æ—¶é—´æ¨ç§»èŠ‚çœçš„å†…å­˜è¿˜æ˜¯éå¸¸å¯è§‚çš„</p><table><thead><tr><th>setå’ŒBitmapså­˜å‚¨ç‹¬ç«‹ç”¨æˆ·ç©ºé—´å¯¹æ¯”</th><th></th><th></th><th></th></tr></thead><tbody><tr><td>æ•°æ®ç±»å‹</td><td>ä¸€å¤©</td><td>ä¸€ä¸ªæœˆ</td><td>ä¸€å¹´</td></tr><tr><td>é›†åˆç±»å‹</td><td>400MB</td><td>12GB</td><td>144GB</td></tr><tr><td>Bitmaps</td><td>12.5MB</td><td>375MB</td><td>4.5GB</td></tr></tbody></table><p>ä½†Bitmapså¹¶ä¸æ˜¯ä¸‡é‡‘æ²¹ï¼Œ å‡å¦‚è¯¥ç½‘ç«™æ¯å¤©çš„ç‹¬ç«‹è®¿é—®ç”¨æˆ·å¾ˆå°‘ï¼Œ ä¾‹å¦‚åªæœ‰10ä¸‡ï¼ˆå¤§é‡çš„åƒµå°¸ç”¨æˆ·ï¼‰ ï¼Œ é‚£ä¹ˆä¸¤è€…çš„å¯¹æ¯”å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼Œ å¾ˆæ˜¾ç„¶ï¼Œ è¿™æ—¶å€™ä½¿ç”¨Bitmapså°±ä¸å¤ªåˆé€‚äº†ï¼Œ å› ä¸ºåŸºæœ¬ä¸Šå¤§éƒ¨åˆ†ä½éƒ½æ˜¯0ã€‚</p><table><thead><tr><th>setå’ŒBitmapså­˜å‚¨ä¸€å¤©æ´»è·ƒç”¨æˆ·å¯¹æ¯”ï¼ˆç‹¬ç«‹ç”¨æˆ·æ¯”è¾ƒå°‘ï¼‰</th><th></th><th></th><th></th></tr></thead><tbody><tr><td>æ•°æ®ç±»å‹</td><td>æ¯ä¸ªuseridå ç”¨ç©ºé—´</td><td>éœ€è¦å­˜å‚¨çš„ç”¨æˆ·é‡</td><td>å…¨éƒ¨å†…å­˜é‡</td></tr><tr><td>é›†åˆç±»å‹</td><td>64ä½</td><td>100000</td><td>64ä½*100000 &#x3D; 800KB</td></tr><tr><td>Bitmaps</td><td>1ä½</td><td>100000000</td><td>1ä½*100000000 &#x3D; 12.5MB</td></tr></tbody></table><h3 id="HyperLogLogç»Ÿè®¡"><a href="#HyperLogLogç»Ÿè®¡" class="headerlink" title="HyperLogLogç»Ÿè®¡"></a>HyperLogLogç»Ÿè®¡</h3><p>åœ¨å·¥ä½œå½“ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°ä¸ç»Ÿè®¡ç›¸å…³çš„åŠŸèƒ½éœ€æ±‚ï¼Œæ¯”å¦‚ç»Ÿè®¡ç½‘ç«™PVï¼ˆPageViewé¡µé¢è®¿é—®é‡ï¼‰,å¯ä»¥ä½¿ç”¨Redisçš„incrã€incrbyè½»æ¾å®ç°ã€‚</p><p>ä½†åƒUVï¼ˆUniqueVisitorï¼Œç‹¬ç«‹è®¿å®¢ï¼‰ã€ç‹¬ç«‹IPæ•°ã€æœç´¢è®°å½•æ•°ç­‰éœ€è¦å»é‡å’Œè®¡æ•°çš„é—®é¢˜å¦‚ä½•è§£å†³ï¼Ÿè¿™ç§æ±‚é›†åˆä¸­ä¸é‡å¤å…ƒç´ ä¸ªæ•°çš„é—®é¢˜ç§°ä¸ºåŸºæ•°é—®é¢˜ã€‚</p><p>Redis HyperLogLog æ˜¯ç”¨æ¥åšåŸºæ•°ç»Ÿè®¡çš„ç®—æ³•ï¼ŒHyperLogLog çš„ä¼˜ç‚¹æ˜¯ï¼Œåœ¨è¾“å…¥å…ƒç´ çš„æ•°é‡æˆ–è€…ä½“ç§¯éå¸¸éå¸¸å¤§æ—¶ï¼Œè®¡ç®—åŸºæ•°æ‰€éœ€çš„ç©ºé—´æ€»æ˜¯å›ºå®šçš„ã€å¹¶ä¸”æ˜¯å¾ˆå°çš„ã€‚</p><p>åœ¨ Redis é‡Œé¢ï¼Œæ¯ä¸ª HyperLogLog é”®åªéœ€è¦èŠ±è´¹ 12 KB å†…å­˜ï¼Œå°±å¯ä»¥è®¡ç®—æ¥è¿‘ 2^64 ä¸ªä¸åŒå…ƒç´ çš„åŸºæ•°ã€‚è¿™å’Œè®¡ç®—åŸºæ•°æ—¶ï¼Œå…ƒç´ è¶Šå¤šè€—è´¹å†…å­˜å°±è¶Šå¤šçš„é›†åˆå½¢æˆé²œæ˜å¯¹æ¯”ã€‚</p><p>ä½†æ˜¯ï¼Œå› ä¸º HyperLogLog åªä¼šæ ¹æ®è¾“å…¥å…ƒç´ æ¥è®¡ç®—åŸºæ•°ï¼Œè€Œä¸ä¼šå‚¨å­˜è¾“å…¥å…ƒç´ æœ¬èº«ï¼Œæ‰€ä»¥ HyperLogLog ä¸èƒ½åƒé›†åˆé‚£æ ·ï¼Œè¿”å›è¾“å…¥çš„å„ä¸ªå…ƒç´ ã€‚</p><p>ä»€ä¹ˆæ˜¯åŸºæ•°?</p><p>æ¯”å¦‚æ•°æ®é›† {1, 3, 5, 7, 5, 7, 8}ï¼Œ é‚£ä¹ˆè¿™ä¸ªæ•°æ®é›†çš„åŸºæ•°é›†ä¸º {1, 3, 5 ,7, 8}, åŸºæ•°(ä¸é‡å¤å…ƒç´ )ä¸º5ã€‚ åŸºæ•°ä¼°è®¡å°±æ˜¯åœ¨è¯¯å·®å¯æ¥å—çš„èŒƒå›´å†…ï¼Œå¿«é€Ÿè®¡ç®—åŸºæ•°</p><h4 id="pfadd"><a href="#pfadd" class="headerlink" title="pfadd"></a><code>pfadd</code></h4><p>æ·»åŠ æŒ‡å®šå…ƒç´ åˆ° HyperLogLog ä¸­:  <code>pfadd &lt;key&gt;&lt; element&gt; [element ...] </code> </p><p>ä¾‹å¦‚:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pfadd program &quot;redis&quot;   # å¾€programé‡Œé¢æ·»åŠ redis</span><br><span class="line">pfadd program &quot;kafka&quot;</span><br></pre></td></tr></table></figure><p>å°†æ‰€æœ‰å…ƒç´ æ·»åŠ åˆ°æŒ‡å®šHyperLogLogæ•°æ®ç»“æ„ä¸­ã€‚å¦‚æœæ‰§è¡Œå‘½ä»¤åHLLä¼°è®¡çš„è¿‘ä¼¼åŸºæ•°å‘ç”Ÿå˜åŒ–ï¼Œåˆ™è¿”å›1ï¼Œå¦åˆ™è¿”å›0</p><p>åœ¨æ­¤æ—¶ä¾‹å¦‚å†å¾€programæ·»åŠ redis è¿”å›çš„ç»“æœæ˜¯0,å› ä¸ºåŸºæ•°æ²¡æœ‰å‘ç”Ÿå˜åŒ–</p><h4 id="pfcount"><a href="#pfcount" class="headerlink" title="pfcount"></a><code>pfcount</code></h4><p>è®¡ç®—HLLçš„è¿‘ä¼¼åŸºæ•°:  <code>pfcount&lt;key&gt; [key ...] </code> ï¼Œå¯ä»¥è®¡ç®—å¤šä¸ªHLLï¼Œæ¯”å¦‚ç”¨HLLå­˜å‚¨æ¯å¤©çš„UVï¼Œè®¡ç®—ä¸€å‘¨çš„UVå¯ä»¥ä½¿ç”¨7å¤©çš„UVåˆå¹¶è®¡ç®—å³å¯, ç¤ºä¾‹</p><img src="/2023/10/05/Redis/image-20231021211250381.png" class title="pfcountå®ä¾‹"><h4 id="pfmerge"><a href="#pfmerge" class="headerlink" title="pfmerge"></a><code>pfmerge</code></h4><p>å°†ä¸€ä¸ªæˆ–å¤šä¸ªHLLåˆå¹¶åçš„ç»“æœå­˜å‚¨åœ¨å¦ä¸€ä¸ªHLLä¸­: <code>pfmerge&lt;destkey&gt;&lt;sourcekey&gt; [sourcekey ...] </code>ï¼Œæ¯”å¦‚æ¯æœˆæ´»è·ƒç”¨æˆ·å¯ä»¥ä½¿ç”¨æ¯å¤©çš„æ´»è·ƒç”¨æˆ·æ¥åˆå¹¶è®¡ç®—å¯å¾—</p><img src="/2023/10/05/Redis/image-20231021211402606.png" class title="pfmerge"><h3 id="Geospatialåœ°ç†ä¿¡æ¯"><a href="#Geospatialåœ°ç†ä¿¡æ¯" class="headerlink" title="Geospatialåœ°ç†ä¿¡æ¯"></a>Geospatialåœ°ç†ä¿¡æ¯</h3><p>Redis 3.2 ä¸­å¢åŠ äº†å¯¹GEOç±»å‹çš„æ”¯æŒã€‚GEOï¼ŒGeographicï¼Œåœ°ç†ä¿¡æ¯çš„ç¼©å†™ã€‚è¯¥ç±»å‹ï¼Œå°±æ˜¯å…ƒç´ çš„2ç»´åæ ‡ï¼Œåœ¨åœ°å›¾ä¸Šå°±æ˜¯ç»çº¬åº¦ã€‚redisåŸºäºè¯¥ç±»å‹ï¼Œæä¾›äº†ç»çº¬åº¦è®¾ç½®ï¼ŒæŸ¥è¯¢ï¼ŒèŒƒå›´æŸ¥è¯¢ï¼Œè·ç¦»æŸ¥è¯¢ï¼Œç»çº¬åº¦Hashç­‰å¸¸è§æ“ä½œ</p><h4 id="geoaddæ·»åŠ åœ°ç†ä½ç½®"><a href="#geoaddæ·»åŠ åœ°ç†ä½ç½®" class="headerlink" title="geoaddæ·»åŠ åœ°ç†ä½ç½®"></a><code>geoadd</code>æ·»åŠ åœ°ç†ä½ç½®</h4><p> æ·»åŠ åœ°ç†ä½ç½®ï¼ˆç»åº¦ï¼Œçº¬åº¦ï¼Œåç§°ï¼‰:  <code>geoadd&lt;key&gt;&lt; longitude&gt;&lt;latitude&gt;&lt;member&gt; [longitude latitude member...]</code></p><p>å®ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">geoadd china:city <span class="number">121.47</span> <span class="number">31.23</span> shanghai</span><br><span class="line">geoadd china:city <span class="number">106.50</span> <span class="number">29.53</span> chongqing <span class="number">114.05</span> <span class="number">22.52</span> shenzhen <span class="number">116.38</span> <span class="number">39.90</span> beijing</span><br></pre></td></tr></table></figure><p>ä¸¤ææ— æ³•ç›´æ¥æ·»åŠ ï¼Œä¸€èˆ¬ä¼šä¸‹è½½åŸå¸‚æ•°æ®ï¼Œç›´æ¥é€šè¿‡ Java ç¨‹åºä¸€æ¬¡æ€§å¯¼å…¥ã€‚</p><p>æœ‰æ•ˆçš„ç»åº¦ä» -180 åº¦åˆ° 180 åº¦ã€‚æœ‰æ•ˆçš„çº¬åº¦ä» -85.05112878 åº¦åˆ° 85.05112878 åº¦ã€‚</p><p>å½“åæ ‡ä½ç½®è¶…å‡ºæŒ‡å®šèŒƒå›´æ—¶ï¼Œè¯¥å‘½ä»¤å°†ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚</p><p>å·²ç»æ·»åŠ çš„æ•°æ®ï¼Œæ˜¯æ— æ³•å†æ¬¡å¾€é‡Œé¢æ·»åŠ çš„ã€‚</p><h4 id="geoposåœ°åŒºåæ ‡å€¼"><a href="#geoposåœ°åŒºåæ ‡å€¼" class="headerlink" title="geoposåœ°åŒºåæ ‡å€¼"></a><code>geopos</code>åœ°åŒºåæ ‡å€¼</h4><p>è·å¾—æŒ‡å®šåœ°åŒºçš„åæ ‡å€¼:  <code>geopos &lt;key&gt;&lt;member&gt; [member...] </code></p><p>å®ä¾‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; geopos china:city shanghai</span><br><span class="line">1) 2) &quot;121.47000163793563843&quot;</span><br><span class="line">   2) &quot;31.22999903975783553&quot;</span><br></pre></td></tr></table></figure><h4 id="geodistç›´çº¿è·ç¦»"><a href="#geodistç›´çº¿è·ç¦»" class="headerlink" title="geodistç›´çº¿è·ç¦»"></a><code>geodist</code>ç›´çº¿è·ç¦»</h4><p>è·å–ä¸¤ä¸ªä½ç½®ä¹‹é—´çš„ç›´çº¿è·ç¦»<code>geodist&lt;key&gt;&lt;member1&gt;&lt;member2&gt; [m|km|ft|mi ]</code></p><p>å®ä¾‹</p><p>è·å–ä¸¤ä¸ªä½ç½®ä¹‹é—´çš„ç›´çº¿è·ç¦»</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; geopos china:city beijin shanghai km</span><br><span class="line">&quot;1087.4816&quot;</span><br></pre></td></tr></table></figure><p>å•ä½ï¼š</p><p>m è¡¨ç¤ºå•ä½ä¸ºç±³[é»˜è®¤å€¼]ã€‚</p><p>km è¡¨ç¤ºå•ä½ä¸ºåƒç±³ã€‚</p><p>mi è¡¨ç¤ºå•ä½ä¸ºè‹±é‡Œã€‚</p><p>ft è¡¨ç¤ºå•ä½ä¸ºè‹±å°ºã€‚</p><p>å¦‚æœç”¨æˆ·æ²¡æœ‰æ˜¾å¼åœ°æŒ‡å®šå•ä½å‚æ•°ï¼Œ é‚£ä¹ˆ GEODIST é»˜è®¤ä½¿ç”¨ç±³ä½œä¸ºå•ä½</p><h4 id="georadiusæ‰¾æŸä¸€åŠå¾„å†…çš„å…ƒç´ "><a href="#georadiusæ‰¾æŸä¸€åŠå¾„å†…çš„å…ƒç´ " class="headerlink" title="georadiusæ‰¾æŸä¸€åŠå¾„å†…çš„å…ƒç´ "></a><code>georadius</code>æ‰¾æŸä¸€åŠå¾„å†…çš„å…ƒç´ </h4><p>ä»¥ç»™å®šçš„ç»çº¬åº¦ä¸ºä¸­å¿ƒï¼Œæ‰¾å‡ºæŸä¸€åŠå¾„å†…çš„å…ƒç´  <code>georadius&lt;key&gt;&lt; longitude&gt;&lt;latitude&gt;radius m|km|ft|mi</code>ç»åº¦ çº¬åº¦ è·ç¦» å•ä½</p><p>å®ä¾‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; geopos china:city 110 30 1000 km</span><br><span class="line">1) &quot;chongqing&quot;</span><br><span class="line">2) &quot;shengzhen&quot;</span><br></pre></td></tr></table></figure><h2 id="Redisåœ¨SpringBootçš„é…ç½®"><a href="#Redisåœ¨SpringBootçš„é…ç½®" class="headerlink" title="Redisåœ¨SpringBootçš„é…ç½®"></a>Redisåœ¨SpringBootçš„é…ç½®</h2><h3 id="å¯¼å…¥ä¾èµ–"><a href="#å¯¼å…¥ä¾èµ–" class="headerlink" title="å¯¼å…¥ä¾èµ–"></a>å¯¼å…¥ä¾èµ–</h3><p>SpringBoot2.x</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- spring2.Xé›†æˆredisæ‰€éœ€common-pool2--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-pool2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="RedisConfigè®¾ç½®"><a href="#RedisConfigè®¾ç½®" class="headerlink" title="RedisConfigè®¾ç½®"></a>RedisConfigè®¾ç½®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfig</span> <span class="keyword">extends</span> <span class="title class_">CachingConfigurerSupport</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory factory)</span> &#123;</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line">        RedisSerializer&lt;String&gt; redisSerializer = <span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>();</span><br><span class="line">        <span class="type">Jackson2JsonRedisSerializer</span> <span class="variable">jackson2JsonRedisSerializer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jackson2JsonRedisSerializer</span>(Object.class);</span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">om</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(om);</span><br><span class="line">        template.setConnectionFactory(factory);</span><br><span class="line"><span class="comment">//keyåºåˆ—åŒ–æ–¹å¼</span></span><br><span class="line">        template.setKeySerializer(redisSerializer);</span><br><span class="line"><span class="comment">//valueåºåˆ—åŒ–</span></span><br><span class="line">        template.setValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line"><span class="comment">//value hashmapåºåˆ—åŒ–</span></span><br><span class="line">        template.setHashValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CacheManager <span class="title function_">cacheManager</span><span class="params">(RedisConnectionFactory factory)</span> &#123;</span><br><span class="line">        RedisSerializer&lt;String&gt; redisSerializer = <span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>();</span><br><span class="line">        <span class="type">Jackson2JsonRedisSerializer</span> <span class="variable">jackson2JsonRedisSerializer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Jackson2JsonRedisSerializer</span>(Object.class);</span><br><span class="line"><span class="comment">//è§£å†³æŸ¥è¯¢ç¼“å­˜è½¬æ¢å¼‚å¸¸çš„é—®é¢˜</span></span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">om</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(om);</span><br><span class="line"><span class="comment">// é…ç½®åºåˆ—åŒ–ï¼ˆè§£å†³ä¹±ç çš„é—®é¢˜ï¼‰,è¿‡æœŸæ—¶é—´600ç§’</span></span><br><span class="line">        <span class="type">RedisCacheConfiguration</span> <span class="variable">config</span> <span class="operator">=</span> RedisCacheConfiguration.defaultCacheConfig()</span><br><span class="line">                .entryTtl(Duration.ofSeconds(<span class="number">600</span>))</span><br><span class="line">                .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(redisSerializer))</span><br><span class="line">                .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(jackson2JsonRedisSerializer))</span><br><span class="line">                .disableCachingNullValues();</span><br><span class="line">        <span class="type">RedisCacheManager</span> <span class="variable">cacheManager</span> <span class="operator">=</span> RedisCacheManager.builder(factory)</span><br><span class="line">                .cacheDefaults(config)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="keyword">return</span> cacheManager;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Redisäº‹åŠ¡ã€é”æœºåˆ¶ã€ç§’æ€â˜…"><a href="#Redisäº‹åŠ¡ã€é”æœºåˆ¶ã€ç§’æ€â˜…" class="headerlink" title="Redisäº‹åŠ¡ã€é”æœºåˆ¶ã€ç§’æ€â˜…"></a>Redisäº‹åŠ¡ã€é”æœºåˆ¶ã€ç§’æ€â˜…</h2><p>Redisäº‹åŠ¡æ˜¯ä¸€ä¸ªå•ç‹¬çš„éš”ç¦»æ“ä½œï¼šäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œã€‚äº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­ã€‚</p><p>Redisäº‹åŠ¡çš„ä¸»è¦ä½œç”¨å°±æ˜¯<strong>ä¸²è”å¤šä¸ªå‘½ä»¤</strong>é˜²æ­¢åˆ«çš„å‘½ä»¤æ’é˜Ÿ</p><h3 id="Multiã€Execã€discard"><a href="#Multiã€Execã€discard" class="headerlink" title="Multiã€Execã€discard"></a>Multiã€Execã€discard</h3><p>Multiï¼šç±»ä¼¼äºå¼€å¯äº‹åŠ¡ Transational(value&#x3D;true)</p><p>ä»è¾“å…¥Multiå‘½ä»¤å¼€å§‹ï¼Œè¾“å…¥çš„å‘½ä»¤éƒ½ä¼šä¾æ¬¡è¿›å…¥<strong>å‘½ä»¤é˜Ÿåˆ—</strong>ä¸­ï¼Œä½†ä¸ä¼šæ‰§è¡Œï¼Œç›´åˆ°è¾“å…¥Execåï¼ŒRedisä¼šå°†ä¹‹å‰çš„å‘½ä»¤é˜Ÿåˆ—ä¸­çš„å‘½ä»¤<strong>ä¾æ¬¡æ‰§è¡Œ</strong>ã€‚</p><p>ç»„é˜Ÿçš„è¿‡ç¨‹ä¸­å¯ä»¥é€šè¿‡discardæ¥æ”¾å¼ƒç»„é˜Ÿ</p><img src="/2023/10/05/Redis/Redis-queue.png" class title="Redisäº‹åŠ¡é˜Ÿåˆ—å›¾"><p>æ¡ˆä¾‹: å½“å‰æˆ‘æœ‰ä¸¤ä¸ªå‘½ä»¤ è®¾ç½®k1ä¸º1,k2ä¸º2 ,  æ§åˆ¶å°å¦‚ä¸‹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi    # è¿›å…¥äº‹åŠ¡æ¨¡å¼</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set k1 1 # è®¾ç½®k1ä¸º1,å¹¶ä¸”è¿›å…¥é˜Ÿåˆ—</span><br><span class="line">QUEUED                     </span><br><span class="line">127.0.0.1:6379&gt; set k2 2 # è®¾ç½®k2ä¸º2,å¹¶ä¸”è¿›å…¥é˜Ÿåˆ—</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; exec     # æäº¤é˜Ÿåˆ—,ä¾æ¬¡æ‰§è¡Œ</span><br><span class="line">1) OK</span><br><span class="line">2) OK</span><br></pre></td></tr></table></figure><p>ç»„é˜Ÿé˜¶æ®µæŠ¥é”™ï¼Œæäº¤å¤±è´¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set k3 3</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; set k4</span><br><span class="line">(error) ERR wrong number of arguments for &#x27;set&#x27; command</span><br><span class="line">127.0.0.1:6379&gt; set k5 5</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; exec</span><br><span class="line">(error) EXECABORT Transaction discarded because of previous errors.</span><br></pre></td></tr></table></figure><p>ç»„é˜ŸæˆåŠŸï¼Œæäº¤æœ‰æˆåŠŸæœ‰å¤±è´¥æƒ…å†µ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set k1 k</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; incr k1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; set k2 k</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; exec</span><br><span class="line">1) OK</span><br><span class="line">2) (error) ERR value is not an integer or out of range</span><br><span class="line">3) OK</span><br></pre></td></tr></table></figure><h3 id="äº‹åŠ¡çš„é”™è¯¯å¤„ç†"><a href="#äº‹åŠ¡çš„é”™è¯¯å¤„ç†" class="headerlink" title="äº‹åŠ¡çš„é”™è¯¯å¤„ç†"></a>äº‹åŠ¡çš„é”™è¯¯å¤„ç†</h3><p><strong>ç»„é˜Ÿä¸­</strong>æŸä¸ªå‘½ä»¤å‡ºç°äº†æŠ¥å‘Šé”™è¯¯ï¼Œæ‰§è¡Œæ—¶æ•´ä¸ªçš„æ‰€æœ‰é˜Ÿåˆ—<strong>éƒ½ä¼šè¢«å–æ¶ˆ</strong>(<strong>ç»„é˜Ÿæ—¶æ˜¯ç±»ä¼¼äºåŸå­æ€§çš„</strong>)</p><img src="/2023/10/05/Redis/transational-error.png" class title="Redisäº‹åŠ¡é”™è¯¯å¤„ç†"><p>å¦‚æœ<strong>æ‰§è¡Œé˜¶æ®µ</strong>æŸä¸ªå‘½ä»¤æŠ¥å‡ºäº†é”™è¯¯ï¼Œåˆ™<strong>åªæœ‰æŠ¥é”™</strong>çš„å‘½ä»¤ä¸ä¼šè¢«æ‰§è¡Œï¼Œè€Œå…¶ä»–çš„å‘½ä»¤<strong>éƒ½ä¼šæ‰§è¡Œ</strong>ï¼Œä¸ä¼šå›æ»š</p><img src="/2023/10/05/Redis/rollback.png" class><h3 id="äº‹åŠ¡å†²çªçš„é—®é¢˜"><a href="#äº‹åŠ¡å†²çªçš„é—®é¢˜" class="headerlink" title="äº‹åŠ¡å†²çªçš„é—®é¢˜"></a>äº‹åŠ¡å†²çªçš„é—®é¢˜</h3><p>ä¾‹å­:</p><p>åœ¨ä¸€ä¸ªè´¦æˆ·ä¸­,ä¸€ä¸ªè¯·æ±‚æƒ³ç»™é‡‘é¢å‡8000</p><p>ä¸€ä¸ªè¯·æ±‚æƒ³ç»™é‡‘é¢å‡5000</p><p>ä¸€ä¸ªè¯·æ±‚æƒ³ç»™é‡‘é¢å‡1000</p><table><thead><tr><th align="center">å¼€å§‹é‡‘é¢</th><th align="center">é€»è¾‘åˆ¤æ–­</th><th align="center">æ“ä½œç»“æœ</th><th align="center">æœ€åç»“æœ</th></tr></thead><tbody><tr><td align="center"></td><td align="center">if 10000&gt;8000 then -8000</td><td align="center">-8000</td><td align="center"></td></tr><tr><td align="center">10000</td><td align="center">if 10000&gt;8000 then -5000</td><td align="center">-5000</td><td align="center">-4000</td></tr><tr><td align="center"></td><td align="center">if 10000&gt;8000 then -1000</td><td align="center">-1000</td><td align="center"></td></tr></tbody></table><h4 id="æ‚²è§‚é”"><a href="#æ‚²è§‚é”" class="headerlink" title="æ‚²è§‚é”"></a>æ‚²è§‚é”</h4><img src="/2023/10/05/Redis/%E6%82%B2%E8%A7%82%E9%94%81.png" class title="æ‚²è§‚é”"><p><strong>æ‚²è§‚é”(Pessimistic Lock)</strong>, é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆæ‚²è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šblockç›´åˆ°å®ƒæ‹¿åˆ°é”ã€‚<strong>ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“é‡Œè¾¹å°±ç”¨åˆ°äº†å¾ˆå¤šè¿™ç§é”æœºåˆ¶</strong>ï¼Œæ¯”å¦‚<strong>è¡Œé”</strong>ï¼Œ<strong>è¡¨é”</strong>ç­‰ï¼Œ<strong>è¯»é”</strong>ï¼Œ<strong>å†™é”</strong>ç­‰ï¼Œéƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé”</p><h4 id="ä¹è§‚é”"><a href="#ä¹è§‚é”" class="headerlink" title="ä¹è§‚é”"></a>ä¹è§‚é”</h4><img src="/2023/10/05/Redis/%E4%B9%90%E8%A7%82%E9%94%81.png" class title="ä¹è§‚é”"><p><strong>ä¹è§‚é”(Optimistic Lock),</strong> é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆä¹è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·ç­‰æœºåˆ¶ã€‚<strong>ä¹è§‚é”é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œè¿™æ ·å¯ä»¥æé«˜ååé‡</strong>ã€‚Rediså°±æ˜¯åˆ©ç”¨è¿™ç§check-and-setæœºåˆ¶å®ç°äº‹åŠ¡çš„ã€‚</p><h4 id="WATCH-key-key"><a href="#WATCH-key-key" class="headerlink" title="WATCH key [key . . .]"></a>WATCH key [key . . .]</h4><p>ç›‘è§†key: åœ¨æ‰§è¡Œmultiä¹‹å‰ï¼Œå…ˆæ‰§è¡Œwatch key1 [key2],å¯ä»¥ç›‘è§†ä¸€ä¸ª(æˆ–å¤šä¸ª) key ï¼Œå¦‚æœåœ¨äº‹åŠ¡<strong>æ‰§è¡Œä¹‹å‰è¿™ä¸ª(æˆ–è¿™äº›) key è¢«å…¶ä»–å‘½ä»¤æ‰€æ”¹åŠ¨ï¼Œé‚£ä¹ˆäº‹åŠ¡å°†è¢«æ‰“æ–­ã€‚</strong>ä¹è§‚é”ç‰ˆæœ¬å·æ§åˆ¶</p><h4 id="unwatch"><a href="#unwatch" class="headerlink" title="unwatch"></a>unwatch</h4><p>å–æ¶ˆ WATCH å‘½ä»¤å¯¹æ‰€æœ‰ key çš„ç›‘è§†ã€‚</p><p>å¦‚æœåœ¨æ‰§è¡Œ WATCH å‘½ä»¤ä¹‹åï¼ŒEXEC å‘½ä»¤æˆ–DISCARD å‘½ä»¤å…ˆè¢«æ‰§è¡Œäº†çš„è¯ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦å†æ‰§è¡ŒUNWATCH äº†ã€‚</p><p><a href="http://doc.redisfans.com/transaction/exec.html">EXEC â€” Redis å‘½ä»¤å‚è€ƒ (redisfans.com)</a></p><h3 id="Redisäº‹åŠ¡ä¸‰ç‰¹æ€§"><a href="#Redisäº‹åŠ¡ä¸‰ç‰¹æ€§" class="headerlink" title="Redisäº‹åŠ¡ä¸‰ç‰¹æ€§"></a>Redisäº‹åŠ¡ä¸‰ç‰¹æ€§</h3><h4 id="å•ç‹¬çš„éš”ç¦»æ“ä½œ"><a href="#å•ç‹¬çš„éš”ç¦»æ“ä½œ" class="headerlink" title="å•ç‹¬çš„éš”ç¦»æ“ä½œ"></a>å•ç‹¬çš„éš”ç¦»æ“ä½œ</h4><p>äº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œã€‚äº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­ã€‚ </p><h4 id="æ²¡æœ‰éš”ç¦»çº§åˆ«çš„æ¦‚å¿µ"><a href="#æ²¡æœ‰éš”ç¦»çº§åˆ«çš„æ¦‚å¿µ" class="headerlink" title="æ²¡æœ‰éš”ç¦»çº§åˆ«çš„æ¦‚å¿µ"></a>æ²¡æœ‰éš”ç¦»çº§åˆ«çš„æ¦‚å¿µ</h4><p> é˜Ÿåˆ—ä¸­çš„å‘½ä»¤æ²¡æœ‰æäº¤ä¹‹å‰éƒ½ä¸ä¼šå®é™…è¢«æ‰§è¡Œï¼Œå› ä¸ºäº‹åŠ¡æäº¤å‰ä»»ä½•æŒ‡ä»¤éƒ½ä¸ä¼šè¢«å®é™…æ‰§è¡Œ</p><h4 id="ä¸ä¿è¯åŸå­æ€§"><a href="#ä¸ä¿è¯åŸå­æ€§" class="headerlink" title="ä¸ä¿è¯åŸå­æ€§"></a>ä¸ä¿è¯åŸå­æ€§</h4><p>äº‹åŠ¡ä¸­å¦‚æœæœ‰ä¸€æ¡å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œå…¶åçš„å‘½ä»¤ä»ç„¶ä¼šè¢«æ‰§è¡Œï¼Œæ²¡æœ‰å›æ»š </p><h3 id="Redisäº‹åŠ¡ç§’æ€æ¡ˆä¾‹"><a href="#Redisäº‹åŠ¡ç§’æ€æ¡ˆä¾‹" class="headerlink" title="Redisäº‹åŠ¡ç§’æ€æ¡ˆä¾‹"></a>Redisäº‹åŠ¡ç§’æ€æ¡ˆä¾‹</h3><h4 id="è§£å†³è®¡æ•°å™¨å’Œäººå‘˜è®°å½•çš„äº‹åŠ¡æ“ä½œ"><a href="#è§£å†³è®¡æ•°å™¨å’Œäººå‘˜è®°å½•çš„äº‹åŠ¡æ“ä½œ" class="headerlink" title="è§£å†³è®¡æ•°å™¨å’Œäººå‘˜è®°å½•çš„äº‹åŠ¡æ“ä½œ"></a>è§£å†³è®¡æ•°å™¨å’Œäººå‘˜è®°å½•çš„äº‹åŠ¡æ“ä½œ</h4><p>å•†å“åº“å­˜: ( å‡ä¸ªæ•° )</p><table><thead><tr><th>key</th><th>string</th></tr></thead><tbody><tr><td>sk:prodid:qt</td><td>å‰©ä½™ä¸ªæ•°</td></tr></tbody></table><p>ç§’æ€æˆåŠŸè€…æ¸…å•: ( åŠ ä¸ªæ•°, seté›†åˆå»é‡ )</p><table><thead><tr><th>key</th><th>set</th></tr></thead><tbody><tr><td></td><td>æˆåŠŸè€…çš„user_id</td></tr><tr><td>sk:prod-id:user</td><td>æˆåŠŸè€…çš„user_id</td></tr><tr><td></td><td>æˆåŠŸè€…çš„user_id</td></tr></tbody></table><p>ä½¿ç”¨ç®€å•çš„ä»£ç æ¨¡æ‹Ÿç§’æ€æµç¨‹ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç§’æ€è¿‡ç¨‹ æ¨¡æ‹Ÿ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">doSecKill</span><span class="params">(String uid,String prodid)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">//1 uidå’Œprodidéç©ºåˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">if</span>(uid == <span class="literal">null</span> || prodid == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2 è¿æ¥redis</span></span><br><span class="line">    <span class="comment">// Jedis jedis = new Jedis(&quot;192.168.44.168&quot;,6379);</span></span><br><span class="line">    <span class="comment">//====(è¿æ¥æ± )====(è§£å†³è¶…æ—¶é—®é¢˜)</span></span><br><span class="line">    <span class="comment">//é€šè¿‡è¿æ¥æ± å¾—åˆ°jediså¯¹è±¡</span></span><br><span class="line">    <span class="type">JedisPool</span> <span class="variable">jedisPoolInstance</span> <span class="operator">=</span> JedisPoolUtil.getJedisPoolInstance();</span><br><span class="line">    <span class="type">Jedis</span> <span class="variable">jedis</span> <span class="operator">=</span> jedisPoolInstance.getResource();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3 æ‹¼æ¥key</span></span><br><span class="line">    <span class="comment">// 3.1 åº“å­˜key</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">kcKey</span> <span class="operator">=</span> <span class="string">&quot;sk:&quot;</span>+prodid+<span class="string">&quot;:qt&quot;</span>;</span><br><span class="line">    <span class="comment">// 3.2 ç§’æ€æˆåŠŸç”¨æˆ·key</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">userKey</span> <span class="operator">=</span> <span class="string">&quot;sk:&quot;</span>+prodid+<span class="string">&quot;:user&quot;</span>;</span><br><span class="line"><span class="comment">//====(ä¹è§‚é”)====</span></span><br><span class="line">    <span class="comment">//ç›‘è§†åº“å­˜ </span></span><br><span class="line">    jedis.watch(kcKey);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4 è·å–åº“å­˜ï¼Œå¦‚æœåº“å­˜nullï¼Œç§’æ€è¿˜æ²¡æœ‰å¼€å§‹</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">kc</span> <span class="operator">=</span> jedis.get(kcKey);</span><br><span class="line">    <span class="keyword">if</span>(kc == <span class="literal">null</span>) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç§’æ€è¿˜æ²¡æœ‰å¼€å§‹ï¼Œè¯·ç­‰å¾…&quot;</span>);</span><br><span class="line">        jedis.close();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5 åˆ¤æ–­ç”¨æˆ·æ˜¯å¦é‡å¤ç§’æ€æ“ä½œ</span></span><br><span class="line">    <span class="keyword">if</span>(jedis.sismember(userKey, uid)) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å·²ç»ç§’æ€æˆåŠŸäº†ï¼Œä¸èƒ½é‡å¤ç§’æ€&quot;</span>);</span><br><span class="line">        jedis.close();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//6 åˆ¤æ–­å¦‚æœå•†å“æ•°é‡ï¼Œåº“å­˜æ•°é‡å°äº1ï¼Œç§’æ€ç»“æŸ</span></span><br><span class="line">    <span class="keyword">if</span>(Integer.parseInt(kc)&lt;=<span class="number">0</span>) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç§’æ€å·²ç»ç»“æŸäº†&quot;</span>);</span><br><span class="line">        jedis.close();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//7 ç§’æ€è¿‡ç¨‹</span></span><br><span class="line">    <span class="comment">//ä½¿ç”¨äº‹åŠ¡</span></span><br><span class="line">    <span class="type">Transaction</span> <span class="variable">multi</span> <span class="operator">=</span> jedis.multi();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç»„é˜Ÿæ“ä½œ</span></span><br><span class="line">    multi.decr(kcKey);      <span class="comment">// å‡å°‘åº“å­˜</span></span><br><span class="line">    multi.sadd(userKey,uid);<span class="comment">// åŠ å…¥ç”¨æˆ·</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ‰§è¡Œ</span></span><br><span class="line">    List&lt;Object&gt; results = multi.exec();</span><br><span class="line">    <span class="keyword">if</span>(results == <span class="literal">null</span> || results.size()==<span class="number">0</span>) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç§’æ€å¤±è´¥äº†....&quot;</span>);</span><br><span class="line">        jedis.close();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ²¡æœ‰æ·»åŠ äº‹åŠ¡,ä¼šè¶…å–</span></span><br><span class="line">    <span class="comment">//7.1 åº“å­˜-1</span></span><br><span class="line">    <span class="comment">//jedis.decr(kcKey);</span></span><br><span class="line">    <span class="comment">//7.2 æŠŠç§’æ€æˆåŠŸç”¨æˆ·æ·»åŠ æ¸…å•é‡Œé¢</span></span><br><span class="line">    <span class="comment">//jedis.sadd(userKey,uid);</span></span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;ç§’æ€æˆåŠŸäº†..&quot;</span>);</span><br><span class="line">    jedis.close();</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ€»ç»“: å½“å‰æ¡ˆä¾‹ä»£ç æ¨¡æ‹Ÿçš„ç§’æ€, å…ˆè·å–ç§’æ€ç”¨æˆ·keyå’Œç§’æ€å•†å“çš„key,  ä½¿ç”¨Redisçš„Watchç›‘è§†åº“å­˜,  åˆ¤æ–­åº“å­˜æƒ…å†µ,  å¦‚æœå­˜åœ¨åº“å­˜,  å¼€å§‹ç§’æ€,  åœ¨ç§’æ€è¿‡ç¨‹ä¸­åˆ¤æ–­ç”¨æˆ·æ˜¯å¦é‡å¤ç§’æ€,  ä»¥åŠåˆ¤æ–­åº“å­˜æ˜¯å¦ä¸è¶³,  å¼€å¯äº‹ç‰©,  è¿›è¡Œç»„é˜Ÿ(é˜Ÿåˆ—)æ“ä½œ,  ç„¶åæ‰§è¡Œexec(), æ ¹æ®ç»“æœ(List<Object> results)åˆ¤æ–­ç»“æœå¦‚ä½•, æµç¨‹ç»“æŸ (ä¸Šè¿°ä»£ç ä¸ºå®Œæ•´çš„æµç¨‹,åŠ äº†è¿æ¥æ± ,åŠ äº†ä¹è§‚é”)                                                                                                                                                    </Object></p><h4 id="Redisäº‹åŠ¡ç§’æ€å¹¶å‘æ¨¡æ‹Ÿ"><a href="#Redisäº‹åŠ¡ç§’æ€å¹¶å‘æ¨¡æ‹Ÿ" class="headerlink" title="Redisäº‹åŠ¡ç§’æ€å¹¶å‘æ¨¡æ‹Ÿ"></a>Redisäº‹åŠ¡ç§’æ€å¹¶å‘æ¨¡æ‹Ÿ</h4><p>ä½¿ç”¨<strong>å·¥å…·abæ¨¡æ‹Ÿ</strong>æµ‹è¯• (CentOS6 é»˜è®¤å®‰è£…   CentOS7éœ€è¦æ‰‹åŠ¨å®‰è£…) </p><p>è”ç½‘ï¼šyum install httpd-tools</p><p>æ— ç½‘ç»œ:ï¼ˆ1ï¼‰ è¿›å…¥cd &#x2F;run&#x2F;media&#x2F;root&#x2F;CentOS 7 x86_64&#x2F;Packagesï¼ˆè·¯å¾„è·Ÿcentos6ä¸åŒï¼‰</p><p>é¡ºåºå®‰è£… : </p><p><code>apr-1.4.8-3.el7.x86_64.rpm</code></p><p><code>apr-util-1.5.2-6.el7.x86_64.rpm</code></p><p><code>httpd-tools-2.4.6-67.el7.centos.x86_64.rpm</code></p><p>é€šè¿‡abæµ‹è¯•</p><p>vim postfile æ¨¡æ‹Ÿè¡¨å•æäº¤å‚æ•°,ä»¥&amp;ç¬¦å·ç»“å°¾;å­˜æ”¾å½“å‰ç›®å½•ã€‚</p><p>å†…å®¹ï¼šprodid&#x3D;0101&amp;</p><p><code>ab -n 2000 -c 200 -k -p ~/postfile -T application/x-www-form-urlencoded http://127.0.0.1:8081/Seckill/doseckill</code></p><blockquote><p>2000 ä¸ª è¯·æ±‚ä¸­æœ‰200ä¸ªæ˜¯å¹¶å‘æ‰§è¡Œ</p><p>-n è¯·æ±‚æ•°,    -c è¯·æ±‚ä¸­çš„å¹¶å‘æ•°é‡,  -p æäº¤å‚æ•°,    -t  å‚æ•°ç±»å‹</p><p>127.0.0.1:8081: å®é™…ä¸Šè¦åŠ ä¸Šå½“å‰ä¸»æœºçš„ipåœ°å€ ipconfig</p></blockquote><p>è¿˜å¯ä»¥é€šè¿‡Apipostç­‰å·¥å…·è¿›è¡Œå‹æµ‹å¹¶å‘è¯·æ±‚</p><h5 id="è¶…å–"><a href="#è¶…å–" class="headerlink" title="è¶…å–"></a>è¶…å–</h5><p>Redisä¸­å•†å“æ•°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set sk:0101:qt 10</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get sk:0101:qt</span><br><span class="line">&quot;-2&quot;   # åœ¨å¹¶å‘çš„æ—¶å€™åº“å­˜å˜æˆäº†-2</span><br></pre></td></tr></table></figure><p>åœ¨åå°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ç§’æ€æˆåŠŸ!</span><br><span class="line">ç§’æ€æˆåŠŸ!</span><br><span class="line">ç§’æ€æˆåŠŸ!</span><br><span class="line">ç§’æ€æˆåŠŸ!</span><br><span class="line">å·²ç§’å…‰!</span><br><span class="line">ç§’æ€æˆåŠŸ!</span><br><span class="line">å·²ç§’å…‰!</span><br><span class="line">å·²ç§’å…‰!</span><br><span class="line">å·²ç§’å…‰!    </span><br></pre></td></tr></table></figure><h5 id="è¶…å–é—®é¢˜"><a href="#è¶…å–é—®é¢˜" class="headerlink" title="è¶…å–é—®é¢˜"></a>è¶…å–é—®é¢˜</h5><table><thead><tr><th align="center">æ€»åº“å­˜</th><th align="center">ç”¨æˆ·è¯·æ±‚</th><th align="center">æ“ä½œ</th><th align="center">åº“å­˜</th></tr></thead><tbody><tr><td align="center"></td><td align="center">A :1.æ£€æŸ¥æ˜¯å¦è¿˜æœ‰åº“å­˜ 2. æœ‰åˆ™-1</td><td align="center">-1</td><td align="center"></td></tr><tr><td align="center">10 (æ€»)</td><td align="center">B: 1.æ£€æŸ¥æ˜¯å¦è¿˜æœ‰åº“å­˜ 2. æœ‰åˆ™-1</td><td align="center">-1</td><td align="center">-N (æ€»)</td></tr><tr><td align="center"></td><td align="center">C: 1.æ£€æŸ¥æ˜¯å¦è¿˜æœ‰åº“å­˜ 2. æœ‰åˆ™-1</td><td align="center">-1</td><td align="center"></td></tr><tr><td align="center"></td><td align="center">â€¦. â€¦</td><td align="center">â€¦</td><td align="center"></td></tr></tbody></table><h5 id="åˆ©ç”¨ä¹è§‚é”æ·˜æ±°ç”¨æˆ·ï¼Œè§£å†³è¶…å–é—®é¢˜"><a href="#åˆ©ç”¨ä¹è§‚é”æ·˜æ±°ç”¨æˆ·ï¼Œè§£å†³è¶…å–é—®é¢˜" class="headerlink" title="åˆ©ç”¨ä¹è§‚é”æ·˜æ±°ç”¨æˆ·ï¼Œè§£å†³è¶…å–é—®é¢˜"></a>åˆ©ç”¨ä¹è§‚é”æ·˜æ±°ç”¨æˆ·ï¼Œè§£å†³è¶…å–é—®é¢˜</h5><img src="/2023/10/05/Redis/%E4%B9%90%E8%A7%82%E9%94%81%E8%A7%A3%E5%86%B3%E8%B6%85%E5%8D%96%E9%97%AE%E9%A2%98.png" class><p>å¯¹åº“å­˜çš„keyä¸æ–­ç›‘è§†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jedis.watch(kcKey); <span class="comment">//â˜…</span></span><br></pre></td></tr></table></figure><p>å¯¹ç§’æ€çš„è¿‡ç¨‹ä½¿ç”¨äº‹åŠ¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//â˜…ä½¿ç”¨äº‹åŠ¡</span></span><br><span class="line"><span class="type">Transaction</span> <span class="variable">multi</span> <span class="operator">=</span> jedis.multi();</span><br><span class="line"></span><br><span class="line"><span class="comment">//â˜…ç»„é˜Ÿæ“ä½œ</span></span><br><span class="line">multi.decr(kcKey);      <span class="comment">// å‡å°‘åº“å­˜</span></span><br><span class="line">multi.sadd(userKey,uid);<span class="comment">// åŠ å…¥ç”¨æˆ·,</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰§è¡Œ</span></span><br><span class="line">List&lt;Object&gt; results = multi.exec();</span><br><span class="line"><span class="keyword">if</span>(results == <span class="literal">null</span> || results.size() == <span class="number">0</span>) &#123; <span class="comment">// ç»“æœä¸ºç©ºæˆ–è€…æœ‰å…¶ä»–çš„æƒ…å†µ-&gt;å¤±è´¥ å¦åˆ™æˆåŠŸ</span></span><br><span class="line">    log.info(<span class="string">&quot;ç§’æ€å¤±è´¥äº†....&quot;</span>);</span><br><span class="line">    jedis.close();</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ€»ç»“: å…ˆWatchç›‘è§†key,  ç„¶ååŠ å…¥äº‹åŠ¡ç»„é˜Ÿ,  æœ€åæ‰§è¡Œ,  åˆ¤æ–­è¿”å›çš„listé›†åˆ</p></blockquote><p>èµ°åˆ°è¿™é‡Œäº†,  è§£å†³äº†è¶…å–é—®é¢˜(åŠ <strong>ä¹è§‚é”</strong>),  è§£å†³äº†è¿æ¥è¶…æ—¶é—®é¢˜(<strong>ä½¿ç”¨JedisPoolè¿æ¥æ± </strong>),  ä½†æ˜¯å‘ç°è¿˜æœ‰<strong>åº“å­˜é—ç•™é—®é¢˜</strong>.  ä¹è§‚é”é€ æˆåº“å­˜é—ç•™é—®é¢˜</p><h5 id="è§£å†³åº“å­˜é—ç•™é—®é¢˜"><a href="#è§£å†³åº“å­˜é—ç•™é—®é¢˜" class="headerlink" title="è§£å†³åº“å­˜é—ç•™é—®é¢˜"></a>è§£å†³åº“å­˜é—ç•™é—®é¢˜</h5><h6 id="Luaè„šæœ¬"><a href="#Luaè„šæœ¬" class="headerlink" title="Luaè„šæœ¬"></a>Luaè„šæœ¬</h6><p>Lua æ˜¯ä¸€ä¸ªå°å·§çš„ <u>è„šæœ¬è¯­è¨€</u>ï¼ŒLuaè„šæœ¬å¯ä»¥å¾ˆå®¹æ˜“çš„è¢«C&#x2F;C++ ä»£ç è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥åè¿‡æ¥è°ƒç”¨C&#x2F;C++çš„å‡½æ•°ï¼ŒLuaå¹¶æ²¡æœ‰æä¾›å¼ºå¤§çš„åº“ï¼Œä¸€ä¸ªå®Œæ•´çš„Luaè§£é‡Šå™¨ä¸è¿‡200kï¼Œæ‰€ä»¥Luaä¸é€‚åˆä½œä¸ºå¼€å‘ç‹¬ç«‹åº”ç”¨ç¨‹åºçš„è¯­è¨€ï¼Œè€Œæ˜¯ä½œä¸ºåµŒå…¥å¼è„šæœ¬è¯­è¨€ã€‚</p><p>å¾ˆå¤šåº”ç”¨ç¨‹åºã€æ¸¸æˆä½¿ç”¨LUAä½œä¸ºè‡ªå·±çš„åµŒå…¥å¼è„šæœ¬è¯­è¨€ï¼Œä»¥æ­¤æ¥å®ç°å¯é…ç½®æ€§ã€å¯æ‰©å±•æ€§ã€‚</p><h6 id="LUAè„šæœ¬åœ¨Redisä¸­çš„ä¼˜åŠ¿"><a href="#LUAè„šæœ¬åœ¨Redisä¸­çš„ä¼˜åŠ¿" class="headerlink" title="LUAè„šæœ¬åœ¨Redisä¸­çš„ä¼˜åŠ¿"></a>LUAè„šæœ¬åœ¨Redisä¸­çš„ä¼˜åŠ¿</h6><p>å°†å¤æ‚çš„æˆ–è€…å¤šæ­¥çš„redisæ“ä½œï¼Œå†™ä¸ºä¸€ä¸ªè„šæœ¬ï¼Œä¸€æ¬¡æäº¤ç»™redisæ‰§è¡Œï¼Œå‡å°‘åå¤è¿æ¥redisçš„æ¬¡æ•°ã€‚<wavy>æå‡æ€§èƒ½</wavy>ã€‚</p><p>LUAè„šæœ¬æ˜¯ç±»ä¼¼redisäº‹åŠ¡ï¼Œæœ‰ä¸€å®šçš„<u>åŸå­æ€§</u>ï¼Œä¸ä¼šè¢«å…¶ä»–å‘½ä»¤æ’é˜Ÿï¼Œå¯ä»¥å®Œæˆä¸€äº›redisäº‹åŠ¡æ€§çš„æ“ä½œã€‚</p><p>ä½†æ˜¯æ³¨æ„redisçš„luaè„šæœ¬åŠŸèƒ½ï¼Œåªæœ‰åœ¨Redis 2.6ä»¥ä¸Šçš„ç‰ˆæœ¬æ‰å¯ä»¥ä½¿ç”¨ã€‚</p><p>åˆ©ç”¨luaè„šæœ¬æ·˜æ±°ç”¨æˆ·ï¼Œè§£å†³è¶…å–é—®é¢˜ã€‚</p><p>redis 2.6ç‰ˆæœ¬ä»¥åï¼Œé€šè¿‡luaè„šæœ¬è§£å†³<strong>äº‰æŠ¢é—®é¢˜</strong>ï¼Œå®é™…ä¸Šæ˜¯<strong>redis</strong> <strong>åˆ©ç”¨å…¶å•çº¿ç¨‹çš„ç‰¹æ€§ï¼Œç”¨ä»»åŠ¡é˜Ÿåˆ—çš„æ–¹å¼è§£å†³å¤šä»»åŠ¡å¹¶å‘é—®é¢˜</strong>ã€‚</p><img src="/2023/10/05/Redis/lua.png" class title="luaè„šæœ¬ æ‰§è¡Œ"><p><a href="https://www.w3cschool.cn/lua/">Lua æ•™ç¨‹_w3cschool</a></p><h6 id="è§£å†³åº“å­˜ä¾èµ–é—®é¢˜-luaè„šæœ¬"><a href="#è§£å†³åº“å­˜ä¾èµ–é—®é¢˜-luaè„šæœ¬" class="headerlink" title="è§£å†³åº“å­˜ä¾èµ–é—®é¢˜,luaè„šæœ¬"></a>è§£å†³åº“å­˜ä¾èµ–é—®é¢˜,luaè„šæœ¬</h6><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> userid=KEYS[<span class="number">1</span>]; <span class="comment">-- è·å–ç”¨æˆ·id</span></span><br><span class="line"><span class="keyword">local</span> prodid=KEYS[<span class="number">2</span>]; <span class="comment">-- è·å–å•†å“id</span></span><br><span class="line"><span class="comment">-- keyæ‹¼æ¥</span></span><br><span class="line"><span class="keyword">local</span> qtkey=<span class="string">&quot;sk:&quot;</span>..prodid..<span class="string">&quot;:qt&quot;</span>;</span><br><span class="line"><span class="keyword">local</span> usersKey=<span class="string">&quot;sk:&quot;</span>..prodid.<span class="string">&quot;:usr&#x27;; </span></span><br><span class="line"><span class="string">-- åˆ¤æ–­ç”¨æˆ·keyæ˜¯å¦åœ¨å½“å‰æ¸…å•ä¸­å­˜åœ¨</span></span><br><span class="line"><span class="string">local userExists=redis.call(&quot;</span>sismember<span class="string">&quot;,usersKey,userid);</span></span><br><span class="line"><span class="string">-- ç”¨æˆ·å·²ç»ç§’æ€è¿‡äº†,çº¦å®šè¿”å›2</span></span><br><span class="line"><span class="string">if tonumber(userExists)==1 then </span></span><br><span class="line"><span class="string">  return 2; </span></span><br><span class="line"><span class="string">end</span></span><br><span class="line"><span class="string">local num= redis.call(&quot;</span>get<span class="string">&quot; ,qtkey);</span></span><br><span class="line"><span class="string">-- ç§’æ€ç»“æŸ</span></span><br><span class="line"><span class="string">if tonumber(num)&lt;=0 then </span></span><br><span class="line"><span class="string">  return 0; </span></span><br><span class="line"><span class="string">-- å¦åˆ™æ·»åŠ æ¸…å•,å‡å°‘åº“å­˜</span></span><br><span class="line"><span class="string">else </span></span><br><span class="line"><span class="string">  redis.call(&quot;</span>decr<span class="string">&quot;,qtkey);</span></span><br><span class="line"><span class="string">  redis.call(&quot;</span>sadd<span class="string">&quot;,usersKey,userid);</span></span><br><span class="line"><span class="string">end</span></span><br><span class="line"><span class="string">-- ç§’æ€æˆåŠŸ</span></span><br><span class="line"><span class="string">return 1;</span></span><br></pre></td></tr></table></figure><p>å¯¹äºè¿™ä¸ªè„šæœ¬å¦‚ä½•ä½¿ç”¨?<psw>æˆ‘ä¹Ÿä¸çŸ¥é“,ä¸æ˜¯</psw>,  ä¾‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisByScript</span> &#123;</span><br><span class="line"><span class="comment">//  ===Luaè„šæœ¬===</span></span><br><span class="line"><span class="keyword">static</span> <span class="type">String</span> <span class="variable">secKillScript</span> <span class="operator">=</span><span class="string">&quot;local userid=KEYS[1];\r\n&quot;</span> + </span><br><span class="line"><span class="string">&quot;local prodid=KEYS[2];\r\n&quot;</span> + </span><br><span class="line"><span class="string">&quot;local qtkey=&#x27;sk:&#x27;..prodid..\&quot;:qt\&quot;;\r\n&quot;</span> + </span><br><span class="line"><span class="string">&quot;local usersKey=&#x27;sk:&#x27;..prodid..\&quot;:usr\&quot;;\r\n&quot;</span> + </span><br><span class="line"><span class="string">&quot;local userExists=redis.call(\&quot;sismember\&quot;,usersKey,userid);\r\n&quot;</span> + </span><br><span class="line"><span class="string">&quot;if tonumber(userExists)==1 then \r\n&quot;</span> + </span><br><span class="line"><span class="string">&quot;   return 2;\r\n&quot;</span> + </span><br><span class="line"><span class="string">&quot;end\r\n&quot;</span> + </span><br><span class="line"><span class="string">&quot;local num= redis.call(\&quot;get\&quot; ,qtkey);\r\n&quot;</span> + </span><br><span class="line"><span class="string">&quot;if tonumber(num)&lt;=0 then \r\n&quot;</span> + </span><br><span class="line"><span class="string">&quot;   return 0;\r\n&quot;</span> + </span><br><span class="line"><span class="string">&quot;else \r\n&quot;</span> + </span><br><span class="line"><span class="string">&quot;   redis.call(\&quot;decr\&quot;,qtkey);\r\n&quot;</span> + </span><br><span class="line"><span class="string">&quot;   redis.call(\&quot;sadd\&quot;,usersKey,userid);\r\n&quot;</span> + </span><br><span class="line"><span class="string">&quot;end\r\n&quot;</span> + </span><br><span class="line"><span class="string">&quot;return 1&quot;</span> ;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">static</span> <span class="type">String</span> <span class="variable">secKillScript2</span> <span class="operator">=</span> </span><br><span class="line"><span class="string">&quot;local userExists=redis.call(\&quot;sismember\&quot;,\&quot;&#123;sk&#125;:0101:usr\&quot;,userid);\r\n&quot;</span> +</span><br><span class="line"><span class="string">&quot; return 1&quot;</span>;</span><br><span class="line"><span class="comment">// ç§’æ€æµç¨‹å°è£…, ç»“åˆLua</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">doSecKill</span><span class="params">(String uid,String prodid)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line"><span class="type">JedisPool</span> <span class="variable">jedispool</span> <span class="operator">=</span>  JedisPoolUtil.getJedisPoolInstance();</span><br><span class="line">Jedis jedis=jedispool.getResource();</span><br><span class="line"></span><br><span class="line"> <span class="comment">//String sha1=  .secKillScript;</span></span><br><span class="line">        <span class="comment">// è°ƒç”¨JedisåŠ è½½è„šæœ¬æ–¹æ³•,åŠ è½½åˆšåˆšæå†™çš„luaè„šæœ¬</span></span><br><span class="line">String sha1=  jedis.scriptLoad(secKillScript);</span><br><span class="line">Object result= jedis.evalsha(sha1, <span class="number">2</span>, uid,prodid);</span><br><span class="line"></span><br><span class="line">  String reString=String.valueOf(result);</span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;0&quot;</span>.equals( reString )  ) &#123;</span><br><span class="line">System.err.println(<span class="string">&quot;å·²æŠ¢ç©ºï¼ï¼&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;1&quot;</span>.equals( reString )  )  &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;æŠ¢è´­æˆåŠŸï¼ï¼ï¼ï¼&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;2&quot;</span>.equals( reString )  )  &#123;</span><br><span class="line">System.err.println(<span class="string">&quot;è¯¥ç”¨æˆ·å·²æŠ¢è¿‡ï¼ï¼&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">System.err.println(<span class="string">&quot;æŠ¢è´­å¼‚å¸¸ï¼ï¼&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">jedis.close();</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="RedisæŒä¹…åŒ–ä¹‹RDB"><a href="#RedisæŒä¹…åŒ–ä¹‹RDB" class="headerlink" title="RedisæŒä¹…åŒ–ä¹‹RDB"></a>RedisæŒä¹…åŒ–ä¹‹RDB</h2><p><a href="https://redis.io/">Redis</a>å®˜ç½‘</p><p>Redis æä¾›äº†2ä¸ªä¸åŒå½¢å¼çš„æŒä¹…åŒ–æ–¹å¼ã€‚</p><p>(1) RDBï¼ˆRedis DataBaseï¼‰ </p><p>(2) AOFï¼ˆAppend Of Fileï¼‰ </p><h3 id="RDB-Redis-DataBase"><a href="#RDB-Redis-DataBase" class="headerlink" title="RDB(Redis DataBase)"></a>RDB(Redis DataBase)</h3><h4 id="æ˜¯ä»€ä¹ˆ"><a href="#æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ˜¯ä»€ä¹ˆ?"></a>æ˜¯ä»€ä¹ˆ?</h4><p>åœ¨æŒ‡å®šçš„<wavy>æ—¶é—´é—´éš”</wavy>å†…å°†å†…å­˜ä¸­çš„<strong>æ•°æ®é›†</strong><wavy>å¿«ç…§</wavy>å†™å…¥ç£ç›˜ï¼Œ ä¹Ÿå°±æ˜¯è¡Œè¯è®²çš„Snapshotå¿«ç…§ï¼Œå®ƒæ¢å¤æ—¶æ˜¯å°†å¿«ç…§æ–‡ä»¶ç›´æ¥è¯»åˆ°å†…å­˜é‡Œ,  å¿«ç…§è®°å½•æŸä¸€åˆ»çš„æ•°æ®</p><h4 id="å¤‡ä»½æ˜¯å¦‚ä½•æ‰§è¡Œçš„"><a href="#å¤‡ä»½æ˜¯å¦‚ä½•æ‰§è¡Œçš„" class="headerlink" title="å¤‡ä»½æ˜¯å¦‚ä½•æ‰§è¡Œçš„?"></a>å¤‡ä»½æ˜¯å¦‚ä½•æ‰§è¡Œçš„?</h4><p>Redisä¼šå•ç‹¬åˆ›å»ºï¼ˆforkï¼‰ä¸€ä¸ªå­è¿›ç¨‹æ¥è¿›è¡ŒæŒä¹…åŒ–ï¼Œä¼š<strong>å…ˆ</strong>å°†æ•°æ®å†™å…¥åˆ° ä¸€ä¸ª<u>ä¸´æ—¶æ–‡ä»¶</u>ä¸­ï¼Œå¾…æŒä¹…åŒ–è¿‡ç¨‹éƒ½ç»“æŸäº†ï¼Œå†ç”¨è¿™ä¸ª<strong>ä¸´æ—¶æ–‡ä»¶æ›¿æ¢ä¸Šæ¬¡æŒä¹…åŒ–å¥½çš„æ–‡ä»¶(dump.rdb)<strong>ã€‚ æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸»è¿›ç¨‹æ˜¯ä¸è¿›è¡Œä»»ä½•IOæ“ä½œçš„ï¼Œè¿™å°±ç¡®ä¿äº†æé«˜çš„æ€§èƒ½ å¦‚æœéœ€è¦è¿›è¡Œå¤§è§„æ¨¡æ•°æ®çš„æ¢å¤ï¼Œä¸”å¯¹äºæ•°æ®æ¢å¤çš„å®Œæ•´æ€§ä¸æ˜¯éå¸¸æ•æ„Ÿï¼Œé‚£RDBæ–¹å¼è¦æ¯”AOFæ–¹å¼æ›´åŠ çš„é«˜æ•ˆã€‚</strong>RDBçš„ç¼ºç‚¹æ˜¯<emp>æœ€åä¸€æ¬¡æŒä¹…åŒ–åçš„æ•°æ®å¯èƒ½ä¸¢å¤±</emp></strong> .</p><h4 id="Fork"><a href="#Fork" class="headerlink" title="Fork"></a>Fork</h4><ul><li>Forkçš„ä½œç”¨æ˜¯å¤åˆ¶ä¸€ä¸ªä¸å½“å‰è¿›ç¨‹<strong>ä¸€æ ·çš„è¿›ç¨‹</strong>ã€‚æ–°è¿›ç¨‹çš„æ‰€æœ‰æ•°æ®ï¼ˆå˜é‡ã€ç¯å¢ƒå˜é‡ã€ç¨‹åºè®¡æ•°å™¨ç­‰ï¼‰ æ•°å€¼éƒ½å’ŒåŸè¿›ç¨‹ä¸€è‡´ï¼Œä½†æ˜¯æ˜¯ä¸€ä¸ªå…¨æ–°çš„è¿›ç¨‹ï¼Œå¹¶<emp>ä½œä¸ºåŸè¿›ç¨‹çš„å­è¿›ç¨‹</emp></li><li><span class="p green">åœ¨Linuxç¨‹åºä¸­ï¼Œfork()ä¼šäº§ç”Ÿä¸€ä¸ªå’Œçˆ¶è¿›ç¨‹å®Œå…¨ç›¸åŒçš„å­è¿›ç¨‹ï¼Œä½†å­è¿›ç¨‹åœ¨æ­¤åå¤šä¼šexecç³»ç»Ÿè°ƒç”¨ï¼Œå‡ºäºæ•ˆç‡è€ƒè™‘ï¼ŒLinuxä¸­å¼•å…¥äº†<u>å†™æ—¶å¤åˆ¶æŠ€æœ¯</u></span></li><li><span class="p green"><u>ä¸€èˆ¬æƒ…å†µçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¼šå…±ç”¨åŒä¸€æ®µç‰©ç†å†…å­˜</u>ï¼Œåªæœ‰è¿›ç¨‹ç©ºé—´çš„å„æ®µçš„å†…å®¹è¦å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰ä¼šå°†çˆ¶è¿›ç¨‹çš„å†…å®¹å¤åˆ¶ä¸€ä»½ç»™å­è¿›ç¨‹ã€‚</span></li></ul><h4 id="RDBæŒä¹…æµç¨‹"><a href="#RDBæŒä¹…æµç¨‹" class="headerlink" title="RDBæŒä¹…æµç¨‹"></a>RDBæŒä¹…æµç¨‹</h4><img src="/2023/10/05/Redis/RDB%E6%8C%81%E4%B9%85%E5%8C%96%E6%B5%81%E7%A8%8B.png" class><h4 id="dump-rdbæ–‡ä»¶"><a href="#dump-rdbæ–‡ä»¶" class="headerlink" title="dump.rdbæ–‡ä»¶"></a>dump.rdbæ–‡ä»¶</h4><p>åœ¨redis.confä¸­é…ç½®æ–‡ä»¶åç§°,  é»˜è®¤ä¸ºdump.rdb</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># RDB files created with checksum disabled have a checksum of zero that will</span></span><br><span class="line"><span class="comment"># tell the loading code to skip the check.</span></span><br><span class="line"><span class="attr">rdbchecksum</span> <span class="string">yes</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># The filename where to dump the DB</span></span><br><span class="line"><span class="attr">dbfilename</span> <span class="string">dump.rdb     # æ­¤å¤„ä¸ºä¿®æ”¹æŒä¹…ä¿å­˜çš„æ–‡ä»¶å</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># The working directory.</span></span><br></pre></td></tr></table></figure><h4 id="é…ç½®ä½ç½®"><a href="#é…ç½®ä½ç½®" class="headerlink" title="é…ç½®ä½ç½®"></a>é…ç½®ä½ç½®</h4><p>rdbæ–‡ä»¶çš„ä¿å­˜ä½ç½®,  ä¹Ÿå¯ä»¥ä¿®æ”¹.  é»˜è®¤ä¸ºRediså¯åŠ¨æ—¶å‘½ä»¤è¡Œæ‰€åœ¨çš„ç›®å½•ä¸‹</p><p><code>dir  &quot;/myredis&quot;</code></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The working directory.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The DB will be written inside this directory, with the filename specified</span></span><br><span class="line"><span class="comment"># above using the &#x27;dbfilename&#x27; configuration directive.</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># The Append Only File will also be created inside this directory.</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># Note that you must specify a directory here, not a file name.</span></span><br><span class="line"><span class="attr">dir</span> <span class="string">./     # æ­¤å¤„ä¸ºä¿®æ”¹æ–‡ä»¶ä¿å­˜ä½ç½®è·¯å¾„</span></span><br></pre></td></tr></table></figure><h4 id="å¦‚ä½•è§¦å‘RDBå¿«ç…§ï¼›ä¿æŒç­–ç•¥"><a href="#å¦‚ä½•è§¦å‘RDBå¿«ç…§ï¼›ä¿æŒç­–ç•¥" class="headerlink" title="å¦‚ä½•è§¦å‘RDBå¿«ç…§ï¼›ä¿æŒç­–ç•¥"></a>å¦‚ä½•è§¦å‘RDBå¿«ç…§ï¼›ä¿æŒç­–ç•¥</h4><h5 id="é…ç½®æ–‡ä»¶ä¸­é»˜è®¤çš„å¿«ç…§é…ç½®"><a href="#é…ç½®æ–‡ä»¶ä¸­é»˜è®¤çš„å¿«ç…§é…ç½®" class="headerlink" title="é…ç½®æ–‡ä»¶ä¸­é»˜è®¤çš„å¿«ç…§é…ç½®"></a>é…ç½®æ–‡ä»¶ä¸­é»˜è®¤çš„å¿«ç…§é…ç½®</h5><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">################################ SNAPSHOTTING  ################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Save the DB on disk:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   save &lt;seconds&gt; &lt;changes&gt;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   Will save the DB if both the given number of seconds and the given</span></span><br><span class="line"><span class="comment">#   number of write operations against the DB occurred.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   In the example below the behaviour will be to save:</span></span><br><span class="line"><span class="comment">#   after 900 sec (15 min) if at least 1 key changed</span></span><br><span class="line"><span class="comment">#   after 300 sec (5 min) if at least 10 keys changed</span></span><br><span class="line"><span class="comment">#   after 60 sec if at least 10000 keys changed</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   <span class="doctag">Note:</span> you can disable saving completely by commenting out all &quot;save&quot; lines.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   It is also possible to remove all the previously configured save</span></span><br><span class="line"><span class="comment">#   points by adding a save directive` with a single empty string argument</span></span><br><span class="line"><span class="comment">#   like in the following example:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   save &quot;&quot;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#å¦‚æœè‡³å°‘æœ‰1ä¸ªkeyå˜åŒ–åœ¨900ç§’åä¿å­˜</span></span><br><span class="line"><span class="attr">save</span> <span class="string">900 1</span></span><br><span class="line"><span class="comment">#å¦‚æœè‡³å°‘æœ‰10ä¸ªkeyå˜åŒ–åœ¨300ç§’åä¿å­˜</span></span><br><span class="line"><span class="attr">save</span> <span class="string">300 10</span></span><br><span class="line"><span class="comment">#å¦‚æœè‡³å°‘æœ‰10000ä¸ªkeyå˜åŒ–åœ¨60ç§’åä¿å­˜</span></span><br><span class="line"><span class="attr">save</span> <span class="string">60 10000</span></span><br></pre></td></tr></table></figure><h5 id="save-VS-bgsave"><a href="#save-VS-bgsave" class="headerlink" title="save VS bgsave"></a>save VS bgsave</h5><p>save ï¼šsaveæ—¶åªç®¡ä¿å­˜ï¼Œå…¶å®ƒä¸ç®¡ï¼Œå…¨éƒ¨é˜»å¡ã€‚æ‰‹åŠ¨ä¿å­˜ã€‚ä¸å»ºè®®ã€‚</p><p><strong><u>bgsave</u>ï¼š<u>Redisä¼šåœ¨åå°å¼‚æ­¥è¿›è¡Œå¿«ç…§æ“ä½œï¼Œå¿«ç…§åŒæ—¶è¿˜å¯ä»¥å“åº”å®¢æˆ·ç«¯è¯·æ±‚ã€‚</u></strong></p><p>å¯ä»¥é€šè¿‡lastsave å‘½ä»¤è·å–æœ€åä¸€æ¬¡æˆåŠŸæ‰§è¡Œå¿«ç…§çš„æ—¶é—´</p><h4 id="flushallå‘½ä»¤"><a href="#flushallå‘½ä»¤" class="headerlink" title="flushallå‘½ä»¤"></a>flushallå‘½ä»¤</h4><h3 id="AOF-Append-of-File"><a href="#AOF-Append-of-File" class="headerlink" title="AOF(Append of File)"></a>AOF(Append of File)</h3>]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> åç«¯ </tag>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MyBatisPlus</title>
      <link href="/2023/09/25/MyBatisPlus/"/>
      <url>/2023/09/25/MyBatisPlus/</url>
      
        <content type="html"><![CDATA[<p>åˆ®å¼€çœ‹çœ‹ï¼š<psw>è¿™é‡Œå•¥éƒ½æ²¡æœ‰(è¿˜æ²¡æœ‰ç¬”è®°å–”)</psw></p>]]></content>
      
      
      <categories>
          
          <category> MyBatisPlus </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> åç«¯ </tag>
            
            <tag> MyBatisPlus </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è§£å†³github Connection timed outé—®é¢˜</title>
      <link href="/2023/09/24/Github%E8%BF%9E%E6%8E%A5%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98/"/>
      <url>/2023/09/24/Github%E8%BF%9E%E6%8E%A5%E8%B6%85%E6%97%B6%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h2 id="é—®é¢˜ç‚¹"><a href="#é—®é¢˜ç‚¹" class="headerlink" title="é—®é¢˜ç‚¹"></a>é—®é¢˜ç‚¹</h2><blockquote><p>ssh: connect to host github.com port 22: Connection timed out</p></blockquote><h2 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h2><p>æ‰¾åˆ°gitçš„å®‰è£…ç›®å½•ï¼Œæ‰¾åˆ°<code>/etc/ssh/ssh_config</code>æ–‡ä»¶</p><p>åœ¨æ–‡ä»¶(<code> ssh_config</code>)æœ«å°¾å¤„æ·»åŠ  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Host github.com</span><br><span class="line">User git</span><br><span class="line">Hostname ssh.github.com</span><br><span class="line">PreferredAuthentications publickey</span><br><span class="line">IdentityFile ~/.ssh/id_rsa</span><br><span class="line">Port 443</span><br></pre></td></tr></table></figure><p>å†æ¬¡è¿›è¡Œæäº¤,åç»­æœ‰å¯èƒ½ä¼šæç¤ºæ˜¯å¦ç»§ç»­ æˆ‘ä»¬é€‰æ‹©yeså³å¯</p>]]></content>
      
      
      <categories>
          
          <category> Github </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ€»ç»“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringåŸºç¡€éƒ¨åˆ†</title>
      <link href="/2023/09/24/Spring/"/>
      <url>/2023/09/24/Spring/</url>
      
        <content type="html"><![CDATA[<p>Springæ€»ç»“æ¥è¯´å°±æ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ§åˆ¶åè½¬ï¼ˆIOCï¼‰å’Œé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰çš„æ¡†æ¶</p><h1 id="SpringåŸºç¡€"><a href="#SpringåŸºç¡€" class="headerlink" title="SpringåŸºç¡€"></a>SpringåŸºç¡€</h1><h2 id="å®¹å™¨ï¼šIoC"><a href="#å®¹å™¨ï¼šIoC" class="headerlink" title="å®¹å™¨ï¼šIoC"></a>å®¹å™¨ï¼šIoC</h2><p>IoC æ˜¯ Inversion of Control çš„ç®€å†™ï¼Œè¯‘ä¸ºâ€œæ§åˆ¶åè½¬â€ï¼Œå®ƒä¸æ˜¯ä¸€é—¨æŠ€æœ¯ï¼Œè€Œæ˜¯ä¸€ç§è®¾è®¡æ€æƒ³ï¼Œæ˜¯ä¸€ä¸ªé‡è¦çš„é¢å‘å¯¹è±¡ç¼–ç¨‹æ³•åˆ™ï¼Œèƒ½å¤ŸæŒ‡å¯¼æˆ‘ä»¬å¦‚ä½•è®¾è®¡å‡ºæ¾è€¦åˆã€æ›´ä¼˜è‰¯çš„ç¨‹åºã€‚</p><p>Spring é€šè¿‡ IoC å®¹å™¨æ¥ç®¡ç†æ‰€æœ‰ Java å¯¹è±¡çš„å®ä¾‹åŒ–å’Œåˆå§‹åŒ–ï¼Œæ§åˆ¶å¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚æˆ‘ä»¬å°†ç”± IoC å®¹å™¨ç®¡ç†çš„ Java å¯¹è±¡ç§°ä¸º Spring Beanï¼Œå®ƒä¸ä½¿ç”¨å…³é”®å­— new åˆ›å»ºçš„ Java å¯¹è±¡æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚</p><p>IoC å®¹å™¨æ˜¯ Spring æ¡†æ¶ä¸­æœ€é‡è¦çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œå®ƒè´¯ç©¿äº† Spring ä»è¯ç”Ÿåˆ°æˆé•¿çš„æ•´ä¸ªè¿‡ç¨‹ã€‚</p><h3 id="IoCå®¹å™¨"><a href="#IoCå®¹å™¨" class="headerlink" title="IoCå®¹å™¨"></a>IoCå®¹å™¨</h3><h4 id="æ§åˆ¶åè½¬ï¼ˆIoCï¼‰"><a href="#æ§åˆ¶åè½¬ï¼ˆIoCï¼‰" class="headerlink" title="æ§åˆ¶åè½¬ï¼ˆIoCï¼‰"></a>æ§åˆ¶åè½¬ï¼ˆIoCï¼‰</h4><ul><li><p>æ§åˆ¶åè½¬æ˜¯ä¸€ç§æ€æƒ³ã€‚</p></li><li><p>æ§åˆ¶åè½¬æ˜¯ä¸ºäº†é™ä½ç¨‹åºè€¦åˆåº¦ï¼Œæé«˜ç¨‹åºæ‰©å±•åŠ›ã€‚</p></li><li><p>æ§åˆ¶åè½¬ï¼Œåè½¬çš„æ˜¯ä»€ä¹ˆï¼Ÿ</p></li><li><ul><li>å°†å¯¹è±¡çš„åˆ›å»ºæƒåˆ©äº¤å‡ºå»ï¼Œäº¤ç»™ç¬¬ä¸‰æ–¹å®¹å™¨è´Ÿè´£ã€‚</li><li>å°†å¯¹è±¡å’Œå¯¹è±¡ä¹‹é—´å…³ç³»çš„ç»´æŠ¤æƒäº¤å‡ºå»ï¼Œäº¤ç»™ç¬¬ä¸‰æ–¹å®¹å™¨è´Ÿè´£ã€‚</li></ul></li><li><p>æ§åˆ¶åè½¬è¿™ç§æ€æƒ³å¦‚ä½•å®ç°å‘¢ï¼Ÿ</p></li><li><ul><li>DIï¼ˆDependency Injectionï¼‰ï¼šä¾èµ–æ³¨å…¥</li></ul></li></ul><h4 id="ä¾èµ–æ³¨å…¥"><a href="#ä¾èµ–æ³¨å…¥" class="headerlink" title="ä¾èµ–æ³¨å…¥"></a>ä¾èµ–æ³¨å…¥</h4><p>DIï¼ˆDependency Injectionï¼‰ï¼šä¾èµ–æ³¨å…¥ï¼Œä¾èµ–æ³¨å…¥å®ç°äº†æ§åˆ¶åè½¬çš„æ€æƒ³ã€‚</p><p><strong>ä¾èµ–æ³¨å…¥ï¼š</strong></p><ul><li><strong>æŒ‡Springåˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹ä¸­ï¼Œå°†å¯¹è±¡ä¾èµ–å±æ€§é€šè¿‡é…ç½®è¿›è¡Œæ³¨å…¥</strong></li></ul><p>ä¾èµ–æ³¨å…¥å¸¸è§çš„å®ç°æ–¹å¼åŒ…æ‹¬ä¸¤ç§ï¼š</p><ul><li>ç¬¬ä¸€ç§ï¼šsetæ³¨å…¥</li><li>ç¬¬äºŒç§ï¼šæ„é€ æ³¨å…¥</li></ul><p>æ‰€ä»¥ç»“è®ºæ˜¯ï¼šIOC å°±æ˜¯ä¸€ç§æ§åˆ¶åè½¬çš„æ€æƒ³ï¼Œ è€Œ DI æ˜¯å¯¹IoCçš„ä¸€ç§å…·ä½“å®ç°ã€‚</p><p><strong>Beanç®¡ç†è¯´çš„æ˜¯ï¼šBeanå¯¹è±¡çš„åˆ›å»ºï¼Œä»¥åŠBeanå¯¹è±¡ä¸­å±æ€§çš„èµ‹å€¼ï¼ˆæˆ–è€…å«åšBeanå¯¹è±¡ä¹‹é—´å…³ç³»çš„ç»´æŠ¤ï¼‰ã€‚</strong></p><h4 id="IoCå®¹å™¨åœ¨Springçš„å®ç°"><a href="#IoCå®¹å™¨åœ¨Springçš„å®ç°" class="headerlink" title="IoCå®¹å™¨åœ¨Springçš„å®ç°"></a>IoCå®¹å™¨åœ¨Springçš„å®ç°</h4><p>Spring çš„ IoC å®¹å™¨å°±æ˜¯ IoCæ€æƒ³çš„ä¸€ä¸ªè½åœ°çš„äº§å“å®ç°ã€‚IoCå®¹å™¨ä¸­ç®¡ç†çš„ç»„ä»¶ä¹Ÿå«åš beanã€‚åœ¨åˆ›å»º bean ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦åˆ›å»ºIoC å®¹å™¨ã€‚Spring æä¾›äº†IoC å®¹å™¨çš„ä¸¤ç§å®ç°æ–¹å¼ï¼š</p><p><strong>â‘ BeanFactory</strong></p><p>è¿™æ˜¯ IoC å®¹å™¨çš„åŸºæœ¬å®ç°ï¼Œæ˜¯ Spring å†…éƒ¨ä½¿ç”¨çš„æ¥å£ã€‚é¢å‘ Spring æœ¬èº«ï¼Œä¸æä¾›ç»™å¼€å‘äººå‘˜ä½¿ç”¨ã€‚</p><p><strong>â‘¡ApplicationContext</strong></p><p>BeanFactory çš„å­æ¥å£ï¼Œæä¾›äº†æ›´å¤šé«˜çº§ç‰¹æ€§ã€‚é¢å‘ Spring çš„ä½¿ç”¨è€…ï¼Œå‡ ä¹æ‰€æœ‰åœºåˆéƒ½ä½¿ç”¨ ApplicationContext è€Œä¸æ˜¯åº•å±‚çš„ BeanFactoryã€‚</p><p><strong>â‘¢ApplicationContextçš„ä¸»è¦å®ç°ç±»</strong></p><table><thead><tr><th>ç±»å‹å</th><th>ç®€ä»‹</th></tr></thead><tbody><tr><td>ClassPathXmlApplicationContext</td><td>é€šè¿‡è¯»å–ç±»è·¯å¾„ä¸‹çš„ XML æ ¼å¼çš„é…ç½®æ–‡ä»¶åˆ›å»º IOC å®¹å™¨å¯¹è±¡</td></tr><tr><td>FileSystemXmlApplicationContext</td><td>é€šè¿‡æ–‡ä»¶ç³»ç»Ÿè·¯å¾„è¯»å– XML æ ¼å¼çš„é…ç½®æ–‡ä»¶åˆ›å»º IOC å®¹å™¨å¯¹è±¡</td></tr><tr><td>ConfigurableApplicationContext</td><td>ApplicationContext çš„å­æ¥å£ï¼ŒåŒ…å«ä¸€äº›æ‰©å±•æ–¹æ³• refresh() å’Œ close() ï¼Œè®© ApplicationContext å…·æœ‰å¯åŠ¨ã€å…³é—­å’Œåˆ·æ–°ä¸Šä¸‹æ–‡çš„èƒ½åŠ›ã€‚</td></tr><tr><td>WebApplicationContext</td><td>ä¸“é—¨ä¸º Web åº”ç”¨å‡†å¤‡ï¼ŒåŸºäº Web ç¯å¢ƒåˆ›å»º IOC å®¹å™¨å¯¹è±¡ï¼Œå¹¶å°†å¯¹è±¡å¼•å…¥å­˜å…¥ ServletContext åŸŸä¸­ã€‚</td></tr></tbody></table><h3 id="åŸºäºXMLç®¡ç†Bean"><a href="#åŸºäºXMLç®¡ç†Bean" class="headerlink" title="åŸºäºXMLç®¡ç†Bean"></a>åŸºäºXMLç®¡ç†Bean</h3><h4 id="æ­å»ºå­æ¨¡å—spring6-ioc-xml"><a href="#æ­å»ºå­æ¨¡å—spring6-ioc-xml" class="headerlink" title="æ­å»ºå­æ¨¡å—spring6-ioc-xml"></a>æ­å»ºå­æ¨¡å—spring6-ioc-xml</h4><p><strong>â‘ æ­å»ºæ¨¡å—</strong></p><p>æ­å»ºæ–¹å¼å¦‚ï¼šspring-first</p><p><strong>â‘¡å¼•å…¥é…ç½®æ–‡ä»¶</strong></p><p>å¼•å…¥spring-firstæ¨¡å—é…ç½®æ–‡ä»¶ï¼šbeans.xmlã€log4j2.xml</p><p><strong>â‘¢æ·»åŠ ä¾èµ–</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--spring contextä¾èµ–--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å½“ä½ å¼•å…¥Spring Contextä¾èµ–ä¹‹åï¼Œè¡¨ç¤ºå°†Springçš„åŸºç¡€ä¾èµ–å¼•å…¥äº†--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.0.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--junit5æµ‹è¯•--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.jupiter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-jupiter-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--log4j2çš„ä¾èµ–--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.19.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-slf4j2-impl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.19.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>â‘£å¼•å…¥javaç±»</strong></p><p>å¼•å…¥spring-firstæ¨¡å—javaåŠtestç›®å½•ä¸‹å®ä½“ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorld</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HelloWorld</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ— å‚æ•°æ„é€ æ–¹æ³•æ‰§è¡Œ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;helloworld&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorldTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(HelloWorldTest.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testHelloWorld</span><span class="params">()</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å®éªŒä¸€ï¼šè·å–bean"><a href="#å®éªŒä¸€ï¼šè·å–bean" class="headerlink" title="å®éªŒä¸€ï¼šè·å–bean"></a>å®éªŒä¸€ï¼šè·å–bean</h4><h5 id="â‘ æ–¹å¼ä¸€ï¼šæ ¹æ®idè·å–"><a href="#â‘ æ–¹å¼ä¸€ï¼šæ ¹æ®idè·å–" class="headerlink" title="â‘ æ–¹å¼ä¸€ï¼šæ ¹æ®idè·å–"></a>â‘ æ–¹å¼ä¸€ï¼šæ ¹æ®idè·å–</h5><p>ç”±äº id å±æ€§æŒ‡å®šäº† bean çš„å”¯ä¸€æ ‡è¯†ï¼Œæ‰€ä»¥æ ¹æ® bean æ ‡ç­¾çš„ id å±æ€§å¯ä»¥ç²¾ç¡®è·å–åˆ°ä¸€ä¸ªç»„ä»¶å¯¹è±¡ã€‚ä¸Šä¸ªå®éªŒä¸­æˆ‘ä»¬ä½¿ç”¨çš„å°±æ˜¯è¿™ç§æ–¹å¼ã€‚</p><h5 id="â‘¡æ–¹å¼äºŒï¼šæ ¹æ®ç±»å‹è·å–"><a href="#â‘¡æ–¹å¼äºŒï¼šæ ¹æ®ç±»å‹è·å–" class="headerlink" title="â‘¡æ–¹å¼äºŒï¼šæ ¹æ®ç±»å‹è·å–"></a>â‘¡æ–¹å¼äºŒï¼šæ ¹æ®ç±»å‹è·å–</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testHelloWorld1</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line">    <span class="type">HelloWorld</span> <span class="variable">bean</span> <span class="operator">=</span> ac.getBean(HelloWorld.class);</span><br><span class="line">    bean.sayHello();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="â‘¢æ–¹å¼ä¸‰ï¼šæ ¹æ®idå’Œç±»å‹"><a href="#â‘¢æ–¹å¼ä¸‰ï¼šæ ¹æ®idå’Œç±»å‹" class="headerlink" title="â‘¢æ–¹å¼ä¸‰ï¼šæ ¹æ®idå’Œç±»å‹"></a>â‘¢æ–¹å¼ä¸‰ï¼šæ ¹æ®idå’Œç±»å‹</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testHelloWorld2</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line">    <span class="type">HelloWorld</span> <span class="variable">bean</span> <span class="operator">=</span> ac.getBean(<span class="string">&quot;helloworld&quot;</span>, HelloWorld.class);</span><br><span class="line">    bean.sayHello();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="â‘£æ³¨æ„çš„åœ°æ–¹"><a href="#â‘£æ³¨æ„çš„åœ°æ–¹" class="headerlink" title="â‘£æ³¨æ„çš„åœ°æ–¹"></a>â‘£æ³¨æ„çš„åœ°æ–¹</h5><p>å½“æ ¹æ®ç±»å‹è·å–beanæ—¶ï¼Œè¦æ±‚IOCå®¹å™¨ä¸­æŒ‡å®šç±»å‹çš„beanæœ‰ä¸”åªèƒ½æœ‰ä¸€ä¸ª</p><p>å½“IOCå®¹å™¨ä¸­ä¸€å…±é…ç½®äº†ä¸¤ä¸ªï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;helloworldOne&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hang.spring6.bean.HelloWorld&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;helloworldTwo&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hang.spring6.bean.HelloWorld&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ ¹æ®ç±»å‹è·å–æ—¶ä¼šæŠ›å‡ºå¼‚å¸¸ï¼š</p><blockquote><p>org.springframework.beans.factory.NoUniqueBeanDefinitionException: No qualifying bean of type â€˜com.hang.spring6.bean.HelloWorldâ€™ available: expected single matching bean but found 2: helloworldOne,helloworldTwo</p></blockquote><h5 id="â‘¤æ‰©å±•çŸ¥è¯†"><a href="#â‘¤æ‰©å±•çŸ¥è¯†" class="headerlink" title="â‘¤æ‰©å±•çŸ¥è¯†"></a>â‘¤æ‰©å±•çŸ¥è¯†</h5><p>å¦‚æœç»„ä»¶ç±»å®ç°äº†æ¥å£ï¼Œæ ¹æ®æ¥å£ç±»å‹å¯ä»¥è·å– bean å—ï¼Ÿ</p><blockquote><p>å¯ä»¥ï¼Œå‰ææ˜¯beanå”¯ä¸€</p></blockquote><p>å¦‚æœä¸€ä¸ªæ¥å£æœ‰å¤šä¸ªå®ç°ç±»ï¼Œè¿™äº›å®ç°ç±»éƒ½é…ç½®äº† beanï¼Œæ ¹æ®æ¥å£ç±»å‹å¯ä»¥è·å– bean å—ï¼Ÿ</p><blockquote><p>ä¸è¡Œï¼Œå› ä¸ºbeanä¸å”¯ä¸€</p></blockquote><p><strong>ç»“è®º</strong></p><p>æ ¹æ®ç±»å‹æ¥è·å–beanæ—¶ï¼Œåœ¨æ»¡è¶³beanå”¯ä¸€æ€§çš„å‰æä¸‹ï¼Œå…¶å®åªæ˜¯çœ‹ï¼šã€å¯¹è±¡ <strong>instanceof</strong> æŒ‡å®šçš„ç±»å‹ã€çš„è¿”å›ç»“æœï¼Œåªè¦è¿”å›çš„æ˜¯trueå°±å¯ä»¥è®¤å®šä¸ºå’Œç±»å‹åŒ¹é…ï¼Œèƒ½å¤Ÿè·å–åˆ°ã€‚</p><p>javaä¸­ï¼Œinstanceofè¿ç®—ç¬¦ç”¨äºåˆ¤æ–­å‰é¢çš„å¯¹è±¡æ˜¯å¦æ˜¯åé¢çš„ç±»ï¼Œæˆ–å…¶å­ç±»ã€å®ç°ç±»çš„å®ä¾‹ã€‚å¦‚æœæ˜¯è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šç”¨instanceofå…³é”®å­—åšåˆ¤æ–­æ—¶ï¼Œ instanceof æ“ä½œç¬¦çš„å·¦å³æ“ä½œå¿…é¡»æœ‰ç»§æ‰¿æˆ–å®ç°å…³ç³»</p><h4 id="å®éªŒäºŒï¼šä¾èµ–æ³¨å…¥ä¹‹setteræ³¨å…¥"><a href="#å®éªŒäºŒï¼šä¾èµ–æ³¨å…¥ä¹‹setteræ³¨å…¥" class="headerlink" title="å®éªŒäºŒï¼šä¾èµ–æ³¨å…¥ä¹‹setteræ³¨å…¥"></a>å®éªŒäºŒï¼šä¾èµ–æ³¨å…¥ä¹‹setteræ³¨å…¥</h4><p><strong>â‘ åˆ›å»ºå­¦ç”Ÿç±»Student</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.bean;</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoConstructor</span></span><br><span class="line"><span class="meta">@AllConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>â‘¡é…ç½®beanæ—¶ä¸ºå±æ€§èµ‹å€¼</strong></p><p>spring-di.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;studentOne&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hang.spring6.bean.Student&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- propertyæ ‡ç­¾ï¼šé€šè¿‡ç»„ä»¶ç±»çš„setXxx()æ–¹æ³•ç»™ç»„ä»¶å¯¹è±¡è®¾ç½®å±æ€§ --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- nameå±æ€§ï¼šæŒ‡å®šå±æ€§åï¼ˆè¿™ä¸ªå±æ€§åæ˜¯getXxx()ã€setXxx()æ–¹æ³•å®šä¹‰çš„ï¼Œå’Œæˆå‘˜å˜é‡æ— å…³ï¼‰ --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- valueå±æ€§ï¼šæŒ‡å®šå±æ€§å€¼ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1001&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å¼ ä¸‰&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;23&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ç”·&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>â‘¢æµ‹è¯•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDIBySet</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;spring-di.xml&quot;</span>);</span><br><span class="line">    <span class="type">Student</span> <span class="variable">studentOne</span> <span class="operator">=</span> ac.getBean(<span class="string">&quot;studentOne&quot;</span>, Student.class);</span><br><span class="line">    System.out.println(studentOne);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å®éªŒä¸‰ï¼šä¾èµ–æ³¨å…¥ä¹‹æ„é€ å™¨æ³¨å…¥"><a href="#å®éªŒä¸‰ï¼šä¾èµ–æ³¨å…¥ä¹‹æ„é€ å™¨æ³¨å…¥" class="headerlink" title="å®éªŒä¸‰ï¼šä¾èµ–æ³¨å…¥ä¹‹æ„é€ å™¨æ³¨å…¥"></a>å®éªŒä¸‰ï¼šä¾èµ–æ³¨å…¥ä¹‹æ„é€ å™¨æ³¨å…¥</h4><p><strong>â‘ åœ¨Studentç±»ä¸­æ·»åŠ æœ‰å‚æ„é€ </strong></p><p><strong>â‘¡é…ç½®bean</strong></p><p>spring-di.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;studentTwo&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hang.spring6.bean.Student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;1002&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;æå››&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;33&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;å¥³&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼š</p><p>constructor-argæ ‡ç­¾è¿˜æœ‰ä¸¤ä¸ªå±æ€§å¯ä»¥è¿›ä¸€æ­¥æè¿°æ„é€ å™¨å‚æ•°ï¼š</p><ul><li>indexå±æ€§ï¼šæŒ‡å®šå‚æ•°æ‰€åœ¨ä½ç½®çš„ç´¢å¼•ï¼ˆä»0å¼€å§‹ï¼‰</li><li>nameå±æ€§ï¼šæŒ‡å®šå‚æ•°å</li></ul></blockquote><p><strong>â‘¢æµ‹è¯•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDIByConstructor</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;spring-di.xml&quot;</span>);</span><br><span class="line">    <span class="type">Student</span> <span class="variable">studentOne</span> <span class="operator">=</span> ac.getBean(<span class="string">&quot;studentTwo&quot;</span>, Student.class);</span><br><span class="line">    System.out.println(studentOne);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å®éªŒå››ï¼šç‰¹æ®Šå€¼å¤„ç†"><a href="#å®éªŒå››ï¼šç‰¹æ®Šå€¼å¤„ç†" class="headerlink" title="å®éªŒå››ï¼šç‰¹æ®Šå€¼å¤„ç†"></a>å®éªŒå››ï¼šç‰¹æ®Šå€¼å¤„ç†</h4><h5 id="â‘ å­—é¢é‡èµ‹å€¼"><a href="#â‘ å­—é¢é‡èµ‹å€¼" class="headerlink" title="â‘ å­—é¢é‡èµ‹å€¼"></a>â‘ å­—é¢é‡èµ‹å€¼</h5><blockquote><p>ä»€ä¹ˆæ˜¯å­—é¢é‡ï¼Ÿ</p><p>int a &#x3D; 10;</p><p>å£°æ˜ä¸€ä¸ªå˜é‡aï¼Œåˆå§‹åŒ–ä¸º10ï¼Œæ­¤æ—¶aå°±ä¸ä»£è¡¨å­—æ¯aäº†ï¼Œè€Œæ˜¯ä½œä¸ºä¸€ä¸ªå˜é‡çš„åå­—ã€‚å½“æˆ‘ä»¬å¼•ç”¨açš„æ—¶å€™ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ‹¿åˆ°çš„å€¼æ˜¯10ã€‚</p><p>è€Œå¦‚æœaæ˜¯å¸¦å¼•å·çš„ï¼šâ€™aâ€™ï¼Œé‚£ä¹ˆå®ƒç°åœ¨ä¸æ˜¯ä¸€ä¸ªå˜é‡ï¼Œå®ƒå°±æ˜¯ä»£è¡¨aè¿™ä¸ªå­—æ¯æœ¬èº«ï¼Œè¿™å°±æ˜¯å­—é¢é‡ã€‚æ‰€ä»¥å­—é¢é‡æ²¡æœ‰å¼•ç”³å«ä¹‰ï¼Œå°±æ˜¯æˆ‘ä»¬çœ‹åˆ°çš„è¿™ä¸ªæ•°æ®æœ¬èº«ã€‚</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ä½¿ç”¨valueå±æ€§ç»™beançš„å±æ€§èµ‹å€¼æ—¶ï¼ŒSpringä¼šæŠŠvalueå±æ€§çš„å€¼çœ‹åšå­—é¢é‡ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å¼ ä¸‰&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h5 id="â‘¡nullå€¼"><a href="#â‘¡nullå€¼" class="headerlink" title="â‘¡nullå€¼"></a>â‘¡nullå€¼</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">null</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;null&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šå†™æ³•ï¼Œä¸ºnameæ‰€èµ‹çš„å€¼æ˜¯å­—ç¬¦ä¸²null</p></blockquote><h5 id="â‘¢xmlå®ä½“"><a href="#â‘¢xmlå®ä½“" class="headerlink" title="â‘¢xmlå®ä½“"></a>â‘¢xmlå®ä½“</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å°äºå·åœ¨XMLæ–‡æ¡£ä¸­ç”¨æ¥å®šä¹‰æ ‡ç­¾çš„å¼€å§‹ï¼Œä¸èƒ½éšä¾¿ä½¿ç”¨ --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- è§£å†³æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨XMLå®ä½“æ¥ä»£æ›¿ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;expression&quot;</span> <span class="attr">value</span>=<span class="string">&quot;a <span class="symbol">&amp;lt;</span> b&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h5 id="â‘£CDATAèŠ‚"><a href="#â‘£CDATAèŠ‚" class="headerlink" title="â‘£CDATAèŠ‚"></a>â‘£CDATAèŠ‚</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;expression&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- è§£å†³æ–¹æ¡ˆäºŒï¼šä½¿ç”¨CDATAèŠ‚ --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- CDATAä¸­çš„Cä»£è¡¨Characterï¼Œæ˜¯æ–‡æœ¬ã€å­—ç¬¦çš„å«ä¹‰ï¼ŒCDATAå°±è¡¨ç¤ºçº¯æ–‡æœ¬æ•°æ® --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- XMLè§£æå™¨çœ‹åˆ°CDATAèŠ‚å°±çŸ¥é“è¿™é‡Œæ˜¯çº¯æ–‡æœ¬ï¼Œå°±ä¸ä¼šå½“ä½œXMLæ ‡ç­¾æˆ–å±æ€§æ¥è§£æ --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æ‰€ä»¥CDATAèŠ‚ä¸­å†™ä»€ä¹ˆç¬¦å·éƒ½éšæ„ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>&lt;![CDATA[a &lt; b]]&gt;<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="å®éªŒäº”ï¼šä¸ºå¯¹è±¡ç±»å‹å±æ€§èµ‹å€¼"><a href="#å®éªŒäº”ï¼šä¸ºå¯¹è±¡ç±»å‹å±æ€§èµ‹å€¼" class="headerlink" title="å®éªŒäº”ï¼šä¸ºå¯¹è±¡ç±»å‹å±æ€§èµ‹å€¼"></a>å®éªŒäº”ï¼šä¸ºå¯¹è±¡ç±»å‹å±æ€§èµ‹å€¼</h4><p><strong>â‘ åˆ›å»ºç­çº§ç±»Clazz</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoConstructor</span></span><br><span class="line"><span class="meta">@AllConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Clazz</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer clazzId;</span><br><span class="line">    <span class="keyword">private</span> String clazzName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>â‘¡ä¿®æ”¹Studentç±»</strong></p><p>åœ¨Studentç±»ä¸­æ·»åŠ Getã€Setæ–¹æ³•</p><h5 id="æ–¹å¼ä¸€ï¼šå¼•ç”¨å¤–éƒ¨bean"><a href="#æ–¹å¼ä¸€ï¼šå¼•ç”¨å¤–éƒ¨bean" class="headerlink" title="æ–¹å¼ä¸€ï¼šå¼•ç”¨å¤–éƒ¨bean"></a>æ–¹å¼ä¸€ï¼šå¼•ç”¨å¤–éƒ¨bean</h5><p>é…ç½®Clazzç±»å‹çš„beanï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;clazzOne&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hang.spring6.bean.Clazz&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;clazzId&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1111&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;clazzName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;è´¢æºæ»šæ»šç­&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸ºStudentä¸­çš„clazzå±æ€§èµ‹å€¼ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;studentFour&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hang.spring6.bean.Student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1004&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;èµµå…­&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;26&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å¥³&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- refå±æ€§ï¼šå¼•ç”¨IOCå®¹å™¨ä¸­æŸä¸ªbeançš„idï¼Œå°†æ‰€å¯¹åº”çš„beanä¸ºå±æ€§èµ‹å€¼ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;clazz&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;clazzOne&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é”™è¯¯æ¼”ç¤ºï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;studentFour&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hang.spring6.bean.Student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1004&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;èµµå…­&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;26&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å¥³&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;clazz&quot;</span> <span class="attr">value</span>=<span class="string">&quot;clazzOne&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœé”™æŠŠrefå±æ€§å†™æˆäº†valueå±æ€§ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼š Caused by: java.lang.IllegalStateException: Cannot convert value of type â€˜java.lang.Stringâ€™ to required type â€˜com.hang.spring6.bean.Clazzâ€™ for property â€˜clazzâ€™: no matching editors or conversion strategy found </p><p>æ„æ€æ˜¯ä¸èƒ½æŠŠStringç±»å‹è½¬æ¢æˆæˆ‘ä»¬è¦çš„Clazzç±»å‹ï¼Œè¯´æ˜æˆ‘ä»¬ä½¿ç”¨valueå±æ€§æ—¶ï¼ŒSpringåªæŠŠè¿™ä¸ªå±æ€§çœ‹åšä¸€ä¸ªæ™®é€šçš„å­—ç¬¦ä¸²ï¼Œä¸ä¼šè®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªbeançš„idï¼Œæ›´ä¸ä¼šæ ¹æ®å®ƒå»æ‰¾åˆ°beanæ¥èµ‹å€¼</p></blockquote><h5 id="æ–¹å¼äºŒï¼šå†…éƒ¨bean"><a href="#æ–¹å¼äºŒï¼šå†…éƒ¨bean" class="headerlink" title="æ–¹å¼äºŒï¼šå†…éƒ¨bean"></a>æ–¹å¼äºŒï¼šå†…éƒ¨bean</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;studentFour&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hang.spring6.bean.Student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1004&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;èµµå…­&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;26&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å¥³&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;clazz&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- åœ¨ä¸€ä¸ªbeanä¸­å†å£°æ˜ä¸€ä¸ªbeanå°±æ˜¯å†…éƒ¨bean --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å†…éƒ¨beanåªèƒ½ç”¨äºç»™å±æ€§èµ‹å€¼ï¼Œä¸èƒ½åœ¨å¤–éƒ¨é€šè¿‡IOCå®¹å™¨è·å–ï¼Œå› æ­¤å¯ä»¥çœç•¥idå±æ€§ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;clazzInner&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hang.spring6.bean.Clazz&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;clazzId&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2222&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;clazzName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;è¿œå¤§å‰ç¨‹ç­&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="æ–¹å¼ä¸‰ï¼šçº§è”å±æ€§èµ‹å€¼"><a href="#æ–¹å¼ä¸‰ï¼šçº§è”å±æ€§èµ‹å€¼" class="headerlink" title="æ–¹å¼ä¸‰ï¼šçº§è”å±æ€§èµ‹å€¼"></a>æ–¹å¼ä¸‰ï¼šçº§è”å±æ€§èµ‹å€¼</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;studentFour&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hang.spring6.bean.Student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1004&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;èµµå…­&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;26&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å¥³&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;clazz&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;clazzOne&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;clazz.clazzId&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3333&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;clazz.clazzName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æœ€å¼ºç‹è€…ç­&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="å®éªŒå…­ï¼šä¸ºæ•°ç»„ç±»å‹å±æ€§èµ‹å€¼"><a href="#å®éªŒå…­ï¼šä¸ºæ•°ç»„ç±»å‹å±æ€§èµ‹å€¼" class="headerlink" title="å®éªŒå…­ï¼šä¸ºæ•°ç»„ç±»å‹å±æ€§èµ‹å€¼"></a>å®éªŒå…­ï¼šä¸ºæ•°ç»„ç±»å‹å±æ€§èµ‹å€¼</h4><p><strong>â‘ ä¿®æ”¹Studentç±»</strong></p><p>åœ¨Studentç±»ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String[] hobbies;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> String[] getHobbies() &#123;</span><br><span class="line">    <span class="keyword">return</span> hobbies;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHobbies</span><span class="params">(String[] hobbies)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.hobbies = hobbies;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>â‘¡é…ç½®bean</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;studentFour&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hang.spring.bean6.Student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1004&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;èµµå…­&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;26&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å¥³&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- refå±æ€§ï¼šå¼•ç”¨IOCå®¹å™¨ä¸­æŸä¸ªbeançš„idï¼Œå°†æ‰€å¯¹åº”çš„beanä¸ºå±æ€§èµ‹å€¼ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;clazz&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;clazzOne&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hobbies&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>æŠ½çƒŸ<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>å–é…’<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>çƒ«å¤´<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="å®éªŒä¸ƒï¼šä¸ºé›†åˆç±»å‹å±æ€§èµ‹å€¼"><a href="#å®éªŒä¸ƒï¼šä¸ºé›†åˆç±»å‹å±æ€§èµ‹å€¼" class="headerlink" title="å®éªŒä¸ƒï¼šä¸ºé›†åˆç±»å‹å±æ€§èµ‹å€¼"></a>å®éªŒä¸ƒï¼šä¸ºé›†åˆç±»å‹å±æ€§èµ‹å€¼</h4><h5 id="â‘ ä¸ºListé›†åˆç±»å‹å±æ€§èµ‹å€¼"><a href="#â‘ ä¸ºListé›†åˆç±»å‹å±æ€§èµ‹å€¼" class="headerlink" title="â‘ ä¸ºListé›†åˆç±»å‹å±æ€§èµ‹å€¼"></a>â‘ ä¸ºListé›†åˆç±»å‹å±æ€§èµ‹å€¼</h5><p>åœ¨Clazzç±»ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> List&lt;Student&gt; students;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> List&lt;Student&gt; <span class="title function_">getStudents</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> students;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setStudents</span><span class="params">(List&lt;Student&gt; students)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.students = students;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®beanï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;clazzTwo&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hang.spring6.bean.Clazz&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;clazzId&quot;</span> <span class="attr">value</span>=<span class="string">&quot;4444&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;clazzName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Javaee0222&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;students&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;studentOne&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;studentTwo&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;studentThree&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>è‹¥ä¸ºSeté›†åˆç±»å‹å±æ€§èµ‹å€¼ï¼Œåªéœ€è¦å°†å…¶ä¸­çš„listæ ‡ç­¾æ”¹ä¸ºsetæ ‡ç­¾å³å¯</p></blockquote><h5 id="â‘¡ä¸ºMapé›†åˆç±»å‹å±æ€§èµ‹å€¼"><a href="#â‘¡ä¸ºMapé›†åˆç±»å‹å±æ€§èµ‹å€¼" class="headerlink" title="â‘¡ä¸ºMapé›†åˆç±»å‹å±æ€§èµ‹å€¼"></a>â‘¡ä¸ºMapé›†åˆç±»å‹å±æ€§èµ‹å€¼</h5><p>åˆ›å»ºæ•™å¸ˆç±»Teacherï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.bean;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoConstructor</span></span><br><span class="line"><span class="meta">@AllConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Teacher</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer teacherId;</span><br><span class="line">    <span class="keyword">private</span> String teacherName;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨Studentç±»ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç (æ·»åŠ è€å¸ˆé›†åˆ,ä¸€ä¸ªå­¦ç”Ÿå¯¹åº”å¤šä¸ªè€å¸ˆ)ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Map&lt;String, Teacher&gt; teacherMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Map&lt;String, Teacher&gt; <span class="title function_">getTeacherMap</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> teacherMap;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTeacherMap</span><span class="params">(Map&lt;String, Teacher&gt; teacherMap)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.teacherMap = teacherMap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®beanï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;teacherOne&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hang.spring6.bean.Teacher&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;teacherId&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10010&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;teacherName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å¤§å®&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;teacherTwo&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hang.spring6.bean.Teacher&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;teacherId&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10086&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;teacherName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;äºŒå®&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;studentFour&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hang.spring6.bean.Student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1004&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;èµµå…­&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;26&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å¥³&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- refå±æ€§ï¼šå¼•ç”¨IOCå®¹å™¨ä¸­æŸä¸ªbeançš„idï¼Œå°†æ‰€å¯¹åº”çš„beanä¸ºå±æ€§èµ‹å€¼ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;clazz&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;clazzOne&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hobbies&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>æŠ½çƒŸ<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>å–é…’<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>çƒ«å¤´<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;teacherMap&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">key</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>10010<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;teacherOne&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">key</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">value</span>&gt;</span>10086<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;teacherTwo&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="â‘¢å¼•ç”¨é›†åˆç±»å‹çš„bean"><a href="#â‘¢å¼•ç”¨é›†åˆç±»å‹çš„bean" class="headerlink" title="â‘¢å¼•ç”¨é›†åˆç±»å‹çš„bean"></a>â‘¢å¼•ç”¨é›†åˆç±»å‹çš„bean</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--listé›†åˆç±»å‹çš„bean--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">util:list</span> <span class="attr">id</span>=<span class="string">&quot;students&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;studentOne&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;studentTwo&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;studentThree&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">util:list</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--mapé›†åˆç±»å‹çš„bean--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">util:map</span> <span class="attr">id</span>=<span class="string">&quot;teacherMap&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">entry</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>10010<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;teacherOne&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">entry</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>10086<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;teacherTwo&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ref</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">util:map</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;clazzTwo&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hang.spring6.bean.Clazz&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;clazzId&quot;</span> <span class="attr">value</span>=<span class="string">&quot;4444&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;clazzName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Javaee0222&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;students&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;students&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;studentFour&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hang.spring6.bean.Student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1004&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;èµµå…­&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;26&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">value</span>=<span class="string">&quot;å¥³&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- refå±æ€§ï¼šå¼•ç”¨IOCå®¹å™¨ä¸­æŸä¸ªbeançš„idï¼Œå°†æ‰€å¯¹åº”çš„beanä¸ºå±æ€§èµ‹å€¼ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;clazz&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;clazzOne&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hobbies&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>æŠ½çƒŸ<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>å–é…’<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>çƒ«å¤´<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;teacherMap&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;teacherMap&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>ä½¿ç”¨util:listã€util:mapæ ‡ç­¾å¿…é¡»å¼•å…¥ç›¸åº”çš„å‘½åç©ºé—´</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:util</span>=<span class="string">&quot;http://www.springframework.org/schema/util&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/util</span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.springframework.org/schema/util/spring-util.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></blockquote><h4 id="å®éªŒå…«ï¼špå‘½åç©ºé—´"><a href="#å®éªŒå…«ï¼špå‘½åç©ºé—´" class="headerlink" title="å®éªŒå…«ï¼špå‘½åç©ºé—´"></a>å®éªŒå…«ï¼špå‘½åç©ºé—´</h4><p>å¼•å…¥på‘½åç©ºé—´</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:util</span>=<span class="string">&quot;http://www.springframework.org/schema/util&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/util</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/util/spring-util.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¼•å…¥på‘½åç©ºé—´åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¸ºbeançš„å„ä¸ªå±æ€§èµ‹å€¼</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;studentSix&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hang.spring6.bean.Student&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">p:id</span>=<span class="string">&quot;1006&quot;</span> <span class="attr">p:name</span>=<span class="string">&quot;å°æ˜&quot;</span> <span class="attr">p:clazz-ref</span>=<span class="string">&quot;clazzOne&quot;</span> <span class="attr">p:teacherMap-ref</span>=<span class="string">&quot;teacherMap&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="å®éªŒä¹ï¼šå¼•å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶"><a href="#å®éªŒä¹ï¼šå¼•å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶" class="headerlink" title="å®éªŒä¹ï¼šå¼•å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶"></a>å®éªŒä¹ï¼šå¼•å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶</h4><p><strong>â‘ åŠ å…¥ä¾èµ–</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- MySQLé©±åŠ¨ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.30<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- æ•°æ®æº --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.15<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>â‘¡åˆ›å»ºå¤–éƒ¨å±æ€§æ–‡ä»¶</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jdbc.user</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">jdbc.password</span>=<span class="string">hang</span></span><br><span class="line"><span class="attr">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/ssm?serverTimezone=UTC</span></span><br><span class="line"><span class="attr">jdbc.driver</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br></pre></td></tr></table></figure><p><strong>â‘¢å¼•å…¥å±æ€§æ–‡ä»¶</strong></p><p>å¼•å…¥context åç§°ç©ºé—´</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å¼•å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:jdbc.properties&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šåœ¨ä½¿ç”¨ <a href="context:property-placeholder">context:property-placeholder</a> å…ƒç´ åŠ è½½å¤–åŒ…é…ç½®æ–‡ä»¶åŠŸèƒ½å‰ï¼Œé¦–å…ˆéœ€è¦åœ¨ XML é…ç½®çš„ä¸€çº§æ ‡ç­¾ <beans> ä¸­æ·»åŠ  context ç›¸å…³çš„çº¦æŸã€‚</beans></p><p><strong>â‘£é…ç½®bean</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;druidDataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.user&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>â‘¤æµ‹è¯•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDataSource</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;spring-datasource.xml&quot;</span>);</span><br><span class="line">    <span class="type">DataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> ac.getBean(DataSource.class);</span><br><span class="line">    <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> dataSource.getConnection();</span><br><span class="line">    System.out.println(connection);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å®éªŒåï¼šbeançš„ä½œç”¨åŸŸ"><a href="#å®éªŒåï¼šbeançš„ä½œç”¨åŸŸ" class="headerlink" title="å®éªŒåï¼šbeançš„ä½œç”¨åŸŸ"></a>å®éªŒåï¼šbeançš„ä½œç”¨åŸŸ</h4><p><strong>â‘ æ¦‚å¿µ</strong></p><p>åœ¨Springä¸­å¯ä»¥é€šè¿‡é…ç½®beanæ ‡ç­¾çš„scopeå±æ€§æ¥æŒ‡å®šbeançš„ä½œç”¨åŸŸèŒƒå›´ï¼Œå„å–å€¼å«ä¹‰å‚åŠ ä¸‹è¡¨ï¼š</p><table><thead><tr><th>å–å€¼</th><th>å«ä¹‰</th><th>åˆ›å»ºå¯¹è±¡çš„æ—¶æœº</th></tr></thead><tbody><tr><td>singletonï¼ˆé»˜è®¤ï¼‰</td><td>åœ¨IOCå®¹å™¨ä¸­ï¼Œè¿™ä¸ªbeançš„å¯¹è±¡å§‹ç»ˆä¸ºå•å®ä¾‹</td><td>IOCå®¹å™¨åˆå§‹åŒ–æ—¶</td></tr><tr><td>prototype</td><td>è¿™ä¸ªbeanåœ¨IOCå®¹å™¨ä¸­æœ‰å¤šä¸ªå®ä¾‹</td><td>è·å–beanæ—¶</td></tr></tbody></table><p>å¦‚æœæ˜¯åœ¨WebApplicationContextç¯å¢ƒä¸‹è¿˜ä¼šæœ‰å¦å¤–å‡ ä¸ªä½œç”¨åŸŸï¼ˆä½†ä¸å¸¸ç”¨ï¼‰ï¼š</p><table><thead><tr><th>å–å€¼</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>request</td><td>åœ¨ä¸€ä¸ªè¯·æ±‚èŒƒå›´å†…æœ‰æ•ˆ</td></tr><tr><td>session</td><td>åœ¨ä¸€ä¸ªä¼šè¯èŒƒå›´å†…æœ‰æ•ˆ</td></tr></tbody></table><p><strong>â‘¡åˆ›å»ºç±»User</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.bean;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(Integer id, String username, String password, Integer age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUsername</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUsername</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPassword</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPassword</span><span class="params">(String password)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(Integer age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, username=&#x27;&quot;</span> + username + <span class="string">&#x27;/&#x27;</span><span class="string">&#x27; +</span></span><br><span class="line"><span class="string">                &quot;, password=&#x27;</span><span class="string">&quot; + password + &#x27;/&#x27;&#x27; +</span></span><br><span class="line"><span class="string">                &quot;</span>, age=<span class="string">&quot; + age +</span></span><br><span class="line"><span class="string">                &#x27;&#125;&#x27;;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>â‘¢é…ç½®bean</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- scopeå±æ€§ï¼šå–å€¼singletonï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œbeanåœ¨IOCå®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼ŒIOCå®¹å™¨åˆå§‹åŒ–æ—¶åˆ›å»ºå¯¹è±¡ --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- scopeå±æ€§ï¼šå–å€¼prototypeï¼Œbeanåœ¨IOCå®¹å™¨ä¸­å¯ä»¥æœ‰å¤šä¸ªå®ä¾‹ï¼ŒgetBean()æ—¶åˆ›å»ºå¯¹è±¡ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.hang.spring6.bean.User&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>â‘£æµ‹è¯•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testBeanScope</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;spring-scope.xml&quot;</span>);</span><br><span class="line">    <span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> ac.getBean(User.class);</span><br><span class="line">    <span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> ac.getBean(User.class);</span><br><span class="line">    System.out.println(user1==user2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å®éªŒåä¸€ï¼šbeanç”Ÿå‘½å‘¨æœŸ"><a href="#å®éªŒåä¸€ï¼šbeanç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="å®éªŒåä¸€ï¼šbeanç”Ÿå‘½å‘¨æœŸ"></a>å®éªŒåä¸€ï¼šbeanç”Ÿå‘½å‘¨æœŸ</h4><p><strong>â‘ å…·ä½“çš„ç”Ÿå‘½å‘¨æœŸè¿‡ç¨‹</strong></p><ul><li><p>beanå¯¹è±¡åˆ›å»ºï¼ˆè°ƒç”¨æ— å‚æ„é€ å™¨ï¼‰</p></li><li><p>ç»™beanå¯¹è±¡è®¾ç½®å±æ€§</p></li><li><p>beançš„åç½®å¤„ç†å™¨ï¼ˆåˆå§‹åŒ–ä¹‹å‰ï¼‰</p></li><li><p>beanå¯¹è±¡åˆå§‹åŒ–ï¼ˆéœ€åœ¨é…ç½®beanæ—¶æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•ï¼‰</p></li><li><p>beançš„åç½®å¤„ç†å™¨ï¼ˆåˆå§‹åŒ–ä¹‹åï¼‰</p></li><li><p>beanå¯¹è±¡å°±ç»ªå¯ä»¥ä½¿ç”¨</p></li><li><p>beanå¯¹è±¡é”€æ¯ï¼ˆéœ€åœ¨é…ç½®beanæ—¶æŒ‡å®šé”€æ¯æ–¹æ³•ï¼‰</p></li><li><p>IOCå®¹å™¨å…³é—­</p></li></ul><p><strong>â‘¡ä¿®æ”¹ç±»User</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç”Ÿå‘½å‘¨æœŸï¼š1ã€åˆ›å»ºå¯¹è±¡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(Integer id, String username, String password, Integer age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç”Ÿå‘½å‘¨æœŸï¼š2ã€ä¾èµ–æ³¨å…¥&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUsername</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUsername</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPassword</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPassword</span><span class="params">(String password)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(Integer age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initMethod</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç”Ÿå‘½å‘¨æœŸï¼š3ã€åˆå§‹åŒ–&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroyMethod</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç”Ÿå‘½å‘¨æœŸï¼š5ã€é”€æ¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, username=&#x27;&quot;</span> + username + <span class="string">&#x27;/&#x27;</span><span class="string">&#x27; +</span></span><br><span class="line"><span class="string">                &quot;, password=&#x27;</span><span class="string">&quot; + password + &#x27;/&#x27;&#x27; +</span></span><br><span class="line"><span class="string">                &quot;</span>, age=<span class="string">&quot; + age +</span></span><br><span class="line"><span class="string">                &#x27;&#125;&#x27;;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„å…¶ä¸­çš„initMethod()å’ŒdestroyMethod()ï¼Œå¯ä»¥é€šè¿‡é…ç½®beanæŒ‡å®šä¸ºåˆå§‹åŒ–å’Œé”€æ¯çš„æ–¹æ³•</p></blockquote><p><strong>â‘¢é…ç½®bean</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ä½¿ç”¨init-methodå±æ€§æŒ‡å®šåˆå§‹åŒ–æ–¹æ³• --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ä½¿ç”¨destroy-methodå±æ€§æŒ‡å®šé”€æ¯æ–¹æ³• --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.hang.spring6.bean.User&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;initMethod&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;destroyMethod&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1001&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;admin&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;23&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>â‘£æµ‹è¯•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testLife</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;spring-lifecycle.xml&quot;</span>);</span><br><span class="line">    <span class="type">User</span> <span class="variable">bean</span> <span class="operator">=</span> ac.getBean(User.class);</span><br><span class="line">    System.out.println(<span class="string">&quot;ç”Ÿå‘½å‘¨æœŸï¼š4ã€é€šè¿‡IOCå®¹å™¨è·å–beanå¹¶ä½¿ç”¨&quot;</span>);</span><br><span class="line">    ac.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>â‘¤beançš„åç½®å¤„ç†å™¨</strong></p><p>beançš„åç½®å¤„ç†å™¨ä¼šåœ¨ç”Ÿå‘½å‘¨æœŸçš„åˆå§‹åŒ–å‰åæ·»åŠ é¢å¤–çš„æ“ä½œï¼Œéœ€è¦å®ç°BeanPostProcessoræ¥å£ï¼Œä¸”é…ç½®åˆ°IOCå®¹å™¨ä¸­ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œbeanåç½®å¤„ç†å™¨ä¸æ˜¯å•ç‹¬é’ˆå¯¹æŸä¸€ä¸ªbeanç”Ÿæ•ˆï¼Œè€Œæ˜¯é’ˆå¯¹IOCå®¹å™¨ä¸­æ‰€æœ‰beanéƒ½ä¼šæ‰§è¡Œ</p><p>åˆ›å»ºbeançš„åç½®å¤„ç†å™¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.process;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.BeanPostProcessor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;â˜†â˜†â˜†&quot;</span> + beanName + <span class="string">&quot; = &quot;</span> + bean);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;â˜…â˜…â˜…&quot;</span> + beanName + <span class="string">&quot; = &quot;</span> + bean);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨IOCå®¹å™¨ä¸­é…ç½®åç½®å¤„ç†å™¨ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- beançš„åç½®å¤„ç†å™¨è¦æ”¾å…¥IOCå®¹å™¨æ‰èƒ½ç”Ÿæ•ˆ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myBeanProcessor&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hang.spring6.process.MyBeanProcessor&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><h4 id="å®éªŒåäºŒï¼šFactoryBean"><a href="#å®éªŒåäºŒï¼šFactoryBean" class="headerlink" title="å®éªŒåäºŒï¼šFactoryBean"></a>å®éªŒåäºŒï¼šFactoryBean</h4><p><strong>â‘ ç®€ä»‹</strong></p><p>FactoryBeanæ˜¯Springæä¾›çš„ä¸€ç§æ•´åˆç¬¬ä¸‰æ–¹æ¡†æ¶çš„å¸¸ç”¨æœºåˆ¶ã€‚å’Œæ™®é€šçš„beanä¸åŒï¼Œé…ç½®ä¸€ä¸ªFactoryBeanç±»å‹çš„beanï¼Œåœ¨è·å–beançš„æ—¶å€™å¾—åˆ°çš„å¹¶ä¸æ˜¯classå±æ€§ä¸­é…ç½®çš„è¿™ä¸ªç±»çš„å¯¹è±¡ï¼Œè€Œæ˜¯getObject()æ–¹æ³•çš„è¿”å›å€¼ã€‚é€šè¿‡è¿™ç§æœºåˆ¶ï¼ŒSpringå¯ä»¥å¸®æˆ‘ä»¬æŠŠå¤æ‚ç»„ä»¶åˆ›å»ºçš„è¯¦ç»†è¿‡ç¨‹å’Œç¹çç»†èŠ‚éƒ½å±è”½èµ·æ¥ï¼ŒåªæŠŠæœ€ç®€æ´çš„ä½¿ç”¨ç•Œé¢å±•ç¤ºç»™æˆ‘ä»¬ã€‚</p><p>å°†æ¥æˆ‘ä»¬æ•´åˆMybatisæ—¶ï¼ŒSpringå°±æ˜¯é€šè¿‡FactoryBeanæœºåˆ¶æ¥å¸®æˆ‘ä»¬åˆ›å»ºSqlSessionFactoryå¯¹è±¡çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Copyright 2002-2020 the original author or authors.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="line"><span class="comment"> * you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment"> * You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *      https://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"> * See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"> * limitations under the License.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> org.springframework.beans.factory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.lang.Nullable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Interface to be implemented by objects used within a &#123;<span class="doctag">@link</span> BeanFactory&#125; which</span></span><br><span class="line"><span class="comment"> * are themselves factories for individual objects. If a bean implements this</span></span><br><span class="line"><span class="comment"> * interface, it is used as a factory for an object to expose, not directly as a</span></span><br><span class="line"><span class="comment"> * bean instance that will be exposed itself.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;&lt;b&gt;NB: A bean that implements this interface cannot be used as a normal bean.&lt;/b&gt;</span></span><br><span class="line"><span class="comment"> * A FactoryBean is defined in a bean style, but the object exposed for bean</span></span><br><span class="line"><span class="comment"> * references (&#123;<span class="doctag">@link</span> #getObject()&#125;) is always the object that it creates.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;FactoryBeans can support singletons and prototypes, and can either create</span></span><br><span class="line"><span class="comment"> * objects lazily on demand or eagerly on startup. The &#123;<span class="doctag">@link</span> SmartFactoryBean&#125;</span></span><br><span class="line"><span class="comment"> * interface allows for exposing more fine-grained behavioral metadata.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;This interface is heavily used within the framework itself, for example for</span></span><br><span class="line"><span class="comment"> * the AOP &#123;<span class="doctag">@link</span> org.springframework.aop.framework.ProxyFactoryBean&#125; or the</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> org.springframework.jndi.JndiObjectFactoryBean&#125;. It can be used for</span></span><br><span class="line"><span class="comment"> * custom components as well; however, this is only common for infrastructure code.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;&lt;b&gt;&#123;<span class="doctag">@code</span> FactoryBean&#125; is a programmatic contract. Implementations are not</span></span><br><span class="line"><span class="comment"> * supposed to rely on annotation-driven injection or other reflective facilities.&lt;/b&gt;</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> #getObjectType()&#125; &#123;<span class="doctag">@link</span> #getObject()&#125; invocations may arrive early in the</span></span><br><span class="line"><span class="comment"> * bootstrap process, even ahead of any post-processor setup. If you need access to</span></span><br><span class="line"><span class="comment"> * other beans, implement &#123;<span class="doctag">@link</span> BeanFactoryAware&#125; and obtain them programmatically.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;&lt;b&gt;The container is only responsible for managing the lifecycle of the FactoryBean</span></span><br><span class="line"><span class="comment"> * instance, not the lifecycle of the objects created by the FactoryBean.&lt;/b&gt; Therefore,</span></span><br><span class="line"><span class="comment"> * a destroy method on an exposed bean object (such as &#123;<span class="doctag">@link</span> java.io.Closeable#close()&#125;</span></span><br><span class="line"><span class="comment"> * will &lt;i&gt;not&lt;/i&gt; be called automatically. Instead, a FactoryBean should implement</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> DisposableBean&#125; and delegate any such close call to the underlying object.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Finally, FactoryBean objects participate in the containing BeanFactory&#x27;s</span></span><br><span class="line"><span class="comment"> * synchronization of bean creation. There is usually no need for internal</span></span><br><span class="line"><span class="comment"> * synchronization other than for purposes of lazy initialization within the</span></span><br><span class="line"><span class="comment"> * FactoryBean itself (or the like).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Rod Johnson</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Juergen Hoeller</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 08.03.2003</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt; the bean type</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> org.springframework.beans.factory.BeanFactory</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> org.springframework.aop.framework.ProxyFactoryBean</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> org.springframework.jndi.JndiObjectFactoryBean</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FactoryBean</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The name of an attribute that can be</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@link</span> org.springframework.core.AttributeAccessor#setAttribute set&#125; on a</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@link</span> org.springframework.beans.factory.config.BeanDefinition&#125; so that</span></span><br><span class="line"><span class="comment">     * factory beans can signal their object type when it can&#x27;t be deduced from</span></span><br><span class="line"><span class="comment">     * the factory bean class.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 5.2</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">OBJECT_TYPE_ATTRIBUTE</span> <span class="operator">=</span> <span class="string">&quot;factoryBeanObjectType&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Return an instance (possibly shared or independent) of the object</span></span><br><span class="line"><span class="comment">     * managed by this factory.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;As with a &#123;<span class="doctag">@link</span> BeanFactory&#125;, this allows support for both the</span></span><br><span class="line"><span class="comment">     * Singleton and Prototype design pattern.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;If this FactoryBean is not fully initialized yet at the time of</span></span><br><span class="line"><span class="comment">     * the call (for example because it is involved in a circular reference),</span></span><br><span class="line"><span class="comment">     * throw a corresponding &#123;<span class="doctag">@link</span> FactoryBeanNotInitializedException&#125;.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;As of Spring 2.0, FactoryBeans are allowed to return &#123;<span class="doctag">@code</span> null&#125;</span></span><br><span class="line"><span class="comment">     * objects. The factory will consider this as normal value to be used; it</span></span><br><span class="line"><span class="comment">     * will not throw a FactoryBeanNotInitializedException in this case anymore.</span></span><br><span class="line"><span class="comment">     * FactoryBean implementations are encouraged to throw</span></span><br><span class="line"><span class="comment">     * FactoryBeanNotInitializedException themselves now, as appropriate.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> an instance of the bean (can be &#123;<span class="doctag">@code</span> null&#125;)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception in case of creation errors</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> FactoryBeanNotInitializedException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    T <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Return the type of object that this FactoryBean creates,</span></span><br><span class="line"><span class="comment">     * or &#123;<span class="doctag">@code</span> null&#125; if not known in advance.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;This allows one to check for specific types of beans without</span></span><br><span class="line"><span class="comment">     * instantiating objects, for example on autowiring.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;In the case of implementations that are creating a singleton object,</span></span><br><span class="line"><span class="comment">     * this method should try to avoid singleton creation as far as possible;</span></span><br><span class="line"><span class="comment">     * it should rather estimate the type in advance.</span></span><br><span class="line"><span class="comment">     * For prototypes, returning a meaningful type here is advisable too.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;This method can be called &lt;i&gt;before&lt;/i&gt; this FactoryBean has</span></span><br><span class="line"><span class="comment">     * been fully initialized. It must not rely on state created during</span></span><br><span class="line"><span class="comment">     * initialization; of course, it can still use such state if available.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;&lt;b&gt;<span class="doctag">NOTE:</span>&lt;/b&gt; Autowiring will simply ignore FactoryBeans that return</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> null&#125; here. Therefore it is highly recommended to implement</span></span><br><span class="line"><span class="comment">     * this method properly, using the current state of the FactoryBean.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the type of object that this FactoryBean creates,</span></span><br><span class="line"><span class="comment">     * or &#123;<span class="doctag">@code</span> null&#125; if not known at the time of the call</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> ListableBeanFactory#getBeansOfType</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    Class&lt;?&gt; getObjectType();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Is the object managed by this factory a singleton? That is,</span></span><br><span class="line"><span class="comment">     * will &#123;<span class="doctag">@link</span> #getObject()&#125; always return the same object</span></span><br><span class="line"><span class="comment">     * (a reference that can be cached)?</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;&lt;b&gt;<span class="doctag">NOTE:</span>&lt;/b&gt; If a FactoryBean indicates to hold a singleton object,</span></span><br><span class="line"><span class="comment">     * the object returned from &#123;<span class="doctag">@code</span> getObject()&#125; might get cached</span></span><br><span class="line"><span class="comment">     * by the owning BeanFactory. Hence, do not return &#123;<span class="doctag">@code</span> true&#125;</span></span><br><span class="line"><span class="comment">     * unless the FactoryBean always exposes the same reference.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;The singleton status of the FactoryBean itself will generally</span></span><br><span class="line"><span class="comment">     * be provided by the owning BeanFactory; usually, it has to be</span></span><br><span class="line"><span class="comment">     * defined as singleton there.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;&lt;b&gt;<span class="doctag">NOTE:</span>&lt;/b&gt; This method returning &#123;<span class="doctag">@code</span> false&#125; does not</span></span><br><span class="line"><span class="comment">     * necessarily indicate that returned objects are independent instances.</span></span><br><span class="line"><span class="comment">     * An implementation of the extended &#123;<span class="doctag">@link</span> SmartFactoryBean&#125; interface</span></span><br><span class="line"><span class="comment">     * may explicitly indicate independent instances through its</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@link</span> SmartFactoryBean#isPrototype()&#125; method. Plain &#123;<span class="doctag">@link</span> FactoryBean&#125;</span></span><br><span class="line"><span class="comment">     * implementations which do not implement this extended interface are</span></span><br><span class="line"><span class="comment">     * simply assumed to always return independent instances if the</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> isSingleton()&#125; implementation returns &#123;<span class="doctag">@code</span> false&#125;.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;The default implementation returns &#123;<span class="doctag">@code</span> true&#125;, since a</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> FactoryBean&#125; typically manages a singleton instance.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> whether the exposed object is a singleton</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #getObject()</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> SmartFactoryBean#isPrototype()</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">isSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>â‘¡åˆ›å»ºç±»UserFactoryBean</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.bean;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserFactoryBean</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;User&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> User.class;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>â‘¢é…ç½®bean</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;user&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hang.spring6.bean.UserFactoryBean&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>â‘£æµ‹è¯•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUserFactoryBean</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//è·å–IOCå®¹å™¨</span></span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;spring-factorybean.xml&quot;</span>);</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) ac.getBean(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">    System.out.println(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å®éªŒåä¸‰ï¼šåŸºäºxmlè‡ªåŠ¨è£…é…"><a href="#å®éªŒåä¸‰ï¼šåŸºäºxmlè‡ªåŠ¨è£…é…" class="headerlink" title="å®éªŒåä¸‰ï¼šåŸºäºxmlè‡ªåŠ¨è£…é…"></a>å®éªŒåä¸‰ï¼šåŸºäºxmlè‡ªåŠ¨è£…é…</h4><blockquote><p>è‡ªåŠ¨è£…é…ï¼š</p><p>æ ¹æ®æŒ‡å®šçš„ç­–ç•¥ï¼Œåœ¨IOCå®¹å™¨ä¸­åŒ¹é…æŸä¸€ä¸ªbeanï¼Œè‡ªåŠ¨ä¸ºæŒ‡å®šçš„beanä¸­æ‰€ä¾èµ–çš„ç±»ç±»å‹æˆ–æ¥å£ç±»å‹å±æ€§èµ‹å€¼</p></blockquote><p><strong>â‘ åœºæ™¯æ¨¡æ‹Ÿ</strong></p><p>åˆ›å»ºç±»UserController</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.autowire.controller</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserService</span><span class="params">(UserService userService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userService = userService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveUser</span><span class="params">()</span>&#123;</span><br><span class="line">        userService.saveUser();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºæ¥å£UserService</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.autowire.service</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">saveUser</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºç±»UserServiceImplå®ç°æ¥å£UserService</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.autowire.service.impl</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserDao</span><span class="params">(UserDao userDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userDao = userDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveUser</span><span class="params">()</span> &#123;</span><br><span class="line">        userDao.saveUser();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºæ¥å£UserDao</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.autowire.dao</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">saveUser</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºç±»UserDaoImplå®ç°æ¥å£UserDao</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.autowire.dao.impl</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveUser</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¿å­˜æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>â‘¡é…ç½®bean</strong></p><blockquote><p>ä½¿ç”¨beanæ ‡ç­¾çš„autowireå±æ€§è®¾ç½®è‡ªåŠ¨è£…é…æ•ˆæœ</p><p>è‡ªåŠ¨è£…é…æ–¹å¼ï¼šbyType</p><p>byTypeï¼šæ ¹æ®ç±»å‹åŒ¹é…IOCå®¹å™¨ä¸­çš„æŸä¸ªå…¼å®¹ç±»å‹çš„beanï¼Œä¸ºå±æ€§è‡ªåŠ¨èµ‹å€¼</p><p>è‹¥åœ¨IOCä¸­ï¼Œæ²¡æœ‰ä»»ä½•ä¸€ä¸ªå…¼å®¹ç±»å‹çš„beanèƒ½å¤Ÿä¸ºå±æ€§èµ‹å€¼ï¼Œåˆ™è¯¥å±æ€§ä¸è£…é…ï¼Œå³å€¼ä¸ºé»˜è®¤å€¼null</p><p>è‹¥åœ¨IOCä¸­ï¼Œæœ‰å¤šä¸ªå…¼å®¹ç±»å‹çš„beanèƒ½å¤Ÿä¸ºå±æ€§èµ‹å€¼ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸NoUniqueBeanDefinitionException</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userController&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hang.spring6.autowire.controller.UserController&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;byType&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hang.spring6.autowire.service.impl.UserServiceImpl&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;byType&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hang.spring6.autowire.dao.impl.UserDaoImpl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>è‡ªåŠ¨è£…é…æ–¹å¼ï¼šbyName</p><p>byNameï¼šå°†è‡ªåŠ¨è£…é…çš„å±æ€§çš„å±æ€§åï¼Œä½œä¸ºbeançš„idåœ¨IOCå®¹å™¨ä¸­åŒ¹é…ç›¸å¯¹åº”çš„beanè¿›è¡Œèµ‹å€¼</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userController&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hang.spring6.autowire.controller.UserController&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;byName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hang.spring6.autowire.service.impl.UserServiceImpl&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;byName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userServiceImpl&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hang.spring6.autowire.service.impl.UserServiceImpl&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;byName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hang.spring6.autowire.dao.impl.UserDaoImpl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDaoImpl&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.hang.spring6.autowire.dao.impl.UserDaoImpl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>â‘¢æµ‹è¯•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAutoWireByXML</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;autowire-xml.xml&quot;</span>);</span><br><span class="line">    <span class="type">UserController</span> <span class="variable">userController</span> <span class="operator">=</span> ac.getBean(UserController.class);</span><br><span class="line">    userController.saveUser();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŸºäºæ³¨è§£ç®¡ç†Beanï¼ˆâ˜†ï¼‰"><a href="#åŸºäºæ³¨è§£ç®¡ç†Beanï¼ˆâ˜†ï¼‰" class="headerlink" title="åŸºäºæ³¨è§£ç®¡ç†Beanï¼ˆâ˜†ï¼‰"></a>åŸºäºæ³¨è§£ç®¡ç†Beanï¼ˆâ˜†ï¼‰</h3><p>ä» Java 5 å¼€å§‹ï¼ŒJava å¢åŠ äº†å¯¹æ³¨è§£ï¼ˆAnnotationï¼‰çš„æ”¯æŒï¼Œå®ƒæ˜¯ä»£ç ä¸­çš„ä¸€ç§ç‰¹æ®Šæ ‡è®°ï¼Œå¯ä»¥åœ¨ç¼–è¯‘ã€ç±»åŠ è½½å’Œè¿è¡Œæ—¶è¢«è¯»å–ï¼Œæ‰§è¡Œç›¸åº”çš„å¤„ç†ã€‚å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡æ³¨è§£åœ¨ä¸æ”¹å˜åŸæœ‰ä»£ç å’Œé€»è¾‘çš„æƒ…å†µä¸‹ï¼Œåœ¨æºä»£ç ä¸­åµŒå…¥è¡¥å……ä¿¡æ¯ã€‚</p><p>Spring ä» 2.5 ç‰ˆæœ¬å¼€å§‹æä¾›äº†å¯¹æ³¨è§£æŠ€æœ¯çš„å…¨é¢æ”¯æŒï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ³¨è§£æ¥å®ç°è‡ªåŠ¨è£…é…ï¼Œç®€åŒ– Spring çš„ XML é…ç½®ã€‚</p><p>Spring é€šè¿‡æ³¨è§£å®ç°è‡ªåŠ¨è£…é…çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>å¼•å…¥ä¾èµ–</li><li>å¼€å¯ç»„ä»¶æ‰«æ</li><li>ä½¿ç”¨æ³¨è§£å®šä¹‰ Bean</li><li>ä¾èµ–æ³¨å…¥</li></ol><h4 id="æ­å»ºå­æ¨¡å—spring6-ioc-annotation"><a href="#æ­å»ºå­æ¨¡å—spring6-ioc-annotation" class="headerlink" title="æ­å»ºå­æ¨¡å—spring6-ioc-annotation"></a>æ­å»ºå­æ¨¡å—spring6-ioc-annotation</h4><p><strong>â‘ æ­å»ºæ¨¡å—</strong></p><p>æ­å»ºæ–¹å¼å¦‚ï¼šspring6-ioc-xml</p><p><strong>â‘¡å¼•å…¥é…ç½®æ–‡ä»¶</strong></p><p>å¼•å…¥spring-ioc-xmlæ¨¡å—æ—¥å¿—log4j2.xml</p><p><strong>â‘¢æ·»åŠ ä¾èµ–</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--spring contextä¾èµ–--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å½“ä½ å¼•å…¥Spring Contextä¾èµ–ä¹‹åï¼Œè¡¨ç¤ºå°†Springçš„åŸºç¡€ä¾èµ–å¼•å…¥äº†--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.0.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--junit5æµ‹è¯•--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.jupiter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-jupiter-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--log4j2çš„ä¾èµ–--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.19.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-slf4j2-impl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.19.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="å¼€å¯ç»„ä»¶æ‰«æ"><a href="#å¼€å¯ç»„ä»¶æ‰«æ" class="headerlink" title="å¼€å¯ç»„ä»¶æ‰«æ"></a>å¼€å¯ç»„ä»¶æ‰«æ</h4><p>Spring é»˜è®¤ä¸ä½¿ç”¨æ³¨è§£è£…é… Beanï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨ Spring çš„ XML é…ç½®ä¸­ï¼Œé€šè¿‡ <a href="context:component-scan">context:component-scan</a> å…ƒç´ å¼€å¯ Spring Beansçš„è‡ªåŠ¨æ‰«æåŠŸèƒ½ã€‚å¼€å¯æ­¤åŠŸèƒ½åï¼ŒSpring ä¼šè‡ªåŠ¨ä»æ‰«ææŒ‡å®šçš„åŒ…ï¼ˆbase-package å±æ€§è®¾ç½®ï¼‰åŠå…¶å­åŒ…ä¸‹çš„æ‰€æœ‰ç±»ï¼Œå¦‚æœç±»ä¸Šä½¿ç”¨äº† @Component æ³¨è§£ï¼Œå°±å°†è¯¥ç±»è£…é…åˆ°å®¹å™¨ä¸­ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">            http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å¼€å¯ç»„ä»¶æ‰«æåŠŸèƒ½--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.hang.spring6&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šåœ¨ä½¿ç”¨ <a href="context:component-scan">context:component-scan</a> å…ƒç´ å¼€å¯è‡ªåŠ¨æ‰«æåŠŸèƒ½å‰ï¼Œé¦–å…ˆéœ€è¦åœ¨ XML é…ç½®çš„ä¸€çº§æ ‡ç­¾ <beans> ä¸­æ·»åŠ  context ç›¸å…³çš„çº¦æŸã€‚</beans></p><p><strong>æƒ…å†µä¸€ï¼šæœ€åŸºæœ¬çš„æ‰«ææ–¹å¼</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.hang.spring6&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>æƒ…å†µäºŒï¼šæŒ‡å®šè¦æ’é™¤çš„ç»„ä»¶</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.hang.spring6&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- context:exclude-filteræ ‡ç­¾ï¼šæŒ‡å®šæ’é™¤è§„åˆ™ --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment"> typeï¼šè®¾ç½®æ’é™¤æˆ–åŒ…å«çš„ä¾æ®</span></span><br><span class="line"><span class="comment">type=&quot;annotation&quot;ï¼Œæ ¹æ®æ³¨è§£æ’é™¤ï¼Œexpressionä¸­è®¾ç½®è¦æ’é™¤çš„æ³¨è§£çš„å…¨ç±»å</span></span><br><span class="line"><span class="comment">type=&quot;assignable&quot;ï¼Œæ ¹æ®ç±»å‹æ’é™¤ï¼Œexpressionä¸­è®¾ç½®è¦æ’é™¤çš„ç±»å‹çš„å…¨ç±»å</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;context:exclude-filter type=&quot;assignable&quot; expression=&quot;com.hang.spring6.controller.UserController&quot;/&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>æƒ…å†µä¸‰ï¼šä»…æ‰«ææŒ‡å®šç»„ä»¶</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.hang&quot;</span> <span class="attr">use-default-filters</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- context:include-filteræ ‡ç­¾ï¼šæŒ‡å®šåœ¨åŸæœ‰æ‰«æè§„åˆ™çš„åŸºç¡€ä¸Šè¿½åŠ çš„è§„åˆ™ --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- use-default-filterså±æ€§ï¼šå–å€¼falseè¡¨ç¤ºå…³é—­é»˜è®¤æ‰«æè§„åˆ™ --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æ­¤æ—¶å¿…é¡»è®¾ç½®use-default-filters=&quot;false&quot;ï¼Œå› ä¸ºé»˜è®¤è§„åˆ™å³æ‰«ææŒ‡å®šåŒ…ä¸‹æ‰€æœ‰ç±» --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment"> typeï¼šè®¾ç½®æ’é™¤æˆ–åŒ…å«çš„ä¾æ®</span></span><br><span class="line"><span class="comment">type=&quot;annotation&quot;ï¼Œæ ¹æ®æ³¨è§£æ’é™¤ï¼Œexpressionä¸­è®¾ç½®è¦æ’é™¤çš„æ³¨è§£çš„å…¨ç±»å</span></span><br><span class="line"><span class="comment">type=&quot;assignable&quot;ï¼Œæ ¹æ®ç±»å‹æ’é™¤ï¼Œexpressionä¸­è®¾ç½®è¦æ’é™¤çš„ç±»å‹çš„å…¨ç±»å</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;context:include-filter type=&quot;assignable&quot; expression=&quot;com.hang.spring6.controller.UserController&quot;/&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨æ³¨è§£å®šä¹‰-Bean"><a href="#ä½¿ç”¨æ³¨è§£å®šä¹‰-Bean" class="headerlink" title="ä½¿ç”¨æ³¨è§£å®šä¹‰ Bean"></a>ä½¿ç”¨æ³¨è§£å®šä¹‰ Bean</h4><p>Spring æä¾›äº†ä»¥ä¸‹å¤šä¸ªæ³¨è§£ï¼Œè¿™äº›æ³¨è§£å¯ä»¥ç›´æ¥æ ‡æ³¨åœ¨ Java ç±»ä¸Šï¼Œå°†å®ƒä»¬å®šä¹‰æˆ Spring Beanã€‚</p><table><thead><tr><th>æ³¨è§£</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>@Component</td><td>è¯¥æ³¨è§£ç”¨äºæè¿° Spring ä¸­çš„ Beanï¼Œå®ƒæ˜¯ä¸€ä¸ªæ³›åŒ–çš„æ¦‚å¿µï¼Œä»…ä»…è¡¨ç¤ºå®¹å™¨ä¸­çš„ä¸€ä¸ªç»„ä»¶ï¼ˆBeanï¼‰ï¼Œå¹¶ä¸”å¯ä»¥ä½œç”¨åœ¨åº”ç”¨çš„ä»»ä½•å±‚æ¬¡ï¼Œä¾‹å¦‚ Service å±‚ã€Dao å±‚ç­‰ã€‚  ä½¿ç”¨æ—¶åªéœ€å°†è¯¥æ³¨è§£æ ‡æ³¨åœ¨ç›¸åº”ç±»ä¸Šå³å¯ã€‚</td></tr><tr><td>@Repository</td><td>è¯¥æ³¨è§£ç”¨äºå°†æ•°æ®è®¿é—®å±‚ï¼ˆDao å±‚ï¼‰çš„ç±»æ ‡è¯†ä¸º Spring ä¸­çš„ Beanï¼Œå…¶åŠŸèƒ½ä¸ @Component ç›¸åŒã€‚</td></tr><tr><td>@Service</td><td>è¯¥æ³¨è§£é€šå¸¸ä½œç”¨åœ¨ä¸šåŠ¡å±‚ï¼ˆService å±‚ï¼‰ï¼Œç”¨äºå°†ä¸šåŠ¡å±‚çš„ç±»æ ‡è¯†ä¸º Spring ä¸­çš„ Beanï¼Œå…¶åŠŸèƒ½ä¸ @Component ç›¸åŒã€‚</td></tr><tr><td>@Controller</td><td>è¯¥æ³¨è§£é€šå¸¸ä½œç”¨åœ¨æ§åˆ¶å±‚ï¼ˆå¦‚SpringMVC çš„ Controllerï¼‰ï¼Œç”¨äºå°†æ§åˆ¶å±‚çš„ç±»æ ‡è¯†ä¸º Spring ä¸­çš„ Beanï¼Œå…¶åŠŸèƒ½ä¸ @Component ç›¸åŒã€‚</td></tr></tbody></table><h4 id="å®éªŒä¸€ï¼š-Autowiredæ³¨å…¥"><a href="#å®éªŒä¸€ï¼š-Autowiredæ³¨å…¥" class="headerlink" title="å®éªŒä¸€ï¼š@Autowiredæ³¨å…¥"></a>å®éªŒä¸€ï¼š@Autowiredæ³¨å…¥</h4><p>å•ç‹¬ä½¿ç”¨@Autowiredæ³¨è§£ï¼Œ<strong>é»˜è®¤æ ¹æ®ç±»å‹è£…é…</strong>ã€‚ã€é»˜è®¤æ˜¯byTypeã€‘</p><p>æŸ¥çœ‹æºç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.beans.factory.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Documented;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.CONSTRUCTOR, ElementType.METHOD, ElementType.PARAMETER, ElementType.FIELD, ElementType.ANNOTATION_TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Autowired &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">required</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æºç ä¸­æœ‰ä¸¤å¤„éœ€è¦æ³¨æ„ï¼š</p><ul><li><p>ç¬¬ä¸€å¤„ï¼šè¯¥æ³¨è§£å¯ä»¥æ ‡æ³¨åœ¨å“ªé‡Œï¼Ÿ</p></li><li><ul><li>æ„é€ æ–¹æ³•ä¸Š</li><li>æ–¹æ³•ä¸Š</li><li>å½¢å‚ä¸Š</li><li>å±æ€§ä¸Š</li><li>æ³¨è§£ä¸Š</li></ul></li><li><p>ç¬¬äºŒå¤„ï¼šè¯¥æ³¨è§£æœ‰ä¸€ä¸ªrequiredå±æ€§ï¼Œé»˜è®¤å€¼æ˜¯trueï¼Œè¡¨ç¤ºåœ¨æ³¨å…¥çš„æ—¶å€™è¦æ±‚è¢«æ³¨å…¥çš„Beanå¿…é¡»æ˜¯å­˜åœ¨çš„ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™æŠ¥é”™ã€‚å¦‚æœrequiredå±æ€§è®¾ç½®ä¸ºfalseï¼Œè¡¨ç¤ºæ³¨å…¥çš„Beanå­˜åœ¨æˆ–è€…ä¸å­˜åœ¨éƒ½æ²¡å…³ç³»ï¼Œå­˜åœ¨çš„è¯å°±æ³¨å…¥ï¼Œä¸å­˜åœ¨çš„è¯ï¼Œä¹Ÿä¸æŠ¥é”™ã€‚</p></li></ul><h5 id="â‘ åœºæ™¯ä¸€ï¼šå±æ€§æ³¨å…¥"><a href="#â‘ åœºæ™¯ä¸€ï¼šå±æ€§æ³¨å…¥" class="headerlink" title="â‘ åœºæ™¯ä¸€ï¼šå±æ€§æ³¨å…¥"></a>â‘ åœºæ™¯ä¸€ï¼šå±æ€§æ³¨å…¥</h5><p>åˆ›å»ºUserDaoæ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºUserDaoImplå®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hang.spring6.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Daoå±‚æ‰§è¡Œç»“æŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºUserServiceæ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">out</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºUserServiceImplå®ç°ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hang.spring6.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.hang.spring6.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">out</span><span class="params">()</span> &#123;</span><br><span class="line">        userDao.print();</span><br><span class="line">        System.out.println(<span class="string">&quot;Serviceå±‚æ‰§è¡Œç»“æŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºUserControllerç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hang.spring6.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">out</span><span class="params">()</span> &#123;</span><br><span class="line">        userService.out();</span><br><span class="line">        System.out.println(<span class="string">&quot;Controllerå±‚æ‰§è¡Œç»“æŸã€‚&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•ä¸€</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hang.spring6.controller.UserController;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(UserTest.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAnnotation</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;Beans.xml&quot;</span>);</span><br><span class="line">        <span class="type">UserController</span> <span class="variable">userController</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;userController&quot;</span>, UserController.class);</span><br><span class="line">        userController.out();</span><br><span class="line">        logger.info(<span class="string">&quot;æ‰§è¡ŒæˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šæ„é€ æ–¹æ³•å’Œsetteræ–¹æ³•éƒ½æ²¡æœ‰æä¾›ï¼Œç»è¿‡æµ‹è¯•ï¼Œä»ç„¶å¯ä»¥æ³¨å…¥æˆåŠŸã€‚</p><h5 id="â‘¡åœºæ™¯äºŒï¼šsetæ³¨å…¥"><a href="#â‘¡åœºæ™¯äºŒï¼šsetæ³¨å…¥" class="headerlink" title="â‘¡åœºæ™¯äºŒï¼šsetæ³¨å…¥"></a>â‘¡åœºæ™¯äºŒï¼šsetæ³¨å…¥</h5><p>ä¿®æ”¹UserServiceImplç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hang.spring6.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.hang.spring6.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserDao</span><span class="params">(UserDao userDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userDao = userDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">out</span><span class="params">()</span> &#123;</span><br><span class="line">        userDao.print();</span><br><span class="line">        System.out.println(<span class="string">&quot;Serviceå±‚æ‰§è¡Œç»“æŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹UserControllerç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hang.spring6.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserService</span><span class="params">(UserService userService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userService = userService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">out</span><span class="params">()</span> &#123;</span><br><span class="line">        userService.out();</span><br><span class="line">        System.out.println(<span class="string">&quot;Controllerå±‚æ‰§è¡Œç»“æŸã€‚&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼šæˆåŠŸè°ƒç”¨</p><h5 id="â‘¢åœºæ™¯ä¸‰ï¼šæ„é€ æ–¹æ³•æ³¨å…¥"><a href="#â‘¢åœºæ™¯ä¸‰ï¼šæ„é€ æ–¹æ³•æ³¨å…¥" class="headerlink" title="â‘¢åœºæ™¯ä¸‰ï¼šæ„é€ æ–¹æ³•æ³¨å…¥"></a>â‘¢åœºæ™¯ä¸‰ï¼šæ„é€ æ–¹æ³•æ³¨å…¥</h5><p>ä¿®æ”¹UserServiceImplç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hang.spring6.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.hang.spring6.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserServiceImpl</span><span class="params">(UserDao userDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userDao = userDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">out</span><span class="params">()</span> &#123;</span><br><span class="line">        userDao.print();</span><br><span class="line">        System.out.println(<span class="string">&quot;Serviceå±‚æ‰§è¡Œç»“æŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹UserControllerç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hang.spring6.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserController</span><span class="params">(UserService userService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userService = userService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">out</span><span class="params">()</span> &#123;</span><br><span class="line">        userService.out();</span><br><span class="line">        System.out.println(<span class="string">&quot;Controllerå±‚æ‰§è¡Œç»“æŸã€‚&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼šæˆåŠŸè°ƒç”¨</p><h5 id="â‘£åœºæ™¯å››ï¼šå½¢å‚ä¸Šæ³¨å…¥"><a href="#â‘£åœºæ™¯å››ï¼šå½¢å‚ä¸Šæ³¨å…¥" class="headerlink" title="â‘£åœºæ™¯å››ï¼šå½¢å‚ä¸Šæ³¨å…¥"></a>â‘£åœºæ™¯å››ï¼šå½¢å‚ä¸Šæ³¨å…¥</h5><p>ä¿®æ”¹UserServiceImplç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hang.spring6.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.hang.spring6.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserServiceImpl</span><span class="params">(<span class="meta">@Autowired</span> UserDao userDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userDao = userDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">out</span><span class="params">()</span> &#123;</span><br><span class="line">        userDao.print();</span><br><span class="line">        System.out.println(<span class="string">&quot;Serviceå±‚æ‰§è¡Œç»“æŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹UserControllerç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hang.spring6.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserController</span><span class="params">(<span class="meta">@Autowired</span> UserService userService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userService = userService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">out</span><span class="params">()</span> &#123;</span><br><span class="line">        userService.out();</span><br><span class="line">        System.out.println(<span class="string">&quot;Controllerå±‚æ‰§è¡Œç»“æŸã€‚&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼šæˆåŠŸè°ƒç”¨</p><h5 id="â‘¤åœºæ™¯äº”ï¼šåªæœ‰ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œæ— æ³¨è§£"><a href="#â‘¤åœºæ™¯äº”ï¼šåªæœ‰ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œæ— æ³¨è§£" class="headerlink" title="â‘¤åœºæ™¯äº”ï¼šåªæœ‰ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œæ— æ³¨è§£"></a>â‘¤åœºæ™¯äº”ï¼šåªæœ‰ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œæ— æ³¨è§£</h5><p>ä¿®æ”¹UserServiceImplç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hang.spring6.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.hang.spring6.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserServiceImpl</span><span class="params">(UserDao userDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userDao = userDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">out</span><span class="params">()</span> &#123;</span><br><span class="line">        userDao.print();</span><br><span class="line">        System.out.println(<span class="string">&quot;Serviceå±‚æ‰§è¡Œç»“æŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•é€šè¿‡</p><p><strong>å½“æœ‰å‚æ•°çš„æ„é€ æ–¹æ³•åªæœ‰ä¸€ä¸ªæ—¶ï¼Œ@Autowiredæ³¨è§£å¯ä»¥çœç•¥ã€‚</strong></p><p>è¯´æ˜ï¼šæœ‰å¤šä¸ªæ„é€ æ–¹æ³•æ—¶å‘¢ï¼Ÿå¤§å®¶å¯ä»¥æµ‹è¯•ï¼ˆå†æ·»åŠ ä¸€ä¸ªæ— å‚æ„é€ å‡½æ•°ï¼‰ï¼Œæµ‹è¯•æŠ¥é”™</p><h5 id="â‘¥åœºæ™¯å…­ï¼š-Autowiredæ³¨è§£å’Œ-Qualifieræ³¨è§£è”åˆ"><a href="#â‘¥åœºæ™¯å…­ï¼š-Autowiredæ³¨è§£å’Œ-Qualifieræ³¨è§£è”åˆ" class="headerlink" title="â‘¥åœºæ™¯å…­ï¼š@Autowiredæ³¨è§£å’Œ@Qualifieræ³¨è§£è”åˆ"></a>â‘¥åœºæ™¯å…­ï¼š@Autowiredæ³¨è§£å’Œ@Qualifieræ³¨è§£è”åˆ</h5><p>æ·»åŠ daoå±‚å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hang.spring6.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoRedisImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Redis Daoå±‚æ‰§è¡Œç»“æŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼šæµ‹è¯•å¼‚å¸¸</p><p>é”™è¯¯ä¿¡æ¯ä¸­è¯´ï¼šä¸èƒ½è£…é…ï¼ŒUserDaoè¿™ä¸ªBeançš„æ•°é‡ç­‰äº2</p><p>æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ<strong>å½“ç„¶è¦byNameï¼Œæ ¹æ®åç§°è¿›è¡Œè£…é…äº†ã€‚</strong></p><p>ä¿®æ”¹UserServiceImplç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hang.spring6.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.hang.spring6.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier(&quot;userDaoImpl&quot;)</span> <span class="comment">// æŒ‡å®šbeançš„åå­—</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">out</span><span class="params">()</span> &#123;</span><br><span class="line">        userDao.print();</span><br><span class="line">        System.out.println(<span class="string">&quot;Serviceå±‚æ‰§è¡Œç»“æŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ€»ç»“</strong></p><ul><li>@Autowiredæ³¨è§£å¯ä»¥å‡ºç°åœ¨ï¼šå±æ€§ä¸Šã€æ„é€ æ–¹æ³•ä¸Šã€æ„é€ æ–¹æ³•çš„å‚æ•°ä¸Šã€setteræ–¹æ³•ä¸Šã€‚</li><li>å½“å¸¦å‚æ•°çš„æ„é€ æ–¹æ³•åªæœ‰ä¸€ä¸ªï¼Œ@Autowiredæ³¨è§£å¯ä»¥çœç•¥ã€‚ï¼ˆï¼‰</li><li>@Autowiredæ³¨è§£é»˜è®¤æ ¹æ®ç±»å‹æ³¨å…¥ã€‚å¦‚æœè¦æ ¹æ®åç§°æ³¨å…¥çš„è¯ï¼Œéœ€è¦é…åˆ@Qualifieræ³¨è§£ä¸€èµ·ä½¿ç”¨ã€‚</li></ul><h4 id="å®éªŒäºŒï¼š-Resourceæ³¨å…¥"><a href="#å®éªŒäºŒï¼š-Resourceæ³¨å…¥" class="headerlink" title="å®éªŒäºŒï¼š@Resourceæ³¨å…¥"></a>å®éªŒäºŒï¼š@Resourceæ³¨å…¥</h4><p>@Resourceæ³¨è§£ä¹Ÿå¯ä»¥å®Œæˆå±æ€§æ³¨å…¥ã€‚é‚£å®ƒå’Œ@Autowiredæ³¨è§£æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p><ul><li>@Resourceæ³¨è§£æ˜¯JDKæ‰©å±•åŒ…ä¸­çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å±äºJDKçš„ä¸€éƒ¨åˆ†ã€‚æ‰€ä»¥è¯¥æ³¨è§£æ˜¯æ ‡å‡†æ³¨è§£ï¼Œæ›´åŠ å…·æœ‰é€šç”¨æ€§ã€‚(JSR-250æ ‡å‡†ä¸­åˆ¶å®šçš„æ³¨è§£ç±»å‹ã€‚JSRæ˜¯Javaè§„èŒƒææ¡ˆã€‚)</li><li>@Autowiredæ³¨è§£æ˜¯Springæ¡†æ¶è‡ªå·±çš„ã€‚</li><li><strong>@Resourceæ³¨è§£é»˜è®¤æ ¹æ®åç§°è£…é…byNameï¼ŒæœªæŒ‡å®šnameæ—¶ï¼Œä½¿ç”¨å±æ€§åä½œä¸ºnameã€‚é€šè¿‡nameæ‰¾ä¸åˆ°çš„è¯ä¼šè‡ªåŠ¨å¯åŠ¨é€šè¿‡ç±»å‹byTypeè£…é…ã€‚</strong></li><li><strong>@Autowiredæ³¨è§£é»˜è®¤æ ¹æ®ç±»å‹è£…é…byTypeï¼Œå¦‚æœæƒ³æ ¹æ®åç§°è£…é…ï¼Œéœ€è¦é…åˆ@Qualifieræ³¨è§£ä¸€èµ·ç”¨ã€‚</strong></li><li>@Resourceæ³¨è§£ç”¨åœ¨å±æ€§ä¸Šã€setteræ–¹æ³•ä¸Šã€‚</li><li>@Autowiredæ³¨è§£ç”¨åœ¨å±æ€§ä¸Šã€setteræ–¹æ³•ä¸Šã€æ„é€ æ–¹æ³•ä¸Šã€æ„é€ æ–¹æ³•å‚æ•°ä¸Šã€‚</li></ul><p>@Resourceæ³¨è§£å±äºJDKæ‰©å±•åŒ…ï¼Œæ‰€ä»¥ä¸åœ¨JDKå½“ä¸­ï¼Œéœ€è¦é¢å¤–å¼•å…¥ä»¥ä¸‹ä¾èµ–ï¼šã€<strong>å¦‚æœæ˜¯JDK8çš„è¯ä¸éœ€è¦é¢å¤–å¼•å…¥ä¾èµ–ã€‚é«˜äºJDK11æˆ–ä½äºJDK8éœ€è¦å¼•å…¥ä»¥ä¸‹ä¾èµ–ã€‚</strong>ã€‘</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jakarta.annotation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jakarta.annotation-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æºç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> jakarta.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Repeatable;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE, ElementType.FIELD, ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Repeatable(Resources.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Resource &#123;</span><br><span class="line">    String <span class="title function_">name</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">lookup</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt; type() <span class="keyword">default</span> Object.class;</span><br><span class="line"></span><br><span class="line">    Resource.AuthenticationType <span class="title function_">authenticationType</span><span class="params">()</span> <span class="keyword">default</span> Resource.AuthenticationType.CONTAINER;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">shareable</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">mappedName</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">description</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">enum</span> <span class="title class_">AuthenticationType</span> &#123;</span><br><span class="line">        CONTAINER,</span><br><span class="line">        APPLICATION;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">AuthenticationType</span><span class="params">()</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="â‘ åœºæ™¯ä¸€ï¼šæ ¹æ®nameæ³¨å…¥"><a href="#â‘ åœºæ™¯ä¸€ï¼šæ ¹æ®nameæ³¨å…¥" class="headerlink" title="â‘ åœºæ™¯ä¸€ï¼šæ ¹æ®nameæ³¨å…¥"></a>â‘ åœºæ™¯ä¸€ï¼šæ ¹æ®nameæ³¨å…¥</h5><p>ä¿®æ”¹UserDaoImplç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hang.spring6.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository(&quot;myUserDao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Daoå±‚æ‰§è¡Œç»“æŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹UserServiceImplç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hang.spring6.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.hang.spring6.service.UserService;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource(name = &quot;myUserDao&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> UserDao myUserDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">out</span><span class="params">()</span> &#123;</span><br><span class="line">        myUserDao.print();</span><br><span class="line">        System.out.println(<span class="string">&quot;Serviceå±‚æ‰§è¡Œç»“æŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•é€šè¿‡</p><h5 id="â‘¡åœºæ™¯äºŒï¼šnameæœªçŸ¥æ³¨å…¥"><a href="#â‘¡åœºæ™¯äºŒï¼šnameæœªçŸ¥æ³¨å…¥" class="headerlink" title="â‘¡åœºæ™¯äºŒï¼šnameæœªçŸ¥æ³¨å…¥"></a>â‘¡åœºæ™¯äºŒï¼šnameæœªçŸ¥æ³¨å…¥</h5><p>ä¿®æ”¹UserDaoImplç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hang.spring6.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository(&quot;myUserDao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Daoå±‚æ‰§è¡Œç»“æŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹UserServiceImplç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hang.spring6.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.hang.spring6.service.UserService;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserDao myUserDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">out</span><span class="params">()</span> &#123;</span><br><span class="line">        myUserDao.print();</span><br><span class="line">        System.out.println(<span class="string">&quot;Serviceå±‚æ‰§è¡Œç»“æŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•é€šè¿‡</p><p>å½“@Resourceæ³¨è§£ä½¿ç”¨æ—¶æ²¡æœ‰æŒ‡å®šnameçš„æ—¶å€™ï¼Œè¿˜æ˜¯æ ¹æ®nameè¿›è¡ŒæŸ¥æ‰¾ï¼Œè¿™ä¸ªnameæ˜¯å±æ€§åã€‚</p><h5 id="â‘¢åœºæ™¯ä¸‰-å…¶ä»–æƒ…å†µ"><a href="#â‘¢åœºæ™¯ä¸‰-å…¶ä»–æƒ…å†µ" class="headerlink" title="â‘¢åœºæ™¯ä¸‰ å…¶ä»–æƒ…å†µ"></a>â‘¢åœºæ™¯ä¸‰ å…¶ä»–æƒ…å†µ</h5><p>ä¿®æ”¹UserServiceImplç±»ï¼ŒuserDao1å±æ€§åä¸å­˜åœ¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hang.spring6.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.hang.spring6.service.UserService;</span><br><span class="line"><span class="keyword">import</span> jakarta.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao1;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">out</span><span class="params">()</span> &#123;</span><br><span class="line">        userDao1.print();</span><br><span class="line">        System.out.println(<span class="string">&quot;Serviceå±‚æ‰§è¡Œç»“æŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•å¼‚å¸¸</p><p>æ ¹æ®å¼‚å¸¸ä¿¡æ¯å¾—çŸ¥ï¼šæ˜¾ç„¶å½“é€šè¿‡nameæ‰¾ä¸åˆ°çš„æ—¶å€™ï¼Œè‡ªç„¶ä¼šå¯åŠ¨byTypeè¿›è¡Œæ³¨å…¥ï¼Œä»¥ä¸Šçš„é”™è¯¯æ˜¯å› ä¸ºUserDaoæ¥å£ä¸‹æœ‰ä¸¤ä¸ªå®ç°ç±»å¯¼è‡´çš„ã€‚æ‰€ä»¥æ ¹æ®ç±»å‹æ³¨å…¥å°±ä¼šæŠ¥é”™ã€‚</p><p>@Resourceçš„setæ³¨å…¥å¯ä»¥è‡ªè¡Œæµ‹è¯•</p><p><strong>æ€»ç»“ï¼š</strong></p><p>@Resourceæ³¨è§£ï¼šé»˜è®¤byNameæ³¨å…¥ï¼Œæ²¡æœ‰æŒ‡å®šnameæ—¶æŠŠå±æ€§åå½“åšnameï¼Œæ ¹æ®nameæ‰¾ä¸åˆ°æ—¶ï¼Œæ‰ä¼šbyTypeæ³¨å…¥ã€‚byTypeæ³¨å…¥æ—¶ï¼ŒæŸç§ç±»å‹çš„Beanåªèƒ½æœ‰ä¸€ä¸ª</p><h4 id="3-3-6ã€Springå…¨æ³¨è§£å¼€å‘"><a href="#3-3-6ã€Springå…¨æ³¨è§£å¼€å‘" class="headerlink" title="3.3.6ã€Springå…¨æ³¨è§£å¼€å‘"></a>3.3.6ã€Springå…¨æ³¨è§£å¼€å‘</h4><p>å…¨æ³¨è§£å¼€å‘å°±æ˜¯ä¸å†ä½¿ç”¨springé…ç½®æ–‡ä»¶äº†ï¼Œå†™ä¸€ä¸ªé…ç½®ç±»æ¥ä»£æ›¿é…ç½®æ–‡ä»¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//@ComponentScan(&#123;&quot;com.hang.spring6.controller&quot;, &quot;com.hang.spring6.service&quot;,&quot;com.hang.spring6.dao&quot;&#125;)</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.hang.spring6&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Spring6Config</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAllAnnotation</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(Spring6Config.class);</span><br><span class="line">    <span class="type">UserController</span> <span class="variable">userController</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;userController&quot;</span>, UserController.class);</span><br><span class="line">    userController.out();</span><br><span class="line">    logger.info(<span class="string">&quot;æ‰§è¡ŒæˆåŠŸ&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŸç†-æ‰‹å†™IoC"><a href="#åŸç†-æ‰‹å†™IoC" class="headerlink" title="åŸç†-æ‰‹å†™IoC"></a>åŸç†-æ‰‹å†™IoC</h2><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒSpringæ¡†æ¶çš„IOCæ˜¯åŸºäºJavaåå°„æœºåˆ¶å®ç°çš„ï¼Œä¸‹é¢æˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹javaåå°„ã€‚</p><h3 id="å›é¡¾Javaåå°„"><a href="#å›é¡¾Javaåå°„" class="headerlink" title="å›é¡¾Javaåå°„"></a>å›é¡¾Javaåå°„</h3><p><code>Java</code>åå°„æœºåˆ¶æ˜¯åœ¨è¿è¡ŒçŠ¶æ€ä¸­ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼›å¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„æ–¹æ³•å’Œå±æ€§ï¼›è¿™ç§åŠ¨æ€è·å–ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡æ–¹æ³•çš„åŠŸèƒ½ç§°ä¸º<code>Java</code>è¯­è¨€çš„åå°„æœºåˆ¶ã€‚ç®€å•æ¥è¯´ï¼Œåå°„æœºåˆ¶æŒ‡çš„æ˜¯ç¨‹åºåœ¨è¿è¡Œæ—¶èƒ½å¤Ÿè·å–è‡ªèº«çš„ä¿¡æ¯ã€‚</p><p>è¦æƒ³è§£å‰–ä¸€ä¸ªç±»ï¼Œå¿…é¡»å…ˆè¦<strong>è·å–åˆ°è¯¥ç±»çš„Classå¯¹è±¡</strong>ã€‚è€Œå‰–æä¸€ä¸ªç±»æˆ–ç”¨åå°„è§£å†³å…·ä½“çš„é—®é¢˜å°±æ˜¯ä½¿ç”¨ç›¸å…³API<strong>ï¼ˆ1ï¼‰java.lang.Classï¼ˆ2ï¼‰java.lang.reflect</strong>ï¼Œæ‰€ä»¥ï¼Œ<strong>Classå¯¹è±¡æ˜¯åå°„çš„æ ¹æº</strong>ã€‚</p><p><strong>è‡ªå®šä¹‰ç±»</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.reflect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Car</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å±æ€§</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ— å‚æ•°æ„é€ </span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Car</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æœ‰å‚æ•°æ„é€ </span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Car</span><span class="params">(String name, <span class="type">int</span> age, String color)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">        <span class="built_in">this</span>.color = color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ™®é€šæ–¹æ³•</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç§æœ‰æ–¹æ³•-run.....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//getå’Œsetæ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getColor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> color;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setColor</span><span class="params">(String color)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.color = color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Car&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;/&#x27;</span><span class="string">&#x27; +</span></span><br><span class="line"><span class="string">                &quot;, age=&quot; + age +</span></span><br><span class="line"><span class="string">                &quot;, color=&#x27;</span><span class="string">&quot; + color + &#x27;/&#x27;&#x27; +</span></span><br><span class="line"><span class="string">                &#x27;&#125;&#x27;;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>ç¼–å†™æµ‹è¯•ç±»</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.reflect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestCar</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1ã€è·å–Classå¯¹è±¡å¤šç§æ–¹å¼</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//1 ç±»å.class</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">clazz1</span> <span class="operator">=</span> Car.class;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2 å¯¹è±¡.getClass()</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">clazz2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car</span>().getClass();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3 Class.forName(&quot;å…¨è·¯å¾„&quot;)</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">clazz3</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;com.hang.reflect.Car&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å®ä¾‹åŒ–</span></span><br><span class="line">        <span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> (Car)clazz3.getConstructor().newInstance();</span><br><span class="line">        System.out.println(car);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2ã€è·å–æ„é€ æ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test02</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Car.class;</span><br><span class="line">        <span class="comment">//è·å–æ‰€æœ‰æ„é€ </span></span><br><span class="line">        <span class="comment">// getConstructors()è·å–æ‰€æœ‰publicçš„æ„é€ æ–¹æ³•</span></span><br><span class="line"><span class="comment">//        Constructor[] constructors = clazz.getConstructors();</span></span><br><span class="line">        <span class="comment">// getDeclaredConstructors()è·å–æ‰€æœ‰çš„æ„é€ æ–¹æ³•public  private</span></span><br><span class="line">        Constructor[] constructors = clazz.getDeclaredConstructors();</span><br><span class="line">        <span class="keyword">for</span> (Constructor c:constructors) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ–¹æ³•åç§°ï¼š&quot;</span>+c.getName()+<span class="string">&quot; å‚æ•°ä¸ªæ•°ï¼š&quot;</span>+c.getParameterCount());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æŒ‡å®šæœ‰å‚æ•°æ„é€ åˆ›å»ºå¯¹è±¡</span></span><br><span class="line">        <span class="comment">//1 æ„é€ public</span></span><br><span class="line"><span class="comment">//        Constructor c1 = clazz.getConstructor(String.class, int.class, String.class);</span></span><br><span class="line"><span class="comment">//        Car car1 = (Car)c1.newInstance(&quot;å¤åˆ©&quot;, 10, &quot;çº¢è‰²&quot;);</span></span><br><span class="line"><span class="comment">//        System.out.println(car1);</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//2 æ„é€ private</span></span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">c2</span> <span class="operator">=</span> clazz.getDeclaredConstructor(String.class, <span class="type">int</span>.class, String.class);</span><br><span class="line">        c2.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">Car</span> <span class="variable">car2</span> <span class="operator">=</span> (Car)c2.newInstance(<span class="string">&quot;æ·è¾¾&quot;</span>, <span class="number">15</span>, <span class="string">&quot;ç™½è‰²&quot;</span>);</span><br><span class="line">        System.out.println(car2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3ã€è·å–å±æ€§</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test03</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Car.class;</span><br><span class="line">        <span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> (Car)clazz.getDeclaredConstructor().newInstance();</span><br><span class="line">        <span class="comment">//è·å–æ‰€æœ‰publicå±æ€§</span></span><br><span class="line">        <span class="comment">//Field[] fields = clazz.getFields();</span></span><br><span class="line">        <span class="comment">//è·å–æ‰€æœ‰å±æ€§ï¼ˆåŒ…å«ç§æœ‰å±æ€§ï¼‰</span></span><br><span class="line">        Field[] fields = clazz.getDeclaredFields();</span><br><span class="line">        <span class="keyword">for</span> (Field field:fields) &#123;</span><br><span class="line">            <span class="keyword">if</span>(field.getName().equals(<span class="string">&quot;name&quot;</span>)) &#123;</span><br><span class="line">                <span class="comment">//è®¾ç½®å…è®¸è®¿é—®</span></span><br><span class="line">                field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                field.set(car,<span class="string">&quot;äº”è±å®å…‰&quot;</span>);</span><br><span class="line">                System.out.println(car);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(field.getName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4ã€è·å–æ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test04</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car</span>(<span class="string">&quot;å¥”é©°&quot;</span>,<span class="number">10</span>,<span class="string">&quot;é»‘è‰²&quot;</span>);</span><br><span class="line">        <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> car.getClass();</span><br><span class="line">        <span class="comment">//1 publicæ–¹æ³•</span></span><br><span class="line">        Method[] methods = clazz.getMethods();</span><br><span class="line">        <span class="keyword">for</span> (Method m1:methods) &#123;</span><br><span class="line">            <span class="comment">//System.out.println(m1.getName());</span></span><br><span class="line">            <span class="comment">//æ‰§è¡Œæ–¹æ³• toString</span></span><br><span class="line">            <span class="keyword">if</span>(m1.getName().equals(<span class="string">&quot;toString&quot;</span>)) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">invoke</span> <span class="operator">=</span> (String)m1.invoke(car);</span><br><span class="line">                <span class="comment">//System.out.println(&quot;toStringæ‰§è¡Œäº†ï¼š&quot;+invoke);</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2 privateæ–¹æ³•</span></span><br><span class="line">        Method[] methodsAll = clazz.getDeclaredMethods();</span><br><span class="line">        <span class="keyword">for</span> (Method m:methodsAll) &#123;</span><br><span class="line">            <span class="comment">//æ‰§è¡Œæ–¹æ³• run</span></span><br><span class="line">            <span class="keyword">if</span>(m.getName().equals(<span class="string">&quot;run&quot;</span>)) &#123;</span><br><span class="line">                m.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                m.invoke(car);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®ç°Springçš„IoC"><a href="#å®ç°Springçš„IoC" class="headerlink" title="å®ç°Springçš„IoC"></a>å®ç°Springçš„IoC</h3><p>æˆ‘ä»¬çŸ¥é“ï¼ŒIoCï¼ˆæ§åˆ¶åè½¬ï¼‰å’ŒDIï¼ˆä¾èµ–æ³¨å…¥ï¼‰æ˜¯Springé‡Œé¢æ ¸å¿ƒçš„ä¸œè¥¿ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•è‡ªå·±æ‰‹å†™å‡ºè¿™æ ·çš„ä»£ç å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬å°±ä¸€æ­¥ä¸€æ­¥å†™å‡ºSpringæ¡†æ¶æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ã€‚</p><p><strong>â‘ æ­å»ºå­æ¨¡å—</strong></p><p>æ­å»ºæ¨¡å—ï¼šguigu-springï¼Œæ­å»ºæ–¹å¼å¦‚å…¶ä»–springå­æ¨¡å—</p><p><strong>â‘¡å‡†å¤‡æµ‹è¯•éœ€è¦çš„bean</strong></p><p>æ·»åŠ ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--junit5æµ‹è¯•--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.jupiter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-jupiter-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åˆ›å»ºUserDaoæ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.test.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºUserDaoImplå®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.test.dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hang.spring.dao.UserDao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Daoå±‚æ‰§è¡Œç»“æŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åˆ›å»ºUserServiceæ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.test.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">out</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºUserServiceImplå®ç°ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring.test.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hang.spring.core.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> com.hang.spring.service.UserService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    private UserDao userDao;</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">out</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//userDao.print();</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Serviceå±‚æ‰§è¡Œç»“æŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>â‘¢å®šä¹‰æ³¨è§£</strong></p><p>æˆ‘ä»¬é€šè¿‡æ³¨è§£çš„å½¢å¼åŠ è½½beanä¸å®ç°ä¾èµ–æ³¨å…¥</p><p>beanæ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring.core.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Bean &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¾èµ–æ³¨å…¥æ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring.core.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.FIELD&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Di &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼šä¸Šé¢ä¸¤ä¸ªæ³¨è§£å¯ä»¥éšæ„å–å</p><p><strong>â‘£å®šä¹‰beanå®¹å™¨æ¥å£</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring.core;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ApplicationContext</span> &#123;</span><br><span class="line"></span><br><span class="line">    Object <span class="title function_">getBean</span><span class="params">(Class clazz)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>â‘¤ç¼–å†™æ³¨è§£beanå®¹å™¨æ¥å£å®ç°</strong></p><p>AnnotationApplicationContextåŸºäºæ³¨è§£æ‰«æbean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring.core;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AnnotationApplicationContext</span> <span class="keyword">implements</span> <span class="title class_">ApplicationContext</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å­˜å‚¨beançš„å®¹å™¨</span></span><br><span class="line">    <span class="keyword">private</span> HashMap&lt;Class, Object&gt; beanFactory = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getBean</span><span class="params">(Class clazz)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> beanFactory.get(clazz);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®åŒ…æ‰«æåŠ è½½bean</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> basePackage</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AnnotationApplicationContext</span><span class="params">(String basePackage)</span> &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>â‘¥ç¼–å†™æ‰«æbeané€»è¾‘</strong></p><p>æˆ‘ä»¬é€šè¿‡æ„é€ æ–¹æ³•ä¼ å…¥åŒ…çš„baseè·¯å¾„ï¼Œæ‰«æè¢«@Beanæ³¨è§£çš„javaå¯¹è±¡ï¼Œå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring.core;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hang.spring.core.annotation.Bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AnnotationApplicationContext</span> <span class="keyword">implements</span> <span class="title class_">ApplicationContext</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å­˜å‚¨beançš„å®¹å™¨</span></span><br><span class="line">    <span class="keyword">private</span> HashMap&lt;Class, Object&gt; beanFactory = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String rootPath;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getBean</span><span class="params">(Class clazz)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> beanFactory.get(clazz);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®åŒ…æ‰«æåŠ è½½bean</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> basePackage</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AnnotationApplicationContext</span><span class="params">(String basePackage)</span> &#123;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">packageDirName</span> <span class="operator">=</span> basePackage.replaceAll(<span class="string">&quot;//.&quot;</span>, <span class="string">&quot;////&quot;</span>);</span><br><span class="line">            Enumeration&lt;URL&gt; dirs =Thread.currentThread().getContextClassLoader().getResources(packageDirName);</span><br><span class="line">            <span class="keyword">while</span> (dirs.hasMoreElements()) &#123;</span><br><span class="line">                <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> dirs.nextElement();</span><br><span class="line">                <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> URLDecoder.decode(url.getFile(),<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">                rootPath = filePath.substring(<span class="number">0</span>, filePath.length()-packageDirName.length());</span><br><span class="line">                loadBean(<span class="keyword">new</span> <span class="title class_">File</span>(filePath));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">void</span> <span class="title function_">loadBean</span><span class="params">(File fileParent)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (fileParent.isDirectory()) &#123;</span><br><span class="line">            File[] childrenFiles = fileParent.listFiles();</span><br><span class="line">            <span class="keyword">if</span>(childrenFiles == <span class="literal">null</span> || childrenFiles.length == <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (File child : childrenFiles) &#123;</span><br><span class="line">                <span class="keyword">if</span> (child.isDirectory()) &#123;</span><br><span class="line">                    <span class="comment">//å¦‚æœæ˜¯ä¸ªæ–‡ä»¶å¤¹å°±ç»§ç»­è°ƒç”¨è¯¥æ–¹æ³•,ä½¿ç”¨äº†é€’å½’</span></span><br><span class="line">                    loadBean(child);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">//é€šè¿‡æ–‡ä»¶è·¯å¾„è½¬å˜æˆå…¨ç±»å,ç¬¬ä¸€æ­¥æŠŠç»å¯¹è·¯å¾„éƒ¨åˆ†å»æ‰</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">pathWithClass</span> <span class="operator">=</span> child.getAbsolutePath().substring(rootPath.length() - <span class="number">1</span>);</span><br><span class="line">                    <span class="comment">//é€‰ä¸­classæ–‡ä»¶</span></span><br><span class="line">                    <span class="keyword">if</span> (pathWithClass.contains(<span class="string">&quot;.class&quot;</span>)) &#123;</span><br><span class="line">                        <span class="comment">//    com.xinzhi.dao.UserDao</span></span><br><span class="line">                        <span class="comment">//å»æ‰.classåç¼€ï¼Œå¹¶ä¸”æŠŠ / æ›¿æ¢æˆ .</span></span><br><span class="line">                        <span class="type">String</span> <span class="variable">fullName</span> <span class="operator">=</span> pathWithClass.replaceAll(<span class="string">&quot;////&quot;</span>, <span class="string">&quot;.&quot;</span>).replace(<span class="string">&quot;.class&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            Class&lt;?&gt; aClass = Class.forName(fullName);</span><br><span class="line">                            <span class="comment">//æŠŠéæ¥å£çš„ç±»å®ä¾‹åŒ–æ”¾åœ¨mapä¸­</span></span><br><span class="line">                            <span class="keyword">if</span>(!aClass.isInterface())&#123;</span><br><span class="line">                                <span class="type">Bean</span> <span class="variable">annotation</span> <span class="operator">=</span> aClass.getAnnotation(Bean.class);</span><br><span class="line">                                <span class="keyword">if</span>(annotation != <span class="literal">null</span>)&#123;</span><br><span class="line">                                    <span class="type">Object</span> <span class="variable">instance</span> <span class="operator">=</span> aClass.newInstance();</span><br><span class="line">                                    <span class="comment">//åˆ¤æ–­ä¸€ä¸‹æœ‰æ²¡æœ‰æ¥å£</span></span><br><span class="line">                                    <span class="keyword">if</span>(aClass.getInterfaces().length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                                        <span class="comment">//å¦‚æœæœ‰æ¥å£æŠŠæ¥å£çš„classå½“æˆkeyï¼Œå®ä¾‹å¯¹è±¡å½“æˆvalue</span></span><br><span class="line">                                        System.out.println(<span class="string">&quot;æ­£åœ¨åŠ è½½ã€&quot;</span>+ aClass.getInterfaces()[<span class="number">0</span>] +<span class="string">&quot;ã€‘,å®ä¾‹å¯¹è±¡æ˜¯ï¼š&quot;</span> + instance.getClass().getName());</span><br><span class="line">                                        beanFactory.put(aClass.getInterfaces()[<span class="number">0</span>], instance);</span><br><span class="line">                                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                                        <span class="comment">//å¦‚æœæœ‰æ¥å£æŠŠè‡ªå·±çš„classå½“æˆkeyï¼Œå®ä¾‹å¯¹è±¡å½“æˆvalue</span></span><br><span class="line">                                        System.out.println(<span class="string">&quot;æ­£åœ¨åŠ è½½ã€&quot;</span>+ aClass.getName() +<span class="string">&quot;ã€‘,å®ä¾‹å¯¹è±¡æ˜¯ï¼š&quot;</span> + instance.getClass().getName());</span><br><span class="line">                                        beanFactory.put(aClass, instance);</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (ClassNotFoundException | IllegalAccessException | InstantiationException e) &#123;</span><br><span class="line">                            e.printStackTrace();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>â‘¦javaç±»æ ‡è¯†Beanæ³¨è§£</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> </span><br></pre></td></tr></table></figure><p><strong>â‘§æµ‹è¯•BeanåŠ è½½</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hang.spring.core.AnnotationApplicationContext;</span><br><span class="line"><span class="keyword">import</span> com.hang.spring.core.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> com.hang.spring.test.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringIocTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testIoc</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationApplicationContext</span>(<span class="string">&quot;com.hang.spring.test&quot;</span>);</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService)applicationContext.getBean(UserService.class);</span><br><span class="line">        userService.out();</span><br><span class="line">        System.out.println(<span class="string">&quot;run success&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ§åˆ¶å°æ‰“å°æµ‹è¯•</p><p><strong>â‘¨ä¾èµ–æ³¨å…¥</strong></p><p>åªè¦userDao.print();è°ƒç”¨æˆåŠŸï¼Œè¯´æ˜å°±æ³¨å…¥æˆåŠŸ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring.test.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hang.spring.core.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> com.hang.spring.core.annotation.Di;</span><br><span class="line"><span class="keyword">import</span> com.hang.spring.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.hang.spring.service.UserService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Di</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">out</span><span class="params">()</span> &#123;</span><br><span class="line">        userDao.print();</span><br><span class="line">        System.out.println(<span class="string">&quot;Serviceå±‚æ‰§è¡Œç»“æŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç¬¬å…«æ­¥ï¼šæŠ¥é”™äº†ï¼Œè¯´æ˜å½“å‰userDaoæ˜¯ä¸ªç©ºå¯¹è±¡</p><p><strong>â‘©ä¾èµ–æ³¨å…¥å®ç°</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring.core;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.hang.spring.core.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> com.hang.spring.core.annotation.Di;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AnnotationApplicationContext</span> <span class="keyword">implements</span> <span class="title class_">ApplicationContext</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å­˜å‚¨beançš„å®¹å™¨</span></span><br><span class="line">    <span class="keyword">private</span> HashMap&lt;Class, Object&gt; beanFactory = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String rootPath;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getBean</span><span class="params">(Class clazz)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> beanFactory.get(clazz);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®åŒ…æ‰«æåŠ è½½bean</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> basePackage</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AnnotationApplicationContext</span><span class="params">(String basePackage)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">packageDirName</span> <span class="operator">=</span> basePackage.replaceAll(<span class="string">&quot;//.&quot;</span>, <span class="string">&quot;////&quot;</span>);</span><br><span class="line">            Enumeration&lt;URL&gt; dirs =Thread.currentThread().getContextClassLoader().getResources(packageDirName);</span><br><span class="line">            <span class="keyword">while</span> (dirs.hasMoreElements()) &#123;</span><br><span class="line">                <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> dirs.nextElement();</span><br><span class="line">                <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> URLDecoder.decode(url.getFile(),<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">                rootPath = filePath.substring(<span class="number">0</span>, filePath.length()-packageDirName.length());</span><br><span class="line">                loadBean(<span class="keyword">new</span> <span class="title class_">File</span>(filePath));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//ä¾èµ–æ³¨å…¥</span></span><br><span class="line">        loadDi();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">void</span> <span class="title function_">loadBean</span><span class="params">(File fileParent)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (fileParent.isDirectory()) &#123;</span><br><span class="line">            File[] childrenFiles = fileParent.listFiles();</span><br><span class="line">            <span class="keyword">if</span>(childrenFiles == <span class="literal">null</span> || childrenFiles.length == <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (File child : childrenFiles) &#123;</span><br><span class="line">                <span class="keyword">if</span> (child.isDirectory()) &#123;</span><br><span class="line">                    <span class="comment">//å¦‚æœæ˜¯ä¸ªæ–‡ä»¶å¤¹å°±ç»§ç»­è°ƒç”¨è¯¥æ–¹æ³•,ä½¿ç”¨äº†é€’å½’</span></span><br><span class="line">                    loadBean(child);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">//é€šè¿‡æ–‡ä»¶è·¯å¾„è½¬å˜æˆå…¨ç±»å,ç¬¬ä¸€æ­¥æŠŠç»å¯¹è·¯å¾„éƒ¨åˆ†å»æ‰</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">pathWithClass</span> <span class="operator">=</span> child.getAbsolutePath().substring(rootPath.length() - <span class="number">1</span>);</span><br><span class="line">                    <span class="comment">//é€‰ä¸­classæ–‡ä»¶</span></span><br><span class="line">                    <span class="keyword">if</span> (pathWithClass.contains(<span class="string">&quot;.class&quot;</span>)) &#123;</span><br><span class="line">                        <span class="comment">//    com.xinzhi.dao.UserDao</span></span><br><span class="line">                        <span class="comment">//å»æ‰.classåç¼€ï¼Œå¹¶ä¸”æŠŠ / æ›¿æ¢æˆ .</span></span><br><span class="line">                        <span class="type">String</span> <span class="variable">fullName</span> <span class="operator">=</span> pathWithClass.replaceAll(<span class="string">&quot;////&quot;</span>, <span class="string">&quot;.&quot;</span>).replace(<span class="string">&quot;.class&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            Class&lt;?&gt; aClass = Class.forName(fullName);</span><br><span class="line">                            <span class="comment">//æŠŠéæ¥å£çš„ç±»å®ä¾‹åŒ–æ”¾åœ¨mapä¸­</span></span><br><span class="line">                            <span class="keyword">if</span>(!aClass.isInterface())&#123;</span><br><span class="line">                                <span class="type">Bean</span> <span class="variable">annotation</span> <span class="operator">=</span> aClass.getAnnotation(Bean.class);</span><br><span class="line">                                <span class="keyword">if</span>(annotation != <span class="literal">null</span>)&#123;</span><br><span class="line">                                    <span class="type">Object</span> <span class="variable">instance</span> <span class="operator">=</span> aClass.newInstance();</span><br><span class="line">                                    <span class="comment">//åˆ¤æ–­ä¸€ä¸‹æœ‰æ²¡æœ‰æ¥å£</span></span><br><span class="line">                                    <span class="keyword">if</span>(aClass.getInterfaces().length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                                        <span class="comment">//å¦‚æœæœ‰æ¥å£æŠŠæ¥å£çš„classå½“æˆkeyï¼Œå®ä¾‹å¯¹è±¡å½“æˆvalue</span></span><br><span class="line">                                        System.out.println(<span class="string">&quot;æ­£åœ¨åŠ è½½ã€&quot;</span>+ aClass.getInterfaces()[<span class="number">0</span>] +<span class="string">&quot;ã€‘,å®ä¾‹å¯¹è±¡æ˜¯ï¼š&quot;</span> + instance.getClass().getName());</span><br><span class="line">                                        beanFactory.put(aClass.getInterfaces()[<span class="number">0</span>], instance);</span><br><span class="line">                                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                                        <span class="comment">//å¦‚æœæœ‰æ¥å£æŠŠè‡ªå·±çš„classå½“æˆkeyï¼Œå®ä¾‹å¯¹è±¡å½“æˆvalue</span></span><br><span class="line">                                        System.out.println(<span class="string">&quot;æ­£åœ¨åŠ è½½ã€&quot;</span>+ aClass.getName() +<span class="string">&quot;ã€‘,å®ä¾‹å¯¹è±¡æ˜¯ï¼š&quot;</span> + instance.getClass().getName());</span><br><span class="line">                                        beanFactory.put(aClass, instance);</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (ClassNotFoundException | IllegalAccessException | InstantiationException e) &#123;</span><br><span class="line">                            e.printStackTrace();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">loadDi</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(Map.Entry&lt;Class,Object&gt; entry : beanFactory.entrySet())&#123;</span><br><span class="line">            <span class="comment">//å°±æ˜¯å’±ä»¬æ”¾åœ¨å®¹å™¨çš„å¯¹è±¡</span></span><br><span class="line">            <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> entry.getValue();</span><br><span class="line">            Class&lt;?&gt; aClass = obj.getClass();</span><br><span class="line">            Field[] declaredFields = aClass.getDeclaredFields();</span><br><span class="line">            <span class="keyword">for</span> (Field field : declaredFields)&#123;</span><br><span class="line">                <span class="type">Di</span> <span class="variable">annotation</span> <span class="operator">=</span> field.getAnnotation(Di.class);</span><br><span class="line">                <span class="keyword">if</span>( annotation != <span class="literal">null</span> )&#123;</span><br><span class="line">                    field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;æ­£åœ¨ç»™ã€&quot;</span>+obj.getClass().getName()+<span class="string">&quot;ã€‘å±æ€§ã€&quot;</span> + field.getName() + <span class="string">&quot;ã€‘æ³¨å…¥å€¼ã€&quot;</span>+ beanFactory.get(field.getType()).getClass().getName() +<span class="string">&quot;ã€‘&quot;</span>);</span><br><span class="line">                        field.set(obj,beanFactory.get(field.getType()));</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç¬¬å…«æ­¥ï¼šæ‰§è¡ŒæˆåŠŸï¼Œä¾èµ–æ³¨å…¥æˆåŠŸ</p><h2 id="é¢å‘åˆ‡é¢ï¼šAOP"><a href="#é¢å‘åˆ‡é¢ï¼šAOP" class="headerlink" title="é¢å‘åˆ‡é¢ï¼šAOP"></a>é¢å‘åˆ‡é¢ï¼šAOP</h2><h3 id="åœºæ™¯æ¨¡æ‹Ÿ"><a href="#åœºæ™¯æ¨¡æ‹Ÿ" class="headerlink" title="åœºæ™¯æ¨¡æ‹Ÿ"></a>åœºæ™¯æ¨¡æ‹Ÿ</h3><p><strong>æ­å»ºå­æ¨¡å—ï¼šspring6-aop</strong></p><h4 id="å£°æ˜æ¥å£"><a href="#å£°æ˜æ¥å£" class="headerlink" title="å£°æ˜æ¥å£"></a>å£°æ˜æ¥å£</h4><p>å£°æ˜è®¡ç®—å™¨æ¥å£Calculatorï¼ŒåŒ…å«åŠ å‡ä¹˜é™¤çš„æŠ½è±¡æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Calculator</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> <span class="title function_">sub</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> <span class="title function_">mul</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> <span class="title function_">div</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åˆ›å»ºå®ç°ç±»"><a href="#åˆ›å»ºå®ç°ç±»" class="headerlink" title="åˆ›å»ºå®ç°ç±»"></a>åˆ›å»ºå®ç°ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CalculatorImpl</span> <span class="keyword">implements</span> <span class="title class_">Calculator</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    </span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> i + j;</span><br><span class="line">    </span><br><span class="line">        System.out.println(<span class="string">&quot;æ–¹æ³•å†…éƒ¨ result = &quot;</span> + result);</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sub</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    </span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> i - j;</span><br><span class="line">    </span><br><span class="line">        System.out.println(<span class="string">&quot;æ–¹æ³•å†…éƒ¨ result = &quot;</span> + result);</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">mul</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    </span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> i * j;</span><br><span class="line">    </span><br><span class="line">        System.out.println(<span class="string">&quot;æ–¹æ³•å†…éƒ¨ result = &quot;</span> + result);</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">div</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    </span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> i / j;</span><br><span class="line">    </span><br><span class="line">        System.out.println(<span class="string">&quot;æ–¹æ³•å†…éƒ¨ result = &quot;</span> + result);</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åˆ›å»ºå¸¦æ—¥å¿—åŠŸèƒ½çš„å®ç°ç±»"><a href="#åˆ›å»ºå¸¦æ—¥å¿—åŠŸèƒ½çš„å®ç°ç±»" class="headerlink" title="åˆ›å»ºå¸¦æ—¥å¿—åŠŸèƒ½çš„å®ç°ç±»"></a>åˆ›å»ºå¸¦æ—¥å¿—åŠŸèƒ½çš„å®ç°ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CalculatorLogImpl</span> <span class="keyword">implements</span> <span class="title class_">Calculator</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    </span><br><span class="line">        System.out.println(<span class="string">&quot;[æ—¥å¿—] add æ–¹æ³•å¼€å§‹äº†ï¼Œå‚æ•°æ˜¯ï¼š&quot;</span> + i + <span class="string">&quot;,&quot;</span> + j);</span><br><span class="line">    </span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> i + j;</span><br><span class="line">    </span><br><span class="line">        System.out.println(<span class="string">&quot;æ–¹æ³•å†…éƒ¨ result = &quot;</span> + result);</span><br><span class="line">    </span><br><span class="line">        System.out.println(<span class="string">&quot;[æ—¥å¿—] add æ–¹æ³•ç»“æŸäº†ï¼Œç»“æœæ˜¯ï¼š&quot;</span> + result);</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sub</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    </span><br><span class="line">        System.out.println(<span class="string">&quot;[æ—¥å¿—] sub æ–¹æ³•å¼€å§‹äº†ï¼Œå‚æ•°æ˜¯ï¼š&quot;</span> + i + <span class="string">&quot;,&quot;</span> + j);</span><br><span class="line">    </span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> i - j;</span><br><span class="line">    </span><br><span class="line">        System.out.println(<span class="string">&quot;æ–¹æ³•å†…éƒ¨ result = &quot;</span> + result);</span><br><span class="line">    </span><br><span class="line">        System.out.println(<span class="string">&quot;[æ—¥å¿—] sub æ–¹æ³•ç»“æŸäº†ï¼Œç»“æœæ˜¯ï¼š&quot;</span> + result);</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">mul</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    </span><br><span class="line">        System.out.println(<span class="string">&quot;[æ—¥å¿—] mul æ–¹æ³•å¼€å§‹äº†ï¼Œå‚æ•°æ˜¯ï¼š&quot;</span> + i + <span class="string">&quot;,&quot;</span> + j);</span><br><span class="line">    </span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> i * j;</span><br><span class="line">    </span><br><span class="line">        System.out.println(<span class="string">&quot;æ–¹æ³•å†…éƒ¨ result = &quot;</span> + result);</span><br><span class="line">    </span><br><span class="line">        System.out.println(<span class="string">&quot;[æ—¥å¿—] mul æ–¹æ³•ç»“æŸäº†ï¼Œç»“æœæ˜¯ï¼š&quot;</span> + result);</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">div</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    </span><br><span class="line">        System.out.println(<span class="string">&quot;[æ—¥å¿—] div æ–¹æ³•å¼€å§‹äº†ï¼Œå‚æ•°æ˜¯ï¼š&quot;</span> + i + <span class="string">&quot;,&quot;</span> + j);</span><br><span class="line">    </span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> i / j;</span><br><span class="line">    </span><br><span class="line">        System.out.println(<span class="string">&quot;æ–¹æ³•å†…éƒ¨ result = &quot;</span> + result);</span><br><span class="line">    </span><br><span class="line">        System.out.println(<span class="string">&quot;[æ—¥å¿—] div æ–¹æ³•ç»“æŸäº†ï¼Œç»“æœæ˜¯ï¼š&quot;</span> + result);</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æå‡ºé—®é¢˜"><a href="#æå‡ºé—®é¢˜" class="headerlink" title="æå‡ºé—®é¢˜"></a>æå‡ºé—®é¢˜</h4><p><strong>â‘ ç°æœ‰ä»£ç ç¼ºé™·</strong></p><p>é’ˆå¯¹å¸¦æ—¥å¿—åŠŸèƒ½çš„å®ç°ç±»ï¼Œæˆ‘ä»¬å‘ç°æœ‰å¦‚ä¸‹ç¼ºé™·ï¼š</p><ul><li>å¯¹æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½æœ‰å¹²æ‰°ï¼Œå¯¼è‡´ç¨‹åºå‘˜åœ¨å¼€å‘æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½æ—¶åˆ†æ•£äº†ç²¾åŠ›</li><li>é™„åŠ åŠŸèƒ½åˆ†æ•£åœ¨å„ä¸ªä¸šåŠ¡åŠŸèƒ½æ–¹æ³•ä¸­ï¼Œä¸åˆ©äºç»Ÿä¸€ç»´æŠ¤</li></ul><p><strong>â‘¡è§£å†³æ€è·¯</strong></p><p>è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œæ ¸å¿ƒå°±æ˜¯ï¼šè§£è€¦ã€‚æˆ‘ä»¬éœ€è¦æŠŠé™„åŠ åŠŸèƒ½ä»ä¸šåŠ¡åŠŸèƒ½ä»£ç ä¸­æŠ½å–å‡ºæ¥ã€‚</p><p><strong>â‘¢å›°éš¾</strong></p><p>è§£å†³é—®é¢˜çš„å›°éš¾ï¼šè¦æŠ½å–çš„ä»£ç åœ¨æ–¹æ³•å†…éƒ¨ï¼Œé ä»¥å‰æŠŠå­ç±»ä¸­çš„é‡å¤ä»£ç æŠ½å–åˆ°çˆ¶ç±»çš„æ–¹å¼æ²¡æ³•è§£å†³ã€‚æ‰€ä»¥éœ€è¦å¼•å…¥æ–°çš„æŠ€æœ¯ã€‚</p><h3 id="ä»£ç†æ¨¡å¼"><a href="#ä»£ç†æ¨¡å¼" class="headerlink" title="ä»£ç†æ¨¡å¼"></a>ä»£ç†æ¨¡å¼</h3><h4 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><p><strong>â‘ ä»‹ç»</strong></p><p>äºŒåä¸‰ç§è®¾è®¡æ¨¡å¼ä¸­çš„ä¸€ç§ï¼Œå±äºç»“æ„å‹æ¨¡å¼ã€‚å®ƒçš„ä½œç”¨å°±æ˜¯é€šè¿‡æä¾›ä¸€ä¸ªä»£ç†ç±»ï¼Œè®©æˆ‘ä»¬åœ¨è°ƒç”¨ç›®æ ‡æ–¹æ³•çš„æ—¶å€™ï¼Œä¸å†æ˜¯ç›´æ¥å¯¹ç›®æ ‡æ–¹æ³•è¿›è¡Œè°ƒç”¨ï¼Œè€Œæ˜¯é€šè¿‡ä»£ç†ç±»<strong>é—´æ¥</strong>è°ƒç”¨ã€‚è®©ä¸å±äºç›®æ ‡æ–¹æ³•æ ¸å¿ƒé€»è¾‘çš„ä»£ç ä»ç›®æ ‡æ–¹æ³•ä¸­å‰¥ç¦»å‡ºæ¥â€”â€”<strong>è§£è€¦</strong>ã€‚è°ƒç”¨ç›®æ ‡æ–¹æ³•æ—¶å…ˆè°ƒç”¨ä»£ç†å¯¹è±¡çš„æ–¹æ³•ï¼Œå‡å°‘å¯¹ç›®æ ‡æ–¹æ³•çš„è°ƒç”¨å’Œæ‰“æ‰°ï¼ŒåŒæ—¶è®©é™„åŠ åŠŸèƒ½èƒ½å¤Ÿé›†ä¸­åœ¨ä¸€èµ·ä¹Ÿæœ‰åˆ©äºç»Ÿä¸€ç»´æŠ¤ã€‚</p><img src="/2023/09/24/Spring/img016.png" class title="images"><p>ä½¿ç”¨ä»£ç†åï¼š</p><img src="/2023/09/24/Spring/img017.png" class title="images"><p><strong>â‘¡ç”Ÿæ´»ä¸­çš„ä»£ç†</strong></p><ul><li>å¹¿å‘Šå•†æ‰¾å¤§æ˜æ˜Ÿæ‹å¹¿å‘Šéœ€è¦ç»è¿‡ç»çºªäºº</li><li>åˆä½œä¼™ä¼´æ‰¾å¤§è€æ¿è°ˆåˆä½œè¦çº¦è§é¢æ—¶é—´éœ€è¦ç»è¿‡ç§˜ä¹¦</li><li>æˆ¿äº§ä¸­ä»‹æ˜¯ä¹°å–åŒæ–¹çš„ä»£ç†</li></ul><p><strong>â‘¢ç›¸å…³æœ¯è¯­</strong></p><ul><li>ä»£ç†ï¼šå°†éæ ¸å¿ƒé€»è¾‘å‰¥ç¦»å‡ºæ¥ä»¥åï¼Œå°è£…è¿™äº›éæ ¸å¿ƒé€»è¾‘çš„ç±»ã€å¯¹è±¡ã€æ–¹æ³•ã€‚</li><li>ç›®æ ‡ï¼šè¢«ä»£ç†â€œå¥—ç”¨â€äº†éæ ¸å¿ƒé€»è¾‘ä»£ç çš„ç±»ã€å¯¹è±¡ã€æ–¹æ³•ã€‚</li></ul><h4 id="é™æ€ä»£ç†"><a href="#é™æ€ä»£ç†" class="headerlink" title="é™æ€ä»£ç†"></a>é™æ€ä»£ç†</h4><p>åˆ›å»ºé™æ€ä»£ç†ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CalculatorStaticProxy</span> <span class="keyword">implements</span> <span class="title class_">Calculator</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å°†è¢«ä»£ç†çš„ç›®æ ‡å¯¹è±¡å£°æ˜ä¸ºæˆå‘˜å˜é‡</span></span><br><span class="line">    <span class="keyword">private</span> Calculator target;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CalculatorStaticProxy</span><span class="params">(Calculator target)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">// é™„åŠ åŠŸèƒ½ç”±ä»£ç†ç±»ä¸­çš„ä»£ç†æ–¹æ³•æ¥å®ç°</span></span><br><span class="line">        System.out.println(<span class="string">&quot;[æ—¥å¿—] add æ–¹æ³•å¼€å§‹äº†ï¼Œå‚æ•°æ˜¯ï¼š&quot;</span> + i + <span class="string">&quot;,&quot;</span> + j);</span><br><span class="line">    </span><br><span class="line">        <span class="comment">// é€šè¿‡ç›®æ ‡å¯¹è±¡æ¥å®ç°æ ¸å¿ƒä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">addResult</span> <span class="operator">=</span> target.add(i, j);</span><br><span class="line">    </span><br><span class="line">        System.out.println(<span class="string">&quot;[æ—¥å¿—] add æ–¹æ³•ç»“æŸäº†ï¼Œç»“æœæ˜¯ï¼š&quot;</span> + addResult);</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> addResult;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>é™æ€ä»£ç†ç¡®å®å®ç°äº†è§£è€¦ï¼Œä½†æ˜¯ç”±äºä»£ç éƒ½å†™æ­»äº†ï¼Œå®Œå…¨ä¸å…·å¤‡ä»»ä½•çš„çµæ´»æ€§ã€‚å°±æ‹¿æ—¥å¿—åŠŸèƒ½æ¥è¯´ï¼Œå°†æ¥å…¶ä»–åœ°æ–¹ä¹Ÿéœ€è¦é™„åŠ æ—¥å¿—ï¼Œé‚£è¿˜å¾—å†å£°æ˜æ›´å¤šä¸ªé™æ€ä»£ç†ç±»ï¼Œé‚£å°±äº§ç”Ÿäº†å¤§é‡é‡å¤çš„ä»£ç ï¼Œæ—¥å¿—åŠŸèƒ½è¿˜æ˜¯åˆ†æ•£çš„ï¼Œæ²¡æœ‰ç»Ÿä¸€ç®¡ç†ã€‚</p><p>æå‡ºè¿›ä¸€æ­¥çš„éœ€æ±‚ï¼šå°†æ—¥å¿—åŠŸèƒ½é›†ä¸­åˆ°ä¸€ä¸ªä»£ç†ç±»ä¸­ï¼Œå°†æ¥æœ‰ä»»ä½•æ—¥å¿—éœ€æ±‚ï¼Œéƒ½é€šè¿‡è¿™ä¸€ä¸ªä»£ç†ç±»æ¥å®ç°ã€‚è¿™å°±éœ€è¦ä½¿ç”¨åŠ¨æ€ä»£ç†æŠ€æœ¯äº†ã€‚</p></blockquote><h4 id="åŠ¨æ€ä»£ç†"><a href="#åŠ¨æ€ä»£ç†" class="headerlink" title="åŠ¨æ€ä»£ç†"></a>åŠ¨æ€ä»£ç†</h4><p>ç”Ÿäº§ä»£ç†å¯¹è±¡çš„å·¥å‚ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProxyFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object target;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ProxyFactory</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getProxy</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * newProxyInstance()ï¼šåˆ›å»ºä¸€ä¸ªä»£ç†å®ä¾‹</span></span><br><span class="line"><span class="comment">         * å…¶ä¸­æœ‰ä¸‰ä¸ªå‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">         * 1ã€classLoaderï¼šåŠ è½½åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»çš„ç±»åŠ è½½å™¨</span></span><br><span class="line"><span class="comment">         * 2ã€interfacesï¼šç›®æ ‡å¯¹è±¡å®ç°çš„æ‰€æœ‰æ¥å£çš„classå¯¹è±¡æ‰€ç»„æˆçš„æ•°ç»„</span></span><br><span class="line"><span class="comment">         * 3ã€invocationHandlerï¼šè®¾ç½®ä»£ç†å¯¹è±¡å®ç°ç›®æ ‡å¯¹è±¡æ–¹æ³•çš„è¿‡ç¨‹ï¼Œå³ä»£ç†ç±»ä¸­å¦‚ä½•é‡å†™æ¥å£ä¸­çš„æŠ½è±¡æ–¹æ³•</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> target.getClass().getClassLoader();</span><br><span class="line">        Class&lt;?&gt;[] interfaces = target.getClass().getInterfaces();</span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">invocationHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvocationHandler</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">                 * proxyï¼šä»£ç†å¯¹è±¡</span></span><br><span class="line"><span class="comment">                 * methodï¼šä»£ç†å¯¹è±¡éœ€è¦å®ç°çš„æ–¹æ³•ï¼Œå³å…¶ä¸­éœ€è¦é‡å†™çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">                 * argsï¼šmethodæ‰€å¯¹åº”æ–¹æ³•çš„å‚æ•°</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;[åŠ¨æ€ä»£ç†][æ—¥å¿—] &quot;</span>+method.getName()+<span class="string">&quot;ï¼Œå‚æ•°ï¼š&quot;</span>+ Arrays.toString(args));</span><br><span class="line">                    result = method.invoke(target, args);</span><br><span class="line">                    System.out.println(<span class="string">&quot;[åŠ¨æ€ä»£ç†][æ—¥å¿—] &quot;</span>+method.getName()+<span class="string">&quot;ï¼Œç»“æœï¼š&quot;</span>+ result);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                    System.out.println(<span class="string">&quot;[åŠ¨æ€ä»£ç†][æ—¥å¿—] &quot;</span>+method.getName()+<span class="string">&quot;ï¼Œå¼‚å¸¸ï¼š&quot;</span>+e.getMessage());</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;[åŠ¨æ€ä»£ç†][æ—¥å¿—] &quot;</span>+method.getName()+<span class="string">&quot;ï¼Œæ–¹æ³•æ‰§è¡Œå®Œæ¯•&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Proxy.newProxyInstance(classLoader, interfaces, invocationHandler);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDynamicProxy</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">ProxyFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProxyFactory</span>(<span class="keyword">new</span> <span class="title class_">CalculatorLogImpl</span>());</span><br><span class="line">    <span class="type">Calculator</span> <span class="variable">proxy</span> <span class="operator">=</span> (Calculator) factory.getProxy();</span><br><span class="line">    proxy.div(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="comment">//proxy.div(1,1);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="AOPæ¦‚å¿µåŠç›¸å…³æœ¯è¯­"><a href="#AOPæ¦‚å¿µåŠç›¸å…³æœ¯è¯­" class="headerlink" title="AOPæ¦‚å¿µåŠç›¸å…³æœ¯è¯­"></a>AOPæ¦‚å¿µåŠç›¸å…³æœ¯è¯­</h3><h4 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h4><p>AOPï¼ˆAspect Oriented Programmingï¼‰æ˜¯ä¸€ç§è®¾è®¡æ€æƒ³ï¼Œæ˜¯è½¯ä»¶è®¾è®¡é¢†åŸŸä¸­çš„é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œå®ƒæ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¸€ç§è¡¥å……å’Œå®Œå–„ï¼Œå®ƒä»¥é€šè¿‡é¢„ç¼–è¯‘æ–¹å¼å’Œè¿è¡ŒæœŸåŠ¨æ€ä»£ç†æ–¹å¼å®ç°ï¼Œåœ¨ä¸ä¿®æ”¹æºä»£ç çš„æƒ…å†µä¸‹ï¼Œç»™ç¨‹åºåŠ¨æ€ç»Ÿä¸€æ·»åŠ é¢å¤–åŠŸèƒ½çš„ä¸€ç§æŠ€æœ¯ã€‚åˆ©ç”¨AOPå¯ä»¥å¯¹ä¸šåŠ¡é€»è¾‘çš„å„ä¸ªéƒ¨åˆ†è¿›è¡Œéš”ç¦»ï¼Œä»è€Œä½¿å¾—ä¸šåŠ¡é€»è¾‘å„éƒ¨åˆ†ä¹‹é—´çš„è€¦åˆåº¦é™ä½ï¼Œæé«˜ç¨‹åºçš„å¯é‡ç”¨æ€§ï¼ŒåŒæ—¶æé«˜äº†å¼€å‘çš„æ•ˆç‡ã€‚</p><h4 id="ç›¸å…³æœ¯è¯­"><a href="#ç›¸å…³æœ¯è¯­" class="headerlink" title="ç›¸å…³æœ¯è¯­"></a>ç›¸å…³æœ¯è¯­</h4><h5 id="â‘ æ¨ªåˆ‡å…³æ³¨ç‚¹"><a href="#â‘ æ¨ªåˆ‡å…³æ³¨ç‚¹" class="headerlink" title="â‘ æ¨ªåˆ‡å…³æ³¨ç‚¹"></a>â‘ æ¨ªåˆ‡å…³æ³¨ç‚¹</h5><p>åˆ†æ•£åœ¨æ¯ä¸ªå„ä¸ªæ¨¡å—ä¸­è§£å†³åŒä¸€æ ·çš„é—®é¢˜ï¼Œå¦‚ç”¨æˆ·éªŒè¯ã€æ—¥å¿—ç®¡ç†ã€äº‹åŠ¡å¤„ç†ã€æ•°æ®ç¼“å­˜éƒ½å±äºæ¨ªåˆ‡å…³æ³¨ç‚¹ã€‚</p><p>ä»æ¯ä¸ªæ–¹æ³•ä¸­æŠ½å–å‡ºæ¥çš„åŒä¸€ç±»éæ ¸å¿ƒä¸šåŠ¡ã€‚åœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šä¸ªæ¨ªåˆ‡å…³æ³¨ç‚¹å¯¹ç›¸å…³æ–¹æ³•è¿›è¡Œå¤šä¸ªä¸åŒæ–¹é¢çš„å¢å¼ºã€‚</p><p>è¿™ä¸ªæ¦‚å¿µä¸æ˜¯è¯­æ³•å±‚é¢çš„ï¼Œè€Œæ˜¯æ ¹æ®é™„åŠ åŠŸèƒ½çš„é€»è¾‘ä¸Šçš„éœ€è¦ï¼šæœ‰åä¸ªé™„åŠ åŠŸèƒ½ï¼Œå°±æœ‰åä¸ªæ¨ªåˆ‡å…³æ³¨ç‚¹ã€‚</p><img src="/2023/09/24/Spring/img019.png" class title="images"><h5 id="â‘¡é€šçŸ¥ï¼ˆå¢å¼ºï¼‰"><a href="#â‘¡é€šçŸ¥ï¼ˆå¢å¼ºï¼‰" class="headerlink" title="â‘¡é€šçŸ¥ï¼ˆå¢å¼ºï¼‰"></a>â‘¡é€šçŸ¥ï¼ˆå¢å¼ºï¼‰</h5><p><strong>å¢å¼ºï¼Œé€šä¿—è¯´ï¼Œå°±æ˜¯ä½ æƒ³è¦å¢å¼ºçš„åŠŸèƒ½ï¼Œæ¯”å¦‚ å®‰å…¨ï¼Œäº‹åŠ¡ï¼Œæ—¥å¿—ç­‰ã€‚</strong></p><p>æ¯ä¸€ä¸ªæ¨ªåˆ‡å…³æ³¨ç‚¹ä¸Šè¦åšçš„äº‹æƒ…éƒ½éœ€è¦å†™ä¸€ä¸ªæ–¹æ³•æ¥å®ç°ï¼Œè¿™æ ·çš„æ–¹æ³•å°±å«é€šçŸ¥æ–¹æ³•ã€‚</p><ul><li>å‰ç½®é€šçŸ¥ï¼šåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•<strong>å‰</strong>æ‰§è¡Œ</li><li>è¿”å›é€šçŸ¥ï¼šåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•<strong>æˆåŠŸç»“æŸ</strong>åæ‰§è¡Œï¼ˆ<strong>å¯¿ç»ˆæ­£å¯</strong>ï¼‰</li><li>å¼‚å¸¸é€šçŸ¥ï¼šåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•<strong>å¼‚å¸¸ç»“æŸ</strong>åæ‰§è¡Œï¼ˆ<strong>æ­»äºéå‘½</strong>ï¼‰</li><li>åç½®é€šçŸ¥ï¼šåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•<strong>æœ€ç»ˆç»“æŸ</strong>åæ‰§è¡Œï¼ˆ<strong>ç›–æ£ºå®šè®º</strong>ï¼‰</li><li>ç¯ç»•é€šçŸ¥ï¼šä½¿ç”¨tryâ€¦catchâ€¦finallyç»“æ„å›´ç»•<strong>æ•´ä¸ª</strong>è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•ï¼ŒåŒ…æ‹¬ä¸Šé¢å››ç§é€šçŸ¥å¯¹åº”çš„æ‰€æœ‰ä½ç½®</li></ul><img src="/2023/09/24/Spring/img020.png" class title="images"><h5 id="â‘¢åˆ‡é¢"><a href="#â‘¢åˆ‡é¢" class="headerlink" title="â‘¢åˆ‡é¢"></a>â‘¢åˆ‡é¢</h5><p>å°è£…é€šçŸ¥æ–¹æ³•çš„ç±»ã€‚</p><img src="/2023/09/24/Spring/img021.png" class title="images"><h5 id="â‘£ç›®æ ‡"><a href="#â‘£ç›®æ ‡" class="headerlink" title="â‘£ç›®æ ‡"></a>â‘£ç›®æ ‡</h5><p>è¢«ä»£ç†çš„ç›®æ ‡å¯¹è±¡ã€‚</p><h5 id="â‘¤ä»£ç†"><a href="#â‘¤ä»£ç†" class="headerlink" title="â‘¤ä»£ç†"></a>â‘¤ä»£ç†</h5><p>å‘ç›®æ ‡å¯¹è±¡åº”ç”¨é€šçŸ¥ä¹‹ååˆ›å»ºçš„ä»£ç†å¯¹è±¡ã€‚</p><h5 id="â‘¥è¿æ¥ç‚¹"><a href="#â‘¥è¿æ¥ç‚¹" class="headerlink" title="â‘¥è¿æ¥ç‚¹"></a>â‘¥è¿æ¥ç‚¹</h5><p>è¿™ä¹Ÿæ˜¯ä¸€ä¸ªçº¯é€»è¾‘æ¦‚å¿µï¼Œä¸æ˜¯è¯­æ³•å®šä¹‰çš„ã€‚</p><p>æŠŠæ–¹æ³•æ’æˆä¸€æ’ï¼Œæ¯ä¸€ä¸ªæ¨ªåˆ‡ä½ç½®çœ‹æˆxè½´æ–¹å‘ï¼ŒæŠŠæ–¹æ³•ä»ä¸Šåˆ°ä¸‹æ‰§è¡Œçš„é¡ºåºçœ‹æˆyè½´ï¼Œxè½´å’Œyè½´çš„äº¤å‰ç‚¹å°±æ˜¯è¿æ¥ç‚¹ã€‚<strong>é€šä¿—è¯´ï¼Œå°±æ˜¯springå…è®¸ä½ ä½¿ç”¨é€šçŸ¥çš„åœ°æ–¹</strong></p><img src="/2023/09/24/Spring/img022.png" class title="images"><h5 id="â‘¦åˆ‡å…¥ç‚¹"><a href="#â‘¦åˆ‡å…¥ç‚¹" class="headerlink" title="â‘¦åˆ‡å…¥ç‚¹"></a>â‘¦åˆ‡å…¥ç‚¹</h5><p>å®šä½è¿æ¥ç‚¹çš„æ–¹å¼ã€‚</p><p>æ¯ä¸ªç±»çš„æ–¹æ³•ä¸­éƒ½åŒ…å«å¤šä¸ªè¿æ¥ç‚¹ï¼Œæ‰€ä»¥è¿æ¥ç‚¹æ˜¯ç±»ä¸­å®¢è§‚å­˜åœ¨çš„äº‹ç‰©ï¼ˆä»é€»è¾‘ä¸Šæ¥è¯´ï¼‰ã€‚</p><p>å¦‚æœæŠŠè¿æ¥ç‚¹çœ‹ä½œæ•°æ®åº“ä¸­çš„è®°å½•ï¼Œé‚£ä¹ˆåˆ‡å…¥ç‚¹å°±æ˜¯æŸ¥è¯¢è®°å½•çš„ SQL è¯­å¥ã€‚</p><p><strong>Spring çš„ AOP æŠ€æœ¯å¯ä»¥é€šè¿‡åˆ‡å…¥ç‚¹å®šä½åˆ°ç‰¹å®šçš„è¿æ¥ç‚¹ã€‚é€šä¿—è¯´ï¼Œè¦å®é™…å»å¢å¼ºçš„æ–¹æ³•</strong></p><p>åˆ‡ç‚¹é€šè¿‡ org.springframework.aop.Pointcut æ¥å£è¿›è¡Œæè¿°ï¼Œå®ƒä½¿ç”¨ç±»å’Œæ–¹æ³•ä½œä¸ºè¿æ¥ç‚¹çš„æŸ¥è¯¢æ¡ä»¶ã€‚</p><h4 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h4><ul><li><p>ç®€åŒ–ä»£ç ï¼šæŠŠæ–¹æ³•ä¸­å›ºå®šä½ç½®çš„é‡å¤çš„ä»£ç <strong>æŠ½å–</strong>å‡ºæ¥ï¼Œè®©è¢«æŠ½å–çš„æ–¹æ³•æ›´ä¸“æ³¨äºè‡ªå·±çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œæé«˜å†…èšæ€§ã€‚</p></li><li><p>ä»£ç å¢å¼ºï¼šæŠŠç‰¹å®šçš„åŠŸèƒ½å°è£…åˆ°åˆ‡é¢ç±»ä¸­ï¼Œçœ‹å“ªé‡Œæœ‰éœ€è¦ï¼Œå°±å¾€ä¸Šå¥—ï¼Œè¢«<strong>å¥—ç”¨</strong>äº†åˆ‡é¢é€»è¾‘çš„æ–¹æ³•å°±è¢«åˆ‡é¢ç»™å¢å¼ºäº†ã€‚</p></li></ul><h3 id="åŸºäºæ³¨è§£çš„AOP"><a href="#åŸºäºæ³¨è§£çš„AOP" class="headerlink" title="åŸºäºæ³¨è§£çš„AOP"></a>åŸºäºæ³¨è§£çš„AOP</h3><h4 id="æŠ€æœ¯è¯´æ˜"><a href="#æŠ€æœ¯è¯´æ˜" class="headerlink" title="æŠ€æœ¯è¯´æ˜"></a>æŠ€æœ¯è¯´æ˜</h4><img src="/2023/09/24/Spring/img023.png" class title="images"><img src="/2023/09/24/Spring/image-20221216132844066.png" class title="image-20221216132844066"><ul><li>åŠ¨æ€ä»£ç†åˆ†ä¸ºJDKåŠ¨æ€ä»£ç†å’ŒcglibåŠ¨æ€ä»£ç†</li><li>å½“ç›®æ ‡ç±»æœ‰æ¥å£çš„æƒ…å†µä½¿ç”¨JDKåŠ¨æ€ä»£ç†å’ŒcglibåŠ¨æ€ä»£ç†ï¼Œæ²¡æœ‰æ¥å£æ—¶åªèƒ½ä½¿ç”¨cglibåŠ¨æ€ä»£ç†</li><li>JDKåŠ¨æ€ä»£ç†åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»ä¼šåœ¨com.sun.proxyåŒ…ä¸‹ï¼Œç±»åä¸º$proxy1ï¼Œå’Œç›®æ ‡ç±»å®ç°ç›¸åŒçš„æ¥å£</li><li>cglibåŠ¨æ€ä»£ç†åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»ä¼šå’Œç›®æ ‡åœ¨åœ¨ç›¸åŒçš„åŒ…ä¸‹ï¼Œä¼šç»§æ‰¿ç›®æ ‡ç±»</li><li>åŠ¨æ€ä»£ç†ï¼ˆInvocationHandlerï¼‰ï¼šJDKåŸç”Ÿçš„å®ç°æ–¹å¼ï¼Œéœ€è¦è¢«ä»£ç†çš„ç›®æ ‡ç±»å¿…é¡»å®ç°æ¥å£ã€‚å› ä¸ºè¿™ä¸ªæŠ€æœ¯è¦æ±‚<strong>ä»£ç†å¯¹è±¡å’Œç›®æ ‡å¯¹è±¡å®ç°åŒæ ·çš„æ¥å£</strong>ï¼ˆå…„å¼Ÿä¸¤ä¸ªæ‹œæŠŠå­æ¨¡å¼ï¼‰ã€‚</li><li>cglibï¼šé€šè¿‡<strong>ç»§æ‰¿è¢«ä»£ç†çš„ç›®æ ‡ç±»</strong>ï¼ˆè®¤å¹²çˆ¹æ¨¡å¼ï¼‰å®ç°ä»£ç†ï¼Œæ‰€ä»¥ä¸éœ€è¦ç›®æ ‡ç±»å®ç°æ¥å£ã€‚</li><li>AspectJï¼šæ˜¯AOPæ€æƒ³çš„ä¸€ç§å®ç°ã€‚æœ¬è´¨ä¸Šæ˜¯é™æ€ä»£ç†ï¼Œ<strong>å°†ä»£ç†é€»è¾‘â€œç»‡å…¥â€è¢«ä»£ç†çš„ç›®æ ‡ç±»ç¼–è¯‘å¾—åˆ°çš„å­—èŠ‚ç æ–‡ä»¶</strong>ï¼Œæ‰€ä»¥æœ€ç»ˆæ•ˆæœæ˜¯åŠ¨æ€çš„ã€‚weaverå°±æ˜¯ç»‡å…¥å™¨ã€‚Springåªæ˜¯å€Ÿç”¨äº†AspectJä¸­çš„æ³¨è§£ã€‚</li></ul><h4 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h4><p><strong>â‘ æ·»åŠ ä¾èµ–</strong></p><p>åœ¨IOCæ‰€éœ€ä¾èµ–åŸºç¡€ä¸Šå†åŠ å…¥ä¸‹é¢ä¾èµ–å³å¯ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--spring contextä¾èµ–--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å½“ä½ å¼•å…¥Spring Contextä¾èµ–ä¹‹åï¼Œè¡¨ç¤ºå°†Springçš„åŸºç¡€ä¾èµ–å¼•å…¥äº†--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--spring aopä¾èµ–--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--spring aspectsä¾èµ–--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--junit5æµ‹è¯•--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.jupiter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-jupiter-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--log4j2çš„ä¾èµ–--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.19.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-slf4j2-impl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.19.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>â‘¡å‡†å¤‡è¢«ä»£ç†çš„ç›®æ ‡èµ„æº</strong></p><p>æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Calculator</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> <span class="title function_">sub</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> <span class="title function_">mul</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> <span class="title function_">div</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CalculatorImpl</span> <span class="keyword">implements</span> <span class="title class_">Calculator</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    </span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> i + j;</span><br><span class="line">    </span><br><span class="line">        System.out.println(<span class="string">&quot;æ–¹æ³•å†…éƒ¨ result = &quot;</span> + result);</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sub</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    </span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> i - j;</span><br><span class="line">    </span><br><span class="line">        System.out.println(<span class="string">&quot;æ–¹æ³•å†…éƒ¨ result = &quot;</span> + result);</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">mul</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    </span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> i * j;</span><br><span class="line">    </span><br><span class="line">        System.out.println(<span class="string">&quot;æ–¹æ³•å†…éƒ¨ result = &quot;</span> + result);</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">div</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    </span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> i / j;</span><br><span class="line">    </span><br><span class="line">        System.out.println(<span class="string">&quot;æ–¹æ³•å†…éƒ¨ result = &quot;</span> + result);</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åˆ›å»ºåˆ‡é¢ç±»å¹¶é…ç½®"><a href="#åˆ›å»ºåˆ‡é¢ç±»å¹¶é…ç½®" class="headerlink" title="åˆ›å»ºåˆ‡é¢ç±»å¹¶é…ç½®"></a>åˆ›å»ºåˆ‡é¢ç±»å¹¶é…ç½®</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @Aspectè¡¨ç¤ºè¿™ä¸ªç±»æ˜¯ä¸€ä¸ªåˆ‡é¢ç±»</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="comment">// @Componentæ³¨è§£ä¿è¯è¿™ä¸ªåˆ‡é¢ç±»èƒ½å¤Ÿæ”¾å…¥IOCå®¹å™¨</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspect</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Before(&quot;execution(public int com.hang.aop.annotation.CalculatorImpl.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeMethod</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> joinPoint.getSignature().getName();</span><br><span class="line">        <span class="type">String</span> <span class="variable">args</span> <span class="operator">=</span> Arrays.toString(joinPoint.getArgs());</span><br><span class="line">        System.out.println(<span class="string">&quot;Logger--&gt;å‰ç½®é€šçŸ¥ï¼Œæ–¹æ³•åï¼š&quot;</span>+methodName+<span class="string">&quot;ï¼Œå‚æ•°ï¼š&quot;</span>+args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After(&quot;execution(* com.hang.aop.annotation.CalculatorImpl.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterMethod</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> joinPoint.getSignature().getName();</span><br><span class="line">        System.out.println(<span class="string">&quot;Logger--&gt;åç½®é€šçŸ¥ï¼Œæ–¹æ³•åï¼š&quot;</span>+methodName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning(value = &quot;execution(* com.hang.aop.annotation.CalculatorImpl.*(..))&quot;, returning = &quot;result&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturningMethod</span><span class="params">(JoinPoint joinPoint, Object result)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> joinPoint.getSignature().getName();</span><br><span class="line">        System.out.println(<span class="string">&quot;Logger--&gt;è¿”å›é€šçŸ¥ï¼Œæ–¹æ³•åï¼š&quot;</span>+methodName+<span class="string">&quot;ï¼Œç»“æœï¼š&quot;</span>+result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterThrowing(value = &quot;execution(* com.hang.aop.annotation.CalculatorImpl.*(..))&quot;, throwing = &quot;ex&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowingMethod</span><span class="params">(JoinPoint joinPoint, Throwable ex)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> joinPoint.getSignature().getName();</span><br><span class="line">        System.out.println(<span class="string">&quot;Logger--&gt;å¼‚å¸¸é€šçŸ¥ï¼Œæ–¹æ³•åï¼š&quot;</span>+methodName+<span class="string">&quot;ï¼Œå¼‚å¸¸ï¼š&quot;</span>+ex);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Around(&quot;execution(* com.hang.aop.annotation.CalculatorImpl.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">aroundMethod</span><span class="params">(ProceedingJoinPoint joinPoint)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> joinPoint.getSignature().getName();</span><br><span class="line">        <span class="type">String</span> <span class="variable">args</span> <span class="operator">=</span> Arrays.toString(joinPoint.getArgs());</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç¯ç»•é€šçŸ¥--&gt;ç›®æ ‡å¯¹è±¡æ–¹æ³•æ‰§è¡Œä¹‹å‰&quot;</span>);</span><br><span class="line">            <span class="comment">//ç›®æ ‡å¯¹è±¡ï¼ˆè¿æ¥ç‚¹ï¼‰æ–¹æ³•çš„æ‰§è¡Œ</span></span><br><span class="line">            result = joinPoint.proceed();</span><br><span class="line">            System.out.println(<span class="string">&quot;ç¯ç»•é€šçŸ¥--&gt;ç›®æ ‡å¯¹è±¡æ–¹æ³•è¿”å›å€¼ä¹‹å&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">            throwable.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">&quot;ç¯ç»•é€šçŸ¥--&gt;ç›®æ ‡å¯¹è±¡æ–¹æ³•å‡ºç°å¼‚å¸¸æ—¶&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ç¯ç»•é€šçŸ¥--&gt;ç›®æ ‡å¯¹è±¡æ–¹æ³•æ‰§è¡Œå®Œæ¯•&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨Springçš„é…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        åŸºäºæ³¨è§£çš„AOPçš„å®ç°ï¼š</span></span><br><span class="line"><span class="comment">        1ã€å°†ç›®æ ‡å¯¹è±¡å’Œåˆ‡é¢äº¤ç»™IOCå®¹å™¨ç®¡ç†ï¼ˆæ³¨è§£+æ‰«æï¼‰</span></span><br><span class="line"><span class="comment">        2ã€å¼€å¯AspectJçš„è‡ªåŠ¨ä»£ç†ï¼Œä¸ºç›®æ ‡å¯¹è±¡è‡ªåŠ¨ç”Ÿæˆä»£ç†</span></span><br><span class="line"><span class="comment">        3ã€å°†åˆ‡é¢ç±»é€šè¿‡æ³¨è§£@Aspectæ ‡è¯†</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.hang.aop.annotation&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œæµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CalculatorTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(CalculatorTest.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAdd</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line">        <span class="type">Calculator</span> <span class="variable">calculator</span> <span class="operator">=</span> ac.getBean( Calculator.class);</span><br><span class="line">        <span class="type">int</span> <span class="variable">add</span> <span class="operator">=</span> calculator.add(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">        logger.info(<span class="string">&quot;æ‰§è¡ŒæˆåŠŸ:&quot;</span>+add);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœï¼š</p><h4 id="å„ç§é€šçŸ¥"><a href="#å„ç§é€šçŸ¥" class="headerlink" title="å„ç§é€šçŸ¥"></a>å„ç§é€šçŸ¥</h4><ul><li>å‰ç½®é€šçŸ¥ï¼šä½¿ç”¨@Beforeæ³¨è§£æ ‡è¯†ï¼Œåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•<strong>å‰</strong>æ‰§è¡Œ</li><li>è¿”å›é€šçŸ¥ï¼šä½¿ç”¨@AfterReturningæ³¨è§£æ ‡è¯†ï¼Œåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•<strong>æˆåŠŸç»“æŸ</strong>åæ‰§è¡Œï¼ˆ<strong>å¯¿ç»ˆæ­£å¯</strong>ï¼‰</li><li>å¼‚å¸¸é€šçŸ¥ï¼šä½¿ç”¨@AfterThrowingæ³¨è§£æ ‡è¯†ï¼Œåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•<strong>å¼‚å¸¸ç»“æŸ</strong>åæ‰§è¡Œï¼ˆ<strong>æ­»äºéå‘½</strong>ï¼‰</li><li>åç½®é€šçŸ¥ï¼šä½¿ç”¨@Afteræ³¨è§£æ ‡è¯†ï¼Œåœ¨è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•<strong>æœ€ç»ˆç»“æŸ</strong>åæ‰§è¡Œï¼ˆ<strong>ç›–æ£ºå®šè®º</strong>ï¼‰</li><li>ç¯ç»•é€šçŸ¥ï¼šä½¿ç”¨@Aroundæ³¨è§£æ ‡è¯†ï¼Œä½¿ç”¨tryâ€¦catchâ€¦finallyç»“æ„å›´ç»•<strong>æ•´ä¸ª</strong>è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•ï¼ŒåŒ…æ‹¬ä¸Šé¢å››ç§é€šçŸ¥å¯¹åº”çš„æ‰€æœ‰ä½ç½®</li></ul><h4 id="åˆ‡å…¥ç‚¹è¡¨è¾¾å¼è¯­æ³•"><a href="#åˆ‡å…¥ç‚¹è¡¨è¾¾å¼è¯­æ³•" class="headerlink" title="åˆ‡å…¥ç‚¹è¡¨è¾¾å¼è¯­æ³•"></a>åˆ‡å…¥ç‚¹è¡¨è¾¾å¼è¯­æ³•</h4><p><strong>â‘ ä½œç”¨</strong></p><img src="/2023/09/24/Spring/img024.png" class title="images"><p><strong>â‘¡è¯­æ³•ç»†èŠ‚</strong></p><ul><li><p>ç”¨*å·ä»£æ›¿â€œæƒé™ä¿®é¥°ç¬¦â€å’Œâ€œè¿”å›å€¼â€éƒ¨åˆ†è¡¨ç¤ºâ€œæƒé™ä¿®é¥°ç¬¦â€å’Œâ€œè¿”å›å€¼â€ä¸é™</p></li><li><p>åœ¨åŒ…åçš„éƒ¨åˆ†ï¼Œä¸€ä¸ªâ€œ*â€å·åªèƒ½ä»£è¡¨åŒ…çš„å±‚æ¬¡ç»“æ„ä¸­çš„ä¸€å±‚ï¼Œè¡¨ç¤ºè¿™ä¸€å±‚æ˜¯ä»»æ„çš„ã€‚</p><ul><li>ä¾‹å¦‚ï¼š*.HelloåŒ¹é…com.Helloï¼Œä¸åŒ¹é…com.hang.Hello</li></ul></li><li><p>åœ¨åŒ…åçš„éƒ¨åˆ†ï¼Œä½¿ç”¨â€œ*..â€è¡¨ç¤ºåŒ…åä»»æ„ã€åŒ…çš„å±‚æ¬¡æ·±åº¦ä»»æ„</p></li><li><p>åœ¨ç±»åçš„éƒ¨åˆ†ï¼Œç±»åéƒ¨åˆ†æ•´ä½“ç”¨*å·ä»£æ›¿ï¼Œè¡¨ç¤ºç±»åä»»æ„</p></li><li><p>åœ¨ç±»åçš„éƒ¨åˆ†ï¼Œå¯ä»¥ä½¿ç”¨*å·ä»£æ›¿ç±»åçš„ä¸€éƒ¨åˆ†</p><ul><li>ä¾‹å¦‚ï¼š*ServiceåŒ¹é…æ‰€æœ‰åç§°ä»¥Serviceç»“å°¾çš„ç±»æˆ–æ¥å£</li></ul></li><li><p>åœ¨æ–¹æ³•åéƒ¨åˆ†ï¼Œå¯ä»¥ä½¿ç”¨*å·è¡¨ç¤ºæ–¹æ³•åä»»æ„</p></li><li><p>åœ¨æ–¹æ³•åéƒ¨åˆ†ï¼Œå¯ä»¥ä½¿ç”¨*å·ä»£æ›¿æ–¹æ³•åçš„ä¸€éƒ¨åˆ†</p><ul><li>ä¾‹å¦‚ï¼š*OperationåŒ¹é…æ‰€æœ‰æ–¹æ³•åä»¥Operationç»“å°¾çš„æ–¹æ³•</li></ul></li><li><p>åœ¨æ–¹æ³•å‚æ•°åˆ—è¡¨éƒ¨åˆ†ï¼Œä½¿ç”¨(..)è¡¨ç¤ºå‚æ•°åˆ—è¡¨ä»»æ„</p></li><li><p>åœ¨æ–¹æ³•å‚æ•°åˆ—è¡¨éƒ¨åˆ†ï¼Œä½¿ç”¨(int,..)è¡¨ç¤ºå‚æ•°åˆ—è¡¨ä»¥ä¸€ä¸ªintç±»å‹çš„å‚æ•°å¼€å¤´</p></li><li><p>åœ¨æ–¹æ³•å‚æ•°åˆ—è¡¨éƒ¨åˆ†ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹å’Œå¯¹åº”çš„åŒ…è£…ç±»å‹æ˜¯ä¸ä¸€æ ·çš„</p><ul><li>åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ä¸­ä½¿ç”¨ int å’Œå®é™…æ–¹æ³•ä¸­ Integer æ˜¯ä¸åŒ¹é…çš„</li></ul></li><li><p>åœ¨æ–¹æ³•è¿”å›å€¼éƒ¨åˆ†ï¼Œå¦‚æœæƒ³è¦æ˜ç¡®æŒ‡å®šä¸€ä¸ªè¿”å›å€¼ç±»å‹ï¼Œé‚£ä¹ˆå¿…é¡»åŒæ—¶å†™æ˜æƒé™ä¿®é¥°ç¬¦</p><ul><li>ä¾‹å¦‚ï¼šexecution(public int <em>..<em>Service.</em>(.., int))æ­£ç¡®<br>ä¾‹å¦‚ï¼šexecution(</em> int *..<em>Service.</em>(.., int))é”™è¯¯</li></ul></li></ul><img src="/2023/09/24/Spring/img025.png" class title="images"><h4 id="é‡ç”¨åˆ‡å…¥ç‚¹è¡¨è¾¾å¼"><a href="#é‡ç”¨åˆ‡å…¥ç‚¹è¡¨è¾¾å¼" class="headerlink" title="é‡ç”¨åˆ‡å…¥ç‚¹è¡¨è¾¾å¼"></a>é‡ç”¨åˆ‡å…¥ç‚¹è¡¨è¾¾å¼</h4><p><strong>â‘ å£°æ˜</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut(&quot;execution(* com.hang.aop.annotation.*.*(..))&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pointCut</span><span class="params">()</span>&#123;&#125;</span><br></pre></td></tr></table></figure><p><strong>â‘¡åœ¨åŒä¸€ä¸ªåˆ‡é¢ä¸­ä½¿ç”¨</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before(&quot;pointCut()&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeMethod</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> joinPoint.getSignature().getName();</span><br><span class="line">    <span class="type">String</span> <span class="variable">args</span> <span class="operator">=</span> Arrays.toString(joinPoint.getArgs());</span><br><span class="line">    System.out.println(<span class="string">&quot;Logger--&gt;å‰ç½®é€šçŸ¥ï¼Œæ–¹æ³•åï¼š&quot;</span>+methodName+<span class="string">&quot;ï¼Œå‚æ•°ï¼š&quot;</span>+args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>â‘¢åœ¨ä¸åŒåˆ‡é¢ä¸­ä½¿ç”¨</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before(&quot;com.hang.aop.CommonPointCut.pointCut()&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeMethod</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> joinPoint.getSignature().getName();</span><br><span class="line">    <span class="type">String</span> <span class="variable">args</span> <span class="operator">=</span> Arrays.toString(joinPoint.getArgs());</span><br><span class="line">    System.out.println(<span class="string">&quot;Logger--&gt;å‰ç½®é€šçŸ¥ï¼Œæ–¹æ³•åï¼š&quot;</span>+methodName+<span class="string">&quot;ï¼Œå‚æ•°ï¼š&quot;</span>+args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è·å–é€šçŸ¥çš„ç›¸å…³ä¿¡æ¯"><a href="#è·å–é€šçŸ¥çš„ç›¸å…³ä¿¡æ¯" class="headerlink" title="è·å–é€šçŸ¥çš„ç›¸å…³ä¿¡æ¯"></a>è·å–é€šçŸ¥çš„ç›¸å…³ä¿¡æ¯</h4><p><strong>â‘ è·å–è¿æ¥ç‚¹ä¿¡æ¯</strong></p><p>è·å–è¿æ¥ç‚¹ä¿¡æ¯å¯ä»¥åœ¨é€šçŸ¥æ–¹æ³•çš„å‚æ•°ä½ç½®è®¾ç½®JoinPointç±»å‹çš„å½¢å‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before(&quot;execution(public int com.hang.aop.annotation.CalculatorImpl.*(..))&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeMethod</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">    <span class="comment">//è·å–è¿æ¥ç‚¹çš„ç­¾åä¿¡æ¯</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> joinPoint.getSignature().getName();</span><br><span class="line">    <span class="comment">//è·å–ç›®æ ‡æ–¹æ³•åˆ°çš„å®å‚ä¿¡æ¯</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">args</span> <span class="operator">=</span> Arrays.toString(joinPoint.getArgs());</span><br><span class="line">    System.out.println(<span class="string">&quot;Logger--&gt;å‰ç½®é€šçŸ¥ï¼Œæ–¹æ³•åï¼š&quot;</span>+methodName+<span class="string">&quot;ï¼Œå‚æ•°ï¼š&quot;</span>+args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>â‘¡è·å–ç›®æ ‡æ–¹æ³•çš„è¿”å›å€¼</strong></p><p>@AfterReturningä¸­çš„å±æ€§returningï¼Œç”¨æ¥å°†é€šçŸ¥æ–¹æ³•çš„æŸä¸ªå½¢å‚ï¼Œæ¥æ”¶ç›®æ ‡æ–¹æ³•çš„è¿”å›å€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AfterReturning(value = &quot;execution(* com.hang.aop.annotation.CalculatorImpl.*(..))&quot;, returning = &quot;result&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturningMethod</span><span class="params">(JoinPoint joinPoint, Object result)</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> joinPoint.getSignature().getName();</span><br><span class="line">    System.out.println(<span class="string">&quot;Logger--&gt;è¿”å›é€šçŸ¥ï¼Œæ–¹æ³•åï¼š&quot;</span>+methodName+<span class="string">&quot;ï¼Œç»“æœï¼š&quot;</span>+result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>â‘¢è·å–ç›®æ ‡æ–¹æ³•çš„å¼‚å¸¸</strong></p><p>@AfterThrowingä¸­çš„å±æ€§throwingï¼Œç”¨æ¥å°†é€šçŸ¥æ–¹æ³•çš„æŸä¸ªå½¢å‚ï¼Œæ¥æ”¶ç›®æ ‡æ–¹æ³•çš„å¼‚å¸¸</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AfterThrowing(value = &quot;execution(* com.hang.aop.annotation.CalculatorImpl.*(..))&quot;, throwing = &quot;ex&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowingMethod</span><span class="params">(JoinPoint joinPoint, Throwable ex)</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> joinPoint.getSignature().getName();</span><br><span class="line">    System.out.println(<span class="string">&quot;Logger--&gt;å¼‚å¸¸é€šçŸ¥ï¼Œæ–¹æ³•åï¼š&quot;</span>+methodName+<span class="string">&quot;ï¼Œå¼‚å¸¸ï¼š&quot;</span>+ex);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç¯ç»•é€šçŸ¥"><a href="#ç¯ç»•é€šçŸ¥" class="headerlink" title="ç¯ç»•é€šçŸ¥"></a>ç¯ç»•é€šçŸ¥</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Around(&quot;execution(* com.hang.aop.annotation.CalculatorImpl.*(..))&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">aroundMethod</span><span class="params">(ProceedingJoinPoint joinPoint)</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> joinPoint.getSignature().getName();</span><br><span class="line">    <span class="type">String</span> <span class="variable">args</span> <span class="operator">=</span> Arrays.toString(joinPoint.getArgs());</span><br><span class="line">    <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç¯ç»•é€šçŸ¥--&gt;ç›®æ ‡å¯¹è±¡æ–¹æ³•æ‰§è¡Œä¹‹å‰&quot;</span>);</span><br><span class="line">        <span class="comment">//ç›®æ ‡æ–¹æ³•çš„æ‰§è¡Œï¼Œç›®æ ‡æ–¹æ³•çš„è¿”å›å€¼ä¸€å®šè¦è¿”å›ç»™å¤–ç•Œè°ƒç”¨è€…</span></span><br><span class="line">        result = joinPoint.proceed();</span><br><span class="line">        System.out.println(<span class="string">&quot;ç¯ç»•é€šçŸ¥--&gt;ç›®æ ‡å¯¹è±¡æ–¹æ³•è¿”å›å€¼ä¹‹å&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">        throwable.printStackTrace();</span><br><span class="line">        System.out.println(<span class="string">&quot;ç¯ç»•é€šçŸ¥--&gt;ç›®æ ‡å¯¹è±¡æ–¹æ³•å‡ºç°å¼‚å¸¸æ—¶&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç¯ç»•é€šçŸ¥--&gt;ç›®æ ‡å¯¹è±¡æ–¹æ³•æ‰§è¡Œå®Œæ¯•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åˆ‡é¢çš„ä¼˜å…ˆçº§"><a href="#åˆ‡é¢çš„ä¼˜å…ˆçº§" class="headerlink" title="åˆ‡é¢çš„ä¼˜å…ˆçº§"></a>åˆ‡é¢çš„ä¼˜å…ˆçº§</h4><p>ç›¸åŒç›®æ ‡æ–¹æ³•ä¸ŠåŒæ—¶å­˜åœ¨å¤šä¸ªåˆ‡é¢æ—¶ï¼Œåˆ‡é¢çš„ä¼˜å…ˆçº§æ§åˆ¶åˆ‡é¢çš„<strong>å†…å¤–åµŒå¥—</strong>é¡ºåºã€‚</p><ul><li>ä¼˜å…ˆçº§é«˜çš„åˆ‡é¢ï¼šå¤–é¢</li><li>ä¼˜å…ˆçº§ä½çš„åˆ‡é¢ï¼šé‡Œé¢</li></ul><p>ä½¿ç”¨@Orderæ³¨è§£å¯ä»¥æ§åˆ¶åˆ‡é¢çš„ä¼˜å…ˆçº§ï¼š</p><ul><li>@Order(è¾ƒå°çš„æ•°)ï¼šä¼˜å…ˆçº§é«˜</li><li>@Order(è¾ƒå¤§çš„æ•°)ï¼šä¼˜å…ˆçº§ä½</li></ul><img src="/2023/09/24/Spring/img026.png" class title="images"><h3 id="åŸºäºXMLçš„AOP"><a href="#åŸºäºXMLçš„AOP" class="headerlink" title="åŸºäºXMLçš„AOP"></a>åŸºäºXMLçš„AOP</h3><h4 id="å‡†å¤‡å·¥ä½œ-1"><a href="#å‡†å¤‡å·¥ä½œ-1" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h4><p>å‚è€ƒåŸºäºæ³¨è§£çš„AOPç¯å¢ƒ</p><h4 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.hang.aop.xml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®åˆ‡é¢ç±»--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;loggerAspect&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;pointCut&quot;</span> </span></span><br><span class="line"><span class="tag">                   <span class="attr">expression</span>=<span class="string">&quot;execution(* com.hang.aop.xml.CalculatorImpl.*(..))&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;beforeMethod&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pointCut&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:before</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">&quot;afterMethod&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pointCut&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">&quot;afterReturningMethod&quot;</span> <span class="attr">returning</span>=<span class="string">&quot;result&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pointCut&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after-returning</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">&quot;afterThrowingMethod&quot;</span> <span class="attr">throwing</span>=<span class="string">&quot;ex&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pointCut&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after-throwing</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">&quot;aroundMethod&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pointCut&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:around</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="å•å…ƒæµ‹è¯•ï¼šJUnit"><a href="#å•å…ƒæµ‹è¯•ï¼šJUnit" class="headerlink" title="å•å…ƒæµ‹è¯•ï¼šJUnit"></a>å•å…ƒæµ‹è¯•ï¼šJUnit</h2><p>åœ¨ä¹‹å‰çš„æµ‹è¯•æ–¹æ³•ä¸­ï¼Œå‡ ä¹éƒ½èƒ½çœ‹åˆ°ä»¥ä¸‹çš„ä¸¤è¡Œä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;xxx.xml&quot;</span>);</span><br><span class="line"><span class="type">Xxxx</span> <span class="variable">xxx</span> <span class="operator">=</span> context.getBean(Xxxx.class);</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤è¡Œä»£ç çš„ä½œç”¨æ˜¯åˆ›å»ºSpringå®¹å™¨ï¼Œæœ€ç»ˆè·å–åˆ°å¯¹è±¡ï¼Œä½†æ˜¯æ¯æ¬¡æµ‹è¯•éƒ½éœ€è¦é‡å¤ç¼–å†™ã€‚é’ˆå¯¹ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯ç¨‹åºèƒ½è‡ªåŠ¨å¸®æˆ‘ä»¬åˆ›å»ºå®¹å™¨ã€‚æˆ‘ä»¬éƒ½çŸ¥é“JUnitæ— æ³•çŸ¥æ™“æˆ‘ä»¬æ˜¯å¦ä½¿ç”¨äº† Spring æ¡†æ¶ï¼Œæ›´ä¸ç”¨è¯´å¸®æˆ‘ä»¬åˆ›å»º Spring å®¹å™¨äº†ã€‚Springæä¾›äº†ä¸€ä¸ªè¿è¡Œå™¨ï¼Œå¯ä»¥è¯»å–é…ç½®æ–‡ä»¶ï¼ˆæˆ–æ³¨è§£ï¼‰æ¥åˆ›å»ºå®¹å™¨ã€‚æˆ‘ä»¬åªéœ€è¦å‘Šè¯‰å®ƒé…ç½®æ–‡ä»¶ä½ç½®å°±å¯ä»¥äº†ã€‚è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬é€šè¿‡Springæ•´åˆJUnitå¯ä»¥ä½¿ç¨‹åºåˆ›å»ºspringå®¹å™¨äº†</p><h3 id="æ•´åˆJUnit5"><a href="#æ•´åˆJUnit5" class="headerlink" title="æ•´åˆJUnit5"></a>æ•´åˆJUnit5</h3><h4 id="æ­å»ºå­æ¨¡å—"><a href="#æ­å»ºå­æ¨¡å—" class="headerlink" title="æ­å»ºå­æ¨¡å—"></a>æ­å»ºå­æ¨¡å—</h4><p>æ­å»ºspring-junitæ¨¡å—</p><h4 id="å¼•å…¥ä¾èµ–"><a href="#å¼•å…¥ä¾èµ–" class="headerlink" title="å¼•å…¥ä¾èµ–"></a>å¼•å…¥ä¾èµ–</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--spring contextä¾èµ–--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å½“ä½ å¼•å…¥Spring Contextä¾èµ–ä¹‹åï¼Œè¡¨ç¤ºå°†Springçš„åŸºç¡€ä¾èµ–å¼•å…¥äº†--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--springå¯¹junitçš„æ”¯æŒç›¸å…³ä¾èµ–--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--junit5æµ‹è¯•--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.jupiter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-jupiter-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--log4j2çš„ä¾èµ–--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.19.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-slf4j2-impl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.19.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="æ·»åŠ é…ç½®æ–‡ä»¶"><a href="#æ·»åŠ é…ç½®æ–‡ä»¶" class="headerlink" title="æ·»åŠ é…ç½®æ–‡ä»¶"></a>æ·»åŠ é…ç½®æ–‡ä»¶</h4><p>beans.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.hang.spring6.bean&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>copyæ—¥å¿—æ–‡ä»¶ï¼šlog4j2.xml</p><h4 id="æ·»åŠ javaç±»"><a href="#æ·»åŠ javaç±»" class="headerlink" title="æ·»åŠ javaç±»"></a>æ·»åŠ javaç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;run user&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.hang.spring6.bean.User;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.extension.ExtendWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit.jupiter.SpringExtension;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit.jupiter.SpringJUnitConfig;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸¤ç§æ–¹å¼å‡å¯</span></span><br><span class="line"><span class="comment">//æ–¹å¼ä¸€</span></span><br><span class="line"><span class="comment">//@ExtendWith(SpringExtension.class)</span></span><br><span class="line"><span class="comment">//@ContextConfiguration(&quot;classpath:beans.xml&quot;)</span></span><br><span class="line"><span class="comment">//æ–¹å¼äºŒ</span></span><br><span class="line"><span class="meta">@SpringJUnitConfig(locations = &quot;classpath:beans.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringJUnit5Test</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUser</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ•´åˆJUnit4"><a href="#æ•´åˆJUnit4" class="headerlink" title="æ•´åˆJUnit4"></a>æ•´åˆJUnit4</h3><p>JUnit4åœ¨å…¬å¸ä¹Ÿä¼šç»å¸¸ç”¨åˆ°ï¼Œåœ¨æ­¤ä¹Ÿå­¦ä¹ ä¸€ä¸‹</p><h4 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- junitæµ‹è¯• --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•-2"><a href="#æµ‹è¯•-2" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.hang.spring6.bean.User;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(&quot;classpath:beans.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringJUnit4Test</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUser</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h2><h3 id="JdbcTemplate"><a href="#JdbcTemplate" class="headerlink" title="JdbcTemplate"></a>JdbcTemplate</h3><h4 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>Spring æ¡†æ¶å¯¹ JDBC è¿›è¡Œå°è£…ï¼Œä½¿ç”¨ JdbcTemplate æ–¹ä¾¿å®ç°å¯¹æ•°æ®åº“æ“ä½œ</p><h4 id="å‡†å¤‡å·¥ä½œ-2"><a href="#å‡†å¤‡å·¥ä½œ-2" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h4><p><strong>â‘ æ­å»ºå­æ¨¡å—</strong></p><p>æ­å»ºå­æ¨¡å—ï¼šspring-jdbc-tx</p><p><strong>â‘¡åŠ å…¥ä¾èµ–</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--spring jdbc  Spring æŒä¹…åŒ–å±‚æ”¯æŒjaråŒ…--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- MySQLé©±åŠ¨ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.30<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- æ•°æ®æº --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.15<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>â‘¢åˆ›å»ºjdbc.properties</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jdbc.user</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">jdbc.password</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/spring?characterEncoding=utf8&amp;useSSL=false</span></span><br><span class="line"><span class="attr">jdbc.driver</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br></pre></td></tr></table></figure><p><strong>â‘£é…ç½®Springçš„é…ç½®æ–‡ä»¶</strong></p><p>beans.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- å¯¼å…¥å¤–éƒ¨å±æ€§æ–‡ä»¶ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:jdbc.properties&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- é…ç½®æ•°æ®æº --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;druidDataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.user&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- é…ç½® JdbcTemplate --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jdbcTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- è£…é…æ•°æ®æº --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;druidDataSource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>â‘¤å‡†å¤‡æ•°æ®åº“ä¸æµ‹è¯•è¡¨</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE `spring`;</span><br><span class="line"></span><br><span class="line">use `spring`;</span><br><span class="line"></span><br><span class="line">CREATE TABLE `spring` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `name` varchar(<span class="number">20</span>) DEFAULT NULL COMMENT <span class="string">&#x27;å§“å&#x27;</span>,</span><br><span class="line">  `age` <span class="type">int</span>(<span class="number">11</span>) DEFAULT NULL COMMENT <span class="string">&#x27;å¹´é¾„&#x27;</span>,</span><br><span class="line">  `sex` varchar(<span class="number">2</span>) DEFAULT NULL COMMENT <span class="string">&#x27;æ€§åˆ«&#x27;</span>,</span><br><span class="line">  PRIMARY <span class="title function_">KEY</span> <span class="params">(`id`)</span></span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;</span><br></pre></td></tr></table></figure><h4 id="å®ç°CURD"><a href="#å®ç°CURD" class="headerlink" title="å®ç°CURD"></a>å®ç°CURD</h4><h5 id="â‘ è£…é…-JdbcTemplate"><a href="#â‘ è£…é…-JdbcTemplate" class="headerlink" title="â‘ è£…é… JdbcTemplate"></a>â‘ è£…é… JdbcTemplate</h5><p><strong>åˆ›å»ºæµ‹è¯•ç±»ï¼Œæ•´åˆJUnitï¼Œæ³¨å…¥JdbcTemplate</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit.jupiter.SpringJUnitConfig;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringJUnitConfig(locations = &quot;classpath:beans.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCTemplateTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="â‘¡æµ‹è¯•å¢åˆ æ”¹åŠŸèƒ½"><a href="#â‘¡æµ‹è¯•å¢åˆ æ”¹åŠŸèƒ½" class="headerlink" title="â‘¡æµ‹è¯•å¢åˆ æ”¹åŠŸèƒ½"></a>â‘¡æµ‹è¯•å¢åˆ æ”¹åŠŸèƒ½</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">//æµ‹è¯•å¢åˆ æ”¹åŠŸèƒ½</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdate</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//æ·»åŠ åŠŸèƒ½</span></span><br><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into t_emp values(null,?,?,?)&quot;</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> jdbcTemplate.update(sql, <span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="number">23</span>, <span class="string">&quot;ç”·&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//ä¿®æ”¹åŠŸèƒ½</span></span><br><span class="line"><span class="comment">//String sql = &quot;update t_emp set name=? where id=?&quot;;</span></span><br><span class="line">    <span class="comment">//int result = jdbcTemplate.update(sql, &quot;å¼ ä¸‰hang&quot;, 1);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ é™¤åŠŸèƒ½</span></span><br><span class="line"><span class="comment">//String sql = &quot;delete from t_emp where id=?&quot;;</span></span><br><span class="line"><span class="comment">//int result = jdbcTemplate.update(sql, 1);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="â‘¢æŸ¥è¯¢æ•°æ®è¿”å›å¯¹è±¡"><a href="#â‘¢æŸ¥è¯¢æ•°æ®è¿”å›å¯¹è±¡" class="headerlink" title="â‘¢æŸ¥è¯¢æ•°æ®è¿”å›å¯¹è±¡"></a>â‘¢æŸ¥è¯¢æ•°æ®è¿”å›å¯¹è±¡</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Emp</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç”Ÿæˆgetå’Œsetæ–¹æ³•</span></span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Emp&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;/&#x27;</span><span class="string">&#x27; +</span></span><br><span class="line"><span class="string">                &quot;, age=&quot; + age +</span></span><br><span class="line"><span class="string">                &quot;, sex=&#x27;</span><span class="string">&quot; + sex + &#x27;/&#x27;&#x27; +</span></span><br><span class="line"><span class="string">                &#x27;&#125;&#x27;;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æŸ¥è¯¢ï¼šè¿”å›å¯¹è±¡</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectObject</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//å†™æ³•ä¸€</span></span><br><span class="line"><span class="comment">//        String sql = &quot;select * from t_emp where id=?&quot;;</span></span><br><span class="line"><span class="comment">//        Emp empResult = jdbcTemplate.queryForObject(sql,</span></span><br><span class="line"><span class="comment">//                (rs, rowNum) -&gt; &#123;</span></span><br><span class="line"><span class="comment">//                    Emp emp = new Emp();</span></span><br><span class="line"><span class="comment">//                    emp.setId(rs.getInt(&quot;id&quot;));</span></span><br><span class="line"><span class="comment">//                    emp.setName(rs.getString(&quot;name&quot;));</span></span><br><span class="line"><span class="comment">//                    emp.setAge(rs.getInt(&quot;age&quot;));</span></span><br><span class="line"><span class="comment">//                    emp.setSex(rs.getString(&quot;sex&quot;));</span></span><br><span class="line"><span class="comment">//                    return emp;</span></span><br><span class="line"><span class="comment">//                &#125;, 1);</span></span><br><span class="line"><span class="comment">//        System.out.println(empResult);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//å†™æ³•äºŒ</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from t_emp where id=?&quot;</span>;</span><br><span class="line">    <span class="type">Emp</span> <span class="variable">emp</span> <span class="operator">=</span> jdbcTemplate.queryForObject(sql,</span><br><span class="line">                  <span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;&gt;(Emp.class),<span class="number">1</span>);</span><br><span class="line">    System.out.println(emp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="â‘£æŸ¥è¯¢æ•°æ®è¿”å›listé›†åˆ"><a href="#â‘£æŸ¥è¯¢æ•°æ®è¿”å›listé›†åˆ" class="headerlink" title="â‘£æŸ¥è¯¢æ•°æ®è¿”å›listé›†åˆ"></a>â‘£æŸ¥è¯¢æ•°æ®è¿”å›listé›†åˆ</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">//æŸ¥è¯¢å¤šæ¡æ•°æ®ä¸ºä¸€ä¸ªlisté›†åˆ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectList</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from t_emp&quot;</span>;</span><br><span class="line">    List&lt;Emp&gt; list = jdbcTemplate.query(sql, <span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;&gt;(Emp.class));</span><br><span class="line">    System.out.println(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="â‘¤æŸ¥è¯¢è¿”å›å•ä¸ªçš„å€¼"><a href="#â‘¤æŸ¥è¯¢è¿”å›å•ä¸ªçš„å€¼" class="headerlink" title="â‘¤æŸ¥è¯¢è¿”å›å•ä¸ªçš„å€¼"></a>â‘¤æŸ¥è¯¢è¿”å›å•ä¸ªçš„å€¼</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">//æŸ¥è¯¢å•è¡Œå•åˆ—çš„å€¼</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">selectCount</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select count(id) from t_emp&quot;</span>;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> jdbcTemplate.queryForObject(sql, Integer.class);</span><br><span class="line">    System.out.println(count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å£°æ˜å¼äº‹åŠ¡æ¦‚å¿µ"><a href="#å£°æ˜å¼äº‹åŠ¡æ¦‚å¿µ" class="headerlink" title="å£°æ˜å¼äº‹åŠ¡æ¦‚å¿µ"></a>å£°æ˜å¼äº‹åŠ¡æ¦‚å¿µ</h3><h4 id="å£°æ˜å¼äº‹åŠ¡åŸºæœ¬æ¦‚å¿µ"><a href="#å£°æ˜å¼äº‹åŠ¡åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="å£°æ˜å¼äº‹åŠ¡åŸºæœ¬æ¦‚å¿µ"></a>å£°æ˜å¼äº‹åŠ¡åŸºæœ¬æ¦‚å¿µ</h4><h5 id="â‘ ä»€ä¹ˆæ˜¯äº‹åŠ¡"><a href="#â‘ ä»€ä¹ˆæ˜¯äº‹åŠ¡" class="headerlink" title="â‘ ä»€ä¹ˆæ˜¯äº‹åŠ¡"></a>â‘ ä»€ä¹ˆæ˜¯äº‹åŠ¡</h5><p>æ•°æ®åº“äº‹åŠ¡( transaction)æ˜¯è®¿é—®å¹¶å¯èƒ½æ“ä½œå„ç§æ•°æ®é¡¹çš„ä¸€ä¸ªæ•°æ®åº“æ“ä½œåºåˆ—ï¼Œè¿™äº›æ“ä½œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œ,è¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œï¼Œæ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ã€‚äº‹åŠ¡ç”±äº‹åŠ¡å¼€å§‹ä¸äº‹åŠ¡ç»“æŸä¹‹é—´æ‰§è¡Œçš„å…¨éƒ¨æ•°æ®åº“æ“ä½œç»„æˆã€‚</p><h5 id="â‘¡äº‹åŠ¡çš„ç‰¹æ€§"><a href="#â‘¡äº‹åŠ¡çš„ç‰¹æ€§" class="headerlink" title="â‘¡äº‹åŠ¡çš„ç‰¹æ€§"></a>â‘¡äº‹åŠ¡çš„ç‰¹æ€§</h5><p><strong>Aï¼šåŸå­æ€§(Atomicity)</strong></p><p>ä¸€ä¸ªäº‹åŠ¡(transaction)ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå…¨éƒ¨ä¸å®Œæˆï¼Œä¸ä¼šç»“æŸåœ¨ä¸­é—´æŸä¸ªç¯èŠ‚ã€‚äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œä¼šè¢«å›æ»šï¼ˆRollbackï¼‰åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œå°±åƒè¿™ä¸ªäº‹åŠ¡ä»æ¥æ²¡æœ‰æ‰§è¡Œè¿‡ä¸€æ ·ã€‚</p><p><strong>Cï¼šä¸€è‡´æ€§(Consistency)</strong></p><p>äº‹åŠ¡çš„ä¸€è‡´æ€§æŒ‡çš„æ˜¯åœ¨ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œä¹‹å‰å’Œæ‰§è¡Œä¹‹åæ•°æ®åº“éƒ½å¿…é¡»å¤„äºä¸€è‡´æ€§çŠ¶æ€ã€‚</p><p>å¦‚æœäº‹åŠ¡æˆåŠŸåœ°å®Œæˆï¼Œé‚£ä¹ˆç³»ç»Ÿä¸­æ‰€æœ‰å˜åŒ–å°†æ­£ç¡®åœ°åº”ç”¨ï¼Œç³»ç»Ÿå¤„äºæœ‰æ•ˆçŠ¶æ€ã€‚</p><p>å¦‚æœåœ¨äº‹åŠ¡ä¸­å‡ºç°é”™è¯¯ï¼Œé‚£ä¹ˆç³»ç»Ÿä¸­çš„æ‰€æœ‰å˜åŒ–å°†è‡ªåŠ¨åœ°å›æ»šï¼Œç³»ç»Ÿè¿”å›åˆ°åŸå§‹çŠ¶æ€ã€‚</p><p><strong>Iï¼šéš”ç¦»æ€§(Isolation)</strong></p><p>æŒ‡çš„æ˜¯åœ¨å¹¶å‘ç¯å¢ƒä¸­ï¼Œå½“ä¸åŒçš„äº‹åŠ¡åŒæ—¶æ“çºµç›¸åŒçš„æ•°æ®æ—¶ï¼Œæ¯ä¸ªäº‹åŠ¡éƒ½æœ‰å„è‡ªçš„å®Œæ•´æ•°æ®ç©ºé—´ã€‚ç”±å¹¶å‘äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹å¿…é¡»ä¸ä»»ä½•å…¶ä»–å¹¶å‘äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹éš”ç¦»ã€‚äº‹åŠ¡æŸ¥çœ‹æ•°æ®æ›´æ–°æ—¶ï¼Œæ•°æ®æ‰€å¤„çš„çŠ¶æ€è¦ä¹ˆæ˜¯å¦ä¸€äº‹åŠ¡ä¿®æ”¹å®ƒä¹‹å‰çš„çŠ¶æ€ï¼Œè¦ä¹ˆæ˜¯å¦ä¸€äº‹åŠ¡ä¿®æ”¹å®ƒä¹‹åçš„çŠ¶æ€ï¼Œäº‹åŠ¡ä¸ä¼šæŸ¥çœ‹åˆ°ä¸­é—´çŠ¶æ€çš„æ•°æ®ã€‚</p><p><strong>Dï¼šæŒä¹…æ€§(Durability)</strong></p><p>æŒ‡çš„æ˜¯åªè¦äº‹åŠ¡æˆåŠŸç»“æŸï¼Œå®ƒå¯¹æ•°æ®åº“æ‰€åšçš„æ›´æ–°å°±å¿…é¡»ä¿å­˜ä¸‹æ¥ã€‚å³ä½¿å‘ç”Ÿç³»ç»Ÿå´©æºƒï¼Œé‡æ–°å¯åŠ¨æ•°æ®åº“ç³»ç»Ÿåï¼Œæ•°æ®åº“è¿˜èƒ½æ¢å¤åˆ°äº‹åŠ¡æˆåŠŸç»“æŸæ—¶çš„çŠ¶æ€ã€‚</p><h4 id="ç¼–ç¨‹å¼äº‹åŠ¡"><a href="#ç¼–ç¨‹å¼äº‹åŠ¡" class="headerlink" title="ç¼–ç¨‹å¼äº‹åŠ¡"></a>ç¼–ç¨‹å¼äº‹åŠ¡</h4><p>äº‹åŠ¡åŠŸèƒ½çš„ç›¸å…³æ“ä½œå…¨éƒ¨é€šè¿‡è‡ªå·±ç¼–å†™ä»£ç æ¥å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> ...;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¼€å¯äº‹åŠ¡ï¼šå…³é—­äº‹åŠ¡çš„è‡ªåŠ¨æäº¤</span></span><br><span class="line">    conn.setAutoCommit(<span class="literal">false</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ ¸å¿ƒæ“ä½œ</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æäº¤äº‹åŠ¡</span></span><br><span class="line">    conn.commit();</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å›æ»šäº‹åŠ¡</span></span><br><span class="line">    conn.rollBack();</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é‡Šæ”¾æ•°æ®åº“è¿æ¥</span></span><br><span class="line">    conn.close();</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–ç¨‹å¼çš„å®ç°æ–¹å¼å­˜åœ¨ç¼ºé™·ï¼š</p><ul><li>ç»†èŠ‚æ²¡æœ‰è¢«å±è”½ï¼šå…·ä½“æ“ä½œè¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰ç»†èŠ‚éƒ½éœ€è¦ç¨‹åºå‘˜è‡ªå·±æ¥å®Œæˆï¼Œæ¯”è¾ƒç¹çã€‚</li><li>ä»£ç å¤ç”¨æ€§ä¸é«˜ï¼šå¦‚æœæ²¡æœ‰æœ‰æ•ˆæŠ½å–å‡ºæ¥ï¼Œæ¯æ¬¡å®ç°åŠŸèƒ½éƒ½éœ€è¦è‡ªå·±ç¼–å†™ä»£ç ï¼Œä»£ç å°±æ²¡æœ‰å¾—åˆ°å¤ç”¨ã€‚</li></ul><h4 id="7-2-3ã€å£°æ˜å¼äº‹åŠ¡"><a href="#7-2-3ã€å£°æ˜å¼äº‹åŠ¡" class="headerlink" title="7.2.3ã€å£°æ˜å¼äº‹åŠ¡"></a>7.2.3ã€å£°æ˜å¼äº‹åŠ¡</h4><p>æ—¢ç„¶äº‹åŠ¡æ§åˆ¶çš„ä»£ç æœ‰è§„å¾‹å¯å¾ªï¼Œä»£ç çš„ç»“æ„åŸºæœ¬æ˜¯ç¡®å®šçš„ï¼Œæ‰€ä»¥æ¡†æ¶å°±å¯ä»¥å°†å›ºå®šæ¨¡å¼çš„ä»£ç æŠ½å–å‡ºæ¥ï¼Œè¿›è¡Œç›¸å…³çš„å°è£…ã€‚</p><p>å°è£…èµ·æ¥åï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œç®€å•çš„é…ç½®å³å¯å®Œæˆæ“ä½œã€‚</p><ul><li>å¥½å¤„1ï¼šæé«˜å¼€å‘æ•ˆç‡</li><li>å¥½å¤„2ï¼šæ¶ˆé™¤äº†å†—ä½™çš„ä»£ç </li><li>å¥½å¤„3ï¼šæ¡†æ¶ä¼šç»¼åˆè€ƒè™‘ç›¸å…³é¢†åŸŸä¸­åœ¨å®é™…å¼€å‘ç¯å¢ƒä¸‹æœ‰å¯èƒ½é‡åˆ°çš„å„ç§é—®é¢˜ï¼Œè¿›è¡Œäº†å¥å£®æ€§ã€æ€§èƒ½ç­‰å„ä¸ªæ–¹é¢çš„ä¼˜åŒ–</li></ul><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“ä¸‹é¢ä¸¤ä¸ªæ¦‚å¿µï¼š</p><ul><li><strong>ç¼–ç¨‹å¼</strong>ï¼š<strong>è‡ªå·±å†™ä»£ç </strong>å®ç°åŠŸèƒ½</li><li><strong>å£°æ˜å¼</strong>ï¼šé€šè¿‡<strong>é…ç½®</strong>è®©<strong>æ¡†æ¶</strong>å®ç°åŠŸèƒ½</li></ul><h3 id="åŸºäºæ³¨è§£çš„å£°æ˜å¼äº‹åŠ¡"><a href="#åŸºäºæ³¨è§£çš„å£°æ˜å¼äº‹åŠ¡" class="headerlink" title="åŸºäºæ³¨è§£çš„å£°æ˜å¼äº‹åŠ¡"></a>åŸºäºæ³¨è§£çš„å£°æ˜å¼äº‹åŠ¡</h3><h4 id="å‡†å¤‡å·¥ä½œ-3"><a href="#å‡†å¤‡å·¥ä½œ-3" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h4><p><strong>â‘ æ·»åŠ é…ç½®</strong></p><p>åœ¨beans.xmlæ·»åŠ é…ç½®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--æ‰«æç»„ä»¶--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.hang.spring6&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>â‘¡åˆ›å»ºè¡¨</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `t_book` (</span><br><span class="line">  `book_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;ä¸»é”®&#x27;</span>,</span><br><span class="line">  `book_name` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å›¾ä¹¦åç§°&#x27;</span>,</span><br><span class="line">  `price` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ä»·æ ¼&#x27;</span>,</span><br><span class="line">  `stock` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;åº“å­˜ï¼ˆæ— ç¬¦å·ï¼‰&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`book_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">3</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"><span class="keyword">insert</span>  <span class="keyword">into</span> `t_book`(`book_id`,`book_name`,`price`,`stock`) <span class="keyword">values</span> (<span class="number">1</span>,<span class="string">&#x27;æ–—ç ´è‹ç©¹&#x27;</span>,<span class="number">80</span>,<span class="number">100</span>),(<span class="number">2</span>,<span class="string">&#x27;æ–—ç½—å¤§é™†&#x27;</span>,<span class="number">50</span>,<span class="number">100</span>);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `t_user` (</span><br><span class="line">  `user_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;ä¸»é”®&#x27;</span>,</span><br><span class="line">  `username` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ç”¨æˆ·å&#x27;</span>,</span><br><span class="line">  `balance` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ä½™é¢ï¼ˆæ— ç¬¦å·ï¼‰&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`user_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">2</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"><span class="keyword">insert</span>  <span class="keyword">into</span> `t_user`(`user_id`,`username`,`balance`) <span class="keyword">values</span> (<span class="number">1</span>,<span class="string">&#x27;admin&#x27;</span>,<span class="number">50</span>);</span><br></pre></td></tr></table></figure><p><strong>â‘¢åˆ›å»ºç»„ä»¶</strong></p><p>åˆ›å»ºBookControllerï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.controller;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookService bookService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buyBook</span><span class="params">(Integer bookId, Integer userId)</span>&#123;</span><br><span class="line">        bookService.buyBook(bookId, userId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºæ¥å£BookServiceï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.service;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">buyBook</span><span class="params">(Integer bookId, Integer userId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºå®ç°ç±»BookServiceImplï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.service.impl;</span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookDao bookDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buyBook</span><span class="params">(Integer bookId, Integer userId)</span> &#123;</span><br><span class="line">        <span class="comment">//æŸ¥è¯¢å›¾ä¹¦çš„ä»·æ ¼</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">price</span> <span class="operator">=</span> bookDao.getPriceByBookId(bookId);</span><br><span class="line">        <span class="comment">//æ›´æ–°å›¾ä¹¦çš„åº“å­˜</span></span><br><span class="line">        bookDao.updateStock(bookId);</span><br><span class="line">        <span class="comment">//æ›´æ–°ç”¨æˆ·çš„ä½™é¢</span></span><br><span class="line">        bookDao.updateBalance(userId, price);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºæ¥å£BookDaoï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.dao;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line">    Integer <span class="title function_">getPriceByBookId</span><span class="params">(Integer bookId)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">updateStock</span><span class="params">(Integer bookId)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">updateBalance</span><span class="params">(Integer userId, Integer price)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºå®ç°ç±»BookDaoImplï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.dao.impl;</span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getPriceByBookId</span><span class="params">(Integer bookId)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select price from t_book where book_id = ?&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate.queryForObject(sql, Integer.class, bookId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateStock</span><span class="params">(Integer bookId)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;update t_book set stock = stock - 1 where book_id = ?&quot;</span>;</span><br><span class="line">        jdbcTemplate.update(sql, bookId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateBalance</span><span class="params">(Integer userId, Integer price)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;update t_user set balance = balance - ? where user_id = ?&quot;</span>;</span><br><span class="line">        jdbcTemplate.update(sql, price, userId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•æ— äº‹åŠ¡æƒ…å†µ"><a href="#æµ‹è¯•æ— äº‹åŠ¡æƒ…å†µ" class="headerlink" title="æµ‹è¯•æ— äº‹åŠ¡æƒ…å†µ"></a>æµ‹è¯•æ— äº‹åŠ¡æƒ…å†µ</h4><p><strong>â‘ åˆ›å»ºæµ‹è¯•ç±»</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit.jupiter.SpringJUnitConfig;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringJUnitConfig(locations = &quot;classpath:beans.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TxByAnnotationTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookController bookController;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testBuyBook</span><span class="params">()</span>&#123;</span><br><span class="line">        bookController.buyBook(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>â‘¡æ¨¡æ‹Ÿåœºæ™¯</strong></p><p>ç”¨æˆ·è´­ä¹°å›¾ä¹¦ï¼Œå…ˆæŸ¥è¯¢å›¾ä¹¦çš„ä»·æ ¼ï¼Œå†æ›´æ–°å›¾ä¹¦çš„åº“å­˜å’Œç”¨æˆ·çš„ä½™é¢</p><p>å‡è®¾ç”¨æˆ·idä¸º1çš„ç”¨æˆ·ï¼Œè´­ä¹°idä¸º1çš„å›¾ä¹¦</p><p>ç”¨æˆ·ä½™é¢ä¸º50ï¼Œè€Œå›¾ä¹¦ä»·æ ¼ä¸º80</p><p>è´­ä¹°å›¾ä¹¦ä¹‹åï¼Œç”¨æˆ·çš„ä½™é¢ä¸º-30ï¼Œæ•°æ®åº“ä¸­ä½™é¢å­—æ®µè®¾ç½®äº†æ— ç¬¦å·ï¼Œå› æ­¤æ— æ³•å°†-30æ’å…¥åˆ°ä½™é¢å­—æ®µ</p><p>æ­¤æ—¶æ‰§è¡Œsqlè¯­å¥ä¼šæŠ›å‡ºSQLException</p><p><strong>â‘¢è§‚å¯Ÿç»“æœ</strong></p><p>å› ä¸ºæ²¡æœ‰æ·»åŠ äº‹åŠ¡ï¼Œå›¾ä¹¦çš„åº“å­˜æ›´æ–°äº†ï¼Œä½†æ˜¯ç”¨æˆ·çš„ä½™é¢æ²¡æœ‰æ›´æ–°</p><p>æ˜¾ç„¶è¿™æ ·çš„ç»“æœæ˜¯é”™è¯¯çš„ï¼Œè´­ä¹°å›¾ä¹¦æ˜¯ä¸€ä¸ªå®Œæ•´çš„åŠŸèƒ½ï¼Œæ›´æ–°åº“å­˜å’Œæ›´æ–°ä½™é¢è¦ä¹ˆéƒ½æˆåŠŸè¦ä¹ˆéƒ½å¤±è´¥</p><h4 id="åŠ å…¥äº‹åŠ¡"><a href="#åŠ å…¥äº‹åŠ¡" class="headerlink" title="åŠ å…¥äº‹åŠ¡"></a>åŠ å…¥äº‹åŠ¡</h4><h5 id="â‘ æ·»åŠ äº‹åŠ¡é…ç½®"><a href="#â‘ æ·»åŠ äº‹åŠ¡é…ç½®" class="headerlink" title="â‘ æ·»åŠ äº‹åŠ¡é…ç½®"></a>â‘ æ·»åŠ äº‹åŠ¡é…ç½®</h5><p>åœ¨springé…ç½®æ–‡ä»¶ä¸­å¼•å…¥txå‘½åç©ºé—´</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨Springçš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ é…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;druidDataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    å¼€å¯äº‹åŠ¡çš„æ³¨è§£é©±åŠ¨</span></span><br><span class="line"><span class="comment">    é€šè¿‡æ³¨è§£@Transactionalæ‰€æ ‡è¯†çš„æ–¹æ³•æˆ–æ ‡è¯†çš„ç±»ä¸­æ‰€æœ‰çš„æ–¹æ³•ï¼Œéƒ½ä¼šè¢«äº‹åŠ¡ç®¡ç†å™¨ç®¡ç†äº‹åŠ¡</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- transaction-managerå±æ€§çš„é»˜è®¤å€¼æ˜¯transactionManagerï¼Œå¦‚æœäº‹åŠ¡ç®¡ç†å™¨beançš„idæ­£å¥½å°±æ˜¯è¿™ä¸ªé»˜è®¤å€¼ï¼Œåˆ™å¯ä»¥çœç•¥è¿™ä¸ªå±æ€§ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><h5 id="â‘¡æ·»åŠ äº‹åŠ¡æ³¨è§£"><a href="#â‘¡æ·»åŠ äº‹åŠ¡æ³¨è§£" class="headerlink" title="â‘¡æ·»åŠ äº‹åŠ¡æ³¨è§£"></a>â‘¡æ·»åŠ äº‹åŠ¡æ³¨è§£</h5><p>å› ä¸ºserviceå±‚è¡¨ç¤ºä¸šåŠ¡é€»è¾‘å±‚ï¼Œä¸€ä¸ªæ–¹æ³•è¡¨ç¤ºä¸€ä¸ªå®Œæˆçš„åŠŸèƒ½ï¼Œå› æ­¤å¤„ç†äº‹åŠ¡ä¸€èˆ¬åœ¨serviceå±‚å¤„ç†</p><p><strong>åœ¨BookServiceImplçš„buybook()æ·»åŠ æ³¨è§£@Transactional</strong></p><h5 id="â‘¢è§‚å¯Ÿç»“æœ"><a href="#â‘¢è§‚å¯Ÿç»“æœ" class="headerlink" title="â‘¢è§‚å¯Ÿç»“æœ"></a>â‘¢è§‚å¯Ÿç»“æœ</h5><p>ç”±äºä½¿ç”¨äº†Springçš„å£°æ˜å¼äº‹åŠ¡ï¼Œæ›´æ–°åº“å­˜å’Œæ›´æ–°ä½™é¢éƒ½æ²¡æœ‰æ‰§è¡Œ</p><h4 id="Transactionalæ³¨è§£æ ‡è¯†çš„ä½ç½®"><a href="#Transactionalæ³¨è§£æ ‡è¯†çš„ä½ç½®" class="headerlink" title="@Transactionalæ³¨è§£æ ‡è¯†çš„ä½ç½®"></a>@Transactionalæ³¨è§£æ ‡è¯†çš„ä½ç½®</h4><p>@Transactionalæ ‡è¯†åœ¨æ–¹æ³•ä¸Šï¼Œåˆ™åªä¼šå½±å“è¯¥æ–¹æ³•</p><p>@Transactionalæ ‡è¯†çš„ç±»ä¸Šï¼Œåˆ™ä¼šå½±å“ç±»ä¸­æ‰€æœ‰çš„æ–¹æ³•</p><h4 id="äº‹åŠ¡å±æ€§ï¼šåªè¯»"><a href="#äº‹åŠ¡å±æ€§ï¼šåªè¯»" class="headerlink" title="äº‹åŠ¡å±æ€§ï¼šåªè¯»"></a>äº‹åŠ¡å±æ€§ï¼šåªè¯»</h4><p><strong>â‘ ä»‹ç»</strong></p><p>å¯¹ä¸€ä¸ªæŸ¥è¯¢æ“ä½œæ¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬æŠŠå®ƒè®¾ç½®æˆåªè¯»ï¼Œå°±èƒ½å¤Ÿæ˜ç¡®å‘Šè¯‰æ•°æ®åº“ï¼Œè¿™ä¸ªæ“ä½œä¸æ¶‰åŠå†™æ“ä½œã€‚è¿™æ ·æ•°æ®åº“å°±èƒ½å¤Ÿé’ˆå¯¹æŸ¥è¯¢æ“ä½œæ¥è¿›è¡Œä¼˜åŒ–ã€‚</p><p><strong>â‘¡ä½¿ç”¨æ–¹å¼</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(readOnly = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buyBook</span><span class="params">(Integer bookId, Integer userId)</span> &#123;</span><br><span class="line">    <span class="comment">//æŸ¥è¯¢å›¾ä¹¦çš„ä»·æ ¼</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">price</span> <span class="operator">=</span> bookDao.getPriceByBookId(bookId);</span><br><span class="line">    <span class="comment">//æ›´æ–°å›¾ä¹¦çš„åº“å­˜</span></span><br><span class="line">    bookDao.updateStock(bookId);</span><br><span class="line">    <span class="comment">//æ›´æ–°ç”¨æˆ·çš„ä½™é¢</span></span><br><span class="line">    bookDao.updateBalance(userId, price);</span><br><span class="line">    <span class="comment">//System.out.println(1/0);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>â‘¢æ³¨æ„</strong></p><p>å¯¹å¢åˆ æ”¹æ“ä½œè®¾ç½®åªè¯»ä¼šæŠ›å‡ºä¸‹é¢å¼‚å¸¸ï¼š</p><p>Caused by: java.sql.SQLException: Connection is read-only. Queries leading to data modification are not allowed</p><h4 id="äº‹åŠ¡å±æ€§ï¼šè¶…æ—¶"><a href="#äº‹åŠ¡å±æ€§ï¼šè¶…æ—¶" class="headerlink" title="äº‹åŠ¡å±æ€§ï¼šè¶…æ—¶"></a>äº‹åŠ¡å±æ€§ï¼šè¶…æ—¶</h4><p><strong>â‘ ä»‹ç»</strong></p><p>äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ‰å¯èƒ½å› ä¸ºé‡åˆ°æŸäº›é—®é¢˜ï¼Œå¯¼è‡´ç¨‹åºå¡ä½ï¼Œä»è€Œé•¿æ—¶é—´å ç”¨æ•°æ®åº“èµ„æºã€‚è€Œé•¿æ—¶é—´å ç”¨èµ„æºï¼Œå¤§æ¦‚ç‡æ˜¯å› ä¸ºç¨‹åºè¿è¡Œå‡ºç°äº†é—®é¢˜ï¼ˆå¯èƒ½æ˜¯Javaç¨‹åºæˆ–MySQLæ•°æ®åº“æˆ–ç½‘ç»œè¿æ¥ç­‰ç­‰ï¼‰ã€‚æ­¤æ—¶è¿™ä¸ªå¾ˆå¯èƒ½å‡ºé—®é¢˜çš„ç¨‹åºåº”è¯¥è¢«å›æ»šï¼Œæ’¤é”€å®ƒå·²åšçš„æ“ä½œï¼Œäº‹åŠ¡ç»“æŸï¼ŒæŠŠèµ„æºè®©å‡ºæ¥ï¼Œè®©å…¶ä»–æ­£å¸¸ç¨‹åºå¯ä»¥æ‰§è¡Œã€‚</p><p>æ¦‚æ‹¬æ¥è¯´å°±æ˜¯ä¸€å¥è¯ï¼šè¶…æ—¶å›æ»šï¼Œé‡Šæ”¾èµ„æºã€‚</p><p><strong>â‘¡ä½¿ç”¨æ–¹å¼</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¶…æ—¶æ—¶é—´å•ä½ç§’</span></span><br><span class="line"><span class="meta">@Transactional(timeout = 3)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buyBook</span><span class="params">(Integer bookId, Integer userId)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">5</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æŸ¥è¯¢å›¾ä¹¦çš„ä»·æ ¼</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">price</span> <span class="operator">=</span> bookDao.getPriceByBookId(bookId);</span><br><span class="line">    <span class="comment">//æ›´æ–°å›¾ä¹¦çš„åº“å­˜</span></span><br><span class="line">    bookDao.updateStock(bookId);</span><br><span class="line">    <span class="comment">//æ›´æ–°ç”¨æˆ·çš„ä½™é¢</span></span><br><span class="line">    bookDao.updateBalance(userId, price);</span><br><span class="line">    <span class="comment">//System.out.println(1/0);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>â‘¢è§‚å¯Ÿç»“æœ</strong></p><p>æ‰§è¡Œè¿‡ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸ï¼š</p><p>org.springframework.transaction.<strong>TransactionTimedOutException</strong>: Transaction timed out: deadline was Fri Jun 04 16:25:39 CST 2022</p><h4 id="äº‹åŠ¡å±æ€§ï¼šå›æ»šç­–ç•¥"><a href="#äº‹åŠ¡å±æ€§ï¼šå›æ»šç­–ç•¥" class="headerlink" title="äº‹åŠ¡å±æ€§ï¼šå›æ»šç­–ç•¥"></a>äº‹åŠ¡å±æ€§ï¼šå›æ»šç­–ç•¥</h4><p><strong>â‘ ä»‹ç»</strong></p><p>å£°æ˜å¼äº‹åŠ¡é»˜è®¤åªé’ˆå¯¹è¿è¡Œæ—¶å¼‚å¸¸å›æ»šï¼Œç¼–è¯‘æ—¶å¼‚å¸¸ä¸å›æ»šã€‚</p><p>å¯ä»¥é€šè¿‡@Transactionalä¸­ç›¸å…³å±æ€§è®¾ç½®å›æ»šç­–ç•¥</p><ul><li><p>rollbackForå±æ€§ï¼šéœ€è¦è®¾ç½®ä¸€ä¸ªClassç±»å‹çš„å¯¹è±¡</p></li><li><p>rollbackForClassNameå±æ€§ï¼šéœ€è¦è®¾ç½®ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å…¨ç±»å</p></li><li><p>noRollbackForå±æ€§ï¼šéœ€è¦è®¾ç½®ä¸€ä¸ªClassç±»å‹çš„å¯¹è±¡</p></li><li><p>rollbackForå±æ€§ï¼šéœ€è¦è®¾ç½®ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å…¨ç±»å</p></li></ul><p><strong>â‘¡ä½¿ç”¨æ–¹å¼</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(noRollbackFor = ArithmeticException.class)</span></span><br><span class="line"><span class="comment">//@Transactional(noRollbackForClassName = &quot;java.lang.ArithmeticException&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buyBook</span><span class="params">(Integer bookId, Integer userId)</span> &#123;</span><br><span class="line">    <span class="comment">//æŸ¥è¯¢å›¾ä¹¦çš„ä»·æ ¼</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">price</span> <span class="operator">=</span> bookDao.getPriceByBookId(bookId);</span><br><span class="line">    <span class="comment">//æ›´æ–°å›¾ä¹¦çš„åº“å­˜</span></span><br><span class="line">    bookDao.updateStock(bookId);</span><br><span class="line">    <span class="comment">//æ›´æ–°ç”¨æˆ·çš„ä½™é¢</span></span><br><span class="line">    bookDao.updateBalance(userId, price);</span><br><span class="line">    System.out.println(<span class="number">1</span>/<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>â‘¢è§‚å¯Ÿç»“æœ</strong></p><p>è™½ç„¶è´­ä¹°å›¾ä¹¦åŠŸèƒ½ä¸­å‡ºç°äº†æ•°å­¦è¿ç®—å¼‚å¸¸ï¼ˆArithmeticExceptionï¼‰ï¼Œä½†æ˜¯æˆ‘ä»¬è®¾ç½®çš„å›æ»šç­–ç•¥æ˜¯ï¼Œå½“å‡ºç°ArithmeticExceptionä¸å‘ç”Ÿå›æ»šï¼Œå› æ­¤è´­ä¹°å›¾ä¹¦çš„æ“ä½œæ­£å¸¸æ‰§è¡Œ</p><h4 id="äº‹åŠ¡å±æ€§ï¼šéš”ç¦»çº§åˆ«"><a href="#äº‹åŠ¡å±æ€§ï¼šéš”ç¦»çº§åˆ«" class="headerlink" title="äº‹åŠ¡å±æ€§ï¼šéš”ç¦»çº§åˆ«"></a>äº‹åŠ¡å±æ€§ï¼šéš”ç¦»çº§åˆ«</h4><p><strong>â‘ ä»‹ç»</strong></p><p>æ•°æ®åº“ç³»ç»Ÿå¿…é¡»å…·æœ‰éš”ç¦»å¹¶å‘è¿è¡Œå„ä¸ªäº‹åŠ¡çš„èƒ½åŠ›ï¼Œä½¿å®ƒä»¬ä¸ä¼šç›¸äº’å½±å“ï¼Œé¿å…å„ç§å¹¶å‘é—®é¢˜ã€‚ä¸€ä¸ªäº‹åŠ¡ä¸å…¶ä»–äº‹åŠ¡éš”ç¦»çš„ç¨‹åº¦ç§°ä¸ºéš”ç¦»çº§åˆ«ã€‚SQLæ ‡å‡†ä¸­è§„å®šäº†å¤šç§äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œä¸åŒéš”ç¦»çº§åˆ«å¯¹åº”ä¸åŒçš„å¹²æ‰°ç¨‹åº¦ï¼Œéš”ç¦»çº§åˆ«è¶Šé«˜ï¼Œæ•°æ®ä¸€è‡´æ€§å°±è¶Šå¥½ï¼Œä½†å¹¶å‘æ€§è¶Šå¼±ã€‚</p><p>éš”ç¦»çº§åˆ«ä¸€å…±æœ‰å››ç§ï¼š</p><ul><li><p>è¯»æœªæäº¤ï¼šREAD UNCOMMITTED</p><p>å…è®¸Transaction01è¯»å–Transaction02æœªæäº¤çš„ä¿®æ”¹ã€‚</p></li><li><p>è¯»å·²æäº¤ï¼šREAD COMMITTEDã€</p><p>è¦æ±‚Transaction01åªèƒ½è¯»å–Transaction02å·²æäº¤çš„ä¿®æ”¹ã€‚</p></li><li><p>å¯é‡å¤è¯»ï¼šREPEATABLE READ</p><p>ç¡®ä¿Transaction01å¯ä»¥å¤šæ¬¡ä»ä¸€ä¸ªå­—æ®µä¸­è¯»å–åˆ°ç›¸åŒçš„å€¼ï¼Œå³Transaction01æ‰§è¡ŒæœŸé—´ç¦æ­¢å…¶å®ƒäº‹åŠ¡å¯¹è¿™ä¸ªå­—æ®µè¿›è¡Œæ›´æ–°ã€‚</p></li><li><p>ä¸²è¡ŒåŒ–ï¼šSERIALIZABLE</p><p>ç¡®ä¿Transaction01å¯ä»¥å¤šæ¬¡ä»ä¸€ä¸ªè¡¨ä¸­è¯»å–åˆ°ç›¸åŒçš„è¡Œï¼Œåœ¨Transaction01æ‰§è¡ŒæœŸé—´ï¼Œç¦æ­¢å…¶å®ƒäº‹åŠ¡å¯¹è¿™ä¸ªè¡¨è¿›è¡Œæ·»åŠ ã€æ›´æ–°ã€åˆ é™¤æ“ä½œã€‚å¯ä»¥é¿å…ä»»ä½•å¹¶å‘é—®é¢˜ï¼Œä½†æ€§èƒ½ååˆ†ä½ä¸‹ã€‚</p></li></ul><p>å„ä¸ªéš”ç¦»çº§åˆ«è§£å†³å¹¶å‘é—®é¢˜çš„èƒ½åŠ›è§ä¸‹è¡¨ï¼š</p><table><thead><tr><th>éš”ç¦»çº§åˆ«</th><th>è„è¯»</th><th>ä¸å¯é‡å¤è¯»</th><th>å¹»è¯»</th></tr></thead><tbody><tr><td>READ UNCOMMITTED</td><td>æœ‰</td><td>æœ‰</td><td>æœ‰</td></tr><tr><td>READ COMMITTED</td><td>æ— </td><td>æœ‰</td><td>æœ‰</td></tr><tr><td>REPEATABLE READ</td><td>æ— </td><td>æ— </td><td>æœ‰</td></tr><tr><td>SERIALIZABLE</td><td>æ— </td><td>æ— </td><td>æ— </td></tr></tbody></table><p>å„ç§æ•°æ®åº“äº§å“å¯¹äº‹åŠ¡éš”ç¦»çº§åˆ«çš„æ”¯æŒç¨‹åº¦ï¼š</p><table><thead><tr><th>éš”ç¦»çº§åˆ«</th><th>Oracle</th><th>MySQL</th></tr></thead><tbody><tr><td>READ UNCOMMITTED</td><td>Ã—</td><td>âˆš</td></tr><tr><td>READ COMMITTED</td><td>âˆš(é»˜è®¤)</td><td>âˆš</td></tr><tr><td>REPEATABLE READ</td><td>Ã—</td><td>âˆš(é»˜è®¤)</td></tr><tr><td>SERIALIZABLE</td><td>âˆš</td><td>âˆš</td></tr></tbody></table><p><strong>â‘¡ä½¿ç”¨æ–¹å¼</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(isolation = Isolation.DEFAULT)</span><span class="comment">//ä½¿ç”¨æ•°æ®åº“é»˜è®¤çš„éš”ç¦»çº§åˆ«</span></span><br><span class="line"><span class="meta">@Transactional(isolation = Isolation.READ_UNCOMMITTED)</span><span class="comment">//è¯»æœªæäº¤</span></span><br><span class="line"><span class="meta">@Transactional(isolation = Isolation.READ_COMMITTED)</span><span class="comment">//è¯»å·²æäº¤</span></span><br><span class="line"><span class="meta">@Transactional(isolation = Isolation.REPEATABLE_READ)</span><span class="comment">//å¯é‡å¤è¯»</span></span><br><span class="line"><span class="meta">@Transactional(isolation = Isolation.SERIALIZABLE)</span><span class="comment">//ä¸²è¡ŒåŒ–</span></span><br></pre></td></tr></table></figure><h4 id="äº‹åŠ¡å±æ€§ï¼šä¼ æ’­è¡Œä¸º"><a href="#äº‹åŠ¡å±æ€§ï¼šä¼ æ’­è¡Œä¸º" class="headerlink" title="äº‹åŠ¡å±æ€§ï¼šä¼ æ’­è¡Œä¸º"></a>äº‹åŠ¡å±æ€§ï¼šä¼ æ’­è¡Œä¸º</h4><p><strong>â‘ ä»‹ç»</strong></p><p>ä»€ä¹ˆæ˜¯äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸ºï¼Ÿ</p><p>åœ¨serviceç±»ä¸­æœ‰a()æ–¹æ³•å’Œb()æ–¹æ³•ï¼Œa()æ–¹æ³•ä¸Šæœ‰äº‹åŠ¡ï¼Œb()æ–¹æ³•ä¸Šä¹Ÿæœ‰äº‹åŠ¡ï¼Œå½“a()æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­è°ƒç”¨äº†b()æ–¹æ³•ï¼Œäº‹åŠ¡æ˜¯å¦‚ä½•ä¼ é€’çš„ï¼Ÿåˆå¹¶åˆ°ä¸€ä¸ªäº‹åŠ¡é‡Œï¼Ÿè¿˜æ˜¯å¼€å¯ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Ÿè¿™å°±æ˜¯äº‹åŠ¡ä¼ æ’­è¡Œä¸ºã€‚</p><p>ä¸€å…±æœ‰ä¸ƒç§ä¼ æ’­è¡Œä¸ºï¼š</p><ul><li>REQUIREDï¼šæ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœä¸å­˜åœ¨å°±æ–°å»ºä¸€ä¸ª(é»˜è®¤)<strong>ã€æ²¡æœ‰å°±æ–°å»ºï¼Œæœ‰å°±åŠ å…¥ã€‘</strong></li><li>SUPPORTSï¼šæ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œ<strong>ã€æœ‰å°±åŠ å…¥ï¼Œæ²¡æœ‰å°±ä¸ç®¡äº†ã€‘</strong></li><li>MANDATORYï¼šå¿…é¡»è¿è¡Œåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡æ­£åœ¨å‘ç”Ÿï¼Œå°†æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸<strong>ã€æœ‰å°±åŠ å…¥ï¼Œæ²¡æœ‰å°±æŠ›å¼‚å¸¸ã€‘</strong></li><li>REQUIRES_NEWï¼šå¼€å¯ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œå¦‚æœä¸€ä¸ªäº‹åŠ¡å·²ç»å­˜åœ¨ï¼Œåˆ™å°†è¿™ä¸ªå­˜åœ¨çš„äº‹åŠ¡æŒ‚èµ·<strong>ã€ä¸ç®¡æœ‰æ²¡æœ‰ï¼Œç›´æ¥å¼€å¯ä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œå¼€å¯çš„æ–°äº‹åŠ¡å’Œä¹‹å‰çš„äº‹åŠ¡ä¸å­˜åœ¨åµŒå¥—å…³ç³»ï¼Œä¹‹å‰äº‹åŠ¡è¢«æŒ‚èµ·ã€‘</strong></li><li>NOT_SUPPORTEDï¼šä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœæœ‰äº‹åŠ¡å­˜åœ¨ï¼ŒæŒ‚èµ·å½“å‰äº‹åŠ¡<strong>ã€ä¸æ”¯æŒäº‹åŠ¡ï¼Œå­˜åœ¨å°±æŒ‚èµ·ã€‘</strong></li><li>NEVERï¼šä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœæœ‰äº‹åŠ¡å­˜åœ¨ï¼ŒæŠ›å‡ºå¼‚å¸¸<strong>ã€ä¸æ”¯æŒäº‹åŠ¡ï¼Œå­˜åœ¨å°±æŠ›å¼‚å¸¸ã€‘</strong></li><li>NESTEDï¼šå¦‚æœå½“å‰æ­£æœ‰ä¸€ä¸ªäº‹åŠ¡åœ¨è¿›è¡Œä¸­ï¼Œåˆ™è¯¥æ–¹æ³•åº”å½“è¿è¡Œåœ¨ä¸€ä¸ªåµŒå¥—å¼äº‹åŠ¡ä¸­ã€‚è¢«åµŒå¥—çš„äº‹åŠ¡å¯ä»¥ç‹¬ç«‹äºå¤–å±‚äº‹åŠ¡è¿›è¡Œæäº¤æˆ–å›æ»šã€‚å¦‚æœå¤–å±‚äº‹åŠ¡ä¸å­˜åœ¨ï¼Œè¡Œä¸ºå°±åƒREQUIREDä¸€æ ·ã€‚<strong>ã€æœ‰äº‹åŠ¡çš„è¯ï¼Œå°±åœ¨è¿™ä¸ªäº‹åŠ¡é‡Œå†åµŒå¥—ä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„äº‹åŠ¡ï¼ŒåµŒå¥—çš„äº‹åŠ¡å¯ä»¥ç‹¬ç«‹çš„æäº¤å’Œå›æ»šã€‚æ²¡æœ‰äº‹åŠ¡å°±å’ŒREQUIREDä¸€æ ·ã€‚ã€‘</strong></li></ul><p><strong>â‘¡æµ‹è¯•</strong></p><p>åˆ›å»ºæ¥å£CheckoutServiceï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CheckoutService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">checkout</span><span class="params">(Integer[] bookIds, Integer userId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºå®ç°ç±»CheckoutServiceImplï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CheckoutServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">CheckoutService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookService bookService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="comment">//ä¸€æ¬¡è´­ä¹°å¤šæœ¬å›¾ä¹¦</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkout</span><span class="params">(Integer[] bookIds, Integer userId)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (Integer bookId : bookIds) &#123;</span><br><span class="line">            bookService.buyBook(bookId, userId);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨BookControllerä¸­æ·»åŠ æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> CheckoutService checkoutService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkout</span><span class="params">(Integer[] bookIds, Integer userId)</span>&#123;</span><br><span class="line">    checkoutService.checkout(bookIds, userId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ•°æ®åº“ä¸­å°†ç”¨æˆ·çš„ä½™é¢ä¿®æ”¹ä¸º100å…ƒ</p><p><strong>â‘¢è§‚å¯Ÿç»“æœ</strong></p><p>å¯ä»¥é€šè¿‡@Transactionalä¸­çš„propagationå±æ€§è®¾ç½®äº‹åŠ¡ä¼ æ’­è¡Œä¸º</p><p>ä¿®æ”¹BookServiceImplä¸­buyBook()ä¸Šï¼Œæ³¨è§£@Transactionalçš„propagationå±æ€§</p><p>@Transactional(propagation &#x3D; Propagation.REQUIRED)ï¼Œé»˜è®¤æƒ…å†µï¼Œè¡¨ç¤ºå¦‚æœå½“å‰çº¿ç¨‹ä¸Šæœ‰å·²ç»å¼€å¯çš„äº‹åŠ¡å¯ç”¨ï¼Œé‚£ä¹ˆå°±åœ¨è¿™ä¸ªäº‹åŠ¡ä¸­è¿è¡Œã€‚ç»è¿‡è§‚å¯Ÿï¼Œè´­ä¹°å›¾ä¹¦çš„æ–¹æ³•buyBook()åœ¨checkout()ä¸­è¢«è°ƒç”¨ï¼Œcheckout()ä¸Šæœ‰äº‹åŠ¡æ³¨è§£ï¼Œå› æ­¤åœ¨æ­¤äº‹åŠ¡ä¸­æ‰§è¡Œã€‚æ‰€è´­ä¹°çš„ä¸¤æœ¬å›¾ä¹¦çš„ä»·æ ¼ä¸º80å’Œ50ï¼Œè€Œç”¨æˆ·çš„ä½™é¢ä¸º100ï¼Œå› æ­¤åœ¨è´­ä¹°ç¬¬äºŒæœ¬å›¾ä¹¦æ—¶ä½™é¢ä¸è¶³å¤±è´¥ï¼Œå¯¼è‡´æ•´ä¸ªcheckout()å›æ»šï¼Œå³åªè¦æœ‰ä¸€æœ¬ä¹¦ä¹°ä¸äº†ï¼Œå°±éƒ½ä¹°ä¸äº†</p><p>@Transactional(propagation &#x3D; Propagation.REQUIRES_NEW)ï¼Œè¡¨ç¤ºä¸ç®¡å½“å‰çº¿ç¨‹ä¸Šæ˜¯å¦æœ‰å·²ç»å¼€å¯çš„äº‹åŠ¡ï¼Œéƒ½è¦å¼€å¯æ–°äº‹åŠ¡ã€‚åŒæ ·çš„åœºæ™¯ï¼Œæ¯æ¬¡è´­ä¹°å›¾ä¹¦éƒ½æ˜¯åœ¨buyBook()çš„äº‹åŠ¡ä¸­æ‰§è¡Œï¼Œå› æ­¤ç¬¬ä¸€æœ¬å›¾ä¹¦è´­ä¹°æˆåŠŸï¼Œäº‹åŠ¡ç»“æŸï¼Œç¬¬äºŒæœ¬å›¾ä¹¦è´­ä¹°å¤±è´¥ï¼Œåªåœ¨ç¬¬äºŒæ¬¡çš„buyBook()ä¸­å›æ»šï¼Œè´­ä¹°ç¬¬ä¸€æœ¬å›¾ä¹¦ä¸å—å½±å“ï¼Œå³èƒ½ä¹°å‡ æœ¬å°±ä¹°å‡ æœ¬ã€‚</p><h4 id="å…¨æ³¨è§£é…ç½®äº‹åŠ¡"><a href="#å…¨æ³¨è§£é…ç½®äº‹åŠ¡" class="headerlink" title="å…¨æ³¨è§£é…ç½®äº‹åŠ¡"></a>å…¨æ³¨è§£é…ç½®äº‹åŠ¡</h4><p><strong>â‘ æ·»åŠ é…ç½®ç±»</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hang.spring6.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.datasource.DataSourceTransactionManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.EnableTransactionManagement;</span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.hang.spring6&quot;)</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">getDataSource</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">        dataSource.setDriverClassName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        dataSource.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/spring?characterEncoding=utf8&amp;useSSL=false&quot;</span>);</span><br><span class="line">        dataSource.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dataSource.setPassword(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;jdbcTemplate&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JdbcTemplate <span class="title function_">getJdbcTemplate</span><span class="params">(DataSource dataSource)</span>&#123;</span><br><span class="line">        <span class="type">JdbcTemplate</span> <span class="variable">jdbcTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JdbcTemplate</span>();</span><br><span class="line">        jdbcTemplate.setDataSource(dataSource);</span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSourceTransactionManager <span class="title function_">getDataSourceTransactionManager</span><span class="params">(DataSource dataSource)</span>&#123;</span><br><span class="line">        <span class="type">DataSourceTransactionManager</span> <span class="variable">dataSourceTransactionManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataSourceTransactionManager</span>();</span><br><span class="line">        dataSourceTransactionManager.setDataSource(dataSource);</span><br><span class="line">        <span class="keyword">return</span> dataSourceTransactionManager;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>â‘¡æµ‹è¯•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.hang.spring6.config.SpringConfig;</span><br><span class="line"><span class="keyword">import</span> com.hang.spring6.controller.BookController;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.AnnotationConfigApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit.jupiter.SpringJUnitConfig;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TxByAllAnnotationTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testTxAllAnnotation</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfig.class);</span><br><span class="line">        <span class="type">BookController</span> <span class="variable">accountService</span> <span class="operator">=</span> applicationContext.getBean(<span class="string">&quot;bookController&quot;</span>, BookController.class);</span><br><span class="line">        accountService.buyBook(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŸºäºXMLçš„å£°æ˜å¼äº‹åŠ¡"><a href="#åŸºäºXMLçš„å£°æ˜å¼äº‹åŠ¡" class="headerlink" title="åŸºäºXMLçš„å£°æ˜å¼äº‹åŠ¡"></a>åŸºäºXMLçš„å£°æ˜å¼äº‹åŠ¡</h3><h4 id="åœºæ™¯æ¨¡æ‹Ÿ-1"><a href="#åœºæ™¯æ¨¡æ‹Ÿ-1" class="headerlink" title="åœºæ™¯æ¨¡æ‹Ÿ"></a>åœºæ™¯æ¨¡æ‹Ÿ</h4><p>å‚è€ƒåŸºäºæ³¨è§£çš„å£°æ˜å¼äº‹åŠ¡</p><h4 id="ä¿®æ”¹Springé…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹Springé…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹Springé…ç½®æ–‡ä»¶"></a>ä¿®æ”¹Springé…ç½®æ–‡ä»¶</h4><p>å°†Springé…ç½®æ–‡ä»¶ä¸­å»æ‰tx:annotation-driven æ ‡ç­¾ï¼Œå¹¶æ·»åŠ é…ç½®ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- é…ç½®äº‹åŠ¡é€šçŸ¥å’Œåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">pointcut</span>=<span class="string">&quot;execution(* com.hang.spring.tx.xml.service.impl.*.*(..))&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:advisor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- tx:adviceæ ‡ç­¾ï¼šé…ç½®äº‹åŠ¡é€šçŸ¥ --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- idå±æ€§ï¼šç»™äº‹åŠ¡é€šçŸ¥æ ‡ç­¾è®¾ç½®å”¯ä¸€æ ‡è¯†ï¼Œä¾¿äºå¼•ç”¨ --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- transaction-managerå±æ€§ï¼šå…³è”äº‹åŠ¡ç®¡ç†å™¨ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- tx:methodæ ‡ç­¾ï¼šé…ç½®å…·ä½“çš„äº‹åŠ¡æ–¹æ³• --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- nameå±æ€§ï¼šæŒ‡å®šæ–¹æ³•åï¼Œå¯ä»¥ä½¿ç”¨æ˜Ÿå·ä»£è¡¨å¤šä¸ªå­—ç¬¦ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;get*&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;query*&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;find*&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">        <span class="comment">&lt;!-- read-onlyå±æ€§ï¼šè®¾ç½®åªè¯»å±æ€§ --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- rollback-forå±æ€§ï¼šè®¾ç½®å›æ»šçš„å¼‚å¸¸ --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- no-rollback-forå±æ€§ï¼šè®¾ç½®ä¸å›æ»šçš„å¼‚å¸¸ --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- isolationå±æ€§ï¼šè®¾ç½®äº‹åŠ¡çš„éš”ç¦»çº§åˆ« --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- timeoutå±æ€§ï¼šè®¾ç½®äº‹åŠ¡çš„è¶…æ—¶å±æ€§ --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- propagationå±æ€§ï¼šè®¾ç½®äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;save*&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;false&quot;</span> <span class="attr">rollback-for</span>=<span class="string">&quot;java.lang.Exception&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRES_NEW&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;update*&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;false&quot;</span> <span class="attr">rollback-for</span>=<span class="string">&quot;java.lang.Exception&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRES_NEW&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;delete*&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;false&quot;</span> <span class="attr">rollback-for</span>=<span class="string">&quot;java.lang.Exception&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRES_NEW&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šåŸºäºxmlå®ç°çš„å£°æ˜å¼äº‹åŠ¡ï¼Œå¿…é¡»å¼•å…¥aspectJçš„ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></blockquote>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> åç«¯ </tag>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexoå¼•å…¥æœ¬åœ°å›¾ç‰‡</title>
      <link href="/2023/09/23/Hexo%E5%BC%95%E5%85%A5%E6%9C%AC%E5%9C%B0%E5%9B%BE%E7%89%87/"/>
      <url>/2023/09/23/Hexo%E5%BC%95%E5%85%A5%E6%9C%AC%E5%9C%B0%E5%9B%BE%E7%89%87/</url>
      
        <content type="html"><![CDATA[<h2 id="å®ç°æ­¥éª¤"><a href="#å®ç°æ­¥éª¤" class="headerlink" title="å®ç°æ­¥éª¤"></a>å®ç°æ­¥éª¤</h2><p>ç¬¬ä¸€æ­¥ï¼šä¿®æ”¹é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„<code>_config.yml</code>æ–‡ä»¶å‚æ•°<code>post_asset_folder</code>å€¼ä¸º<code>true</code>ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¼€å§‹ä½¿ç”¨æœ¬åœ°é™æ€èµ„æº</span></span><br><span class="line"><span class="attr">post_asset_folder:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥ï¼šå®‰è£…æ’ä»¶<code>hexo-asset-image</code>ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œ</span></span><br><span class="line"><span class="string">npm</span> <span class="string">install</span> <span class="string">https://github.com/xcodebuild/hexo-asset-image.git</span> <span class="string">--save</span></span><br></pre></td></tr></table></figure><p>å®Œæˆä¸Šè¿°é…ç½®åï¼Œåœ¨ä½¿ç”¨å‘½ä»¤<code>hexo new post</code>æ–°å»ºæ–‡ç« æ—¶ï¼Œå°†ä¼šåœ¨<code>source/_posts</code>ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªä¸æ–‡ç« åŒåçš„ç›®å½•ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">hexo</span> <span class="string">new</span> <span class="string">post</span> <span class="string">&quot;æµ‹è¯•æ–‡ç« &quot;</span></span><br></pre></td></tr></table></figure><p>å¤åˆ¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">|____scaffolds</span></span><br><span class="line"><span class="string">|____source</span></span><br><span class="line"><span class="string">|</span> <span class="string">|_____posts</span></span><br><span class="line"><span class="string">|</span> <span class="string">|</span> <span class="string">|____æµ‹è¯•æ–‡ç« .md</span></span><br><span class="line"><span class="string">|</span> <span class="string">|</span> <span class="string">|____æµ‹è¯•æ–‡ç« </span> <span class="comment"># ä¸æ–‡ç« åŒåçš„ç›®å½•ï¼Œç”¨äºä¿å­˜åœ¨æ–‡ç« ä¸­å¼•å…¥çš„æœ¬åœ°å›¾ç‰‡èµ„æº</span></span><br><span class="line"><span class="string">|____themes</span></span><br></pre></td></tr></table></figure><p>å¤åˆ¶</p><p>å¦‚ä¸Šï¼Œæ–°å»ºâ€œæµ‹è¯•æ–‡ç« .mdâ€æ—¶ï¼Œå°†ä¼šåœ¨<code>_posts</code>ç›®å½•ä¸‹åˆ›å»ºåŒåæ–‡ä»¶å¤¹â€œæµ‹è¯•æ–‡ç« â€ï¼Œåœ¨â€œæµ‹è¯•æ–‡ç« .mdâ€æ–‡ä»¶ä¸­éœ€è¦å¼•å…¥çš„å›¾ç‰‡æ–‡ä»¶åªè¦æ”¾åœ¨ç›®å½•â€œæµ‹è¯•æ–‡ç« â€ä¸‹å³å¯ã€‚ å›¾ç‰‡å¼•ç”¨æ–¹å¼ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¼•ç”¨å›¾ç‰‡çš„æ—¶å€™ä¸€å®šè¦å¸¦ä¸Šç›®å½•åç§°ä½œä¸ºè·¯å¾„</span></span><br><span class="line"><span class="type">![</span><span class="string">æœ¬åœ°å›¾ç‰‡](æµ‹è¯•æ–‡ç« /æœ¬åœ°å›¾ç‰‡.jpg)</span></span><br></pre></td></tr></table></figure><p>å¤åˆ¶</p><p>ä½¿ç”¨è¯¥æ–¹å¼å¼•ç”¨çš„å›¾ç‰‡æ—¢å¯ä»¥åœ¨æœ¬åœ°é¢„è§ˆï¼Œæ­£å¼å‘å¸ƒä¹‹åä¹Ÿèƒ½æ­£å¸¸æ˜¾ç¤ºã€‚</p><h2 id="åŸç†è¯´æ˜"><a href="#åŸç†è¯´æ˜" class="headerlink" title="åŸç†è¯´æ˜"></a>åŸç†è¯´æ˜</h2><p>æ˜¾ç„¶ï¼Œåœ¨hexoä¸­å¼•å…¥å›¾ç‰‡çš„æ–¹å¼ç¨å¾®æœ‰ç‚¹ç¹çï¼Œå³ï¼šå¿…é¡»åœ¨<code>_post</code>ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªä¸æ–‡ç« åŒåçš„ç›®å½•ï¼Œç„¶åå°†éœ€è¦å¼•ç”¨çš„å›¾ç‰‡æ–‡ä»¶éƒ½æ”¾åœ¨è¯¥ç›®å½•ä¸­ã€‚ è¿˜å¥½ä½¿ç”¨æ’ä»¶<code>hexo-asset-image</code>èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨åˆ›å»ºå›¾ç‰‡ç›®å½•ï¼ˆæ¯æ¬¡éƒ½ä¼šè‡ªåŠ¨åˆ›å»ºï¼Œå¦‚æœåœ¨æ–‡ç« ä¸­ä¸éœ€è¦å¼•ç”¨å›¾ç‰‡èµ„æºï¼Œå¯ä»¥æ‰‹åŠ¨å°†è¯¥ç›®å½•åˆ é™¤ï¼‰ã€‚</p><p>é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆéœ€è¦å°†æ–‡ç« å¼•ç”¨çš„å›¾ç‰‡æ”¾ç½®åœ¨ä¸æ–‡ç« åŒåçš„ç›®å½•å‘¢ï¼Ÿ åŸå› æ˜¯ï¼šåœ¨æ‰§è¡Œ<code>hexo g</code>å‘½ä»¤çš„æ—¶å€™ä¼šå°†æ–‡ç« è½¬æ¢ä¸ºä¸€ä¸ª<code>index.html</code>æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶è·¯å¾„ä¸º<code>public/å¹´/æœˆ/æ—¥/æ–‡ç« åç§°/index.html</code>ï¼ŒåŒæ—¶ä¹Ÿä¼šå°†æ–‡ç« ä¸­å¼•ç”¨çš„å›¾ç‰‡æ–‡ä»¶æ‹·è´åˆ°ä¸<code>index.html</code>æ–‡ä»¶ç›¸åŒçš„ç›®å½•ä¸­ã€‚ å¦å¤–ï¼Œè½¬æ¢åçš„<code>index.html</code>æ–‡ä»¶ä¿å­˜è·¯å¾„ä¸­æœ‰ä¸€ä¸ª<code>å¹´/æœˆ/æ—¥</code>ï¼Œè¿™æ˜¯åœ¨é¡¹ç›®é…ç½®æ–‡ä»¶<code>_config.yml</code>çš„<code>permalink</code>å‚æ•°ä¸­é…ç½®çš„ï¼Œé»˜è®¤å€¼ä¸ºï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">permalink:</span> <span class="string">:year/:month/:day/:title/</span></span><br></pre></td></tr></table></figure><p>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>æœ¬æ–‡è½¬è½½åšä¸»ã€Œç¼–ç¨‹éšç¬”ã€æ–‡ç« :<br>åŸæ–‡é“¾æ¥ï¼š<a href="https://cloud.tencent.com/developer/article/2202579">åœ¨Hexoä¸­å¼•å…¥æœ¬åœ°å›¾ç‰‡çš„å®ç°-è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘ (tencent.com)</a></p>]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexoé­”æ”¹ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
